<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><div id="myscoll"></div><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>GQ Video项目相关解答 | geqian's Blog🍭</title><meta name="keywords" content="项目相关"><meta name="author" content="geqian's Blog🍭"><meta name="copyright" content="geqian's Blog🍭"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="GQ Video项目相关解答">
<meta property="og:type" content="article">
<meta property="og:title" content="GQ Video项目相关解答">
<meta property="og:url" content="https://itgeqian.github.io/posts/83.html">
<meta property="og:site_name" content="geqian&#39;s Blog🍭">
<meta property="og:description" content="GQ Video项目相关解答">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/84.jpg">
<meta property="article:published_time" content="2025-09-06T09:09:03.000Z">
<meta property="article:modified_time" content="2025-09-16T12:01:00.000Z">
<meta property="article:author" content="geqian&#39;s Blog🍭">
<meta property="article:tag" content="项目相关">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/84.jpg"><link rel="shortcut icon" href="/"><link rel="canonical" href="https://itgeqian.github.io/posts/83"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.js',
      css: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'GQ Video项目相关解答',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-09-16 20:01:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><style id="themeColor"></style><style id="rightSide"></style><style id="transPercent"></style><style id="blurNum"></style><style id="settingStyle"></style><span id="fps"></span><style id="defineBg"></style><style id="menu_shadow"></style><script src="https://cdn.jsdelivr.net/npm/echarts@6/dist/echarts.min.js"></script><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper@1.0.12/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper@1.0.12/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="geqian's Blog🍭" type="application/atom+xml">
</head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/assets/avatar.png" onerror="onerror=null;src='/assets/r1.jpg'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">83</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">51</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">18</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> 首页</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--article"></use></svg><span class="menu_word" style="font-size:17px"> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei">                   </use></svg><span class="menu_word" style="font-size:17px"> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pinweishenghuo"></use></svg><span class="menu_word" style="font-size:17px"> 休闲</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/life/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-yinle">                   </use></svg><span class="menu_word" style="font-size:17px"> 八音盒</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-dianying1">                   </use></svg><span class="menu_word" style="font-size:17px"> 影院</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-youxishoubing">                   </use></svg><span class="menu_word" style="font-size:17px"> 游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xiangzi"></use></svg><span class="menu_word" style="font-size:17px"> 八宝箱</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/box/gallery/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-tubiaozhizuomoban">                   </use></svg><span class="menu_word" style="font-size:17px"> 画廊</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/animation/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-nvwumao">                   </use></svg><span class="menu_word" style="font-size:17px"> 动画</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-zhifengche">                   </use></svg><span class="menu_word" style="font-size:17px"> 网址导航</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> 社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pengyouquan">                   </use></svg><span class="menu_word" style="font-size:17px"> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangye"></use></svg><span class="menu_word" style="font-size:17px"> 网站</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/site/census/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--tongjibiao">                   </use></svg><span class="menu_word" style="font-size:17px"> 网站统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujutongji1">                   </use></svg><span class="menu_word" style="font-size:17px"> 文章统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/time/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xianxingshalou">                   </use></svg><span class="menu_word" style="font-size:17px"> 旧时光</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">geqian's Blog🍭</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> 首页</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--article"></use></svg><span class="menu_word" style="font-size:17px"> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei">                   </use></svg><span class="menu_word" style="font-size:17px"> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pinweishenghuo"></use></svg><span class="menu_word" style="font-size:17px"> 休闲</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/life/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-yinle">                   </use></svg><span class="menu_word" style="font-size:17px"> 八音盒</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-dianying1">                   </use></svg><span class="menu_word" style="font-size:17px"> 影院</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-youxishoubing">                   </use></svg><span class="menu_word" style="font-size:17px"> 游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xiangzi"></use></svg><span class="menu_word" style="font-size:17px"> 八宝箱</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/box/gallery/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-tubiaozhizuomoban">                   </use></svg><span class="menu_word" style="font-size:17px"> 画廊</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/animation/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-nvwumao">                   </use></svg><span class="menu_word" style="font-size:17px"> 动画</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-zhifengche">                   </use></svg><span class="menu_word" style="font-size:17px"> 网址导航</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> 社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pengyouquan">                   </use></svg><span class="menu_word" style="font-size:17px"> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangye"></use></svg><span class="menu_word" style="font-size:17px"> 网站</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/site/census/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--tongjibiao">                   </use></svg><span class="menu_word" style="font-size:17px"> 网站统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujutongji1">                   </use></svg><span class="menu_word" style="font-size:17px"> 文章统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/time/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xianxingshalou">                   </use></svg><span class="menu_word" style="font-size:17px"> 旧时光</span></a></li></ul></div></div><center id="name-container"><a id="page-name" href="javascript:scrollToTop()">PAGE_NAME</a></center><div id="nav-right"><div id="search-button"><a class="search faa-parent animated-hover" title="检索站内任何你想要的信息"><svg class="faa-tada icon" style="height:24px;width:24px;fill:currentColor;position:relative;top:6px" aria-hidden="true"><use xlink:href="#icon-valentine_-search-love-find-heart"></use></svg><span> 搜索</span></a></div><a class="meihua faa-parent animated-hover" onclick="toggleWinbox()" title="美化设置-自定义你的风格" id="meihua-button"><svg class="faa-tada icon" style="height:26px;width:26px;fill:currentColor;position:relative;top:8px" aria-hidden="true"><use xlink:href="#icon-tupian1"></use></svg></a><a class="sun_moon faa-parent animated-hover" onclick="switchNightMode()" title="浅色和深色模式转换" id="nightmode-button"><svg class="faa-tada" style="height:25px;width:25px;fill:currentColor;position:relative;top:7px" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon">       </use></svg></a><div id="toggle-menu"><a><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-info"><h1 class="post-title">GQ Video项目相关解答</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><svg class="meta_icon post-meta-icon" style="width:30px;height:30px;position:relative;top:10px"><use xlink:href="#icon-rili"></use></svg><span class="post-meta-label">发表于 </span><time class="post-meta-date-created" datetime="2025-09-06T09:09:03.000Z" title="发表于 2025-09-06 17:09:03">2025-09-06</time><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-gengxin1"></use></svg><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-09-16T12:01:00.000Z" title="更新于 2025-09-16 20:01:00">2025-09-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-biaoqian"></use></svg><a class="post-meta-categories" href="/categories/%E9%9D%A2%E8%AF%95/">面试</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:8px"><use xlink:href="#icon-charuword"></use></svg><span class="post-meta-label">字数总计:</span><span class="word-count">1.8w</span><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:20px;height:20px;position:relative;top:5px"><use xlink:href="#icon-shizhong"></use></svg><span class="post-meta-label">阅读时长:</span><span>55分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="GQ Video项目相关解答"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:5px"><use xlink:href="#icon-eye"></use></svg><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="GQ-Video">GQ Video</h1>
<h2 id="请你先简单介绍一下这个GQ-Video项目？">请你先简单介绍一下这个GQ Video项目？</h2>
<p>GQ Video 是我之前做的一个<strong>在线视频互动社区</strong>项目，主要面向 B 端创作者和 C 端观众。简单说，它不是单纯的视频点播网站，它是**“视频内容 + 实时互动 + 数据统计”一体化的平台**，功能上包括：视频上传与转码、弹幕评论、互动计数（点赞、收藏、投币）、消息通知以及搜索和推荐等。</p>
<p>从架构上，我们是基于 <strong>Spring Boot + Spring Cloud Alibaba 微服务</strong>来搭的，前后端分离，后端拆成了<strong>视频服务、互动服务、资源服务、网关、Admin</strong> 等多个微服务，<strong>注册发现用 Nacos，统一入口用 Gateway，缓存用 Redis，搜索用 Elasticsearch，存储用 Mysql + Minio，异步解耦用 RocketMQ，分布式事务用 Seata</strong>。</p>
<p>我个人主要负责的是<strong>后端整体架构设计和核心业务链路</strong>，包括：</p>
<ul>
<li>微服务的拆分和技术选型，网关路由和注册中心的搭建；</li>
<li>Redis 业务组件（登录 Token、验证码、在线人数、播放量统计等）；</li>
<li>ES 搜索与排序、RocketMQ 播放埋点与转码链路；</li>
<li>以及大文件分片上传、FFmpeg 转码、对象存储上传这些跟视频强相关的能力。</li>
</ul>
<p>整体来看，这是一个<strong>强调高并发读、多服务协同、强互动体验</strong>的视频社区项目。</p>
<h2 id="你提到你把后端微服务拆成了视频服务、互动服务、资源服务、网关、Admin-这5个微服务模块，你能告诉你当时是怎么想的吗？为什么这么设计呢？">你提到你把后端微服务拆成了视频服务、互动服务、资源服务、网关、Admin 这5个微服务模块，你能告诉你当时是怎么想的吗？为什么这么设计呢？</h2>
<p><strong>先说整体思路</strong>：我不是一上来就按技术栈拆，而是按**业务边界 + 非功能需求（扩展性、吞吐、存储类型）**来划的。最终形成的是 <strong>4 个业务域服务</strong> + 1 个统一入口的网关。</p>
<hr>
<h3 id="1）视频服务：核心业务域，单独拿出来">1）视频服务：核心业务域，单独拿出来</h3>
<ul>
<li>视频的投稿、审核、推荐、分 P 管理、基础统计（播放、收藏、投币这些计数）都放在这里，它是整个系统的数据中心之一。</li>
<li>原因很简单：
<ul>
<li>一方面视频这块业务规则复杂、表多、事务多（涉及用户、硬币、稿件、多表更新），需要一个比较“重”的服务来兜；</li>
<li>另一方面很多其它服务（互动、资源）都要依赖视频基础信息，如果混在一起，后面扩展会很难拆。</li>
</ul>
</li>
</ul>
<h3 id="2）互动服务：高频操作，解耦出来减压">2）互动服务：高频操作，解耦出来减压</h3>
<ul>
<li>评论、弹幕、用户消息、点赞/收藏行为记录、在线人数这类“高频轻量操作”全部放在互动服务里。</li>
<li>这么拆有几个考虑：
<ul>
<li>互动读写非常频繁，如果和视频主表强耦合在一个服务里，很容易拖慢核心视频接口；</li>
<li>互动的扩展模式也不太一样，后期要做限流、风控、黑名单、反垃圾等，会在这个域里持续演进，把它单独拆出来更灵活；</li>
<li>通过内部接口和消息，把互动和视频的统计关联起来，比如删除视频的时候让互动服务清评论、清弹幕等。</li>
</ul>
</li>
</ul>
<h3 id="3）资源服务：和“文件-存储-转码”强相关，单独一个域">3）资源服务：和“文件/存储/转码”强相关，单独一个域</h3>
<ul>
<li>所有跟<strong>文件打交道</strong>的东西：大文件分片上传、合并、转码、切片、对象存储（MinIO）、本地文件清理等，都由资源服务负责。</li>
<li>这么做的原因是：
<ul>
<li>这块会涉及 FFmpeg、磁盘 IO、网络带宽这些比较“重”的资源占用，我不想让业务服务直接承担这一块的复杂性；</li>
<li>未来如果要换存储方案、加 CDN、引入新的转码规格，只要改资源服务，不会影响视频、互动那边的业务接口；</li>
<li>对外暴露的也是统一的文件上传/下载/删除接口，其他服务通过内部调用来使用。</li>
</ul>
</li>
</ul>
<h3 id="4）Admin（后台管理）：权限和场景完全不同，单独服务">4）Admin（后台管理）：权限和场景完全不同，单独服务</h3>
<ul>
<li>后台有一套自己的登录、角色权限、审核发布、运营配置等需求，和 C 端的访问模式完全不一样。</li>
<li>我把 Admin 单独拆出来：
<ul>
<li>可以用独立的账号体系和权限模型，不影响 C 端用户登录；</li>
<li>它调用内部接口去操作视频、互动、资源，不直接暴露核心表结构；</li>
<li>部署上也可以跟前台分开，比如只开放给内网或特定 IP 段。</li>
</ul>
</li>
</ul>
<h3 id="5）网关：统一入口-路由-安全">5）网关：统一入口 + 路由 + 安全</h3>
<ul>
<li>最外层用网关做唯一入口，对外就是一个域名，内部再把请求分发到视频、互动、资源、Admin 对应的服务。</li>
<li>网关这层我还会做几件事：
<ul>
<li>路由转发、路径统一、参数/头部的一些统一处理；</li>
<li>基础的鉴权和灰度，比如拦截内部接口、做简单的版本路由；</li>
<li>给后面限流、监控、埋点留好切入点。</li>
</ul>
</li>
</ul>
<hr>
<h3 id="6）总结成一两句话给面试官">6）总结成一两句话给面试官</h3>
<blockquote>
<p>“当时拆服务，我是按业务边界来的：视频是核心业务域，互动是高频轻量域，资源是 IO/转码强相关域，Admin 是后台管理域，再加一个统一网关做入口。<br>
这样拆的好处是：<strong>核心数据和高频操作解耦、重 IO 能单独横向扩、后台和前台权限隔离、整体可扩展性和运维都更清晰</strong>，后面要做新功能或者扩容时，只动对应的那一块就行了。”</p>
</blockquote>
<h2 id="你们的服务是怎么做日志收集的">你们的服务是怎么做日志收集的</h2>
<ul>
<li>我当前项目的的做法很简单：利用Logback，既打控制台，也打本地文件。每个服务把运行日志按固定格式写到本机的 logs 目录，按“日期+大小”自动切分，保留一段时间。出问题就直接看这些日志，定位很快。</li>
<li>需要集中查看时，也不用改代码，只要在服务器上加个日志收集器Logstash、，把这些文件统一送到一个搜索平台（比如 ES），再用一个网页（比如 Kibana）来搜、画图、做告警就行。（也就是ELK）</li>
<li>一句话流程：服务写文件 → 收集器把文件送到搜索库 → 网页上一搜就能看到所有服务的日志。</li>
</ul>
<p>这样做的好处是：实现简单、出问题好排查；要升级成“像 ELK 那样的集中日志系统”也很容易，基本是平台侧加收集与展示，不用动业务代码。</p>
<h2 id="项目中你是否使用过哪些-Java-并发工具类？">项目中你是否使用过哪些 Java 并发工具类？</h2>
<h3 id="面试口述版（30-60-秒）">面试口述版（30-60 秒）</h3>
<ul>
<li>我在 GQ Video 里主要用的是线程池配合队列做并发处理。比如我们用 ExecutorService 跑后台任务：一类线程消费 Redis 队列的“播放上报”和“转码任务”，把高峰请求削到后台，避免接口阻塞；还有删除视频这种重操作，我放到线程池里异步清理 ES、对象存储和本地文件，显著降低前端等待时间。</li>
<li>传统的 JUC 工具像 ConcurrentHashMap、AtomicInteger、Semaphore、CountDownLatch、CyclicBarrier、BlockingQueue 在当前代码里没有直接大规模使用，但我熟悉它们的场景，业务上也有现成可落地的点。</li>
</ul>
<h3 id="追问时可展开（逐条举例）">追问时可展开（逐条举例）</h3>
<ul>
<li>如果要引入 JUC，我会这样用：
<ul>
<li>ConcurrentHashMap：做热门视频的本地缓存与并发加载合并，避免同一时间多线程打 DB。</li>
<li>AtomicInteger/LongAdder：本地热点计数（在线人数、播放数滑窗），定时批量回写 Redis/DB。</li>
<li>Semaphore：限制“同时转码/同时上传/外部接口调用”并发度，保护 CPU/IO 和下游。</li>
<li>CountDownLatch：首页聚合多个区块数据并行拉取，主线程等待全部完成统一返回。</li>
<li>CyclicBarrier：多清晰度转码全部完成后再一次性发布“可播放”状态。</li>
<li>BlockingQueue：作为 Redis 或 MQ 不可用时的本地降级队列，保证生产-消费不断流。</li>
</ul>
</li>
<li>选择原则：共享可变状态优先用 ConcurrentHashMap/Atomic*；资源并发控制用 Semaphore；一次性并行聚合用 CountDownLatch/CompletableFuture；阶段同步用 CyclicBarrier；生产-消费优先消息中间件，退而求其次用 BlockingQueue+线程池。</li>
</ul>
<p>一句话总结：现在我用“线程池+队列”把关键链路做了异步化和削峰，真要上更细粒度并发控制，我能把 JUC 工具按场景补进去，既能保证吞吐，也能控制稳定性。</p>
<h2 id="你具体讲讲播放事件统计、转码任务这两个任务，没上MQ你是怎么实现的，用了MQ你又是怎么实现的？">你具体讲讲播放事件统计、转码任务这两个任务，没上MQ你是怎么实现的，用了MQ你又是怎么实现的？</h2>
<h3 id="面试口语版回答（MQ-改造播放统计-转码任务）">面试口语版回答（MQ 改造播放统计 &amp; 转码任务）</h3>
<hr>
<h4 id="一、没上-MQ-之前">一、没上 MQ 之前</h4>
<p>那时候我们还没引入消息队列，用的是「<strong>线程池 + Redis 列表</strong>」来异步处理任务。</p>
<ul>
<li>
<p><strong>播放事件</strong>：<br>
前端每次上报一次“播放事件”，<strong>后端不会直接在请求里做一堆写库操作</strong>，我这边直接把事件丢进 Redis 列表（LPUSH），后台有一个固定大小的线程池 while(true) 从列表里取（RPOP），<br>
取到VideoPlayInfoDto 之后， 做四件事：<strong>视频播放数 +1、记一条播放历史、按天在 Redis 里做播放统计、同步 ES 计数</strong>。</p>
</li>
<li>
<p><strong>转码任务</strong>：<br>
用户投稿上传完视频，我也是把转码任务信息塞进 Redis 列表，然后线程池轮询去拿</p>
<p>取到任务以后<strong>从临时目录把分片拷贝到正式目录并合并</strong>、<strong>用 FFmpeg 获取时长、转码、切片</strong>；<strong>上传到 MinIO</strong>；<strong>最后通过 Feign 调用视频服务更新数据库里的转码结果。</strong></p>
</li>
<li>
<p>这一版的问题其实也比较典型：</p>
<ul>
<li>
<p>所有重试、失败补偿、堆积监控都要自己写；</p>
</li>
<li>
<p>线程池固定死了，高峰期压上来不太好扩；</p>
</li>
<li>
<p>进程一挂或者有异常，只能靠日志排查，没有完整的轨迹。</p>
</li>
</ul>
</li>
</ul>
<hr>
<h4 id="二、上-MQ（RocketMQ）之后：发布订阅-条件开关">二、上 MQ（RocketMQ）之后：发布订阅 + 条件开关</h4>
<p>后面我们把这两条链路都迁到了 RocketMQ 上，并且用一个 mq.enabled 的配置做了灰度开关：</p>
<ul>
<li>当这个开关为false时：ExecuteQueueTask 这套 <strong>Redis + 线程池</strong>的方案生效；</li>
<li>当这个开关为true时：MqPublisher（发送者） 和两个 Consumer（消费者）（PlayEventConsumer、TranscodeConsumer）生效，老的方案被 @ConditionalOnProperty 关掉。</li>
</ul>
<p>接下来我仔细说说MQ的方案：</p>
<p>我设计了两个 Topic：</p>
<ul>
<li>
<p><code>video-play</code>（播放事件链路） 专门处理播放事件</p>
</li>
<li>
<p><code>video-transcode</code>（转码任务链路） 处理转码任务</p>
</li>
<li>
<p><strong>播放事件这块</strong>：<br>
发布端拿到播放上报后，不再往 Redis 队列里塞对象，直接把事件对象发到 MQ，不再阻塞主线程。<br>
消费端收到后，还是那4件事：加播放数、写播放历史、Redis 记录按天播放数、同步 ES 计数。</p>
<ul>
<li>差别在于这些现在都运行在 MQ 的消费线程里，<strong>主请求只负责“发消息”，很快就能返回</strong>,也就是解耦与异步。</li>
</ul>
</li>
<li>
<p>可靠性方面 RocketMQ 自带重试和死信队列，高峰期如果堆积，可以简单通过Consumer消费者组 来水平扩容。同时我还做了幂等处理（比如用 userId+videoId+fileIndex 做唯一键）。</p>
</li>
<li>
<p><strong>转码任务这块</strong>：<br>
用户提交稿件或合并分片后，会发一条转码消息到 MQ。<br>
消费端收到后 调转码组件，也就是把之前 Redis 队列里做的那一整套拷贝、<strong>合并、FFmpeg 转码、MinIO 上传、更新数据库的流程</strong>都搬到了 MQ 消费端。</p>
</li>
<li>
<p>可靠性方面RocketMQ 本身就支持失败重试和死信，<strong>如果某个视频持续转码失败，可以直接在控制台看到对应的消息和栈信息，比之前“线程里打个错误日志”好排查很多。</strong></p>
</li>
</ul>
<hr>
<h4 id="三、上-MQ-之后的变化">三、上 MQ 之后的变化</h4>
<ul>
<li>
<p>对主链路的影响（异步/解耦）：请求线程只负责“发消息”，谁来处理它都不管，发完就返回，也就是解耦与异步的一个思想，<strong>不卡在转码、统计这种重 IO 操作上</strong></p>
</li>
<li>
<p><strong>对可靠性的提升</strong>：<strong>RocketMQ 提供了重试、死信和堆积监控，出了问题有地方看，消息不会悄悄丢。</strong></p>
</li>
<li>
<p><strong>对扩展性的提升</strong>：<strong>现在想加新的统计维度或者新的转码流程，只需要新挂一个 Consumer 订阅同一个 Topic</strong>，不用改原来的业务接口。</p>
</li>
<li>
<p>对运维的友好度（兜底机制）：通过 mq.enabled 配置，可以<strong>在本地或故障场景下快速切回 Redis 方案</strong>，相当于内置了一套“降级兜底”的机制。</p>
</li>
</ul>
<hr>
<h4 id="一句话总结">一句话总结</h4>
<blockquote>
<p>之前“线程池 + Redis 列表”能把事儿干完，但可靠性和可观测性都比较差；上了 RocketMQ 之后，我把播放统计和转码都改成了标准的发布订阅模型，用 MQ 自带的重试、死信、监控能力，既把主流程解耦了，也让这两条异步链路更稳定、更好扩展。</p>
</blockquote>
<h2 id="你为什么考虑的是RocketMQ这个消息队列而不是RabbitMQ或者Kafka">你为什么考虑的是RocketMQ这个消息队列而不是RabbitMQ或者Kafka</h2>
<h3 id="面试口语版回答示例">面试口语版回答示例</h3>
<p><strong>先说结论</strong>：我们这个项目的消息主要是<strong>业务型消息</strong>，比如播放事件、转码任务这类，要求的是“<strong>可靠投递 + 可重试 + 支持延时/顺序 + 运维别能太重</strong>”，在这几个点上，RocketMQ 比 RabbitMQ、Kafka 更贴合。</p>
<ul>
<li>
<p><strong>和 RabbitMQ 比</strong><br>
<strong>RabbitMQ</strong> 的路由模型确实很灵活，但整体吞吐会比 RocketMQ、Kafka 小一档，高峰期如果播放上报和转码任务一起压上来，压力会比较大；<br>
另外像<strong>延时消息、死信队列</strong>这类能力，RabbitMQ <strong>需要依赖插件或自己组合交换机/队列去做</strong>，<strong>而 RocketMQ 是原生就支持重试和死信队列的</strong>，我们消费端只要用 <code>@RocketMQMessageListener</code> 配一下消费组，就能直接享受这些能力，开发、排障都更简单；<br>
<strong>再加上我们本身用了 Spring Cloud Alibaba，一般也是跟 Nacos、Seata、RocketMQ 这一套生态一起用，集成成本更低。</strong></p>
</li>
<li>
<p><strong>和 Kafka 比</strong><br>
Kafka 更适合做<strong>日志、埋点、流式计算</strong>那种“<strong>海量吞吐 + 最终一致</strong>”的场景，它的消费模型是“至少一次”，做业务幂等要自己花不少功夫；<br>
而我们这类业务消息，更关心的是<strong>单条消息失败怎么重试、超过次数怎么办、要不要进死信队列、需要不要做延时重试</strong>，这些在 RocketMQ 里基本是开箱就有的，而在 Kafka 里很多要靠周边组件或者自研补；<br>
同时 Kafka 集群本身的<strong>运维成本也更高一些</strong>，对我们这种“中高并发的业务系统”来说，RocketMQ 在<strong>特性和复杂度之间更平衡</strong>。</p>
</li>
<li>
<p><strong>结合到我们项目落地</strong><br>
在 RocketMQ 上实现起来比较顺手，如果换成 RabbitMQ/Kafka，要么自己补很多机制，要么运维和开发成本都会上去。</p>
</li>
</ul>
<p><strong>一句话总结</strong>：<strong>在这个以业务消息为主的场景下，RocketMQ 既能扛住播放/转码的量，又自带重试、死信、延时等业务友好的特性，和我们用的 Spring Cloud Alibaba 生态也比较契合，所以我更倾向选 RocketMQ，而不是 RabbitMQ 或 Kafka</strong>。</p>
<h2 id="我看到你的项目技术栈有Elasticsearch-，你说说你的Elasticsearch-做了哪些事，你为什么选择了Elasticsearch这个搜索引擎？你是怎么保证ES和Mysql的一致性的？">我看到你的项目技术栈有Elasticsearch ，你说说你的Elasticsearch 做了哪些事，你为什么选择了Elasticsearch这个搜索引擎？你是怎么保证ES和Mysql的一致性的？</h2>
<h3 id="口语化答案">口语化答案</h3>
<ul>
<li>
<p>在 GQ Video 里，Elasticsearch主要干三件事：</p>
<ol>
<li>做“视频搜索”的索引库，存标题<code>videoName</code>、标签<code>tags</code>、封面、作者等元数据；</li>
<li>支持关键词高亮、相关性排序和多维排序（在相关性基础上叠加播放量/收藏量等热度字段）；</li>
<li>实时更新计数类字段（播放/弹幕/收藏），用脚本自增并带 upsert，保证字段不存在也不报错。</li>
</ol>
</li>
<li>
<p>搜索怎么用的：</p>
<ul>
<li>查询走 multi_match 命中标题+标签，打开 highlighter，让命中的词用<code>&lt;span class='highlight'&gt;</code>包起来，前端直接渲染即可；</li>
<li>排序先按相关性 <code>_score</code>，再按业务字段（比如播放量）做二次排序；</li>
<li>分页、统计这些都在 ES 里完成，接口只负责把 <code>videoId</code> 批量回表补全必要信息。</li>
</ul>
</li>
<li>
<p>和 MySQL 的关系：</p>
<ul>
<li>MySQL是主库，ES是“搜索副本”，我们走“最终一致”：新增/修改/删除异步同步到 ES；计数类通过消息/队列异步自增，失败有重试和兜底重刷。</li>
</ul>
</li>
<li>
<p>为什么选 Elasticsearch：</p>
<ul>
<li>全文检索体验好：倒排索引+相关性评分，模糊匹配、同义词、分词（IK）都很成熟；</li>
<li>性能与扩展性强：大数据量下的查询/分页稳定，分片副本易于横向扩展；</li>
<li>生态完善：高亮、聚合、脚本更新、排序、统计都开箱即用，开发成本低、可维护性好。</li>
</ul>
</li>
</ul>
<p>一句话：ES在项目里就是“高性能的搜索引擎 + 实时热度排序器”，把复杂的检索、高亮、排序交给它处理，MySQL只专注事务数据，二者异步同步，既快又稳。</p>
<h3 id="面试口语版回答示例-2">面试口语版回答示例</h3>
<p>如果你问我“你们的 Elasticsearch 在项目里干嘛、为什么用它、怎么保证跟 MySQL 一致”，我会这样说：</p>
<hr>
<h3 id="1）ES-在项目里具体做了什么？">1）ES 在项目里具体做了什么？</h3>
<p>在 GQ Video 里，其实我就是把 ES 当成一个专门给视频做<strong>搜索和热度排序</strong>的引擎，主要干了三件事：</p>
<p><strong>第一是建一个“视频搜索库”</strong></p>
<ul>
<li>服务启动的时候，我会先初始化好一个视频索引，把视频的基础信息都灌进去，比如 ID、标题、标签、封面、发布时间，还有一些统计类的字段。</li>
<li>标题这块用了中文分词，标签这块按照逗号拆开成多个关键词，这样用户搜标题、搜标签都能比较准确地命中。</li>
</ul>
<p><strong>第二是做搜索、高亮和多维排序</strong></p>
<ul>
<li>用户在前台搜的时候，我会同时在标题和标签里做全文检索，再把命中的关键字高亮出来，前端拿到结果直接展示就行。</li>
<li>排序上不是简单按时间排，而是先按相关度排一轮，再叠加播放量、收藏量、发布时间这些业务维度做二次排序，最后再做分页，把结果列表和分页信息一并返回。</li>
</ul>
<p>为了展示更完整，我还会根据搜索结果里涉及的作者 ID，批量回数据库把作者昵称补上，这样一条结果就能把视频和作者信息都带齐。</p>
<p><strong>第三是把各种统计数字实时同步到 ES</strong><br>
像播放次数、弹幕数、收藏数这些热度指标，在业务侧有变动时就顺手更新到 ES。</p>
<p>这块我封了一层通用的“计数自增”逻辑，加减多少都可以，内部会自动处理好“字段原来不存在”“默认为 0”这类情况，避免更新时报错。<br>
<strong>不管是走消息队列，还是走本地线程去消费播放事件，处理完数据库之后都会调一次这个更新方法</strong>，<strong>所以 ES 里的数据基本能跟着业务实时往前跑</strong>，搜索结果才能按最新的热度去排。</p>
<hr>
<h3 id="2）为什么选择-Elasticsearch？">2）为什么选择 Elasticsearch？</h3>
<p>这个项目的搜索需求，<strong>用 MySQL 的 <code>LIKE</code> 基本顶不住</strong>，所以我一开始就选了 ES，主要几个考虑：</p>
<ul>
<li><strong>全文检索体验好</strong>：<strong>ES 自带倒排索引 + 相关性打分，再配 IK 分词，能很好地解决标题模糊搜索、标签搜索这些需求，高亮也是开箱即用</strong>；</li>
<li><strong>多维排序和聚合方便</strong>：我们既要按相关性排，又要按播放量、收藏量、发布时间这些业务字段<strong>二次排序，在 ES 里就是加几个 <code>sort</code> 的事</strong>，比在 MySQL 里各种 order by + limit 要灵活很多；</li>
<li><strong>扩展性和性能</strong>：视频量上去之后，<strong>单机 MySQL 做复杂搜索容易拖垮主库</strong>，<strong>而 ES 天然支持分片、副本，后面要扩容可以直接水平扩展</strong>；</li>
</ul>
<p>一句话：<strong>MySQL 更适合作事务存储，ES 更适合复杂搜索和热度排序</strong>，两者各司其职。</p>
<hr>
<h3 id="3）怎么保证-ES-和-MySQL-的一致性？">3）怎么保证 ES 和 MySQL 的一致性？</h3>
<p>我们整体思路是：<strong>MySQL 是主，ES 是搜索副本，采用“最终一致性 + 事件驱动”的模式</strong>，大概分三类情况：</p>
<ul>
<li>
<p><strong>新增/审核通过时写入 ES</strong><br>
视频在 MySQL 里插入成功后，会通过服务层调用 <code>EsSearchComponent.saveDoc(videoInfo)</code>：</p>
<ul>
<li>如果文档不存在就新建，把 MySQL 里的视频实体 <code>VideoInfo</code> 映射成 <code>VideoInfoEsDto</code> 存进索引；</li>
<li>后续视频信息有变动（比如标题、标签），就走 <code>updateDoc(videoInfo)</code>，只更新非空字段。<br>
这部分是和业务写库同一条调用链上的，属于“写完主库后，马上异步同步 ES”。</li>
</ul>
</li>
<li>
<p><strong>删除视频时删除 ES 文档</strong><br>
在 <code>VideoInfoServiceImpl.deleteVideo</code> 里，删除 MySQL 主表之后，会直接调用 <code>esSearchComponent.delDoc(videoId)</code> 把对应文档删掉，同时还会异步清理分 P、弹幕、评论、封面和切片目录，确保 ES 里不会再搜出这条视频。</p>
</li>
<li>
<p><strong>计数量（播放/收藏/弹幕）的一致性</strong><br>
播放事件这条链路，是通过 RocketMQ 或 Redis 队列来驱动的：</p>
<ul>
<li>同一条 <code>VideoPlayEvent</code> 消息，消费端先更新 MySQL 里的计数（<code>videoInfoMapper.updateCountInfo</code>），然后再调 <code>esSearchComponent.updateDocCount</code> 更新 ES；</li>
<li>如果 ES 更新失败，会打出 error 日志，方便后面通过运维或者管理端接口（比如 <code>VideoInfoApi.updateDocCount</code> 或全量重建索引）做补偿；</li>
<li>这类统计对用户来说允许极短时间的“最终一致”，所以我们更关注“不丢消息 + 可重放/可修复”，而不是强一致。</li>
</ul>
</li>
</ul>
<p>整体可以这样总结给面试官：</p>
<blockquote>
<p>“我们把 MySQL 当成权威数据源，ES 当成只读的搜索副本。写入流程里会同步更新 ES，计数这类高频字段通过播放事件驱动去异步自增。出问题时有日志和接口可以重刷，保证的是‘最终一致 + 不丢数据’，而不是强事务级的一致性。”</p>
</blockquote>
<h3 id="更口语化的一致性回答（弱化类名-字段名）">更口语化的一致性回答（弱化类名/字段名）</h3>
<p>我们整体思路是：<strong>MySQL 是主，ES 是搜索副本，采用“最终一致性 + 事件驱动”的模式</strong>，大概分三类情况：</p>
<p><strong>第一种是新增和审核通过</strong></p>
<ul>
<li>一条视频先正常落到数据库里，写库成功之后，我会在同一条业务链路里，再顺手把这条视频的关键信息同步一份到 ES。</li>
<li>如果 ES 里还没有这条，就新建一条；有则更新。</li>
</ul>
<p><strong>第二种是删除视频</strong></p>
<ul>
<li>删视频时也是先删数据库里的那条记录，然后紧接着把搜索引擎里对应的那条文档也删掉。</li>
<li><strong>同时还会在后台异步把这个视频相关的分 P、弹幕、评论、封面图、切片目录这些都清理掉，确保无论是数据库还是搜索结果里，都不会再出现这条已经删掉的视频。</strong></li>
</ul>
<p><strong>第三种是各种计数：播放、收藏、弹幕这些</strong></p>
<ul>
<li>这类高频更新的数字，我们是通过“播放事件”来驱动的：同一条事件消息，消费的时候先把数据库里的计数 +1，再把搜索引擎里的热度字段也跟着 +1。</li>
<li>如果更新 ES 的那一步出错了，<strong>我这边会把异常打日志，后面可以通过后台接口或者运维脚本去做补偿，比如单条修正或者按天全量重刷。</strong></li>
<li><strong>对用户来说，这种统计允许有一点点延迟，也就是最终一致,所以我们更关注“消息别丢、出了问题能补得回来”。</strong></li>
</ul>
<p><strong>最后我一般会用一句话总结给面试官：</strong></p>
<blockquote>
<p>“我们把 MySQL 当权威数据源，ES 当搜索副本。新增、修改、删除都会顺带把 ES 更新一份，播放这类高频统计通过事件异步去驱动。偶尔有短暂不一致没关系，关键是消息不丢、有日志、有补偿手段，整体做到最终一致。”</p>
</blockquote>
<h2 id="Nacos相关">Nacos相关</h2>
<h3 id="可能被问到的方向-回答思路（结合你现在的项目）">可能被问到的方向 &amp; 回答思路（结合你现在的项目）</h3>
<p>下面这些都是“你那句 Nacos 注册发现与配置切换”很容易引出来的问题，你可以按点准备答案。</p>
<hr>
<ul>
<li><strong>1）你项目里具体怎么用 Nacos 做服务注册发现的？</strong>
<ul>
<li><strong>所有微服务启动后会自动把自己注册到 Nacos</strong>，服务名就是 <code>spring.application.name</code>（比如视频、互动、资源、Admin、网关）。</li>
<li><strong>彼此调用时通过服务名访问</strong>，<strong>而不是写死 IP/端口</strong>，比如网关路由 <code>lb://视频服务</code>、内部 Feign 调用 <code>service-id</code>。</li>
</ul>
</li>
<li><strong>2）配置中心这块，你在项目里是怎么用 Nacos 的？</strong>
<ul>
<li>把每个服务的环境配置放在 Nacos，数据库、Redis、RocketMQ、MinIO、mq.enabled、日志级别、上传大小等。</li>
<li>命名规则一般是“应用名 + 环境”，比如 <code>$&#123;spring.application.name&#125;-dev.yml</code>，让不同环境通过 namespace 或 profile 隔离。</li>
<li><strong>服务启动时从 Nacos 拉取配置，修改后可以在不重启的情况下动态生效</strong>（提一下 <code>@RefreshScope</code> 或 Spring Cloud Alibaba 的自动刷新机制即可）。</li>
</ul>
</li>
<li><strong>3）“配置切换”你实际做过哪些场景？（这是高频追问）</strong>
<ul>
<li><strong>MQ 开关</strong>：<code>mq.enabled</code> 放在 Nacos，<strong>线上可以动态控制是走 RocketMQ 还是回退到本地线程 + Redis 队列</strong>；</li>
<li><strong>存储切换</strong>：<strong>资源服务里通过配置调整是走本地磁盘还是 MinIO</strong>，对象存储的 endpoint、密钥等也在 Nacos 里统一管理；</li>
<li>运营参数：动态调整上传大小限制、日志级别、统计任务等，而不需要重新发布服务。</li>
</ul>
</li>
<li><strong>4）为什么选 Nacos，而不是 Eureka / Consul / 自己用 Git 做配置？</strong>
<ul>
<li><strong>和 Spring Cloud Alibaba 生态贴合</strong>，注册中心 + 配置中心一体，接入成本低；</li>
<li><strong>自带配置中心</strong>、<strong>实时推送</strong>、<strong>功能更全</strong>；</li>
</ul>
</li>
<li><strong>5）你们是怎么利用 Nacos 做“高可用/动态扩展”的？</strong>
<ul>
<li>多实例注册：<strong>同一个服务可以起多份实例，全部挂到 Nacos 底下</strong>，<strong>网关和其它服务通过服务名 + 负载均衡自动分发请求，实现水平扩展</strong>；</li>
<li>配置层面：<strong>通过 Nacos 调整连接池大小、线程池参数、MQ 开关等，在线做性能调优或限流降级</strong>；</li>
<li><strong>生产可以做 Nacos 集群 + 本地缓存，单点故障时客户端不会瞬间失效</strong>。</li>
</ul>
</li>
<li><strong>6）如果 Nacos 挂了或者配置发错了，你们怎么兜底？</strong>
<ul>
<li><strong>客户端会有本地缓存，短时间内 Nacos 不可用不会立刻影响服务</strong>；</li>
<li><strong>关键配置可以在本地也留一份默认值，启动时如果拉不到远程配置，先用默认值起服务</strong>；</li>
</ul>
</li>
</ul>
<h2 id="GateWay相关">GateWay相关</h2>
<h3 id="可以被问到的几个典型方向（含答题思路）">可以被问到的几个典型方向（含答题思路）</h3>
<p>下面这些都是围绕你那句「Gateway + Redis 分布式鉴权 / 会话共享 / 统一异常」<strong>最容易被问到的问题方向</strong>，你可以按点提前准备：</p>
<hr>
<ul>
<li><strong>1）整体鉴权/会话流程：登录之后，一次请求从网关到后端完整怎么走？</strong><br>
按顺序讲：
<ul>
<li>用户登录成功 → 后端生成 token，写到 Redis 里（携带用户信息和过期时间），并下发给前端（Cookie）。</li>
<li>前端之后所有请求都带这个 token，到达网关时：
<ul>
<li>对管理端 <code>/admin/**</code> 路由走 <code>AdminFilter</code>，优先放行登录相关路径，其它路径会从Cookie 里取管理员 token，没带就直接在网关抛“未登录”的业务异常。</li>
<li>所有请求先过全局 <code>GatewayGlobalRequestFilter</code>，把带内部前缀的 URL 统一拦截掉，防止外部直接打内部接口。</li>
</ul>
</li>
<li>通过网关后，到各个微服务里再用 拦截器从 Header 取 token，到 Redis 里查用户信息做二次校验，实现真正的“分布式鉴权 + 会话共享”。</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><strong>2）为什么要在网关层做一层鉴权，微服务里又做一层？各自负责什么？</strong>
<ul>
<li>网关层：做的是**“入口级”的粗粒度控制**，比如：<strong>非登录接口必须带管理员 token、屏蔽内部接口、简单日志</strong>等，一旦不满足条件就直接在网关返回统一错误，<strong>减少无效请求打到后端</strong>。</li>
<li>各微服务内：做的是**“业务级”的细粒度控制**，比如判断用户是否登录、<strong>角色/权限校验、是否有操作当前资源的权限</strong>等。</li>
<li>这样设计的好处是：<strong>公共规则集中在网关，业务规则保留在各服务，既不重复写一堆 if，又不会把所有业务细节都塞到网关里</strong>。</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><strong>3）你说的“Redis 实现分布式会话共享”具体指什么？多实例下是怎么共享的？</strong>
<ul>
<li><strong>所有登录态（无论前台用户还是后台管理员）的 token 和用户信息都统一存在 Redis，设置统一过期时间和续期策略</strong>。</li>
<li><strong>无论请求被网关转发到哪一台实例、哪个微服务，只要拿到 token，去 Redis 查到同一份用户信息即可，所以 session 不再绑 JVM，而是</strong>跨实例共享。</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><strong>4）网关 + Nacos + Redis 之间是怎么配合的？</strong>
<ul>
<li>服务注册发现走 Nacos：Gateway 只认“服务名 + 路由规则”，不关心具体 IP/端口，扩/缩容时实例变化由 Nacos 同步。</li>
<li>鉴权和会话共享走 Redis：无论请求哪里落，鉴权时都是按统一 key 从 Redis 里查用户信息。</li>
<li>配置（比如哪些路径需要 AdminFilter、日志级别、token 头名等）可以放到 Nacos 的 <code>easylive-cloud-gateway-dev.yml</code>，动态生效。</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><strong>5）统一网关层异常处理怎么做的？和各服务自己的异常处理有什么区别？</strong>
<ul>
<li>网关这边实现了一个全局的 <code>WebExceptionHandler</code>，<strong>所有经过 Gateway 的异常（包含过滤器里抛的业务异常、路由不到下游的 404/503 等）都会在这里兜底。</strong></li>
<li>在这个 Handler 里，<strong>把异常统一转换成一个标准的响应结构</strong>：固定字段（code、msg、status），404 / 503 / 业务异常 / 未知异常分别映射成约定的错误码和提示。</li>
<li><strong>各微服务内部也有自己的全局异常处理，但那是用户已经“穿过网关”之后的事；网关这一层更多是帮前端屏蔽“下游服务不可用 / 路由错误 / 未登录”等入口级问题</strong>。</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><strong>6）你是怎么隔离“内部接口”和对外接口的？为什么要在网关做？</strong>
<ul>
<li>所有给内部调用的接口（比如服务间 RPC）统一加了一个内部前缀，正常情况下只应该在内网被调用。</li>
<li><code>GatewayGlobalRequestFilter</code> <strong>会先判断 URL 是否包含这个前缀，如果是就直接在网关返回 404 或业务错误码，外部用户永远访问不到内部 API</strong>。</li>
<li>这么做的好处是：<strong>即便某个服务的内部控制写漏了，只要走网关的流量，都会被这层“白名单/黑名单式”的路径规则挡住</strong>。</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><strong>7）如果 Redis 挂了或者延迟很高，你们的鉴权/会话会有什么影响，有没有兜底方案？</strong>
<ul>
<li><strong>短时间 Redis 不可用时，系统返回“系统繁忙，请稍后重试”</strong>；</li>
</ul>
</li>
</ul>
<hr>
<h2 id="Seata相关">Seata相关</h2>
<h3 id="一、面试官可能问的方向（带思路）">一、面试官可能问的方向（带思路）</h3>
<ul>
<li>
<p><strong>1）你为什么要引入 Seata，单用 <code>@Transactional</code> 不够吗？</strong></p>
<ul>
<li>场景：<strong>评论发布时既要写评论库，又要更新视频服务里的评论数，这两个库在不同微服务里，传统 <code>@Transactional</code> 只能管住当前服务的本地库</strong>。</li>
<li>之所以需要引出 Seata：是为了让“评论写入 + 远程更新计数 + 其它跨服务操作”<strong>要么都成功，要么都回滚，所以用全局事务把多服务的本地事务包在一起</strong>。</li>
</ul>
</li>
<li>
<p><strong>2）你是在哪些具体业务里用了 <code>@GlobalTransactional</code>？</strong></p>
<ul>
<li>
<p>评论发布：插入评论 → 远程调用视频服务增加评论数，如果任何一步抛异常，全局回滚；</p>
</li>
<li>
<p>级联删除：删除视频时，视频服务删主表和资源，互动服务删评论/弹幕等，中途有一步失败就全部撤销；</p>
</li>
<li>
<p>复杂互动计数：比如同时更新用户互动统计、视频统计等多张表且跨服务时。</p>
</li>
<li>
<p>“<strong>跨服务、多库、必须保证强一致</strong>”的特点。</p>
</li>
</ul>
</li>
<li>
<p><strong>3）给我讲讲 <code>@GlobalTransactional</code> 的工作原理，大概怎么运作？</strong></p>
<ul>
<li>先说概念：
<ul>
<li><strong>标注在入口方法上时，Seata 会为这次请求创建一个全局事务 ID</strong>；</li>
<li>参与的每个微服务在自己的本地事务里都会带上这个 ID，向 Seata 注册成为“分支事务”；</li>
</ul>
</li>
<li>然后说流程：
<ul>
<li><strong>所有本地事务都成功提交后，Seata 的全局事务协调器才会把全局事务标记为成功；</strong></li>
<li><strong>只要有一个分支失败，协调器就会让已经成功的分支全部回滚，保证整体一致。</strong></li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>4）使用 Seata 之后，你是怎么写代码的？入口在哪？</strong></p>
<ul>
<li>入口：一般放在“业务链路的最上游服务”的方法上，比如评论发布的接口实现。</li>
<li>写法：把原本的 <code>@Transactional(rollbackFor = Exception.class)</code> 换成 <code>@GlobalTransactional(rollbackFor = Exception.class)</code>，里面照常调用本地 Mapper、远程 Feign 接口。</li>
<li>要点：
<ul>
<li>入口方法本身不要再开新的本地事务嵌套；</li>
<li>远程调用的下游服务自己的本地操作依然用 <code>@Transactional</code> 保证单服务内的一致性。</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>5）你是怎么区分“该不该用 Seata”的？有没有滥用的风险？</strong></p>
<ul>
<li>适合用的：
<ul>
<li><strong>跨多个服务/多个库，且必须强一致的场景</strong>，比如资金、积分、评论数这类对用户强感知的核心数据；</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>6）Seata 带来的问题/成本你有考虑过吗？</strong></p>
<ul>
<li><strong>性能开销</strong>：所有参与服务都要跟协调器交互，全局事务越多，对 TPS 的影响越大。</li>
<li>网络依赖：协调器或网络抖动时，容易放大成一条链路上的超时或回滚。</li>
<li><strong>运维复杂度</strong>：要多维护一个 Seata 集群和对应的事务表。
<ul>
<li>对高频简单操作（例如纯统计）我会优先用 MQ + 本地事务，而不是动不动就上全局事务。</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>7）Seata 出现部分失败或网络问题时，你们怎么排查？</strong></p>
<ul>
<li>排查：
<ul>
<li><strong>查 Seata 的全局事务表，看哪些全局事务在重试 / 回滚中</strong>；</li>
<li><strong>结合业务日志定位是哪个分支服务报错</strong>。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="代码生成器">代码生成器</h2>
<h3 id="可以被问到的典型方向（结合你这套代码生成器）">可以被问到的典型方向（结合你这套代码生成器）</h3>
<hr>
<ul>
<li><strong>1）你这个代码生成器是解决什么痛点？为什么要自己做？</strong>
<ul>
<li>老实说：项目里每加一张表，都要手写 PO、Query、Mapper、XML、Service、Controller、分页、统一返回这些重复代码，很费时间也容易写错。</li>
<li><strong>生成器做的事：从数据库表结构（字段、类型、注释、索引）出发，一键生成从实体、查询对象、Mapper/XML 到 Service、Controller 的“标准骨架”，包括分页、统一响应、全局异常等。</strong></li>
<li><strong>自己做而不是直接用别人的</strong>（比如 MyBatis-Plus 生成器），主要是因为该项目有一套固定规范：BaseMapper、BaseParam/SimplePage、ResponseVO、PageSize 等通用抽象，<strong>现成工具难以完全贴合，所以干脆做了一个“贴合本项目规范”的生成器</strong>。</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>
<p><strong>2）它具体都能生成哪些东西？从哪一步到哪一步是自动化的？</strong></p>
<ul>
<li>根据 <code>user_info</code> 这种表，自动生成：
<ul>
<li>PO 实体（UserInfo）——字段、注释、时间格式注解等；</li>
<li>Query（UserInfoQuery）——精确/模糊字段、时间区间、分页和排序；</li>
<li>Mapper 接口 + XML——通用 CRUD、批量、按业务键查询、UPSERT、动态条件；</li>
<li>Service/ServiceImpl——分页编排、批量空集短路、危险操作前置校验；</li>
<li>Controller——分页查询、新增/批量/按业务键增删改查，并统一用 ResponseVO 返回。</li>
</ul>
</li>
</ul>
<p><strong>表一建好，点一下生成，就有一条从 Controller 到 DAO 的“最小闭环”，只剩下少量业务逻辑需要手写</strong>。</p>
</li>
</ul>
<hr>
<ul>
<li><strong>3）你生成器的核心设计思路是什么？（比如模板、抽象等）</strong>
<ul>
<li>大体是“<strong>元数据 + 模板</strong>”：
<ul>
<li><strong>从数据库拿到表字段、注释、主键、唯一索引这些元数据</strong>；</li>
<li><strong>把通用能力抽象成 Base 类/通用枚举</strong>：<code>BaseMapper</code>、<code>BaseParam/SimplePage</code>、<code>ResponseVO/PaginationResultVO</code>、<code>PageSize</code>、<code>BusinessException</code> 等；</li>
<li><strong>再用模板按照统一规范拼出各层代码。</strong></li>
</ul>
</li>
<li>这样新表出来之后，只需要在模板层改一次，就能让所有新生成的代码同步更新风格和规范。</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><strong>4）它相比“手写 + 复制粘贴”或者 MyBatis-Plus 这类生成器，有什么亮点？</strong>
<ul>
<li>相比通用生成器，你可以说：<strong>它不仅是“生成代码”，更是“生成符合团队规范、带安全检查的骨架”</strong>。</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><strong>5）生成后的代码如何二次开发？会不会不方便维护？</strong>
<ul>
<li><strong>生成的只是“基础骨架”</strong>，比如 UserInfoController 里的基础 CRUD、分页、Query 条件等；</li>
<li><strong>真正的业务逻辑（比如注册校验、密码加密、积分发放）都是在 ServiceImpl 或额外的方法里手写</strong>，生成器不会反复覆盖；</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><strong>7）有没有遇到什么坑？</strong>
<ul>
<li>顺带说一句：<strong>生成器本身也要当成一个“产品”来维护</strong>，版本升级、模板兼容都是后面慢慢打磨出来的。</li>
</ul>
</li>
</ul>
<h2 id="你做项目遇到了什么难点？你是怎么解决的？">你做项目遇到了什么难点？你是怎么解决的？</h2>
<p>是的，我做这个项目时遇到过几个问题</p>
<h3 id="1-验证码被覆盖的一个问题">1.验证码被覆盖的一个问题</h3>
<h4 id="一开始我们做验证码很简单：">一开始我们做验证码很简单：</h4>
<ul>
<li>
<p>后端生成一张算术验证码图片，结果直接丢到 Redis 里，用的是固定的 key，比如就叫 checkCode。</p>
</li>
<li>
<p>单人用的时候没问题，但一到高并发，就会出现这样的情况：A 用户刚拿到验证码，B 用户一刷新页面，Redis 里的值就被 B 覆盖了。</p>
</li>
<li>
<p>结果就是 A 输入的其实是旧验证码，后端拿到的是真实值已经变成 B 的那一份，导致校验老是不通过。</p>
</li>
</ul>
<h4 id="2-我的改造思路">2. 我的改造思路</h4>
<p>我后来把这个问题拆成两块：<strong>“验证码内容”和“验证码引用”分开存</strong>。</p>
<p>大概是这样做的：</p>
<ol>
<li>用户点开注册/登录时，我生成一张算术验证码图片，把图片转成 base64 返回给前端；</li>
<li>同时我在后端随机生成一个 <strong>唯一的 key</strong>，<strong>可以理解成验证码 ID，用 UUID 就行</strong>；</li>
<li><strong>Redis 里不再用一个公共 key</strong>，<strong>而是用：<code>前缀 + 验证码ID</code> 去保存真实验证码值，并设置 10 分钟过期</strong>；</li>
<li>前端这时候拿到的是两样东西：
<ul>
<li><strong>一张图片（base64）用来展示给用户看</strong>；</li>
<li><strong>一个验证码 ID（checkCodeKey），用户提交表单时把这个 ID 和自己输入的结果一起带回来；</strong></li>
</ul>
</li>
<li>校验的时候，后端根据验证码 ID 从 Redis 里取真实值，对一下是否一致；</li>
<li>不管对没对上，<strong>校验完立刻删掉这个 key</strong>，做到“一次一用，不能复用”。</li>
</ol>
<p>这样一改，<strong>每个请求都有自己的验证码 key</strong>，互相之间完全隔离，自然也就不存在“别人刷新把我的验证码顶掉”的问题了。</p>
<hr>
<h3 id="2：大文件分片上传-转码耗时长，接口容易超时">2：大文件分片上传 + 转码耗时长，接口容易超时</h3>
<p><strong>问题：</strong><br>
视频是分片上传的，用户网络环境又不稳定。最开始如果在上传接口里<strong>直接合并分片、调用 FFmpeg 转码、生成切片</strong>，会出现：</p>
<ul>
<li>接口执行时间特别长，浏览器经常超时；</li>
<li>一旦中途失败，很难知道哪一步出了问题，也没法优雅地重试。</li>
</ul>
<p><strong>我的做法：</strong></p>
<ul>
<li>
<p><strong>上传阶段</strong></p>
<ul>
<li>每个上传任务在后端生成一个 uploadId，把分片个数、文件名、临时路径等信息存在 Redis 里；</li>
<li>分片只负责往临时目录写文件块，并更新 Redis 里的进度，整个过程都非常轻量。</li>
</ul>
</li>
<li>
<p><strong>转码阶段异步化</strong></p>
<ul>
<li>当所有分片传完后，不再在请求里做转码，而是<strong>往队列里塞一个“转码任务”</strong>（Redis 队列 or RocketMQ）；</li>
<li>资源服务里有专门的消费任务/消费者，后台慢慢干：
<ul>
<li>从临时目录拷贝 + 合并分片；</li>
<li>调 FFmpeg 生成完整视频、切 HLS 切片、算时长；</li>
<li>成功之后再回调视频服务更新数据库状态。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>效果：</strong></p>
<ul>
<li>用户请求只负责“上传分片 + 提交任务”，响应时间从几十秒降到几百毫秒；</li>
<li>转码失败时日志清晰可查，而且是后台任务，可以单独重试或重新投递，不影响用户主流程。</li>
</ul>
<hr>
<h3 id="案例-3：评论发布和评论数不一致（跨服务事务）">案例 3：评论发布和评论数不一致（跨服务事务）</h3>
<p><strong>问题：</strong><br>
评论发布这一条链路会同时操作<strong>评论服务的数据库</strong>和<strong>视频服务的评论计数</strong>：</p>
<ul>
<li>评论表插入一条记录；</li>
<li>远程调用视频服务，把该视频的评论数 +1。</li>
</ul>
<p>如果中间任何一步失败，就会产生“<strong>列表里有评论，但计数没加上</strong>”或者反过来的情况。</p>
<p><strong>我的做法：</strong></p>
<ul>
<li>对这类强一致的链路，引入了 Seata，把入口方法从 <code>@Transactional</code> 改成 <code>@GlobalTransactional</code>；</li>
<li>评论服务这边插入评论作为一个本地分支事务；</li>
<li>远程调用视频服务更新评论数，那边自己的本地事务也加入同一个全局事务；</li>
<li>只要有任何一步抛异常，Seata 会通知所有已经成功的分支一起回滚，保证“要么都成功，要么都失败”。</li>
</ul>
<p><strong>效果：</strong></p>
<ul>
<li>解决了“评论内容和计数对不上”的问题；</li>
<li>也让这类跨服务的操作写法尽量贴近单体事务，对业务开发来说心智负担小很多。</li>
</ul>
<hr>
<h3 id="4-：播放统计从“线程池-Redis-列表”迁到-RocketMQ">4.：播放统计从“线程池 + Redis 列表”迁到 RocketMQ</h3>
<p><strong>问题：</strong><br>
最开始播放统计是用“Redis 队列 + 后台线程 while(true) 消费”的方式做的：</p>
<ul>
<li>高峰期时，线程池容易打满，队列一堆积就很难监控；</li>
<li>失败重试、死信都要自己写，服务一挂掉，现场很难排查。</li>
</ul>
<p><strong>我的做法：</strong></p>
<ul>
<li>把播放埋点、转码任务这些都迁到 RocketMQ：
<ul>
<li>入口服务只负责<strong>发消息</strong>，把播放事件/转码任务丢到对应 Topic；</li>
<li>消费端专门处理：更新播放数、写播放历史、更新 ES 热度字段、触发转码等。</li>
</ul>
</li>
<li>支持按配置开关：<code>mq.enabled=true</code> 走 MQ，关掉时自动退回到 Redis 队列方案，方便灰度和回滚。</li>
</ul>
<p><strong>效果：</strong></p>
<ul>
<li>主接口明显变快，只做“发消息”；</li>
<li>消息的堆积量、重试、死信都能在 MQ 控制台看到，运维和排障成本比之前的线程池高循环好太多。</li>
</ul>
<h2 id="简单讲讲这个项目的注册功能？">简单讲讲这个项目的注册功能？</h2>
<h3 id="口语化讲注册流程（面试版）">口语化讲注册流程（面试版）</h3>
<p>这个项目的注册流程其实不复杂，可以分三步说：校验、建用户、落库。</p>
<ul>
<li>
<p><strong>第一步是前端+验证码这块</strong><br>
用户在前端填邮箱、昵称、密码，先看一张算术验证码图片。<br>
我这边会把验证码对应的一个 <code>checkCodeKey</code> 一起给前端，等用户点“注册”的时候，把<strong>用户输入的验证码 + 这个 key</strong> 一起带回来。</p>
</li>
<li>
<p><strong>第二步是后端校验</strong><br>
后端拿到请求后，先用 <code>checkCodeKey</code> 去 Redis 查真实验证码，校验完<strong>不管对不对都直接删掉这个 key</strong>，保证验证码一次一用。<br>
验证码通过之后，再去库里查一遍邮箱和昵称，有重复就抛业务异常，前端直接提示“邮箱已注册/昵称已占用”。</p>
</li>
<li>
<p><strong>第三步是创建用户并落库</strong><br>
校验都通过后，我会生成一个 10 位的用户 ID，把密码做一次 MD5（只存加密后的值），同时给一套默认属性：状态、性别、主题、注册时间，还有初始硬币（当前和累计各 10）。<br>
最后调用 Mapper 插入数据库，成功后只返回一个“注册成功”的结果，前端会跳回登录页而不是直接给用户登录。</p>
</li>
<li>
<p><strong>顺带会提一下做的防护点</strong></p>
<ul>
<li>并发重复注册这块，一方面代码查重，另一方面数据库上有邮箱、昵称唯一索引兜底；</li>
<li>验证码是<strong>每次生成一个独立 key 放 Redis</strong>，设置过期时间和一次性校验，不会出现别的用户刷新把你的验证码覆盖掉；</li>
<li>安全上会对同 IP / 同邮箱做注册频控，密码永远只存加密后的摘要，不存明文。</li>
</ul>
</li>
</ul>
<h2 id="简单讲讲这个项目的登录以及自动登录、退出你是怎么实现的？">简单讲讲这个项目的登录以及自动登录、退出你是怎么实现的？</h2>
<h3 id="口语化讲登录-自动登录-退出（面试版）">口语化讲登录 / 自动登录 / 退出（面试版）</h3>
<p><strong>1）登录是怎么做的？</strong></p>
<ul>
<li>前端这边就是把<strong>邮箱、密码、验证码</strong>一起丢给后端，同时带上验证码的 <code>checkCodeKey</code>。</li>
<li>后端先用这个 key 去 Redis 里把真实验证码拿出来，对完之后<strong>不管成不成功都直接删掉</strong>，验证码只用一次。</li>
<li>接着校验账号：
<ul>
<li>查一下这个邮箱有没有用户；</li>
<li>把输入的密码做 MD5 后跟数据库里的摘要比一比；</li>
<li>再看一下账号状态是不是正常；</li>
<li>顺便更新一下最后登录时间、登录 IP。</li>
</ul>
</li>
<li>都通过以后，我会生成一个 UUID 当作 <strong>token</strong>，把「用户信息 + 过期时间（比如 7 天）」塞到 Redis 里，key 大概就是 <code>token:&#123;token&#125;</code> 这种。</li>
<li>最后把这个 token 写到 Cookie 里返回给前端（有效期也是 7 天），如果之前已经有旧的 token，就顺手把 Redis 里旧的登录态删掉，避免一个账号在同端出现多个 token。</li>
</ul>
<hr>
<p><strong>2）自动登录是怎么做的？</strong></p>
<ul>
<li>自动登录其实就是<strong>拿着 token 来要用户信息</strong>：
<ul>
<li>前端每次刷新页面或打开站点，会把 Cookie 里的 token 带上，调用一个“自动登录”接口；</li>
<li>后端拿 token 去 Redis 里找，如果能找到用户信息，说明登录态还有效，直接返回给前端；</li>
<li>如果发现这个 token 马上要过期了（比如剩不到一天），我会顺便帮它<strong>续一下命</strong>：把 Redis 里的过期时间往后推一推，再重新写一遍 Cookie，这样用户几乎感受不到过期。</li>
</ul>
</li>
</ul>
<hr>
<p><strong>3）退出登录怎么做？</strong></p>
<ul>
<li>退出就很简单了：
<ul>
<li>从 Cookie 里把 token 读出来；</li>
<li>把 Redis 中这个 token 对应的登录态删掉；</li>
<li>同时把浏览器里的 Cookie 设置成立刻过期，相当于把本地的“钥匙”也扔掉。</li>
</ul>
</li>
</ul>
<hr>
<p><strong>4）一两句话总结</strong></p>
<p>整个登录体系可以总结成一句话：</p>
<blockquote>
<p>用 Redis 存登录态，用 Cookie 带 token —— 登录的时候写入，自动登录的时候续期，退出的时候一起清理；验证码同样用 Redis + 独立 key 做成一次一用，避免多人并发时互相覆盖。</p>
</blockquote>
<h2 id="简单讲讲这个项目的分类功能是怎么实现的，一级分类和二级分类是如何实现的？">简单讲讲这个项目的分类功能是怎么实现的，一级分类和二级分类是如何实现的？</h2>
<p>我这块是用一张分类表 + 父子关系，把一级、二级都放在一起管理的。</p>
<p>数据结构</p>
<ul>
<li>表里有 category_id、p_category_id、编码、名称、图标、背景图、排序号这些字段。</li>
<li>约定很简单：父级 ID 为 0 的就是一级分类，父级 ID 指向某个一级分类的，就是它下面的二级分类。</li>
</ul>
<p>新增/修改</p>
<p>删除</p>
<ul>
<li>支持“级联删除”：传入一个 <code>categoryId</code>，同时把该分类以及它的直接子分类一并删掉（SQL 用 <code>category_id = ? OR p_category_id = ?</code>）。</li>
</ul>
<p>排序</p>
<ul>
<li>提供一个批量排序接口，前端把拖拽后的 ID 顺序传上来（如 <code>&quot;3,5,4&quot;</code>），后端按顺序重写同父级下的 <code>sort</code> 值。</li>
</ul>
<p>查询与树形</p>
<ul>
<li>查询时按 <code>sort asc</code> 取出线性列表；如果入参标记 <code>convert2Tree=true</code>，后端把线性数据按 <code>p_category_id</code> 组装成树（给每个节点挂 <code>children</code>），前端直接渲染成“一级-二级”的层级结构。</li>
</ul>
<p>缓存</p>
<ul>
<li>分类变更后会刷新 Redis 缓存，把“排好序的树形列表”整体存到 <code>category:list:</code>；客户端读取时优先走缓存，未命中再回源并回填缓存。</li>
</ul>
<p>一句话：用 <code>p_category_id</code> 建父子关系（0 表示一级），唯一校验+排序号维护新增/修改，删除支持带子类，查询可直接返回树形并缓存到 Redis，前端据此渲染一级/二级分类。</p>
<h3 id="口语版：怎么实现分类、一级二级怎么区分">口语版：怎么实现分类、一级二级怎么区分</h3>
<p>我这块是用一张分类表 + 父子关系，把一级、二级都放在一起管理的。</p>
<p><strong>先说数据结构</strong><br>
表里有 <code>category_id</code>、<code>p_category_id</code>、编码、名称、图标、背景图、排序号这些字段。<br>
约定很简单：<strong>父级 ID 为 0 的就是一级分类，父级 ID 指向某个一级分类的，就是它下面的二级分类</strong>。</p>
<p><strong>新增 / 修改怎么做</strong></p>
<ul>
<li>新增或修改前，会先按“分类id”做一次唯一校验，避免同一个id被重复使用。</li>
<li>新增的时候，会在同一个父级下面查一遍当前最大的排序号，然后把新分类的排序号设成 <code>max + 1</code>，这样前端拖拽完再调一次“批量排序”接口就能重排；修改的话就按主键更新就行。</li>
</ul>
<p><strong>删除怎么做</strong><br>
<strong>支持简单的级联</strong>：传进来一个分类 ID，我这边会把<strong>这个分类以及它名下的一层子分类</strong>一起删掉，SQL 上就是 <code>category_id = ? OR p_category_id = ?</code> 这种写法。</p>
<p><strong>查询和树形结构</strong><br>
查的时候先按 <code>sort</code> 升序把所有分类拉成一个扁平列表。<br>
如果入参要求返回“树形”，后端就会先挑出所有一级分类，再把对应的二级挂到它的 <code>children</code> 下面，前端拿到就是一个现成的“一级 → 二级”的树。</p>
<p><strong>缓存这块</strong><br>
<strong>分类其实不怎么变，所以我会把排好序的树形结果直接丢到 Redis 里，比如一个统一的 key。<br>
读的时候优先走缓存，没命中再查数据库并回填；有新增、修改、删除的时候顺手把这份缓存刷新掉。</strong></p>
<p>你要我一句话概括的话，就是：</p>
<blockquote>
<p>用 <code>p_category_id</code> 做父子关系（0 表示一级），配合排序号和级联删除，把新增/修改/排序都集中在一张表里处理，查询时组装成树形并缓存到 Redis，前端就可以直接渲染一级、二级分类了。</p>
</blockquote>
<h2 id="简单讲讲这个项目的文件上传功能是怎么实现的">简单讲讲这个项目的文件上传功能是怎么实现的</h2>
<ul>
<li>
<p>预上传建档</p>
<ul>
<li>前端先调“预上传”，把文件名和分片数发过来。</li>
<li>服务端生成一个 uploadId，顺带在磁盘建临时目录，在 Redis 里记录会话状态（分片总数、当前进度、临时路径、TTL），返回 uploadId。</li>
</ul>
</li>
<li>
<p>分片上传</p>
<ul>
<li>前端按顺序带着 uploadId + chunkIndex + 分片文件逐片上传。</li>
<li>后端校验：会话是否存在、是否跳片、大小是否超限；然后把分片落到“临时目录/chunkIndex”这个文件里。</li>
<li>每传一片就把进度与累计字节数写回 Redis，并续期，支持断点续传与重传当前片（覆盖写）。</li>
</ul>
</li>
<li>
<p>合并与后续处理</p>
<ul>
<li>所有分片到齐后（前端或服务端触发“合并”），把临时分片顺序拼成完整视频文件。</li>
<li>触发后续流程：转码/切片/上传对象存储（或本地），回写数据库状态与文件路径；这一步我们支持走 MQ（RocketMQ）异步处理，峰值更稳，也可开关回退到线程池+Redis 队列。</li>
</ul>
</li>
<li>
<p>安全与体验</p>
<ul>
<li>上传限额、单文件大小、分片并发数都可配置；路径做了合法性校验。</li>
<li>返回的是相对路径，前端用统一的“读文件”接口访问；封面图可选生成 200px 缩略图加速展示。</li>
</ul>
</li>
</ul>
<p>一句话：用“预上传建档（Redis 会话）+ 顺序分片上传（断点续传）+ 合并 + 异步转码/入库”的流程，既稳又能抗大文件与高并发。</p>
<h3 id="口语版：这个项目的文件上传是怎么做的">口语版：这个项目的文件上传是怎么做的</h3>
<p>我这块是按“<strong>预上传建档 → 分片上传 → 合并 → 异步转码</strong>”这一整条流水线来设计的。</p>
<ul>
<li><strong>第一步：预上传建档</strong><br>
用户刚选完文件，先调一个“预上传”接口，把文件名、分片数这些基本信息丢给后端。<br>
后端做三件事：<br>
1）生成一个唯一的 <code>uploadId</code>；<br>
2）在磁盘上建一个对应的临时目录；<br>
3）在 Redis 里存一份“上传会话”，里面有分片总数、已上传到第几片、临时路径、过期时间等。<br>
然后把 <code>uploadId</code> 返回给前端，后续所有分片都围绕这个 <code>uploadId</code> 走。</li>
<li><strong>第二步：分片上传（支持断点续传）</strong><br>
前端拿着 <code>uploadId</code>，按分片一片一片地传，每片都会带上当前的 <code>chunkIndex</code> 和分片内容。<br>
后端收到之后，会先检查：
<ul>
<li>这个 <code>uploadId</code> 对应的会话在不在（有没有过期）；</li>
<li>分片顺序对不对，有没有乱序/跳片；</li>
<li>尺寸有没有超限。<br>
校验通过，就把这一片写临时目录里。<br>
<strong>每传完一片，会把当前进度和累计大小更新回 Redis，并顺手续一下期，这样用户断网或者页面刷新了，再重新连上还能从上次的进度往下传</strong>。</li>
</ul>
</li>
<li><strong>第三步：合并 + 后续处理</strong><br>
当所有分片都传完之后，后端会按顺序把这些小文件拼成一个完整的视频文件。<br>
接着就进入：
<ul>
<li>做一次转码 + 切片（FFmpeg）；</li>
<li>上传到对象存储minio中（或者保存在本地）；</li>
<li>更新数据库里这条视频的状态和真URL路径。</li>
<li>这几步我没放在上传接口里堵着，而是丢到后台异步去跑：</li>
<li>正常是走 RocketMQ，把“转码任务”发到 MQ 里，由资源服务的消费者慢慢处理；</li>
<li>如果 MQ 关掉了，还可以退回到“线程池 + Redis 队列”的模式，相当于内置了一套兜底降级方案。</li>
</ul>
</li>
</ul>
<p><strong>一句话总结</strong>：</p>
<blockquote>
<p>我是用“预上传建档（Redis 维护会话）+ 分片断点续传 + 服务端合并 + 异步转码入库”这一条链路来做文件上传的，既能扛大文件、高并发，又不会把接口堵死。</p>
</blockquote>
<h2 id="面试官问：简单讲讲这个项目的审核功能是怎么实现的">面试官问：简单讲讲这个项目的审核功能是怎么实现的</h2>
<h3 id="口语版：这个项目的审核是怎么做的">口语版：这个项目的审核是怎么做的</h3>
<ul>
<li>
<p><strong>1）审核入口</strong><br>
审核接口，传三个参数：视频 ID、审核结果（通过还是驳回）、驳回原因。</p>
</li>
<li>
<p><strong>2）关键校验？</strong></p>
<ul>
<li>第一步我会校验状态，只允许把“待审核”的视频改成“通过”或者“驳回”，其他状态一律不让动。</li>
<li>第二步用了一点类似乐观锁的思路：更新的时候带上条件 <code>where video_id=? and status=待审核</code>，<br>
这样两个人同时点审核，<strong>只有第一个人能更新成功</strong>，第二个人发现状态已经不是待审核了，就认为审核已经被别人处理过了，避免多次覆盖。</li>
</ul>
</li>
<li>
<p><strong>3）如果审核通过，要做哪些事？</strong></p>
<ul>
<li><strong>先把投稿表里的最新数据“拷贝”到线上正式表</strong>，</li>
<li><strong>再把这次投稿对应的文件清单也同步过去</strong>：先删掉线上旧的文件记录，再把新的整批插进去；</li>
<li><strong>清理这次审核过程中积累的“待删除文件队列”</strong>，<strong>避免临时或历史文件遗留在磁盘/对象存储里</strong>；</li>
<li><strong>最后再做一些后置动作</strong>，比如写入 ES 索引、刷新缓存、给作者发一条站内消息告诉他“视频已审核通过”。</li>
</ul>
</li>
<li>
<p><strong>4）如果审核驳回呢？</strong></p>
<ul>
<li><strong>只在投稿表里把状态改成“驳回”，顺便把驳回原因写进去</strong>；</li>
<li>不会动线上正式表，也不会把文件清单同步上线，相当于这次投稿没通过审核。</li>
</ul>
</li>
<li>
<p><strong>5）事务和幂等怎么保证？</strong></p>
<ul>
<li>整个审核方法是<strong>包在一个事务里</strong>的，过程中只要有一步失败，前面做的拷贝/同步都会一起回滚，保证状态一致；</li>
<li>再加上前面说的“where status=待审核”这个条件，其实就实现了<strong>只审核一次</strong>的效果，多点几次也是同一条记录，不会出现反复覆盖。</li>
</ul>
</li>
</ul>
<p><strong>一句话总结一下</strong>：</p>
<blockquote>
<p>审核就是一次“带乐观锁的状态流转”：只允许从待审核流转到通过或驳回；通过就把投稿数据和文件清单同步到线上并做后续处理，驳回只更新投稿状态和原因，全流程用事务和条件更新来保证只被审核一次、数据是干净一致的。</p>
</blockquote>
<h2 id="简单讲讲这个项目的弹幕功能是怎么实现的">简单讲讲这个项目的弹幕功能是怎么实现的</h2>
<h3 id="口语版：这个项目的弹幕是怎么做的">口语版：这个项目的弹幕是怎么做的</h3>
<p>我这块是用一张表 + 简单接口，把“发弹幕、拉弹幕、统计和开关”串在一起的。</p>
<p><strong>弹幕怎么存？</strong><br>
后端有一张专门的弹幕表，大概就存这些信息：</p>
<ul>
<li>
<p>哪个视频、哪一 P（videoId + fileId）；</p>
</li>
<li>
<p>谁发的（userId）；</p>
</li>
<li>
<p>内容、颜色、模式（滚动 / 顶部 / 底部）；</p>
</li>
<li>
<p>最重要的一个字段：time（在第几秒出现）；</p>
</li>
<li>
<p>以及发送时间。</p>
</li>
<li>
<p>视频表里还维护了一个“弹幕数量”的计数字段，用来做统计和排序。</p>
</li>
</ul>
<p><strong>用户发弹幕的流程</strong></p>
<ul>
<li>
<p>前端在看视频的时候，带着参数去调发送弹幕接口。</p>
</li>
<li>
<p>后端先从登录态里拿当前用户 ID，再做几层校验：</p>
</li>
<li>
<p>文字长度有没有超限制（比如不超过 200 字）；</p>
</li>
<li>
<p>视频是否存在、这个视频有没有被 UP 主关闭弹幕。</p>
</li>
<li>
<p>校验都通过之后，就往弹幕表里插一条记录，同时把对应视频的弹幕数加 1。</p>
</li>
</ul>
<p><strong>弹幕是怎么展示出来的？</strong><br>
播放器在加载某一 P 的时候，会调一个“拉弹幕”的接口。<br>
后端就按这个分 P 去查，通常按弹幕的自增 ID 或时间顺序排好，一次性返回给前端。<br>
<strong>每条记录里都有一个“出现在第几秒”的时间戳，前端就可以根据当前播放进度，把对应时间点的弹幕渲染出来；</strong><br>
如果这个视频被设置成“关闭弹幕”，那接口这边直接返回空列表就行了。</p>
<p><strong>开关和计数这块怎么管？</strong></p>
<ul>
<li>视频信息里有一个互动配置字段，里面会带“是否关闭弹幕”的开关；</li>
<li>弹幕数量这块就是每成功发一条，就把视频表里的弹幕计数 +1，后面做排序或统计的时候可以直接用。</li>
</ul>
<p><strong>补一句整体设计</strong><br>
整体就是：<strong>登录校验在切面里统一做，弹幕表只负责存内容和时间点，视频表负责开关和计数，前端根据时间戳来决定什么时候把弹幕画到屏幕上</strong>，整体实现比较轻量，也方便后续扩展弹幕样式。</p>
<h2 id="简单讲讲这个项目的点赞收藏投币功能是怎么实现的">简单讲讲这个项目的点赞收藏投币功能是怎么实现的</h2>
<h3 id="口语版：点赞-收藏-投币是怎么做的">口语版：点赞 / 收藏 / 投币是怎么做的</h3>
<p><strong>1）先说表这块</strong></p>
<ul>
<li>我有一张专门的<strong>用户行为表，记录“谁对哪条视频做了什么</strong>”：视频 ID、评论 ID（有些行为跟评论有关）、行为类型（点赞 / 收藏 / 投币）、用户 ID 等。</li>
<li><strong>这些字段上做了一个联合唯一索引，相当于“同一个人对同一个目标，同一种行为只能有一条记录”，天然防重复</strong>。</li>
<li><strong>视频表里再单独维护几个计数字段</strong>，比如点赞数、收藏数、投币数，<strong>用来展示和排序</strong>。</li>
</ul>
<hr>
<p><strong>2）点赞 / 收藏：开关型的逻辑</strong></p>
<ul>
<li>点赞、收藏都是“开关”思路：
<ul>
<li>先查一下这条行为在表里存不存在；</li>
<li>已经存在，就说明用户点过赞 / 收藏了，这次再点就是取消：</li>
<li>不存在，就是第一次点：插入一条记录，把计数 +1。</li>
</ul>
</li>
<li>整个操作包在<strong>事务</strong>里，防止数据不一致的情况</li>
</ul>
<hr>
<p><strong>3）投币：累加型的逻辑</strong></p>
<ul>
<li>是一种“扣我加你，再记一笔账”的模式：
<ul>
<li>先判断一下自己不能给自己投币；</li>
<li>再判断同一个用户对同一视频是不是已经投过，以及当前余额&gt;=投币数</li>
<li>校验通过后，从当前用户的硬币余额里扣除，同时给 UP 主的硬币加上；</li>
<li>行为表里插入一条“投币”的记录；</li>
<li>视频表里的投币数再 +N。</li>
</ul>
</li>
<li>整个流程同样放在一个事务里，要么全部成功，要么都不生效。</li>
</ul>
<hr>
<p><strong>4）展示和站内消息这块</strong></p>
<ul>
<li>当我们在查视频详情的时候，我会顺带把“当前用户对这个视频做过哪些行为”一起返回，比如是否已经点赞、是否已收藏、有没有投币过。<br>
前端拿到后就可以把按钮置蓝、显示“已投币”等状态。</li>
<li>在点赞/评论/收藏审核等接口方法上加了一个 <code>@RecordUserMessage</code> 注解，切面会在业务执行成功后，自动帮你写一条站内消息，比如“你的视频被点赞了 / 被收藏了”，业务代码不用到处手动发通知。</li>
</ul>
<hr>
<p><strong>5）一句话总结</strong></p>
<blockquote>
<p>点赞 / 收藏用“存在删、无则增”的开关模式，投币用“扣我加你 + 行为落表”的累加模式；<br>
联合唯一索引保证一人一行为的幂等，视频计数统一通过一个更新方法维护，再配合 AOP 自动发站内消息，整个过程放在事务里保证一致性。</p>
</blockquote>
<h2 id="简单讲讲这个项目的评论功能是怎么实现的？父级子级评论怎么实现的？">简单讲讲这个项目的评论功能是怎么实现的？父级子级评论怎么实现的？</h2>
<h3 id="口语版：评论功能-父子评论怎么做的">口语版：评论功能 &amp; 父子评论怎么做的</h3>
<p><strong>1）评论是怎么存的？</strong></p>
<ul>
<li>后端就一张 <code>video_comment</code> 表，关键信息有：
<ul>
<li><code>comment_id</code>：这条评论自己的 ID；</li>
<li><code>p_comment_id</code>：父评论 ID，<strong>0 表示主评论，大于 0 表示某个主评论下面的子评论</strong>；</li>
<li><code>video_id</code>、<code>user_id</code>、<code>reply_user_id</code>（如果是回复别人，会记被回复的人是谁）；</li>
<li><code>content</code>、点赞数、踩数、是否置顶、发送时间等。</li>
</ul>
</li>
<li>视频表里还维护一个总评论数，用来做展示和排序。</li>
</ul>
<hr>
<p><strong>2）发评论的流程（顺便说父子关系怎么定）</strong></p>
<ul>
<li>
<p>前端调发评论的接口，带 <code>视频id、内容</code>，如果是“回复某条评论”，会多带一个<code>replyCommentId</code>。</p>
</li>
<li>
<p>后端校验：视频是否存在、UP 有没有关闭评论区。</p>
</li>
<li>
<p>如果没带 <code>replyCommentId</code>，那就是<strong>主评论</strong>：</p>
<p>入库后把视频的评论数 <code>+1</code>。</p>
</li>
<li>
<p>如果带了 <code>replyCommentId</code>，那就是<strong>回复</strong>：</p>
<ul>
<li>先查被回复那条评论；</li>
<li>如果对方本身是主评，就把当前这条的 <code>p_comment_id</code> 设成对方的 <code>comment_id</code>；</li>
<li>如果对方是子评，就沿用它的 <code>p_comment_id</code>，也就是所有回复都挂在同一个“楼层”下；</li>
<li>同时把 <code>reply_user_id</code> 记成被回复的那个人，后面做“@谁谁谁”的展示和站内消息会用到。</li>
</ul>
</li>
</ul>
<hr>
<p><strong>一句话总结</strong></p>
<blockquote>
<p>我是用 <code>p_comment_id</code> 来做父子关系：0 表示主评，&gt;0 表示挂在某个主评下面的子评；<br>
发评论时看有没有 <code>replyCommentId</code> 来决定 <code>p_comment_id</code> 和 <code>reply_user_id</code>，查评论时先主评再一次性把子评论挂在 <code>children</code> 上返回，配合点赞/踩、删除、置顶等能力，就能比较完整地支撑“楼中楼”评论体系。</p>
</blockquote>
<h2 id="在线人数怎么实现的？">在线人数怎么实现的？</h2>
<ul>
<li>我用“心跳+过期监听”的思路做的，核心都在 Redis。</li>
<li>客户端每隔几秒上报一次心跳：调用后端 <code>/video/reportVideoPlayOnline?fileId&amp;deviceId</code>。</li>
<li>服务器做两件事：
<ul>
<li>首次心跳：给这个用户写一个在线标记 key，比如 <code>video:play:online:user:&#123;fileId&#125;:&#123;deviceId&#125;</code>，TTL≈8s；同时把在线总数 key <code>video:play:online:count:&#123;fileId&#125;</code> 自增1（并给它TTL≈10s）。返回当前在线数。</li>
<li>非首次心跳：只给这两个 key 续期，不再自增，避免一个人被计多次。</li>
</ul>
</li>
<li>下线/断网的扣减：
<ul>
<li>开启 Redis key 过期事件（Ex），监听到“用户在线标记”过期时，根据 key 解析出 <code>fileId</code>，对 <code>video:play:online:count:&#123;fileId&#125;</code> 做自减1。</li>
</ul>
</li>
<li>这样就实现了“首上+1、持续续期、不重复计数、心跳断了自动-1”，进程宕机也能靠过期回收，计数基本准。</li>
</ul>
<h3 id="口语版：在线人数是怎么做的">口语版：在线人数是怎么做的</h3>
<p>这个在线人数我用的是“<strong>心跳 + Redis 过期</strong>”的思路，核心都是靠 Redis 在撑。</p>
<ul>
<li>
<p><strong>第一步：客户端定时发心跳</strong><br>
播放器在播放某一 P 时，每隔几秒会带着发一次心跳，相当于告诉服务端“我还在看”。</p>
</li>
<li>
<p><strong>第二步：服务端怎么记在线用户</strong><br>
收到心跳后，我分两种情况处理：</p>
<ul>
<li><strong>第一次心跳</strong>（用户刚进入视频）
<ul>
<li>在 Redis 里写一个用户在线标记，TTL 设成 8 秒；</li>
<li>同时把这个视频的在线总数 自增 1，并给它设一个稍长一点的 TTL（比如 10 秒）；</li>
<li>然后把当前在线数返回给前端。</li>
</ul>
</li>
<li><strong>后续心跳</strong> 的就不会再加 ，这样一个用户不会被算成多个人</li>
</ul>
</li>
<li>
<p><strong>第三步：人走了怎么减 1？</strong><br>
我在 Redis 这边打开了 key 过期事件监听：</p>
<ul>
<li>当某个Redis里的 在线标记 过期时，说明这个设备一段时间没心跳了，就认为下线了；</li>
<li>同时把这个视频的在线总数  做一次自减 1。</li>
</ul>
</li>
</ul>
<p>这样一套下来，其实就是：</p>
<blockquote>
<p>首次上报时在线人数 +1，之后只续命不重复计数；心跳断了靠 Redis 过期自动 -1。<br>
就算服务重启，Redis 里 key 也会自己过期回收，在线人数整体是比较准确、而且实现也比较轻量的。</p>
</blockquote>
<h2 id="24小时热门显示是怎么实现的？">24小时热门显示是怎么实现的？</h2>
<ul>
<li>我这块没做复杂的离线计算，走的是“在线统计 + SQL 过滤排序”。</li>
<li>每次播放都会把 <code>video_info.play_count +1</code>，同时更新 <code>last_play_time=now()</code>（在 <code>updateCountInfo</code> 里做的）。</li>
<li>接口 <code>/video/loadHotVideoList</code> 查询最近 24 小时：SQL 条件 <code>last_play_time &gt;= now() - interval 24 hour</code>，再按 <code>play_count desc</code> 排序，分页返回，并联表补上作者头像/昵称做展示。</li>
<li>这样能实时反映最近一天的热度；如果要换窗口（如 48 小时/7 天）只改查询参数即可。配合 <code>last_play_time</code>、<code>play_count</code> 索引，查询很快。</li>
</ul>
<h3 id="口语版：24-小时热门是怎么做的">口语版：24 小时热门是怎么做的</h3>
<p>这块我没上特别重的离线统计，就是用<strong>在线累加 + 一条 SQL 过滤排序</strong>解决的。</p>
<p><strong>先把数据埋好点</strong><br>
每次视频被播放，我都会做两件事：<br>
1）把这条视频的播放数 +1；<br>
2）顺便更新一下它的 最近一次播放时间</p>
<p><strong>查 24 小时热门的时候</strong><br>
热门接口 <code>/video/loadHotVideoList</code> 的查询条件其实很直接：</p>
<ul>
<li>先筛一遍：<code>last_play_time &gt;= now() - interval 24 hour</code>，<strong>只看最近 24 小时有过播放的；</strong></li>
<li>再按 播放量正序排序，取前几页数据；</li>
<li>联表把作者头像、昵称这些信息一起补上，方便前端直接展示。</li>
</ul>
<p><strong>好处和扩展性</strong></p>
<ul>
<li>这样做的好处是：<strong>实时性很好</strong>，只要有人一播放，立刻会影响到 24 小时热门；</li>
<li>要换时间窗口（比如 48 小时、7 天）也很简单，只改一下 where 条件即可。</li>
<li>我们还可以在再给 最近一次播放时间  和 播放量 建个合适的索引，这个查询在数据量上来之后也能跑得很快。</li>
</ul>
<h2 id="你的项目中哪里用到了AOP？">你的项目中哪里用到了AOP？</h2>
<p>在 GQ Video 里，我主要把 AOP 用在两块典型的横切逻辑上：<strong>登录校验</strong>和<strong>用户行为转站内消息</strong>。</p>
<ul>
<li>
<p><strong>第一块是登录校验的全局拦截</strong><br>
我在公共模块里定义了一个注解 <code>@GlobalInterceptor</code>，然后写了一个切面 <code>GlobalOperationAspect</code>，用 <code>@Before</code> 去拦截。<br>
控制器方法只要加上 <code>@GlobalInterceptor(checkLogin = true)</code>，真正执行业务代码之前，切面会先从 <code>HttpServletRequest</code> 里拿到 <code>token</code>，再去 Redis 查 <code>TokenUserInfoDto</code>，如果 token 为空或者查不到，就直接抛 <code>BusinessException</code>，前端拿到统一的错误码。<br>
这样好处是比较明显的：<strong>接口里不用一遍遍去写“判断有没有登录”的 if，后面要调整登录策略（比如 token 时长、踢下线逻辑）只改切面这一处，就能全局生效。</strong></p>
</li>
<li>
<p><strong>第二块是把用户行为自动转换成站内消息</strong><br>
这类逻辑我用的是另外一个注解 <code>@RecordUserMessage</code>，对应的切面是 <code>UserMessageOperationAspect</code>，用 <code>@Around</code> 去包一层。<br>
像用户收藏、评论、回复、审核通过/驳回这种操作，在方法上打个 <code>@RecordUserMessage(...)</code> 就行了：<br>
切面里会先执行原方法，拿到 <code>ResponseVO</code>，只有在正常返回、不抛异常的情况下，才去解析方法参数（比如 <code>videoId</code>、<code>actionType</code>、<code>replyCommentId</code>、<code>content</code>），结合注解里配的默认 <code>MessageTypeEnum</code> 和实际的 <code>actionType</code>，最后调用 <code>UserMessageService.saveUserMessage</code> 落一条站内消息。当前操作者是谁，是从请求头 token → Redis 里拿 <code>TokenUserInfoDto</code> 算出来的。<br>
这样业务代码只关心“这次是评论还是收藏”，不需要自己去管“给谁发一条什么类型的站内消息”，通知逻辑集中在切面里，既统一又方便扩展。</p>
<p><a target="_blank" rel="noopener" href="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1110.png">https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1110.png</a></p>
</li>
<li>
<p><strong>为什么选 AOP 而不是简单用过滤器/拦截器？</strong><br>
登录这块我们在网关也有粗粒度的校验，但像“哪些方法必须登录、成功后要不要额外记一条消息”这种，是<strong>方法级的业务规则</strong>，需要读到注解和参数，AOP 在这层会更合适；<br>
类似“操作审计、性能埋点”这种以后要加的能力，也可以沿用这一套模式，再加注解和切面就行，对现有业务代码侵入很小。</p>
</li>
</ul>
<h2 id="历史播放记录怎么实现的？">历史播放记录怎么实现的？</h2>
<h3 id="口语版：历史播放记录是怎么做的">口语版：历史播放记录是怎么做的</h3>
<p>我这块历史记录是绑在“播放事件”上的，用户一看视频，后台就自动记一笔，不需要前端额外调接口。</p>
<ul>
<li>
<p><strong>1）数据怎么存？</strong><br>
有一张播放历史表，大概就这几个字段：用户 ID、视频 ID、分 P 索引（fileIndex）、最后观看时间<br>
同一个用户对同一个视频，只保留一条记录，每次再看就更新这条的分 P 和时间。</p>
</li>
<li>
<p><strong>2）什么时候写历史？</strong></p>
<p>前端上报播放后，先发一条 <code>video-play</code> 消息到 RocketMQ，消费端 <code>PlayEventConsumer</code> 收到后：</p>
<ul>
<li>给视频播放数 +1；</li>
<li>如果带了 userId，就调 saveHistory 记历史。</li>
</ul>
<p><code>saveHistory</code> 做的事很简单：</p>
<ul>
<li>组一条 <code>VideoPlayHistory</code>（用户、视频、分 P、当前时间）；</li>
<li>调用 Mapper 的 <code>insertOrUpdate</code>，有就更新，没有就插入，<strong>这样同一用户多次播放同一视频不会刷出一堆重复记录</strong>。</li>
</ul>
</li>
<li>
<p><strong>3）历史列表怎么查？</strong></p>
<p>还有一个单独的查历史接口 <code>loadHistory</code>：</p>
<ul>
<li>先拿当前登录的用户 ID；</li>
<li>按  最后更新时间倒序 排序，再带上页码做分页；</li>
<li>Mapper 查询的时候会 <strong>联表视频表</strong> 把封面和标题一起查出来，这样前端拿到的每条历史记录里，就能看到“什么时候看的哪一 P”，也有“封面和名字”</li>
</ul>
</li>
<li>
<p><strong>4）清空和删除单条怎么做？</strong></p>
<ul>
<li>按当前用户 ID cleanHistory 会把这人的所有历史记录删掉；</li>
<li>指定一个视频 ID，delHistory 只删当前用户在这个视频上的那条历史。</li>
</ul>
</li>
</ul>
<p><strong>一句话总结</strong>：</p>
<blockquote>
<p>历史播放是依托“播放事件”自动写入的：每次播放就 insertOrUpdate 一条“用户 + 视频 + 分 P + 最后观看时间”的记录，查的时候按时间倒序分页、顺带带上封面和标题，并提供清空和按视频删除的接口，前端就能很方便地做“最近观看”列表。</p>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>GQ Video项目相关解答</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://itgeqian.github.io/posts/83.html">https://itgeqian.github.io/posts/83.html</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>作者</h><div class="post-copyright-cc-info"><h>geqian's Blog🍭</h></div></div><div class="post-copyright-c"><h>发布于</h><div class="post-copyright-cc-info"><h>2025-09-06</h></div></div><div class="post-copyright-u"><h>更新于</h><div class="post-copyright-cc-info"><h>2025-09-16</h></div></div><div class="post-copyright-c"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E9%A1%B9%E7%9B%AE%E7%9B%B8%E5%85%B3/"><div class="tags-punctuation"><svg class="faa-tada icon" style="height:1.1em;width:1.1em;fill:currentColor;position:relative;top:2px;margin-right:3px" aria-hidden="true"><use xlink:href="#icon-sekuaibiaoqian"></use></svg></div>项目相关</a></div></div><link rel="stylesheet" href="/css/coin.css" media="defer" onload="this.media='all'"/><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">投喂作者</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://java-geqian.oss-cn-beijing.aliyuncs.com/%E5%BE%AE%E4%BF%A1PAY.jpg" target="_blank"><img class="post-qr-code-img" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/%E5%BE%AE%E4%BF%A1PAY.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://java-geqian.oss-cn-beijing.aliyuncs.com/%E6%94%AF%E4%BB%98%E5%AE%9DPAY.jpg" target="_blank"><img class="post-qr-code-img" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/%E6%94%AF%E4%BB%98%E5%AE%9DPAY.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></button></div><audio id="coinAudio" src="https://npm.elemecdn.com/akilar-candyassets@1.0.36/audio/aowu.m4a"></audio><script defer="defer" src="/js/coin.js"></script><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/54.html"><img class="prev-cover" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/%E4%B8%89%E5%9B%BD%E6%97%A0%E5%8F%8C.jpg" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">代码生成器详解</div></div></a></div><div class="next-post pull-right"><a href="/posts/53.html"><img class="next-cover" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/4.jpg" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">AIGC之Comfyui</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/82.html" title="GQ Music项目相关解答"><img class="cover" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/21.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-10-20</div><div class="title">GQ Music项目相关解答</div></div></a></div><div><a href="/posts/58.html" title="GQ Music项目演示图"><img class="cover" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/18.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-09-26</div><div class="title">GQ Music项目演示图</div></div></a></div><div><a href="/posts/43.html" title="GQ Video项目优化记录"><img class="cover" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/30.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-08-03</div><div class="title">GQ Video项目优化记录</div></div></a></div><div><a href="/posts/41.html" title="GQ Video单服务改造微服务"><img class="cover" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/29.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-08-11</div><div class="title">GQ Video单服务改造微服务</div></div></a></div><div><a href="/posts/37.html" title="GQ Video单服务版本记录"><img class="cover" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/27.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-08-12</div><div class="title">GQ Video单服务版本记录</div></div></a></div><div><a href="/posts/54.html" title="代码生成器详解"><img class="cover" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/%E4%B8%89%E5%9B%BD%E6%97%A0%E5%8F%8C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-09-11</div><div class="title">代码生成器详解</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><svg class="meta_icon" style="width:22px;height:22px;position:relative;top:5px"><use xlink:href="#icon-mulu1"></use></svg><span style="font-weight:bold">目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#GQ-Video"><span class="toc-text">GQ Video</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E4%BD%A0%E5%85%88%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8B%E8%BF%99%E4%B8%AAGQ-Video%E9%A1%B9%E7%9B%AE%EF%BC%9F"><span class="toc-text">请你先简单介绍一下这个GQ Video项目？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%A0%E6%8F%90%E5%88%B0%E4%BD%A0%E6%8A%8A%E5%90%8E%E7%AB%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8B%86%E6%88%90%E4%BA%86%E8%A7%86%E9%A2%91%E6%9C%8D%E5%8A%A1%E3%80%81%E4%BA%92%E5%8A%A8%E6%9C%8D%E5%8A%A1%E3%80%81%E8%B5%84%E6%BA%90%E6%9C%8D%E5%8A%A1%E3%80%81%E7%BD%91%E5%85%B3%E3%80%81Admin-%E8%BF%995%E4%B8%AA%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%9D%97%EF%BC%8C%E4%BD%A0%E8%83%BD%E5%91%8A%E8%AF%89%E4%BD%A0%E5%BD%93%E6%97%B6%E6%98%AF%E6%80%8E%E4%B9%88%E6%83%B3%E7%9A%84%E5%90%97%EF%BC%9F%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%99%E4%B9%88%E8%AE%BE%E8%AE%A1%E5%91%A2%EF%BC%9F"><span class="toc-text">你提到你把后端微服务拆成了视频服务、互动服务、资源服务、网关、Admin 这5个微服务模块，你能告诉你当时是怎么想的吗？为什么这么设计呢？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89%E8%A7%86%E9%A2%91%E6%9C%8D%E5%8A%A1%EF%BC%9A%E6%A0%B8%E5%BF%83%E4%B8%9A%E5%8A%A1%E5%9F%9F%EF%BC%8C%E5%8D%95%E7%8B%AC%E6%8B%BF%E5%87%BA%E6%9D%A5"><span class="toc-text">1）视频服务：核心业务域，单独拿出来</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E4%BA%92%E5%8A%A8%E6%9C%8D%E5%8A%A1%EF%BC%9A%E9%AB%98%E9%A2%91%E6%93%8D%E4%BD%9C%EF%BC%8C%E8%A7%A3%E8%80%A6%E5%87%BA%E6%9D%A5%E5%87%8F%E5%8E%8B"><span class="toc-text">2）互动服务：高频操作，解耦出来减压</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%89%E8%B5%84%E6%BA%90%E6%9C%8D%E5%8A%A1%EF%BC%9A%E5%92%8C%E2%80%9C%E6%96%87%E4%BB%B6-%E5%AD%98%E5%82%A8-%E8%BD%AC%E7%A0%81%E2%80%9D%E5%BC%BA%E7%9B%B8%E5%85%B3%EF%BC%8C%E5%8D%95%E7%8B%AC%E4%B8%80%E4%B8%AA%E5%9F%9F"><span class="toc-text">3）资源服务：和“文件&#x2F;存储&#x2F;转码”强相关，单独一个域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%89Admin%EF%BC%88%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%EF%BC%89%EF%BC%9A%E6%9D%83%E9%99%90%E5%92%8C%E5%9C%BA%E6%99%AF%E5%AE%8C%E5%85%A8%E4%B8%8D%E5%90%8C%EF%BC%8C%E5%8D%95%E7%8B%AC%E6%9C%8D%E5%8A%A1"><span class="toc-text">4）Admin（后台管理）：权限和场景完全不同，单独服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%89%E7%BD%91%E5%85%B3%EF%BC%9A%E7%BB%9F%E4%B8%80%E5%85%A5%E5%8F%A3-%E8%B7%AF%E7%94%B1-%E5%AE%89%E5%85%A8"><span class="toc-text">5）网关：统一入口 + 路由 + 安全</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%BC%89%E6%80%BB%E7%BB%93%E6%88%90%E4%B8%80%E4%B8%A4%E5%8F%A5%E8%AF%9D%E7%BB%99%E9%9D%A2%E8%AF%95%E5%AE%98"><span class="toc-text">6）总结成一两句话给面试官</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%A0%E4%BB%AC%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%98%AF%E6%80%8E%E4%B9%88%E5%81%9A%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86%E7%9A%84"><span class="toc-text">你们的服务是怎么做日志收集的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%A0%E6%98%AF%E5%90%A6%E4%BD%BF%E7%94%A8%E8%BF%87%E5%93%AA%E4%BA%9B-Java-%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7%E7%B1%BB%EF%BC%9F"><span class="toc-text">项目中你是否使用过哪些 Java 并发工具类？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%8F%A3%E8%BF%B0%E7%89%88%EF%BC%8830-60-%E7%A7%92%EF%BC%89"><span class="toc-text">面试口述版（30-60 秒）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%BD%E9%97%AE%E6%97%B6%E5%8F%AF%E5%B1%95%E5%BC%80%EF%BC%88%E9%80%90%E6%9D%A1%E4%B8%BE%E4%BE%8B%EF%BC%89"><span class="toc-text">追问时可展开（逐条举例）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%A0%E5%85%B7%E4%BD%93%E8%AE%B2%E8%AE%B2%E6%92%AD%E6%94%BE%E4%BA%8B%E4%BB%B6%E7%BB%9F%E8%AE%A1%E3%80%81%E8%BD%AC%E7%A0%81%E4%BB%BB%E5%8A%A1%E8%BF%99%E4%B8%A4%E4%B8%AA%E4%BB%BB%E5%8A%A1%EF%BC%8C%E6%B2%A1%E4%B8%8AMQ%E4%BD%A0%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84%EF%BC%8C%E7%94%A8%E4%BA%86MQ%E4%BD%A0%E5%8F%88%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84%EF%BC%9F"><span class="toc-text">你具体讲讲播放事件统计、转码任务这两个任务，没上MQ你是怎么实现的，用了MQ你又是怎么实现的？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%8F%A3%E8%AF%AD%E7%89%88%E5%9B%9E%E7%AD%94%EF%BC%88MQ-%E6%94%B9%E9%80%A0%E6%92%AD%E6%94%BE%E7%BB%9F%E8%AE%A1-%E8%BD%AC%E7%A0%81%E4%BB%BB%E5%8A%A1%EF%BC%89"><span class="toc-text">面试口语版回答（MQ 改造播放统计 &amp; 转码任务）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%B2%A1%E4%B8%8A-MQ-%E4%B9%8B%E5%89%8D"><span class="toc-text">一、没上 MQ 之前</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E4%B8%8A-MQ%EF%BC%88RocketMQ%EF%BC%89%E4%B9%8B%E5%90%8E%EF%BC%9A%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85-%E6%9D%A1%E4%BB%B6%E5%BC%80%E5%85%B3"><span class="toc-text">二、上 MQ（RocketMQ）之后：发布订阅 + 条件开关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E4%B8%8A-MQ-%E4%B9%8B%E5%90%8E%E7%9A%84%E5%8F%98%E5%8C%96"><span class="toc-text">三、上 MQ 之后的变化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%80%BB%E7%BB%93"><span class="toc-text">一句话总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%A0%E4%B8%BA%E4%BB%80%E4%B9%88%E8%80%83%E8%99%91%E7%9A%84%E6%98%AFRocketMQ%E8%BF%99%E4%B8%AA%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E8%80%8C%E4%B8%8D%E6%98%AFRabbitMQ%E6%88%96%E8%80%85Kafka"><span class="toc-text">你为什么考虑的是RocketMQ这个消息队列而不是RabbitMQ或者Kafka</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%8F%A3%E8%AF%AD%E7%89%88%E5%9B%9E%E7%AD%94%E7%A4%BA%E4%BE%8B"><span class="toc-text">面试口语版回答示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%88%91%E7%9C%8B%E5%88%B0%E4%BD%A0%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%8A%80%E6%9C%AF%E6%A0%88%E6%9C%89Elasticsearch-%EF%BC%8C%E4%BD%A0%E8%AF%B4%E8%AF%B4%E4%BD%A0%E7%9A%84Elasticsearch-%E5%81%9A%E4%BA%86%E5%93%AA%E4%BA%9B%E4%BA%8B%EF%BC%8C%E4%BD%A0%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9%E4%BA%86Elasticsearch%E8%BF%99%E4%B8%AA%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%EF%BC%9F%E4%BD%A0%E6%98%AF%E6%80%8E%E4%B9%88%E4%BF%9D%E8%AF%81ES%E5%92%8CMysql%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7%E7%9A%84%EF%BC%9F"><span class="toc-text">我看到你的项目技术栈有Elasticsearch ，你说说你的Elasticsearch 做了哪些事，你为什么选择了Elasticsearch这个搜索引擎？你是怎么保证ES和Mysql的一致性的？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%A3%E8%AF%AD%E5%8C%96%E7%AD%94%E6%A1%88"><span class="toc-text">口语化答案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%8F%A3%E8%AF%AD%E7%89%88%E5%9B%9E%E7%AD%94%E7%A4%BA%E4%BE%8B-2"><span class="toc-text">面试口语版回答示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89ES-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E9%87%8C%E5%85%B7%E4%BD%93%E5%81%9A%E4%BA%86%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">1）ES 在项目里具体做了什么？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9-Elasticsearch%EF%BC%9F"><span class="toc-text">2）为什么选择 Elasticsearch？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%89%E6%80%8E%E4%B9%88%E4%BF%9D%E8%AF%81-ES-%E5%92%8C-MySQL-%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7%EF%BC%9F"><span class="toc-text">3）怎么保证 ES 和 MySQL 的一致性？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E5%8F%A3%E8%AF%AD%E5%8C%96%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7%E5%9B%9E%E7%AD%94%EF%BC%88%E5%BC%B1%E5%8C%96%E7%B1%BB%E5%90%8D-%E5%AD%97%E6%AE%B5%E5%90%8D%EF%BC%89"><span class="toc-text">更口语化的一致性回答（弱化类名&#x2F;字段名）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nacos%E7%9B%B8%E5%85%B3"><span class="toc-text">Nacos相关</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E8%83%BD%E8%A2%AB%E9%97%AE%E5%88%B0%E7%9A%84%E6%96%B9%E5%90%91-%E5%9B%9E%E7%AD%94%E6%80%9D%E8%B7%AF%EF%BC%88%E7%BB%93%E5%90%88%E4%BD%A0%E7%8E%B0%E5%9C%A8%E7%9A%84%E9%A1%B9%E7%9B%AE%EF%BC%89"><span class="toc-text">可能被问到的方向 &amp; 回答思路（结合你现在的项目）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GateWay%E7%9B%B8%E5%85%B3"><span class="toc-text">GateWay相关</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E4%BB%A5%E8%A2%AB%E9%97%AE%E5%88%B0%E7%9A%84%E5%87%A0%E4%B8%AA%E5%85%B8%E5%9E%8B%E6%96%B9%E5%90%91%EF%BC%88%E5%90%AB%E7%AD%94%E9%A2%98%E6%80%9D%E8%B7%AF%EF%BC%89"><span class="toc-text">可以被问到的几个典型方向（含答题思路）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Seata%E7%9B%B8%E5%85%B3"><span class="toc-text">Seata相关</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E9%9D%A2%E8%AF%95%E5%AE%98%E5%8F%AF%E8%83%BD%E9%97%AE%E7%9A%84%E6%96%B9%E5%90%91%EF%BC%88%E5%B8%A6%E6%80%9D%E8%B7%AF%EF%BC%89"><span class="toc-text">一、面试官可能问的方向（带思路）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8"><span class="toc-text">代码生成器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E4%BB%A5%E8%A2%AB%E9%97%AE%E5%88%B0%E7%9A%84%E5%85%B8%E5%9E%8B%E6%96%B9%E5%90%91%EF%BC%88%E7%BB%93%E5%90%88%E4%BD%A0%E8%BF%99%E5%A5%97%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8%EF%BC%89"><span class="toc-text">可以被问到的典型方向（结合你这套代码生成器）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%A0%E5%81%9A%E9%A1%B9%E7%9B%AE%E9%81%87%E5%88%B0%E4%BA%86%E4%BB%80%E4%B9%88%E9%9A%BE%E7%82%B9%EF%BC%9F%E4%BD%A0%E6%98%AF%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3%E7%9A%84%EF%BC%9F"><span class="toc-text">你做项目遇到了什么难点？你是怎么解决的？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%AA%8C%E8%AF%81%E7%A0%81%E8%A2%AB%E8%A6%86%E7%9B%96%E7%9A%84%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98"><span class="toc-text">1.验证码被覆盖的一个问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E5%BC%80%E5%A7%8B%E6%88%91%E4%BB%AC%E5%81%9A%E9%AA%8C%E8%AF%81%E7%A0%81%E5%BE%88%E7%AE%80%E5%8D%95%EF%BC%9A"><span class="toc-text">一开始我们做验证码很简单：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%88%91%E7%9A%84%E6%94%B9%E9%80%A0%E6%80%9D%E8%B7%AF"><span class="toc-text">2. 我的改造思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%9A%E5%A4%A7%E6%96%87%E4%BB%B6%E5%88%86%E7%89%87%E4%B8%8A%E4%BC%A0-%E8%BD%AC%E7%A0%81%E8%80%97%E6%97%B6%E9%95%BF%EF%BC%8C%E6%8E%A5%E5%8F%A3%E5%AE%B9%E6%98%93%E8%B6%85%E6%97%B6"><span class="toc-text">2：大文件分片上传 + 转码耗时长，接口容易超时</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-3%EF%BC%9A%E8%AF%84%E8%AE%BA%E5%8F%91%E5%B8%83%E5%92%8C%E8%AF%84%E8%AE%BA%E6%95%B0%E4%B8%8D%E4%B8%80%E8%87%B4%EF%BC%88%E8%B7%A8%E6%9C%8D%E5%8A%A1%E4%BA%8B%E5%8A%A1%EF%BC%89"><span class="toc-text">案例 3：评论发布和评论数不一致（跨服务事务）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%EF%BC%9A%E6%92%AD%E6%94%BE%E7%BB%9F%E8%AE%A1%E4%BB%8E%E2%80%9C%E7%BA%BF%E7%A8%8B%E6%B1%A0-Redis-%E5%88%97%E8%A1%A8%E2%80%9D%E8%BF%81%E5%88%B0-RocketMQ"><span class="toc-text">4.：播放统计从“线程池 + Redis 列表”迁到 RocketMQ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E8%AE%B2%E8%AE%B2%E8%BF%99%E4%B8%AA%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%B3%A8%E5%86%8C%E5%8A%9F%E8%83%BD%EF%BC%9F"><span class="toc-text">简单讲讲这个项目的注册功能？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%A3%E8%AF%AD%E5%8C%96%E8%AE%B2%E6%B3%A8%E5%86%8C%E6%B5%81%E7%A8%8B%EF%BC%88%E9%9D%A2%E8%AF%95%E7%89%88%EF%BC%89"><span class="toc-text">口语化讲注册流程（面试版）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E8%AE%B2%E8%AE%B2%E8%BF%99%E4%B8%AA%E9%A1%B9%E7%9B%AE%E7%9A%84%E7%99%BB%E5%BD%95%E4%BB%A5%E5%8F%8A%E8%87%AA%E5%8A%A8%E7%99%BB%E5%BD%95%E3%80%81%E9%80%80%E5%87%BA%E4%BD%A0%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84%EF%BC%9F"><span class="toc-text">简单讲讲这个项目的登录以及自动登录、退出你是怎么实现的？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%A3%E8%AF%AD%E5%8C%96%E8%AE%B2%E7%99%BB%E5%BD%95-%E8%87%AA%E5%8A%A8%E7%99%BB%E5%BD%95-%E9%80%80%E5%87%BA%EF%BC%88%E9%9D%A2%E8%AF%95%E7%89%88%EF%BC%89"><span class="toc-text">口语化讲登录 &#x2F; 自动登录 &#x2F; 退出（面试版）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E8%AE%B2%E8%AE%B2%E8%BF%99%E4%B8%AA%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%88%86%E7%B1%BB%E5%8A%9F%E8%83%BD%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84%EF%BC%8C%E4%B8%80%E7%BA%A7%E5%88%86%E7%B1%BB%E5%92%8C%E4%BA%8C%E7%BA%A7%E5%88%86%E7%B1%BB%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%9A%84%EF%BC%9F"><span class="toc-text">简单讲讲这个项目的分类功能是怎么实现的，一级分类和二级分类是如何实现的？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%A3%E8%AF%AD%E7%89%88%EF%BC%9A%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E5%88%86%E7%B1%BB%E3%80%81%E4%B8%80%E7%BA%A7%E4%BA%8C%E7%BA%A7%E6%80%8E%E4%B9%88%E5%8C%BA%E5%88%86"><span class="toc-text">口语版：怎么实现分类、一级二级怎么区分</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E8%AE%B2%E8%AE%B2%E8%BF%99%E4%B8%AA%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%8A%9F%E8%83%BD%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84"><span class="toc-text">简单讲讲这个项目的文件上传功能是怎么实现的</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%A3%E8%AF%AD%E7%89%88%EF%BC%9A%E8%BF%99%E4%B8%AA%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%98%AF%E6%80%8E%E4%B9%88%E5%81%9A%E7%9A%84"><span class="toc-text">口语版：这个项目的文件上传是怎么做的</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%E9%97%AE%EF%BC%9A%E7%AE%80%E5%8D%95%E8%AE%B2%E8%AE%B2%E8%BF%99%E4%B8%AA%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%AE%A1%E6%A0%B8%E5%8A%9F%E8%83%BD%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84"><span class="toc-text">面试官问：简单讲讲这个项目的审核功能是怎么实现的</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%A3%E8%AF%AD%E7%89%88%EF%BC%9A%E8%BF%99%E4%B8%AA%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%AE%A1%E6%A0%B8%E6%98%AF%E6%80%8E%E4%B9%88%E5%81%9A%E7%9A%84"><span class="toc-text">口语版：这个项目的审核是怎么做的</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E8%AE%B2%E8%AE%B2%E8%BF%99%E4%B8%AA%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%BC%B9%E5%B9%95%E5%8A%9F%E8%83%BD%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84"><span class="toc-text">简单讲讲这个项目的弹幕功能是怎么实现的</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%A3%E8%AF%AD%E7%89%88%EF%BC%9A%E8%BF%99%E4%B8%AA%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%BC%B9%E5%B9%95%E6%98%AF%E6%80%8E%E4%B9%88%E5%81%9A%E7%9A%84"><span class="toc-text">口语版：这个项目的弹幕是怎么做的</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E8%AE%B2%E8%AE%B2%E8%BF%99%E4%B8%AA%E9%A1%B9%E7%9B%AE%E7%9A%84%E7%82%B9%E8%B5%9E%E6%94%B6%E8%97%8F%E6%8A%95%E5%B8%81%E5%8A%9F%E8%83%BD%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84"><span class="toc-text">简单讲讲这个项目的点赞收藏投币功能是怎么实现的</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%A3%E8%AF%AD%E7%89%88%EF%BC%9A%E7%82%B9%E8%B5%9E-%E6%94%B6%E8%97%8F-%E6%8A%95%E5%B8%81%E6%98%AF%E6%80%8E%E4%B9%88%E5%81%9A%E7%9A%84"><span class="toc-text">口语版：点赞 &#x2F; 收藏 &#x2F; 投币是怎么做的</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E8%AE%B2%E8%AE%B2%E8%BF%99%E4%B8%AA%E9%A1%B9%E7%9B%AE%E7%9A%84%E8%AF%84%E8%AE%BA%E5%8A%9F%E8%83%BD%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84%EF%BC%9F%E7%88%B6%E7%BA%A7%E5%AD%90%E7%BA%A7%E8%AF%84%E8%AE%BA%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84%EF%BC%9F"><span class="toc-text">简单讲讲这个项目的评论功能是怎么实现的？父级子级评论怎么实现的？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%A3%E8%AF%AD%E7%89%88%EF%BC%9A%E8%AF%84%E8%AE%BA%E5%8A%9F%E8%83%BD-%E7%88%B6%E5%AD%90%E8%AF%84%E8%AE%BA%E6%80%8E%E4%B9%88%E5%81%9A%E7%9A%84"><span class="toc-text">口语版：评论功能 &amp; 父子评论怎么做的</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8%E7%BA%BF%E4%BA%BA%E6%95%B0%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84%EF%BC%9F"><span class="toc-text">在线人数怎么实现的？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%A3%E8%AF%AD%E7%89%88%EF%BC%9A%E5%9C%A8%E7%BA%BF%E4%BA%BA%E6%95%B0%E6%98%AF%E6%80%8E%E4%B9%88%E5%81%9A%E7%9A%84"><span class="toc-text">口语版：在线人数是怎么做的</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#24%E5%B0%8F%E6%97%B6%E7%83%AD%E9%97%A8%E6%98%BE%E7%A4%BA%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84%EF%BC%9F"><span class="toc-text">24小时热门显示是怎么实现的？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%A3%E8%AF%AD%E7%89%88%EF%BC%9A24-%E5%B0%8F%E6%97%B6%E7%83%AD%E9%97%A8%E6%98%AF%E6%80%8E%E4%B9%88%E5%81%9A%E7%9A%84"><span class="toc-text">口语版：24 小时热门是怎么做的</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%A0%E7%9A%84%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%93%AA%E9%87%8C%E7%94%A8%E5%88%B0%E4%BA%86AOP%EF%BC%9F"><span class="toc-text">你的项目中哪里用到了AOP？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%86%E5%8F%B2%E6%92%AD%E6%94%BE%E8%AE%B0%E5%BD%95%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84%EF%BC%9F"><span class="toc-text">历史播放记录怎么实现的？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%A3%E8%AF%AD%E7%89%88%EF%BC%9A%E5%8E%86%E5%8F%B2%E6%92%AD%E6%94%BE%E8%AE%B0%E5%BD%95%E6%98%AF%E6%80%8E%E4%B9%88%E5%81%9A%E7%9A%84"><span class="toc-text">口语版：历史播放记录是怎么做的</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-color: transparent;"><div id="footer-wrap"><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">格言🧬</p><div class="bg-ad"><div>再看看那个光点，它就在这里，这是家园，这是我们 —— 你所爱的每一个人，你认识的一个人，你听说过的每一个人，曾经有过的每一个人，都在它上面度过他们的一生✨</div><div class="btn-xz-box"><a class="btn-xz" target="_blank" rel="noopener" href="https://stellarium.org/">点击开启星辰之旅</a></div></div></div><div class="t-t-r"><p class="ft-t t-l-t">猜你想看💡</p><ul class="ft-links"><li><a href="/comments/">留点什么</a><a href="/archives/">文章归档</a></li><li><a href="/categories/">文章分类</a><a href="/tags/">文章标签</a></li><li><a href="/box/Gallery/">我的画廊</a><a href="/personal/bb/">我的唠叨</a></li><li><a href="/site/time/">建设进程</a><a href="/site/census/">网站统计</a></li></ul></div></div></div><div class="ft-item-2"><p class="ft-t">推荐友链⌛</p><div class="ft-img-group"><div class="img-group-item"></div></div></div></div><div class="copyright"><span><b>&copy;2022-2025</b></span><span><b>&nbsp;&nbsp;By geqian's Blog🍭</b></span></div><div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://icp.gov.moe/?keyword=20230913" style="margin-inline:5px" title="本站已加入萌ICP豪华套餐，萌ICP备20230913号"><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/20230913.svg" alt=""/></a></p></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><a class="icon-V hidden" onclick="switchNightMode()" title="浅色和深色模式转换"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button class="share" type="button" title="右键模式" onclick="changeMouseMode()"><i class="fas fa-mouse"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog right_side"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button class="share" type="button" title="分享链接" onclick="share()"><i class="fas fa-share-nodes"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i><span id="percent">0<span>%</span></span></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();"><i class="fa fa-arrow-up"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa fa-copy"></i><span>复制</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();"><i class="fa fa-search"></i><span>百度搜索</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();"><i class="fa fa-link"></i><span>转到链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()"><i class="fa fa-copy"></i><span>粘贴</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="#post-comment"><i class="fas fa-comment"></i><span>空降评论</span></a><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()"><i class="fa fa-link"></i><span>复制本文地址</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>新窗口打开</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()"><i class="fa fa-link"></i><span>转到链接</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()"><i class="fa fa-download"></i><span>保存图片</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>在新窗口打开</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制图片链接</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:randomPost()"><i class="fa fa-paper-plane"></i><span>随便逛逛</span></a><a class="rightMenu-item" href="javascript:switchNightMode();"><i class="fa fa-moon"></i><span>昼夜切换</span></a><a class="rightMenu-item" href="/personal/about/"><i class="fa fa-info-circle"></i><span>关于博客</span></a><a class="rightMenu-item" href="javascript:toggleWinbox();"><i class="fas fa-cog"></i><span>美化设置</span></a><a class="rightMenu-item" href="javascript:rmf.fullScreen();"><i class="fas fa-expand"></i><span>切换全屏</span></a><a class="rightMenu-item" href="javascript:window.print();"><i class="fa-solid fa-print"></i><span>打印页面</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><script async="async">var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())
setTimeout(function(){preloader.endLoading();}, 5000);
document.getElementById('loading-box').addEventListener('click',()=> {preloader.endLoading()})</script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: '',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: '',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.staticfile.org/twikoo/1.6.8/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script async src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><script async src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script><script defer type="text/javascript" src="https://cdn1.tianli0.top/npm/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script defer src="https://cdn1.tianli0.top/gh/nextapps-de/winbox/dist/winbox.bundle.min.js"></script><script async src="//at.alicdn.com/t/c/font_3586335_hsivh70x0fm.js"></script><script async src="//at.alicdn.com/t/c/font_3636804_gr02jmjr3y9.js"></script><script async src="//at.alicdn.com/t/c/font_3612150_kfv55xn3u2g.js"></script><script async src="https://cdn.wpon.cn/2022-sucai/Gold-ingot.js"></script><canvas id="universe"></canvas><canvas id="snow"></canvas><script defer src="/js/fomal.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn1.tianli0.top/npm/js-heo@1.0.12/metingjs/Meting.min.js"></script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax","#bibi","body > title","#app","#tag-echarts","#posts-echart","#categories-echarts"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/学习笔记/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍡 geqianの学习笔记 (10)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/杂项/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍼 geqianの杂项 (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/项目/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍉 geqianの项目笔记 (6)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/AI/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍨 geqianのAI大模型 (6)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/算法/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍟 geqianの算法学习笔记 (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/面试/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍥 geqianの面试 (20)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/JUC/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🌏 geqianのJUC (4)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/JVM/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍜 geqianのJVM (5)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/云原生/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🔐 geqianの云原生相关 (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/MQ/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📱 geqianの消息队列 (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/前端/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🏛️ geqianの前端工程 (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/mybatis-mybatis-plus/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🎨 geqianのmybatis系列 (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/微服务/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🗺️ geqianのSpringCloud系列 (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/SSM/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📖 geqianのSSM+SpringBoot系列 (7)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/ruoyi/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📞 geqianの若依框架 (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/mysql/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">❓ geqianのmysql (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/Redis/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">💖 geqianのRedis (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item" style="visibility: hidden"></div><a class="magnet_link_more"  href="https://itgeqian.github.io/categories/" style="flex:1;text-align: center;margin-bottom: 10px;">查看更多...</a></div></div>';
    console.log('已挂载magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(33.333333333333336% - 5px);background: #e9e9e9;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: var(--text-bg-hover)}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/71.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/21.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-10-07</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/71.html&quot;);" href="javascript:void(0);" alt="">JVM面试题</a><div class="blog-slider__text">我对JVM的相关理解</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/71.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/60.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/%E5%8F%A4%E9%A3%8E.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-09-30</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/60.html&quot;);" href="javascript:void(0);" alt="">速通Spring AI Alibaba </a><div class="blog-slider__text">速通Spring AI Alibaba 完结</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/60.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/37.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/27.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-04-02</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/37.html&quot;);" href="javascript:void(0);" alt="">GQ Video单服务版本记录</a><div class="blog-slider__text">GQ Video单服务版本记录（完整记录GQ Video从0到1的全记录）</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/37.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/74.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/35.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-09-06</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/74.html&quot;);" href="javascript:void(0);" alt="">Mysql相关面试题</a><div class="blog-slider__text">我对mysql的相关理解</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/74.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/77.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/31.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-10-07</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/77.html&quot;);" href="javascript:void(0);" alt="">javase+集合相关面试题</a><div class="blog-slider__text">我对java基础和集合类的相关理解</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/77.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/68.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/22.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-10-01</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/68.html&quot;);" href="javascript:void(0);" alt="">JUC面试题</a><div class="blog-slider__text">我对JUC的理解</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/68.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper@1.0.12/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper@1.0.12/lib/swiper_init.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementById('gitZone');
      var item_html = '<div class="recent-post-item" id="gitcalendarBar" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 320px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('已挂载gitcalendar')
      }

    if( document.getElementById('gitZone') && (location.pathname ==='/site/census/'|| '/site/census/' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("/api?null",['#d9e0df', '#c6e0dc', '#a8dcd4', '#9adcd2', '#89ded1', '#77e0d0', '#5fdecb', '#47dcc6', '#39dcc3', '#1fdabe', '#00dab9'],'null')
    }
  </script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>