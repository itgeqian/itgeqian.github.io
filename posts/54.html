<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><div id="myscoll"></div><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>ä»£ç ç”Ÿæˆå™¨è¯¦è§£ | geqian's BlogğŸ­</title><meta name="keywords" content="é¡¹ç›®ç›¸å…³"><meta name="author" content="geqian's BlogğŸ­"><meta name="copyright" content="geqian's BlogğŸ­"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="ä»£ç ç”Ÿæˆå™¨è¯¦è§£ï¼Œé€šè¿‡æ·±å…¥åˆ†æä»£ç ç”Ÿæˆå™¨çš„å†…éƒ¨æœºåˆ¶ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°åˆ©ç”¨è¿™ä¸€å·¥å…·æé«˜å¼€å‘æ•ˆç‡ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="ä»£ç ç”Ÿæˆå™¨è¯¦è§£">
<meta property="og:url" content="https://itgeqian.github.io/posts/54.html">
<meta property="og:site_name" content="geqian&#39;s BlogğŸ­">
<meta property="og:description" content="ä»£ç ç”Ÿæˆå™¨è¯¦è§£ï¼Œé€šè¿‡æ·±å…¥åˆ†æä»£ç ç”Ÿæˆå™¨çš„å†…éƒ¨æœºåˆ¶ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°åˆ©ç”¨è¿™ä¸€å·¥å…·æé«˜å¼€å‘æ•ˆç‡ã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp">
<meta property="article:published_time" content="2025-09-10T03:19:03.000Z">
<meta property="article:modified_time" content="2025-09-10T23:03:00.000Z">
<meta property="article:author" content="geqian&#39;s BlogğŸ­">
<meta property="article:tag" content="é¡¹ç›®ç›¸å…³">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp"><link rel="shortcut icon" href="/"><link rel="canonical" href="https://itgeqian.github.io/posts/54"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.js',
      css: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ä»£ç ç”Ÿæˆå™¨è¯¦è§£',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-09-11 07:03:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><style id="themeColor"></style><style id="rightSide"></style><style id="transPercent"></style><style id="blurNum"></style><style id="settingStyle"></style><span id="fps"></span><style id="defineBg"></style><style id="menu_shadow"></style><script src="https://cdn.jsdelivr.net/npm/echarts@6/dist/echarts.min.js"></script><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper@1.0.12/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper@1.0.12/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="geqian's BlogğŸ­" type="application/atom+xml">
</head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/assets/avatar.png" onerror="onerror=null;src='/assets/r1.jpg'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">81</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">51</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">18</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--article"></use></svg><span class="menu_word" style="font-size:17px"> æ–‡ç« </span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> å½’æ¡£</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> æ ‡ç­¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei">                   </use></svg><span class="menu_word" style="font-size:17px"> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pinweishenghuo"></use></svg><span class="menu_word" style="font-size:17px"> ä¼‘é—²</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/life/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-yinle">                   </use></svg><span class="menu_word" style="font-size:17px"> å…«éŸ³ç›’</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-dianying1">                   </use></svg><span class="menu_word" style="font-size:17px"> å½±é™¢</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-youxishoubing">                   </use></svg><span class="menu_word" style="font-size:17px"> æ¸¸æˆ</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xiangzi"></use></svg><span class="menu_word" style="font-size:17px"> å…«å®ç®±</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/box/gallery/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-tubiaozhizuomoban">                   </use></svg><span class="menu_word" style="font-size:17px"> ç”»å»Š</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/animation/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-nvwumao">                   </use></svg><span class="menu_word" style="font-size:17px"> åŠ¨ç”»</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-zhifengche">                   </use></svg><span class="menu_word" style="font-size:17px"> ç½‘å€å¯¼èˆª</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> ç¤¾äº¤</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pengyouquan">                   </use></svg><span class="menu_word" style="font-size:17px"> æœ‹å‹åœˆ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> ç•™è¨€æ¿</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> å‹äººå¸</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangye"></use></svg><span class="menu_word" style="font-size:17px"> ç½‘ç«™</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/site/census/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--tongjibiao">                   </use></svg><span class="menu_word" style="font-size:17px"> ç½‘ç«™ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujutongji1">                   </use></svg><span class="menu_word" style="font-size:17px"> æ–‡ç« ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/time/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xianxingshalou">                   </use></svg><span class="menu_word" style="font-size:17px"> æ—§æ—¶å…‰</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">geqian's BlogğŸ­</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--article"></use></svg><span class="menu_word" style="font-size:17px"> æ–‡ç« </span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> å½’æ¡£</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> æ ‡ç­¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei">                   </use></svg><span class="menu_word" style="font-size:17px"> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pinweishenghuo"></use></svg><span class="menu_word" style="font-size:17px"> ä¼‘é—²</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/life/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-yinle">                   </use></svg><span class="menu_word" style="font-size:17px"> å…«éŸ³ç›’</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-dianying1">                   </use></svg><span class="menu_word" style="font-size:17px"> å½±é™¢</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-youxishoubing">                   </use></svg><span class="menu_word" style="font-size:17px"> æ¸¸æˆ</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xiangzi"></use></svg><span class="menu_word" style="font-size:17px"> å…«å®ç®±</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/box/gallery/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-tubiaozhizuomoban">                   </use></svg><span class="menu_word" style="font-size:17px"> ç”»å»Š</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/animation/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-nvwumao">                   </use></svg><span class="menu_word" style="font-size:17px"> åŠ¨ç”»</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-zhifengche">                   </use></svg><span class="menu_word" style="font-size:17px"> ç½‘å€å¯¼èˆª</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> ç¤¾äº¤</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pengyouquan">                   </use></svg><span class="menu_word" style="font-size:17px"> æœ‹å‹åœˆ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> ç•™è¨€æ¿</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> å‹äººå¸</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangye"></use></svg><span class="menu_word" style="font-size:17px"> ç½‘ç«™</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/site/census/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--tongjibiao">                   </use></svg><span class="menu_word" style="font-size:17px"> ç½‘ç«™ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujutongji1">                   </use></svg><span class="menu_word" style="font-size:17px"> æ–‡ç« ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/time/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xianxingshalou">                   </use></svg><span class="menu_word" style="font-size:17px"> æ—§æ—¶å…‰</span></a></li></ul></div></div><center id="name-container"><a id="page-name" href="javascript:scrollToTop()">PAGE_NAME</a></center><div id="nav-right"><div id="search-button"><a class="search faa-parent animated-hover" title="æ£€ç´¢ç«™å†…ä»»ä½•ä½ æƒ³è¦çš„ä¿¡æ¯"><svg class="faa-tada icon" style="height:24px;width:24px;fill:currentColor;position:relative;top:6px" aria-hidden="true"><use xlink:href="#icon-valentine_-search-love-find-heart"></use></svg><span> æœç´¢</span></a></div><a class="meihua faa-parent animated-hover" onclick="toggleWinbox()" title="ç¾åŒ–è®¾ç½®-è‡ªå®šä¹‰ä½ çš„é£æ ¼" id="meihua-button"><svg class="faa-tada icon" style="height:26px;width:26px;fill:currentColor;position:relative;top:8px" aria-hidden="true"><use xlink:href="#icon-tupian1"></use></svg></a><a class="sun_moon faa-parent animated-hover" onclick="switchNightMode()" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢" id="nightmode-button"><svg class="faa-tada" style="height:25px;width:25px;fill:currentColor;position:relative;top:7px" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon">       </use></svg></a><div id="toggle-menu"><a><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-info"><h1 class="post-title">ä»£ç ç”Ÿæˆå™¨è¯¦è§£</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><svg class="meta_icon post-meta-icon" style="width:30px;height:30px;position:relative;top:10px"><use xlink:href="#icon-rili"></use></svg><span class="post-meta-label">å‘è¡¨äº </span><time class="post-meta-date-created" datetime="2025-09-10T03:19:03.000Z" title="å‘è¡¨äº 2025-09-10 11:19:03">2025-09-10</time><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-gengxin1"></use></svg><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-09-10T23:03:00.000Z" title="æ›´æ–°äº 2025-09-11 07:03:00">2025-09-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-biaoqian"></use></svg><a class="post-meta-categories" href="/categories/%E9%A1%B9%E7%9B%AE/">é¡¹ç›®</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:8px"><use xlink:href="#icon-charuword"></use></svg><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">1.1w</span><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:20px;height:20px;position:relative;top:5px"><use xlink:href="#icon-shizhong"></use></svg><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>47åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ä»£ç ç”Ÿæˆå™¨è¯¦è§£"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:5px"><use xlink:href="#icon-eye"></use></svg><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>æˆ‘åœ¨æ•°æ®åº“easyliveåŠ å…¥äº†ä¸€å¼ è¡¨</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `user_info` (</span><br><span class="line">  `user_id` <span class="type">varchar</span>(<span class="number">12</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;ç”¨æˆ·ID&#x27;</span>,</span><br><span class="line">  `email` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;é‚®ç®±&#x27;</span>,</span><br><span class="line">  `nick_name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;æ˜µç§°&#x27;</span>,</span><br><span class="line">  `avatar` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;ç”¨æˆ·å¤´åƒ&#x27;</span>,</span><br><span class="line">  `<span class="keyword">password</span>` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;å¯†ç &#x27;</span>,</span><br><span class="line">  `status` tinyint(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;çŠ¶æ€&#x27;</span>,</span><br><span class="line">  `create_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `last_login_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;æœ€åç™»å½•æ—¶é—´&#x27;</span>,</span><br><span class="line">  `integral` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;ç§¯åˆ†&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`user_id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `idx_key_email` (`email`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE=InnoDB <span class="keyword">DEFAULT</span> CHARSET=utf8mb4 ROW_FORMAT=DYNAMIC <span class="keyword">COMMENT</span>=<span class="string">&#x27;ç”¨æˆ·ä¿¡æ¯&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆåçš„ä»£ç å°±æ˜¯easyliveä¸­çš„ä»£ç </p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/09/image-141-592x1024.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/09/image-142.png" alt="img"></p>
<p>æ¥ä¸‹æ¥æˆ‘å°†é€ä¸€è®²è§£easyjavaä»£ç ç”Ÿæˆå™¨ç”Ÿæˆçš„é‚£äº›ä»£ç </p>
<h2 id="1-POå®ä½“ç±»-UserInfo">1. POå®ä½“ç±»-<code>UserInfo</code></h2>
<h3 id="UserInfo-å®ä½“ç±»ï¼ˆPOï¼‰æ˜¯ä»€ä¹ˆ">UserInfo å®ä½“ç±»ï¼ˆPOï¼‰æ˜¯ä»€ä¹ˆ</h3>
<ul>
<li><strong>å®šä½</strong>ï¼š<code>POï¼ˆPersistence Objectï¼‰</code>ï¼Œç”¨äºå’Œæ•°æ®åº“è¡¨ <code>user_info</code> ä¸€ä¸€æ˜ å°„ï¼Œæ‰¿è½½å•è¡Œæ•°æ®ã€‚</li>
<li><strong>ä½œç”¨åœºæ™¯</strong>ï¼šMapper å±‚è¿”å›ã€Service/Controller åœ¨å…¥å‚ä¸å‡ºå‚ä¸­ä¼ é€’ã€åºåˆ—åŒ–åˆ° JSON è¿”å›ç»™å‰ç«¯ã€‚</li>
</ul>
<h3 id="å­—æ®µä¸è¡¨ç»“æ„çš„å¯¹åº”å…³ç³»ä¸æ„ä¹‰">å­—æ®µä¸è¡¨ç»“æ„çš„å¯¹åº”å…³ç³»ä¸æ„ä¹‰</h3>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_"><span class="keyword">class</span> <span class="title">UserInfo</span> <span class="keyword"><span class="keyword">implements</span> <span class="type">Serializable</span></span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * ç”¨æˆ·ID</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">String</span> userId;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * é‚®ç®±</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">String</span> email;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * æ˜µç§°</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">String</span> nickName;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * ç”¨æˆ·å¤´åƒ</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">String</span> avatar;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * å¯†ç </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">String</span> password;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * çŠ¶æ€</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Integer status;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * ç§¯åˆ†</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Integer integral;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * åˆ›å»ºæ—¶é—´</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@JsonFormat</span>(pattern = <span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>, timezone = <span class="string">&quot;GMT+8&quot;</span>)</span><br><span class="line">	<span class="meta">@DateTimeFormat</span>(pattern = <span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>)</span><br><span class="line">	<span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * æœ€åç™»å½•æ—¶é—´</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@JsonFormat</span>(pattern = <span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>, timezone = <span class="string">&quot;GMT+8&quot;</span>)</span><br><span class="line">	<span class="meta">@DateTimeFormat</span>(pattern = <span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>)</span><br><span class="line">	<span class="keyword">private</span> Date lastLoginTime;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>userIdï¼ˆvarchar(12) ä¸»é”®ï¼‰</strong>ï¼šä¸šåŠ¡ä¸»é”®ï¼Œå­—ç¬¦ä¸²å­˜å‚¨æ›´çµæ´»ï¼ˆå¯è‡ªå®šä¹‰/è·¨åº“å”¯ä¸€ï¼‰ã€‚</li>
<li><strong>emailï¼ˆvarchar(50)ï¼Œå”¯ä¸€ç´¢å¼•ï¼‰</strong>ï¼šç™»å½•/è”ç³»è´¦å·ï¼ŒDB å±‚å”¯ä¸€çº¦æŸï¼ˆåœ¨ XML/æ•°æ®åº“ä¾§ä½“ç°ï¼Œå®ä½“ä¸ç›´æ¥æ‰¿è½½çº¦æŸæ³¨è§£ï¼‰ã€‚</li>
<li><strong>nickNameï¼ˆvarchar(20)ï¼‰</strong>ï¼šæ˜µç§°ã€‚</li>
<li><strong>avatarï¼ˆvarchar(50)ï¼‰</strong>ï¼šå¤´åƒ URL/è·¯å¾„ã€‚</li>
<li><strong>passwordï¼ˆvarchar(32)ï¼‰</strong>ï¼šå¯†ç æ‘˜è¦ï¼ˆåº”ä¸ºåŠ å¯†åçš„æ‘˜è¦å€¼ï¼Œéæ˜æ–‡ï¼‰ã€‚</li>
<li><strong>statusï¼ˆtinyint(1)ï¼‰</strong>ï¼šçŠ¶æ€ä½ï¼ˆå¦‚ 0/1ï¼‰ï¼Œç”¨ <code>Integer</code> ä»¥ä¾¿è¡¨ç¤ºç©ºå€¼ã€‚</li>
<li><strong>createTimeã€lastLoginTimeï¼ˆdatetimeï¼‰</strong>ï¼šåˆ›å»º/æœ€åç™»å½•æ—¶é—´ã€‚</li>
<li><strong>integralï¼ˆint(11) é»˜è®¤0ï¼‰</strong>ï¼šç§¯åˆ†ï¼Œä¸šåŠ¡è®¡æ•°ã€‚</li>
</ul>
<h3 id="æ—¶é—´å­—æ®µçš„åºåˆ—åŒ–ä¸ç»‘å®š">æ—¶é—´å­—æ®µçš„åºåˆ—åŒ–ä¸ç»‘å®š</h3>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@JsonFormat</span>(pattern = <span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>, timezone = <span class="string">&quot;GMT+8&quot;</span>)</span><br><span class="line"><span class="variable">@DateTimeFormat</span>(pattern = <span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>)</span><br><span class="line">private Date createTime;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>@JsonFormat</strong>ï¼šæ§åˆ¶ JSON è¾“å‡ºæ ¼å¼ä¸æ—¶åŒºï¼ˆå‡ºå‚åºåˆ—åŒ–ï¼‰ã€‚</li>
<li><strong>@DateTimeFormat</strong>ï¼šæ§åˆ¶æ¥å£å…¥å‚ï¼ˆè¡¨å•/æŸ¥è¯¢å‚æ•°ï¼‰å‘ <code>Date</code> çš„è§£æï¼ˆå…¥å‚ç»‘å®šï¼‰ã€‚</li>
<li>æ¨¡å¼å›ºå®šä½¿ç”¨ <code>yyyy-MM-dd HH:mm:ss</code>ï¼Œä¸å‰ç«¯/DB æ—¶é—´å±•ç¤ºä¿æŒä¸€è‡´ã€‚</li>
</ul>
<h3 id="Getter-Setter-ä¸å¯ç©ºæ€§">Getter/Setter ä¸å¯ç©ºæ€§</h3>
<ul>
<li>ç”Ÿæˆäº†å®Œæ•´ Getter/Setterï¼Œä¾¿äº MyBatis åå°„æ˜ å°„ä¸ Spring ç»‘å®šã€‚</li>
<li>å­—æ®µå¤šä¸ºå¯ç©ºï¼ˆä¸ DDL é»˜è®¤ NULL å¯¹é½ï¼‰ï¼Œä¸šåŠ¡å±‚åº”åšéç©ºä¸èŒƒå›´æ ¡éªŒã€‚</li>
</ul>
<h3 id="å¯åºåˆ—åŒ–ä¸è·¨å±‚ä¼ è¾“">å¯åºåˆ—åŒ–ä¸è·¨å±‚ä¼ è¾“</h3>
<ul>
<li><code>implements Serializable</code>ï¼šä¾¿äºæ”¾å…¥ Session/ç¼“å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ä¼ è¾“æˆ–è¿œç¨‹è°ƒç”¨è¿”å›ã€‚</li>
</ul>
<h3 id="toString-ç”¨äºè°ƒè¯•ä¸æ—¥å¿—">toString ç”¨äºè°ƒè¯•ä¸æ—¥å¿—</h3>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line"><span class="built_in">public</span> String toString ()&#123;</span><br><span class="line">    <span class="keyword">return</span> &quot;ç”¨æˆ·ID:&quot;+(userId == <span class="keyword">null</span> ? &quot;ç©º&quot; : userId)+&quot;ï¼Œé‚®ç®±:&quot;+(email == <span class="keyword">null</span> ? &quot;ç©º&quot; : email)+&quot;ï¼Œæ˜µç§°:&quot;+(nickName == <span class="keyword">null</span> ? &quot;ç©º&quot; : nickName)+&quot;ï¼Œç”¨æˆ·å¤´åƒ:&quot;+(avatar == <span class="keyword">null</span> ? &quot;ç©º&quot; : avatar)+&quot;ï¼Œå¯†ç :&quot;+(<span class="keyword">password</span> == <span class="keyword">null</span> ? &quot;ç©º&quot; : <span class="keyword">password</span>)+&quot;ï¼ŒçŠ¶æ€:&quot;+(status == <span class="keyword">null</span> ? &quot;ç©º&quot; : status)+&quot;ï¼Œåˆ›å»ºæ—¶é—´:&quot;+(createTime == <span class="keyword">null</span> ? &quot;ç©º&quot; : DateUtil.format(createTime, DateTimePatternEnum.YYYY_MM_DD_HH_MM_SS.getPattern()))+&quot;ï¼Œæœ€åç™»å½•æ—¶é—´:&quot;+(lastLoginTime == <span class="keyword">null</span> ? &quot;ç©º&quot; : DateUtil.format(lastLoginTime, DateTimePatternEnum.YYYY_MM_DD_HH_MM_SS.getPattern()))+&quot;ï¼Œç§¯åˆ†:&quot;+(integral == <span class="keyword">null</span> ? &quot;ç©º&quot; : integral);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ä½¿ç”¨ <code>DateUtil.format</code> ä¸ <code>DateTimePatternEnum</code> ç»Ÿä¸€æ—¥æœŸæ ¼å¼ï¼Œé¿å… <code>null</code> å¯¼è‡´å¼‚å¸¸ã€‚</li>
<li>æ³¨æ„ï¼šè¿™é‡Œç›´æ¥è¾“å‡ºäº† <code>password</code>ï¼Œç”Ÿäº§æ—¥å¿—ä¸­å»ºè®®é¿å…æ‰“å°æ•æ„Ÿå­—æ®µã€‚</li>
</ul>
<h3 id="ä¸æŸ¥è¯¢å¯¹è±¡çš„åˆ†å·¥">ä¸æŸ¥è¯¢å¯¹è±¡çš„åˆ†å·¥</h3>
<ul>
<li><code>UserInfo</code> è¡¨ç¤ºâ€œä¸€è¡Œæ•°æ®â€çš„å®ä½“ã€‚</li>
<li><code>UserInfoQuery</code> è¡¨ç¤ºâ€œæŸ¥è¯¢æ¡ä»¶ä¸åˆ†é¡µâ€çš„æ¨¡å‹ï¼ˆå«æ¨¡ç³ŠåŒ¹é…ã€æ—¶é—´åŒºé—´ï¼‰ï¼Œä¸¤è€…èŒè´£åˆ†ç¦»ï¼Œä¾¿äºå¤ç”¨ã€‚</li>
</ul>
<h2 id="2-Queryï¼ˆæŸ¥è¯¢å¯¹è±¡ï¼‰-UserInfoQuery-BaseParam-SimplePage">2.Queryï¼ˆæŸ¥è¯¢å¯¹è±¡ï¼‰-UserInfoQuery/BaseParam/SimplePage</h2>
<h3 id="UserInfoQueryï¼ˆæŸ¥è¯¢å¯¹è±¡ï¼‰æ˜¯ä»€ä¹ˆ">UserInfoQueryï¼ˆæŸ¥è¯¢å¯¹è±¡ï¼‰æ˜¯ä»€ä¹ˆ</h3>
<ul>
<li><strong>å®šä½</strong>ï¼šæ‰¿è½½â€œæŸ¥è¯¢æ¡ä»¶ä¸åˆ†é¡µä¿¡æ¯â€çš„å¯¹è±¡ï¼ŒæœåŠ¡äºåˆ—è¡¨/æ£€ç´¢æ¥å£ã€‚</li>
<li><strong>ç»§æ‰¿å…³ç³»</strong>ï¼šç»§æ‰¿ <code>BaseParam</code>ï¼Œå¤©ç„¶åŒ…å«åˆ†é¡µä¸æ’åºèƒ½åŠ›ã€‚</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·ä¿¡æ¯å‚æ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">UserInfoQuery</span> <span class="keyword">extends</span> <span class="title">BaseParam</span> </span>&#123;</span><br></pre></td></tr></table></figure>
<h3 id="å­—æ®µè®¾è®¡ä¸æ„ä¹‰">å­—æ®µè®¾è®¡ä¸æ„ä¹‰</h3>
<ul>
<li><strong>ç²¾ç¡®åŒ¹é…å­—æ®µ</strong>ï¼š<code>userId</code>ã€<code>email</code>ã€<code>nickName</code>ã€<code>avatar</code>ã€<code>password</code>ã€<code>status</code>ã€<code>integral</code> ç­‰ï¼Œå¯¹åº”å®ä½“ä¸»å­—æ®µï¼›å½“è¿™äº›å­—æ®µéç©ºæ—¶ï¼Œé€šå¸¸åœ¨ XML ä¸­ä»¥ <code>=</code> ç²¾ç¡®åŒ¹é…ã€‚</li>
<li><strong>æ¨¡ç³ŠåŒ¹é…å­—æ®µ</strong>ï¼šä¸ºæ¯ä¸ªå­—ç¬¦ä¸²å‹å­—æ®µæä¾› <code>xxxFuzzy</code>ï¼ˆå¦‚ <code>emailFuzzy</code>ã€<code>nickNameFuzzy</code>ï¼‰ï¼Œç”¨äº <code>LIKE '%xxx%'</code>ã€‚</li>
<li><strong>æ—¶é—´åŒºé—´æŸ¥è¯¢</strong>ï¼š</li>
<li><code>createTimeStart</code>ã€<code>createTimeEnd</code> ç”¨äºåˆ›å»ºæ—¶é—´é—­åŒºé—´ï¼›</li>
<li><code>lastLoginTimeStart</code>ã€<code>lastLoginTimeEnd</code> ç”¨äºæœ€åç™»å½•æ—¶é—´é—­åŒºé—´ï¼›</li>
<li>è¿™äº›å­—æ®µåœ¨ XML ä¸­é€šå¸¸ä»¥ <code>&gt;=</code>ã€<code>&lt;=</code> æ¡ä»¶ç»„åˆå‡ºç°ã€‚</li>
</ul>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ›å»ºæ—¶é—´</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">String</span> createTime;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">String</span> createTimeStart;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">String</span> createTimeEnd;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æœ€åç™»å½•æ—¶é—´</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">String</span> lastLoginTime;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">String</span> lastLoginTimeStart;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">String</span> lastLoginTimeEnd;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>ä¸ºä½•ç”¨ String æ‰¿è½½æ—¶é—´</strong>ï¼šä¾¿äºå‰ç«¯ä¼ å‚ä¸å¤šæ ¼å¼å…¼å®¹ï¼ŒXML å†…éƒ¨å†æŒ‰å›ºå®šæ ¼å¼è§£ææˆ–ç›´æ¥ä½œä¸ºå­—ç¬¦ä¸²æ¡ä»¶æ‹¼æ¥ï¼ˆä»¥é¡¹ç›®çº¦å®šä¸ºå‡†ï¼‰ã€‚</li>
</ul>
<h3 id="BaseParamï¼ˆåˆ†é¡µä¸æ’åºåŸºç±»ï¼‰">BaseParamï¼ˆåˆ†é¡µä¸æ’åºåŸºç±»ï¼‰</h3>
<ul>
<li><strong>å­—æ®µ</strong>ï¼š</li>
<li><code>pageNo</code>ï¼šå½“å‰é¡µç ï¼ˆ1 å¼€å§‹ï¼‰</li>
<li><code>pageSize</code>ï¼šæ¯é¡µå¤§å°</li>
<li><code>orderBy</code>ï¼šæ’åºå­å¥ï¼ˆå¦‚ <code>&quot;create_time desc&quot;</code>ï¼‰</li>
<li><code>simplePage</code>ï¼šè®¡ç®—å¥½åç§»é‡çš„åˆ†é¡µå¯¹è±¡</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseParam</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">SimplePage</span> simplePage;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Integer</span> pageNo;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Integer</span> pageSize;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> orderBy;</span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">SimplePage</span> <span class="title function_">getSimplePage</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> simplePage;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>ä½¿ç”¨å»ºè®®</strong>ï¼š</li>
<li><code>orderBy</code> åº”åœ¨æœåŠ¡å±‚åšç™½åå•æ ¡éªŒï¼Œé¿å… SQL æ³¨å…¥ã€‚</li>
<li>æ§åˆ¶å±‚æŠŠ <code>pageNo/pageSize/orderBy</code> ç»„è£…è¿› <code>BaseParam</code>ï¼Œå†äº¤ç”±æœåŠ¡/Mapper ä½¿ç”¨ã€‚</li>
</ul>
<h3 id="SimplePageï¼ˆåˆ†é¡µæ ¸å¿ƒè®¡ç®—ï¼‰">SimplePageï¼ˆåˆ†é¡µæ ¸å¿ƒè®¡ç®—ï¼‰</h3>
<ul>
<li><strong>èŒè´£</strong>ï¼šä¾æ®æ€»æ•° <code>countTotal</code>ã€é¡µç  <code>pageNo</code>ã€æ¯é¡µå¤§å° <code>pageSize</code>ï¼Œè®¡ç®— <code>start</code>ï¼ˆoffsetï¼‰ã€<code>end</code>ï¼ˆlimit sizeï¼‰ã€<code>pageTotal</code>ã€‚</li>
<li><strong>é»˜è®¤ä¸æ”¶æ•›</strong>ï¼š</li>
<li>å½“ <code>pageSize &lt;= 0</code> æ—¶ï¼Œé»˜è®¤ä½¿ç”¨ <code>PageSize.SIZE20</code>ï¼›</li>
<li>å°† <code>pageNo</code> æ”¶æ•›åˆ° [1, pageTotal]ï¼›</li>
<li>è®¡ç®—å…¬å¼ï¼š<code>start = (pageNo - 1) * pageSize</code>ï¼Œ<code>end = pageSize</code>ã€‚</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> void action() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.pageSize &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.pageSize = PageSize.SIZE20.getSize();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.countTotal &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.pageTotal = <span class="keyword">this</span>.countTotal % <span class="keyword">this</span>.pageSize == <span class="number">0</span> ? <span class="keyword">this</span>.countTotal / <span class="keyword">this</span>.pageSize</span><br><span class="line">                : <span class="keyword">this</span>.countTotal / <span class="keyword">this</span>.pageSize + <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        pageTotal = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pageNo &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        pageNo = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (pageNo &gt; pageTotal) &#123;</span><br><span class="line">        pageNo = pageTotal;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.start = (pageNo - <span class="number">1</span>) * pageSize;</span><br><span class="line">    <span class="keyword">this</span>.end = <span class="keyword">this</span>.pageSize;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>å…¸å‹ç”¨æ³•</strong>ï¼š
<ol>
<li>å…ˆæŸ¥æ€»æ•° <code>countTotal</code>ï¼›2) ç”¨ <code>new SimplePage(pageNo, countTotal, pageSize)</code> è®¡ç®—ï¼›3) åœ¨åˆ—è¡¨æŸ¥è¯¢ä¸­ <code>LIMIT start, end</code>ã€‚</li>
</ol>
</li>
<li><strong>ç¤ºä¾‹</strong>ï¼šæ€»æ•° 105ã€<code>pageSize=20</code>ã€<code>pageNo=3</code> â†’ <code>pageTotal=6</code>ã€<code>start=40</code>ã€<code>end=20</code>ã€‚</li>
</ul>
<h3 id="æŸ¥è¯¢å¯¹è±¡çš„ä¸€èˆ¬ä½¿ç”¨æµ">æŸ¥è¯¢å¯¹è±¡çš„ä¸€èˆ¬ä½¿ç”¨æµ</h3>
<ol>
<li>æ§åˆ¶å±‚æ¥æ”¶ <code>UserInfoQuery</code>ï¼ˆåŒ…å«é¡µç ã€å¤§å°ã€æ’åºä¸ç­›é€‰æ¡ä»¶ï¼‰ã€‚</li>
<li>æœåŠ¡å±‚è¡¥å…¨æˆ–æ ¡éªŒæ¡ä»¶ï¼ˆå¦‚ <code>orderBy</code> ç™½åå•ã€æ—¶é—´æ ¼å¼ï¼‰ã€‚</li>
<li>Mapper XML è¯»å– <code>query</code> ä¸­çš„éç©ºå­—æ®µï¼ŒåŠ¨æ€æ‹¼æ¥ <code>WHERE</code> ä¸ <code>ORDER BY</code>ï¼Œå¹¶ä½¿ç”¨ <code>simplePage.start/end</code> åˆ†é¡µã€‚</li>
</ol>
<h2 id="3-UserInfoMapper-ä¸-XML">3. UserInfoMapper ä¸ XML</h2>
<h3 id="UserInfoMapperï¼ˆæ¥å£ï¼‰ä¸-UserInfoMapper-xmlï¼ˆSQLï¼‰æ˜¯ä»€ä¹ˆ">UserInfoMapperï¼ˆæ¥å£ï¼‰ä¸ UserInfoMapper.xmlï¼ˆSQLï¼‰æ˜¯ä»€ä¹ˆ</h3>
<ul>
<li><strong>å®šä½</strong>ï¼š<code>UserInfoMapper&lt;T,P&gt;</code> ç»§æ‰¿é€šç”¨ <code>BaseMapper&lt;T,P&gt;</code>ï¼Œå®šä¹‰äº†æŒ‰ä¸šåŠ¡é”®çš„å®šåˆ¶ CRUDï¼›<code>UserInfoMapper.xml</code> ä»¥ MyBatis åŠ¨æ€ SQL å®ç°è¿™äº›æ–¹æ³•ã€‚</li>
<li><strong>æ³›å‹</strong>ï¼š<code>T</code> ä¸ºå®ä½“ï¼ˆè¿™é‡Œç”¨ <code>UserInfo</code>ï¼‰ï¼Œ<code>P</code> ä¸ºæŸ¥è¯¢å¯¹è±¡ï¼ˆè¿™é‡Œç”¨ <code>UserInfoQuery</code>ï¼‰ã€‚</li>
</ul>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·ä¿¡æ¯ æ•°æ®åº“æ“ä½œæ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="symbol">UserInfoMapper</span>&lt;<span class="symbol">T</span>,<span class="symbol">P</span>&gt; <span class="symbol">extends</span> <span class="symbol">BaseMapper</span>&lt;<span class="symbol">T</span>,<span class="symbol">P</span>&gt; &#123;</span><br></pre></td></tr></table></figure>
<h3 id="å­—æ®µæ˜ å°„ä¸é€šç”¨åˆ—">å­—æ®µæ˜ å°„ä¸é€šç”¨åˆ—</h3>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å®ä½“æ˜ å°„--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;base_result_map&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.easylive.entity.po.UserInfo&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userId&quot;</span>  /&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- é€šç”¨æŸ¥è¯¢ç»“æœåˆ—--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;base_column_list&quot;</span>&gt;</span></span><br><span class="line">   u.user_id,u.email,u.nick_name,u.avatar,u.password,</span><br><span class="line">   u.status,u.create_time,u.last_login_time,u.integral</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å°†è¡¨å­—æ®µä¸å®ä½“å±æ€§ä¸€ä¸€å¯¹åº”ï¼Œç”¨äº <code>select</code> ç»“æœæ˜ å°„ã€‚</li>
</ul>
<h3 id="æ¡ä»¶æ„é€ ï¼ˆç²¾ç¡®ã€æ¨¡ç³Šã€æ—¶é—´åŒºé—´ï¼‰">æ¡ä»¶æ„é€ ï¼ˆç²¾ç¡®ã€æ¨¡ç³Šã€æ—¶é—´åŒºé—´ï¼‰</h3>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;base_condition_filed&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.userId != null and query.userId!=&#x27;&#x27;&quot;</span>&gt;</span> and u.user_id = #</span><span class="template-variable">&#123;query.userId&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  ...</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.createTime != null and query.createTime!=&#x27;&#x27;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &lt;![CDATA[ and  u.create_time=str_to_date(#</span><span class="template-variable">&#123;query.createTime&#125;</span><span class="language-xml">, &#x27;%Y-%m-%d&#x27;) ]]&gt;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;query_condition&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> <span class="tag">&lt;<span class="name">where</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;base_condition_filed&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.emailFuzzy!= null  and query.emailFuzzy!=&#x27;&#x27;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     and u.email like concat(&#x27;%&#x27;, #</span><span class="template-variable">&#123;query.emailFuzzy&#125;</span><span class="language-xml">, &#x27;%&#x27;)</span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">   ...</span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.createTimeEnd!= null and query.createTimeEnd!=&#x27;&#x27;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     &lt;![CDATA[ and  u.create_time&lt; date_sub(str_to_date(#</span><span class="template-variable">&#123;query.createTimeEnd&#125;</span><span class="language-xml">,&#x27;%Y-%m-%d&#x27;),interval -1 day) ]]&gt;</span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>ç²¾ç¡®åŒ¹é…ï¼šç›´æ¥ <code>=</code>ã€‚</li>
<li>æ¨¡ç³ŠåŒ¹é…ï¼š<code>like concat('%', #&#123;...&#125;, '%')</code>ã€‚</li>
<li>æ—¶é—´ç‚¹ä¸åŒºé—´ï¼šå°†å­—ç¬¦ä¸²è½¬æ—¥æœŸæ¯”è¾ƒï¼›åŒºé—´ä¸Šç•Œä½¿ç”¨ <code>&lt; date_sub(..., interval -1 day)</code> å®ç°å«å½“æ—¥çš„é—­åŒºé—´ã€‚</li>
</ul>
<h3 id="åˆ—è¡¨ä¸è®¡æ•°ï¼ˆåˆ†é¡µä¸æ’åºï¼‰">åˆ—è¡¨ä¸è®¡æ•°ï¼ˆåˆ†é¡µä¸æ’åºï¼‰</h3>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectList&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;base_result_map&quot;</span> &gt;</span></span></span><br><span class="line"><span class="language-xml">  SELECT <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;base_column_list&quot;</span> /&gt;</span> FROM user_info u <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;query_condition&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.orderBy!=null&quot;</span>&gt;</span> order by $</span><span class="template-variable">&#123;query.orderBy&#125;</span><span class="language-xml"> <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.simplePage!=null&quot;</span>&gt;</span> limit #</span><span class="template-variable">&#123;query.simplePage.start&#125;</span><span class="language-xml">,#</span><span class="template-variable">&#123;query.simplePage.end&#125;</span><span class="language-xml"> <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>order by $&#123;query.orderBy&#125;</code> ä½¿ç”¨å ä½ç¬¦æ‹¼æ¥ï¼ŒåŠ¡å¿…ä¸šåŠ¡ä¾§åšç™½åå•æ ¡éªŒã€‚</li>
<li>åˆ†é¡µåŸºäº <code>SimplePage.start/end</code>ã€‚</li>
</ul>
<h3 id="æ’å…¥ä¸æ’å…¥æˆ–æ›´æ–°">æ’å…¥ä¸æ’å…¥æˆ–æ›´æ–°</h3>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;insert id<span class="operator">=</span><span class="string">&quot;insert&quot;</span> parameterType<span class="operator">=</span><span class="string">&quot;com.easylive.entity.po.UserInfo&quot;</span>&gt;</span><br><span class="line">  INSERT INTO user_info</span><br><span class="line">  &lt;trim prefix<span class="operator">=</span><span class="string">&quot;(&quot;</span> suffix<span class="operator">=</span><span class="string">&quot;)&quot;</span> suffixOverrides<span class="operator">=</span><span class="string">&quot;,&quot;</span>&gt; ... &lt;/trim&gt;</span><br><span class="line">  &lt;trim prefix<span class="operator">=</span><span class="string">&quot;values (&quot;</span> suffix<span class="operator">=</span><span class="string">&quot;)&quot;</span> suffixOverrides<span class="operator">=</span><span class="string">&quot;,&quot;</span>&gt; ... &lt;/trim&gt;</span><br><span class="line">&lt;/insert&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>ä»…æ’å…¥éç©ºå­—æ®µï¼Œå‡å°‘é»˜è®¤å€¼å†²çªã€‚</li>
</ul>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">insert</span> id=<span class="string">&quot;insertOrUpdate&quot;</span> ...&gt;</span><br><span class="line">  <span class="keyword">INSERT</span> <span class="keyword">INTO</span> user_info (...) <span class="keyword">values</span> (...)</span><br><span class="line">  <span class="keyword">on</span> DUPLICATE <span class="keyword">key</span> <span class="keyword">update</span> </span><br><span class="line">  &lt;<span class="built_in">trim</span> ...&gt; ä»…å¯¹éç©ºå­—æ®µè¿›è¡Œæ›´æ–° &lt;/<span class="built_in">trim</span>&gt;</span><br><span class="line">&lt;/<span class="keyword">insert</span>&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>åŸºäºå”¯ä¸€é”®ï¼ˆå¦‚ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼• <code>email</code>ï¼‰å®ç° UPSERTï¼Œä¸”åªæ›´æ–°ä¼ å…¥éç©ºå­—æ®µã€‚</li>
</ul>
<h3 id="æ‰¹é‡æ’å…¥ä¸æ‰¹é‡-UPSERT">æ‰¹é‡æ’å…¥ä¸æ‰¹é‡ UPSERT</h3>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">insert</span> id=<span class="string">&quot;insertBatch&quot;</span>&gt; ... &lt;foreach <span class="keyword">collection</span>=<span class="string">&quot;list&quot;</span> item=<span class="string">&quot;item&quot;</span> separator=<span class="string">&quot;,&quot;</span>&gt; (...) &lt;/foreach&gt; &lt;/<span class="keyword">insert</span>&gt;</span><br><span class="line">&lt;<span class="keyword">insert</span> id=<span class="string">&quot;insertOrUpdateBatch&quot;</span>&gt; ... <span class="keyword">on</span> DUPLICATE <span class="keyword">key</span> <span class="keyword">update</span> ... &lt;/<span class="keyword">insert</span>&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>é€‚ç”¨äºå¯¼å…¥æˆ–åŒæ­¥åœºæ™¯ï¼ŒUPSERT ä¼šè¦†ç›–å†²çªè¡Œçš„å­—æ®µå€¼ã€‚</li>
</ul>
<h3 id="æ¡ä»¶æ›´æ–°ä¸åˆ é™¤">æ¡ä»¶æ›´æ–°ä¸åˆ é™¤</h3>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">update</span> id=<span class="string">&quot;updateByParam&quot;</span> parameterType=<span class="string">&quot;com.easylive.entity.query.UserInfoQuery&quot;</span>&gt;</span><br><span class="line">  <span class="keyword">UPDATE</span> user_info u</span><br><span class="line">  &lt;<span class="keyword">set</span>&gt; ä»…å¯¹ bean éç©ºå­—æ®µèµ‹å€¼ &lt;/<span class="keyword">set</span>&gt;</span><br><span class="line">  &lt;<span class="keyword">include</span> refid=<span class="string">&quot;query_condition&quot;</span> /&gt;</span><br><span class="line">&lt;/<span class="keyword">update</span>&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>bean</code> æ˜¯è¦èµ‹å€¼çš„æ–°å†…å®¹ï¼Œ<code>query</code> æ˜¯è¿‡æ»¤æ¡ä»¶ã€‚åˆ é™¤åŒç†ç”¨ <code>&lt;delete&gt;</code>ã€‚</li>
</ul>
<h3 id="æŒ‰ä¸šåŠ¡é”®çš„å®šåˆ¶æ–¹æ³•">æŒ‰ä¸šåŠ¡é”®çš„å®šåˆ¶æ–¹æ³•</h3>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">update</span> id=<span class="string">&quot;updateByUserId&quot;</span>&gt; ... <span class="keyword">where</span> user_id=#&#123;userId&#125; &lt;/<span class="keyword">update</span>&gt;</span><br><span class="line">&lt;<span class="keyword">delete</span> id=<span class="string">&quot;deleteByUserId&quot;</span>&gt; <span class="keyword">delete</span> <span class="keyword">from</span> user_info <span class="keyword">where</span> user_id=#&#123;userId&#125; &lt;/<span class="keyword">delete</span>&gt;</span><br><span class="line">&lt;<span class="keyword">select</span> id=<span class="string">&quot;selectByUserId&quot;</span>&gt; <span class="keyword">select</span> ... <span class="keyword">where</span> user_id=#&#123;userId&#125; &lt;/<span class="keyword">select</span>&gt;</span><br><span class="line">&lt;<span class="keyword">update</span> id=<span class="string">&quot;updateByEmail&quot;</span>&gt; ... <span class="keyword">where</span> email=#&#123;email&#125; &lt;/<span class="keyword">update</span>&gt;</span><br><span class="line">&lt;<span class="keyword">delete</span> id=<span class="string">&quot;deleteByEmail&quot;</span>&gt; <span class="keyword">delete</span> <span class="keyword">from</span> user_info <span class="keyword">where</span> email=#&#123;email&#125; &lt;/<span class="keyword">delete</span>&gt;</span><br><span class="line">&lt;<span class="keyword">select</span> id=<span class="string">&quot;selectByEmail&quot;</span>&gt; <span class="keyword">select</span> ... <span class="keyword">where</span> email=#&#123;email&#125; &lt;/<span class="keyword">select</span>&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸æ¥å£ <code>UserInfoMapper</code> ä¸Šçš„æ–¹æ³•ä¸€ä¸€å¯¹åº”ã€‚</li>
</ul>
<p>æœ¬æ è¦ç‚¹ï¼šæ¥å£å£°æ˜ä¸ XML åŠ¨æ€ SQL å¯¹åº”ä¸€è‡´ï¼›<code>query_condition</code> ç»Ÿä¸€ç®¡ç†æ¡ä»¶ï¼›åˆ†é¡µä¸æ’åºé€šè¿‡ <code>BaseParam/SimplePage</code> æ³¨å…¥ï¼›æä¾›æŒ‰ä¸»é”®ä¸å”¯ä¸€é”®çš„ä¾¿æ· CRUDï¼›æ‰¹é‡ä¸ UPSERT æ”¯æŒé«˜æ•ˆå¯¼å…¥ä¸è¦†ç›–ã€‚</p>
<h2 id="4è®²è§£åŸºç¡€-Mapperï¼ˆBaseMapperã€BaseMapperTableSplitï¼‰">4è®²è§£åŸºç¡€ Mapperï¼ˆBaseMapperã€BaseMapperTableSplitï¼‰</h2>
<h3 id="BaseMapper-æ˜¯ä»€ä¹ˆï¼ˆé€šç”¨-Mapper-æ¥å£ï¼‰">BaseMapper æ˜¯ä»€ä¹ˆï¼ˆé€šç”¨ Mapper æ¥å£ï¼‰</h3>
<ul>
<li><strong>å®šä½</strong>ï¼šä¸ºæ‰€æœ‰å®ä½“æä¾›ç»Ÿä¸€çš„ CRUD æ¥å£å®šä¹‰ï¼Œå‡å°‘æ¯å¼ è¡¨é‡å¤ä»£ç ã€‚</li>
<li><strong>æ³›å‹</strong>ï¼š<code>T</code> ä¸ºå®ä½“ç±»å‹ï¼ˆå¦‚ <code>UserInfo</code>ï¼‰ï¼Œ<code>P</code> ä¸ºæŸ¥è¯¢å¯¹è±¡ï¼ˆå¦‚ <code>UserInfoQuery</code>ï¼‰ã€‚</li>
<li><strong>å‚æ•°å‘½åè§„èŒƒ</strong>ï¼šé€šè¿‡ <code>@Param(&quot;bean&quot;)</code>ã€<code>@Param(&quot;query&quot;)</code> çº¦å®š MyBatis XML ä¸­çš„å–å€¼è·¯å¾„ã€‚</li>
</ul>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="symbol">BaseMapper</span>&lt;<span class="symbol">T</span>, <span class="symbol">P</span>&gt; &#123;</span><br><span class="line">   <span class="comment">/** selectList:(æ ¹æ®å‚æ•°æŸ¥è¯¢é›†åˆ) */</span></span><br><span class="line">   List&lt;T&gt; selectList(@Param(<span class="string">&quot;query&quot;</span>) P p);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>æ ¸å¿ƒæ–¹æ³•è¯´æ˜</strong>ï¼š</li>
<li><code>selectList(P query)</code>ï¼šæŒ‰æ¡ä»¶è¿”å›åˆ—è¡¨ï¼Œé€šå¸¸é…åˆåˆ†é¡µã€‚</li>
<li><code>selectCount(P query)</code>ï¼šç»Ÿè®¡æ€»æ•°ï¼Œç”¨äºåˆ†é¡µæ€»é¡µæ•°è®¡ç®—ã€‚</li>
<li><code>insert(T bean)</code>ï¼šæ’å…¥ï¼ˆä¸€èˆ¬ä¸ºâ€œéç©ºå­—æ®µæ’å…¥â€åŠ¨æ€ SQLï¼‰ã€‚</li>
<li><code>insertOrUpdate(T bean)</code>ï¼šå­˜åœ¨åˆ™æ›´æ–°ï¼Œä¸å­˜åœ¨åˆ™æ’å…¥ï¼ˆä¾èµ–å”¯ä¸€çº¦æŸï¼‰ã€‚</li>
<li><code>insertBatch(List&lt;T&gt;)</code>ï¼šæ‰¹é‡æ’å…¥ã€‚</li>
<li><code>insertOrUpdateBatch(List&lt;T&gt;)</code>ï¼šæ‰¹é‡ UPSERTã€‚</li>
<li><code>updateByParam(T bean, P query)</code>ï¼šå°†ç¬¦åˆæ¡ä»¶çš„è®°å½•æ›´æ–°ä¸º <code>bean</code> éç©ºå­—æ®µå€¼ã€‚</li>
<li><code>deleteByParam(P query)</code>ï¼šæŒ‰æ¡ä»¶åˆ é™¤ã€‚</li>
<li><strong>è®¾è®¡ä¼˜ç‚¹</strong>ï¼šç»Ÿä¸€æ–¹æ³•å‘½åä¸å‚æ•°è§„èŒƒï¼Œæ‰€æœ‰å…·ä½“è¡¨çš„ Mapper éƒ½èƒ½ç›´æ¥å¤ç”¨ï¼›XML å¯ä»¥å…±ç”¨ä¸€å¥—åŠ¨æ€ SQL æ¨¡ç‰ˆæ€æƒ³ï¼ˆæˆ–ç”±ä»£ç ç”Ÿæˆå™¨ç”Ÿæˆï¼‰ã€‚</li>
</ul>
<h3 id="BaseMapperTableSplit-æ˜¯ä»€ä¹ˆï¼ˆåˆ†è¡¨åœºæ™¯çš„é€šç”¨-Mapperï¼‰">BaseMapperTableSplit æ˜¯ä»€ä¹ˆï¼ˆåˆ†è¡¨åœºæ™¯çš„é€šç”¨ Mapperï¼‰</h3>
<ul>
<li><strong>å®šä½</strong>ï¼šä¸ <code>BaseMapper</code> åŠŸèƒ½ç›¸åŒï¼Œä½†å¤šäº† <code>tableName</code> ä½œä¸ºæ˜¾å¼å…¥å‚ï¼Œæ”¯æŒè¿è¡Œæ—¶åŠ¨æ€æŒ‡å®šç‰©ç†è¡¨åï¼ˆå¦‚ <code>user_info_2025</code>ï¼‰ã€‚</li>
<li><strong>æ³›å‹</strong>ï¼šåŒ <code>BaseMapper</code>ã€‚</li>
<li><strong>å‚æ•°å‘½åè§„èŒƒ</strong>ï¼šå¢åŠ  <code>@Param(&quot;tableName&quot;) String tableName</code>ã€‚</li>
</ul>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_"><span class="keyword">interface</span> <span class="title">BaseMapperTableSplit</span>&lt;<span class="title">T</span>, <span class="title">P</span>&gt; </span>&#123;</span><br><span class="line">   <span class="comment">/** selectList:(æ ¹æ®å‚æ•°æŸ¥è¯¢é›†åˆ) */</span></span><br><span class="line">   List&lt;T&gt; selectList(<span class="meta">@Param</span>(<span class="string">&quot;tableName&quot;</span>)<span class="keyword">String</span> tableName,<span class="meta">@Param</span>(<span class="string">&quot;query&quot;</span>) P p);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>æ ¸å¿ƒæ–¹æ³•è¯´æ˜</strong>ï¼šä¸ <code>BaseMapper</code> ä¸€ä¸€å¯¹åº”ï¼Œåªæ˜¯å¤šäº† <code>tableName</code>ã€‚</li>
<li>ä¾‹å¦‚ <code>selectList(tableName, query)</code>ã€<code>insert(tableName, bean)</code>ã€<code>updateByParam(tableName, bean, query)</code> ç­‰ã€‚</li>
<li><strong>XML ä½¿ç”¨ç‰¹å¾</strong>ï¼š</li>
<li>SQL ä¸­è¡¨åä½ç½®å†™æˆ <code>$&#123;tableName&#125;</code>ï¼ˆå­—ç¬¦ä¸²æ›¿æ¢ï¼‰ï¼Œå› æ­¤å¿…é¡»åœ¨æœåŠ¡å±‚ä¸¥æ ¼æ ¡éªŒ <code>tableName</code> ç™½åå•ï¼Œé¿å… SQL æ³¨å…¥ã€‚</li>
<li>å…¶å®ƒå‚æ•°å¯ç»§ç»­ä½¿ç”¨ <code>#&#123;&#125;</code> å®‰å…¨å ä½ç¬¦ã€‚</li>
</ul>
<h3 id="ä¸¤è€…å¦‚ä½•ååŒä»£ç ç”Ÿæˆ">ä¸¤è€…å¦‚ä½•ååŒä»£ç ç”Ÿæˆ</h3>
<ul>
<li>å¸¸è§„è¡¨ï¼šç”Ÿæˆ <code>XXXMapper extends BaseMapper&lt;PO, Query&gt;</code> ä¸å¯¹åº” XMLã€‚</li>
<li>åˆ†è¡¨è¡¨ï¼šç”Ÿæˆ <code>XXXMapper extends BaseMapperTableSplit&lt;PO, Query&gt;</code> ä¸å¯¹åº” XMLï¼Œåœ¨è¿è¡ŒæœŸä¼ å…¥è·¯ç”±åçš„çœŸå®è¡¨åã€‚</li>
<li>æœ¬æ è¦ç‚¹ï¼š<code>BaseMapper</code> æŠ½è±¡é€šç”¨ CRUDï¼›<code>BaseMapperTableSplit</code> åœ¨æ­¤åŸºç¡€ä¸Šå¼•å…¥ <code>tableName</code> ä»¥æ”¯æŒåˆ†è¡¨è·¯ç”±ï¼›å‚æ•°å‘½åç»Ÿä¸€ï¼Œä¾¿äº XML å–å€¼ä¸ä»£ç ç”Ÿæˆå™¨æ‰¹é‡å¥—ç”¨ã€‚</li>
</ul>
<h2 id="5-Serviceå±‚">5.Serviceå±‚</h2>
<h3 id="UserInfoServiceï¼ˆæ¥å£ï¼‰æ˜¯ä»€ä¹ˆ">UserInfoServiceï¼ˆæ¥å£ï¼‰æ˜¯ä»€ä¹ˆ</h3>
<ul>
<li><strong>å®šä½</strong>ï¼šå®šä¹‰é¢å‘ä¸šåŠ¡çš„ç”¨æˆ·ä¿¡æ¯æœåŠ¡èƒ½åŠ›ï¼Œå¯¹å¤–å±è”½åº•å±‚ Mapper ç»†èŠ‚ã€‚</li>
<li><strong>æ–¹æ³•åˆ†ç»„</strong>ï¼š</li>
<li>æŸ¥è¯¢ï¼š<code>findListByParam</code>ã€<code>findCountByParam</code>ã€<code>findListByPage</code></li>
<li>æ–°å¢ï¼š<code>add</code>ã€<code>addBatch</code>ã€<code>addOrUpdateBatch</code></li>
<li>æ¡ä»¶æ›´æ–°/åˆ é™¤ï¼š<code>updateByParam</code>ã€<code>deleteByParam</code></li>
<li>ä¸šåŠ¡é”®ä¾¿æ·æ–¹æ³•ï¼š<code>get/update/deleteByUserId</code> ä¸ <code>get/update/deleteByEmail</code></li>
</ul>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·ä¿¡æ¯ ä¸šåŠ¡æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="symbol">UserInfoService</span> &#123;</span><br></pre></td></tr></table></figure>
<h3 id="UserInfoServiceImplï¼ˆå®ç°ï¼‰åšäº†ä»€ä¹ˆ">UserInfoServiceImplï¼ˆå®ç°ï¼‰åšäº†ä»€ä¹ˆ</h3>
<ul>
<li><strong>ä¾èµ–æ³¨å…¥</strong>ï¼š<code>@Resource UserInfoMapper&lt;UserInfo, UserInfoQuery&gt;</code>ï¼Œè°ƒç”¨åº•å±‚é€šç”¨ CRUDã€‚</li>
<li><strong>åˆ†é¡µç¼–æ’</strong>ï¼š</li>
<li>å…ˆ <code>selectCount</code> å¾—åˆ°æ€»æ•°ï¼›</li>
<li>è®¡ç®— <code>pageSize</code>ï¼ˆé»˜è®¤ <code>PageSize.SIZE15</code>ï¼‰ï¼›</li>
<li>æ„å»º <code>SimplePage</code> å†™å›åˆ° <code>param</code>ï¼›</li>
<li>å†æŒ‰æ¡ä»¶æŸ¥åˆ—è¡¨ï¼Œå°è£… <code>PaginationResultVO</code> è¿”å›ã€‚</li>
</ul>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> PaginationResultVO&lt;UserInfo&gt; findListByPage(UserInfoQuery param) &#123;</span><br><span class="line">    <span class="built_in">int</span> <span class="keyword">count</span> = <span class="keyword">this</span>.findCountByParam(param);</span><br><span class="line">    <span class="built_in">int</span> pageSize = param.getPageSize() == <span class="literal">null</span> ? PageSize.SIZE15.getSize() : param.getPageSize();</span><br><span class="line"></span><br><span class="line">    SimplePage page = <span class="keyword">new</span> SimplePage(param.getPageNo(), <span class="keyword">count</span>, pageSize);</span><br><span class="line">    param.setSimplePage(page);</span><br><span class="line">    List&lt;UserInfo&gt; list = <span class="keyword">this</span>.findListByParam(param);</span><br><span class="line">    PaginationResultVO&lt;UserInfo&gt; result = <span class="keyword">new</span> PaginationResultVO(<span class="keyword">count</span>, page.getPageSize(), page.getPageNo(), page.getPageTotal(), list);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>æ‰¹é‡ç©ºé›†åˆçŸ­è·¯</strong>ï¼š<code>addBatch</code>ã€<code>addOrUpdateBatch</code> åœ¨ç©ºé›†åˆæ—¶ç›´æ¥è¿”å› 0ï¼Œé¿å…è½åº“ã€‚</li>
<li><strong>å®‰å…¨æ ¡éªŒ</strong>ï¼šåœ¨ <code>updateByParam</code>ã€<code>deleteByParam</code> å‰è°ƒç”¨ <code>StringTools.checkParam(param)</code>ï¼Œé€šå¸¸ç”¨äºé¿å…æ— æ¡ä»¶æ›´æ–°/åˆ é™¤ã€‚</li>
<li><strong>ä¾¿æ·æ–¹æ³•</strong>ï¼šæŒ‰ <code>userId</code>ã€<code>email</code> æŸ¥è¯¢/æ›´æ–°/åˆ é™¤ï¼Œä¸ <code>UserInfoMapper.xml</code> çš„å®šåˆ¶ SQL ä¸€ä¸€å¯¹åº”ã€‚</li>
<li>æœ¬æ è¦ç‚¹ï¼šService å±‚å¯¹åˆ†é¡µåšç¼–æ’ã€å¯¹å±é™©æ“ä½œåšå‰ç½®æ ¡éªŒã€å¯¹å¤–æä¾›è¯­ä¹‰åŒ–æ–¹æ³•ï¼Œå¹¶æŠŠé€šç”¨ Mapper èƒ½åŠ›è½¬åŒ–ä¸ºä¸šåŠ¡å‹å¥½çš„æ¥å£ã€‚</li>
</ul>
<h2 id="6-Controllerå±‚">6.Controllerå±‚</h2>
<h3 id="UserInfoControllerï¼ˆæ¥å£è®¾è®¡ä¸å…¥å‚å‡ºå‚ï¼‰">UserInfoControllerï¼ˆæ¥å£è®¾è®¡ä¸å…¥å‚å‡ºå‚ï¼‰</h3>
<ul>
<li><strong>ç±»ä¸è·¯ç”±</strong></li>
<li><code>@RestController(&quot;userInfoController&quot;)</code> + <code>@RequestMapping(&quot;/userInfo&quot;)</code>ï¼Œæ‰€æœ‰æ¥å£å‰ç¼€ä¸º <code>/userInfo</code>ã€‚</li>
<li>ç»§æ‰¿ <code>ABaseController</code>ï¼Œç»Ÿä¸€ä½¿ç”¨ <code>getSuccessResponseVO</code> è¿”å›æ ‡å‡†å“åº”ã€‚</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span>(<span class="string">&quot;userInfoController&quot;</span>)</span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">&quot;/userInfo&quot;</span>)</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">UserInfoController</span> <span class="keyword">extends</span> <span class="title">ABaseController</span></span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">UserInfoService</span> userInfoService;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>åˆ†é¡µæŸ¥è¯¢</strong></li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(<span class="string">&quot;/loadDataList&quot;</span>)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVO loadDataList(UserInfoQuery query)&#123;</span><br><span class="line">    <span class="keyword">return</span> getSuccessResponseVO(userInfoService.findListByPage(query));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å…¥å‚ä¸º <code>UserInfoQuery</code>ï¼ˆè¡¨å•/æŸ¥è¯¢å‚æ•°ç»‘å®šï¼‰ï¼Œå‡ºå‚ä¸º <code>ResponseVO&lt;PaginationResultVO&lt;UserInfo&gt;&gt;</code>ã€‚</li>
<li><strong>æ–°å¢/æ‰¹é‡</strong></li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(<span class="string">&quot;/add&quot;</span>)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVO add(UserInfo bean) &#123;</span><br><span class="line">    userInfoService.add(bean);</span><br><span class="line">    <span class="keyword">return</span> getSuccessResponseVO(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@RequestMapping(<span class="string">&quot;/addBatch&quot;</span>)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVO addBatch(<span class="meta">@RequestBody</span> List&lt;UserInfo&gt; listBean) &#123;</span><br><span class="line">    userInfoService.addBatch(listBean);</span><br><span class="line">    <span class="keyword">return</span> getSuccessResponseVO(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å•æ¡æ–°å¢èµ°è¡¨å•ç»‘å®šï¼›æ‰¹é‡æ–°å¢ç”¨ <code>@RequestBody</code> æ¥æ”¶ JSON æ•°ç»„ã€‚</li>
<li><strong>æ‰¹é‡æ–°å¢/ä¿®æ”¹ï¼ˆUPSERTï¼‰</strong></li>
</ul>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@RequestMapping</span>(<span class="string">&quot;/addOrUpdateBatch&quot;</span>)</span><br><span class="line">public ResponseVO <span class="built_in">addOrUpdateBatch</span>(<span class="variable">@RequestBody</span> List&lt;UserInfo&gt; listBean) &#123;</span><br><span class="line">    <span class="selector-tag">userInfoService</span><span class="selector-class">.addBatch</span>(listBean);</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">getSuccessResponseVO</span>(null);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ³¨æ„ï¼šè¿™é‡Œè°ƒç”¨äº† <code>addBatch</code>ï¼ŒæŒ‰è¯­ä¹‰åº”è°ƒç”¨ <code>addOrUpdateBatch</code>ï¼ˆå¯èƒ½æ˜¯å°ç–æ¼ï¼‰ã€‚</li>
<li><strong>æŒ‰ä¸šåŠ¡é”®çš„ä¾¿æ·æ¥å£</strong></li>
<li><code>get/update/deleteUserInfoByUserId</code></li>
<li><code>get/update/deleteUserInfoByEmail</code></li>
<li>æ›´æ–°æ¥å£å…¥å‚ <code>UserInfo bean</code> åªéœ€ä¼ éœ€è¦å˜æ›´çš„éç©ºå­—æ®µï¼›æŸ¥è¯¢/åˆ é™¤é€šè¿‡ç®€å•å­—ç¬¦ä¸²å‚æ•°æ¥æ”¶ã€‚</li>
</ul>
<h3 id="ABaseControllerï¼ˆç»Ÿä¸€å“åº”åŒ…è£…ï¼‰">ABaseControllerï¼ˆç»Ÿä¸€å“åº”åŒ…è£…ï¼‰</h3>
<ul>
<li>æä¾›æˆåŠŸã€ä¸šåŠ¡å¼‚å¸¸ã€æœåŠ¡ç«¯å¼‚å¸¸çš„å¿«æ·å°è£…ï¼›çŠ¶æ€å­—æ®µä½¿ç”¨ <code>status/code/info/data</code> å››å…ƒç»„ã€‚</li>
</ul>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">protected &lt;T&gt; ResponseVO getSuccessResponseVO(T t) &#123;</span><br><span class="line">    ResponseVO&lt;T&gt; responseVO <span class="operator">=</span> new ResponseVO&lt;&gt;()<span class="comment">;</span></span><br><span class="line">    responseVO.setStatus(STATUC_SUCCESS)<span class="comment">;</span></span><br><span class="line">    responseVO.setCode(ResponseCodeEnum.CODE_200.getCode())<span class="comment">;</span></span><br><span class="line">    responseVO.setInfo(ResponseCodeEnum.CODE_200.getMsg())<span class="comment">;</span></span><br><span class="line">    responseVO.setData(t)<span class="comment">;</span></span><br><span class="line">    return responseVO<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="AGlobalExceptionHandlerControllerï¼ˆå…¨å±€å¼‚å¸¸å¤„ç†ï¼‰">AGlobalExceptionHandlerControllerï¼ˆå…¨å±€å¼‚å¸¸å¤„ç†ï¼‰</h3>
<ul>
<li>ç»Ÿä¸€æ•è·å¼‚å¸¸å¹¶è½¬ä¸ºæ ‡å‡†å“åº”ï¼Œä¸”è®°å½•é”™è¯¯æ—¥å¿—ã€‚</li>
<li>404 â†’ <code>CODE_404</code></li>
<li>ä¸šåŠ¡å¼‚å¸¸ â†’ <code>CODE_600</code> æˆ–è‡ªå®šä¹‰</li>
<li>å‚æ•°ç»‘å®š/ç±»å‹é”™è¯¯ â†’ <code>CODE_600</code></li>
<li>å”¯ä¸€é”®å†²çª â†’ <code>CODE_601</code></li>
<li>å…¶å®ƒ â†’ <code>CODE_500</code></li>
</ul>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AGlobalExceptionHandlerController</span> <span class="keyword">extends</span> <span class="title">ABaseController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(AGlobalExceptionHandlerController.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(value = Exception.class)</span><br><span class="line">    <span class="function">Object <span class="title">handleException</span><span class="params">(Exception e, HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        logger.<span class="keyword">error</span>(<span class="string">&quot;è¯·æ±‚é”™è¯¯ï¼Œè¯·æ±‚åœ°å€&#123;&#125;,é”™è¯¯ä¿¡æ¯:&quot;</span>, request.getRequestURL(), e);</span><br><span class="line">        ResponseVO ajaxResponse = <span class="keyword">new</span> ResponseVO();</span><br><span class="line">        <span class="comment">//404</span></span><br><span class="line">        <span class="keyword">if</span> (e <span class="keyword">instanceof</span> NoHandlerFoundException) &#123;</span><br><span class="line">            ajaxResponse.setCode(ResponseCodeEnum.CODE_404.getCode());</span><br><span class="line">            ajaxResponse.setInfo(ResponseCodeEnum.CODE_404.getMsg());</span><br><span class="line">            ajaxResponse.setStatus(STATUC_ERROR);</span><br><span class="line">        &#125; <span class="function"><span class="keyword">else</span> <span class="title">if</span> <span class="params">(e <span class="keyword">instanceof</span> BusinessException)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//ä¸šåŠ¡é”™è¯¯</span></span><br><span class="line">            BusinessException biz = (BusinessException) e;</span><br><span class="line">            ajaxResponse.setCode(biz.getCode() == <span class="keyword">null</span> ? ResponseCodeEnum.CODE_600.getCode() : biz.getCode());</span><br><span class="line">            ajaxResponse.setInfo(biz.getMessage());</span><br><span class="line">            ajaxResponse.setStatus(STATUC_ERROR);</span><br><span class="line">        &#125; <span class="function"><span class="keyword">else</span> <span class="title">if</span> <span class="params">(e <span class="keyword">instanceof</span> BindException|| e <span class="keyword">instanceof</span> MethodArgumentTypeMismatchException)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//å‚æ•°ç±»å‹é”™è¯¯</span></span><br><span class="line">            ajaxResponse.setCode(ResponseCodeEnum.CODE_600.getCode());</span><br><span class="line">            ajaxResponse.setInfo(ResponseCodeEnum.CODE_600.getMsg());</span><br><span class="line">            ajaxResponse.setStatus(STATUC_ERROR);</span><br><span class="line">        &#125; <span class="function"><span class="keyword">else</span> <span class="title">if</span> <span class="params">(e <span class="keyword">instanceof</span> DuplicateKeyException)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//ä¸»é”®å†²çª</span></span><br><span class="line">            ajaxResponse.setCode(ResponseCodeEnum.CODE_601.getCode());</span><br><span class="line">            ajaxResponse.setInfo(ResponseCodeEnum.CODE_601.getMsg());</span><br><span class="line">            ajaxResponse.setStatus(STATUC_ERROR);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ajaxResponse.setCode(ResponseCodeEnum.CODE_500.getCode());</span><br><span class="line">            ajaxResponse.setInfo(ResponseCodeEnum.CODE_500.getMsg());</span><br><span class="line">            ajaxResponse.setStatus(STATUC_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ajaxResponse;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ ‡å‡†å“åº”æ¨¡å‹">æ ‡å‡†å“åº”æ¨¡å‹</h3>
<ul>
<li>
<p><code>ResponseVO&lt;T&gt;</code>ï¼š<code>status</code>ï¼ˆsuccess/errorï¼‰ã€<code>code</code>ã€<code>info</code>ã€<code>data</code>ã€‚</p>
</li>
<li>
<p><code>PaginationResultVO&lt;T&gt;</code>ï¼š<code>totalCount</code>ã€<code>pageSize</code>ã€<code>pageNo</code>ã€<code>pageTotal</code>ã€<code>list</code>ï¼›åˆ†é¡µåˆ—è¡¨æ—¶ä½œä¸º <code>data</code> è¿”å›ã€‚</p>
</li>
<li>
<p>æœ¬æ è¦†ç›–äº† <code>UserInfoController</code> çš„è·¯ç”±ä¸å‚æ•°ç»‘å®šæ–¹å¼ã€æ ‡å‡†å“åº”å°è£…ä»¥åŠå…¨å±€å¼‚å¸¸åˆ°å“åº”ç çš„æ˜ å°„ï¼›å¹¶æŒ‡å‡ºäº† <code>addOrUpdateBatch</code> å¯èƒ½çš„è°ƒç”¨æ–¹æ³•ç–æ¼ã€‚</p>
</li>
</ul>
<h2 id="7-é€šç”¨å“åº”æ¨¡å‹ä¸æšä¸¾">7.é€šç”¨å“åº”æ¨¡å‹ä¸æšä¸¾</h2>
<h3 id="é€šç”¨å“åº”æ¨¡å‹ä¸æšä¸¾">é€šç”¨å“åº”æ¨¡å‹ä¸æšä¸¾</h3>
<ul>
<li><strong>ResponseVOï¼ˆç»Ÿä¸€å“åº”åŒ…è£…ï¼‰</strong></li>
<li>å­—æ®µï¼š<code>status</code>ï¼ˆsuccess/errorï¼‰ã€<code>code</code>ã€<code>info</code>ã€<code>data</code>ã€‚</li>
<li>ç”¨æ³•ï¼šæ§åˆ¶å™¨é€šè¿‡ <code>ABaseController#getSuccessResponseVO</code> å¿«é€Ÿè¿”å›æˆåŠŸç»“æœï¼›å¼‚å¸¸ç»Ÿä¸€åœ¨å…¨å±€å¼‚å¸¸å¤„ç†å™¨ä¸­åŒ…è£…ä¸ºé”™è¯¯ç»“æœã€‚</li>
</ul>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> ResponseVO&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> String <span class="keyword">status</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">Integer</span> code;</span><br><span class="line">    <span class="keyword">private</span> String info;</span><br><span class="line">    <span class="keyword">private</span> T <span class="keyword">data</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>PaginationResultVOï¼ˆåˆ†é¡µç»“æœä½“ï¼‰</strong></li>
<li>å­—æ®µï¼š<code>totalCount</code>ã€<code>pageSize</code>ã€<code>pageNo</code>ã€<code>pageTotal</code>ã€<code>list</code>ã€‚</li>
<li>ç”¨æ³•ï¼šService è®¡ç®—åˆ†é¡µä¿¡æ¯åï¼Œæ„é€ è¯¥å¯¹è±¡ä½œä¸º <code>ResponseVO.data</code> è¿”å›ã€‚</li>
</ul>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> PaginationResultVO&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">Integer</span> totalCount;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">Integer</span> pageSize;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">Integer</span> pageNo;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">Integer</span> pageTotal;</span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; list = new ArrayList&lt;T&gt;();</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>ResponseCodeEnumï¼ˆå“åº”ç ä¸é»˜è®¤æç¤ºï¼‰</strong></li>
<li>çº¦å®šï¼š<code>200</code> æˆåŠŸï¼›<code>404</code> è·¯ç”±ä¸å­˜åœ¨ï¼›<code>600</code> å‚æ•°é”™è¯¯ï¼ˆå«ç»‘å®šé”™è¯¯ï¼‰ï¼›<code>601</code> å”¯ä¸€é”®å†²çªï¼›<code>500</code> æœåŠ¡å™¨é”™è¯¯ã€‚</li>
<li>è¢« <code>ABaseController</code>ã€å…¨å±€å¼‚å¸¸å¤„ç†å™¨å¼•ç”¨ï¼Œä¿éšœå…¨é“¾è·¯è¿”å›ç ä¸€è‡´ã€‚</li>
</ul>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">public</span> enum ResponseCodeEnum &#123;</span><br><span class="line">    <span class="attribute">CODE_200</span>(<span class="number">200</span>, <span class="string">&quot;è¯·æ±‚æˆåŠŸ&quot;</span>),</span><br><span class="line">    <span class="attribute">CODE_404</span>(<span class="number">404</span>, <span class="string">&quot;è¯·æ±‚åœ°å€ä¸å­˜åœ¨&quot;</span>),</span><br><span class="line">    <span class="attribute">CODE_600</span>(<span class="number">600</span>, <span class="string">&quot;è¯·æ±‚å‚æ•°é”™è¯¯&quot;</span>),</span><br><span class="line">    <span class="attribute">CODE_601</span>(<span class="number">601</span>, <span class="string">&quot;ä¿¡æ¯å·²ç»å­˜åœ¨&quot;</span>),</span><br><span class="line">    <span class="attribute">CODE_500</span>(<span class="number">500</span>, <span class="string">&quot;æœåŠ¡å™¨è¿”å›é”™è¯¯ï¼Œè¯·è”ç³»ç®¡ç†å‘˜&quot;</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>PageSizeï¼ˆåˆ†é¡µæšä¸¾ï¼‰</strong></li>
<li>æä¾›å¸¸ç”¨é¡µå¤§å°ï¼š15ã€20ã€30ã€40ã€50ã€‚</li>
<li>åœ¨ Service ä¸­ä½œä¸ºé»˜è®¤ <code>pageSize</code> å…œåº•ï¼Œç»Ÿä¸€å‰åç«¯åˆ†é¡µä½“éªŒã€‚</li>
</ul>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">public enum PageSize &#123;</span><br><span class="line">    <span class="built_in">SIZE15</span>(<span class="number">15</span>), <span class="built_in">SIZE20</span>(<span class="number">20</span>), <span class="built_in">SIZE30</span>(<span class="number">30</span>), <span class="built_in">SIZE40</span>(<span class="number">40</span>), <span class="built_in">SIZE50</span>(<span class="number">50</span>);</span><br></pre></td></tr></table></figure>
<h2 id="8-å·¥å…·ç±»ä¸åŸºç¡€æšä¸¾">8.å·¥å…·ç±»ä¸åŸºç¡€æšä¸¾</h2>
<h3 id="å·¥å…·ä¸åŸºç¡€">å·¥å…·ä¸åŸºç¡€</h3>
<ul>
<li><strong>DateTimePatternEnumï¼ˆæ—¥æœŸæ ¼å¼æšä¸¾ï¼‰</strong></li>
<li>ç»Ÿä¸€æ—¥æœŸæ ¼å¼å¸¸é‡ï¼š<code>yyyy-MM-dd HH:mm:ss</code>ã€<code>yyyy-MM-dd</code>ï¼Œç”¨äºåºåˆ—åŒ–ã€æ—¥å¿—ä¸å·¥å…·ç±»ã€‚</li>
</ul>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">DateTimePatternEnum</span> &#123;</span><br><span class="line">    <span class="built_in">YYYY_MM_DD_HH_MM_SS</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>), <span class="built_in">YYYY_MM_DD</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>DateUtilï¼ˆçº¿ç¨‹å®‰å…¨çš„æ—¥æœŸå·¥å…·ï¼‰</strong></li>
<li>åŸºäº <code>ThreadLocal&lt;SimpleDateFormat&gt;</code> ç¼“å­˜ï¼Œé¿å…å¤šçº¿ç¨‹ä¸‹ <code>SimpleDateFormat</code> éçº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</li>
<li><code>format(Date, pattern)</code>ã€<code>parse(String, pattern)</code> ä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼Œé…åˆ <code>DateTimePatternEnum</code> ç»Ÿä¸€æ ¼å¼ã€‚</li>
<li><code>parse</code> å¤±è´¥æ—¶è¿”å› <code>new Date()</code>ï¼ˆæ³¨æ„ï¼šç”Ÿäº§å¯è€ƒè™‘æŠ›å¼‚å¸¸æˆ–è¿”å› <code>null</code>ï¼‰ã€‚</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="title class_">Map</span>&lt;<span class="title class_">String</span>, <span class="title class_">ThreadLocal</span>&lt;<span class="title class_">SimpleDateFormat</span>&gt;&gt; sdfMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;<span class="title class_">String</span>, <span class="title class_">ThreadLocal</span>&lt;<span class="title class_">SimpleDateFormat</span>&gt;&gt;();</span><br><span class="line">...</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="title class_">String</span> <span class="title function_">format</span>(<span class="params"><span class="title class_">Date</span> date, <span class="title class_">String</span> pattern</span>) &#123; <span class="keyword">return</span> <span class="title function_">getSdf</span>(pattern).<span class="title function_">format</span>(date); &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="title class_">Date</span> <span class="title function_">parse</span>(<span class="params"><span class="title class_">String</span> dateStr, <span class="title class_">String</span> pattern</span>) &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>StringToolsï¼ˆå­—ç¬¦ä¸²ä¸å‚æ•°æ ¡éªŒï¼‰</strong></li>
<li><code>checkParam(Object param)</code>ï¼šåå°„éå† <code>getXxx()</code>ï¼Œç¡®ä¿è‡³å°‘æœ‰ä¸€ä¸ªéç©ºæ¡ä»¶ï¼›å¦åˆ™æŠ›å‡º <code>BusinessException</code>ã€‚ç”¨äºé˜²æ­¢æ— æ¡ä»¶æ›´æ–°/åˆ é™¤ã€‚</li>
<li><code>upperCaseFirstLetter(String)</code>ï¼šé¦–å­—æ¯å¤§å†™ï¼ˆé¿å¼€ç¬¬äºŒä¸ªå­—æ¯å¤§å†™çš„ç¼©å†™åœºæ™¯ï¼‰ã€‚</li>
<li><code>isEmpty(String)</code>ï¼šå¯¹ <code>null</code>ã€ç©ºä¸²ã€â€œnullâ€ã€â€œ\u0000â€ã€å…¨ç©ºç™½ç­‰åˆ¤ç©ºã€‚</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> <span class="title function_">checkParam</span>(<span class="params"><span class="title class_">Object</span> param</span>) &#123;</span><br><span class="line">    <span class="title class_">Field</span>[] fields = param.<span class="title function_">getClass</span>().<span class="title function_">getDeclaredFields</span>();</span><br><span class="line">    <span class="built_in">boolean</span> notEmpty = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="title class_">Field</span> field : fields) &#123;</span><br><span class="line">        <span class="title class_">String</span> methodName = <span class="string">&quot;get&quot;</span> + <span class="title class_">StringTools</span>.<span class="title function_">upperCaseFirstLetter</span>(field.<span class="title function_">getName</span>());</span><br><span class="line">        <span class="title class_">Method</span> method = param.<span class="title function_">getClass</span>().<span class="title function_">getMethod</span>(methodName);</span><br><span class="line">        <span class="title class_">Object</span> <span class="built_in">object</span> = method.<span class="title function_">invoke</span>(param);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">object</span> != <span class="literal">null</span> &amp;&amp; <span class="built_in">object</span> <span class="keyword">instanceof</span> java.<span class="property">lang</span>.<span class="property">String</span> &amp;&amp; !<span class="title class_">StringTools</span>.<span class="title function_">isEmpty</span>(<span class="built_in">object</span>.<span class="title function_">toString</span>())</span><br><span class="line">                || <span class="built_in">object</span> != <span class="literal">null</span> &amp;&amp; !(<span class="built_in">object</span> <span class="keyword">instanceof</span> java.<span class="property">lang</span>.<span class="property">String</span>)) &#123;</span><br><span class="line">            notEmpty = <span class="literal">true</span>; <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!notEmpty) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;å¤šå‚æ•°æ›´æ–°ï¼Œåˆ é™¤ï¼Œå¿…é¡»æœ‰éç©ºæ¡ä»¶&quot;</span>); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>BusinessExceptionï¼ˆä¸šåŠ¡å¼‚å¸¸ï¼‰</strong></li>
<li>ç»§æ‰¿ <code>RuntimeException</code>ï¼Œæ”¯æŒä¸‰ç§æ„é€ ï¼šçº¯æ¶ˆæ¯ã€ç +æ¶ˆæ¯ã€<code>ResponseCodeEnum</code>ã€‚</li>
<li>é‡å†™ <code>fillInStackTrace</code> è¿”å›è‡ªèº«ï¼Œé¿å…å¡«å……å †æ ˆï¼Œå‡å°å¼€é”€ï¼ˆç”¨äºå¯é¢„æœŸçš„ä¸šåŠ¡å¼‚å¸¸ï¼‰ã€‚</li>
<li>è¢«å…¨å±€å¼‚å¸¸å¤„ç†å™¨æ•è·å¹¶æ˜ å°„æˆæ ‡å‡†å“åº”ã€‚</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">BusinessException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">ResponseCodeEnum</span> codeEnum;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> code;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> message;</span><br></pre></td></tr></table></figure>
<ul>
<li>å·²è®²è§£æ—¥æœŸæ ¼å¼ä¸å·¥å…·ç±»åœ¨å®ä½“/æ—¥å¿—/SQLæ¡ä»¶ä¸­çš„ç»Ÿä¸€ä½œç”¨ï¼Œå‚æ•°æ ¡éªŒå¦‚ä½•ä¿æŠ¤å±é™©æ“ä½œï¼Œä»¥åŠä¸šåŠ¡å¼‚å¸¸å¦‚ä½•è½¬åŒ–ä¸ºä¸€è‡´çš„é”™è¯¯å“åº”ã€‚</li>
</ul>
<h2 id="9-åŸºç¡€æ§åˆ¶å™¨ä¸å…¨å±€å¼‚å¸¸">9.åŸºç¡€æ§åˆ¶å™¨ä¸å…¨å±€å¼‚å¸¸</h2>
<ul>
<li><strong>ABaseControllerï¼ˆç»Ÿä¸€å“åº”å¸®åŠ©ç±»ï¼‰</strong></li>
<li>æä¾›ä¸‰ä¸ªä¾¿æ·æ–¹æ³•ï¼šæˆåŠŸè¿”å›ã€ä¸šåŠ¡å¼‚å¸¸è¿”å›ã€æœåŠ¡å™¨å¼‚å¸¸è¿”å›ï¼›å†…éƒ¨ä½¿ç”¨ <code>ResponseCodeEnum</code> çº¦æŸ <code>code</code> ä¸é»˜è®¤ <code>info</code>ã€‚</li>
</ul>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">protected &lt;T&gt; ResponseVO getSuccessResponseVO(T t) &#123;</span><br><span class="line">    ResponseVO&lt;T&gt; responseVO <span class="operator">=</span> new ResponseVO&lt;&gt;()<span class="comment">;</span></span><br><span class="line">    responseVO.setStatus(STATUC_SUCCESS)<span class="comment">;</span></span><br><span class="line">    responseVO.setCode(ResponseCodeEnum.CODE_200.getCode())<span class="comment">;</span></span><br><span class="line">    responseVO.setInfo(ResponseCodeEnum.CODE_200.getMsg())<span class="comment">;</span></span><br><span class="line">    responseVO.setData(t)<span class="comment">;</span></span><br><span class="line">    return responseVO<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ§åˆ¶å™¨ç»§æ‰¿å®ƒä¹‹åï¼Œèƒ½ç»Ÿä¸€å‡ºå‚æ ¼å¼ï¼Œé¿å…æ¯ä¸ªæ¥å£æ‰‹å†™çŠ¶æ€ç ä¸æç¤ºè¯­ã€‚</li>
<li><strong>AGlobalExceptionHandlerControllerï¼ˆå…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼‰</strong></li>
<li>é€šè¿‡ <code>@RestControllerAdvice</code> + <code>@ExceptionHandler(Exception.class)</code> æ•è·æ‰€æœ‰æœªå¤„ç†å¼‚å¸¸ï¼Œæ—¥å¿—è®°å½•åï¼Œè½¬ä¸ºæ ‡å‡†å“åº”è¿”å›ã€‚</li>
<li>è§„åˆ™æ˜ å°„ï¼š
<ul>
<li><code>NoHandlerFoundException</code> â†’ 404</li>
<li><code>BusinessException</code> â†’ å–å…¶è‡ªå¸¦ <code>code/message</code>ï¼Œé»˜è®¤ 600</li>
<li><code>BindException</code>ã€<code>MethodArgumentTypeMismatchException</code> â†’ 600ï¼ˆå‚æ•°é”™è¯¯ï¼‰</li>
<li><code>DuplicateKeyException</code> â†’ 601ï¼ˆå”¯ä¸€é”®å†²çªï¼‰</li>
<li>å…¶å®ƒå¼‚å¸¸ â†’ 500ï¼ˆæœåŠ¡å™¨é”™è¯¯ï¼‰</li>
</ul>
</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">AGlobalExceptionHandlerController</span> <span class="keyword">extends</span> <span class="title">ABaseController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> static <span class="keyword">final</span> <span class="type">Logger</span> logger = <span class="type">LoggerFactory</span>.getLogger(<span class="type">AGlobalExceptionHandlerController</span>.<span class="keyword">class</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>å…¨é“¾è·¯å…³ç³»</strong></li>
<li>æ§åˆ¶å™¨ â†’ ä½¿ç”¨ <code>ABaseController</code> ç»Ÿä¸€æˆåŠŸè¿”å›ã€‚</li>
<li>ä¸šåŠ¡å¼‚å¸¸ â†’ æŠ›å‡º <code>BusinessException</code>ï¼Œè¢«å…¨å±€å¼‚å¸¸å¤„ç†å™¨æ•è·å¹¶è½¬æˆæ ‡å‡†é”™è¯¯å“åº”ã€‚</li>
<li>å…¶å®ƒå¼‚å¸¸ â†’ åŒæ ·è¢«å…¨å±€æ•è·ï¼Œé¿å…å †æ ˆå¤–æ³„ï¼Œä¿è¯å‰ç«¯æ‹¿åˆ°ç»“æ„åŒ–é”™è¯¯ã€‚</li>
</ul>
<h2 id="10-è¡¥å……çš„å·¥å…·ç±»ï¼ˆå¸¸ç”¨ï¼‰">10.è¡¥å……çš„å·¥å…·ç±»ï¼ˆå¸¸ç”¨ï¼‰</h2>
<h3 id="JsonUtilsï¼ˆå¯¹è±¡-æ•°ç»„-JSON-è½¬æ¢ï¼‰">JsonUtilsï¼ˆå¯¹è±¡/æ•°ç»„ JSON è½¬æ¢ï¼‰</h3>
<ul>
<li><strong>å®šä½</strong>ï¼šåŸºäº Fastjson çš„è½»é‡å°è£…ï¼Œæä¾›å¯¹è±¡ã€æ•°ç»„ä¸å­—ç¬¦ä¸²ä¹‹é—´çš„ä¾¿æ·è½¬æ¢ã€‚</li>
<li><strong>æ–¹æ³•æ¸…å•</strong>ï¼š</li>
<li><code>convertObj2Json(Object obj)</code> â†’ åºåˆ—åŒ–å¯¹è±¡ä¸º JSON å­—ç¬¦ä¸²ã€‚</li>
<li><code>convertJson2Obj(String json, Class&lt;T&gt; classz)</code> â†’ ååºåˆ—åŒ– JSON ä¸ºå¯¹è±¡ã€‚</li>
<li><code>convertJsonArray2List(String json, Class&lt;T&gt; classz)</code> â†’ ååºåˆ—åŒ– JSON æ•°ç»„ä¸º <code>List&lt;T&gt;</code>ã€‚</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JsonUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="title class_">String</span> <span class="title function_">convertObj2Json</span>(<span class="params"><span class="title class_">Object</span> obj</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">toJSONString</span>(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">convertJson2Obj</span>(<span class="params"><span class="title class_">String</span> json, <span class="title class_">Class</span>&lt;T&gt; classz</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">JSON</span><span class="built_in">Object</span>.<span class="title function_">parseObject</span>(json, classz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="title class_">List</span>&lt;T&gt; <span class="title function_">convertJsonArray2List</span>(<span class="params"><span class="title class_">String</span> json, <span class="title class_">Class</span>&lt;T&gt; classz</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">JSON</span><span class="built_in">Array</span>.<span class="title function_">parseArray</span>(json, classz);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>ä½¿ç”¨å»ºè®®ä¸æ³¨æ„ç‚¹</strong>ï¼š</li>
<li>å»ºè®®é…åˆç»Ÿä¸€çš„ VO/DTO ä½¿ç”¨ï¼Œé¿å…ç›´æ¥åºåˆ—åŒ–å¸¦æœ‰æ•æ„Ÿå­—æ®µçš„å®ä½“ï¼ˆå¦‚ <code>password</code>ï¼‰ã€‚</li>
<li>å¯¹æ—¶é—´å­—æ®µï¼Œå°½é‡åœ¨åºåˆ—åŒ–å‰è§„èŒƒæ ¼å¼ï¼ˆå¦‚ <code>@JsonFormat</code> æˆ–ç»Ÿä¸€ <code>DateUtil</code>ï¼‰ã€‚</li>
<li>Fastjson åœ¨é«˜ç‰ˆæœ¬ JDK ä¸å®‰å…¨é…ç½®ä¸‹éœ€ç•™æ„ä¾èµ–ç‰ˆæœ¬ä¸ç™½åå•é…ç½®ï¼›å¦‚å¯¹å®‰å…¨åˆè§„æ›´æ•æ„Ÿï¼Œå¯è€ƒè™‘ Jacksonã€‚</li>
</ul>
<h3 id="RedisConfigï¼ˆåºåˆ—åŒ–ç­–ç•¥ä¸å®¹å™¨ï¼‰">RedisConfigï¼ˆåºåˆ—åŒ–ç­–ç•¥ä¸å®¹å™¨ï¼‰</h3>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> RedisConfig&lt;V&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(RedisConfig.<span class="keyword">class</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">@Bean</span>(<span class="string">&quot;redisTemplate&quot;</span>)</span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, V&gt; redisTemplate(RedisConnectionFactory factory) &#123;</span><br><span class="line">        RedisTemplate&lt;String, V&gt; <span class="keyword">template</span> = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        <span class="keyword">template</span>.setConnectionFactory(factory);</span><br><span class="line">        <span class="comment">// è®¾ç½®keyçš„åºåˆ—åŒ–æ–¹å¼</span></span><br><span class="line">        <span class="keyword">template</span>.setKeySerializer(RedisSerializer.<span class="built_in">string</span>());</span><br><span class="line">        <span class="comment">// è®¾ç½®valueçš„åºåˆ—åŒ–æ–¹å¼</span></span><br><span class="line">        <span class="keyword">template</span>.setValueSerializer(RedisSerializer.json());</span><br><span class="line">        <span class="comment">// è®¾ç½®hashçš„keyçš„åºåˆ—åŒ–æ–¹å¼</span></span><br><span class="line">        <span class="keyword">template</span>.setHashKeySerializer(RedisSerializer.<span class="built_in">string</span>());</span><br><span class="line">        <span class="comment">// è®¾ç½®hashçš„valueçš„åºåˆ—åŒ–æ–¹å¼</span></span><br><span class="line">        <span class="keyword">template</span>.setHashValueSerializer(RedisSerializer.json());</span><br><span class="line">        <span class="keyword">template</span>.afterPropertiesSet();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">template</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisMessageListenerContainer container(RedisConnectionFactory connectionFactory) &#123;</span><br><span class="line">        RedisMessageListenerContainer container = <span class="keyword">new</span> RedisMessageListenerContainer();</span><br><span class="line">        container.setConnectionFactory(connectionFactory);</span><br><span class="line">        <span class="keyword">return</span> container;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼šé›†ä¸­é…ç½® <code>RedisTemplate</code> çš„åºåˆ—åŒ–æ–¹å¼ï¼Œå¹¶æ³¨å†Œæ¶ˆæ¯ç›‘å¬å®¹å™¨ã€‚</p>
</li>
<li>
<p><strong>æ ¸å¿ƒ Bean</strong>ï¼š</p>
</li>
<li>
<pre><code>RedisTemplate&lt;String, V&gt; redisTemplate
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  ï¼š</span><br><span class="line"></span><br><span class="line">  - `KeySerializer`ï¼š`RedisSerializer.string()`ï¼Œäººç±»å¯è¯»çš„å­—ç¬¦ä¸²é”®ã€‚</span><br><span class="line">  - `ValueSerializer`ï¼š`RedisSerializer.json()`ï¼Œå€¼ä½¿ç”¨ JSON åºåˆ—åŒ–ï¼Œä¾¿äºè·¨è¯­è¨€/è°ƒè¯•ã€‚</span><br><span class="line">  - `HashKeySerializer`/`HashValueSerializer`ï¼šåˆ†åˆ«ä½¿ç”¨ String/JSONï¼Œä¿æŒä¸€è‡´æ€§ã€‚</span><br><span class="line">  - ä¾èµ– `RedisConnectionFactory`ï¼Œç”± Spring Boot è‡ªåŠ¨é…ç½®ï¼ˆLettuce/Jedisï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">- `RedisMessageListenerContainer`ï¼šç”¨äºåŸºäº Redis Pub/Sub çš„æ¶ˆæ¯ç›‘å¬ï¼ˆåç»­å¯æ³¨å†Œ `MessageListener` ç›‘å¬é¢‘é“ï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">- **ä½¿ç”¨å»ºè®®**ï¼š</span><br><span class="line"></span><br><span class="line">- æ³›å‹ `V` å»ºè®®ä¸ºç¨³å®šçš„ DTO/VOï¼Œé¿å…ç›´æ¥ç¼“å­˜æŒä¹…åŒ–å®ä½“ï¼ˆå­—æ®µå˜åŒ–ä¼šå¯¼è‡´ååºåˆ—åŒ–å¤±è´¥ï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">- è‹¥å€¼ç±»å‹å¤šæ ·ï¼Œå¯åŸºäº `RedisTemplate&lt;String, Object&gt;` é…åˆ Jackson å¤šæ€åºåˆ—åŒ–ï¼Œæˆ–è‡ªå®šä¹‰å¤šä¸ª `RedisTemplate`ã€‚</span><br><span class="line"></span><br><span class="line">- ç”Ÿäº§å»ºè®®å¯ç”¨é”®å‰ç¼€ã€è¶…æ—¶ç­–ç•¥ä¸åºåˆ—åŒ–ç™½åå•ï¼Œç¡®ä¿ç¼“å­˜ç©ºé—´ä¸å®‰å…¨ã€‚</span><br><span class="line"></span><br><span class="line">### RedisUtilsï¼ˆKVã€è¿‡æœŸã€åˆ—è¡¨ã€ZSetã€è®¡æ•°ï¼‰</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<p>@Component(â€œredisUtilsâ€)<br>
public class RedisUtils<V> {</p>
<pre><code>@Resource
private RedisTemplate&lt;String, V&gt; redisTemplate;

private static final Logger logger = LoggerFactory.getLogger(RedisUtils.class);

/**
 * åˆ é™¤ç¼“å­˜
 *
 * @param key å¯ä»¥ä¼ ä¸€ä¸ªå€¼ æˆ–å¤šä¸ª
 */
public void delete(String... key) &#123;
    if (key != null &amp;&amp; key.length &gt; 0) &#123;
        if (key.length == 1) &#123;
            redisTemplate.delete(key[0]);
        &#125; else &#123;
            redisTemplate.delete((Collection&lt;String&gt;) CollectionUtils.arrayToList(key));
        &#125;
    &#125;
&#125;

public V get(String key) &#123;
    return key == null ? null : redisTemplate.opsForValue().get(key);
&#125;

/**
 * æ™®é€šç¼“å­˜æ”¾å…¥
 *
 * @param key   é”®
 * @param value å€¼
 * @return trueæˆåŠŸ falseå¤±è´¥
 */
public boolean set(String key, V value) &#123;
    try &#123;
        redisTemplate.opsForValue().set(key, value);
        return true;
    &#125; catch (Exception e) &#123;
        logger.error(&quot;è®¾ç½®redisKey:&#123;&#125;,value:&#123;&#125;å¤±è´¥&quot;, key, value);
        return false;
    &#125;
&#125;

public boolean keyExists(String key) &#123;
    return redisTemplate.hasKey(key);
&#125;

/**
 * æ™®é€šç¼“å­˜æ”¾å…¥å¹¶è®¾ç½®æ—¶é—´
 *
 * @param key   é”®
 * @param value å€¼
 * @param time  æ—¶é—´(ç§’) timeè¦å¤§äº0 å¦‚æœtimeå°äºç­‰äº0 å°†è®¾ç½®æ— é™æœŸ
 * @return trueæˆåŠŸ false å¤±è´¥
 */
public boolean setex(String key, V value, long time) &#123;
    try &#123;
        if (time &gt; 0) &#123;
            redisTemplate.opsForValue().set(key, value, time, TimeUnit.MILLISECONDS);
        &#125; else &#123;
            set(key, value);
        &#125;
        return true;
    &#125; catch (Exception e) &#123;
        logger.error(&quot;è®¾ç½®redisKey:&#123;&#125;,value:&#123;&#125;å¤±è´¥&quot;, key, value);
        return false;
    &#125;
&#125;

public boolean expire(String key, long time) &#123;
    try &#123;
        if (time &gt; 0) &#123;
            redisTemplate.expire(key, time, TimeUnit.MILLISECONDS);
        &#125;
        return true;
    &#125; catch (Exception e) &#123;
        e.printStackTrace();
        return false;
    &#125;
&#125;


public List&lt;V&gt; getQueueList(String key) &#123;
    return redisTemplate.opsForList().range(key, 0, -1);
&#125;


public boolean lpush(String key, V value, Long time) &#123;
    try &#123;
        redisTemplate.opsForList().leftPush(key, value);
        if (time != null &amp;&amp; time &gt; 0) &#123;
            expire(key, time);
        &#125;
        return true;
    &#125; catch (Exception e) &#123;
        e.printStackTrace();
        return false;
    &#125;
&#125;

public long remove(String key, Object value) &#123;
    try &#123;
        Long remove = redisTemplate.opsForList().remove(key, 1, value);
        return remove;
    &#125; catch (Exception e) &#123;
        e.printStackTrace();
        return 0;
    &#125;
&#125;

public boolean lpushAll(String key, List&lt;V&gt; values, long time) &#123;
    try &#123;
        redisTemplate.opsForList().leftPushAll(key, values);
        if (time &gt; 0) &#123;
            expire(key, time);
        &#125;
        return true;
    &#125; catch (Exception e) &#123;
        e.printStackTrace();
        return false;
    &#125;
&#125;

public V rpop(String key) &#123;
    try &#123;
        return redisTemplate.opsForList().rightPop(key);
    &#125; catch (Exception e) &#123;
        e.printStackTrace();
        return null;
    &#125;
&#125;

public Long increment(String key) &#123;
    Long count = redisTemplate.opsForValue().increment(key, 1);
    return count;
&#125;

public Long incrementex(String key, long milliseconds) &#123;
    Long count = redisTemplate.opsForValue().increment(key, 1);
    if (count == 1) &#123;
        //è®¾ç½®è¿‡æœŸæ—¶é—´1å¤©
        expire(key, milliseconds);
    &#125;
    return count;
&#125;

public Long decrement(String key) &#123;
    Long count = redisTemplate.opsForValue().increment(key, -1);
    if (count &lt;= 0) &#123;
        redisTemplate.delete(key);
    &#125;
    logger.info(&quot;key:&#123;&#125;,å‡å°‘æ•°é‡&#123;&#125;&quot;, key, count);
    return count;
&#125;


public Set&lt;String&gt; getByKeyPrefix(String keyPrifix) &#123;
    Set&lt;String&gt; keyList = redisTemplate.keys(keyPrifix + &quot;*&quot;);
    return keyList;
&#125;


public Map&lt;String, V&gt; getBatch(String keyPrifix) &#123;
    Set&lt;String&gt; keySet = redisTemplate.keys(keyPrifix + &quot;*&quot;);
    List&lt;String&gt; keyList = new ArrayList&lt;&gt;(keySet);
    List&lt;V&gt; keyValueList = redisTemplate.opsForValue().multiGet(keyList);
    Map&lt;String, V&gt; resultMap = keyList.stream().collect(Collectors.toMap(key -&gt; key, value -&gt; keyValueList.get(keyList.indexOf(value))));
    return resultMap;
&#125;

public void zaddCount(String key, V v) &#123;
    redisTemplate.opsForZSet().incrementScore(key, v, 1);
&#125;


public List&lt;V&gt; getZSetList(String key, Integer count) &#123;
    Set&lt;V&gt; topElements = redisTemplate.opsForZSet().reverseRange(key, 0, count);
    List&lt;V&gt; list = new ArrayList&lt;&gt;(topElements);
    return list;
&#125;
</code></pre>
<p>}</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**å®šä½**</span>ï¼šåœ¨ <span class="code">`RedisTemplate&lt;String, V&gt;`</span> åŸºç¡€ä¸Šçš„ä¾¿æ·å°è£…ï¼Œè¦†ç›–å¸¸è§ KVã€TTLã€Listã€ZSet ä¸è®¡æ•°åœºæ™¯ã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**KV ä¸è¿‡æœŸ**</span></span><br><span class="line"><span class="bullet">-</span> <span class="code">`set(key, value)`</span>ï¼šå†™å…¥å€¼ï¼Œå¼‚å¸¸æ—¶è®°å½•é”™è¯¯æ—¥å¿—å¹¶è¿”å› falseã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="code">`get(key)`</span>ï¼šè¯»å–å€¼ã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="code">`setex(key, value, time)`</span>ï¼šå†™å…¥å¹¶è®¾ç½®è¿‡æœŸï¼ˆå•ä½ä¸ºæ¯«ç§’ï¼›å‘½åä¸ Redis åŸç”Ÿå‘½ä»¤ç§’çº§è¯­ä¹‰ä¸åŒï¼Œæ³¨æ„åŒºåˆ†ï¼‰ã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="code">`expire(key, time)`</span>ï¼šè®¾ç½®è¿‡æœŸï¼ˆæ¯«ç§’ï¼‰ã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="code">`delete(String... key)`</span>ï¼šåˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ª keyã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="code">`keyExists(key)`</span>ï¼šåˆ¤å®š key æ˜¯å¦å­˜åœ¨ã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**è®¡æ•°å™¨**</span></span><br><span class="line"><span class="bullet">-</span> <span class="code">`increment(key)`</span>ï¼šè‡ªå¢ 1ã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="code">`incrementex(key, milliseconds)`</span>ï¼šè‡ªå¢å¹¶åœ¨é¦–æ¬¡åˆ›å»ºæ—¶è®¾ç½®è¿‡æœŸã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="code">`decrement(key)`</span>ï¼šè‡ªå‡ 1ï¼Œå½“è®¡æ•° â‰¤ 0 æ—¶åˆ é™¤é”®ï¼ˆå¸¸ç”¨äºå¹¶å‘é…é¢/åº“å­˜è®¡æ•°ï¼‰ã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**List é˜Ÿåˆ—**</span></span><br><span class="line"><span class="bullet">-</span> <span class="code">`lpush(key, value, time)`</span>ï¼šå·¦å…¥é˜Ÿï¼Œæ”¯æŒå¯é€‰è¿‡æœŸã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="code">`lpushAll(key, values, time)`</span>ï¼šæ‰¹é‡å·¦å…¥é˜Ÿå¹¶å¯è®¾ç½®è¿‡æœŸã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="code">`rpop(key)`</span>ï¼šå³å‡ºé˜Ÿï¼ˆæ¶ˆè´¹ç«¯ï¼‰ã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="code">`getQueueList(key)`</span>ï¼šè·å–æ•´ä¸ªåˆ—è¡¨ï¼ˆè°ƒè¯•/è§‚æµ‹ï¼‰ã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**ZSet æ’åºé›†åˆ**</span></span><br><span class="line"><span class="bullet">-</span> <span class="code">`zaddCount(key, v)`</span>ï¼šå¯¹æˆå‘˜ <span class="code">`v`</span> çš„åˆ†å€¼è‡ªå¢ 1ï¼ˆç”¨äºçƒ­æ¦œè®¡æ•°ï¼‰ã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="code">`getZSetList(key, count)`</span>ï¼šæŒ‰åˆ†å€¼ä»é«˜åˆ°ä½å–å‰ N ä¸ªã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**æ‰¹é‡ä¸æ‰«æ**</span></span><br><span class="line"><span class="bullet">-</span> <span class="code">`getByKeyPrefix(prefix)`</span>ï¼šæŒ‰å‰ç¼€æ‰«æ keyï¼ˆæ³¨æ„ç”Ÿäº§ç¯å¢ƒä¸‹ <span class="code">`keys`</span> å‘½ä»¤ä¸º O(N)ï¼Œéœ€è°¨æ…ï¼‰ã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="code">`getBatch(prefix)`</span>ï¼šæ‰¹é‡æ‹‰å–å‰ç¼€åŒ¹é…çš„ KV å¹¶ç»„è£…ä¸º <span class="code">`Map`</span>ã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**æ³¨æ„ç‚¹ä¸å»ºè®®**</span></span><br><span class="line"><span class="bullet">-</span> ç»Ÿä¸€é‡‡ç”¨ JSON åºåˆ—åŒ–çš„ <span class="code">`RedisTemplate`</span>ï¼Œ<span class="code">`V`</span> çš„ç±»å‹è¦ç¨³å®šï¼Œé¿å…å­—æ®µå˜æ›´å¯¼è‡´ååºåˆ—åŒ–å¤±è´¥ã€‚</span><br><span class="line"><span class="bullet">-</span> TTL å•ä½ä¸ºæ¯«ç§’ï¼›å¦‚éœ€ç§’çº§ä¸ Redis æœ¯è¯­ä¸€è‡´ï¼Œå¯å°ä¸€å±‚ç§’çº§ APIã€‚</span><br><span class="line"><span class="bullet">-</span> é«˜å¹¶å‘è®¡æ•°å¯è€ƒè™‘ä½¿ç”¨ <span class="code">`INCRBY`</span>ã€Lua è„šæœ¬æˆ– Redisson åŸå­è®¡æ•°å™¨æ¥æ§åˆ¶åŸå­æ€§ä¸è¿‡æœŸç­–ç•¥ã€‚</span><br><span class="line"><span class="bullet">-</span> æ‰¹é‡ keys/scan å»ºè®®åœ¨åå°ä»»åŠ¡æˆ–ç®¡ç†ç«¯ä½¿ç”¨ï¼Œçº¿ä¸Šè¯·æ±‚è·¯å¾„é¿å…é˜»å¡ã€‚</span><br><span class="line"></span><br><span class="line"><span class="section">### CopyToolsï¼ˆå¯¹è±¡/åˆ—è¡¨å±æ€§å¤åˆ¶ï¼‰</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>public class CopyTools {<br>
public static &lt;T, S&gt; List<T> copyList(List<S> sList, Class<T> classz) {<br>
List<T> list = new ArrayList<T>();<br>
for (S s : sList) {<br>
T t = null;<br>
try {<br>
t = classz.newInstance();<br>
} catch (Exception e) {<br>
e.printStackTrace();<br>
}<br>
BeanUtils.copyProperties(s, t);<br>
list.add(t);<br>
}<br>
return list;<br>
}</p>
<pre><code>public static &lt;T, S&gt; T copy(S s, Class&lt;T&gt; classz) &#123;
    T t = null;
    try &#123;
        t = classz.newInstance();
    &#125; catch (Exception e) &#123;
        e.printStackTrace();
    &#125;
    BeanUtils.copyProperties(s, t);
    return t;
&#125;

public static &lt;T, S&gt; void copyProperties(S s, T t) &#123;
    BeanUtils.copyProperties(s, t);
&#125;
</code></pre>
<p>}</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- **å®šä½**ï¼šå¯¹ `BeanUtils.copyProperties` çš„è½»é‡å°è£…ï¼Œç®€åŒ–å¯¹è±¡é—´å±æ€§æ‹·è´ä¸åˆ—è¡¨è½¬æ¢ã€‚</span><br><span class="line">- **æ ¸å¿ƒæ–¹æ³•**ï¼š</span><br><span class="line">- `copyList(List&lt;S&gt; sList, Class&lt;T&gt; classz)`ï¼šå°† `List&lt;S&gt;` è½¬ä¸º `List&lt;T&gt;`ï¼Œé€ä¸ª `newInstance` å¹¶æ‹·è´ã€‚</span><br><span class="line">- `copy(S s, Class&lt;T&gt; classz)`ï¼šå°† `S` è½¬ä¸º `T`ã€‚</span><br><span class="line">- `copyProperties(S s, T t)`ï¼šç›´æ¥æŠŠ `s` çš„åŒåå±æ€§æ‹·è´åˆ° `t`ã€‚</span><br><span class="line">- **ä½¿ç”¨å»ºè®®**ï¼š</span><br><span class="line">- é€‚åˆ Controller/Service å±‚æŠŠ `PO` è½¬ `VO`ã€`DTO`ï¼Œæˆ–å°†ç¬¬ä¸‰æ–¹å¯¹è±¡æ˜ å°„ä¸ºå†…éƒ¨å¯¹è±¡ã€‚</span><br><span class="line">- ç›®æ ‡ç±»éœ€æœ‰æ— å‚æ„é€ æ–¹æ³•ï¼›ç¼ºå¤±ä¼šå¯¼è‡´ `newInstance()` å¼‚å¸¸ã€‚</span><br><span class="line">- ä»…æŒ‰åŒåå±æ€§æ‹·è´ï¼Œå¤æ‚åœºæ™¯ï¼ˆåµŒå¥—å¯¹è±¡ã€ç±»å‹ä¸ä¸€è‡´ã€é›†åˆæ˜ å°„ï¼‰å»ºè®®ç”¨ MapStruct è¿™ç±»ç¼–è¯‘æœŸç”Ÿæˆå·¥å…·ï¼Œæ€§èƒ½æ›´ä¼˜ä¸”ç±»å‹å®‰å…¨ã€‚</span><br><span class="line"></span><br><span class="line">### DateUtil æ‰©å±•ï¼ˆæ—¥æœŸè®¡ç®—ä¸æœ€è¿‘ N æ—¥åˆ—è¡¨ï¼‰</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>public class DateUtil {</p>
<pre><code>private static final Object lockObj = new Object();
private static Map&lt;String, ThreadLocal&lt;SimpleDateFormat&gt;&gt; sdfMap = new HashMap&lt;String, ThreadLocal&lt;SimpleDateFormat&gt;&gt;();

private static SimpleDateFormat getSdf(final String pattern) &#123;
    ThreadLocal&lt;SimpleDateFormat&gt; tl = sdfMap.get(pattern);
    if (tl == null) &#123;
        synchronized (lockObj) &#123;
            tl = sdfMap.get(pattern);
            if (tl == null) &#123;
                tl = new ThreadLocal&lt;SimpleDateFormat&gt;() &#123;
                    @Override
                    protected SimpleDateFormat initialValue() &#123;
                        return new SimpleDateFormat(pattern);
                    &#125;
                &#125;;
                sdfMap.put(pattern, tl);
            &#125;
        &#125;
    &#125;

    return tl.get();
&#125;

public static String format(Date date, String pattern) &#123;
    return getSdf(pattern).format(date);
&#125;

public static Date parse(String dateStr, String pattern) &#123;
    try &#123;
        return getSdf(pattern).parse(dateStr);
    &#125; catch (ParseException e) &#123;
        e.printStackTrace();
    &#125;
    return new Date();
&#125;

public static String getBeforeDayDate(Integer day) &#123;
    Calendar calendar = Calendar.getInstance();
    calendar.add(Calendar.DAY_OF_YEAR, -day);
    return format(calendar.getTime(), DateTimePatternEnum.YYYY_MM_DD.getPattern());
&#125;

public static Date getDayAgo(Integer day) &#123;
    Calendar calendar = Calendar.getInstance();
    calendar.add(Calendar.DAY_OF_YEAR, -day);
    return calendar.getTime();
&#125;

public static List&lt;String&gt; getBeforeDates(Integer beforeDays) &#123;
    LocalDate endDate = LocalDate.now();
    List&lt;String&gt; dateList = new ArrayList&lt;&gt;();
    DateTimeFormatter formatter = DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&quot;);
    for (int i = beforeDays; i &gt; 0; i--) &#123;
        dateList.add(endDate.minusDays(i).format(formatter));
    &#125;
    return dateList;
&#125;
</code></pre>
<p>}</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**ç›¸è¾ƒåŸºç¡€ç‰ˆçš„å¢å¼º**</span></span><br><span class="line"><span class="bullet">-</span> ä¿ç•™çº¿ç¨‹å®‰å…¨çš„ <span class="code">`format/parse`</span>ï¼ˆ<span class="code">`ThreadLocal&lt;SimpleDateFormat&gt;`</span>ï¼‰ã€‚</span><br><span class="line"><span class="bullet">-</span> æ–°å¢æ—¥æœŸåç§»ä¸åºåˆ—ç”Ÿæˆèƒ½åŠ›ï¼ŒæœåŠ¡äºç»Ÿè®¡æŠ¥è¡¨ã€çœ‹æ¿ã€Top-N è¶‹åŠ¿ç­‰åœºæ™¯ã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**æ–°å¢æ–¹æ³•**</span></span><br><span class="line"><span class="bullet">-</span> <span class="code">`getBeforeDayDate(Integer day)`</span>ï¼šè¿”å› N å¤©å‰çš„æ—¥æœŸå­—ç¬¦ä¸²ï¼ˆ<span class="code">`yyyy-MM-dd`</span>ï¼‰ã€‚å¸¸ç”¨äºæ„é€ æŸ¥è¯¢çš„å¼€å§‹æ—¥æœŸã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="code">`getDayAgo(Integer day)`</span>ï¼šè¿”å› N å¤©å‰çš„ <span class="code">`Date`</span> å¯¹è±¡ï¼Œä¾¿äºä¸æ•°æ®åº“æ—¶é—´å­—æ®µç›´æ¥æ¯”è¾ƒã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="code">`getBeforeDates(Integer beforeDays)`</span>ï¼šç”Ÿæˆæœ€è¿‘ N å¤©çš„æ—¥æœŸå­—ç¬¦ä¸²åˆ—è¡¨ï¼ˆæŒ‰å‡åºï¼šä» N å¤©å‰åˆ°æ˜¨å¤©ï¼‰ï¼Œå¸¸é…åˆç»Ÿè®¡æ›²çº¿è¡¥é›¶ä½¿ç”¨ã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**ä½¿ç”¨å»ºè®®**</span></span><br><span class="line"><span class="bullet">-</span> è‹¥éœ€è¦åŒ…å«â€œä»Šå¤©â€ï¼Œå¯è‡ªè¡Œè¿½åŠ  <span class="code">`LocalDate.now()`</span> æ ¼å¼åŒ–å€¼ã€‚</span><br><span class="line"><span class="bullet">-</span> è·¨æ—¶åŒºåœºæ™¯å»ºè®®ç»Ÿä¸€åœ¨æœåŠ¡ç«¯å›ºå®šæ—¶åŒºæˆ–ä½¿ç”¨ <span class="code">`ZonedDateTime`</span>ã€‚</span><br><span class="line"><span class="bullet">-</span> å¤§æ‰¹é‡æ—¥æœŸåºåˆ—ç”Ÿæˆå»ºè®®åœ¨æœåŠ¡å±‚ç¼“å­˜ï¼Œé¿å…æ¯æ¬¡é‡å¤è®¡ç®—ã€‚</span><br><span class="line"></span><br><span class="line"><span class="section">### FFmpegUtilsï¼ˆç¼©ç•¥å›¾ã€è½¬ç ã€åˆ‡ç‰‡ã€æ—¶é•¿ï¼‰</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>@Component<br>
public class FFmpegUtils {</p>
<pre><code>@Resource
private AppConfig appConfig;


/**
 * ç”Ÿæˆå›¾ç‰‡ç¼©ç•¥å›¾
 *
 * @param filePath
 * @return
 */
public void createImageThumbnail(String filePath) &#123;
    final String CMD_CREATE_IMAGE_THUMBNAIL = &quot;ffmpeg -i \&quot;%s\&quot; -vf scale=200:-1 \&quot;%s\&quot;&quot;;
    String cmd = String.format(CMD_CREATE_IMAGE_THUMBNAIL, filePath, filePath + Constants.IMAGE_THUMBNAIL_SUFFIX);
    ProcessUtils.executeCommand(cmd, appConfig.getShowFFmpegLog());
&#125;


/**
 * è·å–è§†é¢‘ç¼–ç 
 *
 * @param videoFilePath
 * @return
 */
public String getVideoCodec(String videoFilePath) &#123;
    final String CMD_GET_CODE = &quot;ffprobe -v error -select_streams v:0 -show_entries stream=codec_name \&quot;%s\&quot;&quot;;
    String cmd = String.format(CMD_GET_CODE, videoFilePath);
    String result = ProcessUtils.executeCommand(cmd, appConfig.getShowFFmpegLog());
    result = result.replace(&quot;\n&quot;, &quot;&quot;);
    result = result.substring(result.indexOf(&quot;=&quot;) + 1);
    String codec = result.substring(0, result.indexOf(&quot;[&quot;));
    return codec;
&#125;

public void convertHevc2Mp4(String newFileName, String videoFilePath) &#123;
    String CMD_HEVC_264 = &quot;ffmpeg -i %s -c:v libx264 -crf 20 %s&quot;;
    String cmd = String.format(CMD_HEVC_264, newFileName, videoFilePath);
    ProcessUtils.executeCommand(cmd, appConfig.getShowFFmpegLog());
&#125;

public void convertVideo2Ts(File tsFolder, String videoFilePath) &#123;
    final String CMD_TRANSFER_2TS = &quot;ffmpeg -y -i \&quot;%s\&quot;  -vcodec copy -acodec copy -bsf:v h264_mp4toannexb \&quot;%s\&quot;&quot;;
    final String CMD_CUT_TS = &quot;ffmpeg -i \&quot;%s\&quot; -c copy -map 0 -f segment -segment_list \&quot;%s\&quot; -segment_time 10 %s/%%4d.ts&quot;;
    String tsPath = tsFolder + &quot;/&quot; + Constants.TS_NAME;
    //ç”Ÿæˆ.ts
    String cmd = String.format(CMD_TRANSFER_2TS, videoFilePath, tsPath);
    ProcessUtils.executeCommand(cmd, appConfig.getShowFFmpegLog());
    //ç”Ÿæˆç´¢å¼•æ–‡ä»¶.m3u8 å’Œåˆ‡ç‰‡.ts
    cmd = String.format(CMD_CUT_TS, tsPath, tsFolder.getPath() + &quot;/&quot; + Constants.M3U8_NAME, tsFolder.getPath());
    ProcessUtils.executeCommand(cmd, appConfig.getShowFFmpegLog());
    //åˆ é™¤index.ts
    new File(tsPath).delete();
&#125;


public Integer getVideoInfoDuration(String completeVideo) &#123;
    final String CMD_GET_CODE = &quot;ffprobe -v error -show_entries format=duration -of default=noprint_wrappers=1:nokey=1 \&quot;%s\&quot;&quot;;
    String cmd = String.format(CMD_GET_CODE, completeVideo);
    String result = ProcessUtils.executeCommand(cmd, appConfig.getShowFFmpegLog());
    if (StringTools.isEmpty(result)) &#123;
        return 0;
    &#125;
    result = result.replace(&quot;\n&quot;, &quot;&quot;);
    return new BigDecimal(result).intValue();
&#125;
</code></pre>
<p>}</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**å®šä½**</span>ï¼šå°è£…å¸¸ç”¨çš„ FFmpeg/FFprobe å‘½ä»¤ï¼Œç»“åˆ <span class="code">`ProcessUtils`</span> æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å®Œæˆå¤šåª’ä½“å¤„ç†ã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**ä¾èµ–**</span>ï¼š<span class="code">`AppConfig`</span>ï¼ˆæ˜¯å¦æ‰“å°æ—¥å¿—ç­‰å¼€å…³ï¼‰ã€<span class="code">`Constants`</span>ï¼ˆæ–‡ä»¶åå¸¸é‡ï¼‰ã€<span class="code">`ProcessUtils`</span>ï¼ˆè·¨å¹³å°å‘½ä»¤æ‰§è¡Œï¼‰ã€<span class="code">`StringTools`</span>ã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**æ ¸å¿ƒæ–¹æ³•**</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> createImageThumbnail(String filePath)</span><br><span class="line"></span><br><span class="line">  ï¼šç”Ÿæˆå›¾ç‰‡ç¼©ç•¥å›¾</span><br><span class="line"></span><br><span class="line"><span class="bullet">  -</span> å‘½ä»¤ï¼š<span class="code">`ffmpeg -i &quot;æº&quot; -vf scale=200:-1 &quot;æº+ç¼©ç•¥å›¾åç¼€&quot;`</span></span><br><span class="line"><span class="bullet">  -</span> ç­‰æ¯”ç¼©æ”¾åˆ°å®½ 200 åƒç´ ï¼Œé«˜è‡ªé€‚åº”ã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> getVideoCodec(String videoFilePath)</span><br><span class="line"></span><br><span class="line">  ï¼šè¯»å–è§†é¢‘ç¼–ç </span><br><span class="line"></span><br><span class="line"><span class="bullet">  -</span> å‘½ä»¤ï¼š<span class="code">`ffprobe ... -show_entries stream=codec_name`</span></span><br><span class="line"><span class="bullet">  -</span> è§£æè¾“å‡ºå¾—åˆ° <span class="code">`codec`</span>ï¼ˆå¦‚ h264ã€hevcï¼‰ã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> convertHevc2Mp4(String newFileName, String videoFilePath)</span><br><span class="line"></span><br><span class="line">  ï¼šè§†é¢‘è½¬ç </span><br><span class="line"></span><br><span class="line"><span class="bullet">  -</span> å‘½ä»¤ï¼š<span class="code">`ffmpeg -i æº -c:v libx264 -crf 20 ç›®æ ‡`</span></span><br><span class="line"><span class="bullet">  -</span> å°† HEVC è½¬æˆ H.264ï¼Œ<span class="code">`crf=20`</span> è¡¨ç¤ºè´¨é‡ä¸å¤§å°çš„æƒè¡¡ï¼Œå¯æŒ‰éœ€æ±‚è°ƒæ•´ã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> convertVideo2Ts(File tsFolder, String videoFilePath)</span><br><span class="line"></span><br><span class="line">  ï¼šç”Ÿæˆ HLS åˆ‡ç‰‡</span><br><span class="line"></span><br><span class="line"><span class="bullet">  -</span> å…ˆè½¬ä¸­é—´ <span class="code">`index.ts`</span>ï¼Œå†ç”¨ <span class="code">`-f segment -segment_list index.m3u8 -segment_time 10 %04d.ts`</span> åˆ‡ç‰‡ï¼Œæœ€ååˆ é™¤ä¸­é—´æ–‡ä»¶ã€‚</span><br><span class="line"><span class="bullet">  -</span> ç”Ÿæˆ <span class="code">`.m3u8`</span> ä¸å¤šä¸ª <span class="code">`.ts`</span> åˆ‡ç‰‡ï¼Œå¯ç”¨äºç‚¹æ’­/é¢„è§ˆã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> getVideoInfoDuration(String completeVideo)</span><br><span class="line"></span><br><span class="line">  ï¼šè·å–è§†é¢‘æ—¶é•¿ï¼ˆç§’ï¼‰</span><br><span class="line"></span><br><span class="line"><span class="bullet">  -</span> å‘½ä»¤ï¼š<span class="code">`ffprobe ... -show_entries format=duration`</span></span><br><span class="line"><span class="bullet">  -</span> å–è¿”å›ç§’æ•°å­—ç¬¦ä¸²è½¬æ•´å‹ã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**ä½¿ç”¨å»ºè®®**</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> ç¡®ä¿éƒ¨ç½²æœºæœ‰ <span class="code">`ffmpeg`</span>/<span class="code">`ffprobe`</span> å¯æ‰§è¡Œç¨‹åºï¼Œå¹¶åœ¨ PATH ä¸­ã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> å¤§æ–‡ä»¶å¤„ç†å»ºè®®é…åˆå¼‚æ­¥ä»»åŠ¡ä¸è¿›åº¦ä¸ŠæŠ¥ï¼Œé¿å…é˜»å¡è¯·æ±‚çº¿ç¨‹ã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> å¯¹è¾“å…¥/è¾“å‡ºè·¯å¾„åšåˆæ³•æ€§æ£€æŸ¥ï¼Œé¿å…ç©ºæ ¼æˆ–ç‰¹æ®Šå­—ç¬¦å¯¼è‡´å‘½ä»¤å¤±è´¥ã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> è½¬ç å‚æ•°ï¼ˆå¦‚ <span class="code">`crf`</span>ã€ç ç‡ã€åˆ†è¾¨ç‡ï¼‰æ ¹æ®ä¸šåŠ¡å¸¦å®½æˆæœ¬ä¸ç”»è´¨è¦æ±‚è°ƒä¼˜ã€‚</span><br><span class="line"></span><br><span class="line"><span class="section">### ProcessUtilsï¼ˆè·¨å¹³å°å‘½ä»¤æ‰§è¡Œã€è¾“å‡ºæ”¶é›†ã€é’©å­ï¼‰</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>public class ProcessUtils {<br>
private static final Logger logger = LoggerFactory.getLogger(ProcessUtils.class);</p>
<pre><code>private static final String osName = System.getProperty(&quot;os.name&quot;).toLowerCase();

public static String executeCommand(String cmd, Boolean showLog) throws BusinessException &#123;
    if (StringTools.isEmpty(cmd)) &#123;
        return null;
    &#125;

    Runtime runtime = Runtime.getRuntime();
    Process process = null;
    try &#123;
        //åˆ¤æ–­æ“ä½œç³»ç»Ÿ
        if (osName.contains(&quot;win&quot;)) &#123;
            process = Runtime.getRuntime().exec(cmd);
        &#125; else &#123;
            process = Runtime.getRuntime().exec(new String[]&#123;&quot;/bin/sh&quot;, &quot;-c&quot;, cmd&#125;);
        &#125;
        // æ‰§è¡ŒffmpegæŒ‡ä»¤
        // å–å‡ºè¾“å‡ºæµå’Œé”™è¯¯æµçš„ä¿¡æ¯
        // æ³¨æ„ï¼šå¿…é¡»è¦å–å‡ºffmpegåœ¨æ‰§è¡Œå‘½ä»¤è¿‡ç¨‹ä¸­äº§ç”Ÿçš„è¾“å‡ºä¿¡æ¯ï¼Œå¦‚æœä¸å–çš„è¯å½“è¾“å‡ºæµä¿¡æ¯å¡«æ»¡jvmå­˜å‚¨è¾“å‡ºç•™ä¿¡æ¯çš„ç¼“å†²åŒºæ—¶ï¼Œçº¿ç¨‹å°±å›é˜»å¡ä½
        PrintStream errorStream = new PrintStream(process.getErrorStream());
        PrintStream inputStream = new PrintStream(process.getInputStream());
        errorStream.start();
        inputStream.start();
        // ç­‰å¾…ffmpegå‘½ä»¤æ‰§è¡Œå®Œ
        process.waitFor();
        // è·å–æ‰§è¡Œç»“æœå­—ç¬¦ä¸²
        String result = errorStream.stringBuffer.append(inputStream.stringBuffer + &quot;\n&quot;).toString();
        // è¾“å‡ºæ‰§è¡Œçš„å‘½ä»¤ä¿¡æ¯
        if (showLog) &#123;
            logger.info(&quot;æ‰§è¡Œå‘½ä»¤&#123;&#125;ç»“æœ&#123;&#125;&quot;, cmd, result);
        &#125;
        return result;
    &#125; catch (Exception e) &#123;
        logger.error(&quot;æ‰§è¡Œå‘½ä»¤å¤±è´¥cmd&#123;&#125;å¤±è´¥:&#123;&#125; &quot;, cmd, e.getMessage());
        throw new BusinessException(&quot;è§†é¢‘è½¬æ¢å¤±è´¥&quot;);
    &#125; finally &#123;
        if (null != process) &#123;
            ProcessKiller ffmpegKiller = new ProcessKiller(process);
            runtime.addShutdownHook(ffmpegKiller);
        &#125;
    &#125;
&#125;

/**
 * åœ¨ç¨‹åºé€€å‡ºå‰ç»“æŸå·²æœ‰çš„FFmpegè¿›ç¨‹
 */
private static class ProcessKiller extends Thread &#123;
    private Process process;

    public ProcessKiller(Process process) &#123;
        this.process = process;
    &#125;

    @Override
    public void run() &#123;
        this.process.destroy();
    &#125;
&#125;


/**
 * ç”¨äºå–å‡ºffmpegçº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„å„ç§è¾“å‡ºå’Œé”™è¯¯æµçš„ä¿¡æ¯
 */
static class PrintStream extends Thread &#123;
    InputStream inputStream = null;
    BufferedReader bufferedReader = null;
    StringBuffer stringBuffer = new StringBuffer();

    public PrintStream(InputStream inputStream) &#123;
        this.inputStream = inputStream;
    &#125;

    @Override
    public void run() &#123;
        try &#123;
            if (null == inputStream) &#123;
                return;
            &#125;
            bufferedReader = new BufferedReader(new InputStreamReader(inputStream));
            String line = null;
            while ((line = bufferedReader.readLine()) != null) &#123;
                stringBuffer.append(line);
            &#125;
        &#125; catch (Exception e) &#123;
            logger.error(&quot;è¯»å–è¾“å…¥æµå‡ºé”™äº†ï¼é”™è¯¯ä¿¡æ¯ï¼š&quot; + e.getMessage());
        &#125; finally &#123;
            try &#123;
                if (null != bufferedReader) &#123;
                    bufferedReader.close();
                &#125;
                if (null != inputStream) &#123;
                    inputStream.close();
                &#125;
            &#125; catch (IOException e) &#123;
                logger.error(&quot;è°ƒç”¨PrintStreamè¯»å–è¾“å‡ºæµåï¼Œå…³é—­æµæ—¶å‡ºé”™ï¼&quot;);
            &#125;
        &#125;
    &#125;
&#125;
</code></pre>
<p>}</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**å®šä½**</span>ï¼šè·¨å¹³å°æ‰§è¡Œå¤–éƒ¨å‘½ä»¤ï¼ˆWindows/ç±» Unixï¼‰ï¼Œå¹¶å®‰å…¨æ”¶é›†æ ‡å‡†è¾“å‡ºä¸é”™è¯¯è¾“å‡ºï¼Œç»“åˆ <span class="code">`BusinessException`</span> åšç»Ÿä¸€é”™è¯¯æŠ›å‡ºã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**è·¨å¹³å°æ‰§è¡Œ**</span></span><br><span class="line"><span class="bullet">-</span> Windowsï¼š<span class="code">`Runtime.exec(cmd)`</span></span><br><span class="line"><span class="bullet">-</span> Linux/macOSï¼š<span class="code">`Runtime.exec(new String[]&#123;&quot;/bin/sh&quot;,&quot;-c&quot;,cmd&#125;)`</span></span><br><span class="line"><span class="bullet">-</span> é€šè¿‡ <span class="code">`os.name`</span> åˆ¤æ–­ç³»ç»Ÿç±»å‹ã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**è¾“å‡ºæ”¶é›†é˜²é˜»å¡**</span></span><br><span class="line"><span class="bullet">-</span> åŒæ—¶å¯åŠ¨ä¸¤ä¸ªå†…éƒ¨çº¿ç¨‹ <span class="code">`PrintStream`</span> è¯»å– <span class="code">`process.getErrorStream()`</span> ä¸ <span class="code">`process.getInputStream()`</span>ï¼Œé¿å…ç¼“å†²åŒºå¡æ»¡å¯¼è‡´å­è¿›ç¨‹é˜»å¡ã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="code">`waitFor()`</span> ç­‰å¾…å‘½ä»¤æ‰§è¡Œç»“æŸï¼Œå†æ‹¼æ¥ä¸¤è·¯è¾“å‡ºä¸ºç»“æœå­—ç¬¦ä¸²è¿”å›ï¼ˆæŒ‰ <span class="code">`showLog`</span> å†³å®šæ˜¯å¦æ—¥å¿—è¾“å‡ºï¼‰ã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**å¤±è´¥å¤„ç†ä¸é€€å‡ºé’©å­**</span></span><br><span class="line"><span class="bullet">-</span> å‡ºé”™æ—¶è®°å½•é”™è¯¯æ—¥å¿—å¹¶æŠ›å‡º <span class="code">`BusinessException(&quot;è§†é¢‘è½¬æ¢å¤±è´¥&quot;)`</span>ã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="code">`finally`</span> ä¸­æ³¨å†Œ <span class="code">`ProcessKiller`</span> ä½œä¸º JVM é€€å‡ºé’©å­ï¼Œç¡®ä¿è¿›ç¨‹éšåº”ç”¨é€€å‡ºè€Œé”€æ¯ï¼Œé¿å…åƒµå°¸è¿›ç¨‹ã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**ä½¿ç”¨å»ºè®®**</span></span><br><span class="line"><span class="bullet">-</span> ä¼ å…¥çš„ <span class="code">`cmd`</span> è¦å¯¹è¾“å…¥æ–‡ä»¶è·¯å¾„åšè½¬ä¹‰ï¼ˆåŒ…å«ç©ºæ ¼/ç‰¹æ®Šå­—ç¬¦æ—¶éœ€åŠ å¼•å·ï¼‰ã€‚</span><br><span class="line"><span class="bullet">-</span> é•¿æ—¶é—´è¿è¡Œçš„å‘½ä»¤å»ºè®®åœ¨ä¸šåŠ¡å±‚è®¾ç½®è¶…æ—¶ç­–ç•¥æˆ–å¼‚æ­¥åŒ–å¤„ç†ã€‚</span><br><span class="line"><span class="bullet">-</span> è¿”å›ç»“æœå¯ä¾æ®éœ€è¦è¿›ä¸€æ­¥è§£æï¼ˆä¾‹å¦‚ç­›é€‰ ffmpeg çš„è¿›åº¦è¡Œï¼‰ã€‚</span><br><span class="line"></span><br><span class="line"><span class="section">### GatewayExceptionHandlerï¼ˆWebFlux ç½‘å…³ç»Ÿä¸€å¼‚å¸¸ï¼‰</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>@Slf4j<br>
@Order(-1)<br>
@Component<br>
public class GatewayExceptionHandler implements WebExceptionHandler {</p>
<pre><code>protected static final String STATUC_ERROR = &quot;error&quot;;

@Override
public Mono&lt;Void&gt; handle(ServerWebExchange exchange, Throwable throwable) &#123;
    log.error(&quot;ç½‘å…³è¯·æ±‚é”™è¯¯url:&#123;&#125;,é”™è¯¯ä¿¡æ¯&quot;, exchange.getRequest().getPath(), throwable);
    ResponseVO responseVO = getResponse(exchange, throwable);
    ServerHttpResponse response = exchange.getResponse();
    response.getHeaders().setContentType(MediaType.APPLICATION_JSON);
    DataBuffer dataBuffer = response.bufferFactory().wrap(JsonUtils.convertObj2Json(responseVO).getBytes(StandardCharsets.UTF_8));
    return response.writeWith(Mono.just(dataBuffer));
&#125;

private ResponseVO getResponse(ServerWebExchange exchange, Throwable throwable) &#123;
    ResponseVO responseVO = new ResponseVO();
    responseVO.setStatus(STATUC_ERROR);
    if (throwable instanceof ResponseStatusException) &#123;
        ResponseStatusException responseStatusException = (ResponseStatusException) throwable;
        //404
        if (HttpStatus.NOT_FOUND == responseStatusException.getStatus()) &#123;
            responseVO.setCode(ResponseCodeEnum.CODE_404.getCode());
            responseVO.setInfo(ResponseCodeEnum.CODE_404.getMsg());
            return responseVO;
        &#125; else if (HttpStatus.SERVICE_UNAVAILABLE == responseStatusException.getStatus()) &#123;
            //503
            responseVO.setCode(ResponseCodeEnum.CODE_503.getCode());
            responseVO.setInfo(ResponseCodeEnum.CODE_503.getMsg());
            return responseVO;
        &#125; else &#123;
            responseVO.setCode(responseStatusException.getStatus().value());
            responseVO.setInfo(ResponseCodeEnum.CODE_500.getMsg());
            return responseVO;
        &#125;
        //ä¸šåŠ¡å¼‚å¸¸
    &#125; else if (throwable instanceof BusinessException) &#123;
        BusinessException exception = (BusinessException) throwable;
        responseVO.setCode(exception.getCode());
        responseVO.setInfo(exception.getMessage());
        return responseVO;
    &#125;
    responseVO.setCode(ResponseCodeEnum.CODE_500.getCode());
    responseVO.setInfo(ResponseCodeEnum.CODE_500.getMsg());
    return responseVO;
&#125;
</code></pre>
<p>}</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="title">- **å®šä½**:</span> åœ¨ Spring Cloud Gatewayï¼ˆWebFluxï¼‰é“¾è·¯ä¸­ç»Ÿä¸€æ‹¦æˆªå¼‚å¸¸ï¼Œè½¬ä¸ºæ ‡å‡† `ResponseVO` JSON å“åº”ï¼Œä¿è¯å¾®æœåŠ¡å‰ç½®ç½‘å…³çš„å“åº”ä¸€è‡´æ€§ã€‚</span><br><span class="line"></span><br><span class="line">- **å…³é”®ç‚¹**ï¼š</span><br><span class="line"></span><br><span class="line">- `WebExceptionHandler` æ¥å£ï¼›`@Order(-<span class="number">1</span>)` æé«˜ä¼˜å…ˆçº§ï¼Œ`@Component` è‡ªåŠ¨è£…é…ã€‚</span><br><span class="line"></span><br><span class="line">- åœ¨ `handle` ä¸­æ„é€  `ResponseVO`ï¼Œè®¾ç½®å“åº”å¤´ä¸º `application/json`ï¼Œä½¿ç”¨ `JsonUtils` å†™å‡ºã€‚</span><br><span class="line"></span><br><span class="line">- **å¼‚å¸¸æ˜ å°„ç­–ç•¥**ï¼š</span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  ResponseStatusException</span><br></pre></td></tr></table></figure>
<p>:</p>
<ul>
<li>
<p><code>HttpStatus.NOT_FOUND</code> â†’ <code>CODE_404</code></p>
</li>
<li>
<p><code>HttpStatus.SERVICE_UNAVAILABLE</code> â†’ <code>CODE_503</code>ï¼ˆæ³¨æ„ï¼šéœ€è¦åœ¨ <code>ResponseCodeEnum</code> ä¸­æœ‰ 503 å¯¹åº”é¡¹ï¼›è‹¥å½“å‰æ²¡æœ‰ï¼Œè¯·è¡¥å……æšä¸¾ï¼‰</p>
</li>
<li>
<p>å…¶å®ƒ â†’ ä½¿ç”¨çŠ¶æ€ç æœ¬èº«ï¼Œ<code>info</code> ç»Ÿä¸€ä¸º 500 çš„æç¤ºï¼ˆâ€œæœåŠ¡å™¨è¿”å›é”™è¯¯ï¼Œè¯·è”ç³»ç®¡ç†å‘˜â€ï¼‰</p>
</li>
<li>
<pre><code>BusinessException
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  :</span><br><span class="line"></span><br><span class="line"><span class="bullet">  -</span> å–å¼‚å¸¸å†…çš„ <span class="code">`code`</span> ä¸ <span class="code">`message`</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> å…¶å®ƒå¼‚å¸¸:</span><br><span class="line"></span><br><span class="line"><span class="bullet">  -</span> ç»Ÿä¸€æ˜ å°„ä¸º <span class="code">`CODE_500`</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**å“åº”å†™å‡º**</span>ï¼š</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="code">`response.getHeaders().setContentType(MediaType.APPLICATION_JSON)`</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="code">`response.writeWith(Mono.just(buffer))`</span> è¾“å‡º <span class="code">`JsonUtils.convertObj2Json(responseVO)`</span> çš„å­—èŠ‚ã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**ä½¿ç”¨å»ºè®®**</span>ï¼š</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> å»ºè®®å¤ç”¨ä¸ä¸šåŠ¡æœåŠ¡ç«¯ä¸€è‡´çš„ <span class="code">`ResponseVO`</span>ã€<span class="code">`ResponseCodeEnum`</span>ï¼Œé¿å…å‰ç«¯è§£æå·®å¼‚ã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> ç»Ÿä¸€åœ¨ç½‘å…³ä¾§è®°å½• <span class="code">`url + throwable`</span>ï¼Œä¾¿äºé“¾è·¯å®šä½ã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> å¯¹å¤§å¤šæ•°è·¯ç”±å¼‚å¸¸ï¼ˆå¦‚æ²¡æœ‰åŒ¹é…è·¯ç”±ã€æœåŠ¡ä¸å¯ç”¨ï¼‰ç›´æ¥åœ¨æ­¤å¤„è½¬åŒ–ï¼Œé¿å…é€ä¼ åˆ°å‰ç«¯éç»“æ„åŒ–é”™è¯¯ã€‚</span><br><span class="line"></span><br><span class="line"><span class="section">### æ³¨è§£ï¼šGlobalInterceptorï¼ˆå…¨å±€æ‹¦æˆªå¼€å…³ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**å®šä½**</span>ï¼šç”¨äºåœ¨åˆ‡é¢å±‚å®ç°â€œæ˜¯å¦éœ€è¦ç™»å½•â€ç­‰é€šç”¨æ‹¦æˆªé€»è¾‘çš„å¼€å…³æ³¨è§£ã€‚å¯æ ‡æ³¨åœ¨ Controller ç±»æˆ–æ–¹æ³•ä¸Šã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**æ³¨è§£å®šä¹‰**</span>ï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<p>@Target({ElementType.METHOD, ElementType.TYPE})<br>
@Retention(RetentionPolicy.RUNTIME)<br>
public @interface GlobalInterceptor {<br>
boolean checkLogin() default false;<br>
}</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**å…¸å‹ç”¨æ³•**</span>ï¼š</span><br><span class="line"><span class="bullet">-</span> åœ¨æ§åˆ¶å™¨æ–¹æ³•ä¸Šæ ‡æ³¨ <span class="code">`@GlobalInterceptor(checkLogin = true)`</span>ï¼Œç”±å…¨å±€åˆ‡é¢ <span class="code">`GlobalOperationAspect`</span> åœ¨æ–¹æ³•æ‰§è¡Œå‰æ ¡éªŒç™»å½•æ€ï¼ˆå¦‚æ ¡éªŒ tokenã€ä¼šè¯ã€æƒé™ï¼‰ã€‚</span><br><span class="line"><span class="bullet">-</span> æ ‡æ³¨åœ¨ç±»ä¸Šå¯ä½œä¸ºé»˜è®¤ç­–ç•¥ï¼›æ–¹æ³•ä¸Šå†æ¬¡æ ‡æ³¨å¯è¦†ç›–ç±»çº§é»˜è®¤ã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**å®ç°æ€è·¯ï¼ˆåˆ‡é¢ä¾§ï¼‰**</span>ï¼š</span><br><span class="line"><span class="bullet">-</span> åˆ‡ç‚¹ï¼šåŒ¹é…å¸¦æœ‰ <span class="code">`@GlobalInterceptor`</span> çš„ç±»/æ–¹æ³•ã€‚</span><br><span class="line"><span class="bullet">-</span> å‰ç½®é€»è¾‘ï¼šè‹¥ <span class="code">`checkLogin = true`</span>ï¼Œåˆ™è¯»å–ä¸Šä¸‹æ–‡ï¼ˆHeader/Cookie/ThreadLocalï¼‰æ ¡éªŒï¼›å¤±è´¥æŠ› <span class="code">`BusinessException(CODE_600/æœªç™»å½•)`</span>ã€‚</span><br><span class="line"><span class="bullet">-</span> ç»Ÿä¸€å¼‚å¸¸ï¼šç”±å…¨å±€å¼‚å¸¸å¤„ç†å™¨æˆ–ç½‘å…³å¼‚å¸¸å¤„ç†å™¨è½¬æˆæ ‡å‡†å“åº”ã€‚</span><br><span class="line"></span><br><span class="line"><span class="section">### æ³¨è§£ï¼šRecordUserMessageï¼ˆè¡Œä¸ºè½¬æ¶ˆæ¯è®°å½•ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**å®šä½**</span>ï¼šæŠŠç”¨æˆ·è¡Œä¸ºï¼ˆç‚¹èµã€è¯„è®ºã€å›å¤ç­‰ï¼‰åœ¨åˆ‡é¢å±‚è½¬åŒ–ä¸ºç«™å†…æ¶ˆæ¯ï¼Œé€šçŸ¥è¢«å½±å“çš„ç”¨æˆ·ã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**æ³¨è§£å®šä¹‰**</span>ï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>@Target({ElementType.METHOD, ElementType.TYPE})<br>
@Retention(RetentionPolicy.RUNTIME)<br>
public @interface RecordUserMessage {<br>
MessageTypeEnum messageType();<br>
}</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**å…¸å‹ç”¨æ³•**</span>ï¼š</span><br><span class="line"><span class="bullet">-</span> åœ¨â€œç‚¹èµæ¥å£â€ã€â€œè¯„è®ºæ¥å£â€ç­‰æ–¹æ³•ä¸Šæ ‡æ³¨ <span class="code">`@RecordUserMessage(messageType = MessageTypeEnum.LIKE)`</span>ï¼›</span><br><span class="line"><span class="bullet">-</span> åˆ‡é¢åœ¨æ–¹æ³•æˆåŠŸåé‡‡é›†å…³é”®ä¿¡æ¯ï¼ˆæ“ä½œè€…ã€ç›®æ ‡å¯¹è±¡ã€è¢«é€šçŸ¥äººï¼‰ï¼Œå†™å…¥æ¶ˆæ¯è¡¨æˆ–æŠ•é€’æ¶ˆæ¯é˜Ÿåˆ—ã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**å®ç°æ€è·¯ï¼ˆåˆ‡é¢ä¾§ï¼‰**</span>ï¼š</span><br><span class="line"><span class="bullet">-</span> åˆ‡ç‚¹ï¼šåŒ¹é…å¸¦ <span class="code">`@RecordUserMessage`</span> çš„æ–¹æ³•ï¼›</span><br><span class="line"><span class="bullet">-</span> ç¯ç»•/åç½®é€šçŸ¥ï¼šåœ¨æ–¹æ³•æ‰§è¡ŒæˆåŠŸåï¼Œæ„å»ºæ¶ˆæ¯ä½“ï¼ˆç±»å‹ã€ä¸šåŠ¡IDã€è§¦å‘äººã€æ¥æ”¶äººã€æ—¶é—´ï¼‰ï¼›</span><br><span class="line"><span class="bullet">-</span> æŒä¹…åŒ–/æŠ•é€’ï¼šä¿å­˜åˆ° <span class="code">`user_message`</span> è¡¨ï¼Œæˆ–å‘é€ MQï¼ˆKafka/RabbitMQï¼‰ä¾›å¼‚æ­¥æ¶ˆè´¹ï¼›</span><br><span class="line"><span class="bullet">-</span> å¹‚ç­‰ï¼šåŸºäºä¸šåŠ¡é”®ï¼ˆè¡Œä¸ºäºº+ç›®æ ‡+ç±»å‹ï¼‰åšå¹‚ç­‰å»é‡ï¼Œé¿å…é‡å¤æ¶ˆæ¯ï¼›</span><br><span class="line"><span class="bullet">-</span> æ€§èƒ½ï¼šé«˜é¢‘è¡Œä¸ºå»ºè®®å¼‚æ­¥åŒ–ï¼Œé¿å…é˜»å¡ä¸»æµç¨‹ã€‚</span><br><span class="line"></span><br><span class="line"><span class="section">### 11.å…¨æ æ”¶å°¾æ€»ç»“ï¼ˆEasyJava ç”Ÿæˆæ–‡ä»¶è¯¦è§£ + è¡¥å……å·¥å…·ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**å®ä½“ä¸æŸ¥è¯¢å»ºæ¨¡**</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="code">`UserInfo`</span>ï¼ˆPOï¼‰ï¼šä¸¥æ ¼æ˜ å°„ <span class="code">`user_info`</span> å­—æ®µï¼Œæ—¶é—´å­—æ®µç”¨ <span class="code">`@JsonFormat/@DateTimeFormat`</span> ç»Ÿä¸€æ ¼å¼ï¼Œ<span class="code">`toString`</span> ä½¿ç”¨ <span class="code">`DateUtil`</span> ä¸ <span class="code">`DateTimePatternEnum`</span>ã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="code">`UserInfoQuery`</span>ï¼šæ‰¿è½½æ£€ç´¢æ¡ä»¶ï¼Œæä¾›ç²¾ç¡®/æ¨¡ç³Šå­—æ®µä¸æ—¶é—´åŒºé—´ï¼›ç»§æ‰¿ <span class="code">`BaseParam`</span> è·å¾—åˆ†é¡µä¸æ’åºã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="code">`BaseParam`</span>/<span class="code">`SimplePage`</span>ï¼šåˆ†é¡µæ ¸å¿ƒï¼ˆè®¡ç®— <span class="code">`start/end/pageTotal`</span>ï¼‰ï¼Œ<span class="code">`orderBy`</span> ç»Ÿä¸€æ’åºå…¥å‚ã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**æ•°æ®è®¿é—®å±‚ï¼ˆMapper ä¸ XMLï¼‰**</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="code">`BaseMapper`</span>ï¼šé€šç”¨ CRUD/æ‰¹é‡/æŒ‰æ¡ä»¶æ›´æ–°åˆ é™¤ï¼›<span class="code">`BaseMapperTableSplit`</span>ï¼šå¢åŠ  <span class="code">`tableName`</span> æ”¯æŒåˆ†è¡¨ã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="code">```</span></span><br><span class="line"><span class="code">  UserInfoMapper</span></span><br></pre></td></tr></table></figure>
<p>+</p>
  <figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UserInfoMapper.<span class="built_in">xml</span></span><br></pre></td></tr></table></figure>
<p>ï¼š</p>
<ul>
<li>
<p><code>resultMap</code>ã€é€šç”¨åˆ—ç‰‡æ®µã€æ¡ä»¶ç‰‡æ®µï¼ˆç²¾ç¡®/æ¨¡ç³Š/æ—¶é—´åŒºé—´ï¼‰ã€‚</p>
</li>
<li>
<p>åˆ—è¡¨/è®¡æ•°åˆ†é¡µä¸æ’åºï¼›æ’å…¥/æ‰¹é‡/UPSERTï¼›æŒ‰ä¸šåŠ¡é”®ï¼ˆ<code>userId/email</code>ï¼‰ä¾¿æ· CRUDã€‚</p>
</li>
<li>
<p>æ—¶é—´åŒºé—´é—­åŒºé—´å¤„ç†ã€<code>orderBy</code> éœ€ç™½åå•é˜²æ³¨å…¥ã€‚</p>
</li>
<li>
<p><strong>æœåŠ¡ä¸æ§åˆ¶å±‚</strong></p>
</li>
<li>
<p><code>UserInfoService/Impl</code>ï¼šåˆ†é¡µç¼–æ’ï¼ˆå…ˆè®¡æ•°å†æŸ¥åˆ—è¡¨ï¼‰ã€ç©ºé›†åˆçŸ­è·¯ã€<code>StringTools.checkParam</code> é˜²â€œæ— æ¡ä»¶æ›´æ–°/åˆ é™¤â€ã€‚</p>
</li>
<li>
<p><code>UserInfoController</code>ï¼šè·¯ç”±åˆ†ç»„ <code>/userInfo</code>ï¼›æ–°å¢ã€æ‰¹é‡ã€UPSERTï¼ˆæŒ‡å‡ºäº†ä¸€ä¸ªè°ƒç”¨ <code>addBatch</code> çš„å°ç–æ¼åº”ä¸º <code>addOrUpdateBatch</code>ï¼‰ï¼›</p>
</li>
<li>
<p><code>ABaseController</code>ï¼š<code>getSuccessResponseVO/getBusinessErrorResponseVO/getServerErrorResponseVO</code> æ ‡å‡†å“åº”å°è£…ã€‚</p>
</li>
<li>
<p><code>AGlobalExceptionHandlerController</code>ï¼šç»Ÿä¸€å¼‚å¸¸åˆ° <code>ResponseVO</code>ï¼ˆ404/600/601/500 ç­‰ï¼‰ã€‚</p>
</li>
<li>
<p><strong>é€šç”¨å“åº”ä¸æšä¸¾</strong></p>
</li>
<li>
<p><code>ResponseVO&lt;T&gt;</code>ï¼š<code>status/code/info/data</code> å››å…ƒç»„ã€‚</p>
</li>
<li>
<p><code>PaginationResultVO&lt;T&gt;</code>ï¼š<code>totalCount/pageSize/pageNo/pageTotal/list</code>ã€‚</p>
</li>
<li>
<p><code>ResponseCodeEnum</code>ï¼š<code>200/404/600/601/500</code>ï¼ˆç½‘å…³éœ€è¦æ—¶è¡¥å…… <code>503</code>ï¼‰ã€‚</p>
</li>
<li>
<p><code>PageSize</code>ï¼šå¸¸ç”¨é¡µå¤§å°æšä¸¾ï¼ˆ15/20/30/40/50ï¼‰ã€‚</p>
</li>
<li>
<p><strong>å·¥å…·ä¸åŸºç¡€</strong></p>
</li>
<li>
<p>æ—¥æœŸä¸å­—ç¬¦ä¸²</p>
<ul>
<li><code>DateTimePatternEnum</code>ï¼šç»Ÿä¸€æ—¥æœŸæ ¼å¼ã€‚</li>
<li><code>DateUtil</code>ï¼šçº¿ç¨‹å®‰å…¨ <code>format/parse</code>ï¼›æ‰©å±•ç‰ˆæ”¯æŒè·å– N å¤©å‰æ—¥æœŸã€æ—¥æœŸåºåˆ—ã€‚</li>
<li><code>StringTools</code>ï¼š<code>checkParam</code> åå°„æ ¡éªŒæ¡ä»¶éç©ºï¼›<code>isEmpty/upperCaseFirstLetter</code>ã€‚</li>
</ul>
</li>
<li>
<p>ä¸šåŠ¡å¼‚å¸¸</p>
<ul>
<li><code>BusinessException</code>ï¼šæ”¯æŒç +æ¶ˆæ¯/æšä¸¾æ„é€ ï¼Œé‡å†™ <code>fillInStackTrace</code> å…å †æ ˆæå‡æ€§èƒ½ï¼›å…¨å±€å¼‚å¸¸å™¨ç»Ÿä¸€è½¬æ¢ã€‚</li>
</ul>
</li>
<li>
<p>JSON</p>
<ul>
<li><code>JsonUtils</code>ï¼ˆFastjsonï¼‰ï¼šå¯¹è±¡/æ•°ç»„ä¸ JSON äº’è½¬ï¼›æ•æ„Ÿå­—æ®µä¸æ—¶é—´æ ¼å¼éœ€æ³¨æ„ã€‚</li>
</ul>
</li>
<li>
<p>Redis</p>
<ul>
<li><code>RedisConfig</code>ï¼šç»Ÿä¸€ <code>RedisTemplate</code> åºåˆ—åŒ–ï¼ˆString/JSONï¼‰ã€ç›‘å¬å®¹å™¨ã€‚</li>
<li><code>RedisUtils</code>ï¼šKV/TTLã€åˆ—è¡¨é˜Ÿåˆ—ã€ZSet çƒ­æ¦œã€è®¡æ•°å™¨ä¸é¦–åˆ›å»ºè¿‡æœŸã€å‰ç¼€æ‰¹é‡æ‹‰å–ã€‚</li>
</ul>
</li>
<li>
<p>å¤šåª’ä½“ä¸è¿›ç¨‹</p>
<ul>
<li><code>FFmpegUtils</code>ï¼šç¼©ç•¥å›¾ã€ç¼–ç è¯†åˆ«ã€è½¬ç ï¼ˆx264 CRFï¼‰ã€HLS åˆ‡ç‰‡ã€æ—¶é•¿è¯»å–ã€‚</li>
<li><code>ProcessUtils</code>ï¼šè·¨å¹³å°æ‰§è¡Œå‘½ä»¤ã€åŒæµè¯»å–é˜²é˜»å¡ã€JVM é€€å‡ºé’©å­ã€ç»Ÿä¸€å¼‚å¸¸ã€‚</li>
</ul>
</li>
<li>
<p>ç½‘å…³</p>
<ul>
<li><code>GatewayExceptionHandler</code>ï¼šWebFlux ç½‘å…³ç»Ÿä¸€å¼‚å¸¸åˆ° <code>ResponseVO</code>ï¼ˆ404/503/500/ä¸šåŠ¡ç ï¼‰ï¼ŒJSON è¾“å‡ºã€‚</li>
</ul>
</li>
<li>
<p>æ³¨è§£ä¸åˆ‡é¢è¯­ä¹‰</p>
<ul>
<li><code>GlobalInterceptor</code>ï¼šæ§åˆ¶å™¨/æ–¹æ³•çº§ç™»å½•æ ¡éªŒå¼€å…³ï¼Œäº¤ç”±åˆ‡é¢å®ç°ã€‚</li>
<li><code>RecordUserMessage</code>ï¼šè¡Œä¸ºè½¬ç«™å†…æ¶ˆæ¯ï¼Œåˆ‡é¢åœ¨æ–¹æ³•æˆåŠŸåè½åº“/æŠ•é€’ï¼Œå»ºè®®åšå¹‚ç­‰ä¸å¼‚æ­¥åŒ–ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ•´ä½“ä»·å€¼ä¸è½åœ°å»ºè®®</strong></p>
</li>
<li>
<p>ç”Ÿæˆå™¨è¾“å‡ºæ„æˆâ€œä»è¡¨åˆ°æ¥å£â€çš„æœ€å°é—­ç¯ï¼šPO/Query â†’ Mapper/XML â†’ Service â†’ Controller â†’ ç»Ÿä¸€å“åº”/å¼‚å¸¸ã€‚</p>
</li>
<li>
<p>é™æ€è§„èŒƒï¼ˆæ—¶é—´æ ¼å¼ã€åˆ†é¡µã€å“åº”ç ï¼‰+ åŠ¨æ€æ ¡éªŒï¼ˆå‚æ•°éç©ºã€æ’åºç™½åå•ï¼‰ä¿æŒæ¥å£ä¸€è‡´æ€§ä¸å®‰å…¨æ€§ã€‚</p>
</li>
<li>
<p>å¯¹é«˜é¢‘ä¸é‡è®¡ç®—åœºæ™¯æä¾› Redis ä¸å·¥å…·ç±»æ”¯æ’‘ï¼›å¯¹å¤šåª’ä½“åœºæ™¯æä¾› FFmpeg å°è£…ä¸è¿›ç¨‹å®‰å…¨æ‰§è¡Œã€‚</p>
</li>
<li>
<p>å»ºè®®æ¸…å•ï¼š</p>
<ul>
<li>Controller ä¸­ <code>addOrUpdateBatch</code> è°ƒç”¨ä¿®æ­£ä¸º Service çš„åŒåæ–¹æ³•ã€‚</li>
<li><code>orderBy</code> åšç™½åå•æ ¡éªŒï¼›<code>ResponseCodeEnum</code> è¡¥å…… <code>503</code>ï¼ˆè‹¥ä½¿ç”¨ç½‘å…³æ˜ å°„ï¼‰ã€‚</li>
<li>Fastjson/Jackson ç»Ÿä¸€ç­–ç•¥ä¸ç‰ˆæœ¬å®‰å…¨ï¼›<code>JsonUtils</code> ä¿æŠ¤æ•æ„Ÿå­—æ®µã€‚</li>
<li><code>RedisUtils</code> çš„ <code>keys</code>/å‰ç¼€æ“ä½œä»…ç”¨äºè¿ç»´/åå°ä»»åŠ¡ï¼Œåœ¨çº¿è·¯ç”±é¿å…ä½¿ç”¨ã€‚</li>
</ul>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>ä»£ç ç”Ÿæˆå™¨è¯¦è§£</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://itgeqian.github.io/posts/54.html">https://itgeqian.github.io/posts/54.html</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>ä½œè€…</h><div class="post-copyright-cc-info"><h>geqian's BlogğŸ­</h></div></div><div class="post-copyright-c"><h>å‘å¸ƒäº</h><div class="post-copyright-cc-info"><h>2025-09-10</h></div></div><div class="post-copyright-u"><h>æ›´æ–°äº</h><div class="post-copyright-cc-info"><h>2025-09-11</h></div></div><div class="post-copyright-c"><h>è®¸å¯åè®®</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E9%A1%B9%E7%9B%AE%E7%9B%B8%E5%85%B3/"><div class="tags-punctuation"><svg class="faa-tada icon" style="height:1.1em;width:1.1em;fill:currentColor;position:relative;top:2px;margin-right:3px" aria-hidden="true"><use xlink:href="#icon-sekuaibiaoqian"></use></svg></div>é¡¹ç›®ç›¸å…³</a></div></div><link rel="stylesheet" href="/css/coin.css" media="defer" onload="this.media='all'"/><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">æŠ•å–‚ä½œè€…</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://java-geqian.oss-cn-beijing.aliyuncs.com/%E5%BE%AE%E4%BF%A1PAY.jpg" target="_blank"><img class="post-qr-code-img" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/%E5%BE%AE%E4%BF%A1PAY.jpg" alt="å¾®ä¿¡"/></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="https://java-geqian.oss-cn-beijing.aliyuncs.com/%E6%94%AF%E4%BB%98%E5%AE%9DPAY.jpg" target="_blank"><img class="post-qr-code-img" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/%E6%94%AF%E4%BB%98%E5%AE%9DPAY.jpg" alt="æ”¯ä»˜å®"/></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li></ul></div></button></div><audio id="coinAudio" src="https://npm.elemecdn.com/akilar-candyassets@1.0.36/audio/aowu.m4a"></audio><script defer="defer" src="/js/coin.js"></script><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/55.html"><img class="prev-cover" src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">é¡¹ç›®ä¸­çš„VOå’ŒDTO</div></div></a></div><div class="next-post pull-right"><a href="/posts/53.html"><img class="next-cover" src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">AIGCä¹‹Comfyui</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/posts/58.html" title="GQ Musicé¡¹ç›®æ¼”ç¤ºå›¾"><img class="cover" src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-09-26</div><div class="title">GQ Musicé¡¹ç›®æ¼”ç¤ºå›¾</div></div></a></div><div><a href="/posts/43.html" title="GQ Videoé¡¹ç›®ä¼˜åŒ–è®°å½•"><img class="cover" src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-08-03</div><div class="title">GQ Videoé¡¹ç›®ä¼˜åŒ–è®°å½•</div></div></a></div><div><a href="/posts/41.html" title="GQ Videoå•æœåŠ¡æ”¹é€ å¾®æœåŠ¡"><img class="cover" src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-08-11</div><div class="title">GQ Videoå•æœåŠ¡æ”¹é€ å¾®æœåŠ¡</div></div></a></div><div><a href="/posts/37.html" title="GQ Videoå•æœåŠ¡ç‰ˆæœ¬è®°å½•"><img class="cover" src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-08-12</div><div class="title">GQ Videoå•æœåŠ¡ç‰ˆæœ¬è®°å½•</div></div></a></div><div><a href="/posts/55.html" title="é¡¹ç›®ä¸­çš„VOå’ŒDTO"><img class="cover" src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-09-12</div><div class="title">é¡¹ç›®ä¸­çš„VOå’ŒDTO</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><svg class="meta_icon" style="width:22px;height:22px;position:relative;top:5px"><use xlink:href="#icon-mulu1"></use></svg><span style="font-weight:bold">ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-PO%E5%AE%9E%E4%BD%93%E7%B1%BB-UserInfo"><span class="toc-text">1. POå®ä½“ç±»-UserInfo</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UserInfo-%E5%AE%9E%E4%BD%93%E7%B1%BB%EF%BC%88PO%EF%BC%89%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">UserInfo å®ä½“ç±»ï¼ˆPOï¼‰æ˜¯ä»€ä¹ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E6%AE%B5%E4%B8%8E%E8%A1%A8%E7%BB%93%E6%9E%84%E7%9A%84%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB%E4%B8%8E%E6%84%8F%E4%B9%89"><span class="toc-text">å­—æ®µä¸è¡¨ç»“æ„çš„å¯¹åº”å…³ç³»ä¸æ„ä¹‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%AD%97%E6%AE%B5%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E7%BB%91%E5%AE%9A"><span class="toc-text">æ—¶é—´å­—æ®µçš„åºåˆ—åŒ–ä¸ç»‘å®š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Getter-Setter-%E4%B8%8E%E5%8F%AF%E7%A9%BA%E6%80%A7"><span class="toc-text">Getter&#x2F;Setter ä¸å¯ç©ºæ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E8%B7%A8%E5%B1%82%E4%BC%A0%E8%BE%93"><span class="toc-text">å¯åºåˆ—åŒ–ä¸è·¨å±‚ä¼ è¾“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#toString-%E7%94%A8%E4%BA%8E%E8%B0%83%E8%AF%95%E4%B8%8E%E6%97%A5%E5%BF%97"><span class="toc-text">toString ç”¨äºè°ƒè¯•ä¸æ—¥å¿—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8E%E6%9F%A5%E8%AF%A2%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%86%E5%B7%A5"><span class="toc-text">ä¸æŸ¥è¯¢å¯¹è±¡çš„åˆ†å·¥</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Query%EF%BC%88%E6%9F%A5%E8%AF%A2%E5%AF%B9%E8%B1%A1%EF%BC%89-UserInfoQuery-BaseParam-SimplePage"><span class="toc-text">2.Queryï¼ˆæŸ¥è¯¢å¯¹è±¡ï¼‰-UserInfoQuery&#x2F;BaseParam&#x2F;SimplePage</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UserInfoQuery%EF%BC%88%E6%9F%A5%E8%AF%A2%E5%AF%B9%E8%B1%A1%EF%BC%89%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">UserInfoQueryï¼ˆæŸ¥è¯¢å¯¹è±¡ï¼‰æ˜¯ä»€ä¹ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E6%AE%B5%E8%AE%BE%E8%AE%A1%E4%B8%8E%E6%84%8F%E4%B9%89"><span class="toc-text">å­—æ®µè®¾è®¡ä¸æ„ä¹‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BaseParam%EF%BC%88%E5%88%86%E9%A1%B5%E4%B8%8E%E6%8E%92%E5%BA%8F%E5%9F%BA%E7%B1%BB%EF%BC%89"><span class="toc-text">BaseParamï¼ˆåˆ†é¡µä¸æ’åºåŸºç±»ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SimplePage%EF%BC%88%E5%88%86%E9%A1%B5%E6%A0%B8%E5%BF%83%E8%AE%A1%E7%AE%97%EF%BC%89"><span class="toc-text">SimplePageï¼ˆåˆ†é¡µæ ¸å¿ƒè®¡ç®—ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%AF%B9%E8%B1%A1%E7%9A%84%E4%B8%80%E8%88%AC%E4%BD%BF%E7%94%A8%E6%B5%81"><span class="toc-text">æŸ¥è¯¢å¯¹è±¡çš„ä¸€èˆ¬ä½¿ç”¨æµ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-UserInfoMapper-%E4%B8%8E-XML"><span class="toc-text">3. UserInfoMapper ä¸ XML</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UserInfoMapper%EF%BC%88%E6%8E%A5%E5%8F%A3%EF%BC%89%E4%B8%8E-UserInfoMapper-xml%EF%BC%88SQL%EF%BC%89%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">UserInfoMapperï¼ˆæ¥å£ï¼‰ä¸ UserInfoMapper.xmlï¼ˆSQLï¼‰æ˜¯ä»€ä¹ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E6%AE%B5%E6%98%A0%E5%B0%84%E4%B8%8E%E9%80%9A%E7%94%A8%E5%88%97"><span class="toc-text">å­—æ®µæ˜ å°„ä¸é€šç”¨åˆ—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%9E%84%E9%80%A0%EF%BC%88%E7%B2%BE%E7%A1%AE%E3%80%81%E6%A8%A1%E7%B3%8A%E3%80%81%E6%97%B6%E9%97%B4%E5%8C%BA%E9%97%B4%EF%BC%89"><span class="toc-text">æ¡ä»¶æ„é€ ï¼ˆç²¾ç¡®ã€æ¨¡ç³Šã€æ—¶é—´åŒºé—´ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%97%E8%A1%A8%E4%B8%8E%E8%AE%A1%E6%95%B0%EF%BC%88%E5%88%86%E9%A1%B5%E4%B8%8E%E6%8E%92%E5%BA%8F%EF%BC%89"><span class="toc-text">åˆ—è¡¨ä¸è®¡æ•°ï¼ˆåˆ†é¡µä¸æ’åºï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E4%B8%8E%E6%8F%92%E5%85%A5%E6%88%96%E6%9B%B4%E6%96%B0"><span class="toc-text">æ’å…¥ä¸æ’å…¥æˆ–æ›´æ–°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5%E4%B8%8E%E6%89%B9%E9%87%8F-UPSERT"><span class="toc-text">æ‰¹é‡æ’å…¥ä¸æ‰¹é‡ UPSERT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%9B%B4%E6%96%B0%E4%B8%8E%E5%88%A0%E9%99%A4"><span class="toc-text">æ¡ä»¶æ›´æ–°ä¸åˆ é™¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E4%B8%9A%E5%8A%A1%E9%94%AE%E7%9A%84%E5%AE%9A%E5%88%B6%E6%96%B9%E6%B3%95"><span class="toc-text">æŒ‰ä¸šåŠ¡é”®çš„å®šåˆ¶æ–¹æ³•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E8%AE%B2%E8%A7%A3%E5%9F%BA%E7%A1%80-Mapper%EF%BC%88BaseMapper%E3%80%81BaseMapperTableSplit%EF%BC%89"><span class="toc-text">4è®²è§£åŸºç¡€ Mapperï¼ˆBaseMapperã€BaseMapperTableSplitï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#BaseMapper-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%88%E9%80%9A%E7%94%A8-Mapper-%E6%8E%A5%E5%8F%A3%EF%BC%89"><span class="toc-text">BaseMapper æ˜¯ä»€ä¹ˆï¼ˆé€šç”¨ Mapper æ¥å£ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BaseMapperTableSplit-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%88%E5%88%86%E8%A1%A8%E5%9C%BA%E6%99%AF%E7%9A%84%E9%80%9A%E7%94%A8-Mapper%EF%BC%89"><span class="toc-text">BaseMapperTableSplit æ˜¯ä»€ä¹ˆï¼ˆåˆ†è¡¨åœºæ™¯çš„é€šç”¨ Mapperï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%A4%E8%80%85%E5%A6%82%E4%BD%95%E5%8D%8F%E5%90%8C%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90"><span class="toc-text">ä¸¤è€…å¦‚ä½•ååŒä»£ç ç”Ÿæˆ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Service%E5%B1%82"><span class="toc-text">5.Serviceå±‚</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UserInfoService%EF%BC%88%E6%8E%A5%E5%8F%A3%EF%BC%89%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">UserInfoServiceï¼ˆæ¥å£ï¼‰æ˜¯ä»€ä¹ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UserInfoServiceImpl%EF%BC%88%E5%AE%9E%E7%8E%B0%EF%BC%89%E5%81%9A%E4%BA%86%E4%BB%80%E4%B9%88"><span class="toc-text">UserInfoServiceImplï¼ˆå®ç°ï¼‰åšäº†ä»€ä¹ˆ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-Controller%E5%B1%82"><span class="toc-text">6.Controllerå±‚</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UserInfoController%EF%BC%88%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%85%A5%E5%8F%82%E5%87%BA%E5%8F%82%EF%BC%89"><span class="toc-text">UserInfoControllerï¼ˆæ¥å£è®¾è®¡ä¸å…¥å‚å‡ºå‚ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ABaseController%EF%BC%88%E7%BB%9F%E4%B8%80%E5%93%8D%E5%BA%94%E5%8C%85%E8%A3%85%EF%BC%89"><span class="toc-text">ABaseControllerï¼ˆç»Ÿä¸€å“åº”åŒ…è£…ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AGlobalExceptionHandlerController%EF%BC%88%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%EF%BC%89"><span class="toc-text">AGlobalExceptionHandlerControllerï¼ˆå…¨å±€å¼‚å¸¸å¤„ç†ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E5%87%86%E5%93%8D%E5%BA%94%E6%A8%A1%E5%9E%8B"><span class="toc-text">æ ‡å‡†å“åº”æ¨¡å‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E9%80%9A%E7%94%A8%E5%93%8D%E5%BA%94%E6%A8%A1%E5%9E%8B%E4%B8%8E%E6%9E%9A%E4%B8%BE"><span class="toc-text">7.é€šç”¨å“åº”æ¨¡å‹ä¸æšä¸¾</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E5%93%8D%E5%BA%94%E6%A8%A1%E5%9E%8B%E4%B8%8E%E6%9E%9A%E4%B8%BE"><span class="toc-text">é€šç”¨å“åº”æ¨¡å‹ä¸æšä¸¾</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%B7%A5%E5%85%B7%E7%B1%BB%E4%B8%8E%E5%9F%BA%E7%A1%80%E6%9E%9A%E4%B8%BE"><span class="toc-text">8.å·¥å…·ç±»ä¸åŸºç¡€æšä¸¾</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E4%B8%8E%E5%9F%BA%E7%A1%80"><span class="toc-text">å·¥å…·ä¸åŸºç¡€</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E5%9F%BA%E7%A1%80%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B8%8E%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8"><span class="toc-text">9.åŸºç¡€æ§åˆ¶å™¨ä¸å…¨å±€å¼‚å¸¸</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E8%A1%A5%E5%85%85%E7%9A%84%E5%B7%A5%E5%85%B7%E7%B1%BB%EF%BC%88%E5%B8%B8%E7%94%A8%EF%BC%89"><span class="toc-text">10.è¡¥å……çš„å·¥å…·ç±»ï¼ˆå¸¸ç”¨ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JsonUtils%EF%BC%88%E5%AF%B9%E8%B1%A1-%E6%95%B0%E7%BB%84-JSON-%E8%BD%AC%E6%8D%A2%EF%BC%89"><span class="toc-text">JsonUtilsï¼ˆå¯¹è±¡&#x2F;æ•°ç»„ JSON è½¬æ¢ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RedisConfig%EF%BC%88%E5%BA%8F%E5%88%97%E5%8C%96%E7%AD%96%E7%95%A5%E4%B8%8E%E5%AE%B9%E5%99%A8%EF%BC%89"><span class="toc-text">RedisConfigï¼ˆåºåˆ—åŒ–ç­–ç•¥ä¸å®¹å™¨ï¼‰</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-color: transparent;"><div id="footer-wrap"><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">æ ¼è¨€ğŸ§¬</p><div class="bg-ad"><div>å†çœ‹çœ‹é‚£ä¸ªå…‰ç‚¹ï¼Œå®ƒå°±åœ¨è¿™é‡Œï¼Œè¿™æ˜¯å®¶å›­ï¼Œè¿™æ˜¯æˆ‘ä»¬ â€”â€” ä½ æ‰€çˆ±çš„æ¯ä¸€ä¸ªäººï¼Œä½ è®¤è¯†çš„ä¸€ä¸ªäººï¼Œä½ å¬è¯´è¿‡çš„æ¯ä¸€ä¸ªäººï¼Œæ›¾ç»æœ‰è¿‡çš„æ¯ä¸€ä¸ªäººï¼Œéƒ½åœ¨å®ƒä¸Šé¢åº¦è¿‡ä»–ä»¬çš„ä¸€ç”Ÿâœ¨</div><div class="btn-xz-box"><a class="btn-xz" target="_blank" rel="noopener" href="https://stellarium.org/">ç‚¹å‡»å¼€å¯æ˜Ÿè¾°ä¹‹æ—…</a></div></div></div><div class="t-t-r"><p class="ft-t t-l-t">çŒœä½ æƒ³çœ‹ğŸ’¡</p><ul class="ft-links"><li><a href="/comments/">ç•™ç‚¹ä»€ä¹ˆ</a><a href="/archives/">æ–‡ç« å½’æ¡£</a></li><li><a href="/categories/">æ–‡ç« åˆ†ç±»</a><a href="/tags/">æ–‡ç« æ ‡ç­¾</a></li><li><a href="/box/Gallery/">æˆ‘çš„ç”»å»Š</a><a href="/personal/bb/">æˆ‘çš„å” å¨</a></li><li><a href="/site/time/">å»ºè®¾è¿›ç¨‹</a><a href="/site/census/">ç½‘ç«™ç»Ÿè®¡</a></li></ul></div></div></div><div class="ft-item-2"><p class="ft-t">æ¨èå‹é“¾âŒ›</p><div class="ft-img-group"><div class="img-group-item"></div></div></div></div><div class="copyright"><span><b>&copy;2022-2025</b></span><span><b>&nbsp;&nbsp;By geqian's BlogğŸ­</b></span></div><div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://icp.gov.moe/?keyword=20230913" style="margin-inline:5px" title="æœ¬ç«™å·²åŠ å…¥èŒICPè±ªåå¥—é¤ï¼ŒèŒICPå¤‡20230913å·"><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/20230913.svg" alt=""/></a></p></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><a class="icon-V hidden" onclick="switchNightMode()" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button><button class="share" type="button" title="å³é”®æ¨¡å¼" onclick="changeMouseMode()"><i class="fas fa-mouse"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog right_side"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button class="share" type="button" title="åˆ†äº«é“¾æ¥" onclick="share()"><i class="fas fa-share-nodes"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i><span id="percent">0<span>%</span></span></button><button id="go-down" type="button" title="ç›´è¾¾åº•éƒ¨" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();"><i class="fa fa-arrow-up"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa fa-copy"></i><span>å¤åˆ¶</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();"><i class="fa fa-search"></i><span>ç™¾åº¦æœç´¢</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();"><i class="fa fa-link"></i><span>è½¬åˆ°é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()"><i class="fa fa-copy"></i><span>ç²˜è´´</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="#post-comment"><i class="fas fa-comment"></i><span>ç©ºé™è¯„è®º</span></a><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()"><i class="fa fa-link"></i><span>å¤åˆ¶æœ¬æ–‡åœ°å€</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>æ–°çª—å£æ‰“å¼€</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()"><i class="fa fa-link"></i><span>è½¬åˆ°é“¾æ¥</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>å¤åˆ¶é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()"><i class="fa fa-download"></i><span>ä¿å­˜å›¾ç‰‡</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>åœ¨æ–°çª—å£æ‰“å¼€</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>å¤åˆ¶å›¾ç‰‡é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:randomPost()"><i class="fa fa-paper-plane"></i><span>éšä¾¿é€›é€›</span></a><a class="rightMenu-item" href="javascript:switchNightMode();"><i class="fa fa-moon"></i><span>æ˜¼å¤œåˆ‡æ¢</span></a><a class="rightMenu-item" href="/personal/about/"><i class="fa fa-info-circle"></i><span>å…³äºåšå®¢</span></a><a class="rightMenu-item" href="javascript:toggleWinbox();"><i class="fas fa-cog"></i><span>ç¾åŒ–è®¾ç½®</span></a><a class="rightMenu-item" href="javascript:rmf.fullScreen();"><i class="fas fa-expand"></i><span>åˆ‡æ¢å…¨å±</span></a><a class="rightMenu-item" href="javascript:window.print();"><i class="fa-solid fa-print"></i><span>æ‰“å°é¡µé¢</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><script async="async">var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())
setTimeout(function(){preloader.endLoading();}, 5000);
document.getElementById('loading-box').addEventListener('click',()=> {preloader.endLoading()})</script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: '',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: '',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.staticfile.org/twikoo/1.6.8/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script async src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><script async src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script><script defer type="text/javascript" src="https://cdn1.tianli0.top/npm/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script defer src="https://cdn1.tianli0.top/gh/nextapps-de/winbox/dist/winbox.bundle.min.js"></script><script async src="//at.alicdn.com/t/c/font_3586335_hsivh70x0fm.js"></script><script async src="//at.alicdn.com/t/c/font_3636804_gr02jmjr3y9.js"></script><script async src="//at.alicdn.com/t/c/font_3612150_kfv55xn3u2g.js"></script><script async src="https://cdn.wpon.cn/2022-sucai/Gold-ingot.js"></script><canvas id="universe"></canvas><canvas id="snow"></canvas><script defer src="/js/fomal.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn1.tianli0.top/npm/js-heo@1.0.12/metingjs/Meting.min.js"></script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax","#bibi","body > title","#app","#tag-echarts","#posts-echart","#categories-echarts"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/å­¦ä¹ ç¬”è®°/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¡ geqianã®å­¦ä¹ ç¬”è®° (10)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/æ‚é¡¹/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¼ geqianã®æ‚é¡¹ (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/é¡¹ç›®/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ‰ geqianã®é¡¹ç›®ç¬”è®° (6)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/AI/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¨ geqianã®AIå¤§æ¨¡å‹ (6)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/ç®—æ³•/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸŸ geqianã®ç®—æ³•å­¦ä¹ ç¬”è®° (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/é¢è¯•/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¥ geqianã®é¢è¯• (18)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/JUC/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸŒ geqianã®JUC (4)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/JVM/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸœ geqianã®JVM (5)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/äº‘åŸç”Ÿ/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ” geqianã®äº‘åŸç”Ÿç›¸å…³ (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/MQ/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ“± geqianã®æ¶ˆæ¯é˜Ÿåˆ— (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/å‰ç«¯/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ›ï¸ geqianã®å‰ç«¯å·¥ç¨‹ (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/mybatis-mybatis-plus/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¨ geqianã®mybatisç³»åˆ— (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/å¾®æœåŠ¡/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ—ºï¸ geqianã®SpringCloudç³»åˆ— (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/SSM/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ“– geqianã®SSM+SpringBootç³»åˆ— (7)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/ruoyi/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ“ geqianã®è‹¥ä¾æ¡†æ¶ (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/mysql/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">â“ geqianã®mysql (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/Redis/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ’– geqianã®Redis (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item" style="visibility: hidden"></div><a class="magnet_link_more"  href="https://itgeqian.github.io/categories/" style="flex:1;text-align: center;margin-bottom: 10px;">æŸ¥çœ‹æ›´å¤š...</a></div></div>';
    console.log('å·²æŒ‚è½½magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(33.333333333333336% - 5px);background: #e9e9e9;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: var(--text-bg-hover)}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/60.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/%E5%8F%A4%E9%A3%8E.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-09-30</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/60.html&quot;);" href="javascript:void(0);" alt="">é€Ÿé€šSpring AI Alibaba </a><div class="blog-slider__text">é€Ÿé€šSpring AI Alibaba å®Œç»“</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/60.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/37.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-04-02</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/37.html&quot;);" href="javascript:void(0);" alt="">GQ Videoå•æœåŠ¡ç‰ˆæœ¬è®°å½•</a><div class="blog-slider__text">GQ Videoå•æœåŠ¡ç‰ˆæœ¬è®°å½•ï¼ˆå®Œæ•´è®°å½•GQ Videoä»0åˆ°1çš„å…¨è®°å½•ï¼‰</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/37.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/1.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-05-20</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/1.html&quot;);" href="javascript:void(0);" alt="">å®éªŒä¸‰ æ±½è½¦ç§Ÿèµç³»ç»Ÿçš„UMLè®¾è®¡å»ºæ¨¡ ï¼ˆå®Œç»“ï¼‰</a><div class="blog-slider__text">å…³äºæ±½è½¦ç§Ÿèµç³»ç»Ÿçš„UMLè®¾è®¡å»ºæ¨¡</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/1.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/74.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-09-06</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/74.html&quot;);" href="javascript:void(0);" alt="">Mysqlç›¸å…³é¢è¯•é¢˜</a><div class="blog-slider__text">æˆ‘å¯¹mysqlçš„ç›¸å…³ç†è§£</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/74.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/77.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-10-07</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/77.html&quot;);" href="javascript:void(0);" alt="">javase+é›†åˆç›¸å…³é¢è¯•é¢˜</a><div class="blog-slider__text">æˆ‘å¯¹javaåŸºç¡€å’Œé›†åˆç±»çš„ç›¸å…³ç†è§£</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/77.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/68.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-10-01</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/68.html&quot;);" href="javascript:void(0);" alt="">JUCé¢è¯•é¢˜</a><div class="blog-slider__text">æˆ‘å¯¹JUCçš„ç†è§£</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/68.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('å·²æŒ‚è½½butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper@1.0.12/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper@1.0.12/lib/swiper_init.js"></script><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementById('gitZone');
      var item_html = '<div class="recent-post-item" id="gitcalendarBar" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 320px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('å·²æŒ‚è½½gitcalendar')
      }

    if( document.getElementById('gitZone') && (location.pathname ==='/site/census/'|| '/site/census/' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("/api?null",['#d9e0df', '#c6e0dc', '#a8dcd4', '#9adcd2', '#89ded1', '#77e0d0', '#5fdecb', '#47dcc6', '#39dcc3', '#1fdabe', '#00dab9'],'null')
    }
  </script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>