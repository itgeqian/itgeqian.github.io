<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><div id="myscoll"></div><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>GQ Videoå•æœåŠ¡æ”¹é€ å¾®æœåŠ¡ | geqian's BlogğŸ­</title><meta name="keywords" content="é¡¹ç›®ç›¸å…³"><meta name="author" content="geqian's BlogğŸ­"><meta name="copyright" content="geqian's BlogğŸ­"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="GQ Videoå•æœåŠ¡æ”¹é€ å¾®æœåŠ¡">
<meta property="og:type" content="article">
<meta property="og:title" content="GQ Videoå•æœåŠ¡æ”¹é€ å¾®æœåŠ¡">
<meta property="og:url" content="https://itgeqian.github.io/posts/41.html">
<meta property="og:site_name" content="geqian&#39;s BlogğŸ­">
<meta property="og:description" content="GQ Videoå•æœåŠ¡æ”¹é€ å¾®æœåŠ¡">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/29.jpg">
<meta property="article:published_time" content="2025-06-10T02:19:03.000Z">
<meta property="article:modified_time" content="2025-08-10T17:23:00.000Z">
<meta property="article:author" content="geqian&#39;s BlogğŸ­">
<meta property="article:tag" content="é¡¹ç›®ç›¸å…³">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/29.jpg"><link rel="shortcut icon" href="/"><link rel="canonical" href="https://itgeqian.github.io/posts/41"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.js',
      css: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'GQ Videoå•æœåŠ¡æ”¹é€ å¾®æœåŠ¡',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-08-11 01:23:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><style id="themeColor"></style><style id="rightSide"></style><style id="transPercent"></style><style id="blurNum"></style><style id="settingStyle"></style><span id="fps"></span><style id="defineBg"></style><style id="menu_shadow"></style><script src="https://cdn.jsdelivr.net/npm/echarts@6/dist/echarts.min.js"></script><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper@1.0.12/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper@1.0.12/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="geqian's BlogğŸ­" type="application/atom+xml">
</head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/assets/avatar.png" onerror="onerror=null;src='/assets/r1.jpg'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">83</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">51</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">18</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--article"></use></svg><span class="menu_word" style="font-size:17px"> æ–‡ç« </span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> å½’æ¡£</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> æ ‡ç­¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei">                   </use></svg><span class="menu_word" style="font-size:17px"> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pinweishenghuo"></use></svg><span class="menu_word" style="font-size:17px"> ä¼‘é—²</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/life/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-yinle">                   </use></svg><span class="menu_word" style="font-size:17px"> å…«éŸ³ç›’</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-dianying1">                   </use></svg><span class="menu_word" style="font-size:17px"> å½±é™¢</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-youxishoubing">                   </use></svg><span class="menu_word" style="font-size:17px"> æ¸¸æˆ</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xiangzi"></use></svg><span class="menu_word" style="font-size:17px"> å…«å®ç®±</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/box/gallery/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-tubiaozhizuomoban">                   </use></svg><span class="menu_word" style="font-size:17px"> ç”»å»Š</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/animation/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-nvwumao">                   </use></svg><span class="menu_word" style="font-size:17px"> åŠ¨ç”»</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-zhifengche">                   </use></svg><span class="menu_word" style="font-size:17px"> ç½‘å€å¯¼èˆª</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> ç¤¾äº¤</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pengyouquan">                   </use></svg><span class="menu_word" style="font-size:17px"> æœ‹å‹åœˆ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> ç•™è¨€æ¿</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> å‹äººå¸</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangye"></use></svg><span class="menu_word" style="font-size:17px"> ç½‘ç«™</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/site/census/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--tongjibiao">                   </use></svg><span class="menu_word" style="font-size:17px"> ç½‘ç«™ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujutongji1">                   </use></svg><span class="menu_word" style="font-size:17px"> æ–‡ç« ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/time/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xianxingshalou">                   </use></svg><span class="menu_word" style="font-size:17px"> æ—§æ—¶å…‰</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">geqian's BlogğŸ­</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--article"></use></svg><span class="menu_word" style="font-size:17px"> æ–‡ç« </span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> å½’æ¡£</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> æ ‡ç­¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei">                   </use></svg><span class="menu_word" style="font-size:17px"> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pinweishenghuo"></use></svg><span class="menu_word" style="font-size:17px"> ä¼‘é—²</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/life/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-yinle">                   </use></svg><span class="menu_word" style="font-size:17px"> å…«éŸ³ç›’</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-dianying1">                   </use></svg><span class="menu_word" style="font-size:17px"> å½±é™¢</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-youxishoubing">                   </use></svg><span class="menu_word" style="font-size:17px"> æ¸¸æˆ</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xiangzi"></use></svg><span class="menu_word" style="font-size:17px"> å…«å®ç®±</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/box/gallery/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-tubiaozhizuomoban">                   </use></svg><span class="menu_word" style="font-size:17px"> ç”»å»Š</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/animation/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-nvwumao">                   </use></svg><span class="menu_word" style="font-size:17px"> åŠ¨ç”»</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-zhifengche">                   </use></svg><span class="menu_word" style="font-size:17px"> ç½‘å€å¯¼èˆª</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> ç¤¾äº¤</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pengyouquan">                   </use></svg><span class="menu_word" style="font-size:17px"> æœ‹å‹åœˆ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> ç•™è¨€æ¿</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> å‹äººå¸</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangye"></use></svg><span class="menu_word" style="font-size:17px"> ç½‘ç«™</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/site/census/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--tongjibiao">                   </use></svg><span class="menu_word" style="font-size:17px"> ç½‘ç«™ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujutongji1">                   </use></svg><span class="menu_word" style="font-size:17px"> æ–‡ç« ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/time/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xianxingshalou">                   </use></svg><span class="menu_word" style="font-size:17px"> æ—§æ—¶å…‰</span></a></li></ul></div></div><center id="name-container"><a id="page-name" href="javascript:scrollToTop()">PAGE_NAME</a></center><div id="nav-right"><div id="search-button"><a class="search faa-parent animated-hover" title="æ£€ç´¢ç«™å†…ä»»ä½•ä½ æƒ³è¦çš„ä¿¡æ¯"><svg class="faa-tada icon" style="height:24px;width:24px;fill:currentColor;position:relative;top:6px" aria-hidden="true"><use xlink:href="#icon-valentine_-search-love-find-heart"></use></svg><span> æœç´¢</span></a></div><a class="meihua faa-parent animated-hover" onclick="toggleWinbox()" title="ç¾åŒ–è®¾ç½®-è‡ªå®šä¹‰ä½ çš„é£æ ¼" id="meihua-button"><svg class="faa-tada icon" style="height:26px;width:26px;fill:currentColor;position:relative;top:8px" aria-hidden="true"><use xlink:href="#icon-tupian1"></use></svg></a><a class="sun_moon faa-parent animated-hover" onclick="switchNightMode()" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢" id="nightmode-button"><svg class="faa-tada" style="height:25px;width:25px;fill:currentColor;position:relative;top:7px" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon">       </use></svg></a><div id="toggle-menu"><a><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-info"><h1 class="post-title">GQ Videoå•æœåŠ¡æ”¹é€ å¾®æœåŠ¡</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><svg class="meta_icon post-meta-icon" style="width:30px;height:30px;position:relative;top:10px"><use xlink:href="#icon-rili"></use></svg><span class="post-meta-label">å‘è¡¨äº </span><time class="post-meta-date-created" datetime="2025-06-10T02:19:03.000Z" title="å‘è¡¨äº 2025-06-10 10:19:03">2025-06-10</time><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-gengxin1"></use></svg><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-08-10T17:23:00.000Z" title="æ›´æ–°äº 2025-08-11 01:23:00">2025-08-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-biaoqian"></use></svg><a class="post-meta-categories" href="/categories/%E9%A1%B9%E7%9B%AE/">é¡¹ç›®</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:8px"><use xlink:href="#icon-charuword"></use></svg><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">2w</span><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:20px;height:20px;position:relative;top:5px"><use xlink:href="#icon-shizhong"></use></svg><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>100åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="GQ Videoå•æœåŠ¡æ”¹é€ å¾®æœåŠ¡"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:5px"><use xlink:href="#icon-eye"></use></svg><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="1-ç³»ç»Ÿæ¶æ„å›¾">1.ç³»ç»Ÿæ¶æ„å›¾</h2>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1157-1024x732.png" alt="img"></p>
<h2 id="2-æ„å»ºé¡¹ç›®">2.æ„å»ºé¡¹ç›®</h2>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1159.png" alt="img"></p>
<h3 id="å„ä¸ªæ¨¡å—pom-xml">å„ä¸ªæ¨¡å—pom.xml</h3>
<h4 id="æ ¹ç›®å½•pom">æ ¹ç›®å½•pom</h4>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.easylive.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easylive-cloud<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>easylive-cloud-base<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>easylive-cloud-common<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>easylive-cloud-gateway<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>easylive-cloud-web<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>easylive-cloud-admin<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>easylive-cloud-resource<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>easylive-cloud-interact<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">skipTests</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skipTests</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">springboot.version</span>&gt;</span>2.7.18<span class="tag">&lt;/<span class="name">springboot.version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">spring-cloud.version</span>&gt;</span>2021.0.6<span class="tag">&lt;/<span class="name">spring-cloud.version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">spring-cloud-alibaba.version</span>&gt;</span>2021.0.5.0<span class="tag">&lt;/<span class="name">spring-cloud-alibaba.version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">spring-openfeign.version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">spring-openfeign.version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">spring-cloud-gateway.version</span>&gt;</span>3.1.9<span class="tag">&lt;/<span class="name">spring-cloud-gateway.version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">mybatis.version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">mybatis.version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">logback.version</span>&gt;</span>1.2.10<span class="tag">&lt;/<span class="name">logback.version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>8.0.23<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">aspectjweaver.version</span>&gt;</span>1.9.3<span class="tag">&lt;/<span class="name">aspectjweaver.version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">fastjson.version</span>&gt;</span>1.2.83<span class="tag">&lt;/<span class="name">fastjson.version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">commons.lang3.version</span>&gt;</span>3.4<span class="tag">&lt;/<span class="name">commons.lang3.version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">commons.csv.version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">commons.csv.version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">commons.codec.version</span>&gt;</span>1.9<span class="tag">&lt;/<span class="name">commons.codec.version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">commons.io.version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">commons.io.version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">feign-okhttp.version</span>&gt;</span>10.2.0<span class="tag">&lt;/<span class="name">feign-okhttp.version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">okhttp3.version</span>&gt;</span>4.12.0<span class="tag">&lt;/<span class="name">okhttp3.version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">lombok.version</span>&gt;</span>1.18.22<span class="tag">&lt;/<span class="name">lombok.version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">captcha.verion</span>&gt;</span>1.6.2<span class="tag">&lt;/<span class="name">captcha.verion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">es.version</span>&gt;</span>3.3.2<span class="tag">&lt;/<span class="name">es.version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;springboot.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;spring-cloud.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="comment">&lt;!-- SpringCloud Alibaba å¾®æœåŠ¡ --&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;spring-cloud-alibaba.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;spring-openfeign.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="comment">&lt;!--ç½‘å…³--&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;spring-cloud-gateway.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="comment">&lt;!--seata--&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-seata<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2021.0.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;mybatis.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="comment">&lt;!-- æ•°æ®åº“--&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;mysql.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="comment">&lt;!-- æ—¥å¿—ç‰ˆæœ¬ --&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;logback.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;logback.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="comment">&lt;!--åˆ‡é¢--&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;aspectjweaver.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="comment">&lt;!--okhttp--&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.squareup.okhttp3<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>okhttp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;okhttp3.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="comment">&lt;!--fastjson--&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;fastjson.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="comment">&lt;!--apache common--&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-csv<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;commons.csv.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;commons.lang3.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;commons.codec.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;commons.io.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;springboot.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;lombok.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;es.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.whvcse<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easy-captcha<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;captcha.verion&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1338.png" alt="img"></p>
<h4 id="adminæ¨¡å—pom">adminæ¨¡å—pom</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.easylive.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easylive-cloud<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.easylive.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easylive-cloud-admin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">skipTests</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skipTests</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.easylive.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easylive-cloud-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.easylive.EasyliveCloudAdminRunApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="baseæ¨¡å—pom">baseæ¨¡å—pom</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.easylive.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easylive-cloud<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.easylive.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easylive-cloud-base<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">skipTests</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skipTests</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ—¥å¿—ç‰ˆæœ¬ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--fastjson--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--apache common--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-csv<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-seata<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="commonæ¨¡å—pom">commonæ¨¡å—pom</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.easylive.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easylive-cloud<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.easylive.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easylive-cloud-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">skipTests</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skipTests</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.easylive.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easylive-cloud-base<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--nacosçš„é…ç½®ç®¡ç†ä¾èµ–--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--è´Ÿè½½å‡è¡¡--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--mybatis--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- æ•°æ®åº“--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--åˆ‡é¢--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--okhttp--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.squareup.okhttp3<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>okhttp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.squareup.okhttp3<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>okhttp-sse<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.openfeign<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>feign-okhttp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.whvcse<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easy-captcha<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="gatewayæ¨¡å—pom">gatewayæ¨¡å—pom</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.easylive.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easylive-cloud<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.easylive<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easylive-cloud-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">skipTests</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skipTests</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.easylive.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easylive-cloud-base<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--nacosçš„é…ç½®ç®¡ç†ä¾èµ–--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--è´Ÿè½½å‡è¡¡--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.easylive.gateway.EasyliveCloudGatewayRunApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="interactæ¨¡å—pom">interactæ¨¡å—pom</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.easylive.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easylive-cloud<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.easylive.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easylive-cloud-interact<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">skipTests</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skipTests</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.easylive.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easylive-cloud-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.easylive.EasyliveCloudInteractRunApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="resourceæ¨¡å—pom">resourceæ¨¡å—pom</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.easylive.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easylive-cloud<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.easylive.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easylive-cloud-resource<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">skipTests</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skipTests</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.easylive.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easylive-cloud-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.easylive.resource.EasyliveCloudResourceRunApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="webæ¨¡å—pom">webæ¨¡å—pom</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.easylive.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easylive-cloud<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.easylive<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easylive-cloud-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">skipTests</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skipTests</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.easylive.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easylive-cloud-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.easylive.EasyliveCloudWebRunApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1339.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1340-877x1024.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1341-885x1024.png" alt="img"></p>
<h2 id="3-nacoså®ä¾‹">3.nacoså®ä¾‹</h2>
<h3 id="1-seataé…ç½®æ–‡ä»¶">1.seataé…ç½®æ–‡ä»¶</h3>
<p>seataServer.properties</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#For details about configuration items, see https://seata.io/zh-cn/docs/user/configurations.html</span></span><br><span class="line"><span class="comment">#Transport configuration, for client and server</span></span><br><span class="line"><span class="attr">transport.type</span>=TCP</span><br><span class="line"><span class="attr">transport.server</span>=NIO</span><br><span class="line"><span class="attr">transport.heartbeat</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">transport.enableTmClientBatchSendRequest</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">transport.enableRmClientBatchSendRequest</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">transport.enableTcServerBatchSendResponse</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">transport.rpcRmRequestTimeout</span>=<span class="number">30000</span></span><br><span class="line"><span class="attr">transport.rpcTmRequestTimeout</span>=<span class="number">30000</span></span><br><span class="line"><span class="attr">transport.rpcTcRequestTimeout</span>=<span class="number">30000</span></span><br><span class="line"><span class="attr">transport.threadFactory.bossThreadPrefix</span>=NettyBoss</span><br><span class="line"><span class="attr">transport.threadFactory.workerThreadPrefix</span>=NettyServerNIOWorker</span><br><span class="line"><span class="attr">transport.threadFactory.serverExecutorThreadPrefix</span>=NettyServerBizHandler</span><br><span class="line"><span class="attr">transport.threadFactory.shareBossWorker</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">transport.threadFactory.clientSelectorThreadPrefix</span>=NettyClientSelector</span><br><span class="line"><span class="attr">transport.threadFactory.clientSelectorThreadSize</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">transport.threadFactory.clientWorkerThreadPrefix</span>=NettyClientWorkerThread</span><br><span class="line"><span class="attr">transport.threadFactory.bossThreadSize</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">transport.threadFactory.workerThreadSize</span>=default</span><br><span class="line"><span class="attr">transport.shutdown.wait</span>=<span class="number">3</span></span><br><span class="line"><span class="attr">transport.serialization</span>=seata</span><br><span class="line"><span class="attr">transport.compressor</span>=none</span><br><span class="line"></span><br><span class="line"><span class="comment">#Transaction routing rules configuration, only for the client</span></span><br><span class="line"><span class="attr">service.vgroupMapping.default_tx_group</span>=default</span><br><span class="line"><span class="comment">#If you use a registry, you can ignore it</span></span><br><span class="line"><span class="attr">service.default.grouplist</span>=<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8091</span></span><br><span class="line"><span class="attr">service.enableDegrade</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">service.disableGlobalTransaction</span>=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Transaction rule configuration, only for the client</span></span><br><span class="line"><span class="attr">client.rm.asyncCommitBufferLimit</span>=<span class="number">10000</span></span><br><span class="line"><span class="attr">client.rm.lock.retryInterval</span>=<span class="number">10</span></span><br><span class="line"><span class="attr">client.rm.lock.retryTimes</span>=<span class="number">30</span></span><br><span class="line"><span class="attr">client.rm.lock.retryPolicyBranchRollbackOnConflict</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">client.rm.reportRetryCount</span>=<span class="number">5</span></span><br><span class="line"><span class="attr">client.rm.tableMetaCheckEnable</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">client.rm.tableMetaCheckerInterval</span>=<span class="number">60000</span></span><br><span class="line"><span class="attr">client.rm.sqlParserType</span>=druid</span><br><span class="line"><span class="attr">client.rm.reportSuccessEnable</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">client.rm.sagaBranchRegisterEnable</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">client.rm.sagaJsonParser</span>=fastjson</span><br><span class="line"><span class="attr">client.rm.tccActionInterceptorOrder</span>=-<span class="number">2147482648</span></span><br><span class="line"><span class="attr">client.tm.commitRetryCount</span>=<span class="number">5</span></span><br><span class="line"><span class="attr">client.tm.rollbackRetryCount</span>=<span class="number">5</span></span><br><span class="line"><span class="attr">client.tm.defaultGlobalTransactionTimeout</span>=<span class="number">60000</span></span><br><span class="line"><span class="attr">client.tm.degradeCheck</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">client.tm.degradeCheckAllowTimes</span>=<span class="number">10</span></span><br><span class="line"><span class="attr">client.tm.degradeCheckPeriod</span>=<span class="number">2000</span></span><br><span class="line"><span class="attr">client.tm.interceptorOrder</span>=-<span class="number">2147482648</span></span><br><span class="line"><span class="attr">client.undo.dataValidation</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">client.undo.logSerialization</span>=jackson</span><br><span class="line"><span class="attr">client.undo.onlyCareUpdateColumns</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">server.undo.logSaveDays</span>=<span class="number">7</span></span><br><span class="line"><span class="attr">server.undo.logDeletePeriod</span>=<span class="number">86400000</span></span><br><span class="line"><span class="attr">client.undo.logTable</span>=undo_log</span><br><span class="line"><span class="attr">client.undo.compress.enable</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">client.undo.compress.type</span>=zip</span><br><span class="line"><span class="attr">client.undo.compress.threshold</span>=<span class="number">64</span>k</span><br><span class="line"><span class="comment">#For TCC transaction mode</span></span><br><span class="line"><span class="attr">tcc.fence.logTableName</span>=tcc_fence_log</span><br><span class="line"><span class="attr">tcc.fence.cleanPeriod</span>=<span class="number">1</span>h</span><br><span class="line"></span><br><span class="line"><span class="comment">#Log rule configuration, for client and server</span></span><br><span class="line"><span class="attr">log.exceptionRate</span>=<span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Transaction storage configuration, only for the server. The file, db, and redis configuration values are optional.</span></span><br><span class="line"><span class="attr">store.mode</span>=db</span><br><span class="line"><span class="attr">store.lock.mode</span>=db</span><br><span class="line"><span class="attr">store.session.mode</span>=db</span><br><span class="line"><span class="comment">#Used for password encryption</span></span><br><span class="line"><span class="comment">#store.publicKey=</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#If `store.mode,store.lock.mode,store.session.mode` are not equal to `file`, you can remove the configuration block.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#These configurations are required if the `store mode` is `db`. If `store.mode,store.lock.mode,store.session.mode` are not equal to `db`, you can remove the configuration block.</span></span><br><span class="line"><span class="attr">store.db.datasource</span>=druid</span><br><span class="line"><span class="attr">store.db.dbType</span>=mysql</span><br><span class="line"><span class="attr">store.db.driverClassName</span>=com.mysql.cj.jdbc.Driver</span><br><span class="line"><span class="attr">store.db.url</span>=jdbc:mysql://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">3306</span>/easylive?useSSL=<span class="literal">false</span>&amp;&amp;serverTimezone=GMT%<span class="number">2</span>B8&amp;useInformationSchema=<span class="literal">true</span></span><br><span class="line"><span class="attr">store.db.user</span>=root</span><br><span class="line"><span class="attr">store.db.password</span>=root</span><br><span class="line"><span class="attr">store.db.minConn</span>=<span class="number">5</span></span><br><span class="line"><span class="attr">store.db.maxConn</span>=<span class="number">30</span></span><br><span class="line"><span class="attr">store.db.globalTable</span>=global_table</span><br><span class="line"><span class="attr">store.db.branchTable</span>=branch_table</span><br><span class="line"><span class="attr">store.db.distributedLockTable</span>=distributed_lock</span><br><span class="line"><span class="attr">store.db.queryLimit</span>=<span class="number">100</span></span><br><span class="line"><span class="attr">store.db.lockTable</span>=lock_table</span><br><span class="line"><span class="attr">store.db.maxWait</span>=<span class="number">5000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#These configurations are required if the `store mode` is `redis`. If `store.mode,store.lock.mode,store.session.mode` are not equal to `redis`, you can remove the configuration block.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Transaction rule configuration, only for the server</span></span><br><span class="line"><span class="attr">server.recovery.committingRetryPeriod</span>=<span class="number">1000</span></span><br><span class="line"><span class="attr">server.recovery.asynCommittingRetryPeriod</span>=<span class="number">1000</span></span><br><span class="line"><span class="attr">server.recovery.rollbackingRetryPeriod</span>=<span class="number">1000</span></span><br><span class="line"><span class="attr">server.recovery.timeoutRetryPeriod</span>=<span class="number">1000</span></span><br><span class="line"><span class="attr">server.maxCommitRetryTimeout</span>=-<span class="number">1</span></span><br><span class="line"><span class="attr">server.maxRollbackRetryTimeout</span>=-<span class="number">1</span></span><br><span class="line"><span class="attr">server.rollbackRetryTimeoutUnlockEnable</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">server.distributedLockExpireTime</span>=<span class="number">10000</span></span><br><span class="line"><span class="attr">server.xaerNotaRetryTimeout</span>=<span class="number">60000</span></span><br><span class="line"><span class="attr">server.session.branchAsyncQueueSize</span>=<span class="number">5000</span></span><br><span class="line"><span class="attr">server.session.enableBranchAsyncRemove</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">server.enableParallelRequestHandle</span>=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Metrics configuration, only for the server</span></span><br><span class="line"><span class="attr">metrics.enabled</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">metrics.registryType</span>=compact</span><br><span class="line"><span class="attr">metrics.exporterList</span>=prometheus</span><br><span class="line"><span class="attr">metrics.exporterPrometheusPort</span>=<span class="number">9898</span></span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1342.png" alt="img"></p>
<p>æ–°å»ºseataæ—¥å¿—è¡¨</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `undo_log` (</span><br><span class="line">  `id` bigint(<span class="number">20</span>) <span class="literal">NOT</span> NULL AUTO_INCREMENT,</span><br><span class="line">  `branch_id` bigint(<span class="number">20</span>) <span class="literal">NOT</span> NULL,</span><br><span class="line">  `xid` varchar(<span class="number">100</span>) <span class="literal">NOT</span> NULL,</span><br><span class="line">  `context` varchar(<span class="number">128</span>) <span class="literal">NOT</span> NULL,</span><br><span class="line">  `rollback_info` longblob <span class="literal">NOT</span> NULL,</span><br><span class="line">  `log_status` int(<span class="number">11</span>) <span class="literal">NOT</span> NULL,</span><br><span class="line">  `log_created` datetime <span class="literal">NOT</span> NULL,</span><br><span class="line">  `log_modified` datetime <span class="literal">NOT</span> NULL,</span><br><span class="line">  `ext` varchar(<span class="number">100</span>) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  UNIQUE KEY `ux_undo_log` (`xid`,`branch_id`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=<span class="number">1</span> DEFAULT CHARSET=utf8<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">CREATE TABLE `branch_table` (</span><br><span class="line">  `branch_id` bigint(<span class="number">20</span>) <span class="literal">NOT</span> NULL,</span><br><span class="line">  `xid` varchar(<span class="number">128</span>) <span class="literal">NOT</span> NULL,</span><br><span class="line">  `transaction_id` bigint(<span class="number">20</span>) DEFAULT NULL,</span><br><span class="line">  `resource_group_id` varchar(<span class="number">32</span>) DEFAULT NULL,</span><br><span class="line">  `resource_id` varchar(<span class="number">256</span>) DEFAULT NULL,</span><br><span class="line">  `branch_type` varchar(<span class="number">8</span>) DEFAULT NULL,</span><br><span class="line">  `status` tinyint(<span class="number">4</span>) DEFAULT NULL,</span><br><span class="line">  `client_id` varchar(<span class="number">64</span>) DEFAULT NULL,</span><br><span class="line">  `application_data` varchar(<span class="number">2000</span>) DEFAULT NULL,</span><br><span class="line">  `gmt_create` datetime(<span class="number">6</span>) DEFAULT NULL,</span><br><span class="line">  `gmt_modified` datetime(<span class="number">6</span>) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`branch_id`),</span><br><span class="line">  KEY `idx_xid` (`xid`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">CREATE TABLE `lock_table` (</span><br><span class="line">  `row_key` varchar(<span class="number">128</span>) <span class="literal">NOT</span> NULL,</span><br><span class="line">  `xid` varchar(<span class="number">128</span>) DEFAULT NULL,</span><br><span class="line">  `transaction_id` bigint(<span class="number">20</span>) DEFAULT NULL,</span><br><span class="line">  `branch_id` bigint(<span class="number">20</span>) <span class="literal">NOT</span> NULL,</span><br><span class="line">  `resource_id` varchar(<span class="number">256</span>) DEFAULT NULL,</span><br><span class="line">  `table_name` varchar(<span class="number">32</span>) DEFAULT NULL,</span><br><span class="line">  `pk` varchar(<span class="number">36</span>) DEFAULT NULL,</span><br><span class="line"><span class="title">  `status` tinyint(4) NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;0:locked ,1:</span>rollbacking&#x27;,</span><br><span class="line">  `gmt_create` datetime DEFAULT NULL,</span><br><span class="line">  `gmt_modified` datetime DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`row_key`),</span><br><span class="line">  KEY `idx_status` (`status`),</span><br><span class="line">  KEY `idx_branch_id` (`branch_id`),</span><br><span class="line">  KEY `idx_xid` (`xid`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">CREATE TABLE IF <span class="literal">NOT</span> EXISTS `global_table`</span><br><span class="line">(</span><br><span class="line">    `xid`                       VARCHAR(<span class="number">128</span>) <span class="literal">NOT</span> NULL,</span><br><span class="line">    `transaction_id`            BIGINT,</span><br><span class="line">    `status`                    TINYINT      <span class="literal">NOT</span> NULL,</span><br><span class="line">    `application_id`            VARCHAR(<span class="number">32</span>),</span><br><span class="line">    `transaction_service_group` VARCHAR(<span class="number">32</span>),</span><br><span class="line">    `transaction_name`          VARCHAR(<span class="number">128</span>),</span><br><span class="line">    `timeout`                   INT,</span><br><span class="line">    `begin_time`                BIGINT,</span><br><span class="line">    `application_data`          VARCHAR(<span class="number">2000</span>),</span><br><span class="line">    `gmt_create`                DATETIME,</span><br><span class="line">    `gmt_modified`              DATETIME,</span><br><span class="line">    PRIMARY KEY (`xid`),</span><br><span class="line">    KEY `idx_status_gmt_modified` (`status` , `gmt_modified`),</span><br><span class="line">    KEY `idx_transaction_id` (`transaction_id`)</span><br><span class="line">) ENGINE = InnoDB</span><br><span class="line">  DEFAULT CHARSET = utf8mb4<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">CREATE TABLE IF <span class="literal">NOT</span> EXISTS `distributed_lock`</span><br><span class="line">(</span><br><span class="line">    `lock_key`       CHAR(<span class="number">20</span>) <span class="literal">NOT</span> NULL,</span><br><span class="line">    `lock_value`     VARCHAR(<span class="number">20</span>) <span class="literal">NOT</span> NULL,</span><br><span class="line">    `expire`         BIGINT,</span><br><span class="line">    primary key (`lock_key`)</span><br><span class="line">) ENGINE = InnoDB</span><br><span class="line">  DEFAULT CHARSET = utf8mb4<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">INSERT INTO `distributed_lock` (lock_key, lock_value, expire) VALUES (&#x27;AsyncCommitting&#x27;, &#x27; &#x27;, <span class="number">0</span>)<span class="comment">;</span></span><br><span class="line">INSERT INTO `distributed_lock` (lock_key, lock_value, expire) VALUES (&#x27;RetryCommitting&#x27;, &#x27; &#x27;, <span class="number">0</span>)<span class="comment">;</span></span><br><span class="line">INSERT INTO `distributed_lock` (lock_key, lock_value, expire) VALUES (&#x27;RetryRollbacking&#x27;, &#x27; &#x27;, <span class="number">0</span>)<span class="comment">;</span></span><br><span class="line">INSERT INTO `distributed_lock` (lock_key, lock_value, expire) VALUES (&#x27;TxTimeoutCheck&#x27;, &#x27; &#x27;, <span class="number">0</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-åœ¨gatewayçš„resourcesä¸­åˆ›å»ºbootstrap-ymlå¹¶é…ç½®nacoså®ä¾‹å¹¶é…ç½®">2.åœ¨gatewayçš„resourcesä¸­åˆ›å»ºbootstrap.ymlå¹¶é…ç½®nacoså®ä¾‹å¹¶é…ç½®</h3>
<p>bootstrap.yml</p>
<figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">spring</span><span class="punctuation">:</span></span><br><span class="line">  <span class="attribute">profiles</span><span class="punctuation">:</span></span><br><span class="line">    <span class="attribute">active</span><span class="punctuation">:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attribute">application</span><span class="punctuation">:</span></span><br><span class="line">    <span class="attribute">name</span><span class="punctuation">:</span> <span class="string">easylive-cloud-gateway</span></span><br><span class="line">  <span class="attribute">cloud</span><span class="punctuation">:</span></span><br><span class="line">    <span class="attribute">nacos</span><span class="punctuation">:</span></span><br><span class="line">      <span class="attribute">discovery</span><span class="punctuation">:</span></span><br><span class="line">        <span class="attribute">server-addr</span><span class="punctuation">:</span> <span class="string">127.0.0.1:8848</span></span><br><span class="line">      <span class="attribute">config</span><span class="punctuation">:</span></span><br><span class="line">        <span class="attribute">server-addr</span><span class="punctuation">:</span> <span class="string">127.0.0.1:8848</span></span><br><span class="line">        <span class="attribute">file-extension</span><span class="punctuation">:</span> <span class="string">yml</span></span><br><span class="line">        <span class="attribute">shared-configs</span><span class="punctuation">:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">$&#123;spring.application.name&#125;-$&#123;spring.profiles.active&#125;.$&#123;spring.cloud.nacos.config.file-extension&#125;</span></span><br><span class="line">    <span class="attribute">gateway</span><span class="punctuation">:</span></span><br><span class="line">      <span class="attribute">routes</span><span class="punctuation">:</span></span><br><span class="line">        <span class="comment">#è§†é¢‘æ¨¡å—</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">id: video</span></span><br><span class="line">          <span class="attribute">uri</span><span class="punctuation">:</span> <span class="string">lb://easylive-cloud-web</span></span><br><span class="line">          <span class="attribute">predicates</span><span class="punctuation">:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/web/**</span></span><br><span class="line">          <span class="attribute">filters</span><span class="punctuation">:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">StripPrefix=1</span></span><br><span class="line">        <span class="comment">#äº’åŠ¨æœåŠ¡</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">id: interact</span></span><br><span class="line">          <span class="attribute">uri</span><span class="punctuation">:</span> <span class="string">lb://easylive-cloud-interact</span></span><br><span class="line">          <span class="attribute">predicates</span><span class="punctuation">:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/interact/**</span></span><br><span class="line">          <span class="attribute">filters</span><span class="punctuation">:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">StripPrefix=1</span></span><br><span class="line">        <span class="comment">#ç”¨æˆ·æ¨¡å—</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">id: user</span></span><br><span class="line">          <span class="attribute">uri</span><span class="punctuation">:</span> <span class="string">lb://easylive-cloud-ucenter</span></span><br><span class="line">          <span class="attribute">predicates</span><span class="punctuation">:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/user/**</span></span><br><span class="line">          <span class="attribute">filters</span><span class="punctuation">:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">StripPrefix=1</span></span><br><span class="line">        <span class="comment">#èµ„æºæœåŠ¡</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">id: resource</span></span><br><span class="line">          <span class="attribute">uri</span><span class="punctuation">:</span> <span class="string">lb://easylive-cloud-resource</span></span><br><span class="line">          <span class="attribute">predicates</span><span class="punctuation">:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/file/**</span></span><br><span class="line">          <span class="attribute">filters</span><span class="punctuation">:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">StripPrefix=1</span></span><br><span class="line">        <span class="comment">#adminæœåŠ¡</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">id: admin</span></span><br><span class="line">          <span class="attribute">uri</span><span class="punctuation">:</span> <span class="string">lb://easylive-cloud-admin</span></span><br><span class="line">          <span class="attribute">predicates</span><span class="punctuation">:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/admin/**</span></span><br><span class="line">          <span class="attribute">filters</span><span class="punctuation">:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">StripPrefix=1</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">AdminFilter</span></span><br></pre></td></tr></table></figure>
<p>åœ¨nacosåˆ›å»ºå®ä¾‹å¹¶é…ç½®</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">feign:</span></span><br><span class="line">  <span class="params">okhttp:</span></span><br><span class="line">    <span class="params">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="params">server:</span></span><br><span class="line">  <span class="params">port:</span> <span class="number">7071</span></span><br><span class="line"></span><br><span class="line"><span class="params">project:</span></span><br><span class="line">  <span class="params">folder:</span> d:<span class="symbol">/webser/easylive</span></span><br><span class="line"><span class="params">log:</span></span><br><span class="line">  <span class="params">root:</span></span><br><span class="line">    <span class="params">level:</span> debug</span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1160-1024x350.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1343.png" alt="img"></p>
<h3 id="3-åœ¨webçš„resourcesä¸­åˆ›å»ºbootstrap-ymlå¹¶é…ç½®nacoså®ä¾‹å¹¶é…ç½®">3.åœ¨webçš„resourcesä¸­åˆ›å»ºbootstrap.ymlå¹¶é…ç½®nacoså®ä¾‹å¹¶é…ç½®</h3>
<p>bootstrap.ymlä¸­</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">spring:</span></span><br><span class="line">  <span class="params">mvc:</span></span><br><span class="line">    <span class="params">throw-exception-if-no-handler-found:</span> <span class="literal">true</span></span><br><span class="line">  <span class="params">web:</span></span><br><span class="line">    <span class="params">resources:</span></span><br><span class="line">      <span class="params">add-mappings:</span> <span class="literal">false</span></span><br><span class="line">  <span class="params">application:</span></span><br><span class="line">    <span class="params">name:</span> easylive-cloud-web</span><br><span class="line">  <span class="params">profiles:</span></span><br><span class="line">    <span class="params">active:</span> dev</span><br><span class="line">  <span class="params">cloud:</span></span><br><span class="line">    <span class="params">nacos:</span></span><br><span class="line">      <span class="params">discovery:</span></span><br><span class="line">        <span class="params">server-addr:</span> <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8848</span></span><br><span class="line">      <span class="params">config:</span></span><br><span class="line">        <span class="params">server-addr:</span> <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8848</span></span><br><span class="line">        <span class="params">file-extension:</span> yml</span><br><span class="line">        <span class="params">shared-configs:</span></span><br><span class="line">          <span class="operator">-</span> $&#123;spring.application.name&#125;-$&#123;spring.profiles.active&#125;.$&#123;spring.cloud.nacos.config.file-extension&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨nacosåˆ›å»ºå®ä¾‹ï¼Œå¹¶é…ç½®</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">server:</span></span><br><span class="line">  <span class="params">port:</span> <span class="number">7072</span></span><br><span class="line"><span class="params">spring:</span></span><br><span class="line">  <span class="params">servlet:</span></span><br><span class="line">    <span class="params">multipart:</span></span><br><span class="line">      <span class="params">max-file-size:</span> <span class="number">10</span>MB</span><br><span class="line">      <span class="params">max-request-size:</span> <span class="number">15</span>MB</span><br><span class="line"> </span><br><span class="line">  <span class="params">datasource:</span></span><br><span class="line">    <span class="params">url:</span> jdbc:mysql:<span class="operator">//</span><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">3306</span><span class="operator">/</span>easylive<span class="operator">?</span>serverTimezone<span class="operator">=</span>GMT%<span class="number">2</span>B8&amp;useUnicode<span class="operator">=</span><span class="literal">true</span>&amp;characterEncoding<span class="operator">=</span>utf8&amp;autoReconnect<span class="operator">=</span><span class="literal">true</span>&amp;allowMultiQueries<span class="operator">=</span><span class="literal">true</span>&amp;useSSL<span class="operator">=</span><span class="literal">false</span></span><br><span class="line">    <span class="params">username:</span> root</span><br><span class="line">    <span class="params">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="params">driver-class-name:</span> com.mysql.cj.jdbc.Driver</span><br><span class="line">    <span class="params">hikari:</span></span><br><span class="line">      <span class="params">pool-name:</span> HikariCPDatasource</span><br><span class="line">      <span class="params">minimum-idle:</span> <span class="number">5</span></span><br><span class="line">      <span class="params">idle-timeout:</span> <span class="number">180000</span></span><br><span class="line">      <span class="params">maximum-pool-size:</span> <span class="number">10</span></span><br><span class="line">      <span class="params">auto-commit:</span> <span class="literal">true</span></span><br><span class="line">      <span class="params">max-lifetime:</span> <span class="number">1800000</span></span><br><span class="line">      <span class="params">connection-timeout:</span> <span class="number">30000</span></span><br><span class="line">      <span class="params">connection-test-query:</span> SELECT <span class="number">1</span></span><br><span class="line">  <span class="params">redis:</span></span><br><span class="line">    <span class="params">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="params">host:</span> <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">    <span class="params">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="params">jedis:</span></span><br><span class="line">      <span class="params">pool:</span></span><br><span class="line">        <span class="params">max-active:</span> <span class="number">20</span></span><br><span class="line">        <span class="params">max-wait:</span> <span class="operator">-</span><span class="number">1</span></span><br><span class="line">        <span class="params">max-idle:</span> <span class="number">10</span></span><br><span class="line">        <span class="params">min-idle:</span> <span class="number">0</span></span><br><span class="line">    <span class="params">timeout:</span> <span class="number">2000</span></span><br><span class="line"><span class="comment">#mybatis å¤§å°å†™è½¬é©¼å³°</span></span><br><span class="line"><span class="params">mybatis:</span></span><br><span class="line">  <span class="params">configuration:</span></span><br><span class="line">    <span class="params">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="params">project:</span></span><br><span class="line">  <span class="params">folder:</span> d:<span class="operator">/</span>webser<span class="operator">/</span>easylive<span class="symbol">/</span></span><br><span class="line"><span class="params">log:</span></span><br><span class="line">  <span class="params">root:</span></span><br><span class="line">    <span class="params">level:</span> debug</span><br></pre></td></tr></table></figure>
<h3 id="4-åœ¨adminçš„resourcesä¸­åˆ›å»ºbootstrap-ymlå¹¶é…ç½®nacoså®ä¾‹å¹¶é…ç½®">4.åœ¨adminçš„resourcesä¸­åˆ›å»ºbootstrap.ymlå¹¶é…ç½®nacoså®ä¾‹å¹¶é…ç½®</h3>
<p>bootstrap.yml</p>
<figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">spring</span><span class="punctuation">:</span></span><br><span class="line">  <span class="attribute">application</span><span class="punctuation">:</span></span><br><span class="line">    <span class="attribute">name</span><span class="punctuation">:</span> <span class="string">easylive-cloud-admin</span></span><br><span class="line">  <span class="attribute">profiles</span><span class="punctuation">:</span></span><br><span class="line">    <span class="attribute">active</span><span class="punctuation">:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attribute">cloud</span><span class="punctuation">:</span></span><br><span class="line">    <span class="attribute">nacos</span><span class="punctuation">:</span></span><br><span class="line">      <span class="attribute">discovery</span><span class="punctuation">:</span></span><br><span class="line">        <span class="attribute">server-addr</span><span class="punctuation">:</span> <span class="string">127.0.0.1:8848</span></span><br><span class="line">      <span class="attribute">config</span><span class="punctuation">:</span></span><br><span class="line">        <span class="attribute">server-addr</span><span class="punctuation">:</span> <span class="string">127.0.0.1:8848</span></span><br><span class="line">        <span class="attribute">file-extension</span><span class="punctuation">:</span> <span class="string">yml</span></span><br><span class="line">        <span class="attribute">shared-configs</span><span class="punctuation">:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">$&#123;spring.application.name&#125;-$&#123;spring.profiles.active&#125;.$&#123;spring.cloud.nacos.config.file-extension&#125;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨nacosåˆ›å»ºå®ä¾‹ï¼Œå¹¶é…ç½®</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">server:</span></span><br><span class="line">  <span class="params">port:</span> <span class="number">7070</span></span><br><span class="line"><span class="params">spring:</span></span><br><span class="line">  <span class="params">servlet:</span></span><br><span class="line">    <span class="params">multipart:</span></span><br><span class="line">      <span class="params">max-file-size:</span> <span class="number">10</span>MB</span><br><span class="line">      <span class="params">max-request-size:</span> <span class="number">15</span>MB</span><br><span class="line"> </span><br><span class="line">  <span class="params">datasource:</span></span><br><span class="line">    <span class="params">url:</span> jdbc:mysql:<span class="operator">//</span><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">3306</span><span class="operator">/</span>easylive<span class="operator">?</span>serverTimezone<span class="operator">=</span>GMT%<span class="number">2</span>B8&amp;useUnicode<span class="operator">=</span><span class="literal">true</span>&amp;characterEncoding<span class="operator">=</span>utf8&amp;autoReconnect<span class="operator">=</span><span class="literal">true</span>&amp;allowMultiQueries<span class="operator">=</span><span class="literal">true</span>&amp;useSSL<span class="operator">=</span><span class="literal">false</span></span><br><span class="line">    <span class="params">username:</span> root</span><br><span class="line">    <span class="params">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="params">driver-class-name:</span> com.mysql.cj.jdbc.Driver</span><br><span class="line">    <span class="params">hikari:</span></span><br><span class="line">      <span class="params">pool-name:</span> HikariCPDatasource</span><br><span class="line">      <span class="params">minimum-idle:</span> <span class="number">5</span></span><br><span class="line">      <span class="params">idle-timeout:</span> <span class="number">180000</span></span><br><span class="line">      <span class="params">maximum-pool-size:</span> <span class="number">10</span></span><br><span class="line">      <span class="params">auto-commit:</span> <span class="literal">true</span></span><br><span class="line">      <span class="params">max-lifetime:</span> <span class="number">1800000</span></span><br><span class="line">      <span class="params">connection-timeout:</span> <span class="number">30000</span></span><br><span class="line">      <span class="params">connection-test-query:</span> SELECT <span class="number">1</span></span><br><span class="line">  <span class="params">redis:</span></span><br><span class="line">    <span class="params">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="params">host:</span> <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">    <span class="params">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="params">jedis:</span></span><br><span class="line">      <span class="params">pool:</span></span><br><span class="line">        <span class="params">max-active:</span> <span class="number">20</span></span><br><span class="line">        <span class="params">max-wait:</span> <span class="operator">-</span><span class="number">1</span></span><br><span class="line">        <span class="params">max-idle:</span> <span class="number">10</span></span><br><span class="line">        <span class="params">min-idle:</span> <span class="number">0</span></span><br><span class="line">    <span class="params">timeout:</span> <span class="number">2000</span></span><br><span class="line"><span class="comment">#mybatis å¤§å°å†™è½¬é©¼å³°</span></span><br><span class="line"><span class="params">mybatis:</span></span><br><span class="line">  <span class="params">configuration:</span></span><br><span class="line">    <span class="params">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="params">project:</span></span><br><span class="line">  <span class="params">folder:</span> d:<span class="operator">/</span>webser<span class="operator">/</span>easylive<span class="symbol">/</span></span><br><span class="line"><span class="params">log:</span></span><br><span class="line">  <span class="params">root:</span></span><br><span class="line">    <span class="params">level:</span> debug</span><br></pre></td></tr></table></figure>
<h3 id="5-åœ¨interactçš„resourcesä¸­åˆ›å»ºbootstrap-ymlå¹¶é…ç½®nacoså®ä¾‹å¹¶é…ç½®">5.åœ¨interactçš„resourcesä¸­åˆ›å»ºbootstrap.ymlå¹¶é…ç½®nacoså®ä¾‹å¹¶é…ç½®</h3>
<p>bootstrap.yml</p>
<figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">spring</span><span class="punctuation">:</span></span><br><span class="line">  <span class="attribute">application</span><span class="punctuation">:</span></span><br><span class="line">    <span class="attribute">name</span><span class="punctuation">:</span> <span class="string">easylive-cloud-interact</span></span><br><span class="line">  <span class="attribute">profiles</span><span class="punctuation">:</span></span><br><span class="line">    <span class="attribute">active</span><span class="punctuation">:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attribute">cloud</span><span class="punctuation">:</span></span><br><span class="line">    <span class="attribute">nacos</span><span class="punctuation">:</span></span><br><span class="line">      <span class="attribute">discovery</span><span class="punctuation">:</span></span><br><span class="line">        <span class="attribute">server-addr</span><span class="punctuation">:</span> <span class="string">127.0.0.1:8848</span></span><br><span class="line">      <span class="attribute">config</span><span class="punctuation">:</span></span><br><span class="line">        <span class="attribute">server-addr</span><span class="punctuation">:</span> <span class="string">127.0.0.1:8848</span></span><br><span class="line">        <span class="attribute">file-extension</span><span class="punctuation">:</span> <span class="string">yml</span></span><br><span class="line">        <span class="attribute">shared-configs</span><span class="punctuation">:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">$&#123;spring.application.name&#125;-$&#123;spring.profiles.active&#125;.$&#123;spring.cloud.nacos.config.file-extension&#125;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨nacosåˆ›å»ºå®ä¾‹ï¼Œå¹¶é…ç½®</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">server:</span></span><br><span class="line">  <span class="params">port:</span> <span class="number">7073</span></span><br><span class="line"></span><br><span class="line"><span class="params">spring:</span></span><br><span class="line">  <span class="params">datasource:</span></span><br><span class="line">    <span class="params">url:</span> jdbc:mysql:<span class="operator">//</span><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">3306</span><span class="operator">/</span>easylive<span class="operator">?</span>serverTimezone<span class="operator">=</span>GMT%<span class="number">2</span>B8&amp;useUnicode<span class="operator">=</span><span class="literal">true</span>&amp;characterEncoding<span class="operator">=</span>utf8&amp;autoReconnect<span class="operator">=</span><span class="literal">true</span>&amp;allowMultiQueries<span class="operator">=</span><span class="literal">true</span>&amp;useSSL<span class="operator">=</span><span class="literal">false</span></span><br><span class="line">    <span class="params">username:</span> root</span><br><span class="line">    <span class="params">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="params">driver-class-name:</span> com.mysql.cj.jdbc.Driver</span><br><span class="line">    <span class="params">hikari:</span></span><br><span class="line">      <span class="params">pool-name:</span> HikariCPDatasource</span><br><span class="line">      <span class="params">minimum-idle:</span> <span class="number">5</span></span><br><span class="line">      <span class="params">idle-timeout:</span> <span class="number">180000</span></span><br><span class="line">      <span class="params">maximum-pool-size:</span> <span class="number">10</span></span><br><span class="line">      <span class="params">auto-commit:</span> <span class="literal">true</span></span><br><span class="line">      <span class="params">max-lifetime:</span> <span class="number">1800000</span></span><br><span class="line">      <span class="params">connection-timeout:</span> <span class="number">30000</span></span><br><span class="line">      <span class="params">connection-test-query:</span> SELECT <span class="number">1</span></span><br><span class="line"></span><br><span class="line">  <span class="params">redis:</span></span><br><span class="line">    <span class="params">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="params">host:</span> <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">    <span class="params">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="params">jedis:</span></span><br><span class="line">      <span class="params">pool:</span></span><br><span class="line">        <span class="params">max-active:</span> <span class="number">20</span></span><br><span class="line">        <span class="params">max-wait:</span> <span class="operator">-</span><span class="number">1</span></span><br><span class="line">        <span class="params">max-idle:</span> <span class="number">10</span></span><br><span class="line">        <span class="params">min-idle:</span> <span class="number">0</span></span><br><span class="line">    <span class="params">timeout:</span> <span class="number">2000</span></span><br><span class="line"></span><br><span class="line"><span class="params">mybatis:</span></span><br><span class="line">  <span class="params">configuration:</span></span><br><span class="line">    <span class="params">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="params">project:</span></span><br><span class="line">  <span class="params">folder:</span> d:<span class="operator">/</span>webser<span class="operator">/</span>easylive<span class="symbol">/</span></span><br><span class="line"></span><br><span class="line"><span class="params">log:</span></span><br><span class="line">  <span class="params">root:</span></span><br><span class="line">    <span class="params">level:</span> debug</span><br></pre></td></tr></table></figure>
<h3 id="6-åœ¨resourceçš„resourcesä¸­åˆ›å»ºbootstrap-ymlå¹¶é…ç½®nacoså®ä¾‹å¹¶é…ç½®">6.åœ¨resourceçš„resourcesä¸­åˆ›å»ºbootstrap.ymlå¹¶é…ç½®nacoså®ä¾‹å¹¶é…ç½®</h3>
<p>bootstrap.yml</p>
<figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">spring</span><span class="punctuation">:</span></span><br><span class="line">  <span class="attribute">application</span><span class="punctuation">:</span></span><br><span class="line">    <span class="attribute">name</span><span class="punctuation">:</span> <span class="string">easylive-cloud-resource</span></span><br><span class="line">  <span class="attribute">profiles</span><span class="punctuation">:</span></span><br><span class="line">    <span class="attribute">active</span><span class="punctuation">:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attribute">cloud</span><span class="punctuation">:</span></span><br><span class="line">    <span class="attribute">nacos</span><span class="punctuation">:</span></span><br><span class="line">      <span class="attribute">discovery</span><span class="punctuation">:</span></span><br><span class="line">        <span class="attribute">server-addr</span><span class="punctuation">:</span> <span class="string">127.0.0.1:8848</span></span><br><span class="line">      <span class="attribute">config</span><span class="punctuation">:</span></span><br><span class="line">        <span class="attribute">server-addr</span><span class="punctuation">:</span> <span class="string">127.0.0.1:8848</span></span><br><span class="line">        <span class="attribute">file-extension</span><span class="punctuation">:</span> <span class="string">yml</span></span><br><span class="line">        <span class="attribute">shared-configs</span><span class="punctuation">:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">$&#123;spring.application.name&#125;-$&#123;spring.profiles.active&#125;.$&#123;spring.cloud.nacos.config.file-extension&#125;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨nacosåˆ›å»ºå®ä¾‹ï¼Œå¹¶é…ç½®</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">server:</span></span><br><span class="line">  <span class="params">port:</span> <span class="number">7074</span></span><br><span class="line"><span class="params">spring:</span></span><br><span class="line">  <span class="params">servlet:</span></span><br><span class="line">    <span class="params">multipart:</span></span><br><span class="line">      <span class="params">max-file-size:</span> <span class="number">10</span>MB</span><br><span class="line">      <span class="params">max-request-size:</span> <span class="number">15</span>MB</span><br><span class="line"><span class="params">project:</span></span><br><span class="line">  <span class="params">folder:</span> d:<span class="operator">/</span>webser<span class="operator">/</span>easylive<span class="symbol">/</span></span><br><span class="line"><span class="params">log:</span></span><br><span class="line">  <span class="params">root:</span></span><br><span class="line">    <span class="params">level:</span> debug</span><br></pre></td></tr></table></figure>
<h3 id="7-åˆ›å»ºvideoçš„nacoså®ä¾‹easylive-cloud-video-dev-yml">7.åˆ›å»ºvideoçš„nacoså®ä¾‹easylive-cloud-video-dev.yml</h3>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">server:</span></span><br><span class="line">  <span class="params">port:</span> <span class="number">7072</span></span><br><span class="line"><span class="params">spring:</span></span><br><span class="line">  <span class="params">servlet:</span></span><br><span class="line">    <span class="params">multipart:</span></span><br><span class="line">      <span class="params">max-file-size:</span> <span class="number">10</span>MB</span><br><span class="line">      <span class="params">max-request-size:</span> <span class="number">15</span>MB</span><br><span class="line">  <span class="params">datasource:</span></span><br><span class="line">    <span class="params">url:</span> jdbc:mysql:<span class="operator">//</span><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">3306</span><span class="operator">/</span>easylive<span class="operator">?</span>serverTimezone<span class="operator">=</span>GMT%<span class="number">2</span>B8&amp;useUnicode<span class="operator">=</span><span class="literal">true</span>&amp;characterEncoding<span class="operator">=</span>utf8&amp;autoReconnect<span class="operator">=</span><span class="literal">true</span>&amp;allowMultiQueries<span class="operator">=</span><span class="literal">true</span>&amp;useSSL<span class="operator">=</span><span class="literal">false</span></span><br><span class="line">    <span class="params">username:</span> root</span><br><span class="line">    <span class="params">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="params">driver-class-name:</span> com.mysql.cj.jdbc.Driver</span><br><span class="line">    <span class="params">hikari:</span></span><br><span class="line">      <span class="params">pool-name:</span> HikariCPDatasource</span><br><span class="line">      <span class="params">minimum-idle:</span> <span class="number">5</span></span><br><span class="line">      <span class="params">idle-timeout:</span> <span class="number">180000</span></span><br><span class="line">      <span class="params">maximum-pool-size:</span> <span class="number">10</span></span><br><span class="line">      <span class="params">auto-commit:</span> <span class="literal">true</span></span><br><span class="line">      <span class="params">max-lifetime:</span> <span class="number">1800000</span></span><br><span class="line">      <span class="params">connection-timeout:</span> <span class="number">30000</span></span><br><span class="line">      <span class="params">connection-test-query:</span> SELECT <span class="number">1</span></span><br><span class="line">  <span class="params">redis:</span></span><br><span class="line">    <span class="params">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="params">host:</span> <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">    <span class="params">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="params">jedis:</span></span><br><span class="line">      <span class="params">pool:</span></span><br><span class="line">        <span class="params">max-active:</span> <span class="number">20</span></span><br><span class="line">        <span class="params">max-wait:</span> <span class="operator">-</span><span class="number">1</span></span><br><span class="line">        <span class="params">max-idle:</span> <span class="number">10</span></span><br><span class="line">        <span class="params">min-idle:</span> <span class="number">0</span></span><br><span class="line">    <span class="params">timeout:</span> <span class="number">2000</span></span><br><span class="line"><span class="comment">#mybatis å¤§å°å†™è½¬é©¼å³°</span></span><br><span class="line"><span class="params">mybatis:</span></span><br><span class="line">  <span class="params">configuration:</span></span><br><span class="line">    <span class="params">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="params">project:</span></span><br><span class="line">  <span class="params">folder:</span> d:<span class="operator">/</span>webser<span class="operator">/</span>easylive<span class="symbol">/</span></span><br><span class="line"><span class="params">log:</span></span><br><span class="line">  <span class="params">root:</span></span><br><span class="line">    <span class="params">level:</span> debug</span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1184-1024x261.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1344-915x1024.png" alt="img"></p>
<p>ç«¯åˆ°ç«¯è·¯ç”±ç¤ºä¾‹ï¼ˆè¯·æ±‚å¦‚ä½•èµ°ï¼‰</p>
<ol>
<li>æµè§ˆå™¨è¯·æ±‚ <code>GET /web/category/loadAllCategory</code>ï¼›</li>
<li>ç½‘å…³åŒ¹é…åˆ° <strong>id: video</strong> è·¯ç”± â†’ <code>uri: lb://easylive-cloud-web</code>ï¼›</li>
<li><code>StripPrefix=1</code> å»æ‰ <code>/web</code>ï¼Œè½¬å‘åˆ° <code>http://&#123;webå®ä¾‹&#125;/category/loadAllCategory</code>ï¼›</li>
<li><code>easylive-cloud-web</code> åœ¨ Nacos <strong>æ³¨å†Œå‘ç°</strong>ï¼›å¦‚æœæœ‰å¤šå®ä¾‹ï¼Œåˆ™ç”± <strong>LoadBalancer</strong> è½®è¯¢è½¬å‘</li>
</ol>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1345.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1347.png" alt="img"></p>
<h2 id="4-ç½‘å…³gatewayé…ç½®">4.ç½‘å…³gatewayé…ç½®</h2>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1348.png" alt="img"></p>
<p>åœ¨åˆ›å»ºå¦‚ä¸‹ç»“æ„fliterã€handler</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1161.png" alt="img"></p>
<p>AdminFilter â€”â€” åªç»™ç®¡ç†ç«¯è·¯ç”±ç”¨çš„å±€éƒ¨é‰´æƒ</p>
<p>å…¸å‹ç”¨æ³•ï¼šåœ¨ <code>application.yml</code> çš„æŸæ¡ <strong>admin</strong> è·¯ç”±ä¸Šè¿½åŠ  <code>filters: - AdminFilter</code>ã€‚</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_"><span class="keyword">class</span> <span class="title">AdminFilter</span> <span class="keyword"><span class="keyword">extends</span> <span class="type">AbstractGatewayFilterFactory</span></span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">String</span> URL_ACCOUNT = <span class="string">&quot;/account&quot;</span>; <span class="comment">// è´¦å·ç›¸å…³ï¼šç™»å½•/æ³¨å†Œç­‰æ”¾è¡Œ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">String</span> URL_FILE = <span class="string">&quot;/file&quot;</span>;       <span class="comment">// æ–‡ä»¶æœåŠ¡ï¼šä» Cookie å– token</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> GatewayFilter apply(Object config) &#123;</span><br><span class="line">        <span class="keyword">return</span> (exchange, chain) -&gt; &#123;</span><br><span class="line">            ServerHttpRequest request = exchange.getRequest();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 1) è´¦å·å…¥å£ä¸€å¾‹æ”¾è¡Œï¼ˆç™»å½•/åˆ·æ–°éªŒè¯ç ç­‰ä¸éœ€è¦ç™»å½•ï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> (request.getURI().getRawPath().contains(URL_ACCOUNT)) &#123;</span><br><span class="line">                <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2) é»˜è®¤ä» Header å–ç®¡ç†å‘˜ token</span></span><br><span class="line">            <span class="keyword">String</span> token = getToken(request);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3) è‹¥è®¿é—®æ–‡ä»¶èµ„æºï¼ˆç½‘å…³ä¸‹å‘é™æ€/ä¸‹è½½ç­‰ï¼‰ï¼Œä» Cookie å– token</span></span><br><span class="line">            <span class="keyword">if</span> (request.getURI().getRawPath().contains(URL_FILE)) &#123;</span><br><span class="line">                token = getTokenFromCookie(request);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4) ç¼º tokenï¼šæŠ›ä¸šåŠ¡å¼‚å¸¸ï¼Œäº¤ç»™å…¨å±€å¼‚å¸¸å¤„ç†å™¨è¿”å› 901</span></span><br><span class="line">            <span class="keyword">if</span> (StringTools.isEmpty(token)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span><span class="type"></span> BusinessException(ResponseCodeEnum.CODE_901);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** ä» Header å–ç®¡ç†å‘˜ä»¤ç‰Œï¼ˆä¸ä¸‹æ¸¸çº¦å®šçš„å¸¸é‡åä¿æŒä¸€è‡´ï¼‰ */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> getToken(ServerHttpRequest request) &#123;</span><br><span class="line">        <span class="keyword">return</span> request.getHeaders().getFirst(Constants.TOKEN_ADMIN);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** ä» Cookie å–ç®¡ç†å‘˜ä»¤ç‰Œï¼ˆæ³¨æ„åˆ¤ç©ºï¼‰ */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> getTokenFromCookie(ServerHttpRequest request) &#123;</span><br><span class="line">        <span class="keyword">return</span> request.getCookies().getFirst(Constants.TOKEN_ADMIN).getValue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è¦ç‚¹/å»ºè®®</strong></p>
<ul>
<li>è¯¥è¿‡æ»¤å™¨åªåº”<strong>æŒ‚åœ¨ç®¡ç†ç«¯è·¯ç”±</strong>ä¸Šï¼Œé¿å…è¯¯ä¼¤æ™®é€šç”¨æˆ·æ¥å£ã€‚</li>
</ul>
<p>GatewayGatewayGlobalRequestFilter â€”â€” å…¨å±€æ‹¦æˆªå†…éƒ¨æ¥å£ &amp; æ‰“æ—¥å¿—</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_"><span class="keyword">class</span> <span class="title">GatewayGlobalRequestFilter</span> <span class="keyword"><span class="keyword">implements</span> <span class="type">GlobalFilter</span></span>, <span class="title">Ordered</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;<span class="keyword">Void</span>&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123;</span><br><span class="line">        <span class="keyword">String</span> rawpath = exchange.getRequest().getURI().getRawPath();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1) å¯¹æ‰€æœ‰è¯·æ±‚ç”Ÿæ•ˆï¼Œåªè¦è·¯å¾„åŒ…å«â€œå†…éƒ¨æ¥å£å‰ç¼€â€å°±æ‹¦æ‰ï¼ˆè¿”å› 404ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (rawpath.indexOf(Constants.INNER_API_PREFIX) != <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="comment">// æŠ›ä¸šåŠ¡å¼‚å¸¸æˆ– ResponseStatusException éƒ½ä¼šè¢«ç»Ÿä¸€å¤„ç†</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span><span class="type"></span> BusinessException(ResponseCodeEnum.CODE_404);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2) ç®€å•æ—¥å¿—ï¼šè®°å½•ä¸€æ¬¡è®¿é—®è·¯å¾„ï¼ˆå¯æ‰©å±• traceIdã€IPã€UA ç­‰ï¼‰</span></span><br><span class="line">        log.info(<span class="string">&quot;GatewayGlobalRequestFilter: &#123;&#125;&quot;</span>, rawpath);</span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** é¡ºåºè¶Šå°è¶Šå…ˆæ‰§è¡Œï¼›0 ä¿è¯è¾ƒé«˜ä¼˜å…ˆçº§ï¼ˆå…ˆæ‹¦å†…éƒ¨æ¥å£å†åšåˆ«çš„ï¼‰ */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> int getOrder() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è¦ç‚¹</strong></p>
<ul>
<li>è¿™æ˜¯<strong>å…¨å±€</strong>è¿‡æ»¤å™¨ï¼Œæ‰€æœ‰è·¯ç”±éƒ½ä¼šç»è¿‡ã€‚</li>
<li>ç”¨ <code>Ordered</code> æ§åˆ¶æ‰§è¡Œé¡ºåºï¼›ä¸€èˆ¬æŠŠâ€œç¦æ­¢è®¿é—®å†…éƒ¨ APIâ€çš„æ£€æŸ¥æ”¾<strong>å°½é‡é å‰</strong></li>
</ul>
<p>GatewayExceptionHandler â€”â€” ç»Ÿä¸€ JSON é”™è¯¯å“åº”</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Order(-1)</span>  <span class="comment">// æ•°å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼›-1 å¯ä»¥ä¿è¯å°½æ—©å¤„ç†å¼‚å¸¸</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GatewayExceptionHandler</span> <span class="keyword">implements</span> <span class="title class_">WebExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">STATUC_ERROR</span> <span class="operator">=</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">handle</span><span class="params">(ServerWebExchange exchange, Throwable throwable)</span> &#123;</span><br><span class="line">        <span class="comment">// 1) è®°å½•é”™è¯¯ï¼ˆåŒ…å«è¯·æ±‚è·¯å¾„å’Œå †æ ˆï¼‰</span></span><br><span class="line">        log.error(<span class="string">&quot;ç½‘å…³è¯·æ±‚é”™è¯¯ url:&#123;&#125;, é”™è¯¯ä¿¡æ¯ï¼š&quot;</span>,</span><br><span class="line">                  exchange.getRequest().getPath(), throwable);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2) ç»„è£…ç»Ÿä¸€å“åº”ä½“</span></span><br><span class="line">        <span class="type">ResponseVO</span> <span class="variable">responseVO</span> <span class="operator">=</span> getResponse(exchange, throwable);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3) è®¾ç½®å“åº”å¤´ä¸º JSON UTF-8ï¼Œå¹¶å†™å‡ºå“åº”ä½“</span></span><br><span class="line">        <span class="type">ServerHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> exchange.getResponse();</span><br><span class="line">        response.getHeaders().setContentType(MediaType.APPLICATION_JSON);</span><br><span class="line">        <span class="type">DataBuffer</span> <span class="variable">buf</span> <span class="operator">=</span> response.bufferFactory()</span><br><span class="line">                                .wrap(JsonUtils.convertObj2Json(responseVO)</span><br><span class="line">                                .getBytes(StandardCharsets.UTF_8));</span><br><span class="line">        <span class="keyword">return</span> response.writeWith(Mono.just(buf));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** å¼‚å¸¸åˆ° ResponseVO çš„æ˜ å°„è¡¨ */</span></span><br><span class="line">    <span class="keyword">private</span> ResponseVO <span class="title function_">getResponse</span><span class="params">(ServerWebExchange exchange, Throwable throwable)</span> &#123;</span><br><span class="line">        <span class="type">ResponseVO</span> <span class="variable">vo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResponseVO</span>();</span><br><span class="line">        vo.setStatus(STATUC_ERROR);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// A) Spring è‡ªå¸¦çš„å“åº”çŠ¶æ€å¼‚å¸¸ï¼ˆå¦‚ 404ã€503ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (throwable <span class="keyword">instanceof</span> ResponseStatusException) &#123;</span><br><span class="line">            <span class="type">ResponseStatusException</span> <span class="variable">ex</span> <span class="operator">=</span> (ResponseStatusException) throwable;</span><br><span class="line">            <span class="keyword">if</span> (HttpStatus.NOT_FOUND == ex.getStatus()) &#123;</span><br><span class="line">                vo.setCode(ResponseCodeEnum.CODE_404.getCode());</span><br><span class="line">                vo.setInfo(ResponseCodeEnum.CODE_404.getMsg());</span><br><span class="line">                <span class="keyword">return</span> vo;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (HttpStatus.SERVICE_UNAVAILABLE == ex.getStatus()) &#123;</span><br><span class="line">                vo.setCode(ResponseCodeEnum.CODE_503.getCode());</span><br><span class="line">                vo.setInfo(ResponseCodeEnum.CODE_503.getMsg());</span><br><span class="line">                <span class="keyword">return</span> vo;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                vo.setCode(ex.getStatus().value());</span><br><span class="line">                vo.setInfo(ResponseCodeEnum.CODE_500.getMsg());</span><br><span class="line">                <span class="keyword">return</span> vo;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// B) ä¸šåŠ¡å¼‚å¸¸ï¼šç›´æ¥é€ä¼ æˆ‘ä»¬ç³»ç»Ÿå†…çš„é”™è¯¯ç ä¸æ–‡æ¡ˆ</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (throwable <span class="keyword">instanceof</span> BusinessException) &#123;</span><br><span class="line">            <span class="type">BusinessException</span> <span class="variable">be</span> <span class="operator">=</span> (BusinessException) throwable;</span><br><span class="line">            vo.setCode(be.getCode());</span><br><span class="line">            vo.setInfo(be.getMessage());</span><br><span class="line">            <span class="keyword">return</span> vo;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// C) å…¶å®ƒæœªçŸ¥å¼‚å¸¸ï¼šå…œåº•ä¸º 500</span></span><br><span class="line">        vo.setCode(ResponseCodeEnum.CODE_500.getCode());</span><br><span class="line">        vo.setInfo(ResponseCodeEnum.CODE_500.getMsg());</span><br><span class="line">        <span class="keyword">return</span> vo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è¦ç‚¹</strong></p>
<ul>
<li>ç»Ÿä¸€æŠŠå„ç§å¼‚å¸¸å˜æˆå‰ç«¯èƒ½è¯†åˆ«çš„<strong>ç»Ÿä¸€ JSON</strong>ï¼›</li>
<li><code>@Order(-1)</code> ä¿è¯è¿™ä¸ªå¼‚å¸¸å¤„ç†å™¨èƒ½<strong>å°½é‡æ—©</strong>åœ°æ¥ç®¡é”™è¯¯è¾“å‡ºï¼›</li>
<li>ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œæ ¹æ®å¼‚å¸¸ç±»å‹<strong>è®¾ç½® HTTP çŠ¶æ€ç </strong>ï¼ˆå½“å‰ä»£ç åªè®¾ç½®äº† JSON å†…å®¹ç±»å‹ï¼Œè¿”å›ç æ²¿ç”¨é»˜è®¤ï¼‰ã€‚</li>
</ul>
<h2 id="5-åˆ†ç±»ä¿¡æ¯æ‹†åˆ†ï¼ˆOpenfeignï¼‰">5.åˆ†ç±»ä¿¡æ¯æ‹†åˆ†ï¼ˆOpenfeignï¼‰</h2>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1350.png" alt="img"></p>
<p>åˆ›å»ºç›®å½•ç»“æ„ï¼šåœ¨adminå’Œwebæ¨¡å—ä¸‹åˆ›å»ºapiç›®å½•é‡Œè¾¹åŒ…å«ä¸¤ä¸ªç›®å½•consumerå’Œprovider</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1351.png" alt="img"></p>
<p>adminæ¨¡å—ä¸‹api-provider-CategoryApiæ¥å£</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.easylive.api.provider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.easylive.entity.constants.Constants;</span><br><span class="line"><span class="keyword">import</span> com.easylive.entity.po.CategoryInfo;</span><br><span class="line"><span class="keyword">import</span> com.easylive.service.CategoryInfoService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.<span class="keyword">annotation</span>.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(Constants.INNER_API_PREFIX + <span class="string">&quot;/category&quot;</span>)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryApi</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CategoryInfoService categoryInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(<span class="string">&quot;/loadAllCategory&quot;</span>)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;CategoryInfo&gt; loadAllCategory() &#123;</span><br><span class="line">        List&lt;CategoryInfo&gt; categoryInfoList = categoryInfoService.getAllCategoryList();</span><br><span class="line">        <span class="keyword">return</span> categoryInfoList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>webæ¨¡å—ä¸‹api-consumer-CategoryClientæ¥å£</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1352.png" alt="img"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.easylive.api.consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.easylive.entity.constants.Constants;</span><br><span class="line"><span class="keyword">import</span> com.easylive.entity.po.CategoryInfo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FeignClient(name = Constants.SERVER_NAME_ADMIN)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryClient</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(Constants.INNER_API_PREFIX + &quot;/category/loadAllCategory&quot;)</span></span><br><span class="line">    List&lt;CategoryInfo&gt; <span class="title function_">loadAllCategory</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">static</span> <span class="keyword">final</span> <span class="type">String</span> SERVER_NAME_ADMIN = <span class="string">&quot;easylive-cloud-admin&quot;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="type">static</span> <span class="keyword">final</span> <span class="type">String</span> INNER_API_PREFIX = <span class="string">&quot;/inner&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥æŠŠåˆ†ç±»ä¸­è¦ç”¨çš„poã€voã€queryã€serviceã€mapperç­‰ä¿¡æ¯è¿›è¡Œè¿ç§»ï¼Œåœ¨æ­¤çœç•¥ä¸åšé˜è¿°ï¼ˆä¸ºäº†è®© <strong>admin</strong> å’Œ <strong>web</strong> åœ¨ RPC ä¸­<strong>ä¼ åŒä¸€ç§å¯¹è±¡</strong>ï¼Œéœ€è¦æŠŠ <code>po/vo/query/service æ¥å£/mapper æ¥å£</code> ç­‰<strong>é€šç”¨æ¨¡å‹</strong>æŠ½åˆ°å…¬å…±ä¾èµ–ï¼ˆæ¯”å¦‚ <code>easylive-cloud-common</code>ï¼‰ï¼Œä¸¤è¾¹éƒ½ä¾èµ–å®ƒï¼Œé¿å…é‡å¤æ‹·è´ä¸ç±»å‹ä¸ä¸€è‡´ã€‚æ–‡æ¡£ä¸­è¿™ä¸€æ­¥â€œè¿ç§»ç»†èŠ‚çœç•¥â€â€”â€”å®è·µé‡Œä¸€å®šè¦åšã€‚ï¼‰</p>
<p>æ³¨é‡Šæ‰å•æœåŠ¡çš„éƒ¨åˆ†ä»£ç æ–¹ä¾¿åæœŸæ‹“å±•ä¸ºå¾®æœåŠ¡</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1353.png" alt="img"></p>
<p>åœ¨adminæ¨¡å—ä¸‹çš„categoryInfoServiceImplä¸­</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1355.png" alt="img"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delCategory</span><span class="params">(Integer categoryId)</span> &#123;</span><br><span class="line">     <span class="type">VideoInfoQuery</span> <span class="variable">videoInfoQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VideoInfoQuery</span>();</span><br><span class="line">     videoInfoQuery.setCategoryIdOrPCategoryId(categoryId);</span><br><span class="line">      <span class="comment">//æ³¨é‡Šæ‰å•æœåŠ¡çš„ç‰ˆæœ¬ï¼Œå¾®æœåŠ¡ä¸­éœ€è¦ç”±webæ¨¡å—æä¾›æœåŠ¡æ¥å£è¿™é‡Œå†è°ƒç”¨</span></span><br><span class="line">      <span class="comment">//Integer count = videoInfoService.findCountByParam(videoInfoQuery)</span></span><br><span class="line">     <span class="comment">//TODO WEBæ¨¡å—æä¾›åˆ†ç±»ä¸‹çš„è§†é¢‘æ•°é‡</span></span><br><span class="line">     <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> videoInfoClient.getVideoCount(videoInfoQuery);</span><br><span class="line">     <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;åˆ†ç±»ä¸‹æœ‰è§†é¢‘ä¿¡æ¯ï¼Œæ— æ³•åˆ é™¤&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="type">CategoryInfoQuery</span> <span class="variable">categoryInfoQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CategoryInfoQuery</span>();</span><br><span class="line">     categoryInfoQuery.setCategoryIdOrPCategoryId(categoryId);</span><br><span class="line">     categoryInfoMapper.deleteByParam(categoryInfoQuery);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//åˆ·æ–°ç¼“å­˜</span></span><br><span class="line">     save2Redis();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1354.png" alt="img"></p>
<p>åœ¨webæ¨¡å—ä¸‹çš„CategoryController</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.<span class="type">RequestMapping</span>;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.<span class="type">RestController</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.<span class="type">Resource</span>;</span><br><span class="line"><span class="keyword">import</span> java.util.<span class="type">List</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">&quot;/category&quot;</span>)</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">CategoryController</span> <span class="keyword">extends</span> <span class="title">ABaseController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">CategoryClient</span> categoryClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">&quot;/loadAllCategory&quot;</span>)</span><br><span class="line">    public <span class="type">ResponseVO</span> loadAllCategory() &#123;</span><br><span class="line">        <span class="type">List</span>&lt;<span class="type">CategoryInfo</span>&gt; categoryInfoList = categoryClient.loadAllCategory();</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(categoryInfoList);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å…¥localhost:7071/web/category/loadAllCategoryï¼Œlocalhost:7071/admin/category/loadCategoryéƒ½èƒ½æˆåŠŸè¯»åˆ°åˆ†ç±»åˆ—è¡¨ä¸¤è¾¹æ•°æ®æ˜¯ä¸€æ ·çš„</p>
<p>æˆåŠŸé€šè¿‡gatewayä»7071ç«¯å£è®¿é—®åˆ°äº†7072webæ¨¡å—ä¸‹çš„å†…å®¹ä¸7070adminä¸‹çš„å†…å®¹</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1356.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1357-1024x398.png" alt="img"></p>
<h3 id="å°ç»“">å°ç»“</h3>
<ul>
<li><strong>Provider</strong> åœ¨ admin æš´éœ² <code>/inner/category/*</code>ï¼Œ<strong>Consumer</strong> åœ¨ web é€šè¿‡ Feign è°ƒç”¨ï¼Œå®Œæˆâ€œè¯»åˆ†ç±»â€çš„<strong>è·¨æœåŠ¡åŒ–</strong>ï¼›</li>
<li>ä¸šåŠ¡ä¸Šâ€œåˆ é™¤åˆ†ç±»å‰æ£€æŸ¥è§†é¢‘æ•°â€çš„<strong>è¿›ç¨‹å†…ä¾èµ–</strong>ï¼Œæ”¹ä¸ºè°ƒç”¨<strong>è§†é¢‘æœåŠ¡çš„å†…éƒ¨æ¥å£</strong>ï¼›</li>
<li>ç½‘å…³è´Ÿè´£<strong>è·¯ç”±ä¸ä¿æŠ¤</strong>ï¼Œå…¬å…±æ¨¡å‹æŠ½åˆ° <strong>common</strong>ï¼Œæ•´æ¡é“¾è·¯å°±ä»â€œå•ä½“æ–¹æ³•è°ƒç”¨â€å˜æˆäº†â€œ<strong>æœåŠ¡å‘ç° + RPC</strong>â€çš„å¾®æœåŠ¡åä½œã€‚</li>
</ul>
<h2 id="6-webæ¨¡å—æ‹†åˆ†è·å–é¦–é¡µä¿¡æ¯">6.webæ¨¡å—æ‹†åˆ†è·å–é¦–é¡µä¿¡æ¯</h2>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1358.png" alt="img"></p>
<p>é¦–å…ˆå…ˆæŠŠé¦–é¡µä¸­è¦ç”¨çš„poã€voã€queryã€serviceã€mapperç­‰ä¿¡æ¯è¿›è¡Œè¿ç§»ï¼Œåœ¨æ­¤çœç•¥ä¸åšé˜è¿°</p>
<p>æ³¨é‡Šæ‰å•æœåŠ¡çš„éƒ¨åˆ†ä»£ç æ–¹ä¾¿åæœŸæ‹“å±•ä¸ºå¾®æœåŠ¡</p>
<p>videoInfoServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 5) æäº¤åå¼‚æ­¥æ¸…ç†åˆ†Pã€å¼¹å¹•ã€è¯„è®ºä¸ç£ç›˜æ–‡ä»¶</span></span><br><span class="line">	executorService.execute(() -&gt; &#123;</span><br><span class="line">		<span class="comment">// 5.1 å…ˆæ‹¿æ–‡ä»¶æ¸…å•ï¼ˆç”¨äºå®šä½ç£ç›˜ç›®å½•ï¼‰</span></span><br><span class="line">		<span class="type">VideoInfoFileQuery</span> <span class="variable">q</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VideoInfoFileQuery</span>();</span><br><span class="line">		q.setVideoId(videoId);</span><br><span class="line">		List&lt;VideoInfoFile&gt; parts = videoInfoFileMapper.selectList(q);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 5.2 åˆ è®°å½•</span></span><br><span class="line">		videoInfoFileMapper.deleteByParam(q);</span><br><span class="line">		<span class="type">VideoInfoFilePostQuery</span> <span class="variable">pq</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VideoInfoFilePostQuery</span>();</span><br><span class="line">		pq.setVideoId(videoId);</span><br><span class="line">		videoInfoFilePostMapper.deleteByParam(pq);</span><br><span class="line"></span><br><span class="line">                   <span class="comment">//æ³¨é‡Šæ‰å•æœåŠ¡ç‰ˆæœ¬çš„åˆ é™¤å¼¹å¹•å’Œåˆ é™¤è¯„è®º,å¾®æœåŠ¡ç‰ˆæœ¬ä¸­è¿™é‡Œç”±äº¤äº’æ¨¡å—æä¾›æ¥å£</span></span><br><span class="line">                      <span class="comment">// //åˆ é™¤å¼¹å¹•</span></span><br><span class="line">		<span class="comment">//VideoDanmuQuery dq = new VideoDanmuQuery(); </span></span><br><span class="line">                       <span class="comment">// dq.setVideoId(videoId);</span></span><br><span class="line">		<span class="comment">//videoDanmuMapper.deleteByParam(dq);</span></span><br><span class="line">                      <span class="comment">// //åˆ é™¤è¯„è®º</span></span><br><span class="line">		<span class="comment">//VideoCommentQuery cq = new VideoCommentQuery(); </span></span><br><span class="line">                      <span class="comment">//  cq.setVideoId(videoId);                      </span></span><br><span class="line">		<span class="comment">//videoCommentMapper.deleteByParam(cq);</span></span><br><span class="line">                       <span class="comment">// TODO è°ƒç”¨äº’åŠ¨æ¨¡å— åˆ é™¤å¼¹å¹•ï¼Œåˆ é™¤è¯„è®º</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// 5.3 åˆ ç‰©ç†æ–‡ä»¶</span></span><br><span class="line">		<span class="keyword">for</span> (VideoInfoFile p : parts) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				FileUtils.deleteDirectory(<span class="keyword">new</span> <span class="title class_">File</span>(appConfig.getProjectFolder() + p.getFilePath()));</span><br><span class="line">			&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">				log.error(<span class="string">&quot;åˆ é™¤æ–‡ä»¶å¤±è´¥ï¼Œæ–‡ä»¶è·¯å¾„: &#123;&#125;&quot;</span>, p.getFilePath(), e);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1359.png" alt="img"></p>
<p>VideoControllerä¸­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–è§†é¢‘ä¿¡æ¯æ¥å£</span></span><br><span class="line"><span class="comment"> * æ ¹æ®è§†é¢‘IDè·å–è§†é¢‘çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·è¡Œä¸ºï¼ˆç‚¹èµï¼ŒæŠ•å¸ï¼Œæ”¶è—ï¼‰ç­‰ã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> videoId è§†é¢‘çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä¸èƒ½ä¸ºç©º</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> è¿”å›åŒ…å«è§†é¢‘è¯¦ç»†ä¿¡æ¯çš„ResponseVOå¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> BusinessException å¦‚æœè§†é¢‘IDå¯¹åº”çš„è§†é¢‘ä¸å­˜åœ¨ï¼Œåˆ™æŠ›å‡ºä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/getVideoInfo&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> ResponseVO <span class="title function_">getVideoInfo</span><span class="params">(<span class="meta">@NotEmpty</span> String videoId)</span> &#123;</span><br><span class="line">    <span class="type">VideoInfo</span> <span class="variable">videoInfo</span> <span class="operator">=</span> videoInfoService.getVideoInfoByVideoId(videoId);</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> == videoInfo) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ResponseCodeEnum.CODE_404); <span class="comment">// è§†é¢‘æœªæ‰¾åˆ°</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">TokenUserInfoDto</span> <span class="variable">userInfoDto</span> <span class="operator">=</span> getTokenUserInfoDto(); <span class="comment">// è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">    List&lt;UserAction&gt; userActionList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// å¦‚æœç”¨æˆ·å·²ç™»å½•ï¼Œè·å–ç”¨æˆ·çš„è¡Œä¸ºæ•°æ®ï¼ˆç‚¹èµã€æ”¶è—ç­‰ï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> (userInfoDto != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">UserActionQuery</span> <span class="variable">actionQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserActionQuery</span>();</span><br><span class="line">        actionQuery.setVideoId(videoId);</span><br><span class="line">        actionQuery.setUserId(userInfoDto.getUserId());</span><br><span class="line">        actionQuery.setActionTypeArray(<span class="keyword">new</span> <span class="title class_">Integer</span>[]&#123;UserActionTypeEnum.VIDEO_LIKE.getType(), UserActionTypeEnum.VIDEO_COLLECT.getType(),</span><br><span class="line">                UserActionTypeEnum.VIDEO_COIN.getType(),&#125;);</span><br><span class="line">      <span class="comment">//æ³¨é‡Šæ‰å•æœåŠ¡ç‰ˆæœ¬ï¼Œå¾®æœåŠ¡ä¸­è¿™é‡Œåº”è°ƒç”¨äº’åŠ¨æ¨¡å—çš„æ¥å£</span></span><br><span class="line">      <span class="comment">//  userActionList = userActionService.findListByParam(actionQuery);// æŸ¥è¯¢ç”¨æˆ·çš„è¡Œä¸ºè®°å½•</span></span><br><span class="line">        <span class="comment">//TODO è°ƒç”¨äº’åŠ¨æ¨¡å—è·å–ç”¨æˆ·è¡Œä¸º</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¿”å›è§†é¢‘ä¿¡æ¯å’Œç”¨æˆ·è¡Œä¸ºæ•°æ®</span></span><br><span class="line">    <span class="type">VideoInfoResultVo</span> <span class="variable">resultVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VideoInfoResultVo</span>(videoInfo,userActionList);</span><br><span class="line">    <span class="keyword">return</span> getSuccessResponseVO(resultVo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1360.png" alt="img"></p>
<p><strong>å˜åŠ¨è§£æï¼š</strong></p>
<ul>
<li>
<p><strong>åŸå…ˆçš„æŸ¥è¯¢é€»è¾‘</strong>ï¼šç›´æ¥é€šè¿‡ <code>videoInfoService</code> è·å–è§†é¢‘ä¿¡æ¯ï¼Œå¹¶é€šè¿‡ <code>userActionService</code> è·å–ç”¨æˆ·çš„äº’åŠ¨è¡Œä¸ºï¼ˆç‚¹èµã€æŠ•å¸ç­‰ï¼‰ã€‚è¿™äº›æ“ä½œä¹‹å‰æ˜¯å•ä½“æœåŠ¡å†…éƒ¨è°ƒç”¨ã€‚</p>
</li>
<li>
<p>å¾®æœåŠ¡åŒ–åçš„æ“ä½œ</p>
<p>ï¼š</p>
<ul>
<li><strong>è§†é¢‘ä¿¡æ¯</strong>ä¾ç„¶é€šè¿‡ <code>videoInfoService</code> è·å–ï¼ˆä¸å˜ï¼‰ã€‚</li>
<li><strong>ç”¨æˆ·è¡Œä¸ºæ•°æ®</strong>éœ€è¦è°ƒç”¨ç‹¬ç«‹çš„<strong>äº’åŠ¨æ¨¡å—</strong>æ¥å£ï¼Œè·å–ç‚¹èµã€æ”¶è—ã€æŠ•å¸ç­‰ä¿¡æ¯ï¼Œè€Œä¸å†é€šè¿‡æœ¬æ¨¡å—ç›´æ¥æŸ¥è¯¢ã€‚</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šä¸ºäº†è®© <code>userActionService</code> å˜æˆå¯ä»¥è°ƒç”¨çš„å¾®æœåŠ¡æ¥å£ï¼Œé€šå¸¸ä¼šä½¿ç”¨ <strong>OpenFeign</strong> æ¥è¿›è¡Œè¿œç¨‹æœåŠ¡è°ƒç”¨ï¼Œè¿™å°±è¦æ±‚äº’åŠ¨æ¨¡å—æš´éœ²ç›¸åº”çš„ API æ¥å£ï¼Œä¾›è§†é¢‘æ¨¡å—æ¶ˆè´¹ã€‚</p>
</blockquote>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1361.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1362.png" alt="img"></p>
<h2 id="7-resourceæ¨¡å—ä¸­è°ƒç”¨èµ„æºæœåŠ¡è·å–æ–‡ä»¶ä¿¡æ¯">7.resourceæ¨¡å—ä¸­è°ƒç”¨èµ„æºæœåŠ¡è·å–æ–‡ä»¶ä¿¡æ¯</h2>
<p><strong>resourceæ¨¡å—</strong>ä»å•ä½“æ¶æ„æ‹†åˆ†ä¸ºå¾®æœåŠ¡æ¶æ„çš„è¿‡ç¨‹ä¸»è¦ä½“ç°åœ¨å¦‚ä½•å°† <strong>è§†é¢‘èµ„æºçš„è·å–</strong>ï¼ˆå¦‚è§†é¢‘æ–‡ä»¶å’Œæ–‡ä»¶ç‰‡æ®µçš„å¤„ç†ï¼‰ä»åŸæ¥åœ¨åŒä¸€ä¸ªåº”ç”¨ä¸­å®Œæˆï¼Œæ‹†åˆ†åˆ°å¾®æœåŠ¡ä¸­ï¼Œå¹¶é€šè¿‡ <strong>OpenFeign</strong> æ¥è°ƒç”¨å…¶ä»–æœåŠ¡è·å–æ•°æ®ã€‚</p>
<p>é¦–å…ˆå…ˆæŠŠé¦–é¡µä¸­è¦ç”¨çš„poã€voã€queryã€serviceã€mapperç­‰ä¿¡æ¯è¿›è¡Œè¿ç§»ï¼Œåœ¨æ­¤çœç•¥ä¸åšé˜è¿°</p>
<p>åœ¨resourceæ¨¡å—ä¸‹åˆ›å»ºapi-consumer-VideoClient</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@FeignClient</span>(name = Constants.SERVER_NAME_WEB)</span><br><span class="line">public interface VideoClient &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/video/getVideoInfoFileByFileId&quot;</span>)</span><br><span class="line">    VideoInfoFile <span class="built_in">getVideoInfoFileByFileId</span>(<span class="variable">@RequestParam</span> String fileId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨webæ¨¡å—ä¸‹provider-VideoInfoApi</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(Constants.INNER_API_PREFIX + <span class="string">&quot;/video&quot;</span>)</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VideoInfoApi</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> VideoInfoService videoInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> VideoInfoFileService videoInfoFileService;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(<span class="string">&quot;/getVideoInfoFileByFileId&quot;</span>)</span></span><br><span class="line">    <span class="keyword">public</span> VideoInfoFile getVideoInfoFileByFileId(<span class="meta">@NotEmpty</span> String fileId) &#123;</span><br><span class="line">        VideoInfoFile videoInfoFile = videoInfoFileService.getVideoInfoFileByFileId(fileId);</span><br><span class="line">        <span class="keyword">return</span> videoInfoFile;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨resourceæ¨¡å—ä¸‹çš„FileController</p>
<p>æ³¨é‡Šæ‰å•æœåŠ¡çš„éƒ¨åˆ†ä»£ç æ–¹ä¾¿åæœŸæ‹“å±•ä¸ºå¾®æœåŠ¡</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">VideoClient</span> videoClient;</span><br><span class="line">   <span class="comment">//åŸæœ¬å•æœåŠ¡å®ç°</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// /**</span></span><br><span class="line">    <span class="comment">//  * è·å–è§†é¢‘èµ„æº(m3u8)å¹¶åŸ‹ç‚¹æ’­æ”¾äº‹ä»¶</span></span><br><span class="line">    <span class="comment">//  */</span></span><br><span class="line">    <span class="comment">// @RequestMapping(&quot;/videoResource/&#123;fileId&#125;&quot;)</span></span><br><span class="line">    <span class="comment">// public void videoResource(HttpServletResponse response, @PathVariable @NotEmpty String fileId) &#123;</span></span><br><span class="line">    <span class="comment">//     // 1) æŸ¥åˆ†Pæ–‡ä»¶ä¿¡æ¯ï¼ˆåŒ…å« videoId / fileIndex / filePathï¼‰</span></span><br><span class="line">    <span class="comment">//     VideoInfoFile videoInfoFile = videoInfoFileService.getVideoInfoFileByFileId(fileId);</span></span><br><span class="line">    <span class="comment">//     if (videoInfoFile == null) &#123;                       // å¥å£®æ€§ï¼šé¿å… NPE</span></span><br><span class="line">    <span class="comment">//         response.setStatus(HttpServletResponse.SC_NOT_FOUND);</span></span><br><span class="line">    <span class="comment">//         return;</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//     // 2) ç›´æ¥æŠŠ m3u8 è¿”å›ç»™å‰ç«¯ï¼ˆä¸é˜»å¡åŸ‹ç‚¹ï¼‰</span></span><br><span class="line">    <span class="comment">//     String filePath = videoInfoFile.getFilePath();</span></span><br><span class="line">    <span class="comment">//     readFile(response, filePath + &quot;/&quot; + Constants.M3U8_NAME);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//     // 3) ç»„ç»‡â€œæ’­æ”¾äº‹ä»¶â€æŠ•é€’åˆ° Redis é˜Ÿåˆ—ï¼ˆå¼‚æ­¥å†å¤„ç†ï¼‰</span></span><br><span class="line">    <span class="comment">//     VideoPlayInfoDto dto = new VideoPlayInfoDto();</span></span><br><span class="line">    <span class="comment">//     dto.setVideoId(videoInfoFile.getVideoId());        // è§†é¢‘ID</span></span><br><span class="line">    <span class="comment">//     dto.setFileIndex(videoInfoFile.getFileIndex());    // ç¬¬å‡ Pï¼ˆå¯ç”¨äºç»†ç²’åº¦ç»Ÿè®¡ï¼‰</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//     // å¯é€‰ï¼šä» cookie è§£æå½“å‰ç™»å½•ç”¨æˆ·ï¼Œç”¨äºå›å¡«â€œè§‚çœ‹å†å²/ä¸ªæ€§åŒ–æ¨èâ€</span></span><br><span class="line">    <span class="comment">//     TokenUserInfoDto tokenUserInfoDto = getTokenInfoFromCookie();</span></span><br><span class="line">    <span class="comment">//     if (tokenUserInfoDto != null) &#123;</span></span><br><span class="line">    <span class="comment">//         dto.setUserId(tokenUserInfoDto.getUserId());</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//     // 4) æ¨å…¥é˜Ÿåˆ—ï¼ˆLPUSHï¼‰ï¼Œä¸è®¾ç½®è¿‡æœŸ</span></span><br><span class="line">    <span class="comment">//     redisComponent.addVideoPlay(dto);</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    //  * è·å–è§†é¢‘èµ„æºæ–‡ä»¶ç‰‡æ®µ</span></span><br><span class="line"><span class="comment">    //  * æ ¹æ®æ–‡ä»¶IDå’Œæ—¶é—´æˆ³è·å–å¯¹åº”çš„è§†é¢‘èµ„æºæ–‡ä»¶ç‰‡æ®µï¼Œå¹¶å°†æ–‡ä»¶å†…å®¹å†™å…¥å“åº”ä¸­</span></span><br><span class="line"><span class="comment">    //  *</span></span><br><span class="line"><span class="comment">    //  * <span class="doctag">@param</span> response HttpServletResponseå¯¹è±¡ï¼Œç”¨äºå°†æ–‡ä»¶å†…å®¹å†™å…¥å“åº”</span></span><br><span class="line"><span class="comment">    //  * <span class="doctag">@param</span> fileId æ–‡ä»¶IDï¼Œç”¨äºå”¯ä¸€æ ‡è¯†ä¸€ä¸ªè§†é¢‘æ–‡ä»¶</span></span><br><span class="line"><span class="comment">    //  * <span class="doctag">@param</span> ts æ—¶é—´æˆ³ï¼Œç”¨äºå®šä½è§†é¢‘æ–‡ä»¶ä¸­çš„å…·ä½“ç‰‡æ®µ</span></span><br><span class="line"><span class="comment">    //  */</span></span><br><span class="line">    <span class="comment">// @RequestMapping(&quot;/videoResource/&#123;fileId&#125;/&#123;ts&#125;&quot;)</span></span><br><span class="line">    <span class="comment">// public void videoResourceTs(HttpServletResponse response, @PathVariable @NotEmpty String fileId, @PathVariable @NotNull String ts) &#123;</span></span><br><span class="line">    <span class="comment">//     // é€šè¿‡æ–‡ä»¶IDè·å–è§†é¢‘ä¿¡æ¯æ–‡ä»¶å‘å¸ƒè®°å½•</span></span><br><span class="line">    <span class="comment">//     VideoInfoFile videoInfoFile = videoInfoFileService.getVideoInfoFileByFileId(fileId);</span></span><br><span class="line">    <span class="comment">//     // è·å–è§†é¢‘æ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line">    <span class="comment">//     String filePath = videoInfoFile.getFilePath() + &quot;&quot;;</span></span><br><span class="line">    <span class="comment">//     // è¯»å–æ–‡ä»¶å¹¶å°†æ–‡ä»¶å†…å®¹å†™å…¥å“åº”</span></span><br><span class="line">    <span class="comment">//     // filePath + &quot;/&quot; + ts æ˜¯æ–‡ä»¶çš„å®Œæ•´è·¯å¾„ï¼Œå…¶ä¸­ filePath æ˜¯è§†é¢‘æ–‡ä»¶çš„ç›®å½•ï¼Œts æ˜¯è§†é¢‘ç‰‡æ®µçš„æ—¶é—´æˆ³</span></span><br><span class="line">    <span class="comment">//     readFile(response, filePath + &quot;/&quot; + ts);</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">   <span class="comment">//å¾®æœåŠ¡å®ç°</span></span><br><span class="line">         <span class="meta">@RequestMapping</span>(<span class="string">&quot;/videoResource/&#123;fileId&#125;&quot;</span>)</span><br><span class="line">    <span class="meta">@GlobalInterceptor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">getVideoResource</span>(<span class="params"><span class="title class_">HttpServletResponse</span> response, <span class="meta">@PathVariable</span> <span class="meta">@NotEmpty</span> <span class="title class_">String</span> fileId</span>) &#123;</span><br><span class="line">        <span class="title class_">VideoInfoFile</span> videoInfoFile = videoClient.<span class="title function_">getVideoInfoFileByFileId</span>(fileId);</span><br><span class="line">        <span class="keyword">if</span> (videoInfoFile == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">String</span> filePath = videoInfoFile.<span class="title function_">getFilePath</span>();</span><br><span class="line">        <span class="title function_">readFile</span>(response, filePath + <span class="string">&quot;/&quot;</span> + <span class="title class_">Constants</span>.<span class="property">M3U8_NAME</span>);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">VideoPlayInfoDto</span> videoPlayInfoDto = <span class="keyword">new</span> <span class="title class_">VideoPlayInfoDto</span>();</span><br><span class="line">        videoPlayInfoDto.<span class="title function_">setVideoId</span>(videoInfoFile.<span class="title function_">getVideoId</span>());</span><br><span class="line">        videoPlayInfoDto.<span class="title function_">setFileIndex</span>(videoInfoFile.<span class="title function_">getFileIndex</span>());</span><br><span class="line"></span><br><span class="line">        <span class="title class_">TokenUserInfoDto</span> tokenUserInfoDto = <span class="title function_">getTokenInfoFromCookie</span>();</span><br><span class="line">        <span class="keyword">if</span> (tokenUserInfoDto != <span class="literal">null</span>) &#123;</span><br><span class="line">            videoPlayInfoDto.<span class="title function_">setUserId</span>(tokenUserInfoDto.<span class="title function_">getUserId</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        redisComponent.<span class="title function_">addVideoPlay</span>(videoPlayInfoDto);</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="meta">@RequestMapping</span>(<span class="string">&quot;/videoResource/&#123;fileId&#125;/&#123;ts&#125;&quot;</span>)</span><br><span class="line">    <span class="meta">@GlobalInterceptor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">getVideoResourceTs</span>(<span class="params"><span class="title class_">HttpServletResponse</span> response, <span class="meta">@PathVariable</span> <span class="meta">@NotEmpty</span> <span class="title class_">String</span> fileId, <span class="meta">@PathVariable</span> <span class="meta">@NotNull</span> <span class="title class_">String</span> ts</span>) &#123;</span><br><span class="line">        <span class="title class_">VideoInfoFile</span> videoInfoFile = videoClient.<span class="title function_">getVideoInfoFileByFileId</span>(fileId);</span><br><span class="line">        <span class="title class_">String</span> filePath = videoInfoFile.<span class="title function_">getFilePath</span>() + <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="title function_">readFile</span>(response, filePath + <span class="string">&quot;/&quot;</span> + ts);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1363-842x1024.png" alt="img"></p>
<p>è¿™æ®µä»£ç åšäº†ä»¥ä¸‹å‡ ä»¶äº‹ï¼š</p>
<ol>
<li><strong>æŸ¥è¯¢è§†é¢‘æ–‡ä»¶ä¿¡æ¯</strong>ï¼šæ ¹æ® <code>fileId</code> æŸ¥æ‰¾å¯¹åº”çš„è§†é¢‘æ–‡ä»¶ä¿¡æ¯ï¼ˆåŒ…æ‹¬æ–‡ä»¶è·¯å¾„ã€è§†é¢‘IDç­‰ï¼‰ã€‚</li>
<li><strong>è¿”å›è§†é¢‘èµ„æº</strong>ï¼šè¿”å› <code>m3u8</code> æ ¼å¼çš„æ–‡ä»¶å†…å®¹ã€‚</li>
<li><strong>å¼‚æ­¥å¤„ç†æ’­æ”¾äº‹ä»¶</strong>ï¼šå°†è§†é¢‘æ’­æ”¾ä¿¡æ¯æ¨é€åˆ° Redis é˜Ÿåˆ—ï¼Œä»¥ä¾¿åç»­å¤„ç†ï¼ˆä¾‹å¦‚ç»Ÿè®¡ã€æ¨èç­‰ï¼‰ã€‚</li>
</ol>
<p><strong>é—®é¢˜</strong>ï¼š</p>
<p>è¿™ä¸ªä»£ç å¤„ç†é€»è¾‘æ˜¯<strong>å•ä½“æ¶æ„</strong>ä¸­ï¼Œ<code>videoInfoFileService</code> å’Œèµ„æºæœåŠ¡éƒ½åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ã€‚å½“æ‹†åˆ†ä¸ºå¾®æœåŠ¡æ¶æ„æ—¶ï¼Œ<code>videoInfoFileService</code> è¢«æ‹†åˆ°äº† <strong>web æœåŠ¡</strong> ä¸­ï¼Œ<code>resource</code> æœåŠ¡éœ€è¦é€šè¿‡è¿œç¨‹è°ƒç”¨æ¥è·å–è§†é¢‘ä¿¡æ¯ã€‚</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1364.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1365.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1366.png" alt="img"></p>
<h3 id="æ€»ç»“ä¸æ”¹åŠ¨ç‚¹"><strong>æ€»ç»“ä¸æ”¹åŠ¨ç‚¹</strong></h3>
<h4 id="æ”¹åŠ¨ç‚¹ï¼š"><strong>æ”¹åŠ¨ç‚¹</strong>ï¼š</h4>
<ol>
<li><strong>è¿œç¨‹è°ƒç”¨</strong>ï¼šä»ç›´æ¥è°ƒç”¨ <code>videoInfoFileService</code>ï¼Œæ”¹ä¸ºé€šè¿‡ <code>VideoClient</code>ï¼ˆFeignï¼‰è°ƒç”¨ <strong>web æœåŠ¡</strong>ã€‚</li>
<li><strong>æ§åˆ¶å™¨è°ƒæ•´</strong>ï¼šåŸæœ¬åœ¨ <code>resource</code> æœåŠ¡ä¸­å¤„ç†çš„<strong>è§†é¢‘èµ„æºæ–‡ä»¶è·å–é€»è¾‘</strong>ï¼Œæ”¹æˆäº†é€šè¿‡ Feign è°ƒç”¨å…¶ä»–æœåŠ¡ï¼ˆwebï¼‰æ¥è·å–æ•°æ®ã€‚</li>
<li><strong>è§£è€¦</strong>ï¼šæœåŠ¡ä¹‹é—´é€šè¿‡ API è¿›è¡Œé€šä¿¡ï¼Œé¿å…äº†å•ä½“æ¶æ„ä¸‹çš„â€œå¼ºè€¦åˆâ€ã€‚</li>
<li><strong>æ‰©å±•æ€§</strong>ï¼šå½“ä¸šåŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªå¾®æœåŠ¡åï¼Œæ¯ä¸ªæ¨¡å—éƒ½å¯ä»¥ç‹¬ç«‹æ‰©å±•ï¼Œç¬¦åˆå¾®æœåŠ¡æ¶æ„çš„<strong>èŒè´£å•ä¸€åŒ–</strong>ã€‚</li>
</ol>
<h4 id="å¥½å¤„ï¼š"><strong>å¥½å¤„</strong>ï¼š</h4>
<ul>
<li><strong>æ¨¡å—è§£è€¦</strong>ï¼šå°†è§†é¢‘ç›¸å…³æ“ä½œä» <code>resource</code> æœåŠ¡ä¸­æ‹†åˆ†ï¼Œ<code>resource</code> æœåŠ¡åªè´Ÿè´£æ–‡ä»¶èµ„æºç›¸å…³çš„é€»è¾‘ï¼Œè€Œè§†é¢‘ä¿¡æ¯çš„å¤„ç†äº¤ç»™ <strong>web æœåŠ¡</strong>ï¼Œæé«˜äº†æœåŠ¡çš„å†…èšæ€§ä¸èŒè´£å•ä¸€æ€§ã€‚</li>
<li><strong>å¯æ‰©å±•æ€§</strong>ï¼šå¦‚æœä»¥åéœ€è¦å¯¹è§†é¢‘æ¨¡å—çš„åŠŸèƒ½è¿›è¡Œæ‰©å±•æˆ–ä¼˜åŒ–ï¼Œå¯ä»¥ç‹¬ç«‹ä¿®æ”¹ <strong>web æœåŠ¡</strong>ï¼Œä¸å½±å“å…¶ä»–æ¨¡å—ã€‚</li>
<li><strong>æœåŠ¡å¤ç”¨</strong>ï¼šé€šè¿‡ <strong>OpenFeign</strong> å®ç°æœåŠ¡é—´çš„è°ƒç”¨ï¼Œé¿å…äº†é‡å¤ä»£ç ï¼Œå¢å¼ºäº†ä»£ç å¤ç”¨æ€§ã€‚</li>
</ul>
<h2 id="8-interactæ¨¡å—è°ƒç”¨äº’åŠ¨æœåŠ¡">8.interactæ¨¡å—è°ƒç”¨äº’åŠ¨æœåŠ¡</h2>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1367.png" alt="img"></p>
<p>é¦–å…ˆå…ˆæŠŠäº’åŠ¨ç›¸å…³è¦ç”¨çš„poã€voã€queryã€serviceã€mapperç­‰ä¿¡æ¯è¿›è¡Œè¿ç§»ï¼Œåœ¨æ­¤çœç•¥ä¸åšé˜è¿°</p>
<p>1.åœ¨interactæ¨¡å—ä¸‹api-consumer-VideoClient</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@FeignClient</span>(Constants.SERVER_NAME_WEB)</span><br><span class="line">public interface VideoClient &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨æˆ·ç¡¬å¸ï¼šå¢/å‡</span></span><br><span class="line">    <span class="variable">@GetMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/user/updateCoinCountInfo&quot;</span>)</span><br><span class="line">    Integer <span class="built_in">updateCoinCountInfo</span>(<span class="variable">@RequestParam</span> String userId, <span class="variable">@RequestParam</span> Integer count);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŸ¥ç”¨æˆ·</span></span><br><span class="line">    <span class="variable">@GetMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/user/getUserInfoByUserId&quot;</span>)</span><br><span class="line">    UserInfo <span class="built_in">getUserInfoByUserId</span>(<span class="variable">@RequestParam</span> String userId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŸ¥è§†é¢‘</span></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/video/getVideoInfoByVideoId&quot;</span>)</span><br><span class="line">    VideoInfo <span class="built_in">getVideoInfoByVideoId</span>(<span class="variable">@RequestParam</span> String videoId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ”¹è§†é¢‘è®¡æ•°å­—æ®µï¼šç‚¹èµ/æ”¶è—/è¯„è®º/å¼¹å¹•/æŠ•å¸ â€¦</span></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/video/updateCountInfo&quot;</span>)</span><br><span class="line">    Integer <span class="built_in">updateCountInfo</span>(<span class="variable">@RequestParam</span> String videoId, <span class="variable">@RequestParam</span> String field,</span><br><span class="line">                            <span class="variable">@RequestParam</span> Integer changeCount);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŸ¥å®¡æ ¸ç¨¿ï¼ˆç³»ç»Ÿæ¶ˆæ¯ç”¨ï¼‰</span></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/video/getVideoInfoPostByVideoId&quot;</span>)</span><br><span class="line">    VideoInfoPost <span class="built_in">getVideoInfoPostByVideoId</span>(<span class="variable">@RequestParam</span> String videoId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŒæ­¥ ES æ’åºè®¡æ•°</span></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/video/updateDocCount&quot;</span>)</span><br><span class="line">    void <span class="built_in">updateDocCount</span>(<span class="variable">@RequestParam</span> String videoId,</span><br><span class="line">                        <span class="variable">@RequestParam</span> SearchOrderTypeEnum searchOrderTypeEnum,</span><br><span class="line">                        <span class="variable">@RequestParam</span> Integer changeCOunt);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1370-769x1024.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1371.png" alt="img"></p>
<p>æŠŠå•ä½“é‡Œçš„æœ¬åœ°ä¾èµ–æ”¹æˆè¿œç¨‹ä¾èµ–ï¼ˆä¸‰å¤§æ ¸å¿ƒåœºæ™¯ï¼‰</p>
<p>åœºæ™¯ä¸€ï¼šç‚¹èµ/æ”¶è—/æŠ•å¸ï¼ˆUserActionServiceImplï¼‰åœ¨UserActionServiceImplä¸­</p>
<ul>
<li>äº‹åŠ¡è¾¹ç•Œï¼šåŠ äº† <strong><code>@GlobalTransactional</code></strong>ï¼Œäº¤ç”± Seata ç®¡è·¨æœåŠ¡ä¸€è‡´æ€§ï¼›</li>
<li>é¢†åŸŸç¼–æ’ï¼šInteract åˆ¤æ–­æ—§è¡Œä¸ºã€å†™ <code>user_action</code> è¡¨ï¼›éœ€è¦æ”¹è§†é¢‘è®¡æ•°/æ‰£ç¡¬å¸æ—¶ï¼Œ<strong>è®© Web å»åš</strong>ã€‚</li>
</ul>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line">    @Resource</span><br><span class="line">    private VideoClient videoClient;</span><br><span class="line">    <span class="string">//</span>å•æœåŠ¡ç‰ˆæœ¬ä¸­</span><br><span class="line">       <span class="string">//</span> /**</span><br><span class="line">    <span class="string">//</span>  * ä¿å­˜ç”¨æˆ·æ“ä½œã€‚</span><br><span class="line">    <span class="string">//</span>  *</span><br><span class="line">    <span class="string">//</span>  * @param bean ç”¨æˆ·æ“ä½œå®ä½“</span><br><span class="line">    <span class="string">//</span>  * @throws BusinessException ä¸šåŠ¡å¼‚å¸¸</span><br><span class="line">    <span class="string">//</span>  */</span><br><span class="line">    <span class="string">//</span> @Override</span><br><span class="line">    <span class="string">//</span> @Transactional<span class="params">(<span class="attr">rollbackFor</span> = Exception.class)</span></span><br><span class="line">    <span class="string">//</span> public void saveAction<span class="params">(UserAction bean)</span> &#123;</span><br><span class="line">    <span class="string">//</span>     <span class="string">//</span> è·å–è§†é¢‘ä¿¡æ¯ï¼ŒéªŒè¯è§†é¢‘æ˜¯å¦å­˜åœ¨</span><br><span class="line">    <span class="string">//</span>     VideoInfo videoInfo = videoInfoMapper.selectByVideoId<span class="params">(bean.getVideoId()</span>);</span><br><span class="line">    <span class="string">//</span>     <span class="keyword">if</span> <span class="params">(<span class="attr">videoInfo</span> == null)</span> &#123;</span><br><span class="line">    <span class="string">//</span>         throw new BusinessException<span class="params">(ResponseCodeEnum.CODE_600)</span>; <span class="string">//</span> å¦‚æœè§†é¢‘ä¸å­˜åœ¨ï¼ŒæŠ›å‡ºå¼‚å¸¸</span><br><span class="line">    <span class="string">//</span>     &#125;</span><br><span class="line">    <span class="string">//</span>     bean.<span class="keyword">set</span>VideoUserId<span class="params">(videoInfo.getUserId()</span>);<span class="string">//</span> è®¾ç½®è§†é¢‘ç”¨æˆ·ID</span><br><span class="line">    <span class="string">//</span>     <span class="string">//</span> è·å–æ“ä½œç±»å‹æšä¸¾</span><br><span class="line">    <span class="string">//</span>     UserActionTypeEnum actionTypeEnum = UserActionTypeEnum.getByType<span class="params">(bean.getActionType()</span>);</span><br><span class="line">    <span class="string">//</span>     <span class="keyword">if</span> <span class="params">(<span class="attr">actionTypeEnum</span> == null)</span> &#123;</span><br><span class="line">    <span class="string">//</span>         throw new BusinessException<span class="params">(ResponseCodeEnum.CODE_600)</span>; <span class="string">//</span> å¦‚æœæ“ä½œç±»å‹æ— æ•ˆï¼ŒæŠ›å‡ºå¼‚å¸¸</span><br><span class="line">    <span class="string">//</span>     &#125;</span><br><span class="line">    <span class="string">//</span>     <span class="string">//</span> æŸ¥è¯¢æ˜¯å¦å·²æœ‰ç›¸åŒçš„ç”¨æˆ·è¡Œä¸ºè®°å½•ï¼Œå¦‚æœæœ‰åˆ™åˆ é™¤æ—§çš„è®°å½•å¹¶æ›´æ–°è®¡æ•°å™¨ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ’å…¥æ–°è®°å½•å¹¶æ›´æ–°è®¡æ•°å™¨ã€‚</span><br><span class="line">    <span class="string">//</span>     UserAction dbAction = userActionMapper.selectByVideoIdAndCommentIdAndActionTypeAndUserId<span class="params">(bean.getVideoId()</span>, bean.getCommentId<span class="params">()</span>, bean.getActionType<span class="params">()</span>,</span><br><span class="line">    <span class="string">//</span>             bean.getUserId<span class="params">()</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="string">//</span>     bean.<span class="keyword">set</span>ActionTime<span class="params">(new Date()</span>); <span class="string">//</span> è®¾ç½®æ“ä½œæ—¶é—´</span><br><span class="line">    <span class="string">//</span>     <span class="string">//</span> æ ¹æ®è¡Œä¸ºç±»å‹è¿›è¡Œæ“ä½œï¼ˆç‚¹èµã€æ”¶è—ï¼‰</span><br><span class="line">    <span class="string">//</span>     switch <span class="params">(actionTypeEnum)</span> &#123;</span><br><span class="line">    <span class="string">//</span>         <span class="string">//</span>ç‚¹èµ,æ”¶è—</span><br><span class="line">    <span class="string">//</span>         case VIDEO_LIKE:</span><br><span class="line">    <span class="string">//</span>         case VIDEO_COLLECT:</span><br><span class="line">    <span class="string">//</span>             <span class="string">//</span> ç‚¹èµæˆ–æ”¶è—ï¼šå¦‚æœå·²ç»æœ‰è¡Œä¸ºè®°å½•ï¼Œåˆ é™¤è®°å½•ï¼›å¦‚æœæ²¡æœ‰ï¼Œæ’å…¥æ–°è®°å½•</span><br><span class="line">    <span class="string">//</span>             <span class="keyword">if</span> <span class="params">(dbAction != null)</span> &#123;</span><br><span class="line">    <span class="string">//</span>                 userActionMapper.deleteByActionId<span class="params">(dbAction.getActionId()</span>);<span class="string">//</span> åˆ é™¤æ—§è®°å½•</span><br><span class="line">    <span class="string">//</span>             &#125; else &#123;</span><br><span class="line">    <span class="string">//</span>                 userActionMapper.insert<span class="params">(bean)</span>;<span class="string">//</span> æ’å…¥æ–°è®°å½•</span><br><span class="line">    <span class="string">//</span>             &#125;</span><br><span class="line">    <span class="string">//</span>             Integer changeCount = dbAction == null ? 1 : -1;<span class="string">//</span> å¢åŠ æˆ–å‡å°‘è®¡æ•°</span><br><span class="line">    <span class="string">//</span>             videoInfoMapper.updateCountInfo<span class="params">(bean.getVideoId()</span>, actionTypeEnum.getField<span class="params">()</span>, changeCount); <span class="string">//</span> æ›´æ–°è§†é¢‘ç»Ÿè®¡ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">    <span class="string">//</span>             <span class="keyword">if</span> <span class="params">(<span class="attr">actionTypeEnum</span> == UserActionTypeEnum.VIDEO_COLLECT)</span> &#123;</span><br><span class="line">    <span class="string">//</span>                 <span class="string">//</span> æ›´æ–°esæ”¶è—æ•°é‡</span><br><span class="line">    <span class="string">//</span>                 esSearchComponent.updateDocCount<span class="params">(videoInfo.getVideoId()</span>, SearchOrderTypeEnum.VIDEO_COLLECT.getField<span class="params">()</span>, changeCount);</span><br><span class="line">    <span class="string">//</span>             &#125;</span><br><span class="line">    <span class="string">//</span>             break;</span><br><span class="line">	<span class="string">//</span> 		case VIDEO_COIN:</span><br><span class="line">    <span class="string">//</span>             <span class="string">//</span> 1. æ£€æŸ¥UPä¸»æ˜¯å¦ç»™è‡ªå·±æŠ•å¸</span><br><span class="line">    <span class="string">//</span>             <span class="keyword">if</span> <span class="params">(videoInfo.getUserId()</span><span class="string">.equals</span><span class="params">(bean.getUserId()</span>)) &#123;</span><br><span class="line">	<span class="string">//</span> 				throw new BusinessException<span class="params">(&quot;UPä¸»ä¸èƒ½ç»™è‡ªå·±æŠ•å¸&quot;)</span>;</span><br><span class="line">	<span class="string">//</span> 			&#125;</span><br><span class="line">    <span class="string">//</span>             <span class="string">//</span> 2. æ£€æŸ¥è¯¥è§†é¢‘æ˜¯å¦å·²æŠ•å¸</span><br><span class="line">	<span class="string">//</span> 			<span class="keyword">if</span> <span class="params">(dbAction != null)</span> &#123;</span><br><span class="line">	<span class="string">//</span> 				throw new BusinessException<span class="params">(&quot;å¯¹æœ¬ç¨¿ä»¶çš„æŠ•å¸æšæ•°å·²ç”¨å®Œ&quot;)</span>;</span><br><span class="line">	<span class="string">//</span> 			&#125;</span><br><span class="line">    <span class="string">//</span>             <span class="string">//</span> 3. å‡å°‘ç”¨æˆ·çš„ç¡¬å¸æ•°é‡</span><br><span class="line">	<span class="string">//</span> 			Integer updateCount = userInfoMapper.updateCoinCountInfo<span class="params">(bean.getUserId()</span>, -bean.getActionCount<span class="params">()</span>);</span><br><span class="line">	<span class="string">//</span> 			<span class="keyword">if</span> <span class="params">(<span class="attr">updateCount</span> == 0)</span> &#123;</span><br><span class="line">	<span class="string">//</span> 				throw new BusinessException<span class="params">(&quot;å¸ä¸å¤Ÿ&quot;)</span>;</span><br><span class="line">	<span class="string">//</span> 			&#125;</span><br><span class="line">    <span class="string">//</span>             <span class="string">//</span> 4. ç»™è§†é¢‘ä½œè€…å¢åŠ ç¡¬å¸</span><br><span class="line">	<span class="string">//</span> 			updateCount = userInfoMapper.updateCoinCountInfo<span class="params">(videoInfo.getUserId()</span>, bean.getActionCount<span class="params">()</span>);</span><br><span class="line">	<span class="string">//</span> 			<span class="keyword">if</span> <span class="params">(<span class="attr">updateCount</span> == 0)</span> &#123;</span><br><span class="line">	<span class="string">//</span> 				throw new BusinessException<span class="params">(&quot;æŠ•å¸å¤±è´¥&quot;)</span>;</span><br><span class="line">	<span class="string">//</span> 			&#125;</span><br><span class="line">    <span class="string">//</span>             <span class="string">//</span> 5. ä¿å­˜ç”¨æˆ·çš„æŠ•å¸è¡Œä¸ºè®°å½•</span><br><span class="line">	<span class="string">//</span> 			userActionMapper.insert<span class="params">(bean)</span>;</span><br><span class="line">    <span class="string">//</span>             <span class="string">//</span> 6. æ›´æ–°è§†é¢‘çš„æŠ•å¸ç»Ÿè®¡</span><br><span class="line">	<span class="string">//</span> 			videoInfoMapper.updateCountInfo<span class="params">(bean.getVideoId()</span>, actionTypeEnum.getField<span class="params">()</span>, bean.getActionCount<span class="params">()</span>);</span><br><span class="line">	<span class="string">//</span> 			break;</span><br><span class="line">    <span class="string">//</span>         <span class="string">//</span> è¯„è®ºç±»è¡Œä¸ºï¼šç‚¹èµ / è®¨åŒ</span><br><span class="line">    <span class="string">//</span>         case COMMENT_LIKE:</span><br><span class="line">    <span class="string">//</span>         case COMMENT_HATE:</span><br><span class="line">    <span class="string">//</span>             <span class="string">//</span> 1) è®¡ç®—â€œå¯¹ç«‹è¡Œä¸ºç±»å‹â€ï¼ˆç‚¹èµ çš„å¯¹ç«‹æ˜¯ è®¨åŒï¼›è®¨åŒ çš„å¯¹ç«‹æ˜¯ ç‚¹èµï¼‰</span><br><span class="line">    <span class="string">//</span>             UserActionTypeEnum opposeTypeEnum =</span><br><span class="line">    <span class="string">//</span>                     <span class="params">(<span class="attr">actionTypeEnum</span> == UserActionTypeEnum.COMMENT_LIKE)</span></span><br><span class="line">    <span class="string">//</span>                             ? UserActionTypeEnum.COMMENT_HATE</span><br><span class="line">    <span class="string">//</span>                             : UserActionTypeEnum.COMMENT_LIKE;</span><br><span class="line"></span><br><span class="line">    <span class="string">//</span>             <span class="string">//</span> 2) æŸ¥å‡ºâ€œå¯¹ç«‹è¡Œä¸ºâ€æ˜¯å¦å­˜åœ¨ï¼ˆåŒä¸€ç”¨æˆ·ã€åŒä¸€è§†é¢‘ã€åŒä¸€è¯„è®ºï¼‰</span><br><span class="line">    <span class="string">//</span>             UserAction opposeAction = userActionMapper</span><br><span class="line">    <span class="string">//</span>                     <span class="string">.selectByVideoIdAndCommentIdAndActionTypeAndUserId</span><span class="params">(</span></span><br><span class="line"><span class="params">    //                             bean.getVideoId()</span>,            <span class="string">//</span> è§†é¢‘</span><br><span class="line">    <span class="string">//</span>                             bean.getCommentId<span class="params">()</span>,          <span class="string">//</span> è¯„è®º</span><br><span class="line">    <span class="string">//</span>                             opposeTypeEnum.getType<span class="params">()</span>,     <span class="string">//</span> å¯¹ç«‹åŠ¨ä½œç±»å‹</span><br><span class="line">    <span class="string">//</span>                             bean.getUserId<span class="params">()</span>);            <span class="string">//</span> å½“å‰ç”¨æˆ·</span><br><span class="line"></span><br><span class="line">    <span class="string">//</span>             <span class="string">//</span> å¦‚æœâ€œå¯¹ç«‹è¡Œä¸ºâ€å­˜åœ¨ï¼Œå…ˆåˆ æ‰å®ƒï¼ˆä¿æŒäº’æ–¥ï¼‰</span><br><span class="line">    <span class="string">//</span>             <span class="keyword">if</span> <span class="params">(opposeAction != null)</span> &#123;</span><br><span class="line">    <span class="string">//</span>                 userActionMapper.deleteByActionId<span class="params">(opposeAction.getActionId()</span>);</span><br><span class="line">    <span class="string">//</span>             &#125;</span><br><span class="line"></span><br><span class="line">    <span class="string">//</span>             <span class="string">//</span> 3) æŸ¥è¯¢â€œæœ¬æ¬¡åŠ¨ä½œâ€æ˜¯å¦å·²å­˜åœ¨ï¼ˆç”¨äºâ€œäºŒæ¬¡ç‚¹å‡»å–æ¶ˆâ€ï¼‰</span><br><span class="line">    <span class="string">//</span>              dbAction = userActionMapper</span><br><span class="line">    <span class="string">//</span>                     <span class="string">.selectByVideoIdAndCommentIdAndActionTypeAndUserId</span><span class="params">(</span></span><br><span class="line"><span class="params">    //                             bean.getVideoId()</span>,</span><br><span class="line">    <span class="string">//</span>                             bean.getCommentId<span class="params">()</span>,</span><br><span class="line">    <span class="string">//</span>                             actionTypeEnum.getType<span class="params">()</span>,     <span class="string">//</span> æœ¬æ¬¡åŠ¨ä½œç±»å‹</span><br><span class="line">    <span class="string">//</span>                             bean.getUserId<span class="params">()</span>);</span><br><span class="line"></span><br><span class="line">    <span class="string">//</span>             <span class="keyword">if</span> <span class="params">(dbAction != null)</span> &#123;</span><br><span class="line">    <span class="string">//</span>                 <span class="string">//</span> å·²ç‚¹è¿‡åŒä¸€åŠ¨ä½œ -&gt; æœ¬æ¬¡æ“ä½œç­‰äºâ€œå–æ¶ˆâ€è¯¥åŠ¨ä½œ</span><br><span class="line">    <span class="string">//</span>                 userActionMapper.deleteByActionId<span class="params">(dbAction.getActionId()</span>);</span><br><span class="line">    <span class="string">//</span>             &#125; else &#123;</span><br><span class="line">    <span class="string">//</span>                 <span class="string">//</span> é¦–æ¬¡ç‚¹å‡»è¯¥åŠ¨ä½œ -&gt; æ’å…¥è¡Œä¸ºè®°å½•</span><br><span class="line">    <span class="string">//</span>                 userActionMapper.insert<span class="params">(bean)</span>;</span><br><span class="line">    <span class="string">//</span>             &#125;</span><br><span class="line"></span><br><span class="line">    <span class="string">//</span>             <span class="string">//</span> 4) è®¡ç®—è®¡æ•°å˜åŒ–é‡ï¼š</span><br><span class="line">    <span class="string">//</span>             <span class="string">//</span>    - å¦‚æœæ˜¯â€œé¦–æ¬¡ç‚¹å‡»â€ï¼šæœ¬åŠ¨ä½œ +1ï¼›</span><br><span class="line">    <span class="string">//</span>             <span class="string">//</span>    - å¦‚æœæ˜¯â€œå–æ¶ˆç‚¹å‡»â€ï¼šæœ¬åŠ¨ä½œ -1ï¼›</span><br><span class="line">    <span class="string">//</span>              changeCount = <span class="params">(<span class="attr">dbAction</span> == null)</span> ? 1 : -1;</span><br><span class="line"></span><br><span class="line">    <span class="string">//</span>             <span class="string">//</span>    - è‹¥å­˜åœ¨â€œå¯¹ç«‹è¡Œä¸ºâ€ï¼Œæ„å‘³ç€è¿™æ¬¡ä»å¯¹ç«‹åŠ¨ä½œåˆ‡æ¢è¿‡æ¥ï¼Œ</span><br><span class="line">    <span class="string">//</span>             <span class="string">//</span>      éœ€è¦æŠŠâ€œå¯¹ç«‹åŠ¨ä½œè®¡æ•°â€åšä¸€ä¸ªç›¸åçš„å˜æ›´ï¼ˆ+1 çš„åå‘æ˜¯ -1ï¼‰</span><br><span class="line">    <span class="string">//</span>             Integer opposeChangeCount = changeCount * -1;</span><br><span class="line"></span><br><span class="line">    <span class="string">//</span>             <span class="string">//</span> 5) ä¸€æ¬¡ SQL åŒæ­¥æ›´æ–°è¯„è®ºä¸Šçš„ä¸¤ä¸ªè®¡æ•°å­—æ®µï¼ˆæœ¬åŠ¨ä½œå­—æ®µ + å¯¹ç«‹å­—æ®µï¼‰</span><br><span class="line">    <span class="string">//</span>             videoCommentMapper.updateCountInfo<span class="params">(</span></span><br><span class="line"><span class="params">    //                     bean.getCommentId()</span>,             <span class="string">//</span> å“ªæ¡è¯„è®º</span><br><span class="line">    <span class="string">//</span>                     actionTypeEnum.getField<span class="params">()</span>,       <span class="string">//</span> æœ¬åŠ¨ä½œå¯¹åº”çš„è®¡æ•°å­—æ®µåï¼ˆlike_count / hate_countï¼‰</span><br><span class="line">    <span class="string">//</span>                     changeCount,                     <span class="string">//</span> æœ¬åŠ¨ä½œå˜æ›´é‡</span><br><span class="line">    <span class="string">//</span>                     <span class="params">(<span class="attr">opposeAction</span> == null)</span> ? null :  <span class="string">//</span> å¯¹ç«‹å­—æ®µï¼šåªæœ‰å½“â€œå¯¹ç«‹è¡Œä¸ºå­˜åœ¨â€æ—¶æ‰éœ€è¦å›æ»š</span><br><span class="line">    <span class="string">//</span>                             opposeTypeEnum.getField<span class="params">()</span>,</span><br><span class="line">    <span class="string">//</span>                     opposeChangeCount);              <span class="string">//</span> å¯¹ç«‹å­—æ®µçš„åå‘å˜æ›´é‡</span><br><span class="line">    <span class="string">//</span>             break;</span><br><span class="line"></span><br><span class="line">    <span class="string">//</span>     &#125;</span><br><span class="line">    <span class="string">//</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="string">//</span>å¾®æœåŠ¡ç‰ˆæœ¬ä¸­</span><br><span class="line">@Override</span><br><span class="line">@GlobalTransactional<span class="params">(<span class="attr">rollbackFor</span> = Exception.class)</span></span><br><span class="line">public void saveAction<span class="params">(UserAction bean)</span> &#123;</span><br><span class="line">    <span class="string">//</span> 1) æ ¡éªŒè§†é¢‘å­˜åœ¨ï¼ˆå‘ Web æŸ¥ï¼‰</span><br><span class="line">    VideoInfo videoInfo = videoClient.getVideoInfoByVideoId<span class="params">(bean.getVideoId()</span>);</span><br><span class="line">    <span class="keyword">if</span> <span class="params">(<span class="attr">videoInfo</span> == null)</span> throw new BusinessException<span class="params">(ResponseCodeEnum.CODE_600)</span>;</span><br><span class="line">    bean.<span class="keyword">set</span>VideoUserId<span class="params">(videoInfo.getUserId()</span>);</span><br><span class="line"></span><br><span class="line">    UserActionTypeEnum type = UserActionTypeEnum.getByType<span class="params">(bean.getActionType()</span>);</span><br><span class="line">    UserAction dbAction = userActionMapper.selectByVideoIdAndCommentIdAndActionTypeAndUserId<span class="params">(</span></span><br><span class="line"><span class="params">            bean.getVideoId()</span>, bean.getCommentId<span class="params">()</span>, bean.getActionType<span class="params">()</span>, bean.getUserId<span class="params">()</span>);</span><br><span class="line">    bean.<span class="keyword">set</span>ActionTime<span class="params">(new Date()</span>);</span><br><span class="line"></span><br><span class="line">    switch <span class="params">(type)</span> &#123;</span><br><span class="line">        <span class="string">//</span> ç‚¹èµ/æ”¶è—ï¼šäºŒæ¬¡ç‚¹å‡»å–æ¶ˆï¼Œå˜æ›´é‡ Â±1ï¼›æ›´æ–°è§†é¢‘è®¡æ•°åœ¨ Web</span><br><span class="line">        case VIDEO_LIKE:</span><br><span class="line">        case VIDEO_COLLECT:</span><br><span class="line">            <span class="keyword">if</span> <span class="params">(dbAction != null)</span> userActionMapper.deleteByActionId<span class="params">(dbAction.getActionId()</span>);</span><br><span class="line">            else userActionMapper.insert<span class="params">(bean)</span>;</span><br><span class="line">            int delta = <span class="params">(<span class="attr">dbAction</span> == null)</span> ? 1 : -1;</span><br><span class="line">            videoClient.updateCountInfo<span class="params">(bean.getVideoId()</span>, type.getField<span class="params">()</span>, delta);</span><br><span class="line">            <span class="keyword">if</span> <span class="params">(<span class="attr">type</span> == UserActionTypeEnum.VIDEO_LIKE)</span> &#123;</span><br><span class="line">                <span class="string">//</span> ç¤ºä¾‹ä¸­æŠŠ ES æ”¶è—æ•°é‡ä¹Ÿæ”¾è¿™é‡Œæ”¹ï¼ˆæŒ‰ä½ æ–‡æ¡£ï¼‰</span><br><span class="line">                videoClient.updateDocCount<span class="params">(videoInfo.getVideoId()</span>, SearchOrderTypeEnum.VIDEO_COLLECT, delta);</span><br><span class="line">            &#125;</span><br><span class="line">            break;</span><br><span class="line"></span><br><span class="line">        <span class="string">//</span> è¯„è®ºç‚¹èµ/è®¨åŒï¼šäº’æ–¥ï¼›åŒæ—¶æ›´æ–°å¯¹ç«‹è®¡æ•°</span><br><span class="line">        case COMMENT_LIKE:</span><br><span class="line">        case COMMENT_HATE:</span><br><span class="line">            UserActionTypeEnum oppose = <span class="params">(<span class="attr">type</span> == UserActionTypeEnum.COMMENT_LIKE)</span></span><br><span class="line">                                        ? UserActionTypeEnum.COMMENT_HATE</span><br><span class="line">                                        : UserActionTypeEnum.COMMENT_LIKE;</span><br><span class="line">            UserAction opposeAction = userActionMapper.selectByVideoIdAndCommentIdAndActionTypeAndUserId<span class="params">(</span></span><br><span class="line"><span class="params">                    bean.getVideoId()</span>, bean.getCommentId<span class="params">()</span>, oppose.getType<span class="params">()</span>, bean.getUserId<span class="params">()</span>);</span><br><span class="line">            <span class="keyword">if</span> <span class="params">(opposeAction != null)</span> userActionMapper.deleteByActionId<span class="params">(opposeAction.getActionId()</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="params">(dbAction != null)</span> userActionMapper.deleteByActionId<span class="params">(dbAction.getActionId()</span>);</span><br><span class="line">            else userActionMapper.insert<span class="params">(bean)</span>;</span><br><span class="line"></span><br><span class="line">            delta = <span class="params">(<span class="attr">dbAction</span> == null)</span> ? 1 : -1;</span><br><span class="line">            Integer opposeDelta = delta * -1;</span><br><span class="line">            videoCommentMapper.updateCountInfo<span class="params">(</span></span><br><span class="line"><span class="params">                    bean.getCommentId()</span>, bean.getUserId<span class="params">()</span>,</span><br><span class="line">                    type.getField<span class="params">()</span>, delta,</span><br><span class="line">                    <span class="params">(<span class="attr">opposeAction</span> == null)</span> ? null : oppose.getField<span class="params">()</span>, opposeDelta);</span><br><span class="line">            break;</span><br><span class="line"></span><br><span class="line">        <span class="string">//</span> æŠ•å¸ï¼šæ‰£è‡ªå·± + åŠ  UP ä¸»ï¼›éƒ½ç”± Web çš„ç”¨æˆ·é¢†åŸŸæ¥æ‰§è¡Œï¼›å¹¶æ›´æ–°è§†é¢‘æŠ•å¸è®¡æ•°</span><br><span class="line">        case VIDEO_COIN:</span><br><span class="line">            <span class="keyword">if</span> <span class="params">(bean.getActionCount()</span> != 1 &amp;&amp; bean.getActionCount<span class="params">()</span> != 2)</span><br><span class="line">                throw new BusinessException<span class="params">(ResponseCodeEnum.CODE_600)</span>;</span><br><span class="line">            <span class="keyword">if</span> <span class="params">(videoInfo.getUserId()</span><span class="string">.equals</span><span class="params">(bean.getUserId()</span>))</span><br><span class="line">                throw new BusinessException<span class="params">(&quot;UPä¸»ä¸èƒ½ç»™è‡ªå·±æŠ•å¸&quot;)</span>;</span><br><span class="line">            <span class="keyword">if</span> <span class="params">(dbAction != null)</span> throw new BusinessException<span class="params">(&quot;å¯¹æœ¬ç¨¿ä»¶çš„æŠ•å¸æšæ•°å·²ç”¨å®Œ&quot;)</span>;</span><br><span class="line"></span><br><span class="line">            <span class="string">//</span> æ‰£è‡ªå·±</span><br><span class="line">            Integer r1 = videoClient.updateCoinCountInfo<span class="params">(bean.getUserId()</span>, -bean.getActionCount<span class="params">()</span>);</span><br><span class="line">            <span class="keyword">if</span> <span class="params">(<span class="attr">r1</span> == 0)</span> throw new BusinessException<span class="params">(&quot;å¸ä¸å¤Ÿ&quot;)</span>;</span><br><span class="line">            <span class="string">//</span> ç»™ UP ä¸»åŠ </span><br><span class="line">            Integer r2 = videoClient.updateCoinCountInfo<span class="params">(videoInfo.getUserId()</span>, bean.getActionCount<span class="params">()</span>);</span><br><span class="line">            <span class="keyword">if</span> <span class="params">(<span class="attr">r2</span> == 0)</span> throw new BusinessException<span class="params">(&quot;æŠ•å¸å¤±è´¥&quot;)</span>;</span><br><span class="line"></span><br><span class="line">            userActionMapper.insert<span class="params">(bean)</span>;</span><br><span class="line">            videoClient.updateCountInfo<span class="params">(bean.getVideoId()</span>, type.getField<span class="params">()</span>, bean.getActionCount<span class="params">()</span>);</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯¹æ¯”å•ä½“ï¼šåŸæ¥è¿™äº›â€œæ‰£/åŠ ç¡¬å¸ã€æ”¹è§†é¢‘è®¡æ•°ã€æ”¹ ESâ€éƒ½åœ¨åŒæœåŠ¡å†…ç›´æ¥æ“ä½œ â€”â€” ç°åœ¨æ”¹ä¸º<strong>è¿œç¨‹è°ƒç”¨ Web</strong> æ¥æ‰§è¡Œï¼ŒInteract åªä¿ç•™â€œè¡Œä¸ºäº‹å®â€ã€‚</p>
<p>åœºæ™¯äºŒï¼šè¯„è®ºï¼ˆVideoCommentServiceImplï¼‰</p>
<p>VideoCommentServiceImplå°†åŸæœ¬videoInfoMapperè°ƒç”¨çš„æ–¹æ³•æ”¹ä¸ºvideoClientè°ƒç”¨çš„</p>
<ul>
<li>å‘è¡¨/åˆ é™¤/ç½®é¡¶è¯„è®ºæ—¶ï¼Œæ¶‰åŠâ€œæ ¡éªŒè§†é¢‘çŠ¶æ€ï¼ˆæ˜¯å¦å…³é—­è¯„è®ºï¼‰â€â€œå˜æ›´è§†é¢‘è¯„è®ºæ•°ï¼ˆä¸€çº§è¯„è®ºÂ±1ï¼‰â€ï¼Œéƒ½é€šè¿‡ <strong>VideoClient</strong> è®¿é—® Webï¼›</li>
<li>è¯„è®ºå®ä½“çš„å¢åˆ æ”¹ä»åœ¨ Interact è‡ªå·±çš„åº“é‡Œå®Œæˆã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">   <span class="meta">@Resource</span></span><br><span class="line">   <span class="keyword">private</span> VideoClient videoClient;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="meta">@GlobalTransactional(rollbackFor = Exception.class)</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postComment</span><span class="params">(VideoComment comment, Integer replyCommentId)</span> &#123;</span><br><span class="line"></span><br><span class="line">       <span class="type">VideoInfo</span> <span class="variable">videoInfo</span> <span class="operator">=</span> videoClient.getVideoInfoByVideoId(comment.getVideoId());</span><br><span class="line">       <span class="keyword">if</span> (videoInfo == <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ResponseCodeEnum.CODE_600);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//æ˜¯å¦å…³é—­è¯„è®º</span></span><br><span class="line">       <span class="keyword">if</span> (videoInfo.getInteraction() != <span class="literal">null</span> &amp;&amp; videoInfo.getInteraction().contains(Constants.ZERO.toString())) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;UPä¸»å·²å…³é—­è¯„è®ºåŒº&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (replyCommentId != <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="type">VideoComment</span> <span class="variable">replyComment</span> <span class="operator">=</span> getVideoCommentByCommentId(replyCommentId);</span><br><span class="line">           <span class="keyword">if</span> (replyComment == <span class="literal">null</span> || !replyComment.getVideoId().equals(comment.getVideoId())) &#123;</span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ResponseCodeEnum.CODE_600);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span> (replyComment.getpCommentId() == <span class="number">0</span>) &#123;</span><br><span class="line">               comment.setpCommentId(replyComment.getCommentId());</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               comment.setpCommentId(replyComment.getpCommentId());</span><br><span class="line">               comment.setReplyUserId(replyComment.getUserId());</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="type">UserInfo</span> <span class="variable">userInfo</span> <span class="operator">=</span> videoClient.getUserInfoByUserId(replyComment.getUserId());</span><br><span class="line">           comment.setReplyNickName(userInfo.getNickName());</span><br><span class="line">           comment.setReplyAvatar(userInfo.getAvatar());</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           comment.setpCommentId(<span class="number">0</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       comment.setPostTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">       comment.setVideoUserId(videoInfo.getUserId());</span><br><span class="line">       <span class="built_in">this</span>.videoCommentMapper.insert(comment);</span><br><span class="line">       <span class="comment">//å¢åŠ è¯„è®ºæ•°</span></span><br><span class="line">       <span class="keyword">if</span> (comment.getpCommentId() == <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="built_in">this</span>.videoClient.updateCountInfo(comment.getVideoId(), UserActionTypeEnum.VIDEO_COMMENT.getField(), <span class="number">1</span>);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteComment</span><span class="params">(String userId, Integer commentId)</span> &#123;</span><br><span class="line">       <span class="type">VideoComment</span> <span class="variable">comment</span> <span class="operator">=</span> videoCommentMapper.selectByCommentId(commentId);</span><br><span class="line">       <span class="keyword">if</span> (<span class="literal">null</span> == comment) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ResponseCodeEnum.CODE_600);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="type">VideoInfo</span> <span class="variable">videoInfo</span> <span class="operator">=</span> videoClient.getVideoInfoByVideoId(comment.getVideoId());</span><br><span class="line">       <span class="keyword">if</span> (<span class="literal">null</span> == videoInfo) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ResponseCodeEnum.CODE_600);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (userId != <span class="literal">null</span> &amp;&amp; !videoInfo.getUserId().equals(userId) &amp;&amp; !comment.getUserId().equals(userId)) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ResponseCodeEnum.CODE_600);</span><br><span class="line">       &#125;</span><br><span class="line">       videoCommentMapper.deleteByCommentId(commentId);</span><br><span class="line">       <span class="keyword">if</span> (comment.getpCommentId() == <span class="number">0</span>) &#123;</span><br><span class="line">           videoClient.updateCountInfo(videoInfo.getVideoId(), UserActionTypeEnum.VIDEO_COMMENT.getField(), -<span class="number">1</span>);</span><br><span class="line">           <span class="comment">//åˆ é™¤äºŒçº§è¯„è®º</span></span><br><span class="line">           <span class="type">VideoCommentQuery</span> <span class="variable">videoCommentQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VideoCommentQuery</span>();</span><br><span class="line">           videoCommentQuery.setpCommentId(commentId);</span><br><span class="line">           videoCommentMapper.deleteByParam(videoCommentQuery);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="meta">@GlobalTransactional(rollbackFor = Exception.class)</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">topComment</span><span class="params">(Integer commentId, String userId)</span> &#123;</span><br><span class="line">       <span class="comment">//ç°æ¸…é™¤ä¹‹å‰çš„æŒ‡å®š</span></span><br><span class="line">       <span class="built_in">this</span>.cancelTopComment(commentId, userId);</span><br><span class="line"></span><br><span class="line">       <span class="type">VideoComment</span> <span class="variable">videoComment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VideoComment</span>();</span><br><span class="line">       videoComment.setTopType(CommentTopTypeEnum.TOP.getType());</span><br><span class="line">       videoCommentMapper.updateByCommentId(videoComment, commentId);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cancelTopComment</span><span class="params">(Integer commentId, String userId)</span> &#123;</span><br><span class="line">       <span class="type">VideoComment</span> <span class="variable">dbVideoComment</span> <span class="operator">=</span> videoCommentMapper.selectByCommentId(commentId);</span><br><span class="line">       <span class="keyword">if</span> (dbVideoComment == <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ResponseCodeEnum.CODE_600);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="type">VideoInfo</span> <span class="variable">videoInfo</span> <span class="operator">=</span> videoClient.getVideoInfoByVideoId(dbVideoComment.getVideoId());</span><br><span class="line">       <span class="keyword">if</span> (videoInfo == <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ResponseCodeEnum.CODE_600);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (!videoInfo.getUserId().equals(userId)) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ResponseCodeEnum.CODE_600);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="type">VideoComment</span> <span class="variable">videoComment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VideoComment</span>();</span><br><span class="line">       videoComment.setTopType(CommentTopTypeEnum.NO_TOP.getType());</span><br><span class="line"></span><br><span class="line">       <span class="type">VideoCommentQuery</span> <span class="variable">videoCommentQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VideoCommentQuery</span>();</span><br><span class="line">       videoCommentQuery.setVideoId(dbVideoComment.getVideoId());</span><br><span class="line">       videoCommentQuery.setTopType(CommentTopTypeEnum.TOP.getType());</span><br><span class="line">       videoCommentMapper.updateByParam(videoComment, videoCommentQuery);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1372.png" alt="img"></p>
<p>åœºæ™¯ä¸‰ç«™å†…æ¶ˆæ¯ï¼ˆUserMessageServiceImplï¼‰</p>
<p>UserMessageServiceImplå°†åŸæœ¬videoInfoMapperè°ƒç”¨çš„æ–¹æ³•æ”¹ä¸ºvideoClientè°ƒç”¨çš„</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"> <span class="keyword">private</span> VideoClient videoClient;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line"> <span class="meta">@Async</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveUserMessage</span><span class="params">(String videoId, String sendUserId, MessageTypeEnum messageTypeEnum, String content, Integer replyCommentId)</span> &#123;</span><br><span class="line"></span><br><span class="line">     <span class="type">VideoInfo</span> <span class="variable">videoInfo</span> <span class="operator">=</span> <span class="built_in">this</span>.videoClient.getVideoInfoByVideoId(videoId);</span><br><span class="line">     <span class="keyword">if</span> (videoInfo == <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="type">UserMessageExtendDto</span> <span class="variable">extendDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserMessageExtendDto</span>();</span><br><span class="line">     extendDto.setMessageContent(content);</span><br><span class="line"></span><br><span class="line">     <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> videoInfo.getUserId();</span><br><span class="line"></span><br><span class="line">     <span class="comment">//æ”¶è—ï¼Œç‚¹èµ å·²ç»è®°å½•è¿‡æ¶ˆæ¯ï¼Œä¸åœ¨è®°å½•</span></span><br><span class="line">     <span class="keyword">if</span> (ArrayUtils.contains(<span class="keyword">new</span> <span class="title class_">Integer</span>[]&#123;MessageTypeEnum.LIKE.getType(), MessageTypeEnum.COLLECTION.getType()&#125;, messageTypeEnum.getType())) &#123;</span><br><span class="line">         <span class="type">UserMessageQuery</span> <span class="variable">userMessageQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserMessageQuery</span>();</span><br><span class="line">         userMessageQuery.setSendUserId(sendUserId);</span><br><span class="line">         userMessageQuery.setVideoId(videoId);</span><br><span class="line">         userMessageQuery.setMessageType(messageTypeEnum.getType());</span><br><span class="line">         <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> userMessageMapper.selectCount(userMessageQuery);</span><br><span class="line">         <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">             <span class="keyword">return</span>;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="type">UserMessage</span> <span class="variable">userMessage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserMessage</span>();</span><br><span class="line">     userMessage.setUserId(userId);</span><br><span class="line">     userMessage.setVideoId(videoId);</span><br><span class="line">     userMessage.setReadType(MessageReadTypeEnum.NO_READ.getType());</span><br><span class="line">     userMessage.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">     userMessage.setMessageType(messageTypeEnum.getType());</span><br><span class="line">     userMessage.setSendUserId(sendUserId);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//è¯„è®ºç‰¹æ®Šå¤„ç†</span></span><br><span class="line">     <span class="keyword">if</span> (replyCommentId != <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="type">VideoComment</span> <span class="variable">commentInfo</span> <span class="operator">=</span> videoCommentMapper.selectByCommentId(replyCommentId);</span><br><span class="line">         <span class="keyword">if</span> (<span class="literal">null</span> != commentInfo) &#123;</span><br><span class="line">             userId = commentInfo.getUserId();</span><br><span class="line">             extendDto.setMessageContentReply(commentInfo.getContent());</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">if</span> (userId.equals(sendUserId)) &#123;</span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">//ç³»ç»Ÿæ¶ˆæ¯ç‰¹æ®Šå¤„ç†</span></span><br><span class="line">     <span class="keyword">if</span> (MessageTypeEnum.SYS == messageTypeEnum) &#123;</span><br><span class="line">         <span class="type">VideoInfoPost</span> <span class="variable">videoInfoPost</span> <span class="operator">=</span> videoClient.getVideoInfoPostByVideoId(videoId);</span><br><span class="line">         extendDto.setAuditStatus(videoInfoPost.getStatus());</span><br><span class="line">     &#125;</span><br><span class="line">     userMessage.setUserId(userId);</span><br><span class="line">     userMessage.setExtendJson(JsonUtils.convertObj2Json(extendDto));</span><br><span class="line">     <span class="built_in">this</span>.userMessageMapper.insert(userMessage);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ‹¿â€œè§†é¢‘ä½œè€…æ˜¯è°â€â€œç³»ç»Ÿå®¡æ ¸çŠ¶æ€â€ç­‰ä¿¡æ¯ï¼šä¸€å¾‹<strong>ä» Web æŸ¥</strong>ï¼ˆVideoInfo / VideoInfoPostï¼‰ã€‚æ”¶è—/ç‚¹èµæ¶ˆæ¯åš<strong>å¹‚ç­‰å»é‡</strong></p>
<p>åœºæ™¯å››ï¼šå¼¹å¹•ï¼ˆVideoDanmuServiceImplï¼‰</p>
<p>VideoDanmuServiceImplå°†åŸæœ¬videoInfoMapperè°ƒç”¨çš„æ–¹æ³•æ”¹ä¸ºvideoClientè°ƒç”¨çš„</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1373.png" alt="img"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line">  <span class="keyword">private</span> VideoClient videoClient;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">  <span class="meta">@GlobalTransactional(rollbackFor = Exception.class)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveVideoDanmu</span><span class="params">(VideoDanmu bean)</span> &#123;</span><br><span class="line">      <span class="type">VideoInfo</span> <span class="variable">videoInfo</span> <span class="operator">=</span> videoClient.getVideoInfoByVideoId(bean.getVideoId());</span><br><span class="line">      <span class="keyword">if</span> (videoInfo == <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ResponseCodeEnum.CODE_600);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//æ˜¯å¦å…³é—­å¼¹å¹•</span></span><br><span class="line">      <span class="keyword">if</span> (videoInfo.getInteraction() != <span class="literal">null</span> &amp;&amp; videoInfo.getInteraction().contains(Constants.ONE.toString())) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;UPä¸»å·²å…³é—­å¼¹å¹•&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">this</span>.videoDanmuMapper.insert(bean);</span><br><span class="line">      <span class="built_in">this</span>.videoClient.updateCountInfo(bean.getVideoId(), UserActionTypeEnum.VIDEO_DANMU.getField(), <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//æ›´æ–°eså¼¹å¹•æ•°é‡</span></span><br><span class="line">      videoClient.updateDocCount(bean.getVideoId(), SearchOrderTypeEnum.VIDEO_DANMU, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteDanmu</span><span class="params">(String userId, Integer danmuId)</span> &#123;</span><br><span class="line">      <span class="type">VideoDanmu</span> <span class="variable">danmu</span> <span class="operator">=</span> videoDanmuMapper.selectByDanmuId(danmuId);</span><br><span class="line">      <span class="keyword">if</span> (<span class="literal">null</span> == danmu) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ResponseCodeEnum.CODE_600);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">VideoInfo</span> <span class="variable">videoInfo</span> <span class="operator">=</span> videoClient.getVideoInfoByVideoId(danmu.getVideoId());</span><br><span class="line">      <span class="keyword">if</span> (<span class="literal">null</span> == videoInfo) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ResponseCodeEnum.CODE_600);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (userId != <span class="literal">null</span> &amp;&amp; !videoInfo.getUserId().equals(userId)) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ResponseCodeEnum.CODE_600);</span><br><span class="line">      &#125;</span><br><span class="line">      videoDanmuMapper.deleteByDanmuId(danmuId);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>2.åœ¨webæ¨¡å—ä¸‹-api-provider</p>
<p>UserInfoApi</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Resource</span></span><br><span class="line">   private UserInfoService userInfoService;</span><br><span class="line"></span><br><span class="line">   <span class="variable">@RequestMapping</span>(<span class="string">&quot;/updateCoinCountInfo&quot;</span>)</span><br><span class="line">   public Integer <span class="built_in">updateCoinCountInfo</span>(<span class="variable">@NotEmpty</span> String userId, <span class="variable">@NotNull</span> Integer count) &#123;</span><br><span class="line">       <span class="selector-tag">return</span> <span class="selector-tag">userInfoService</span><span class="selector-class">.updateCoinCountInfo</span>(userId, count);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   @<span class="selector-tag">RequestMapping</span>(<span class="string">&quot;/getUserInfoByUserId&quot;</span>)</span><br><span class="line">   <span class="selector-tag">public</span> <span class="selector-tag">UserInfo</span> <span class="selector-tag">getUserInfoByUserId</span>(<span class="variable">@NotEmpty</span> String userId) &#123;</span><br><span class="line">       <span class="selector-tag">return</span> <span class="selector-tag">userInfoService</span><span class="selector-class">.getUserInfoByUserId</span>(userId);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>VideoInfoApi</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Resource</span></span><br><span class="line">    private VideoInfoService videoInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@Resource</span></span><br><span class="line">    private VideoInfoPostService videoInfoPostService;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@Resource</span></span><br><span class="line">    private VideoInfoFileService videoInfoFileService;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@Resource</span></span><br><span class="line">    private VideoInfoFilePostService videoInfoFilePostService;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@Resource</span></span><br><span class="line">    private EsSearchComponent esSearchComponent;</span><br><span class="line"><span class="variable">@RequestMapping</span>(<span class="string">&quot;/getVideoInfoByVideoId&quot;</span>)</span><br><span class="line">    public VideoInfo <span class="built_in">getVideoInfo</span>(<span class="variable">@NotEmpty</span> String videoId) &#123;</span><br><span class="line">        <span class="selector-tag">return</span> <span class="selector-tag">videoInfoService</span><span class="selector-class">.getVideoInfoByVideoId</span>(videoId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="selector-tag">RequestMapping</span>(<span class="string">&quot;/getVideoInfoPostByVideoId&quot;</span>)</span><br><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">VideoInfoPost</span> <span class="selector-tag">getVideoInfoPost</span>(<span class="variable">@NotEmpty</span> String videoId) &#123;</span><br><span class="line">        <span class="selector-tag">return</span> <span class="selector-tag">videoInfoPostService</span><span class="selector-class">.getVideoInfoPostByVideoId</span>(videoId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="selector-tag">RequestMapping</span>(<span class="string">&quot;/updateCountInfo&quot;</span>)</span><br><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">void</span> <span class="selector-tag">updateCountInfo</span>(<span class="variable">@NotEmpty</span> String videoId, <span class="variable">@NotEmpty</span> String field, <span class="variable">@NotNull</span> Integer changeCount) &#123;</span><br><span class="line">        <span class="selector-tag">videoInfoService</span><span class="selector-class">.updateCountInfo</span>(videoId, field, changeCount);</span><br><span class="line">    &#125;</span><br><span class="line">      @<span class="selector-tag">RequestMapping</span>(<span class="string">&quot;/updateDocCount&quot;</span>)</span><br><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">void</span> <span class="selector-tag">updateDocCount</span>(String videoId, SearchOrderTypeEnum searchOrderTypeEnum, Integer changeCOunt) &#123;</span><br><span class="line">        <span class="selector-tag">esSearchComponent</span><span class="selector-class">.updateDocCount</span>(videoId, searchOrderTypeEnum.<span class="built_in">getField</span>(), changeCOunt);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1374.png" alt="img"></p>
<h3 id="å°ç»“-2">å°ç»“</h3>
<p>è¿™æ¬¡æ‹†åˆ†çš„æ ¸å¿ƒæ˜¯<strong>è®©æ‹¥æœ‰æ•°æ®çš„æœåŠ¡æš´éœ²å†…éƒ¨æ¥å£ï¼Œè¡Œä¸ºæœåŠ¡åªåšç¼–æ’</strong>ï¼š</p>
<ul>
<li>Interact è‡ªå·±åªæŒæœ‰â€œè¡Œä¸ºäº‹å®åº“â€ï¼ˆaction/comment/danmu/messageï¼‰ï¼Œ</li>
<li>ä»»ä½•â€œç”¨æˆ·/è§†é¢‘ä¾§çš„çŠ¶æ€å˜æ›´â€éƒ½è®© Web å»åšï¼›</li>
<li>é€šè¿‡ Feign + Seata æŠŠä¸€æ¬¡ç”¨æˆ·è¡Œä¸ºå˜æˆâ€œè·¨æœåŠ¡çš„ä¸€è‡´åŠ¨ä½œâ€ã€‚<br>
è¿™å°±æ˜¯ä»å•ä½“åˆ°å¾®æœåŠ¡åœ¨äº’åŠ¨åŸŸçš„æ ‡å‡†è½åœ°è·¯å¾„</li>
</ul>
<h2 id="9-interactæ¨¡å—äº’åŠ¨æœåŠ¡-è¯„è®ºã€å¼¹å¹•">9.interactæ¨¡å—äº’åŠ¨æœåŠ¡-è¯„è®ºã€å¼¹å¹•</h2>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1375.png" alt="img"></p>
<p>æŠŠä¸ŠæŠ¥åœ¨çº¿äººæ•°å•ç‹¬æŠ½å–åˆ°interactæ¨¡å—ä¸‹çš„OnlineController</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"> <span class="keyword">private</span> <span class="title class_">RedisComponent</span> redisComponent;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@RequestMapping</span>(<span class="string">&quot;/reportVideoPlayOnline&quot;</span>)</span><br><span class="line"> <span class="meta">@GlobalInterceptor</span></span><br><span class="line"> <span class="keyword">public</span> <span class="title class_">ResponseVO</span> <span class="title function_">reportVideoPlayOnline</span>(<span class="params"><span class="meta">@NotEmpty</span> <span class="title class_">String</span> fileId, <span class="title class_">String</span> deviceId</span>) &#123;</span><br><span class="line">     <span class="title class_">Integer</span> count = redisComponent.<span class="title function_">reportVideoPlayOnline</span>(fileId, deviceId);</span><br><span class="line">     <span class="keyword">return</span> <span class="title function_">getSuccessResponseVO</span>(count);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1377.png" alt="img"></p>
<p>videoCommentControllerä¸­å°†åŸæœ¬videoInfoServiceè°ƒç”¨çš„æ–¹æ³•æ”¹ä¸ºvideoClientè°ƒç”¨çš„</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> VideoClient videoClient; <span class="comment">// &lt;&lt; åŸæ¥æ˜¯ videoInfoService</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/loadComment&quot;)</span></span><br><span class="line"><span class="meta">@GlobalInterceptor</span></span><br><span class="line"><span class="keyword">public</span> ResponseVO <span class="title function_">loadComment</span><span class="params">(<span class="meta">@NotEmpty</span> String videoId, Integer pageNo, Integer orderType)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1) å…ˆå‘ web é—®è§†é¢‘ç­–ç•¥ï¼ˆæ˜¯å¦å…³é—­è¯„è®ºç­‰ï¼‰</span></span><br><span class="line">    <span class="type">VideoInfo</span> <span class="variable">videoInfo</span> <span class="operator">=</span> videoClient.getVideoInfoByVideoId(videoId);</span><br><span class="line">    <span class="comment">// interaction åŒ…å« &quot;1&quot; è¡¨ç¤ºå…³é—­ï¼ˆä¸ä½ é¡¹ç›®çº¦å®šä¸€è‡´ï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> (videoInfo.getInteraction() != <span class="literal">null</span></span><br><span class="line">        &amp;&amp; videoInfo.getInteraction().contains(Constants.ONE.toString())) &#123;</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;()); <span class="comment">// ç›´æ¥è¿”å›ç©ºåˆ—è¡¨</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2) æœ¬åŸŸç¼–æ’ï¼šæŸ¥è¯¢é¡¶å±‚è¯„è®º + é€’å½’å­è¯„ + åˆ†é¡µ + æ’åº</span></span><br><span class="line">    <span class="type">VideoCommentQuery</span> <span class="variable">q</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VideoCommentQuery</span>();</span><br><span class="line">    q.setVideoId(videoId);</span><br><span class="line">    q.setLoadChildren(<span class="literal">true</span>);</span><br><span class="line">    q.setPageNo(pageNo);</span><br><span class="line">    q.setPageSize(PageSize.SIZE15.getSize());</span><br><span class="line">    q.setpCommentId(<span class="number">0</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">orderBy</span> <span class="operator">=</span> (orderType == <span class="literal">null</span> || orderType == <span class="number">0</span>)</span><br><span class="line">            ? <span class="string">&quot;like_count desc,comment_id desc&quot;</span> : <span class="string">&quot;comment_id desc&quot;</span>;</span><br><span class="line">    q.setOrderBy(orderBy);</span><br><span class="line">    PaginationResultVO&lt;VideoComment&gt; commentData = videoCommentService.findListByPage(q);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3) ç½®é¡¶è¯„è®ºç½®å‰ï¼ˆå»é‡å unshiftï¼‰</span></span><br><span class="line">    List&lt;VideoComment&gt; topCommentList = topComment(videoId);</span><br><span class="line">    <span class="keyword">if</span> (!topCommentList.isEmpty()) &#123;</span><br><span class="line">        List&lt;VideoComment&gt; rest = commentData.getList().stream()</span><br><span class="line">            .filter(x -&gt; !x.getCommentId().equals(topCommentList.get(<span class="number">0</span>).getCommentId()))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">        rest.addAll(<span class="number">0</span>, topCommentList);</span><br><span class="line">        commentData.setList(rest);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4) ç™»å½•ç”¨æˆ·çš„â€œå·²ç‚¹èµ/å·²è¸©â€æ€ï¼ˆä»æœ¬åŸŸ user_action è¡¨æŸ¥ï¼‰</span></span><br><span class="line">    <span class="type">VideoCommentResultVO</span> <span class="variable">vo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VideoCommentResultVO</span>();</span><br><span class="line">    vo.setCommentData(commentData);</span><br><span class="line"></span><br><span class="line">    List&lt;UserAction&gt; userActionList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">TokenUserInfoDto</span> <span class="variable">token</span> <span class="operator">=</span> getTokenUserInfoDto();</span><br><span class="line">    <span class="keyword">if</span> (token != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">UserActionQuery</span> <span class="variable">uaq</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserActionQuery</span>();</span><br><span class="line">        uaq.setUserId(token.getUserId());</span><br><span class="line">        uaq.setVideoId(videoId);</span><br><span class="line">        uaq.setActionTypeArray(<span class="keyword">new</span> <span class="title class_">Integer</span>[]&#123;</span><br><span class="line">            UserActionTypeEnum.COMMENT_LIKE.getType(),</span><br><span class="line">            UserActionTypeEnum.COMMENT_HATE.getType()</span><br><span class="line">        &#125;);</span><br><span class="line">        userActionList = userActionService.findListByParam(uaq);</span><br><span class="line">    &#125;</span><br><span class="line">    vo.setUserActionList(userActionList);</span><br><span class="line">    <span class="keyword">return</span> getSuccessResponseVO(vo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å˜åŒ–ç‚¹ï¼š</p>
<ul>
<li><strong>è§†é¢‘ç­–ç•¥æ¥æºæ”¹å˜</strong>ï¼šä»â€œæœ¬åœ° serviceâ€æ”¹ä¸ºâ€œFeignâ†’webâ€ï¼›</li>
<li><strong>åˆ—è¡¨ç¼–æ’ä»åœ¨æœ¬åŸŸ</strong>ï¼šåˆ†é¡µã€ç½®é¡¶åˆå¹¶ã€ä¸ªäººæ€æ¸²æŸ“éƒ½åœ¨ interactã€‚</li>
</ul>
<p>VideoDanmuControllerä¸­å°†åŸæœ¬videoInfoServiceè°ƒç”¨çš„æ–¹æ³•æ”¹ä¸ºvideoClientè°ƒç”¨çš„</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> <span class="title class_">VideoClient</span> videoClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">&quot;/loadDanmu&quot;</span>)</span><br><span class="line"><span class="meta">@GlobalInterceptor</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">ResponseVO</span> <span class="title function_">loadDanmu</span>(<span class="params"><span class="meta">@NotEmpty</span> <span class="title class_">String</span> fileId, <span class="meta">@NotEmpty</span> <span class="title class_">String</span> videoId</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1) å…ˆé—® webï¼šæ˜¯å¦å…³é—­å¼¹å¹•</span></span><br><span class="line">    <span class="title class_">VideoInfo</span> videoInfo = videoClient.<span class="title function_">getVideoInfoByVideoId</span>(videoId);</span><br><span class="line">    <span class="keyword">if</span> (videoInfo.<span class="title function_">getInteraction</span>() != <span class="literal">null</span></span><br><span class="line">        &amp;&amp; videoInfo.<span class="title function_">getInteraction</span>().<span class="title function_">contains</span>(<span class="title class_">Constants</span>.<span class="property">ZERO</span>.<span class="title function_">toString</span>())) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">getSuccessResponseVO</span>(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;()); <span class="comment">// å…³é—­å¼¹å¹•ï¼Œè¿”å›ç©º</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2) æŸ¥è¯¢è¯¥åˆ†Pä¸‹çš„å¼¹å¹•ï¼ˆæŒ‰æ—¶é—´/è‡ªå¢å‡åºï¼‰</span></span><br><span class="line">    <span class="title class_">VideoDanmuQuery</span> q = <span class="keyword">new</span> <span class="title class_">VideoDanmuQuery</span>();</span><br><span class="line">    q.<span class="title function_">setFileId</span>(fileId);</span><br><span class="line">    q.<span class="title function_">setOrderBy</span>(<span class="string">&quot;danmu_id asc&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">getSuccessResponseVO</span>(videoDanmuService.<span class="title function_">findListByParam</span>(q));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¦ç‚¹ï¼š</p>
<ul>
<li><strong>å…³/å¼€å¼¹å¹•</strong>åˆ¤å®šæƒä»åœ¨è§†é¢‘åŸŸï¼›</li>
<li>interact åªè´Ÿè´£æŒ‰ <code>fileId</code> å–å¼¹å¹•æµå¹¶æ’åºè¾“å‡º</li>
</ul>
<p>è°ƒç”¨é“¾æ€ä¹ˆèµ°ï¼ˆä¸€æ¬¡è¯„è®º/å¼¹å¹•æŸ¥è¯¢ï¼‰</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1376-1024x345.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1378.png" alt="img"></p>
<h2 id="10-åˆ›ä½œä¸­å¿ƒ">10.åˆ›ä½œä¸­å¿ƒ</h2>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1379.png" alt="img"></p>
<p>é¦–å…ˆå…ˆæŠŠåˆ›ä½œä¸­å¿ƒç›¸å…³è¦ç”¨çš„poã€voã€queryã€serviceã€mapperç­‰ä¿¡æ¯è¿›è¡Œè¿ç§»ï¼Œåœ¨æ­¤çœç•¥ä¸åšé˜è¿°</p>
<p>å°†æŸ¥è¯¢æ‰€æœ‰è§†é¢‘æ¥å£ä»äº¤äº’æ¨¡å—çš„UcenterControlleræ‹†åˆ†åˆ°webæ¨¡å—çš„UcenterInteractControllerä¸­</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1380-880x1024.png" alt="img"></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">&quot;/ucenter&quot;</span>)</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">UCenterInteractController</span> <span class="keyword">extends</span> <span class="title">ABaseController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">VideoInfoPostService</span> videoInfoPostService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">&quot;/loadAllVideo&quot;</span>)</span><br><span class="line">    <span class="meta">@GlobalInterceptor</span>(checkLogin = <span class="literal">true</span>)</span><br><span class="line">    public <span class="type">ResponseVO</span> loadAllVideo() &#123;</span><br><span class="line">        <span class="type">TokenUserInfoDto</span> tokenUserInfoDto = getTokenUserInfoDto();</span><br><span class="line">        <span class="type">VideoInfoPostQuery</span> videoInfoPostQuery = <span class="keyword">new</span> <span class="type">VideoInfoPostQuery</span>();</span><br><span class="line">        videoInfoPostQuery.setUserId(tokenUserInfoDto.getUserId());</span><br><span class="line">        videoInfoPostQuery.setOrderBy(<span class="string">&quot;create_time desc&quot;</span>);</span><br><span class="line">        <span class="type">List</span>&lt;<span class="type">VideoInfoPost</span>&gt; videoInfoPostList = videoInfoPostService.findListByParam(videoInfoPostQuery);</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(videoInfoPostList);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1185-1024x282.png" alt="img"></p>
<h2 id="11-ä¸ªäººä¸­å¿ƒ">11.ä¸ªäººä¸­å¿ƒ</h2>
<p>æŠŠwebç«¯ä¸­UHomeControllerä¸­å±•ç¤ºç”¨æˆ·æ”¶è—åˆ—è¡¨çš„æ¥å£æ‹†åˆ†åˆ°äº’åŠ¨æ¨¡å—çš„UHomeController</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1381-904x1024.png" alt="img"></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">&quot;/uhome&quot;</span>)</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">UcHomeController</span> <span class="keyword">extends</span> <span class="title">ABaseController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">UserActionService</span> userActionService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">&quot;/loadUserCollection&quot;</span>)</span><br><span class="line">    <span class="meta">@GlobalInterceptor</span></span><br><span class="line">    public <span class="type">ResponseVO</span> loadUserCollection(<span class="meta">@NotEmpty</span> <span class="type">String</span> userId, <span class="type">Integer</span> pageNo) &#123;</span><br><span class="line">        <span class="type">UserActionQuery</span> actionQuery = <span class="keyword">new</span> <span class="type">UserActionQuery</span>();</span><br><span class="line">        actionQuery.setActionType(<span class="type">UserActionTypeEnum</span>.<span class="type">VIDEO_COLLECT</span>.getType());</span><br><span class="line">        actionQuery.setUserId(userId);</span><br><span class="line">        actionQuery.setPageNo(pageNo);</span><br><span class="line">        actionQuery.setQueryVideoInfo(<span class="literal">true</span>);</span><br><span class="line">        actionQuery.setOrderBy(<span class="string">&quot;action_time desc&quot;</span>);</span><br><span class="line">        <span class="type">PaginationResultVO</span> resultVO = userActionService.findListByPage(actionQuery);</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(resultVO);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1382-822x1024.png" alt="img"></p>
<h2 id="12-ç®¡ç†åå°-æ•°æ®ç»Ÿè®¡">12.ç®¡ç†åå°-æ•°æ®ç»Ÿè®¡</h2>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1383.png" alt="img"></p>
<ol start="2">
<li>å•ä½“ â†’ å¾®æœåŠ¡ï¼šæ§åˆ¶å™¨ä¸è°ƒç”¨é“¾æ€ä¹ˆå˜</li>
</ol>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1384-833x1024.png" alt="img"></p>
<p>è¿™æ · <strong>Admin</strong> ä»…æ‰¿æ‹…â€œAPI ç¼–æ’â€ï¼ŒçœŸæ­£çš„ç»Ÿè®¡åœ¨ <strong>Web</strong>ã€‚</p>
<p><strong>Web</strong> æš´éœ² provider æ¥å£ <code>StatisticsInfoApi</code> å®ŒæˆåŸæ¥çš„ç»Ÿè®¡è®¡ç®—ï¼š</p>
<ul>
<li><code>/getActualTimeStatisticsInfo</code>ï¼šæŸ¥ T-1 æŒ‰ç±»å‹æ±‡æ€» + ä»¥å…¨ç«™ç”¨æˆ·æ€»æ•°è¦†ç›–â€œç”¨æˆ·/ç²‰ä¸â€é¡¹ + è¿”å›ç´¯è®¡æ€»è§ˆï¼›</li>
<li><code>/getWeekStatisticsInfo</code>ï¼šéâ€œç”¨æˆ·â€ç±»å‹èµ° <code>statistics_info</code>ï¼Œ<strong>ç”¨æˆ·</strong>ç±»å‹èµ° <code>user_info</code> èšåˆï¼›å¯¹ 7 å¤©æ—¥æœŸåºåˆ—<strong>è¡¥ 0</strong>è¾“å‡ºã€‚<br>
ï¼ˆå®ç°ä¸å•ä½“æ—¶ä»£ç›¸åŒï¼Œåªæ˜¯<strong>æŒªåˆ°äº† Web</strong> å¹¶å¯¹å¤–æš´éœ²ä¸ºå†…éƒ¨æ¥å£ï¼‰</li>
</ul>
<p>åœ¨adminæ¨¡å—ä¸‹api-consumer-WebClient</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@FeignClient</span>(name = Constants.SERVER_NAME_WEB)</span><br><span class="line">public interface WebClient &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/video/getVideoCount&quot;</span>)</span><br><span class="line">    Integer <span class="built_in">getVideoCount</span>(<span class="variable">@RequestBody</span> VideoInfoQuery videoInfoQuery);</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/user/loadUser&quot;</span>)</span><br><span class="line">    PaginationResultVO <span class="built_in">loadUser</span>(<span class="variable">@RequestBody</span> UserInfoQuery userInfoQuery);</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/user/changeStatus&quot;</span>)</span><br><span class="line">    void <span class="built_in">changeStatus</span>(<span class="variable">@RequestParam</span> String userId, <span class="variable">@RequestParam</span> Integer status);</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/video/admin/loadVideoList&quot;</span>)</span><br><span class="line">    PaginationResultVO <span class="built_in">loadVideoList</span>(<span class="variable">@RequestBody</span> VideoInfoPostQuery videoInfoPostQuery);</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/video/admin/recommendVideo&quot;</span>)</span><br><span class="line">    void <span class="built_in">recommendVideo</span>(<span class="variable">@RequestParam</span> String videoId);</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/video/admin/auditVideo&quot;</span>)</span><br><span class="line">    Response <span class="built_in">auditVideo</span>(<span class="variable">@RequestParam</span> String videoId, <span class="variable">@RequestParam</span> Integer status, <span class="variable">@RequestParam</span> String reason);</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/video/admin/deleteVideo&quot;</span>)</span><br><span class="line">    void <span class="built_in">deleteVideo</span>(<span class="variable">@RequestParam</span> String videoId);</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/video/admin/loadVideoPList&quot;</span>)</span><br><span class="line">    List&lt;VideoInfoFilePost&gt; <span class="built_in">loadVideoPList</span>(<span class="variable">@RequestParam</span> String videoId);</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/statistics/admin/getActualTimeStatisticsInfo&quot;</span>)</span><br><span class="line">    Map <span class="built_in">getActualTimeStatisticsInfo</span>();</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/statistics/admin/getWeekStatisticsInfo&quot;</span>)</span><br><span class="line">    List&lt;StatisticsInfo&gt; <span class="built_in">getWeekStatisticsInfo</span>(<span class="variable">@RequestParam</span> Integer dataType);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>InteractClient</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">package</span> <span class="selector-tag">com</span><span class="selector-class">.easylive</span><span class="selector-class">.api</span><span class="selector-class">.consumer</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">com</span><span class="selector-class">.easylive</span><span class="selector-class">.entity</span><span class="selector-class">.constants</span><span class="selector-class">.Constants</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">com</span><span class="selector-class">.easylive</span><span class="selector-class">.entity</span><span class="selector-class">.vo</span><span class="selector-class">.PaginationResultVO</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.cloud</span><span class="selector-class">.openfeign</span><span class="selector-class">.FeignClient</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.web</span><span class="selector-class">.bind</span><span class="selector-class">.annotation</span><span class="selector-class">.RequestMapping</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.web</span><span class="selector-class">.bind</span><span class="selector-class">.annotation</span><span class="selector-class">.RequestParam</span>;</span><br><span class="line"></span><br><span class="line">@<span class="selector-tag">FeignClient</span>(name = Constants.SERVER_NAME_INTERACT)</span><br><span class="line"><span class="selector-tag">public</span> <span class="selector-tag">interface</span> <span class="selector-tag">InteractClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/danmu/admin/loadDanmu&quot;</span>)</span><br><span class="line">    PaginationResultVO <span class="built_in">loadDanmu</span>(<span class="variable">@RequestParam</span>(required = false) Integer pageNo, <span class="variable">@RequestParam</span>(required = false) String videoNameFuzzy);</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/danmu/admin/delDanmu&quot;</span>)</span><br><span class="line">    void <span class="built_in">delDanmu</span>(<span class="variable">@RequestParam</span> Integer danmuId);</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/comment/admin/loadComment&quot;</span>)</span><br><span class="line">    PaginationResultVO <span class="built_in">loadComment</span>(<span class="variable">@RequestParam</span>(required = false) Integer pageNo, <span class="variable">@RequestParam</span>(required = false) String videoNameFuzzy);</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/comment/admin/delComment&quot;</span>)</span><br><span class="line">    void <span class="built_in">delComment</span>(<span class="variable">@RequestParam</span> Integer commentId);</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/message/admin/saveUserMessage&quot;</span>)</span><br><span class="line">    void <span class="built_in">saveUserMessage</span>(<span class="variable">@RequestParam</span> String videoId, <span class="variable">@RequestParam</span> String content);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>adminæ¨¡å—ä¸‹çš„IndexController</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">//</span>å•æœåŠ¡ç‰ˆæœ¬</span><br><span class="line">   <span class="string">//</span> /**</span><br><span class="line">    <span class="string">//</span>  * å¹³å°çº§â€œæ˜¨æ—¥æ¦‚è§ˆ + ç´¯è®¡æ¦‚è§ˆâ€</span><br><span class="line">    <span class="string">//</span>  * - æ˜¨æ—¥ï¼šåŸºäº statistics_info çš„ T-1 æ±‡æ€»ï¼ˆå¹³å°ç»´åº¦ï¼Œä¸å¸¦ userIdï¼‰</span><br><span class="line">    <span class="string">//</span>  * - ç²‰ä¸ï¼šæŠŠâ€œæ˜¨æ—¥ç²‰ä¸â€æ›¿æ¢ä¸ºâ€œå½“å‰å…¨ç«™ç”¨æˆ·æ€»æ•°â€ï¼ˆç†è§£ä¸ºç”¨æˆ·è§„æ¨¡ï¼‰</span><br><span class="line">    <span class="string">//</span>  * - ç´¯è®¡ï¼šå„è®¡æ•°æ€»å’Œ + å…¨ç«™ç”¨æˆ·æ€»é‡</span><br><span class="line">    <span class="string">//</span>  */</span><br><span class="line">    <span class="string">//</span> @RequestMapping<span class="params">(&quot;/getActualTimeStatisticsInfo&quot;)</span></span><br><span class="line">    <span class="string">//</span> public ResponseVO getActualTimeStatisticsInfo<span class="params">()</span> &#123;</span><br><span class="line">    <span class="string">//</span>     String preDate = DateUtil.getBeforeDayDate<span class="params">(1)</span>;                 <span class="string">//</span> æ˜¨æ—¥ yyyy-MM-dd</span><br><span class="line">    <span class="string">//</span>     StatisticsInfoQuery param = new StatisticsInfoQuery<span class="params">()</span>;</span><br><span class="line">    <span class="string">//</span>     param.<span class="keyword">set</span>StatisticsDate<span class="params">(preDate)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="string">//</span>     <span class="string">//</span> â‘  æ˜¨æ—¥å„é¡¹ï¼šå¹³å°åˆè®¡ï¼ˆMapper ä¼š sum å¹¶ group by data_type, statistics_dateï¼‰</span><br><span class="line">    <span class="string">//</span>     List&lt;StatisticsInfo&gt; preDayData =</span><br><span class="line">    <span class="string">//</span>             statisticsInfoService.findListTotalInfoByParam<span class="params">(param)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="string">//</span>     <span class="string">//</span> â‘¡ ç”¨å…¨ç«™ç”¨æˆ·æ€»æ•°è¦†ç›–â€œç²‰ä¸â€é¡¹</span><br><span class="line">    <span class="string">//</span>     Integer userCount = userInfoService.findCountByParam<span class="params">(new UserInfoQuery()</span>);</span><br><span class="line">    <span class="string">//</span>     preDayData.forEach<span class="params">(item -&gt; &#123;</span></span><br><span class="line"><span class="params">    //         if (StatisticsTypeEnum.FANS.getType()</span><span class="string">.equals</span><span class="params">(item.getDataType()</span>)) &#123;</span><br><span class="line">    <span class="string">//</span>             item.<span class="keyword">set</span>StatisticsCount<span class="params">(userCount)</span>;</span><br><span class="line">    <span class="string">//</span>         &#125;</span><br><span class="line">    <span class="string">//</span>     &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="string">//</span>     <span class="string">//</span> â‘¢ è½¬æˆ map: dataType -&gt; countï¼Œä¾¿äºå‰ç«¯æŒ‰æšä¸¾æ¸²æŸ“å¡ç‰‡</span><br><span class="line">    <span class="string">//</span>     Map&lt;Integer, Integer&gt; preDayDataMap = preDayData.stream<span class="params">()</span></span><br><span class="line">    <span class="string">//</span>             <span class="string">.collect</span><span class="params">(Collectors.toMap(StatisticsInfo::getDataType,</span></span><br><span class="line"><span class="params">    //                     StatisticsInfo::getStatisticsCount,</span></span><br><span class="line"><span class="params">    //                     (a, b)</span> -&gt; b));</span><br><span class="line"></span><br><span class="line">    <span class="string">//</span>     <span class="string">//</span> â‘£ ç´¯è®¡æ¦‚è§ˆï¼šä¼  null â†’ ç»Ÿè®¡å¹³å°æ€»é‡ï¼›åŒæ—¶è¿”å› userCountï¼ˆå…¨ç«™ç”¨æˆ·æ•°ï¼‰</span><br><span class="line">    <span class="string">//</span>     Map&lt;String, Integer&gt; totalCountInfo =</span><br><span class="line">    <span class="string">//</span>             statisticsInfoService.getStatisticsInfoActualTime<span class="params">(null)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="string">//</span>     Map&lt;String, Object&gt; result = new HashMap&lt;&gt;<span class="params">()</span>;</span><br><span class="line">    <span class="string">//</span>     result.put<span class="params">(&quot;preDayData&quot;, preDayDataMap)</span>;</span><br><span class="line">    <span class="string">//</span>     result.put<span class="params">(&quot;totalCountInfo&quot;, totalCountInfo)</span>;</span><br><span class="line">    <span class="string">//</span>     return getSuccessResponseVO<span class="params">(result)</span>;</span><br><span class="line">    <span class="string">//</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="string">//</span> /**</span><br><span class="line">    <span class="string">//</span>  * å¹³å°çº§â€œè¿‘7å¤©è¶‹åŠ¿â€</span><br><span class="line">    <span class="string">//</span>  * - dataType é FANSï¼šå– statistics_info çš„å¹³å°æ±‡æ€»</span><br><span class="line">    <span class="string">//</span>  * - dataType = FANSï¼šå– user_info æŒ‰ join_time çš„æ¯æ—¥è®¡æ•°</span><br><span class="line">    <span class="string">//</span>  * - å¯¹ç¼ºå¤±æ—¥æœŸè¡¥ 0ï¼Œä¿è¯ 7 å¤©ç­‰é•¿åºåˆ—</span><br><span class="line">    <span class="string">//</span>  */</span><br><span class="line">    <span class="string">//</span> @RequestMapping<span class="params">(&quot;/getWeekStatisticsInfo&quot;)</span></span><br><span class="line">    <span class="string">//</span> public ResponseVO getWeekStatisticsInfo<span class="params">(Integer dataType)</span> &#123;</span><br><span class="line">    <span class="string">//</span>     List&lt;String&gt; dateList = DateUtil.getBeforeDates<span class="params">(7)</span>;             <span class="string">//</span> æœ€è¿‘7å¤©æ—¥æœŸï¼ˆä¸å«ä»Šå¤©ï¼‰</span><br><span class="line"></span><br><span class="line">    <span class="string">//</span>     StatisticsInfoQuery param = new StatisticsInfoQuery<span class="params">()</span>;</span><br><span class="line">    <span class="string">//</span>     param.<span class="keyword">set</span>DataType<span class="params">(dataType)</span>;</span><br><span class="line">    <span class="string">//</span>     param.<span class="keyword">set</span>StatisticsDateStart<span class="params">(dateList.get(0)</span>);</span><br><span class="line">    <span class="string">//</span>     param.<span class="keyword">set</span>StatisticsDateEnd<span class="params">(dateList.get(dateList.size()</span> - 1));</span><br><span class="line">    <span class="string">//</span>     param.<span class="keyword">set</span>OrderBy<span class="params">(&quot;statistics_date asc&quot;)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="string">//</span>     <span class="string">//</span> FANS èµ° user_info èšåˆï¼Œå…¶å®ƒèµ° statistics_info èšåˆ</span><br><span class="line">    <span class="string">//</span>     List&lt;StatisticsInfo&gt; statisticsInfoList =</span><br><span class="line">    <span class="string">//</span>             !StatisticsTypeEnum.FANS.getType<span class="params">()</span><span class="string">.equals</span><span class="params">(dataType)</span></span><br><span class="line">    <span class="string">//</span>                     ? statisticsInfoService.findListTotalInfoByParam<span class="params">(param)</span></span><br><span class="line">    <span class="string">//</span>                     : statisticsInfoService.findUserCountTotalInfoByParam<span class="params">(param)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="string">//</span>     <span class="string">//</span> æ˜ å°„ä¸º date -&gt; itemï¼Œä¾¿äºè¡¥é›¶</span><br><span class="line">    <span class="string">//</span>     Map&lt;String, StatisticsInfo&gt; dataMap = statisticsInfoList.stream<span class="params">()</span></span><br><span class="line">    <span class="string">//</span>             <span class="string">.collect</span><span class="params">(Collectors.toMap(StatisticsInfo::getStatisticsDate,</span></span><br><span class="line"><span class="params">    //                     Function.identity()</span>,</span><br><span class="line">    <span class="string">//</span>                     <span class="params">(a, b)</span> -&gt; b));</span><br><span class="line"></span><br><span class="line">    <span class="string">//</span>     <span class="string">//</span> æŒ‰æ—¥æœŸé¡ºåºè¡¥é›¶è¾“å‡º</span><br><span class="line">    <span class="string">//</span>     List&lt;StatisticsInfo&gt; resultDataList = new ArrayList&lt;&gt;<span class="params">()</span>;</span><br><span class="line">    <span class="string">//</span>     for <span class="params">(String date : dateList)</span> &#123;</span><br><span class="line">    <span class="string">//</span>         StatisticsInfo item = dataMap.get<span class="params">(date)</span>;</span><br><span class="line">    <span class="string">//</span>         <span class="keyword">if</span> <span class="params">(<span class="attr">item</span> == null)</span> &#123;</span><br><span class="line">    <span class="string">//</span>             item = new StatisticsInfo<span class="params">()</span>;</span><br><span class="line">    <span class="string">//</span>             item.<span class="keyword">set</span>StatisticsDate<span class="params">(date)</span>;</span><br><span class="line">    <span class="string">//</span>             item.<span class="keyword">set</span>StatisticsCount<span class="params">(0)</span>;</span><br><span class="line">    <span class="string">//</span>         &#125;</span><br><span class="line">    <span class="string">//</span>         resultDataList.add<span class="params">(item)</span>;</span><br><span class="line">    <span class="string">//</span>     &#125;</span><br><span class="line">    <span class="string">//</span>     return getSuccessResponseVO<span class="params">(resultDataList)</span>;</span><br><span class="line">    <span class="string">//</span> &#125;</span><br><span class="line"></span><br><span class="line">   <span class="string">//</span>å¾®æœåŠ¡ç‰ˆæœ¬</span><br><span class="line">       @Resource</span><br><span class="line">    private WebClient webClient;</span><br><span class="line"></span><br><span class="line">    @RequestMapping<span class="params">(&quot;/getActualTimeStatisticsInfo&quot;)</span></span><br><span class="line">    public ResponseVO getActualTimeStatisticsInfo<span class="params">()</span> &#123;</span><br><span class="line">        return getSuccessResponseVO<span class="params">(webClient.getActualTimeStatisticsInfo()</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @RequestMapping<span class="params">(&quot;/getWeekStatisticsInfo&quot;)</span></span><br><span class="line">    public ResponseVO getWeekStatisticsInfo<span class="params">(Integer dataType)</span> &#123;</span><br><span class="line">        return getSuccessResponseVO<span class="params">(webClient.getWeekStatisticsInfo(dataType)</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å•æœåŠ¡çš„é€»è¾‘æ‹†è§£åˆ°webæ¨¡å—-api-provider-StatisticsInfoApi</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="title class_">Constants</span>.<span class="property">INNER_API_PREFIX</span> + <span class="string">&quot;/statistics/admin&quot;</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StatisticsInfoApi</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">StatisticsInfoService</span> statisticsInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">UserInfoService</span> userInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">&quot;/getActualTimeStatisticsInfo&quot;</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">Map</span> <span class="title function_">getActualTimeStatisticsInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">String</span> preDate = <span class="title class_">DateUtil</span>.<span class="title function_">getBeforeDayDate</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="title class_">StatisticsInfoQuery</span> param = <span class="keyword">new</span> <span class="title class_">StatisticsInfoQuery</span>();</span><br><span class="line">        param.<span class="title function_">setStatisticsDate</span>(preDate);</span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">StatisticsInfo</span>&gt; preDayData = statisticsInfoService.<span class="title function_">findListTotalInfoByParam</span>(param);</span><br><span class="line">        <span class="comment">//æŸ¥è¯¢ç”¨æˆ·æ€»æ•°ï¼Œæ›¿æ¢ç±»å‹ä¸ºç²‰ä¸çš„æ•°é‡</span></span><br><span class="line">        <span class="title class_">Integer</span> userCount = userInfoService.<span class="title function_">findCountByParam</span>(<span class="keyword">new</span> <span class="title class_">UserInfoQuery</span>());</span><br><span class="line">        preDayData.<span class="title function_">forEach</span>(item -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title class_">StatisticsTypeEnum</span>.<span class="property">USER</span>.<span class="title function_">getType</span>().<span class="title function_">equals</span>(item.<span class="title function_">getDataType</span>())) &#123;</span><br><span class="line">                item.<span class="title function_">setStatisticsCount</span>(userCount);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="title class_">Map</span>&lt;<span class="title class_">Integer</span>, <span class="title class_">Integer</span>&gt; preDayDataMap = preDayData.<span class="title function_">stream</span>().<span class="title function_">collect</span>(<span class="title class_">Collectors</span>.<span class="title function_">toMap</span>(<span class="title class_">StatisticsInfo</span>::getDataType, <span class="title class_">StatisticsInfo</span>::getStatisticsCount, (item1, item2) -&gt; item2));</span><br><span class="line">        <span class="title class_">Map</span>&lt;<span class="title class_">String</span>, <span class="title class_">Integer</span>&gt; totalCountInfo = statisticsInfoService.<span class="title function_">getStatisticsInfoActualTime</span>(<span class="literal">null</span>);</span><br><span class="line">        <span class="title class_">Map</span>&lt;<span class="title class_">String</span>, <span class="title class_">Object</span>&gt; result = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        result.<span class="title function_">put</span>(<span class="string">&quot;preDayData&quot;</span>, preDayDataMap);</span><br><span class="line">        result.<span class="title function_">put</span>(<span class="string">&quot;totalCountInfo&quot;</span>, totalCountInfo);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">&quot;/getWeekStatisticsInfo&quot;</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">List</span>&lt;<span class="title class_">StatisticsInfo</span>&gt; <span class="title function_">getWeekStatisticsInfo</span>(<span class="params"><span class="title class_">Integer</span> dataType</span>) &#123;</span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">String</span>&gt; dateList = <span class="title class_">DateUtil</span>.<span class="title function_">getBeforeDates</span>(<span class="number">7</span>);</span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">StatisticsInfo</span>&gt; statisticsInfoList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="title class_">StatisticsInfoQuery</span> param = <span class="keyword">new</span> <span class="title class_">StatisticsInfoQuery</span>();</span><br><span class="line">        param.<span class="title function_">setDataType</span>(dataType);</span><br><span class="line">        param.<span class="title function_">setStatisticsDateStart</span>(dateList.<span class="title function_">get</span>(<span class="number">0</span>));</span><br><span class="line">        param.<span class="title function_">setStatisticsDateEnd</span>(dateList.<span class="title function_">get</span>(dateList.<span class="title function_">size</span>() - <span class="number">1</span>));</span><br><span class="line">        param.<span class="title function_">setOrderBy</span>(<span class="string">&quot;statistics_date asc&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title class_">StatisticsTypeEnum</span>.<span class="property">USER</span>.<span class="title function_">getType</span>().<span class="title function_">equals</span>(dataType)) &#123;</span><br><span class="line">            statisticsInfoList = statisticsInfoService.<span class="title function_">findListTotalInfoByParam</span>(param);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            statisticsInfoList = statisticsInfoService.<span class="title function_">findUserCountTotalInfoByParam</span>(param);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Map</span>&lt;<span class="title class_">String</span>, <span class="title class_">StatisticsInfo</span>&gt; dataMap = statisticsInfoList.<span class="title function_">stream</span>().<span class="title function_">collect</span>(<span class="title class_">Collectors</span>.<span class="title function_">toMap</span>(item -&gt; item.<span class="title function_">getStatisticsDate</span>(), <span class="title class_">Function</span>.<span class="title function_">identity</span>(), (data1, data2) -&gt; data2));</span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">StatisticsInfo</span>&gt; resultDataList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="title class_">String</span> date : dateList) &#123;</span><br><span class="line">            <span class="title class_">StatisticsInfo</span> dataItem = dataMap.<span class="title function_">get</span>(date);</span><br><span class="line">            <span class="keyword">if</span> (dataItem == <span class="literal">null</span>) &#123;</span><br><span class="line">                dataItem = <span class="keyword">new</span> <span class="title class_">StatisticsInfo</span>();</span><br><span class="line">                dataItem.<span class="title function_">setStatisticsCount</span>(<span class="number">0</span>);</span><br><span class="line">                dataItem.<span class="title function_">setStatisticsDate</span>(date);</span><br><span class="line">            &#125;</span><br><span class="line">            resultDataList.<span class="title function_">add</span>(dataItem);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> resultDataList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1385.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1386-1024x325.png" alt="img"></p>
<p>åŒç†ï¼Œè¿‘ 7 å¤©è¶‹åŠ¿ä¹Ÿæ˜¯è¿™æ¡é“¾è·¯ã€‚</p>
<h2 id="13-ç®¡ç†åå°-è§†é¢‘ç®¡ç†">13.ç®¡ç†åå°-è§†é¢‘ç®¡ç†</h2>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1387.png" alt="img"></p>
<p>æ”¹é€ adminæ¨¡å—ä¸­VideoInfoController</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> <span class="title class_">WebClient</span> webClient;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">&quot;/loadVideoList&quot;</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="title class_">ResponseVO</span> <span class="title function_">loadVideoList</span>(<span class="params"><span class="title class_">VideoInfoPostQuery</span> videoInfoPostQuery</span>) &#123;</span><br><span class="line">    videoInfoPostQuery.<span class="title function_">setOrderBy</span>(<span class="string">&quot;last_update_time desc&quot;</span>);</span><br><span class="line">    videoInfoPostQuery.<span class="title function_">setQueryCountInfo</span>(<span class="literal">true</span>);</span><br><span class="line">    videoInfoPostQuery.<span class="title function_">setQueryUserInfo</span>(<span class="literal">true</span>);</span><br><span class="line">    <span class="title class_">PaginationResultVO</span> resultVO = webClient.<span class="title function_">loadVideoList</span>(videoInfoPostQuery);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">getSuccessResponseVO</span>(resultVO);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">&quot;/recommendVideo&quot;</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="title class_">ResponseVO</span> <span class="title function_">recommendVideo</span>(<span class="params"><span class="meta">@NotEmpty</span> <span class="title class_">String</span> videoId</span>) &#123;</span><br><span class="line">    webClient.<span class="title function_">recommendVideo</span>(videoId);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">getSuccessResponseVO</span>(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">&quot;/auditVideo&quot;</span>)</span><br><span class="line"><span class="meta">@RecordUserMessage</span>(messageType = <span class="title class_">MessageTypeEnum</span>.<span class="property">SYS</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="title class_">ResponseVO</span> <span class="title function_">auditVideo</span>(<span class="params"><span class="title class_">HttpServletResponse</span> servletResponse, <span class="meta">@NotEmpty</span> <span class="title class_">String</span> videoId, <span class="meta">@NotNull</span> <span class="title class_">Integer</span> status, <span class="title class_">String</span> reason</span>) &#123;</span><br><span class="line">    webClient.<span class="title function_">auditVideo</span>(videoId, status, reason);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">getSuccessResponseVO</span>(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">&quot;/deleteVideo&quot;</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="title class_">ResponseVO</span> <span class="title function_">deleteVideo</span>(<span class="params"><span class="meta">@NotEmpty</span> <span class="title class_">String</span> videoId</span>) &#123;</span><br><span class="line">    webClient.<span class="title function_">deleteVideo</span>(videoId);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">getSuccessResponseVO</span>(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">&quot;/loadVideoPList&quot;</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="title class_">ResponseVO</span> <span class="title function_">loadVideoPList</span>(<span class="params"><span class="meta">@NotEmpty</span> <span class="title class_">String</span> videoId</span>) &#123;</span><br><span class="line">    <span class="title class_">List</span>&lt;<span class="title class_">VideoInfoFilePost</span>&gt; videoInfoFilePostsList = webClient.<span class="title function_">loadVideoPList</span>(videoId);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">getSuccessResponseVO</span>(videoInfoFilePostsList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1388.png" alt="img"></p>
<p>WebClient</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@FeignClient</span>(name = Constants.SERVER_NAME_WEB)</span><br><span class="line">public interface WebClient &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/video/getVideoCount&quot;</span>)</span><br><span class="line">    Integer <span class="built_in">getVideoCount</span>(<span class="variable">@RequestBody</span> VideoInfoQuery videoInfoQuery);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/user/loadUser&quot;</span>)</span><br><span class="line">    PaginationResultVO <span class="built_in">loadUser</span>(<span class="variable">@RequestBody</span> UserInfoQuery userInfoQuery);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/user/changeStatus&quot;</span>)</span><br><span class="line">    void <span class="built_in">changeStatus</span>(<span class="variable">@RequestParam</span> String userId, <span class="variable">@RequestParam</span> Integer status);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/video/admin/loadVideoList&quot;</span>)</span><br><span class="line">    PaginationResultVO <span class="built_in">loadVideoList</span>(<span class="variable">@RequestBody</span> VideoInfoPostQuery videoInfoPostQuery);</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/video/admin/recommendVideo&quot;</span>)</span><br><span class="line">    void <span class="built_in">recommendVideo</span>(<span class="variable">@RequestParam</span> String videoId);</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/video/admin/auditVideo&quot;</span>)</span><br><span class="line">    Response <span class="built_in">auditVideo</span>(<span class="variable">@RequestParam</span> String videoId, <span class="variable">@RequestParam</span> Integer status, <span class="variable">@RequestParam</span> String reason);</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/video/admin/deleteVideo&quot;</span>)</span><br><span class="line">    void <span class="built_in">deleteVideo</span>(<span class="variable">@RequestParam</span> String videoId);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/video/admin/loadVideoPList&quot;</span>)</span><br><span class="line">    List&lt;VideoInfoFilePost&gt; <span class="built_in">loadVideoPList</span>(<span class="variable">@RequestParam</span> String videoId);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/statistics/admin/getActualTimeStatisticsInfo&quot;</span>)</span><br><span class="line">    Map <span class="built_in">getActualTimeStatisticsInfo</span>();</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/statistics/admin/getWeekStatisticsInfo&quot;</span>)</span><br><span class="line">    List&lt;StatisticsInfo&gt; <span class="built_in">getWeekStatisticsInfo</span>(<span class="variable">@RequestParam</span> Integer dataType);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1389.png" alt="img"></p>
<p>çœŸæ­£å®ç°åœ¨webæ¨¡å—ä¸­api-provider-VideoInfoApiä¸­</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="title class_">Constants</span>.<span class="property">INNER_API_PREFIX</span> + <span class="string">&quot;/video&quot;</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VideoInfoApi</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åå°åˆ—è¡¨ï¼ˆå«ä½œè€…ä¿¡æ¯ã€è®¡æ•°ä¿¡æ¯æ‹¼è£…ï¼›ç»Ÿä¸€æ’åºå­—æ®µç™½åå•ï¼‰</span></span><br><span class="line">  <span class="meta">@RequestMapping</span>(<span class="string">&quot;/admin/loadVideoList&quot;</span>)</span><br><span class="line">  <span class="keyword">public</span> <span class="title class_">PaginationResultVO</span> <span class="title function_">loadVideoList</span>(<span class="params"><span class="meta">@RequestBody</span> <span class="title class_">VideoInfoPostQuery</span> q</span>)&#123;</span><br><span class="line">    q.<span class="title function_">setOrderBy</span>(<span class="string">&quot;v.last_update_time desc&quot;</span>);</span><br><span class="line">    q.<span class="title function_">setQueryCountInfo</span>(<span class="literal">true</span>);</span><br><span class="line">    q.<span class="title function_">setQueryUserInfo</span>(<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span> videoInfoPostService.<span class="title function_">findListByPage</span>(q);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¨è/å®¡æ ¸ï¼ˆå«å‘ç³»ç»Ÿæ¶ˆæ¯åˆ‡é¢ï¼‰/åˆ é™¤ï¼ˆå«è§†é¢‘åŸŸä¸€è‡´æ€§æ¸…ç†ï¼‰</span></span><br><span class="line">  <span class="meta">@RequestMapping</span>(<span class="string">&quot;/admin/recommendVideo&quot;</span>) <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">recommendVideo</span>(<span class="params"><span class="title class_">String</span> videoId</span>)&#123; videoInfoPostService.<span class="title function_">recommendVideo</span>(videoId); &#125;</span><br><span class="line">  <span class="meta">@RequestMapping</span>(<span class="string">&quot;/admin/auditVideo&quot;</span>)     <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">auditVideo</span>(<span class="params"><span class="title class_">String</span> videoId,<span class="title class_">Integer</span> status,<span class="title class_">String</span> reason</span>)&#123; videoInfoPostService.<span class="title function_">auditVideo</span>(videoId,status,reason); &#125;</span><br><span class="line">  <span class="meta">@RequestMapping</span>(<span class="string">&quot;/admin/deleteVideo&quot;</span>)    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">deleteVideo</span>(<span class="params"><span class="title class_">String</span> videoId</span>)&#123; videoInfoService.<span class="title function_">deleteVideo</span>(videoId,<span class="literal">null</span>); &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æŸ¥çœ‹åˆ†Påˆ—è¡¨</span></span><br><span class="line">  <span class="meta">@RequestMapping</span>(<span class="string">&quot;/admin/loadVideoPList&quot;</span>)</span><br><span class="line">  <span class="keyword">public</span> <span class="title class_">List</span>&lt;<span class="title class_">VideoInfoFilePost</span>&gt; <span class="title function_">loadVideoPList</span>(<span class="params"><span class="title class_">String</span> videoId</span>)&#123;</span><br><span class="line">    <span class="title class_">VideoInfoFilePostQuery</span> q = <span class="keyword">new</span> <span class="title class_">VideoInfoFilePostQuery</span>();</span><br><span class="line">    q.<span class="title function_">setOrderBy</span>(<span class="string">&quot;file_index asc&quot;</span>);</span><br><span class="line">    q.<span class="title function_">setVideoId</span>(videoId);</span><br><span class="line">    <span class="keyword">return</span> videoInfoFilePostService.<span class="title function_">findListByParam</span>(q);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// â€”â€” å…¶ä»–å†…éƒ¨åŸºç¡€èƒ½åŠ›ï¼ˆè¢«å¤šä¸ªåŸŸå¤ç”¨ï¼‰â€”â€”</span></span><br><span class="line">  <span class="meta">@RequestMapping</span>(<span class="string">&quot;/updateCountInfo&quot;</span>) </span><br><span class="line"><span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">updateCountInfo</span>(<span class="params"><span class="title class_">String</span> videoId,<span class="title class_">String</span> field,<span class="title class_">Integer</span> change</span>)&#123;          videoInfoService.<span class="title function_">updateCountInfo</span>(videoId,field,change); </span><br><span class="line">&#125;</span><br><span class="line">  <span class="meta">@RequestMapping</span>(<span class="string">&quot;/updateDocCount&quot;</span>)  </span><br><span class="line"><span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">updateDocCount</span>(<span class="params"><span class="title class_">String</span> videoId,<span class="title class_">SearchOrderTypeEnum</span> <span class="keyword">type</span>,<span class="title class_">Integer</span> change</span>)&#123; esSearchComponent.<span class="title function_">updateDocCount</span>(videoId,<span class="keyword">type</span>.<span class="title function_">getField</span>(),change); </span><br><span class="line">&#125;</span><br><span class="line">  <span class="meta">@RequestMapping</span>(<span class="string">&quot;/getVideoInfoByVideoId&quot;</span>)  </span><br><span class="line"><span class="keyword">public</span> <span class="title class_">VideoInfo</span> <span class="title function_">getVideoInfo</span>(<span class="params"><span class="title class_">String</span> videoId</span>)&#123; </span><br><span class="line"><span class="keyword">return</span> videoInfoService.<span class="title function_">getVideoInfoByVideoId</span>(videoId); </span><br><span class="line">&#125;</span><br><span class="line">  <span class="meta">@RequestMapping</span>(<span class="string">&quot;/getVideoInfoPostByVideoId&quot;</span>) </span><br><span class="line"><span class="keyword">public</span> <span class="title class_">VideoInfoPost</span> <span class="title function_">getVideoInfoPost</span>(<span class="params"><span class="title class_">String</span> videoId</span>)&#123; </span><br><span class="line"><span class="keyword">return</span> videoInfoPostService.<span class="title function_">getVideoInfoPostByVideoId</span>(videoId);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1390-1024x393.png" alt="img"></p>
<p><strong>/inner/</strong> è·¯å¾„åªå…è®¸æœåŠ¡é—´è®¿é—®ï¼ˆç½‘å…³å…¨å±€è¿‡æ»¤å™¨å·²å±è”½å…¬ç½‘ï¼‰ã€‚</p>
<p>Admin åªåš<strong>ç¼–æ’/é‰´æƒ/è¿”å›</strong>ï¼›Web è´Ÿè´£<strong>çœŸå®ä¸šåŠ¡</strong>ä¸æ•°æ®ä¸€è‡´æ€§ã€‚</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1391.png" alt="img"></p>
<h2 id="14-ç®¡ç†åå°-äº’åŠ¨ç®¡ç†">14.ç®¡ç†åå°-äº’åŠ¨ç®¡ç†</h2>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1392.png" alt="img"></p>
<p>åœ¨adminæ¨¡å—-api-consumer-ResourceClient</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@FeignClient</span>(name = Constants.SERVER_NAME_RESOURCE)</span><br><span class="line">public interface ResourceClient &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(value = Constants.INNER_API_PREFIX + <span class="string">&quot;/file/uploadImage&quot;</span>, consumes = MediaType.MULTIPART_FORM_DATA_VALUE)</span><br><span class="line">    String <span class="built_in">uploadCover</span>(<span class="variable">@RequestPart</span> MultipartFile file, <span class="variable">@RequestParam</span> Boolean createThumbnail);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(value = Constants.INNER_API_PREFIX + <span class="string">&quot;/file/getResource&quot;</span>)</span><br><span class="line">    Response <span class="built_in">getResource</span>(<span class="variable">@RequestParam</span> String sourceName);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/file/videoResource/&#123;fileId&#125;&quot;</span>)</span><br><span class="line">    Response <span class="built_in">videoResource</span>(<span class="variable">@PathVariable</span> <span class="variable">@NotEmpty</span> String fileId);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/file/videoResource/&#123;fileId&#125;/&#123;ts&#125;&quot;</span>)</span><br><span class="line">    Response <span class="built_in">getVideoResourceTs</span>(<span class="variable">@PathVariable</span> <span class="variable">@NotEmpty</span> String fileId, <span class="variable">@PathVariable</span> <span class="variable">@NotNull</span> String ts);</span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1393.png" alt="img"></p>
<p>æ”¹é€ adminæ¨¡å—ä¸‹InteractController</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line">   <span class="keyword">private</span> <span class="title class_">InteractClient</span> interactClient;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@RequestMapping</span>(<span class="string">&quot;/loadDanmu&quot;</span>)</span><br><span class="line">   <span class="keyword">public</span> <span class="title class_">ResponseVO</span> <span class="title function_">loadDanmu</span>(<span class="params"><span class="title class_">Integer</span> pageNo, <span class="title class_">String</span> videoNameFuzzy</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="title function_">getSuccessResponseVO</span>(interactClient.<span class="title function_">loadDanmu</span>(pageNo, videoNameFuzzy));</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="meta">@RequestMapping</span>(<span class="string">&quot;/delDanmu&quot;</span>)</span><br><span class="line">   <span class="keyword">public</span> <span class="title class_">ResponseVO</span> <span class="title function_">delDanmu</span>(<span class="params"><span class="meta">@NotNull</span> <span class="title class_">Integer</span> danmuId</span>) &#123;</span><br><span class="line">       interactClient.<span class="title function_">delDanmu</span>(danmuId);</span><br><span class="line">       <span class="keyword">return</span> <span class="title function_">getSuccessResponseVO</span>(<span class="literal">null</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@RequestMapping</span>(<span class="string">&quot;/loadComment&quot;</span>)</span><br><span class="line">   <span class="keyword">public</span> <span class="title class_">ResponseVO</span> <span class="title function_">loadComment</span>(<span class="params"><span class="title class_">Integer</span> pageNo, <span class="title class_">String</span> videoNameFuzzy</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="title function_">getSuccessResponseVO</span>(interactClient.<span class="title function_">loadComment</span>(pageNo, videoNameFuzzy));</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@RequestMapping</span>(<span class="string">&quot;/delComment&quot;</span>)</span><br><span class="line">   <span class="keyword">public</span> <span class="title class_">ResponseVO</span> <span class="title function_">delComment</span>(<span class="params"><span class="meta">@NotNull</span> <span class="title class_">Integer</span> commentId</span>) &#123;</span><br><span class="line">       interactClient.<span class="title function_">delComment</span>(commentId);</span><br><span class="line">       <span class="keyword">return</span> <span class="title function_">getSuccessResponseVO</span>(<span class="literal">null</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>çœŸæ­£çš„å®ç°åœ¨äº’åŠ¨æ¨¡å—ä¸‹api-provider-VideoCommentApiä¸VideoDanmuController</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1394.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1395.png" alt="img"></p>
<p>VideoCommentController</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="title class_">Constants</span>.<span class="property">INNER_API_PREFIX</span> + <span class="string">&quot;/comment&quot;</span>)</span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VideoCommentApi</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">VideoCommentService</span> videoCommentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">&quot;/delCommentByVideoId&quot;</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">delCommentByVideoId</span>(<span class="params"><span class="meta">@NotEmpty</span> <span class="title class_">String</span> videoId</span>) &#123;</span><br><span class="line">        <span class="title class_">VideoCommentQuery</span> videoCommentQuery = <span class="keyword">new</span> <span class="title class_">VideoCommentQuery</span>();</span><br><span class="line">        videoCommentQuery.<span class="title function_">setVideoId</span>(videoId);</span><br><span class="line">        videoCommentService.<span class="title function_">deleteByParam</span>(videoCommentQuery);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">&quot;/admin/loadComment&quot;</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">PaginationResultVO</span> <span class="title function_">loadComment</span>(<span class="params"><span class="title class_">Integer</span> pageNo, <span class="title class_">String</span> videoNameFuzzy</span>) &#123;</span><br><span class="line">        <span class="title class_">VideoCommentQuery</span> commentQuery = <span class="keyword">new</span> <span class="title class_">VideoCommentQuery</span>();</span><br><span class="line">        commentQuery.<span class="title function_">setOrderBy</span>(<span class="string">&quot;comment_id desc&quot;</span>);</span><br><span class="line">        commentQuery.<span class="title function_">setPageNo</span>(pageNo);</span><br><span class="line">        commentQuery.<span class="title function_">setQueryVideoInfo</span>(<span class="literal">true</span>);</span><br><span class="line">        commentQuery.<span class="title function_">setVideoNameFuzzy</span>(videoNameFuzzy);</span><br><span class="line">        <span class="title class_">PaginationResultVO</span> resultVO = videoCommentService.<span class="title function_">findListByPage</span>(commentQuery);</span><br><span class="line">        <span class="keyword">return</span> resultVO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">&quot;/admin/delComment&quot;</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">delComment</span>(<span class="params"><span class="meta">@NotNull</span> <span class="title class_">Integer</span> commentId</span>) &#123;</span><br><span class="line">        videoCommentService.<span class="title function_">deleteComment</span>(<span class="literal">null</span>, commentId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>VideoDanmuController</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="title class_">Constants</span>.<span class="property">INNER_API_PREFIX</span> + <span class="string">&quot;/danmu&quot;</span>)</span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VideoDanmuApi</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">VideoDanmuService</span> videoDanmuService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">&quot;/delDanmByVideoId&quot;</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">delDanmByVideoId</span>(<span class="params"><span class="meta">@NotEmpty</span> <span class="title class_">String</span> videoId</span>) &#123;</span><br><span class="line">        <span class="title class_">VideoDanmuQuery</span> videoDanmuQuery = <span class="keyword">new</span> <span class="title class_">VideoDanmuQuery</span>();</span><br><span class="line">        videoDanmuQuery.<span class="title function_">setVideoId</span>(videoId);</span><br><span class="line">        videoDanmuService.<span class="title function_">deleteByParam</span>(videoDanmuQuery);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">&quot;/admin/loadDanmu&quot;</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">PaginationResultVO</span> <span class="title function_">loadDanmu</span>(<span class="params"><span class="title class_">Integer</span> pageNo, <span class="title class_">String</span> videoNameFuzzy</span>) &#123;</span><br><span class="line">        <span class="title class_">VideoDanmuQuery</span> danmuQuery = <span class="keyword">new</span> <span class="title class_">VideoDanmuQuery</span>();</span><br><span class="line">        danmuQuery.<span class="title function_">setOrderBy</span>(<span class="string">&quot;danmu_id desc&quot;</span>);</span><br><span class="line">        danmuQuery.<span class="title function_">setPageNo</span>(pageNo);</span><br><span class="line">        danmuQuery.<span class="title function_">setQueryVideoInfo</span>(<span class="literal">true</span>);</span><br><span class="line">        danmuQuery.<span class="title function_">setVideoNameFuzzy</span>(videoNameFuzzy);</span><br><span class="line">        <span class="title class_">PaginationResultVO</span> resultVO = videoDanmuService.<span class="title function_">findListByPage</span>(danmuQuery);</span><br><span class="line">        <span class="keyword">return</span> resultVO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">&quot;/admin/delDanmu&quot;</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">delDanmu</span>(<span class="params"><span class="meta">@NotNull</span> <span class="title class_">Integer</span> danmuId</span>) &#123;</span><br><span class="line">        videoDanmuService.<span class="title function_">deleteDanmu</span>(<span class="literal">null</span>, danmuId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1396-1024x330.png" alt="img"></p>
<p>åˆ é™¤å¼¹å¹•/è¯„è®ºçš„é“¾è·¯ç›¸åŒï¼Œåªæ˜¯è°ƒç”¨çš„ provider æ¥å£ä¸åŒ</p>
<p><img src="" alt="img"></p>
<h2 id="15-ç®¡ç†åå°ç”¨æˆ·ï¼Œç³»ç»Ÿè®¾ç½®ï¼Œæ–‡ä»¶å¤„ç†">15.ç®¡ç†åå°ç”¨æˆ·ï¼Œç³»ç»Ÿè®¾ç½®ï¼Œæ–‡ä»¶å¤„ç†</h2>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1398.png" alt="img"></p>
<h3 id="1-ç³»ç»Ÿç”¨æˆ·">1.ç³»ç»Ÿç”¨æˆ·</h3>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1400.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1401.png" alt="img"></p>
<p>æ”¹é€ adminæ¨¡å—ä¸‹çš„USerController</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line">   <span class="keyword">private</span> <span class="title class_">WebClient</span> webClient;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@RequestMapping</span>(<span class="string">&quot;/loadUser&quot;</span>)</span><br><span class="line">   <span class="keyword">public</span> <span class="title class_">ResponseVO</span> <span class="title function_">loadUser</span>(<span class="params"><span class="title class_">UserInfoQuery</span> userInfoQuery</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="title function_">getSuccessResponseVO</span>(webClient.<span class="title function_">loadUser</span>(userInfoQuery));</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@RequestMapping</span>(<span class="string">&quot;/changeStatus&quot;</span>)</span><br><span class="line">   <span class="keyword">public</span> <span class="title class_">ResponseVO</span> <span class="title function_">changeStatus</span>(<span class="params"><span class="title class_">String</span> userId, <span class="title class_">Integer</span> status</span>) &#123;</span><br><span class="line">       webClient.<span class="title function_">changeStatus</span>(userId, status);</span><br><span class="line">       <span class="keyword">return</span> <span class="title function_">getSuccessResponseVO</span>(<span class="literal">null</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>adminæ¨¡å—ä¸‹çš„api-consumer-WebClient</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/user/loadUser&quot;</span>)</span><br><span class="line">  PaginationResultVO <span class="built_in">loadUser</span>(<span class="variable">@RequestBody</span> UserInfoQuery userInfoQuery);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/user/changeStatus&quot;</span>)</span><br><span class="line">  void <span class="built_in">changeStatus</span>(<span class="variable">@RequestParam</span> String userId, <span class="variable">@RequestParam</span> Integer status);</span><br></pre></td></tr></table></figure>
<p>çœŸæ­£çš„å®ç°åœ¨webæ¨¡å—ä¸‹api-provider-UserInfo</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">&quot;/getUserInfoByUserId&quot;</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">UserInfo</span> <span class="title function_">getUserInfoByUserId</span>(<span class="params"><span class="meta">@NotEmpty</span> <span class="title class_">String</span> userId</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> userInfoService.<span class="title function_">getUserInfoByUserId</span>(userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">&quot;/loadUser&quot;</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">PaginationResultVO</span> <span class="title function_">loadUser</span>(<span class="params"><span class="meta">@RequestBody</span> <span class="title class_">UserInfoQuery</span> userInfoQuery</span>) &#123;</span><br><span class="line">        <span class="title class_">PaginationResultVO</span> resultVO = userInfoService.<span class="title function_">findListByPage</span>(userInfoQuery);</span><br><span class="line">        <span class="keyword">return</span> resultVO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">&quot;/changeStatus&quot;</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">changeStatus</span>(<span class="params"><span class="meta">@RequestParam</span> <span class="title class_">String</span> userId, <span class="meta">@RequestParam</span> <span class="title class_">Integer</span> status</span>) &#123;</span><br><span class="line">        <span class="title class_">UserInfo</span> userInfo = <span class="keyword">new</span> <span class="title class_">UserInfo</span>();</span><br><span class="line">        userInfo.<span class="title function_">setStatus</span>(status);</span><br><span class="line">        userInfoService.<span class="title function_">updateUserInfoByUserId</span>(userInfo, userId);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-ç³»ç»Ÿè®¾ç½®">2.ç³»ç»Ÿè®¾ç½®</h3>
<p>ç³»ç»Ÿè®¾ç½®æ— è€¦åˆå¤–éƒ¨åŸŸï¼Œç›´æ¥æ²¿ç”¨åŸå®ç°å³å¯ï¼›è‹¥åç»­è¦å¤šç«¯å¤ç”¨ï¼Œå†æŠ½ providerã€‚</p>
<h3 id="3-æ–‡ä»¶å¤„ç†">3.æ–‡ä»¶å¤„ç†</h3>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1402-841x1024.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1403-864x1024.png" alt="img"></p>
<p>åœ¨adminæ¨¡å—ä¸‹api-consumer-ResourceClient</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">package</span> <span class="selector-tag">com</span><span class="selector-class">.easylive</span><span class="selector-class">.api</span><span class="selector-class">.consumer</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">com</span><span class="selector-class">.easylive</span><span class="selector-class">.entity</span><span class="selector-class">.constants</span><span class="selector-class">.Constants</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">feign</span><span class="selector-class">.Response</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.cloud</span><span class="selector-class">.openfeign</span><span class="selector-class">.FeignClient</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.http</span><span class="selector-class">.MediaType</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.web</span><span class="selector-class">.bind</span><span class="selector-class">.annotation</span><span class="selector-class">.PathVariable</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.web</span><span class="selector-class">.bind</span><span class="selector-class">.annotation</span><span class="selector-class">.RequestMapping</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.web</span><span class="selector-class">.bind</span><span class="selector-class">.annotation</span><span class="selector-class">.RequestParam</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.web</span><span class="selector-class">.bind</span><span class="selector-class">.annotation</span><span class="selector-class">.RequestPart</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">org</span><span class="selector-class">.springframework</span><span class="selector-class">.web</span><span class="selector-class">.multipart</span><span class="selector-class">.MultipartFile</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">javax</span><span class="selector-class">.validation</span><span class="selector-class">.constraints</span><span class="selector-class">.NotEmpty</span>;</span><br><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">javax</span><span class="selector-class">.validation</span><span class="selector-class">.constraints</span><span class="selector-class">.NotNull</span>;</span><br><span class="line"></span><br><span class="line">@<span class="selector-tag">FeignClient</span>(name = Constants.SERVER_NAME_RESOURCE)</span><br><span class="line"><span class="selector-tag">public</span> <span class="selector-tag">interface</span> <span class="selector-tag">ResourceClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(value = Constants.INNER_API_PREFIX + <span class="string">&quot;/file/uploadImage&quot;</span>, consumes = MediaType.MULTIPART_FORM_DATA_VALUE)</span><br><span class="line">    String <span class="built_in">uploadCover</span>(<span class="variable">@RequestPart</span> MultipartFile file, <span class="variable">@RequestParam</span> Boolean createThumbnail);</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(value = Constants.INNER_API_PREFIX + <span class="string">&quot;/file/getResource&quot;</span>)</span><br><span class="line">    Response <span class="built_in">getResource</span>(<span class="variable">@RequestParam</span> String sourceName);</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/file/videoResource/&#123;fileId&#125;&quot;</span>)</span><br><span class="line">    Response <span class="built_in">videoResource</span>(<span class="variable">@PathVariable</span> <span class="variable">@NotEmpty</span> String fileId);</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/file/videoResource/&#123;fileId&#125;/&#123;ts&#125;&quot;</span>)</span><br><span class="line">    Response <span class="built_in">getVideoResourceTs</span>(<span class="variable">@PathVariable</span> <span class="variable">@NotEmpty</span> String fileId, <span class="variable">@PathVariable</span> <span class="variable">@NotNull</span> String ts);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨resourceæ¨¡å—ä¸‹api-provider-ResourceApi</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@RestController</span></span><br><span class="line"><span class="variable">@Validated</span></span><br><span class="line"><span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/file&quot;</span>)</span><br><span class="line">public class ResourceApi &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@Resource</span></span><br><span class="line">    private FileController fileController;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(<span class="string">&quot;/uploadImage&quot;</span>)</span><br><span class="line">    public String <span class="built_in">uploadCover</span>(<span class="variable">@NotNull</span> MultipartFile file, <span class="variable">@NotNull</span> Boolean createThumbnail) throws IOException &#123;</span><br><span class="line">        <span class="selector-tag">return</span> <span class="selector-tag">fileController</span><span class="selector-class">.uploadCoverInner</span>(file, createThumbnail);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="selector-tag">RequestMapping</span>(value = <span class="string">&quot;/getResource&quot;</span>)</span><br><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">void</span> <span class="selector-tag">getResource</span>(HttpServletResponse response, <span class="variable">@NotEmpty</span> String sourceName) &#123;</span><br><span class="line">        <span class="selector-tag">fileController</span><span class="selector-class">.getResource</span>(response, sourceName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="selector-tag">RequestMapping</span>(<span class="string">&quot;/videoResource/&#123;fileId&#125;&quot;</span>)</span><br><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">void</span> <span class="selector-tag">videoResource</span>(HttpServletResponse response, <span class="variable">@PathVariable</span> <span class="variable">@NotEmpty</span> String fileId) &#123;</span><br><span class="line">        <span class="selector-tag">fileController</span><span class="selector-class">.getVideoResource</span>(response, fileId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="selector-tag">RequestMapping</span>(<span class="string">&quot;/videoResource/&#123;fileId&#125;/&#123;ts&#125;&quot;</span>)</span><br><span class="line">    @<span class="selector-tag">GlobalInterceptor</span></span><br><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">void</span> <span class="selector-tag">getVideoResourceTs</span>(HttpServletResponse response, <span class="variable">@PathVariable</span> <span class="variable">@NotEmpty</span> String fileId, <span class="variable">@PathVariable</span> <span class="variable">@NotNull</span> String ts) &#123;</span><br><span class="line">        <span class="selector-tag">fileController</span><span class="selector-class">.getVideoResourceTs</span>(response, fileId, ts);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>resourceä¸‹çš„FileControllerä¸­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span>: ä¸Šä¼ å›¾ç‰‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>: [file]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>: com.easylive.entity.vo.ResponseVO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/uploadImage&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkLogin = true)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseVO <span class="title function_">uploadCover</span><span class="params">(<span class="meta">@NotNull</span> MultipartFile file, <span class="meta">@NotNull</span> Boolean createThumbnail)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(uploadCoverInner(file, createThumbnail));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">uploadCoverInner</span><span class="params">(MultipartFile file, Boolean createThumbnail)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">day</span> <span class="operator">=</span> DateUtil.format(<span class="keyword">new</span> <span class="title class_">Date</span>(), DateTimePatternEnum.YYYYMMDD.getPattern());</span><br><span class="line">        <span class="type">String</span> <span class="variable">folder</span> <span class="operator">=</span> appConfig.getProjectFolder() + Constants.FILE_FOLDER + Constants.FILE_COVER + day;</span><br><span class="line">        <span class="type">File</span> <span class="variable">folderFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(folder);</span><br><span class="line">        <span class="keyword">if</span> (!folderFile.exists()) &#123;</span><br><span class="line">            folderFile.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileSuffix</span> <span class="operator">=</span> fileName.substring(fileName.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">realFileName</span> <span class="operator">=</span> StringTools.getRandomString(Constants.LENGTH_30) + fileSuffix;</span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> folder + <span class="string">&quot;/&quot;</span> + realFileName;</span><br><span class="line">        file.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(filePath));</span><br><span class="line">        <span class="keyword">if</span> (createThumbnail) &#123;</span><br><span class="line">            <span class="comment">//ç”Ÿæˆç¼©ç•¥å›¾</span></span><br><span class="line">            fFmpegUtils.createImageThumbnail(filePath);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Constants.FILE_COVER + day + <span class="string">&quot;/&quot;</span> + realFileName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/getResource&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getResource</span><span class="params">(HttpServletResponse response, <span class="meta">@NotEmpty</span> String sourceName)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!StringTools.pathIsOk(sourceName)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ResponseCodeEnum.CODE_600);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> StringTools.getFileSuffix(sourceName);</span><br><span class="line">        <span class="type">FileTypeEnum</span> <span class="variable">fileTypeEnum</span> <span class="operator">=</span> FileTypeEnum.getBySuffix(suffix);</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == fileTypeEnum) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ResponseCodeEnum.CODE_600);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">switch</span> (fileTypeEnum) &#123;</span><br><span class="line">            <span class="keyword">case</span> IMAGE:</span><br><span class="line">                <span class="comment">//ç¼“å­˜30å¤©</span></span><br><span class="line">                response.setHeader(<span class="string">&quot;Cache-Control&quot;</span>, <span class="string">&quot;max-age=&quot;</span> + <span class="number">30</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span>);</span><br><span class="line">                response.setContentType(<span class="string">&quot;image/&quot;</span> + suffix.replace(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;&quot;</span>));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        readFile(response, sourceName);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/videoResource/&#123;fileId&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getVideoResource</span><span class="params">(HttpServletResponse response, <span class="meta">@PathVariable</span> <span class="meta">@NotEmpty</span> String fileId)</span> &#123;</span><br><span class="line">        <span class="type">VideoInfoFile</span> <span class="variable">videoInfoFile</span> <span class="operator">=</span> videoClient.getVideoInfoFileByFileId(fileId);</span><br><span class="line">        <span class="keyword">if</span> (videoInfoFile == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> videoInfoFile.getFilePath();</span><br><span class="line">        readFile(response, filePath + <span class="string">&quot;/&quot;</span> + Constants.M3U8_NAME);</span><br><span class="line"></span><br><span class="line">        <span class="type">VideoPlayInfoDto</span> <span class="variable">videoPlayInfoDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VideoPlayInfoDto</span>();</span><br><span class="line">        videoPlayInfoDto.setVideoId(videoInfoFile.getVideoId());</span><br><span class="line">        videoPlayInfoDto.setFileIndex(videoInfoFile.getFileIndex());</span><br><span class="line"></span><br><span class="line">        <span class="type">TokenUserInfoDto</span> <span class="variable">tokenUserInfoDto</span> <span class="operator">=</span> getTokenInfoFromCookie();</span><br><span class="line">        <span class="keyword">if</span> (tokenUserInfoDto != <span class="literal">null</span>) &#123;</span><br><span class="line">            videoPlayInfoDto.setUserId(tokenUserInfoDto.getUserId());</span><br><span class="line">        &#125;</span><br><span class="line">        redisComponent.addVideoPlay(videoPlayInfoDto);</span><br><span class="line">    &#125;</span><br><span class="line">       <span class="meta">@RequestMapping(&quot;/videoResource/&#123;fileId&#125;/&#123;ts&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getVideoResourceTs</span><span class="params">(HttpServletResponse response, <span class="meta">@PathVariable</span> <span class="meta">@NotEmpty</span> String fileId, <span class="meta">@PathVariable</span> <span class="meta">@NotNull</span> String ts)</span> &#123;</span><br><span class="line">        <span class="type">VideoInfoFile</span> <span class="variable">videoInfoFile</span> <span class="operator">=</span> videoClient.getVideoInfoFileByFileId(fileId);</span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> videoInfoFile.getFilePath() + <span class="string">&quot;&quot;</span>;</span><br><span class="line">        readFile(response, filePath + <span class="string">&quot;/&quot;</span> + ts);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>adminä¸‹çš„FileController</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">&quot;/file&quot;</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileController</span> <span class="keyword">extends</span> <span class="title class_ inherited__">ABaseController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">ResourceClient</span> resourceClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">&quot;/uploadImage&quot;</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ResponseVO</span> <span class="title function_">uploadImage</span>(<span class="params"><span class="meta">@NotNull</span> <span class="title class_">MultipartFile</span> file, <span class="meta">@NotNull</span> <span class="title class_">Boolean</span> createThumbnail</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">getSuccessResponseVO</span>(resourceClient.<span class="title function_">uploadCover</span>(file, createThumbnail));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">&quot;/getResource&quot;</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">getResource</span>(<span class="params"><span class="title class_">HttpServletResponse</span> servletResponse, <span class="meta">@NotEmpty</span> <span class="title class_">String</span> sourceName</span>) &#123;</span><br><span class="line">        <span class="title class_">Response</span> response = resourceClient.<span class="title function_">getResource</span>(sourceName);</span><br><span class="line">        <span class="title function_">convertFileReponse2Stream</span>(servletResponse, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">&quot;/videoResource/&#123;fileId&#125;&quot;</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">getVideoResource</span>(<span class="params"><span class="title class_">HttpServletResponse</span> response, <span class="meta">@PathVariable</span> <span class="meta">@NotEmpty</span> <span class="title class_">String</span> fileId</span>) &#123;</span><br><span class="line">        <span class="title function_">convertFileReponse2Stream</span>(response, resourceClient.<span class="title function_">videoResource</span>(fileId));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">&quot;/videoResource/&#123;fileId&#125;/&#123;ts&#125;&quot;</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">getVideoResourceTs</span>(<span class="params"><span class="title class_">HttpServletResponse</span> response, <span class="meta">@PathVariable</span> <span class="meta">@NotEmpty</span> <span class="title class_">String</span> fileId, <span class="meta">@PathVariable</span> <span class="meta">@NotNull</span> <span class="title class_">String</span> ts</span>) &#123;</span><br><span class="line">        <span class="title function_">convertFileReponse2Stream</span>(response, resourceClient.<span class="title function_">getVideoResourceTs</span>(fileId, ts));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ABaseControllerä¸‹åˆ›å»ºconvertFileReponse2Streamæ–¹æ³•</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> convertFileReponse2Stream(HttpServletResponse servletResponse, Response response) &#123;</span><br><span class="line">       Response.Body <span class="keyword">body</span> = response.<span class="keyword">body</span>();</span><br><span class="line">       <span class="keyword">try</span> (InputStream fileInputStream = <span class="keyword">body</span>.asInputStream();</span><br><span class="line">            OutputStream outStream = servletResponse.getOutputStream()) &#123;</span><br><span class="line">           <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">           <span class="keyword">int</span> len;</span><br><span class="line">           <span class="keyword">while</span> ((len = fileInputStream.read(bytes)) != -<span class="number">1</span>) &#123;</span><br><span class="line">               outStream.write(bytes, <span class="number">0</span>, len);</span><br><span class="line">           &#125;</span><br><span class="line">           outStream.flush();</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           log.error(<span class="string">&quot;è¯»å–æ–‡ä»¶æµå¤±è´¥&quot;</span>, e);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1404-866x1024.png" alt="img"></p>
<h2 id="16-å¤„ç†TODO">16.å¤„ç†TODO</h2>
<h3 id="1-ç¬¬ä¸€ä¸ªTODO">1.ç¬¬ä¸€ä¸ªTODO</h3>
<ol>
<li><strong>è§†é¢‘ä¿¡æ¯çš„æŸ¥è¯¢ä¸ç”¨æˆ·è¡Œä¸ºè·å–ï¼ˆè§†é¢‘è¯¦æƒ…ï¼‰</strong></li>
</ol>
<p>åœ¨åŸå•ä½“åº”ç”¨ä¸­ï¼Œ<strong><code>VideoController</code></strong> è´Ÿè´£æŸ¥è¯¢è§†é¢‘ä¿¡æ¯å¹¶è·å–ç”¨æˆ·è¡Œä¸ºï¼ˆè¯„è®ºã€ç‚¹èµã€æ”¶è—ç­‰ï¼‰ã€‚åœ¨å¾®æœåŠ¡æ‹†åˆ†åï¼Œè§†é¢‘ä¿¡æ¯å’Œç”¨æˆ·è¡Œä¸ºæ•°æ®éƒ½åˆ†åˆ«ç”±ä¸åŒçš„å¾®æœåŠ¡æä¾›ï¼Œ<strong><code>Web</code> æœåŠ¡è´Ÿè´£æä¾›è§†é¢‘ä¿¡æ¯ï¼Œ</strong><code>Interact</code> æœåŠ¡è´Ÿè´£æä¾›ç”¨æˆ·è¡Œä¸ºã€‚</p>
<p>åœ¨webæ¨¡å—ä¸‹-api-consumer-</p>
<p>webæ¨¡å—ä¸‹çš„VideoController-è´Ÿè´£è°ƒç”¨ <code>videoInfoService</code> è·å–è§†é¢‘ä¿¡æ¯ï¼Œå¹¶é€šè¿‡ <strong>Feign</strong> è°ƒç”¨ <strong>Interact æœåŠ¡</strong> è·å–å½“å‰ç”¨æˆ·çš„è¡Œä¸ºï¼ˆå¦‚è§†é¢‘ç‚¹èµã€è¯„è®ºç­‰ï¼‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@RequestMapping(&quot;/getVideoInfo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVO <span class="title function_">getVideoInfo</span><span class="params">(<span class="meta">@NotEmpty</span> String videoId)</span> &#123;</span><br><span class="line">    <span class="type">VideoInfo</span> <span class="variable">videoInfo</span> <span class="operator">=</span> videoInfoService.getVideoInfoByVideoId(videoId);</span><br><span class="line">    <span class="keyword">if</span> (videoInfo == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ResponseCodeEnum.CODE_404);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">TokenUserInfoDto</span> <span class="variable">userInfoDto</span> <span class="operator">=</span> getTokenUserInfoDto();</span><br><span class="line"></span><br><span class="line">    List&lt;UserAction&gt; userActionList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span> (userInfoDto != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">UserActionQuery</span> <span class="variable">actionQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserActionQuery</span>();</span><br><span class="line">        actionQuery.setVideoId(videoId);</span><br><span class="line">        actionQuery.setUserId(userInfoDto.getUserId());</span><br><span class="line">        actionQuery.setActionTypeArray(<span class="keyword">new</span> <span class="title class_">Integer</span>[]&#123;</span><br><span class="line">                UserActionTypeEnum.VIDEO_LIKE.getType(),</span><br><span class="line">                UserActionTypeEnum.VIDEO_COLLECT.getType(),</span><br><span class="line">                UserActionTypeEnum.VIDEO_COIN.getType()</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// è°ƒç”¨äº’åŠ¨æ¨¡å—è·å–ç”¨æˆ·è¡Œä¸º</span></span><br><span class="line">        userActionList = interactClient.getUserActionList(actionQuery);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">VideoInfoResultVo</span> <span class="variable">resultVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VideoInfoResultVo</span>();</span><br><span class="line">    resultVo.setVideoInfo(CopyTools.copy(videoInfo, VideoInfoVo.class));</span><br><span class="line">    resultVo.setUserActionList(userActionList);</span><br><span class="line">    <span class="keyword">return</span> getSuccessResponseVO(resultVo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>InteractClient</strong><br>
Feign ç”¨æ¥ä» <strong>Interact</strong> æœåŠ¡è·å–ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼ˆä¾‹å¦‚è¯„è®ºã€ç‚¹èµç­‰ï¼‰ã€‚</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@FeignClient</span>(name = Constants.SERVER_NAME_INTERACT)</span><br><span class="line">public interface InteractClient &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/userAction/getUserActionList&quot;</span>)</span><br><span class="line">    List&lt;UserAction&gt; <span class="built_in">getUserActionList</span>(<span class="variable">@RequestBody</span> UserActionQuery actionQuery);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨interactæ¨¡å—ä¸‹-api-provider-UserActionApi</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@FeignClient</span>(name = Constants.SERVER_NAME_INTERACT)</span><br><span class="line">public interface InteractClient &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/danmu/admin/loadDanmu&quot;</span>)</span><br><span class="line">    PaginationResultVO <span class="built_in">loadDanmu</span>(<span class="variable">@RequestParam</span>(required = false) Integer pageNo, <span class="variable">@RequestParam</span>(required = false) String videoNameFuzzy);</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/danmu/admin/delDanmu&quot;</span>)</span><br><span class="line">    void <span class="built_in">delDanmu</span>(<span class="variable">@RequestParam</span> Integer danmuId);</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/comment/admin/loadComment&quot;</span>)</span><br><span class="line">    PaginationResultVO <span class="built_in">loadComment</span>(<span class="variable">@RequestParam</span>(required = false) Integer pageNo, <span class="variable">@RequestParam</span>(required = false) String videoNameFuzzy);</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/comment/admin/delComment&quot;</span>)</span><br><span class="line">    void <span class="built_in">delComment</span>(<span class="variable">@RequestParam</span> Integer commentId);</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/message/admin/saveUserMessage&quot;</span>)</span><br><span class="line">    void <span class="built_in">saveUserMessage</span>(<span class="variable">@RequestParam</span> String videoId, <span class="variable">@RequestParam</span> String content);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-ç¬¬äºŒä¸ªTODO">2.ç¬¬äºŒä¸ªTODO</h3>
<ol start="2">
<li><strong>åˆ é™¤åˆ†ç±»æ—¶æ£€æŸ¥è§†é¢‘æ•°é‡</strong></li>
</ol>
<p>åŸæœ¬åœ¨å•ä½“åº”ç”¨ä¸­ï¼Œåˆ é™¤åˆ†ç±»æ—¶ä¼šç›´æ¥è¿›è¡Œæ“ä½œï¼Œè€Œåœ¨å¾®æœåŠ¡æ‹†åˆ†åï¼Œ<strong>Web æœåŠ¡</strong> æä¾›äº†ä¸€ä¸ªæŸ¥è¯¢æ¥å£æ¥è·å–è¯¥åˆ†ç±»ä¸‹çš„è§†é¢‘æ•°é‡ï¼Œç¡®ä¿å¦‚æœåˆ†ç±»ä¸‹æœ‰è§†é¢‘ï¼Œä¸èƒ½åˆ é™¤è¯¥åˆ†ç±»ã€‚</p>
<p>adminæ¨¡å—ä¸‹çš„CategoryInfoServiceImpl</p>
<p>åœ¨ <code>delCategory</code> æ–¹æ³•ä¸­ï¼Œé¦–å…ˆè°ƒç”¨ <strong>Web æœåŠ¡</strong> æä¾›çš„æ¥å£æŸ¥è¯¢è¯¥åˆ†ç±»ä¸‹çš„è§†é¢‘æ•°é‡ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦å¯ä»¥åˆ é™¤è¯¥åˆ†ç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delCategory</span><span class="params">(Integer categoryId)</span> &#123;</span><br><span class="line">     <span class="type">VideoInfoQuery</span> <span class="variable">videoInfoQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VideoInfoQuery</span>();</span><br><span class="line">     videoInfoQuery.setCategoryIdOrPCategoryId(categoryId);</span><br><span class="line">        <span class="comment">//TODO WEBæ¨¡å—æä¾›åˆ†ç±»ä¸‹çš„è§†é¢‘æ•°é‡</span></span><br><span class="line">     <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> videoInfoClient.getVideoCount(videoInfoQuery);</span><br><span class="line">     <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;åˆ†ç±»ä¸‹æœ‰è§†é¢‘ä¿¡æ¯ï¼Œæ— æ³•åˆ é™¤&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="type">CategoryInfoQuery</span> <span class="variable">categoryInfoQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CategoryInfoQuery</span>();</span><br><span class="line">     categoryInfoQuery.setCategoryIdOrPCategoryId(categoryId);</span><br><span class="line">     categoryInfoMapper.deleteByParam(categoryInfoQuery);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//åˆ·æ–°ç¼“å­˜</span></span><br><span class="line">     save2Redis();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨adminæ¨¡å—-api-consumer-WebClient</p>
<p>Feign æ¥å£æŸ¥è¯¢è§†é¢‘æ•°é‡ï¼š</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/video/getVideoCount&quot;</span>)</span><br><span class="line">    Integer <span class="built_in">getVideoCount</span>(<span class="variable">@RequestBody</span> VideoInfoQuery videoInfoQuery);</span><br></pre></td></tr></table></figure>
<p>çœŸæ­£çš„å®ç°åœ¨webæ¨¡å—-api-provider-VideoInfoApiä¸­</p>
<p>Web æœåŠ¡æä¾›è§†é¢‘æ•°é‡æŸ¥è¯¢æ¥å£ï¼š</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@RequestMapping</span>(<span class="string">&quot;/getVideoCount&quot;</span>)</span><br><span class="line">public Integer <span class="built_in">getVideoCount</span>(<span class="variable">@RequestBody</span> VideoInfoQuery videoInfoQuery) &#123;</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">videoInfoService</span><span class="selector-class">.findCountByParam</span>(videoInfoQuery);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-ç¬¬ä¸‰ä¸ªTODO">3.ç¬¬ä¸‰ä¸ªTODO</h3>
<ol start="3">
<li><strong>åˆ é™¤è§†é¢‘æ—¶è°ƒç”¨äº’åŠ¨æœåŠ¡åˆ é™¤å¼¹å¹•å’Œè¯„è®º</strong></li>
</ol>
<p>åœ¨åˆ é™¤è§†é¢‘çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ¸…ç†è¯¥è§†é¢‘ç›¸å…³çš„è¯„è®ºå’Œå¼¹å¹•ã€‚åŸå•ä½“ä¸­ï¼Œè¿™äº›æ“ä½œå¯èƒ½åœ¨åŒä¸€ä¸ªæœåŠ¡ä¸­è¿›è¡Œï¼Œä½†åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œåˆ é™¤æ“ä½œä¼šè°ƒç”¨ <strong>Interact æœåŠ¡</strong> ä¸­çš„å¼¹å¹•ä¸è¯„è®ºåˆ é™¤æ¥å£ã€‚</p>
<p>webæ¨¡å—ä¸‹çš„VideoInfoServiceImpl-åœ¨åˆ é™¤è§†é¢‘æ—¶ï¼Œè°ƒç”¨ <strong>Interact æœåŠ¡</strong> æä¾›çš„åˆ é™¤æ¥å£æ¥åˆ é™¤è¯¥è§†é¢‘çš„å¼¹å¹•å’Œè¯„è®ºã€‚</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">  executorService.execute<span class="function"><span class="params">(() -&gt; &#123;</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">        VideoInfoFileQuery videoInfoFileQuery = <span class="keyword">new</span> VideoInfoFileQuery();</span></span></span><br><span class="line"><span class="params"><span class="function">        videoInfoFileQuery.setVideoId(videoId);</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="regexp">//æŸ¥è¯¢åˆ†P</span></span></span></span><br><span class="line"><span class="regexp"><span class="params"><span class="function">        List&lt;VideoInfoFile&gt; videoInfoFileList = this.videoInfoFileMapper.selectList(videoInfoFileQuery);</span></span></span></span><br><span class="line"><span class="regexp"><span class="params"><span class="function"></span></span></span></span><br><span class="line"><span class="regexp"><span class="params"><span class="function">        //</span>åˆ é™¤åˆ†P</span></span></span><br><span class="line"><span class="params"><span class="function">        videoInfoFileMapper.deleteByParam(videoInfoFileQuery);</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">        VideoInfoFilePostQuery videoInfoFilePostQuery = <span class="keyword">new</span> VideoInfoFilePostQuery();</span></span></span><br><span class="line"><span class="params"><span class="function">        videoInfoFilePostQuery.setVideoId(videoId);</span></span></span><br><span class="line"><span class="params"><span class="function">        videoInfoFilePostMapper.deleteByParam(videoInfoFilePostQuery);</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">      /*  <span class="regexp">//åˆ é™¤å¼¹å¹•</span></span></span></span><br><span class="line"><span class="regexp"><span class="params"><span class="function">        VideoDanmuQuery videoDanmuQuery = new VideoDanmuQuery();</span></span></span></span><br><span class="line"><span class="regexp"><span class="params"><span class="function">        videoDanmuQuery.setVideoId(videoId);</span></span></span></span><br><span class="line"><span class="regexp"><span class="params"><span class="function">        videoDanmuMapper.deleteByParam(videoDanmuQuery);</span></span></span></span><br><span class="line"><span class="regexp"><span class="params"><span class="function"></span></span></span></span><br><span class="line"><span class="regexp"><span class="params"><span class="function">        //</span>åˆ é™¤è¯„è®º</span></span></span><br><span class="line"><span class="params"><span class="function">        VideoCommentQuery videoCommentQuery = <span class="keyword">new</span> VideoCommentQuery();</span></span></span><br><span class="line"><span class="params"><span class="function">        videoCommentQuery.setVideoId(videoId);</span></span></span><br><span class="line"><span class="params"><span class="function">        videoCommentMapper.deleteByParam(videoCommentQuery);*/</span></span></span><br><span class="line"><span class="params"><span class="function">        </span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="regexp">//TODO è°ƒç”¨äº’åŠ¨æ¨¡å— åˆ é™¤å¼¹å¹• åˆ é™¤è¯„è®º</span></span></span></span><br><span class="line"><span class="regexp"><span class="params"><span class="function">        interactClient.delDanmuByVideoId(videoId);</span></span></span></span><br><span class="line"><span class="regexp"><span class="params"><span class="function">        interactClient.delCommentByVideoId(videoId);</span></span></span></span><br><span class="line"><span class="regexp"><span class="params"><span class="function"></span></span></span></span><br><span class="line"><span class="regexp"><span class="params"><span class="function">        //</span>åˆ é™¤æ–‡ä»¶</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">for</span> (VideoInfoFile item : videoInfoFileList) &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="keyword">try</span> &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">                FileUtils.deleteDirectory(<span class="keyword">new</span> File(appConfig.getProjectFolder() + item.getFilePath()));</span></span></span><br><span class="line"><span class="params"><span class="function">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">                log.error(<span class="string">&quot;åˆ é™¤æ–‡ä»¶å¤±è´¥ï¼Œæ–‡ä»¶è·¯å¾„:&#123;&#125;&quot;</span>, item.getFilePath());</span></span></span><br><span class="line"><span class="params"><span class="function">            &#125;</span></span></span><br><span class="line"><span class="params"><span class="function">        &#125;</span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;)</span>;</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>
<p>webæ¨¡å—ä¸‹-api-consumer-InteractClient</p>
<p>åˆ é™¤å¼¹å¹•å’Œè¯„è®ºçš„æ–¹æ³•é€šè¿‡ Feign è°ƒç”¨ <strong>Interact æœåŠ¡</strong>ï¼š</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@FeignClient</span>(name = Constants.SERVER_NAME_INTERACT)</span><br><span class="line">public interface InteractClient &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®IDåˆ é™¤å¼¹å¹•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param videoId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/danmu/delDanmByVideoId&quot;</span>)</span><br><span class="line">    void <span class="built_in">delDanmuByVideoId</span>(<span class="variable">@RequestParam</span> String videoId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®videoIdåˆ é™¤è¯„è®º</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param videoId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/comment/delCommentByVideoId&quot;</span>)</span><br><span class="line">    void <span class="built_in">delCommentByVideoId</span>(<span class="variable">@RequestParam</span> String videoId);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/userAction/getUserActionList&quot;</span>)</span><br><span class="line">    List&lt;UserAction&gt; <span class="built_in">getUserActionList</span>(<span class="variable">@RequestBody</span> UserActionQuery actionQuery);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çœŸæ­£çš„å®ç°åœ¨interactæ¨¡å—-api-provider-VideoCommentApiå’ŒVideoDanmuApi</p>
<p>åœ¨ <strong>Interact æœåŠ¡</strong> ä¸­ï¼Œæä¾›å…·ä½“çš„åˆ é™¤å¼¹å¹•ä¸è¯„è®ºçš„ APIï¼š</p>
<p>VideoCommentApi</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="title class_">Constants</span>.<span class="property">INNER_API_PREFIX</span> + <span class="string">&quot;/comment&quot;</span>)</span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VideoCommentApi</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">VideoCommentService</span> videoCommentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">&quot;/delCommentByVideoId&quot;</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">delCommentByVideoId</span>(<span class="params"><span class="meta">@NotEmpty</span> <span class="title class_">String</span> videoId</span>) &#123;</span><br><span class="line">        <span class="title class_">VideoCommentQuery</span> videoCommentQuery = <span class="keyword">new</span> <span class="title class_">VideoCommentQuery</span>();</span><br><span class="line">        videoCommentQuery.<span class="title function_">setVideoId</span>(videoId);</span><br><span class="line">        videoCommentService.<span class="title function_">deleteByParam</span>(videoCommentQuery);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>VideoDanmuApi</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">&quot;/delDanmByVideoId&quot;</span>)</span><br><span class="line">   <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">delDanmByVideoId</span>(<span class="params"><span class="meta">@NotEmpty</span> <span class="title class_">String</span> videoId</span>) &#123;</span><br><span class="line">       <span class="title class_">VideoDanmuQuery</span> videoDanmuQuery = <span class="keyword">new</span> <span class="title class_">VideoDanmuQuery</span>();</span><br><span class="line">       videoDanmuQuery.<span class="title function_">setVideoId</span>(videoId);</span><br><span class="line">       videoDanmuService.<span class="title function_">deleteByParam</span>(videoDanmuQuery);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-ç¬¬å››ä¸ªTODO">4.ç¬¬å››ä¸ªTODO</h3>
<ol start="4">
<li><strong>ç½‘å…³ä¸­çš„ AdminFilter è¿‡æ»¤å™¨</strong></li>
</ol>
<p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œæ‰€æœ‰æœåŠ¡é—´çš„è°ƒç”¨éœ€è¦è¿›è¡Œå®‰å…¨æ€§éªŒè¯ï¼Œç‰¹åˆ«æ˜¯åå°æœåŠ¡çš„ç®¡ç†æ¥å£ã€‚<strong>AdminFilter</strong> ç”¨æ¥å¯¹è¯·æ±‚è¿›è¡Œ Token æ ¡éªŒï¼Œç¡®ä¿åªæœ‰åˆæ³•çš„ç®¡ç†å‘˜å¯ä»¥è®¿é—®ç®¡ç†æ¥å£ã€‚</p>
<p>gatewayæ¨¡å—ä¸‹filterä¸­çš„AdminFilter</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminFilter</span> <span class="keyword">extends</span> <span class="title class_ inherited__">AbstractGatewayFilterFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> final <span class="keyword">static</span> <span class="title class_">String</span> <span class="variable constant_">URL_ACCOUNT</span> = <span class="string">&quot;/account&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> final <span class="keyword">static</span> <span class="title class_">String</span> <span class="variable constant_">URL_FILE</span> = <span class="string">&quot;/file&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">GatewayFilter</span> <span class="title function_">apply</span>(<span class="params"><span class="title class_">Object</span> config</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (exchange, chain) -&gt; &#123;</span><br><span class="line">            <span class="title class_">ServerHttpRequest</span> request = exchange.<span class="title function_">getRequest</span>();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (request.<span class="title function_">getURI</span>().<span class="title function_">getRawPath</span>().<span class="title function_">contains</span>(<span class="variable constant_">URL_ACCOUNT</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> chain.<span class="title function_">filter</span>(exchange);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title class_">String</span> token = <span class="title function_">getToken</span>(request);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//è·å–æ–‡ä»¶ç›´æ¥ä»cookieä¸­è·å–token</span></span><br><span class="line">            <span class="keyword">if</span> (request.<span class="title function_">getURI</span>().<span class="title function_">getRawPath</span>().<span class="title function_">contains</span>(<span class="variable constant_">URL_FILE</span>)) &#123;</span><br><span class="line">                token = <span class="title function_">getTokenFromCookie</span>(request);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="title class_">StringTools</span>.<span class="title function_">isEmpty</span>(token)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="title class_">ResponseCodeEnum</span>.<span class="property">CODE_901</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> chain.<span class="title function_">filter</span>(exchange);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> <span class="title function_">getToken</span>(<span class="params"><span class="title class_">ServerHttpRequest</span> request</span>) &#123;</span><br><span class="line">        <span class="title class_">String</span> token = request.<span class="title function_">getHeaders</span>().<span class="title function_">getFirst</span>(<span class="title class_">Constants</span>.<span class="property">TOKEN_ADMIN</span>);</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> <span class="title function_">getTokenFromCookie</span>(<span class="params"><span class="title class_">ServerHttpRequest</span> request</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> request.<span class="title function_">getCookies</span>().<span class="title function_">getFirst</span>(<span class="title class_">Constants</span>.<span class="property">TOKEN_ADMIN</span>).<span class="title function_">getValue</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»“è®ºï¼š</p>
<ul>
<li><strong>å¾®æœåŠ¡æ‹†åˆ†</strong>åï¼Œæ•°æ®å’Œé€»è¾‘çš„è¾¹ç•Œæ›´åŠ æ¸…æ™°ï¼šå„ä¸ªæœåŠ¡åªè´Ÿè´£è‡ªå·±çš„æ•°æ®å’ŒåŠŸèƒ½ã€‚</li>
<li>æ§åˆ¶å°æœåŠ¡ï¼ˆAdminï¼‰é€šè¿‡ <strong>Feign</strong> è°ƒç”¨å…¶ä»–æœåŠ¡ï¼ˆå¦‚ <strong>Interact æœåŠ¡</strong>ï¼‰æ¥æ‰§è¡Œå¤æ‚çš„æ“ä½œï¼Œé¿å…é‡å¤å¼€å‘ã€‚</li>
<li><strong>å®‰å…¨æ€§</strong>ä¹Ÿå¾—åˆ°äº†å¢å¼ºï¼Œç‰¹åˆ«æ˜¯åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå„ä¸ªæœåŠ¡ä¹‹é—´çš„é€šä¿¡å¯ä»¥é€šè¿‡å®‰å…¨è®¤è¯è¿›è¡Œä¿æŠ¤ã€‚</li>
</ul>
<h2 id="17-ä½¿ç”¨Seataè§£å†³åˆ†å¸ƒå¼äº‹åŠ¡">17.ä½¿ç”¨Seataè§£å†³åˆ†å¸ƒå¼äº‹åŠ¡</h2>
<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤šä¸ªå¾®æœåŠ¡ä¹‹é—´å¯èƒ½ä¼šæ“ä½œä¸åŒçš„æ•°æ®åº“ï¼Œå› æ­¤æ¯ä¸ªæœåŠ¡çš„äº‹åŠ¡æ“ä½œä¸ä¼šåƒå•ä½“åº”ç”¨ä¸­çš„ <code>@Transactional</code> é‚£æ ·ç›´æ¥æ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡ã€‚ä¸ºäº†ç¡®ä¿å¤šä¸ªæœåŠ¡é—´çš„äº‹åŠ¡ä¸€è‡´æ€§ï¼ŒSeata æä¾›äº† <code>@GlobalTransactional</code> æ³¨è§£ï¼Œå…è®¸åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å®ç°å…¨å±€äº‹åŠ¡ã€‚</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1405.png" alt="img"></p>
<p>åœ¨å•æœåŠ¡ä¸­è¯„è®ºæ¨¡å—æ¶‰åŠåˆ°ä¸¤ä¸ªè¡¨ï¼šè¯„è®ºè¡¨ï¼Œè§†é¢‘ä¿¡æ¯è¡¨ï¼Œå¯èƒ½å‡ºç°è¿™æ ·çš„æƒ…å†µè¯„è®ºå‘å‡ºå»äº†ï¼Œè§†é¢‘ä¿¡æ¯è¡¨ä¸­æ•°é‡æ²¡æ›´æ–°æˆåŠŸï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1187.png" alt="img"></p>
<p>å•æœåŠ¡æˆ‘ä»¬ç”¨çš„æ˜¯@Transactional(rollbackFor = Exception.class)</p>
<p>ä½†åœ¨å¾®æœåŠ¡ä¸­ä¸èµ·ä½œç”¨ï¼Œè¿™æ˜¯å› ä¸ºåœ¨å¾®æœåŠ¡ä¸­æ˜¯æ¨¡å—é—´çš„è°ƒç”¨è€Œæ¯ä¸ªæ¨¡å—è¿æ¥è‡ªå·±çš„æ•°æ®åº“</p>
<p>è¿™æ—¶å€™æˆ‘ä»¬å°±è¦å€ŸåŠ©seataï¼Œåªéœ€è¦æŠŠ@Transactional(rollbackFor = Exception.class)æ”¹ä¸º@GlobalTransactional(rollbackFor = Exception.class)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Override</span></span><br><span class="line"><span class="meta">@GlobalTransactional(rollbackFor = Exception.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postComment</span><span class="params">(VideoComment comment, Integer replyCommentId)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. è·å–è§†é¢‘ä¿¡æ¯ï¼Œåˆ¤æ–­è§†é¢‘æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="type">VideoInfo</span> <span class="variable">videoInfo</span> <span class="operator">=</span> videoClient.getVideoInfoByVideoId(comment.getVideoId());</span><br><span class="line">    <span class="keyword">if</span> (videoInfo == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ResponseCodeEnum.CODE_600);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. åˆ¤æ–­æ˜¯å¦å…³é—­è¯„è®º</span></span><br><span class="line">    <span class="keyword">if</span> (videoInfo.getInteraction() != <span class="literal">null</span> &amp;&amp; videoInfo.getInteraction().contains(Constants.ZERO.toString())) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;UPä¸»å·²å…³é—­è¯„è®ºåŒº&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. å¤„ç†å›å¤è¯„è®º</span></span><br><span class="line">    <span class="keyword">if</span> (replyCommentId != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">VideoComment</span> <span class="variable">replyComment</span> <span class="operator">=</span> getVideoCommentByCommentId(replyCommentId);</span><br><span class="line">        <span class="keyword">if</span> (replyComment == <span class="literal">null</span> || !replyComment.getVideoId().equals(comment.getVideoId())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ResponseCodeEnum.CODE_600);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (replyComment.getpCommentId() == <span class="number">0</span>) &#123;</span><br><span class="line">            comment.setpCommentId(replyComment.getCommentId());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            comment.setpCommentId(replyComment.getpCommentId());</span><br><span class="line">            comment.setReplyUserId(replyComment.getUserId());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">UserInfo</span> <span class="variable">userInfo</span> <span class="operator">=</span> videoClient.getUserInfoByUserId(replyComment.getUserId());</span><br><span class="line">        comment.setReplyNickName(userInfo.getNickName());</span><br><span class="line">        comment.setReplyAvatar(userInfo.getAvatar());</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        comment.setpCommentId(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. ä¿å­˜è¯„è®º</span></span><br><span class="line">    comment.setPostTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    comment.setVideoUserId(videoInfo.getUserId());</span><br><span class="line">    <span class="built_in">this</span>.videoCommentMapper.insert(comment);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. æ›´æ–°è¯„è®ºæ•°</span></span><br><span class="line">    <span class="keyword">if</span> (comment.getpCommentId() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.videoClient.updateCountInfo(comment.getVideoId(), UserActionTypeEnum.VIDEO_COMMENT.getField(), <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä»–ä¹Ÿæœ‰ç±»ä¼¼é—®é¢˜çš„éƒ½åŠ ä¸Šè¿™ä¸ªæ³¨è§£ï¼Œè¿™é‡Œå°±ä¸è´¹ç¯‡å¹…äº†</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1406.png" alt="img"></p>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p><code>@GlobalTransactional</code> æä¾›äº†ä¸€ä¸ªç®€ä¾¿çš„æ–¹å¼æ¥å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä½†å®ƒé€‚ç”¨äºè·¨æœåŠ¡çš„äº‹åŠ¡ç®¡ç†åœºæ™¯ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦ä¿è¯å¤šä¸ªæœåŠ¡é—´æ•°æ®ä¸€è‡´æ€§çš„ä¸šåŠ¡æµç¨‹ä¸­ã€‚ç„¶è€Œï¼Œä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ä¾ç„¶ä¼šå¸¦æ¥æ€§èƒ½å¼€é”€å’Œä¸€äº›ç½‘ç»œæ•…éšœå¤„ç†çš„æŒ‘æˆ˜ï¼Œå› æ­¤åœ¨æ‹†åˆ†å¾®æœåŠ¡æ—¶éœ€è¦ç»¼åˆè€ƒè™‘æ€§èƒ½ä¸ä¸€è‡´æ€§çš„éœ€æ±‚ï¼Œé¿å…æ»¥ç”¨å…¨å±€äº‹åŠ¡ã€‚</p>
<h2 id="18-æ–‡ä»¶å¤„ç†ï¼Œå®šæ—¶ä»»åŠ¡å¤„ç†">18.æ–‡ä»¶å¤„ç†ï¼Œå®šæ—¶ä»»åŠ¡å¤„ç†</h2>
<p>æ‹†åˆ†è¿‡ç¨‹è®²è§£</p>
<p>åœ¨è¿™ä¸ªæµç¨‹ä¸­ï¼ŒåŸæœ¬æ˜¯ä¸€ä¸ª<strong>å•ä½“åº”ç”¨</strong>ï¼Œæ‰€æœ‰çš„æ–‡ä»¶å¤„ç†ã€è§†é¢‘è½¬ç ã€æ•°æ®åº“æ“ä½œç­‰åŠŸèƒ½éƒ½åœ¨ä¸€ä¸ªåº”ç”¨å†…å®Œæˆã€‚éšç€ç³»ç»Ÿçš„å‘å±•ï¼Œæ‹†åˆ†ä¸º<strong>å¾®æœåŠ¡æ¶æ„</strong>åï¼Œæ–‡ä»¶å¤„ç†å’Œè§†é¢‘è½¬ç åŠŸèƒ½è¢«è¿ç§»åˆ°äº† <code>resource</code> æœåŠ¡ä¸­ï¼Œå¹¶ä¸”æ‰€æœ‰æœåŠ¡é€šè¿‡è¿œç¨‹è°ƒç”¨ï¼ˆFeignï¼‰è¿›è¡Œåä½œã€‚</p>
<p>æŠŠExecuteQueueTaskä¸­å¤„ç†è½¬ç çš„é˜Ÿåˆ—è¿ç§»åˆ°resourceæ¨¡å—ä¸‹</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">@Slf4j</span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">ExecuteQueueTask</span> &#123;</span><br><span class="line"></span><br><span class="line">    private ExecutorService executorService = Executors.newFixedThreadPool(Constants.LENGTH_10);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    private RedisUtils redisUtils;</span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    private TransferFileComponent transferFileComponent;</span><br><span class="line"></span><br><span class="line">    @PostConstruct</span><br><span class="line">    public <span class="literal">void</span> consumeTransferFileQueue() &#123;</span><br><span class="line">        executorService.execute<span class="function"><span class="params">(() -&gt; &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">                <span class="keyword">try</span> &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">                    VideoInfoFilePost videoInfoFile = (VideoInfoFilePost) redisUtils.rpop(Constants.REDIS_KEY_QUEUE_TRANSFER);</span></span></span><br><span class="line"><span class="params"><span class="function">                    <span class="keyword">if</span> (videoInfoFile == <span class="literal">null</span>) &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">                        Thread.sleep(<span class="number">1500</span>);</span></span></span><br><span class="line"><span class="params"><span class="function">                        <span class="keyword">continue</span>;</span></span></span><br><span class="line"><span class="params"><span class="function">                    &#125;</span></span></span><br><span class="line"><span class="params"><span class="function">                    transferFileComponent.transferVideoFile(videoInfoFile);</span></span></span><br><span class="line"><span class="params"><span class="function">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">                    log.error(<span class="string">&quot;è·å–è½¬ç æ–‡ä»¶é˜Ÿåˆ—ä¿¡æ¯å¤±è´¥&quot;</span>, e);</span></span></span><br><span class="line"><span class="params"><span class="function">                &#125;</span></span></span><br><span class="line"><span class="params"><span class="function">            &#125;</span></span></span><br><span class="line"><span class="params"><span class="function">        &#125;)</span>;</span></span><br><span class="line"><span class="function">    &#125;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1407-855x1024.png" alt="img"></p>
<p>æ‹†åˆ†åï¼š</p>
<p>æ–‡ä»¶è½¬ç çš„å¤„ç†è¿ç§»åˆ° <code>resource</code> æ¨¡å—ä¸­ã€‚æ–°çš„ <code>TransferFileComponent</code> å¤„ç†è§†é¢‘æ–‡ä»¶çš„ä¸Šä¼ ã€è½¬ç ã€åˆ‡å‰²ç­‰æ“ä½œï¼Œå¹¶å°†è½¬ç ç»“æœæ›´æ–°åˆ°æ•°æ®åº“ã€‚</p>
<p>æŠŠå•æœåŠ¡ä¸­çš„VideoInfoPostServiceImplä¸­çš„è¿™äº›æ–¹æ³•è¿ç§»è¿‡æ¥ï¼Œå¹¶æŠŠä»¥å‰videoInfoFilePostMapperå’ŒvideoInfoPostMapperè°ƒç”¨çš„æ–¹æ³•å…¨éƒ¨æ”¹ä¸ºç”±videoClientè°ƒç”¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransferFileComponent</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisComponent redisComponent;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> AppConfig appConfig;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> FFmpegUtils fFmpegUtils;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> VideoClient videoClient;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transferVideoFile</span><span class="params">(VideoInfoFilePost videoInfoFile)</span> &#123;</span><br><span class="line">        <span class="type">VideoInfoFilePost</span> <span class="variable">updateFilePost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VideoInfoFilePost</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">UploadingFileDto</span> <span class="variable">fileDto</span> <span class="operator">=</span> redisComponent.getUploadingVideoFile(videoInfoFile.getUserId(), videoInfoFile.getUploadId());</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * æ‹·è´æ–‡ä»¶åˆ°æ­£å¼ç›®å½•</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">tempFilePath</span> <span class="operator">=</span> appConfig.getProjectFolder() + Constants.FILE_FOLDER + Constants.FILE_FOLDER_TEMP + fileDto.getFilePath();</span><br><span class="line"></span><br><span class="line">            <span class="type">File</span> <span class="variable">tempFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(tempFilePath);</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">targetFilePath</span> <span class="operator">=</span> appConfig.getProjectFolder() + Constants.FILE_FOLDER + Constants.FILE_VIDEO + fileDto.getFilePath();</span><br><span class="line">            <span class="type">File</span> <span class="variable">taregetFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(targetFilePath);</span><br><span class="line">            <span class="keyword">if</span> (!taregetFile.exists()) &#123;</span><br><span class="line">                taregetFile.mkdirs();</span><br><span class="line">            &#125;</span><br><span class="line">            FileUtils.copyDirectory(tempFile, taregetFile);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * åˆ é™¤ä¸´æ—¶ç›®å½•</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            FileUtils.forceDelete(tempFile);</span><br><span class="line">            redisComponent.delVideoFileInfo(videoInfoFile.getUserId(), videoInfoFile.getUploadId());</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * åˆå¹¶æ–‡ä»¶</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">completeVideo</span> <span class="operator">=</span> targetFilePath + Constants.TEMP_VIDEO_NAME;</span><br><span class="line">            <span class="built_in">this</span>.union(targetFilePath, completeVideo, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * è·å–æ’­æ”¾æ—¶é•¿</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="type">Integer</span> <span class="variable">duration</span> <span class="operator">=</span> fFmpegUtils.getVideoInfoDuration(completeVideo);</span><br><span class="line">            updateFilePost.setDuration(duration);</span><br><span class="line">            updateFilePost.setFileSize(<span class="keyword">new</span> <span class="title class_">File</span>(completeVideo).length());</span><br><span class="line">            updateFilePost.setFilePath(Constants.FILE_VIDEO + fileDto.getFilePath());</span><br><span class="line">            updateFilePost.setTransferResult(VideoFileTransferResultEnum.SUCCESS.getStatus());</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * ffmpegåˆ‡å‰²æ–‡ä»¶</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="built_in">this</span>.convertVideo2Ts(completeVideo);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;æ–‡ä»¶è½¬ç å¤±è´¥&quot;</span>, e);</span><br><span class="line">            updateFilePost.setTransferResult(VideoFileTransferResultEnum.FAIL.getStatus());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            videoClient.transferVideoFile4Db(videoInfoFile.getVideoId(), videoInfoFile.getUploadId(), videoInfoFile.getUserId(), updateFilePost);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">union</span><span class="params">(String dirPath, String toFilePath, <span class="type">boolean</span> delSource)</span> <span class="keyword">throws</span> BusinessException &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">dir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(dirPath);</span><br><span class="line">        <span class="keyword">if</span> (!dir.exists()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;ç›®å½•ä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        File fileList[] = dir.listFiles();</span><br><span class="line">        <span class="type">File</span> <span class="variable">targetFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(toFilePath);</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">RandomAccessFile</span> <span class="variable">writeFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(targetFile, <span class="string">&quot;rw&quot;</span>)) &#123;</span><br><span class="line">            <span class="type">byte</span>[] b = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span> * <span class="number">10</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; fileList.length; i++) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">                <span class="comment">//åˆ›å»ºè¯»å—æ–‡ä»¶çš„å¯¹è±¡</span></span><br><span class="line">                <span class="type">File</span> <span class="variable">chunkFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(dirPath + File.separator + i);</span><br><span class="line">                <span class="type">RandomAccessFile</span> <span class="variable">readFile</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    readFile = <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(chunkFile, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">                    <span class="keyword">while</span> ((len = readFile.read(b)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                        writeFile.write(b, <span class="number">0</span>, len);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;åˆå¹¶åˆ†ç‰‡å¤±è´¥&quot;</span>, e);</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;åˆå¹¶æ–‡ä»¶å¤±è´¥&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    readFile.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;åˆå¹¶æ–‡ä»¶&quot;</span> + dirPath + <span class="string">&quot;å‡ºé”™äº†&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (delSource) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; fileList.length; i++) &#123;</span><br><span class="line">                    fileList[i].delete();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">convertVideo2Ts</span><span class="params">(String videoFilePath)</span> &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">videoFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(videoFilePath);</span><br><span class="line">        <span class="comment">//åˆ›å»ºåŒååˆ‡ç‰‡ç›®å½•</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">tsFolder</span> <span class="operator">=</span> videoFile.getParentFile();</span><br><span class="line">        <span class="type">String</span> <span class="variable">codec</span> <span class="operator">=</span> fFmpegUtils.getVideoCodec(videoFilePath);</span><br><span class="line">        <span class="comment">//è½¬ç </span></span><br><span class="line">        <span class="keyword">if</span> (Constants.VIDEO_CODE_HEVC.equals(codec)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">tempFileName</span> <span class="operator">=</span> videoFilePath + Constants.VIDEO_CODE_TEMP_FILE_SUFFIX;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">File</span>(videoFilePath).renameTo(<span class="keyword">new</span> <span class="title class_">File</span>(tempFileName));</span><br><span class="line">            fFmpegUtils.convertHevc2Mp4(tempFileName, videoFilePath);</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">File</span>(tempFileName).delete();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è§†é¢‘è½¬ä¸ºts</span></span><br><span class="line">        fFmpegUtils.convertVideo2Ts(tsFolder, videoFilePath);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ é™¤è§†é¢‘æ–‡ä»¶</span></span><br><span class="line">        videoFile.delete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨resourceæ¨¡å—-api-consumer-VideoClientæä¾›æ¥å£</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">   <span class="variable">@PostMapping</span>(Constants.INNER_API_PREFIX + <span class="string">&quot;/video/transferVideoFile4Db&quot;</span>)</span><br><span class="line">    VideoInfoFile <span class="built_in">transferVideoFile4Db</span>(<span class="variable">@RequestParam</span> String videoId,</span><br><span class="line">                                       <span class="variable">@RequestParam</span> String uploadId,</span><br><span class="line">                                       <span class="variable">@RequestParam</span> String userId,</span><br><span class="line">                                       <span class="variable">@RequestBody</span> VideoInfoFilePost updateFilePost);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨webæ¨¡å—-api-provider-VideoInfoApiä¸­å®ç°</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@RequestMapping</span>(<span class="string">&quot;/transferVideoFile4Db&quot;</span>)</span><br><span class="line"> public void <span class="built_in">transferVideoFile4Db</span>(<span class="variable">@RequestParam</span> String videoId, <span class="variable">@RequestParam</span> String uploadId, <span class="variable">@RequestParam</span> String userId,</span><br><span class="line">                                  <span class="variable">@RequestBody</span> VideoInfoFilePost updateFilePost) &#123;</span><br><span class="line">     <span class="selector-tag">videoInfoPostService</span><span class="selector-class">.transferVideoFile4Db</span>(videoId, uploadId, userId, updateFilePost);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1408.png" alt="img"></p>
<p>VideoInfoPostService</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ–‡ä»¶è½¬ç </span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="type">void</span> <span class="title">transferVideoFile4Db</span><span class="params">(<span class="type">String</span> videoId, <span class="type">String</span> uploadId, <span class="type">String</span> userId, VideoInfoFilePost updateFilePost)</span></span>;</span><br></pre></td></tr></table></figure>
<p>VideoInfoPostServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="meta">@GlobalTransactional(rollbackFor = Exception.class)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transferVideoFile4Db</span><span class="params">(String videoId, String uploadId, String userId, VideoInfoFilePost updateFilePost)</span> &#123;</span><br><span class="line">      <span class="comment">//æ›´æ–°æ–‡ä»¶çŠ¶æ€</span></span><br><span class="line">      videoInfoFilePostMapper.updateByUploadIdAndUserId(updateFilePost, uploadId, userId);</span><br><span class="line">      <span class="comment">//æ›´æ–°è§†é¢‘ä¿¡æ¯</span></span><br><span class="line">      <span class="type">VideoInfoFilePostQuery</span> <span class="variable">fileQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VideoInfoFilePostQuery</span>();</span><br><span class="line">      fileQuery.setVideoId(videoId);</span><br><span class="line">      fileQuery.setTransferResult(VideoFileTransferResultEnum.FAIL.getStatus());</span><br><span class="line">      <span class="type">Integer</span> <span class="variable">failCount</span> <span class="operator">=</span> videoInfoFilePostMapper.selectCount(fileQuery);</span><br><span class="line">      <span class="keyword">if</span> (failCount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="type">VideoInfoPost</span> <span class="variable">videoUpdate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VideoInfoPost</span>();</span><br><span class="line">          videoUpdate.setStatus(VideoStatusEnum.STATUS1.getStatus());</span><br><span class="line">          videoInfoPostMapper.updateByVideoId(videoUpdate, videoId);</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">        <span class="comment">// æ ¹æ®è½¬ç ç»“æœï¼Œæ›´æ–°è§†é¢‘çŠ¶æ€</span></span><br><span class="line">      fileQuery.setTransferResult(VideoFileTransferResultEnum.TRANSFER.getStatus());</span><br><span class="line">      <span class="type">Integer</span> <span class="variable">transferCount</span> <span class="operator">=</span> videoInfoFilePostMapper.selectCount(fileQuery);</span><br><span class="line">      <span class="keyword">if</span> (transferCount == <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="type">Integer</span> <span class="variable">duration</span> <span class="operator">=</span> videoInfoFilePostMapper.sumDuration(videoId);</span><br><span class="line">          <span class="type">VideoInfoPost</span> <span class="variable">videoUpdate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VideoInfoPost</span>();</span><br><span class="line">          videoUpdate.setStatus(VideoStatusEnum.STATUS2.getStatus());</span><br><span class="line">          videoUpdate.setDuration(duration);</span><br><span class="line">          videoInfoPostMapper.updateByVideoId(videoUpdate, videoId);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†ä¿è¯æ–‡ä»¶è½¬ç å’Œæ•°æ®åº“æ›´æ–°çš„åŸå­æ€§ï¼Œä½¿ç”¨äº† <strong>Seata</strong> æä¾›çš„ <code>@GlobalTransactional</code> æ³¨è§£æ¥å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚å½“æ¶‰åŠåˆ°è·¨æœåŠ¡çš„æ“ä½œæ—¶ï¼Œéœ€è¦ç¡®ä¿è¿™äº›æ“ä½œè¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆå…¨å¤±è´¥ã€‚<code>@GlobalTransactional</code> ä¼šåœ¨äº‹åŠ¡å›æ»šæ—¶è‡ªåŠ¨å›æ»šæ‰€æœ‰å‚ä¸çš„æœ¬åœ°äº‹åŠ¡ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-1409.png" alt="img"></p>
<h3 id="æ€»ç»“-2">æ€»ç»“</h3>
<ol>
<li><strong>ä»å•ä½“åˆ°å¾®æœåŠ¡çš„æ‹†åˆ†</strong>ï¼šæ–‡ä»¶å¤„ç†ï¼ˆè½¬ç ã€åˆå¹¶ã€åˆ‡å‰²ï¼‰æ¨¡å—è¢«æ‹†åˆ†åˆ° <strong><code>resource</code> æœåŠ¡</strong>ï¼Œè€ŒåŸæœ¬è´Ÿè´£æ‰€æœ‰æ“ä½œçš„æœåŠ¡å˜å¾—æ›´åŠ è½»é‡åŒ–ã€‚</li>
<li><strong>æœåŠ¡ä¹‹é—´çš„äº¤äº’</strong>ï¼šä½¿ç”¨ Feign å®Œæˆ <strong><code>resource</code> æœåŠ¡</strong> ä¸ <strong><code>video</code> æœåŠ¡</strong> çš„è¿œç¨‹è°ƒç”¨ï¼Œå‡å°‘äº†è€¦åˆã€‚</li>
<li><strong>åˆ†å¸ƒå¼äº‹åŠ¡</strong>ï¼š<code>@GlobalTransactional</code> ä¿è¯è·¨æœåŠ¡çš„æ•°æ®ä¸€è‡´æ€§ï¼Œä½¿å¾—æ–‡ä»¶è½¬ç ä¸æ•°æ®åº“æ›´æ–°èƒ½å¤Ÿä¿æŒåŸå­æ€§ã€‚</li>
</ol>
<h2 id="å¾®æœåŠ¡ç‰ˆæœ¬å®Œç»“">å¾®æœåŠ¡ç‰ˆæœ¬å®Œç»“</h2>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>GQ Videoå•æœåŠ¡æ”¹é€ å¾®æœåŠ¡</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://itgeqian.github.io/posts/41.html">https://itgeqian.github.io/posts/41.html</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>ä½œè€…</h><div class="post-copyright-cc-info"><h>geqian's BlogğŸ­</h></div></div><div class="post-copyright-c"><h>å‘å¸ƒäº</h><div class="post-copyright-cc-info"><h>2025-06-10</h></div></div><div class="post-copyright-u"><h>æ›´æ–°äº</h><div class="post-copyright-cc-info"><h>2025-08-11</h></div></div><div class="post-copyright-c"><h>è®¸å¯åè®®</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E9%A1%B9%E7%9B%AE%E7%9B%B8%E5%85%B3/"><div class="tags-punctuation"><svg class="faa-tada icon" style="height:1.1em;width:1.1em;fill:currentColor;position:relative;top:2px;margin-right:3px" aria-hidden="true"><use xlink:href="#icon-sekuaibiaoqian"></use></svg></div>é¡¹ç›®ç›¸å…³</a></div></div><link rel="stylesheet" href="/css/coin.css" media="defer" onload="this.media='all'"/><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">æŠ•å–‚ä½œè€…</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://java-geqian.oss-cn-beijing.aliyuncs.com/%E5%BE%AE%E4%BF%A1PAY.jpg" target="_blank"><img class="post-qr-code-img" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/%E5%BE%AE%E4%BF%A1PAY.jpg" alt="å¾®ä¿¡"/></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="https://java-geqian.oss-cn-beijing.aliyuncs.com/%E6%94%AF%E4%BB%98%E5%AE%9DPAY.jpg" target="_blank"><img class="post-qr-code-img" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/%E6%94%AF%E4%BB%98%E5%AE%9DPAY.jpg" alt="æ”¯ä»˜å®"/></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li></ul></div></button></div><audio id="coinAudio" src="https://npm.elemecdn.com/akilar-candyassets@1.0.36/audio/aowu.m4a"></audio><script defer="defer" src="/js/coin.js"></script><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/12.html"><img class="prev-cover" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/22.jpg" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">é€Ÿé€šSpringCloudå¾®æœåŠ¡</div></div></a></div><div class="next-post pull-right"><a href="/posts/4.html"><img class="next-cover" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/%E4%B8%89%E5%B9%BB%E7%A5%9E.jpg" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">å‰ç«¯webå¤ä¹ </div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/posts/82.html" title="GQ Musicé¡¹ç›®ç›¸å…³è§£ç­”"><img class="cover" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/83.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-09-16</div><div class="title">GQ Musicé¡¹ç›®ç›¸å…³è§£ç­”</div></div></a></div><div><a href="/posts/58.html" title="GQ Musicé¡¹ç›®æ¼”ç¤ºå›¾"><img class="cover" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/18.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-09-26</div><div class="title">GQ Musicé¡¹ç›®æ¼”ç¤ºå›¾</div></div></a></div><div><a href="/posts/83.html" title="GQ Videoé¡¹ç›®ç›¸å…³è§£ç­”"><img class="cover" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/84.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-09-16</div><div class="title">GQ Videoé¡¹ç›®ç›¸å…³è§£ç­”</div></div></a></div><div><a href="/posts/43.html" title="GQ Videoé¡¹ç›®ä¼˜åŒ–è®°å½•"><img class="cover" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/30.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-08-03</div><div class="title">GQ Videoé¡¹ç›®ä¼˜åŒ–è®°å½•</div></div></a></div><div><a href="/posts/37.html" title="GQ Videoå•æœåŠ¡ç‰ˆæœ¬è®°å½•"><img class="cover" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/27.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-08-12</div><div class="title">GQ Videoå•æœåŠ¡ç‰ˆæœ¬è®°å½•</div></div></a></div><div><a href="/posts/54.html" title="ä»£ç ç”Ÿæˆå™¨è¯¦è§£"><img class="cover" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/%E4%B8%89%E5%9B%BD%E6%97%A0%E5%8F%8C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-09-11</div><div class="title">ä»£ç ç”Ÿæˆå™¨è¯¦è§£</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><svg class="meta_icon" style="width:22px;height:22px;position:relative;top:5px"><use xlink:href="#icon-mulu1"></use></svg><span style="font-weight:bold">ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E5%9B%BE"><span class="toc-text">1.ç³»ç»Ÿæ¶æ„å›¾</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-text">2.æ„å»ºé¡¹ç›®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%84%E4%B8%AA%E6%A8%A1%E5%9D%97pom-xml"><span class="toc-text">å„ä¸ªæ¨¡å—pom.xml</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B9%E7%9B%AE%E5%BD%95pom"><span class="toc-text">æ ¹ç›®å½•pom</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#admin%E6%A8%A1%E5%9D%97pom"><span class="toc-text">adminæ¨¡å—pom</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#base%E6%A8%A1%E5%9D%97pom"><span class="toc-text">baseæ¨¡å—pom</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#common%E6%A8%A1%E5%9D%97pom"><span class="toc-text">commonæ¨¡å—pom</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gateway%E6%A8%A1%E5%9D%97pom"><span class="toc-text">gatewayæ¨¡å—pom</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#interact%E6%A8%A1%E5%9D%97pom"><span class="toc-text">interactæ¨¡å—pom</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#resource%E6%A8%A1%E5%9D%97pom"><span class="toc-text">resourceæ¨¡å—pom</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web%E6%A8%A1%E5%9D%97pom"><span class="toc-text">webæ¨¡å—pom</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-nacos%E5%AE%9E%E4%BE%8B"><span class="toc-text">3.nacoså®ä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-seata%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">1.seataé…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%9C%A8gateway%E7%9A%84resources%E4%B8%AD%E5%88%9B%E5%BB%BAbootstrap-yml%E5%B9%B6%E9%85%8D%E7%BD%AEnacos%E5%AE%9E%E4%BE%8B%E5%B9%B6%E9%85%8D%E7%BD%AE"><span class="toc-text">2.åœ¨gatewayçš„resourcesä¸­åˆ›å»ºbootstrap.ymlå¹¶é…ç½®nacoså®ä¾‹å¹¶é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%9C%A8web%E7%9A%84resources%E4%B8%AD%E5%88%9B%E5%BB%BAbootstrap-yml%E5%B9%B6%E9%85%8D%E7%BD%AEnacos%E5%AE%9E%E4%BE%8B%E5%B9%B6%E9%85%8D%E7%BD%AE"><span class="toc-text">3.åœ¨webçš„resourcesä¸­åˆ›å»ºbootstrap.ymlå¹¶é…ç½®nacoså®ä¾‹å¹¶é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%9C%A8admin%E7%9A%84resources%E4%B8%AD%E5%88%9B%E5%BB%BAbootstrap-yml%E5%B9%B6%E9%85%8D%E7%BD%AEnacos%E5%AE%9E%E4%BE%8B%E5%B9%B6%E9%85%8D%E7%BD%AE"><span class="toc-text">4.åœ¨adminçš„resourcesä¸­åˆ›å»ºbootstrap.ymlå¹¶é…ç½®nacoså®ä¾‹å¹¶é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%9C%A8interact%E7%9A%84resources%E4%B8%AD%E5%88%9B%E5%BB%BAbootstrap-yml%E5%B9%B6%E9%85%8D%E7%BD%AEnacos%E5%AE%9E%E4%BE%8B%E5%B9%B6%E9%85%8D%E7%BD%AE"><span class="toc-text">5.åœ¨interactçš„resourcesä¸­åˆ›å»ºbootstrap.ymlå¹¶é…ç½®nacoså®ä¾‹å¹¶é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%9C%A8resource%E7%9A%84resources%E4%B8%AD%E5%88%9B%E5%BB%BAbootstrap-yml%E5%B9%B6%E9%85%8D%E7%BD%AEnacos%E5%AE%9E%E4%BE%8B%E5%B9%B6%E9%85%8D%E7%BD%AE"><span class="toc-text">6.åœ¨resourceçš„resourcesä¸­åˆ›å»ºbootstrap.ymlå¹¶é…ç½®nacoså®ä¾‹å¹¶é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E5%88%9B%E5%BB%BAvideo%E7%9A%84nacos%E5%AE%9E%E4%BE%8Beasylive-cloud-video-dev-yml"><span class="toc-text">7.åˆ›å»ºvideoçš„nacoså®ä¾‹easylive-cloud-video-dev.yml</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E7%BD%91%E5%85%B3gateway%E9%85%8D%E7%BD%AE"><span class="toc-text">4.ç½‘å…³gatewayé…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%88%86%E7%B1%BB%E4%BF%A1%E6%81%AF%E6%8B%86%E5%88%86%EF%BC%88Openfeign%EF%BC%89"><span class="toc-text">5.åˆ†ç±»ä¿¡æ¯æ‹†åˆ†ï¼ˆOpenfeignï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-text">å°ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-web%E6%A8%A1%E5%9D%97%E6%8B%86%E5%88%86%E8%8E%B7%E5%8F%96%E9%A6%96%E9%A1%B5%E4%BF%A1%E6%81%AF"><span class="toc-text">6.webæ¨¡å—æ‹†åˆ†è·å–é¦–é¡µä¿¡æ¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-resource%E6%A8%A1%E5%9D%97%E4%B8%AD%E8%B0%83%E7%94%A8%E8%B5%84%E6%BA%90%E6%9C%8D%E5%8A%A1%E8%8E%B7%E5%8F%96%E6%96%87%E4%BB%B6%E4%BF%A1%E6%81%AF"><span class="toc-text">7.resourceæ¨¡å—ä¸­è°ƒç”¨èµ„æºæœåŠ¡è·å–æ–‡ä»¶ä¿¡æ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E4%B8%8E%E6%94%B9%E5%8A%A8%E7%82%B9"><span class="toc-text">æ€»ç»“ä¸æ”¹åŠ¨ç‚¹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%B9%E5%8A%A8%E7%82%B9%EF%BC%9A"><span class="toc-text">æ”¹åŠ¨ç‚¹ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A5%BD%E5%A4%84%EF%BC%9A"><span class="toc-text">å¥½å¤„ï¼š</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-interact%E6%A8%A1%E5%9D%97%E8%B0%83%E7%94%A8%E4%BA%92%E5%8A%A8%E6%9C%8D%E5%8A%A1"><span class="toc-text">8.interactæ¨¡å—è°ƒç”¨äº’åŠ¨æœåŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-2"><span class="toc-text">å°ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-interact%E6%A8%A1%E5%9D%97%E4%BA%92%E5%8A%A8%E6%9C%8D%E5%8A%A1-%E8%AF%84%E8%AE%BA%E3%80%81%E5%BC%B9%E5%B9%95"><span class="toc-text">9.interactæ¨¡å—äº’åŠ¨æœåŠ¡-è¯„è®ºã€å¼¹å¹•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E5%88%9B%E4%BD%9C%E4%B8%AD%E5%BF%83"><span class="toc-text">10.åˆ›ä½œä¸­å¿ƒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83"><span class="toc-text">11.ä¸ªäººä¸­å¿ƒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0-%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1"><span class="toc-text">12.ç®¡ç†åå°-æ•°æ®ç»Ÿè®¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0-%E8%A7%86%E9%A2%91%E7%AE%A1%E7%90%86"><span class="toc-text">13.ç®¡ç†åå°-è§†é¢‘ç®¡ç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0-%E4%BA%92%E5%8A%A8%E7%AE%A1%E7%90%86"><span class="toc-text">14.ç®¡ç†åå°-äº’åŠ¨ç®¡ç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0%E7%94%A8%E6%88%B7%EF%BC%8C%E7%B3%BB%E7%BB%9F%E8%AE%BE%E7%BD%AE%EF%BC%8C%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86"><span class="toc-text">15.ç®¡ç†åå°ç”¨æˆ·ï¼Œç³»ç»Ÿè®¾ç½®ï¼Œæ–‡ä»¶å¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%B3%BB%E7%BB%9F%E7%94%A8%E6%88%B7"><span class="toc-text">1.ç³»ç»Ÿç”¨æˆ·</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%B3%BB%E7%BB%9F%E8%AE%BE%E7%BD%AE"><span class="toc-text">2.ç³»ç»Ÿè®¾ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86"><span class="toc-text">3.æ–‡ä»¶å¤„ç†</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-%E5%A4%84%E7%90%86TODO"><span class="toc-text">16.å¤„ç†TODO</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%AC%AC%E4%B8%80%E4%B8%AATODO"><span class="toc-text">1.ç¬¬ä¸€ä¸ªTODO</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%AC%AC%E4%BA%8C%E4%B8%AATODO"><span class="toc-text">2.ç¬¬äºŒä¸ªTODO</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%AC%AC%E4%B8%89%E4%B8%AATODO"><span class="toc-text">3.ç¬¬ä¸‰ä¸ªTODO</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E7%AC%AC%E5%9B%9B%E4%B8%AATODO"><span class="toc-text">4.ç¬¬å››ä¸ªTODO</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-%E4%BD%BF%E7%94%A8Seata%E8%A7%A3%E5%86%B3%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1"><span class="toc-text">17.ä½¿ç”¨Seataè§£å†³åˆ†å¸ƒå¼äº‹åŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86%EF%BC%8C%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%A4%84%E7%90%86"><span class="toc-text">18.æ–‡ä»¶å¤„ç†ï¼Œå®šæ—¶ä»»åŠ¡å¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-2"><span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88%E6%9C%AC%E5%AE%8C%E7%BB%93"><span class="toc-text">å¾®æœåŠ¡ç‰ˆæœ¬å®Œç»“</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background-color: transparent;"><div id="footer-wrap"><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">æ ¼è¨€ğŸ§¬</p><div class="bg-ad"><div>å†çœ‹çœ‹é‚£ä¸ªå…‰ç‚¹ï¼Œå®ƒå°±åœ¨è¿™é‡Œï¼Œè¿™æ˜¯å®¶å›­ï¼Œè¿™æ˜¯æˆ‘ä»¬ â€”â€” ä½ æ‰€çˆ±çš„æ¯ä¸€ä¸ªäººï¼Œä½ è®¤è¯†çš„ä¸€ä¸ªäººï¼Œä½ å¬è¯´è¿‡çš„æ¯ä¸€ä¸ªäººï¼Œæ›¾ç»æœ‰è¿‡çš„æ¯ä¸€ä¸ªäººï¼Œéƒ½åœ¨å®ƒä¸Šé¢åº¦è¿‡ä»–ä»¬çš„ä¸€ç”Ÿâœ¨</div><div class="btn-xz-box"><a class="btn-xz" target="_blank" rel="noopener" href="https://stellarium.org/">ç‚¹å‡»å¼€å¯æ˜Ÿè¾°ä¹‹æ—…</a></div></div></div><div class="t-t-r"><p class="ft-t t-l-t">çŒœä½ æƒ³çœ‹ğŸ’¡</p><ul class="ft-links"><li><a href="/comments/">ç•™ç‚¹ä»€ä¹ˆ</a><a href="/archives/">æ–‡ç« å½’æ¡£</a></li><li><a href="/categories/">æ–‡ç« åˆ†ç±»</a><a href="/tags/">æ–‡ç« æ ‡ç­¾</a></li><li><a href="/box/Gallery/">æˆ‘çš„ç”»å»Š</a><a href="/personal/bb/">æˆ‘çš„å” å¨</a></li><li><a href="/site/time/">å»ºè®¾è¿›ç¨‹</a><a href="/site/census/">ç½‘ç«™ç»Ÿè®¡</a></li></ul></div></div></div><div class="ft-item-2"><p class="ft-t">æ¨èå‹é“¾âŒ›</p><div class="ft-img-group"><div class="img-group-item"></div></div></div></div><div class="copyright"><span><b>&copy;2022-2025</b></span><span><b>&nbsp;&nbsp;By geqian's BlogğŸ­</b></span></div><div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://icp.gov.moe/?keyword=20230913" style="margin-inline:5px" title="æœ¬ç«™å·²åŠ å…¥èŒICPè±ªåå¥—é¤ï¼ŒèŒICPå¤‡20230913å·"><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/20230913.svg" alt=""/></a></p></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><a class="icon-V hidden" onclick="switchNightMode()" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button><button class="share" type="button" title="å³é”®æ¨¡å¼" onclick="changeMouseMode()"><i class="fas fa-mouse"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog right_side"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button class="share" type="button" title="åˆ†äº«é“¾æ¥" onclick="share()"><i class="fas fa-share-nodes"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i><span id="percent">0<span>%</span></span></button><button id="go-down" type="button" title="ç›´è¾¾åº•éƒ¨" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();"><i class="fa fa-arrow-up"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa fa-copy"></i><span>å¤åˆ¶</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();"><i class="fa fa-search"></i><span>ç™¾åº¦æœç´¢</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();"><i class="fa fa-link"></i><span>è½¬åˆ°é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()"><i class="fa fa-copy"></i><span>ç²˜è´´</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="#post-comment"><i class="fas fa-comment"></i><span>ç©ºé™è¯„è®º</span></a><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()"><i class="fa fa-link"></i><span>å¤åˆ¶æœ¬æ–‡åœ°å€</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>æ–°çª—å£æ‰“å¼€</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()"><i class="fa fa-link"></i><span>è½¬åˆ°é“¾æ¥</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>å¤åˆ¶é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()"><i class="fa fa-download"></i><span>ä¿å­˜å›¾ç‰‡</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>åœ¨æ–°çª—å£æ‰“å¼€</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>å¤åˆ¶å›¾ç‰‡é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:randomPost()"><i class="fa fa-paper-plane"></i><span>éšä¾¿é€›é€›</span></a><a class="rightMenu-item" href="javascript:switchNightMode();"><i class="fa fa-moon"></i><span>æ˜¼å¤œåˆ‡æ¢</span></a><a class="rightMenu-item" href="/personal/about/"><i class="fa fa-info-circle"></i><span>å…³äºåšå®¢</span></a><a class="rightMenu-item" href="javascript:toggleWinbox();"><i class="fas fa-cog"></i><span>ç¾åŒ–è®¾ç½®</span></a><a class="rightMenu-item" href="javascript:rmf.fullScreen();"><i class="fas fa-expand"></i><span>åˆ‡æ¢å…¨å±</span></a><a class="rightMenu-item" href="javascript:window.print();"><i class="fa-solid fa-print"></i><span>æ‰“å°é¡µé¢</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><script async="async">var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())
setTimeout(function(){preloader.endLoading();}, 5000);
document.getElementById('loading-box').addEventListener('click',()=> {preloader.endLoading()})</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: '',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: '',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.staticfile.org/twikoo/1.6.8/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script async src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><script async src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script><script defer type="text/javascript" src="https://cdn1.tianli0.top/npm/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script defer src="https://cdn1.tianli0.top/gh/nextapps-de/winbox/dist/winbox.bundle.min.js"></script><script async src="//at.alicdn.com/t/c/font_3586335_hsivh70x0fm.js"></script><script async src="//at.alicdn.com/t/c/font_3636804_gr02jmjr3y9.js"></script><script async src="//at.alicdn.com/t/c/font_3612150_kfv55xn3u2g.js"></script><script async src="https://cdn.wpon.cn/2022-sucai/Gold-ingot.js"></script><canvas id="universe"></canvas><canvas id="snow"></canvas><script defer src="/js/fomal.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn1.tianli0.top/npm/js-heo@1.0.12/metingjs/Meting.min.js"></script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax","#bibi","body > title","#app","#tag-echarts","#posts-echart","#categories-echarts"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/å­¦ä¹ ç¬”è®°/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¡ geqianã®å­¦ä¹ ç¬”è®° (10)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/æ‚é¡¹/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¼ geqianã®æ‚é¡¹ (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/é¡¹ç›®/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ‰ geqianã®é¡¹ç›®ç¬”è®° (6)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/AI/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¨ geqianã®AIå¤§æ¨¡å‹ (6)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/ç®—æ³•/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸŸ geqianã®ç®—æ³•å­¦ä¹ ç¬”è®° (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/é¢è¯•/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¥ geqianã®é¢è¯• (20)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/JUC/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸŒ geqianã®JUC (4)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/JVM/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸœ geqianã®JVM (5)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/äº‘åŸç”Ÿ/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ” geqianã®äº‘åŸç”Ÿç›¸å…³ (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/MQ/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ“± geqianã®æ¶ˆæ¯é˜Ÿåˆ— (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/å‰ç«¯/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ›ï¸ geqianã®å‰ç«¯å·¥ç¨‹ (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/mybatis-mybatis-plus/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¨ geqianã®mybatisç³»åˆ— (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/å¾®æœåŠ¡/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ—ºï¸ geqianã®SpringCloudç³»åˆ— (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/SSM/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ“– geqianã®SSM+SpringBootç³»åˆ— (7)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/ruoyi/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ“ geqianã®è‹¥ä¾æ¡†æ¶ (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/mysql/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">â“ geqianã®mysql (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/Redis/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ’– geqianã®Redis (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item" style="visibility: hidden"></div><a class="magnet_link_more"  href="https://itgeqian.github.io/categories/" style="flex:1;text-align: center;margin-bottom: 10px;">æŸ¥çœ‹æ›´å¤š...</a></div></div>';
    console.log('å·²æŒ‚è½½magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(33.333333333333336% - 5px);background: #e9e9e9;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: var(--text-bg-hover)}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/71.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/21.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-10-07</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/71.html&quot;);" href="javascript:void(0);" alt="">JVMé¢è¯•é¢˜</a><div class="blog-slider__text">æˆ‘å¯¹JVMçš„ç›¸å…³ç†è§£</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/71.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/60.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/%E5%8F%A4%E9%A3%8E.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-09-30</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/60.html&quot;);" href="javascript:void(0);" alt="">é€Ÿé€šSpring AI Alibaba </a><div class="blog-slider__text">é€Ÿé€šSpring AI Alibaba å®Œç»“</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/60.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/37.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/27.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-04-02</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/37.html&quot;);" href="javascript:void(0);" alt="">GQ Videoå•æœåŠ¡ç‰ˆæœ¬è®°å½•</a><div class="blog-slider__text">GQ Videoå•æœåŠ¡ç‰ˆæœ¬è®°å½•ï¼ˆå®Œæ•´è®°å½•GQ Videoä»0åˆ°1çš„å…¨è®°å½•ï¼‰</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/37.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/74.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/35.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-09-06</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/74.html&quot;);" href="javascript:void(0);" alt="">Mysqlç›¸å…³é¢è¯•é¢˜</a><div class="blog-slider__text">æˆ‘å¯¹mysqlçš„ç›¸å…³ç†è§£</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/74.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/77.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/31.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-10-07</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/77.html&quot;);" href="javascript:void(0);" alt="">javase+é›†åˆç›¸å…³é¢è¯•é¢˜</a><div class="blog-slider__text">æˆ‘å¯¹javaåŸºç¡€å’Œé›†åˆç±»çš„ç›¸å…³ç†è§£</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/77.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/68.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/22.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-10-01</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/68.html&quot;);" href="javascript:void(0);" alt="">JUCé¢è¯•é¢˜</a><div class="blog-slider__text">æˆ‘å¯¹JUCçš„ç†è§£</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/68.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('å·²æŒ‚è½½butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper@1.0.12/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper@1.0.12/lib/swiper_init.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementById('gitZone');
      var item_html = '<div class="recent-post-item" id="gitcalendarBar" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 320px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('å·²æŒ‚è½½gitcalendar')
      }

    if( document.getElementById('gitZone') && (location.pathname ==='/site/census/'|| '/site/census/' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("/api?null",['#d9e0df', '#c6e0dc', '#a8dcd4', '#9adcd2', '#89ded1', '#77e0d0', '#5fdecb', '#47dcc6', '#39dcc3', '#1fdabe', '#00dab9'],'null')
    }
  </script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>