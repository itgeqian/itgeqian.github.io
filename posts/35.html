<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><div id="myscoll"></div><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Redisé¢è¯•ç¯‡ | geqian's BlogğŸ­</title><meta name="keywords" content="Redis"><meta name="author" content="geqian's BlogğŸ­"><meta name="copyright" content="geqian's BlogğŸ­"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="Redisé¢è¯•ç¯‡ï¼ˆè•´å«Redisä¸»ä»ã€Rediså“¨å…µã€Redisåˆ†ç‰‡é›†ç¾¤ã€Redisæ•°æ®ç»“æ„ã€Rediså†…å­˜å›æ”¶ã€Redisç¼“å­˜ä¸€è‡´æ€§ï¼‰">
<meta property="og:type" content="article">
<meta property="og:title" content="Redisé¢è¯•ç¯‡">
<meta property="og:url" content="https://itgeqian.github.io/posts/35.html">
<meta property="og:site_name" content="geqian&#39;s BlogğŸ­">
<meta property="og:description" content="Redisé¢è¯•ç¯‡ï¼ˆè•´å«Redisä¸»ä»ã€Rediså“¨å…µã€Redisåˆ†ç‰‡é›†ç¾¤ã€Redisæ•°æ®ç»“æ„ã€Rediså†…å­˜å›æ”¶ã€Redisç¼“å­˜ä¸€è‡´æ€§ï¼‰">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp">
<meta property="article:published_time" content="2025-08-07T00:19:03.000Z">
<meta property="article:modified_time" content="2025-08-08T11:12:00.000Z">
<meta property="article:author" content="geqian&#39;s BlogğŸ­">
<meta property="article:tag" content="Redis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp"><link rel="shortcut icon" href="/"><link rel="canonical" href="https://itgeqian.github.io/posts/35"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.js',
      css: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Redisé¢è¯•ç¯‡',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-08-08 19:12:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><style id="themeColor"></style><style id="rightSide"></style><style id="transPercent"></style><style id="blurNum"></style><style id="settingStyle"></style><span id="fps"></span><style id="defineBg"></style><style id="menu_shadow"></style><script src="https://cdn.jsdelivr.net/npm/echarts@6/dist/echarts.min.js"></script><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper@1.0.12/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper@1.0.12/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="geqian's BlogğŸ­" type="application/atom+xml">
</head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/assets/avatar.png" onerror="onerror=null;src='/assets/r1.jpg'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">81</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">51</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">18</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--article"></use></svg><span class="menu_word" style="font-size:17px"> æ–‡ç« </span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> å½’æ¡£</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> æ ‡ç­¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei">                   </use></svg><span class="menu_word" style="font-size:17px"> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pinweishenghuo"></use></svg><span class="menu_word" style="font-size:17px"> ä¼‘é—²</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/life/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-yinle">                   </use></svg><span class="menu_word" style="font-size:17px"> å…«éŸ³ç›’</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-dianying1">                   </use></svg><span class="menu_word" style="font-size:17px"> å½±é™¢</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-youxishoubing">                   </use></svg><span class="menu_word" style="font-size:17px"> æ¸¸æˆ</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xiangzi"></use></svg><span class="menu_word" style="font-size:17px"> å…«å®ç®±</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/box/gallery/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-tubiaozhizuomoban">                   </use></svg><span class="menu_word" style="font-size:17px"> ç”»å»Š</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/animation/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-nvwumao">                   </use></svg><span class="menu_word" style="font-size:17px"> åŠ¨ç”»</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-zhifengche">                   </use></svg><span class="menu_word" style="font-size:17px"> ç½‘å€å¯¼èˆª</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> ç¤¾äº¤</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pengyouquan">                   </use></svg><span class="menu_word" style="font-size:17px"> æœ‹å‹åœˆ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> ç•™è¨€æ¿</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> å‹äººå¸</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangye"></use></svg><span class="menu_word" style="font-size:17px"> ç½‘ç«™</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/site/census/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--tongjibiao">                   </use></svg><span class="menu_word" style="font-size:17px"> ç½‘ç«™ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujutongji1">                   </use></svg><span class="menu_word" style="font-size:17px"> æ–‡ç« ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/time/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xianxingshalou">                   </use></svg><span class="menu_word" style="font-size:17px"> æ—§æ—¶å…‰</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">geqian's BlogğŸ­</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--article"></use></svg><span class="menu_word" style="font-size:17px"> æ–‡ç« </span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> å½’æ¡£</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> æ ‡ç­¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei">                   </use></svg><span class="menu_word" style="font-size:17px"> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pinweishenghuo"></use></svg><span class="menu_word" style="font-size:17px"> ä¼‘é—²</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/life/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-yinle">                   </use></svg><span class="menu_word" style="font-size:17px"> å…«éŸ³ç›’</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-dianying1">                   </use></svg><span class="menu_word" style="font-size:17px"> å½±é™¢</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-youxishoubing">                   </use></svg><span class="menu_word" style="font-size:17px"> æ¸¸æˆ</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xiangzi"></use></svg><span class="menu_word" style="font-size:17px"> å…«å®ç®±</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/box/gallery/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-tubiaozhizuomoban">                   </use></svg><span class="menu_word" style="font-size:17px"> ç”»å»Š</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/animation/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-nvwumao">                   </use></svg><span class="menu_word" style="font-size:17px"> åŠ¨ç”»</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-zhifengche">                   </use></svg><span class="menu_word" style="font-size:17px"> ç½‘å€å¯¼èˆª</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> ç¤¾äº¤</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pengyouquan">                   </use></svg><span class="menu_word" style="font-size:17px"> æœ‹å‹åœˆ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> ç•™è¨€æ¿</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> å‹äººå¸</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangye"></use></svg><span class="menu_word" style="font-size:17px"> ç½‘ç«™</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/site/census/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--tongjibiao">                   </use></svg><span class="menu_word" style="font-size:17px"> ç½‘ç«™ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujutongji1">                   </use></svg><span class="menu_word" style="font-size:17px"> æ–‡ç« ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/time/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xianxingshalou">                   </use></svg><span class="menu_word" style="font-size:17px"> æ—§æ—¶å…‰</span></a></li></ul></div></div><center id="name-container"><a id="page-name" href="javascript:scrollToTop()">PAGE_NAME</a></center><div id="nav-right"><div id="search-button"><a class="search faa-parent animated-hover" title="æ£€ç´¢ç«™å†…ä»»ä½•ä½ æƒ³è¦çš„ä¿¡æ¯"><svg class="faa-tada icon" style="height:24px;width:24px;fill:currentColor;position:relative;top:6px" aria-hidden="true"><use xlink:href="#icon-valentine_-search-love-find-heart"></use></svg><span> æœç´¢</span></a></div><a class="meihua faa-parent animated-hover" onclick="toggleWinbox()" title="ç¾åŒ–è®¾ç½®-è‡ªå®šä¹‰ä½ çš„é£æ ¼" id="meihua-button"><svg class="faa-tada icon" style="height:26px;width:26px;fill:currentColor;position:relative;top:8px" aria-hidden="true"><use xlink:href="#icon-tupian1"></use></svg></a><a class="sun_moon faa-parent animated-hover" onclick="switchNightMode()" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢" id="nightmode-button"><svg class="faa-tada" style="height:25px;width:25px;fill:currentColor;position:relative;top:7px" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon">       </use></svg></a><div id="toggle-menu"><a><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-info"><h1 class="post-title">Redisé¢è¯•ç¯‡</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><svg class="meta_icon post-meta-icon" style="width:30px;height:30px;position:relative;top:10px"><use xlink:href="#icon-rili"></use></svg><span class="post-meta-label">å‘è¡¨äº </span><time class="post-meta-date-created" datetime="2025-08-07T00:19:03.000Z" title="å‘è¡¨äº 2025-08-07 08:19:03">2025-08-07</time><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-gengxin1"></use></svg><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-08-08T11:12:00.000Z" title="æ›´æ–°äº 2025-08-08 19:12:00">2025-08-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-biaoqian"></use></svg><a class="post-meta-categories" href="/categories/Redis/">Redis</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:8px"><use xlink:href="#icon-charuword"></use></svg><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">1.7w</span><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:20px;height:20px;position:relative;top:5px"><use xlink:href="#icon-shizhong"></use></svg><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>58åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Redisé¢è¯•ç¯‡"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:5px"><use xlink:href="#icon-eye"></use></svg><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>Redisé«˜çº§ï¼š</p>
<ul>
<li>Redisä¸»ä»</li>
<li>Rediså“¨å…µ</li>
<li>Redisåˆ†ç‰‡é›†ç¾¤</li>
<li>Redisæ•°æ®ç»“æ„</li>
<li>Rediså†…å­˜å›æ”¶</li>
<li>Redisç¼“å­˜ä¸€è‡´æ€§</li>
</ul>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-397.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-398.png" alt="img"></p>
<h2 id="1-Redisä¸»ä»"><a href="#1-Redisä¸»ä»" class="headerlink" title="1.Redisä¸»ä»"></a>1.Redisä¸»ä»</h2><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-404-1024x343.png" alt="img"></p>
<h3 id="1-1-ä¸»ä»é›†ç¾¤ç»“æ„"><a href="#1-1-ä¸»ä»é›†ç¾¤ç»“æ„" class="headerlink" title="1.1.ä¸»ä»é›†ç¾¤ç»“æ„"></a>1.1.ä¸»ä»é›†ç¾¤ç»“æ„</h3><p>ä¸‹å›¾å°±æ˜¯ä¸€ä¸ªç®€å•çš„Redisä¸»ä»é›†ç¾¤ç»“æ„ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-399-1024x452.png" alt="img"></p>
<ul>
<li>ä¸€ä¸»ä¸¤ä»ï¼ˆr1 æ˜¯ masterï¼Œr2 å’Œ r3 æ˜¯ slaveï¼‰</li>
<li>å†™æ•°æ®å‘ç»™ masterï¼Œmaster è‡ªåŠ¨åŒæ­¥ç»™ slave</li>
<li>è¯»è¯·æ±‚ä¼˜å…ˆå‘å¾€ slaveï¼Œå‡è½» master å‹åŠ›ï¼Œå®ç° <strong>è¯»å†™åˆ†ç¦»</strong></li>
</ul>
<h3 id="1-2-æ­å»ºä¸»ä»é›†ç¾¤"><a href="#1-2-æ­å»ºä¸»ä»é›†ç¾¤" class="headerlink" title="1.2.æ­å»ºä¸»ä»é›†ç¾¤"></a>1.2.æ­å»ºä¸»ä»é›†ç¾¤</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-400-1024x281.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-401-1024x231.png" alt="img"></p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">version:</span> <span class="string">&quot;3.2&quot;</span></span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">services:</span></span><br><span class="line"><span class="symbol">  r1:</span></span><br><span class="line"><span class="symbol">    image:</span> redis</span><br><span class="line"><span class="symbol">    container_name:</span> r1</span><br><span class="line"><span class="symbol">    network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line"><span class="symbol">    entrypoint:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;7001&quot;</span>]</span><br><span class="line"><span class="symbol">  r2:</span></span><br><span class="line"><span class="symbol">    image:</span> redis</span><br><span class="line"><span class="symbol">    container_name:</span> r2</span><br><span class="line"><span class="symbol">    network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line"><span class="symbol">    entrypoint:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;7002&quot;</span>]</span><br><span class="line"><span class="symbol">  r3:</span></span><br><span class="line"><span class="symbol">    image:</span> redis</span><br><span class="line"><span class="symbol">    container_name:</span> r3</span><br><span class="line"><span class="symbol">    network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line"><span class="symbol">    entrypoint:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;7003&quot;</span>]</span><br></pre></td></tr></table></figure>
<p>ä¸Šä¼ è‡³è™šæ‹Ÿæœºçš„<code>/root/redis</code>ç›®å½•ä¸‹</p>
<p>åŠ è½½ redis é•œåƒ</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker load -<span class="selector-tag">i</span> redis<span class="selector-class">.tar</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œå‘½ä»¤ï¼Œåå°å¯åŠ¨é›†ç¾¤ï¼š</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker compose up -d</span></span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-402-1024x763.png" alt="img"></p>
<h4 id="å»ºç«‹é›†ç¾¤"><a href="#å»ºç«‹é›†ç¾¤" class="headerlink" title="å»ºç«‹é›†ç¾¤"></a>å»ºç«‹é›†ç¾¤</h4><p>æˆ‘ä»¬å¯åŠ¨äº†3ä¸ªRediså®ä¾‹ï¼Œä½†æ˜¯å®ƒä»¬å¹¶æ²¡æœ‰å½¢æˆä¸»ä»å…³ç³»ã€‚æˆ‘ä»¬éœ€è¦é€šè¿‡å‘½ä»¤æ¥é…ç½®ä¸»ä»å…³ç³»ï¼š</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Redis5.0ä»¥å‰</span></span><br><span class="line">slaveof <span class="variable">&lt;masterip&gt;</span> <span class="variable">&lt;masterport&gt;</span></span><br><span class="line"><span class="comment"># Redis5.0ä»¥å</span></span><br><span class="line">replicaof <span class="variable">&lt;masterip&gt;</span> <span class="variable">&lt;masterport&gt;</span></span><br></pre></td></tr></table></figure>
<p>æœ‰ä¸´æ—¶å’Œæ°¸ä¹…ä¸¤ç§æ¨¡å¼ï¼š</p>
<ul>
<li>æ°¸ä¹…ç”Ÿæ•ˆï¼šåœ¨redis.confæ–‡ä»¶ä¸­åˆ©ç”¨<code>slaveof</code>å‘½ä»¤æŒ‡å®š<code>master</code>èŠ‚ç‚¹</li>
<li>ä¸´æ—¶ç”Ÿæ•ˆï¼šç›´æ¥åˆ©ç”¨redis-cliæ§åˆ¶å°è¾“å…¥<code>slaveof</code>å‘½ä»¤ï¼ŒæŒ‡å®š<code>master</code>èŠ‚ç‚¹</li>
</ul>
<p>æˆ‘ä»¬æµ‹è¯•ä¸´æ—¶æ¨¡å¼ï¼Œé¦–å…ˆè¿æ¥<code>r2</code>ï¼Œè®©å…¶ä»¥<code>r1</code>ä¸ºmaster</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿æ¥r2</span></span><br><span class="line"><span class="attribute">docker</span> exec -it r2 redis-cli -p <span class="number">7002</span></span><br><span class="line"><span class="comment"># è®¤r1ä¸»ï¼Œä¹Ÿå°±æ˜¯7001</span></span><br><span class="line"><span class="attribute">slaveof</span> <span class="number">192.168.150.101</span> <span class="number">7001</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åè¿æ¥<code>r3</code>ï¼Œè®©å…¶ä»¥<code>r1</code>ä¸ºmaster</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿æ¥r3</span></span><br><span class="line"><span class="attribute">docker</span> exec -it r3 redis-cli -p <span class="number">7003</span></span><br><span class="line"><span class="comment"># è®¤r1ä¸»ï¼Œä¹Ÿå°±æ˜¯7001</span></span><br><span class="line"><span class="attribute">slaveof</span> <span class="number">192.168.150.101</span> <span class="number">7001</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åè¿æ¥<code>r1</code>ï¼ŒæŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># è¿æ¥r1</span></span><br><span class="line">docker exec -it <span class="built_in">r1</span> redis-<span class="keyword">cli</span> -p <span class="number">7001</span></span><br><span class="line"><span class="meta"># æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</span></span><br><span class="line">info replication</span><br></pre></td></tr></table></figure>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">7001</span>&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line"><span class="attribute">role</span>:master</span><br><span class="line"><span class="attribute">connected_slaves</span>:<span class="number">2</span></span><br><span class="line"><span class="attribute">slave0</span>:ip=<span class="number">192.168.150.101</span>,port=<span class="number">7002</span>,state=online,offset=<span class="number">140</span>,lag=<span class="number">1</span></span><br><span class="line"><span class="attribute">slave1</span>:ip=<span class="number">192.168.150.101</span>,port=<span class="number">7003</span>,state=online,offset=<span class="number">140</span>,lag=<span class="number">1</span></span><br><span class="line"><span class="attribute">master_failover_state</span>:no-failover</span><br><span class="line"><span class="attribute">master_replid</span>:<span class="number">16</span>d90568498908b322178ca12078114e6c518b86</span><br><span class="line"><span class="attribute">master_replid2</span>:<span class="number">0000000000000000000000000000000000000000</span></span><br><span class="line"><span class="attribute">master_repl_offset</span>:<span class="number">140</span></span><br><span class="line"><span class="attribute">second_repl_offset</span>:-<span class="number">1</span></span><br><span class="line"><span class="attribute">repl_backlog_active</span>:<span class="number">1</span></span><br><span class="line"><span class="attribute">repl_backlog_size</span>:<span class="number">1048576</span></span><br><span class="line"><span class="attribute">repl_backlog_first_byte_offset</span>:<span class="number">1</span></span><br><span class="line"><span class="attribute">repl_backlog_histlen</span>:<span class="number">140</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå½“å‰èŠ‚ç‚¹<code>r1:7001</code>çš„è§’è‰²æ˜¯<code>master</code>ï¼Œæœ‰ä¸¤ä¸ªslaveä¸å…¶è¿æ¥ï¼š</p>
<ul>
<li><code>slave0</code>ï¼š<code>port</code>æ˜¯<code>7002</code>ï¼Œä¹Ÿå°±æ˜¯<code>r2</code>èŠ‚ç‚¹</li>
<li><code>slave1</code>ï¼š<code>port</code>æ˜¯<code>7003</code>ï¼Œä¹Ÿå°±æ˜¯<code>r3</code>èŠ‚ç‚¹</li>
</ul>
<h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>ä¾æ¬¡åœ¨<code>r1</code>ã€<code>r2</code>ã€<code>r3</code>èŠ‚ç‚¹ä¸Šæ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="built_in">num</span> <span class="number">123</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">get</span> <span class="built_in">num</span></span><br></pre></td></tr></table></figure>
<p>ç»“è®ºï¼š</p>
<ul>
<li>r1 èƒ½å†™ï¼ˆsetï¼‰</li>
<li>r2ã€r3 åªèƒ½è¯»ï¼ˆgetï¼‰</li>
</ul>
<p>è¡¨æ˜ä¸»ä»åŒæ­¥æˆåŠŸï¼Œå¹¶å®ç°äº†<strong>è¯»å†™åˆ†ç¦»</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>åˆ†ç±»</th>
<th>å»¶è¿Ÿ</th>
<th>è¯»å†™åˆ†ç¦»</th>
<th>é«˜å¯ç”¨</th>
<th>æ˜“äºæ­å»º</th>
</tr>
</thead>
<tbody>
<tr>
<td>å•èŠ‚ç‚¹</td>
<td>âŒ</td>
<td>âŒ</td>
<td>âŒ</td>
<td>âœ…</td>
</tr>
<tr>
<td>ä¸»ä»æ¶æ„</td>
<td>âœ…ï¼ˆå†™ masterã€è¯» slaveï¼‰</td>
<td>âœ…</td>
<td>âŒï¼ˆä¸»æŒ‚äº†æ— æ³•è‡ªåŠ¨åˆ‡æ¢ï¼‰</td>
<td>âœ…</td>
</tr>
<tr>
<td>å“¨å…µæ¨¡å¼</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âœ…ï¼ˆè‡ªåŠ¨åˆ‡æ¢ä¸»èŠ‚ç‚¹ï¼‰</td>
<td>âš ï¸</td>
</tr>
<tr>
<td>é›†ç¾¤æ¨¡å¼</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âœ…ï¼ˆæ•°æ®åˆ†ç‰‡+å†—ä½™ï¼‰</td>
<td>âŒï¼ˆå¤æ‚ï¼‰</td>
</tr>
</tbody>
</table>
</div>
<h3 id="1-3-ä¸»ä»åŒæ­¥åŸç†"><a href="#1-3-ä¸»ä»åŒæ­¥åŸç†" class="headerlink" title="1.3.ä¸»ä»åŒæ­¥åŸç†"></a>1.3.ä¸»ä»åŒæ­¥åŸç†</h3><p>åœ¨åˆšæ‰çš„ä¸»ä»æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬å‘ç°<code>r1</code>ä¸Šå†™å…¥Redisçš„æ•°æ®ï¼Œåœ¨<code>r2</code>å’Œ<code>r3</code>ä¸Šä¹Ÿèƒ½çœ‹åˆ°ï¼Œè¿™è¯´æ˜ä¸»ä»ä¹‹é—´ç¡®å®å®Œæˆäº†æ•°æ®åŒæ­¥ã€‚</p>
<p>é‚£ä¹ˆè¿™ä¸ªåŒæ­¥æ˜¯å¦‚ä½•å®Œæˆçš„å‘¢ï¼Ÿ</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-405-1024x501.png" alt="img"></p>
<h4 id="1-3-1-å…¨é‡åŒæ­¥"><a href="#1-3-1-å…¨é‡åŒæ­¥" class="headerlink" title="1.3.1.å…¨é‡åŒæ­¥"></a>1.3.1.å…¨é‡åŒæ­¥</h4><p>å…¨é‡åŒæ­¥æ˜¯Redis ä¸»ä»åŒæ­¥ä¸­æœ€å…³é”®çš„åŸºç¡€æµç¨‹ï¼Œå°¤å…¶æ˜¯åœ¨ <strong>ç¬¬ä¸€æ¬¡å»ºç«‹ä¸»ä»å…³ç³»</strong>æ—¶ã€‚</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-410-1024x179.png" alt="img"></p>
<ul>
<li>bgsaveæ˜¯åå°æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ‰§è¡Œåä¼šå°†redisåœ¨å†…å­˜ä¸­çš„æ‰€æœ‰æ•°æ®æŒä¹…åŒ–åˆ°ç¡¬ç›˜ä¸­ï¼Œä¿å­˜åˆ°RDBæ–‡ä»¶</li>
<li>repl_baklogä¸­å­˜æ”¾çš„æ˜¯æ‰€æœ‰masteræ‰§è¡Œçš„å‘½ä»¤ï¼Œç”¨äºç»™salveèŠ‚ç‚¹å‘é€æœªæ”¶åˆ°çš„å‘½ä»¤</li>
</ul>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œ<code>master</code>å¦‚ä½•å¾—çŸ¥<code>salve</code>æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡æ¥åŒæ­¥å‘¢ï¼Ÿ</p>
<p>æœ‰å‡ ä¸ªæ¦‚å¿µï¼Œå¯ä»¥ä½œä¸ºåˆ¤æ–­ä¾æ®ï¼š</p>
<ul>
<li><strong><code>Replication Id</code></strong>ï¼šç®€ç§°<code>replid</code>ï¼Œæ˜¯æ•°æ®é›†çš„æ ‡è®°ï¼Œreplidä¸€è‡´åˆ™æ˜¯åŒä¸€æ•°æ®é›†ã€‚æ¯ä¸ª<code>master</code>éƒ½æœ‰å”¯ä¸€çš„<code>replid</code>ï¼Œ<code>slave</code>åˆ™ä¼šç»§æ‰¿<code>master</code>èŠ‚ç‚¹çš„<code>replid</code>ï¼ˆæ ¹æ®replidæ˜¯å¦ä¸€è‡´æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯ç¬¬ä¸€æ¬¡åŒæ­¥ï¼šå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡åŒæ­¥ï¼Œä¸»ä»èŠ‚ç‚¹çš„replidä¸åŒï¼Œå¦‚æœæ˜¯æ–­å¼€é‡è¿ï¼Œä¸»ä»èŠ‚ç‚¹çš„replidç›¸åŒï¼‰</li>
<li><strong><code>offset</code></strong>ï¼šåç§»é‡ï¼Œéšç€è®°å½•åœ¨<code>repl_baklog</code>ä¸­çš„æ•°æ®å¢å¤šè€Œé€æ¸å¢å¤§ã€‚<code>slave</code>å®ŒæˆåŒæ­¥æ—¶ä¹Ÿä¼šè®°å½•å½“å‰åŒæ­¥çš„<code>offset</code>ã€‚å¦‚æœ<code>slave</code>çš„<code>offset</code>å°äº<code>master</code>çš„<code>offset</code>ï¼Œè¯´æ˜<code>slave</code>æ•°æ®è½åäº<code>master</code>ï¼Œéœ€è¦æ›´æ–°ã€‚</li>
</ul>
<h5 id="å…¨é‡åŒæ­¥çš„è§¦å‘æ—¶æœº"><a href="#å…¨é‡åŒæ­¥çš„è§¦å‘æ—¶æœº" class="headerlink" title="å…¨é‡åŒæ­¥çš„è§¦å‘æ—¶æœº"></a>å…¨é‡åŒæ­¥çš„è§¦å‘æ—¶æœº</h5><p>ä¸»ä»å»ºç«‹è¿æ¥åï¼Œä»èŠ‚ç‚¹ä¼šå‘ä¸»èŠ‚ç‚¹å‘é€åŒæ­¥è¯·æ±‚ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š</p>
<ul>
<li>è‡ªå·±å½“å‰çš„ <code>replication id</code>ï¼ˆreplidï¼‰</li>
<li>å½“å‰çš„ <code>offset</code></li>
</ul>
<p>ä¸»èŠ‚ç‚¹æ®æ­¤åˆ¤æ–­æ˜¯å¦å¯ä»¥è¿›è¡Œ<strong>å¢é‡åŒæ­¥</strong>ã€‚å¦‚æœä»¥ä¸‹ä»»ä¸€æƒ…å†µæ»¡è¶³ï¼Œå°±ä¼šè§¦å‘å…¨é‡åŒæ­¥ï¼š</p>
<ol>
<li><strong>ä¸»ä» <code>replid</code> ä¸ä¸€è‡´</strong> â†’ æ„å‘³ç€è¿™æ˜¯ä¸€ä¸ªæ–°çš„ slaveï¼Œå¿…é¡»è¿›è¡Œå…¨é‡åŒæ­¥ã€‚</li>
<li><strong>ä»èŠ‚ç‚¹ <code>offset</code> å¤ªæ—§ï¼Œä¸»èŠ‚ç‚¹ <code>backlog</code> å·²æ— æ³•æ»¡è¶³å¢é‡éœ€æ±‚</strong> â†’ åªèƒ½å…¨é‡åŒæ­¥ã€‚</li>
</ol>
<p>å› æ­¤ï¼Œ<strong>masteråˆ¤æ–­ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡åŒæ­¥çš„ä¾æ®ï¼Œå°±æ˜¯çœ‹replidæ˜¯å¦ä¸€è‡´</strong>ã€‚æµç¨‹å¦‚å›¾ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-407-1024x516.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-411.png" alt="img"></p>
<p>å®Œæ•´æµç¨‹æè¿°ï¼š</p>
<ul>
<li><code>slave</code>èŠ‚ç‚¹è¯·æ±‚å¢é‡åŒæ­¥</li>
<li><code>master</code>èŠ‚ç‚¹åˆ¤æ–­<code>replid</code>ï¼Œå‘ç°ä¸ä¸€è‡´ï¼Œæ‹’ç»å¢é‡åŒæ­¥</li>
<li><code>master</code>å°†å®Œæ•´å†…å­˜æ•°æ®ç”Ÿæˆ<code>RDB</code>ï¼ˆRedis Database Backup fileæ˜¯Redisæ•°æ®æŒä¹…åŒ–çš„ä¸€ç§æ–¹å¼ï¼Œä¹Ÿè¢«ç§°ä¸ºRedisæ•°æ®å¿«ç…§ï¼‰ï¼Œå‘é€<code>RDB</code>åˆ°<code>slave</code></li>
<li><code>slave</code>æ¸…ç©ºæœ¬åœ°æ•°æ®ï¼ŒåŠ è½½<code>master</code>çš„<code>RDB</code></li>
<li><code>master</code>å°†<code>RDB</code>æœŸé—´çš„å‘½ä»¤è®°å½•åœ¨<code>repl_baklog</code>ï¼Œå¹¶æŒç»­å°†logä¸­çš„å‘½ä»¤å‘é€ç»™<code>slave</code></li>
<li><code>slave</code>æ‰§è¡Œæ¥æ”¶åˆ°çš„å‘½ä»¤ï¼Œä¿æŒä¸<code>master</code>ä¹‹é—´çš„åŒæ­¥</li>
</ul>
<p>æ¥çœ‹ä¸‹<code>r1</code>èŠ‚ç‚¹çš„è¿è¡Œæ—¥å¿—ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-408-1024x548.png" alt="img"></p>
<p>å†çœ‹ä¸‹<code>r2</code>èŠ‚ç‚¹æ‰§è¡Œ<code>replicaof</code>å‘½ä»¤æ—¶çš„æ—¥å¿—ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-409-1024x808.png" alt="img"></p>
<p>ä»æ—¥å¿—ä¹Ÿå¯ä»¥çœ‹å‡ºï¼š</p>
<ul>
<li><code>Master</code> æ—¥å¿—ä¼šæ˜¾ç¤ºå¯åŠ¨äº† <code>bgsave</code>ã€‚</li>
<li><code>Slave</code> æ—¥å¿—ä¼šæ˜¾ç¤ºåŠ è½½äº† <code>RDB</code> æ–‡ä»¶ã€‚</li>
<li>åŒæ­¥å®Œæˆåä¸¤è€… <code>replid</code> ä¸€è‡´ï¼Œå¯ä»¥è¿›è¡Œå¢é‡åŒæ­¥ã€‚</li>
</ul>
<p>ä¸æˆ‘ä»¬æè¿°çš„å®Œå…¨ä¸€è‡´ã€‚</p>
<h5 id="æ ¸å¿ƒæ•°æ®ç»“æ„è¯´æ˜"><a href="#æ ¸å¿ƒæ•°æ®ç»“æ„è¯´æ˜" class="headerlink" title="æ ¸å¿ƒæ•°æ®ç»“æ„è¯´æ˜"></a>æ ¸å¿ƒæ•°æ®ç»“æ„è¯´æ˜</h5><div class="table-container">
<table>
<thead>
<tr>
<th>æ¦‚å¿µ</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>replid</code></td>
<td>Master çš„å”¯ä¸€æ ‡è¯†ï¼ˆæ•°æ®é›†å”¯ä¸€æ€§ï¼‰</td>
</tr>
<tr>
<td><code>offset</code></td>
<td>åŒæ­¥åç§»é‡ï¼Œè®°å½•åŒæ­¥åˆ°å“ªäº†</td>
</tr>
<tr>
<td><code>repl_backlog</code></td>
<td>ä¸»èŠ‚ç‚¹çš„å‘½ä»¤ç¼“å­˜æ—¥å¿—ï¼Œä¿å­˜æœ€è¿‘å†™å‘½ä»¤ï¼Œç”¨äºå¢é‡åŒæ­¥</td>
</tr>
<tr>
<td><code>RDB</code></td>
<td>Redis å¿«ç…§æŒä¹…åŒ–æ–‡ä»¶ï¼ŒåŒ…å«å…¨é‡æ•°æ®</td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>å…¨é‡åŒæ­¥</td>
<td>ç¬¬ä¸€æ¬¡è¿æ¥ï¼Œæˆ–ä¸¢å¤±å¤ªå¤šæ•°æ®ï¼›æ¸…ç©ºæ•°æ® â†’ åŠ è½½ RDB â†’ æ‰§è¡Œ backlog</td>
</tr>
<tr>
<td>å¢é‡åŒæ­¥</td>
<td><code>replid</code> ä¸€è‡´ + offset å¯ç»­æ¥ï¼Œç›´æ¥å‘é€ backlog ä¸­ç¼ºå¤±å‘½ä»¤å³å¯</td>
</tr>
</tbody>
</table>
</div>
<h4 id="1-3-2-å¢é‡åŒæ­¥"><a href="#1-3-2-å¢é‡åŒæ­¥" class="headerlink" title="1.3.2.å¢é‡åŒæ­¥"></a>1.3.2.å¢é‡åŒæ­¥</h4><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-419-1024x322.png" alt="img"></p>
<p>å…¨é‡åŒæ­¥éœ€è¦å…ˆåšRDBï¼Œç„¶åå°†RDBæ–‡ä»¶é€šè¿‡ç½‘ç»œä¼ è¾“ç»™slaveï¼Œæˆæœ¬å¤ªé«˜äº†ã€‚å› æ­¤é™¤äº†ç¬¬ä¸€æ¬¡åšå…¨é‡åŒæ­¥ï¼Œå…¶å®ƒå¤§å¤šæ•°æ—¶å€™slaveä¸masteréƒ½æ˜¯åš<strong>å¢é‡åŒæ­¥</strong>ã€‚</p>
<p>ä»€ä¹ˆæ˜¯å¢é‡åŒæ­¥ï¼Ÿå°±æ˜¯åªæ›´æ–°slaveä¸masterå­˜åœ¨å·®å¼‚çš„éƒ¨åˆ†æ•°æ®ã€‚å¦‚å›¾ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-412-1024x439.png" alt="img"></p>
<p>é‚£ä¹ˆmasteræ€ä¹ˆçŸ¥é“slaveä¸è‡ªå·±çš„æ•°æ®å·®å¼‚åœ¨å“ªé‡Œå‘¢?</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-420.png" alt="img"></p>
<h4 id="1-3-3-repl-baklogåŸç†"><a href="#1-3-3-repl-baklogåŸç†" class="headerlink" title="1.3.3.repl_baklogåŸç†"></a>1.3.3.repl_baklogåŸç†</h4><p>masteræ€ä¹ˆçŸ¥é“slaveä¸è‡ªå·±çš„æ•°æ®å·®å¼‚åœ¨å“ªé‡Œå‘¢?</p>
<p>è¿™å°±è¦è¯´åˆ°å…¨é‡åŒæ­¥æ—¶çš„<code>repl_baklog</code>æ–‡ä»¶äº†ã€‚è¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„æ•°ç»„ï¼Œåªä¸è¿‡æ•°ç»„æ˜¯ç¯å½¢ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>è§’æ ‡åˆ°è¾¾æ•°ç»„æœ«å°¾åï¼Œä¼šå†æ¬¡ä»0å¼€å§‹è¯»å†™</strong>ï¼Œè¿™æ ·æ•°ç»„å¤´éƒ¨çš„æ•°æ®å°±ä¼šè¢«è¦†ç›–ã€‚</p>
<p><code>repl_baklog</code>ä¸­ä¼šè®°å½•Rediså¤„ç†è¿‡çš„å‘½ä»¤åŠ<code>offset</code>ï¼ŒåŒ…æ‹¬masterå½“å‰çš„<code>offset</code>ï¼Œå’Œslaveå·²ç»æ‹·è´åˆ°çš„<code>offset</code>ï¼ˆå°†slaveçš„offsetå­˜å…¥å…¶ä¸­,æ ‡è®°èµ·æ¥,å†æ¬¡å¢é‡åŒæ­¥æŸ¥æ‰¾slave,å¦‚æœæ‰¾ä¸åˆ°å°±è¿›è¡Œå…¨é‡åŒæ­¥ï¼‰ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-413.png" alt="img"></p>
<p>slaveä¸masterçš„offsetä¹‹é—´çš„å·®å¼‚ï¼Œå°±æ˜¯salveéœ€è¦å¢é‡æ‹·è´çš„æ•°æ®äº†ã€‚</p>
<p>éšç€ä¸æ–­æœ‰æ•°æ®å†™å…¥ï¼Œmasterçš„offseté€æ¸å˜å¤§ï¼Œslaveä¹Ÿä¸æ–­çš„æ‹·è´ï¼Œè¿½èµ¶masterçš„offsetï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-414.png" alt="img"></p>
<p>ç›´åˆ°æ•°ç»„è¢«å¡«æ»¡ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-415.png" alt="img"></p>
<p>æ­¤æ—¶ï¼Œå¦‚æœæœ‰æ–°çš„æ•°æ®å†™å…¥ï¼Œå°±ä¼šè¦†ç›–æ•°ç»„ä¸­çš„æ—§æ•°æ®ã€‚ä¸è¿‡ï¼Œæ—§çš„æ•°æ®åªè¦æ˜¯ç»¿è‰²çš„ï¼Œè¯´æ˜æ˜¯å·²ç»è¢«åŒæ­¥åˆ°slaveçš„æ•°æ®ï¼Œå³ä¾¿è¢«è¦†ç›–äº†ä¹Ÿæ²¡ä»€ä¹ˆå½±å“ã€‚å› ä¸ºæœªåŒæ­¥çš„ä»…ä»…æ˜¯çº¢è‰²éƒ¨åˆ†ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-416.png" alt="img"></p>
<p>ä½†æ˜¯ï¼Œå¦‚æœslaveå‡ºç°ç½‘ç»œé˜»å¡ï¼Œå¯¼è‡´masterçš„<code>offset</code>è¿œè¿œè¶…è¿‡äº†slaveçš„<code>offset</code>ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-417.png" alt="img"></p>
<p>å¦‚æœmasterç»§ç»­å†™å…¥æ–°æ•°æ®ï¼Œmasterçš„<code>offset</code>å°±ä¼šè¦†ç›–<code>repl_baklog</code>ä¸­æ—§çš„æ•°æ®ï¼Œç›´åˆ°å°†slaveç°åœ¨çš„<code>offset</code>ä¹Ÿè¦†ç›–ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-418.png" alt="img"></p>
<p>æ£•è‰²æ¡†ä¸­çš„çº¢è‰²éƒ¨åˆ†ï¼Œå°±æ˜¯å°šæœªåŒæ­¥ï¼Œä½†æ˜¯å´å·²ç»è¢«è¦†ç›–çš„æ•°æ®ã€‚æ­¤æ—¶å¦‚æœslaveæ¢å¤ï¼Œéœ€è¦åŒæ­¥ï¼Œå´å‘ç°è‡ªå·±çš„<code>offset</code>éƒ½æ²¡æœ‰äº†ï¼Œæ— æ³•å®Œæˆå¢é‡åŒæ­¥äº†ã€‚åªèƒ½åš<strong>å…¨é‡åŒæ­¥</strong>ã€‚</p>
<p><code>repl_baklog</code>å¤§å°æœ‰ä¸Šé™ï¼Œå†™æ»¡åä¼šè¦†ç›–æœ€æ—©çš„æ•°æ®ã€‚å¦‚æœslaveæ–­å¼€æ—¶é—´è¿‡ä¹…ï¼Œå¯¼è‡´å°šæœªå¤‡ä»½çš„æ•°æ®è¢«è¦†ç›–ï¼Œåˆ™æ— æ³•åŸºäº<code>repl_baklog</code>åšå¢é‡åŒæ­¥ï¼Œåªèƒ½å†æ¬¡å…¨é‡åŒæ­¥ã€‚</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-422.png" alt="img"></p>
<h5 id="æ¨¡æ‹Ÿå¢é‡åŒæ­¥çš„å‡ ä¸ªåœºæ™¯"><a href="#æ¨¡æ‹Ÿå¢é‡åŒæ­¥çš„å‡ ä¸ªåœºæ™¯" class="headerlink" title="æ¨¡æ‹Ÿå¢é‡åŒæ­¥çš„å‡ ä¸ªåœºæ™¯"></a>æ¨¡æ‹Ÿå¢é‡åŒæ­¥çš„å‡ ä¸ªåœºæ™¯</h5><p>åœºæ™¯1ï¼šæ­£å¸¸å¢é‡åŒæ­¥</p>
<ol>
<li>slave æ‰çº¿ä¸€å°ä¼šå„¿ï¼Œmaster ç»§ç»­æ¥æ”¶å†™å…¥ï¼Œrepl_backlog è®°å½•æ–°å‘½ä»¤ã€‚</li>
<li>slave æ¢å¤è¿æ¥ï¼Œå‘æ¥è‡ªå·±çš„ offsetã€‚</li>
<li><p>master åœ¨ repl_backlog ä¸­æ‰¾åˆ°è¿™éƒ¨åˆ†æ•°æ®ï¼Œæ¨é€ç»™ slaveã€‚</p>
<p>å¢é‡åŒæ­¥æˆåŠŸå®Œæˆã€‚</p>
</li>
</ol>
<p>åœºæ™¯2ï¼šrepl_backlog å†™æ»¡äº†</p>
<ul>
<li>éšç€ä¸»èŠ‚ç‚¹ä¸åœæ¥æ”¶æ–°å†™å…¥ï¼Œrepl_backlog ä¹Ÿåœ¨æŒç»­å†™å…¥ã€‚</li>
<li>å› ä¸ºæ˜¯å›ºå®šå¤§å°çš„ç¯å½¢æ•°ç»„ï¼Œ<strong>æ—§æ•°æ®ä¼šè¢«æ–°æ•°æ®è¦†ç›–</strong>ã€‚</li>
<li>å¦‚æœè¦†ç›–çš„æ•°æ®åŒ…å« slave å°šæœªåŒæ­¥çš„ offsetï¼Œé‚£ä¹ˆ slave æƒ³è¦å¢é‡åŒæ­¥æ—¶æ‰¾ä¸åˆ°æ•°æ®ã€‚</li>
</ul>
<p>âŒ å¢é‡åŒæ­¥å¤±è´¥ï¼Œåªèƒ½é‡æ–°åš <strong>å…¨é‡åŒæ­¥</strong>ã€‚</p>
<h5 id="å…³äºslave-æ¢å¤è¿æ¥æ—¶å‘é€è‡ªå·±çš„-offset-æ˜¯æ€ä¹ˆå›äº‹"><a href="#å…³äºslave-æ¢å¤è¿æ¥æ—¶å‘é€è‡ªå·±çš„-offset-æ˜¯æ€ä¹ˆå›äº‹" class="headerlink" title="å…³äºslave æ¢å¤è¿æ¥æ—¶å‘é€è‡ªå·±çš„ offset æ˜¯æ€ä¹ˆå›äº‹"></a>å…³äºslave æ¢å¤è¿æ¥æ—¶å‘é€è‡ªå·±çš„ offset æ˜¯æ€ä¹ˆå›äº‹</h5><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-425-1024x775.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-426-1024x286.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-423-1024x368.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-424-1024x140.png" alt="img"></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>å†…å®¹</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å¢é‡åŒæ­¥åŸç†</strong></td>
<td>master æ ¹æ® repl_backlog ä¸­è®°å½•çš„ offset å’Œå‘½ä»¤åšæ•°æ®è¡¥å‘</td>
</tr>
<tr>
<td><strong>æ•°æ®ç»“æ„</strong></td>
<td>repl_backlog æ˜¯ç¯å½¢ç¼“å†²åŒºï¼Œä¿å­˜ä¸»èŠ‚ç‚¹å¤„ç†è¿‡çš„å‘½ä»¤åŠ offset</td>
</tr>
<tr>
<td><strong>å¢é‡æ¡ä»¶</strong></td>
<td>slave çš„ offset å¯¹åº”æ•°æ®å¿…é¡»è¿˜åœ¨ç¼“å†²åŒºä¸­</td>
</tr>
<tr>
<td><strong>å¤±è´¥åœºæ™¯</strong></td>
<td>slave offset å¯¹åº”çš„æ•°æ®è¢«è¦†ç›–äº†ï¼Œåªèƒ½å›é€€åˆ°å…¨é‡åŒæ­¥</td>
</tr>
<tr>
<td><strong>ä¼˜åŠ¿</strong></td>
<td>ç›¸æ¯”å…¨é‡åŒæ­¥æ›´é«˜æ•ˆï¼ŒèŠ‚çœèµ„æº</td>
</tr>
</tbody>
</table>
</div>
<h3 id="1-4-ä¸»ä»åŒæ­¥ä¼˜åŒ–"><a href="#1-4-ä¸»ä»åŒæ­¥ä¼˜åŒ–" class="headerlink" title="1.4.ä¸»ä»åŒæ­¥ä¼˜åŒ–"></a>1.4.ä¸»ä»åŒæ­¥ä¼˜åŒ–</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-428-1024x164.png" alt="img"></p>
<p>å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥ä¼˜åŒ–Redisä¸»ä»å°±é›†ç¾¤ï¼š</p>
<h4 id="1ï¸âƒ£-å¯ç”¨æ— ç£ç›˜å¤åˆ¶ï¼š"><a href="#1ï¸âƒ£-å¯ç”¨æ— ç£ç›˜å¤åˆ¶ï¼š" class="headerlink" title="1ï¸âƒ£ å¯ç”¨æ— ç£ç›˜å¤åˆ¶ï¼š"></a>1ï¸âƒ£ å¯ç”¨æ— ç£ç›˜å¤åˆ¶ï¼š</h4><p><code>repl-diskless-sync yes</code>åœ¨masterä¸­é…ç½®<code>repl-diskless-sync yes</code>å¯ç”¨æ— ç£ç›˜å¤åˆ¶ï¼Œé¿å…å…¨é‡åŒæ­¥æ—¶çš„ç£ç›˜IOã€‚</p>
<p><strong>é»˜è®¤è¡Œä¸ºï¼ˆæœªä¼˜åŒ–ï¼‰</strong>ï¼š</p>
<ul>
<li><p>å½“ Redis ä¸»èŠ‚ç‚¹è¦è¿›è¡Œ </p>
<p>å…¨é‡å¤åˆ¶</p>
<p> æ—¶ï¼Œå®ƒä¼šï¼š</p>
<ol>
<li><strong>ç”Ÿæˆ RDB æ–‡ä»¶ï¼ˆå¿«ç…§ï¼‰</strong>ï¼›</li>
<li><strong>å°† RDB å†™å…¥ç£ç›˜</strong>ï¼›</li>
<li><strong>å†ä»ç£ç›˜è¯»å– RDB</strong>ï¼›</li>
<li><strong>é€šè¿‡ç½‘ç»œå‘é€ç»™ä»èŠ‚ç‚¹</strong>ã€‚</li>
</ol>
</li>
</ul>
<p><strong>é—®é¢˜</strong>ï¼š</p>
<ul>
<li>æ•´ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°ä¸¤æ¬¡ç£ç›˜ IOï¼ˆå†™ç£ç›˜ã€è¯»ç£ç›˜ï¼‰ï¼›</li>
<li>å¦‚æœä¸»èŠ‚ç‚¹å†…å­˜å¾ˆå¤§ï¼ˆå¦‚ 10G ä»¥ä¸Šï¼‰ï¼Œç£ç›˜ IO éå¸¸åƒåŠ›ï¼›</li>
<li>è¿˜ä¼šä¸ AOF å†™å…¥å‘ç”Ÿå†²çªï¼Œå¯¼è‡´ <strong>ä¸»èŠ‚ç‚¹å“åº”å˜æ…¢æˆ–å¡é¡¿</strong>ã€‚</li>
</ul>
<p><strong>ä¼˜åŒ–åšæ³•</strong>ï¼š</p>
<ul>
<li>åŠ å…¥é…ç½®ï¼š<code>repl-diskless-sync yes</code></li>
<li>æ”¹ä¸ºï¼š<strong>ä¸»èŠ‚ç‚¹å°† RDB ç›´æ¥å†™å…¥ socket å‘é€ç»™ä»èŠ‚ç‚¹</strong>ï¼Œ<strong>ä¸è½ç›˜</strong>ï¼</li>
</ul>
<p>ğŸ“Œ <strong>ç»“æœï¼šå‡å°‘ç£ç›˜ IOï¼Œæé«˜åŒæ­¥æ•ˆç‡ï¼Œå‡è½»ä¸»èŠ‚ç‚¹å‹åŠ›ã€‚</strong></p>
<h4 id="2ï¸âƒ£-å‡å°‘å•èŠ‚ç‚¹å†…å­˜å¤§å°ï¼ˆå»ºè®®-â‰¤-8GBï¼‰"><a href="#2ï¸âƒ£-å‡å°‘å•èŠ‚ç‚¹å†…å­˜å¤§å°ï¼ˆå»ºè®®-â‰¤-8GBï¼‰" class="headerlink" title="2ï¸âƒ£ å‡å°‘å•èŠ‚ç‚¹å†…å­˜å¤§å°ï¼ˆå»ºè®® â‰¤ 8GBï¼‰"></a>2ï¸âƒ£ å‡å°‘å•èŠ‚ç‚¹å†…å­˜å¤§å°ï¼ˆå»ºè®® â‰¤ 8GBï¼‰</h4><ul>
<li>Redis ä½¿ç”¨ RDB æˆ– AOF æŒä¹…åŒ–æ—¶éœ€è¦å°†æ•´ä¸ªæ•°æ®é›†å¤åˆ¶æˆ–éå†ï¼›</li>
<li>å¦‚æœ Redis å•èŠ‚ç‚¹å†…å­˜å¤ªå¤§ï¼Œå…¨é‡å¤åˆ¶ã€GC ç­‰ä¼šå¯¼è‡´é•¿æ—¶é—´å¡é¡¿ï¼›</li>
<li>é™ä½æ¯ä¸ª Redis å®ä¾‹çš„æ•°æ®é‡ï¼Œæœ‰åˆ©äºå¤åˆ¶æ€§èƒ½å’Œæ•…éšœæ¢å¤é€Ÿåº¦ã€‚</li>
</ul>
<p>ğŸ“Œ <strong>å»ºè®®ï¼šå°†æ•°æ®åˆç†æ‹†åˆ†åœ¨å¤šä¸ª Redis å®ä¾‹ä¸­ï¼Œåˆ†æ‹…å‹åŠ›ã€‚</strong></p>
<h4 id="3ï¸âƒ£-å¢å¤§-repl-backlog-å¤§å°ï¼ˆé»˜è®¤ä»…-1MBï¼‰"><a href="#3ï¸âƒ£-å¢å¤§-repl-backlog-å¤§å°ï¼ˆé»˜è®¤ä»…-1MBï¼‰" class="headerlink" title="3ï¸âƒ£ å¢å¤§ repl_backlog å¤§å°ï¼ˆé»˜è®¤ä»… 1MBï¼‰"></a>3ï¸âƒ£ å¢å¤§ <code>repl_backlog</code> å¤§å°ï¼ˆé»˜è®¤ä»… 1MBï¼‰</h4><p><strong>repl_backlog æ˜¯å¢é‡åŒæ­¥çš„ç¼“å†²åŒº</strong>ï¼Œå½“ä»èŠ‚ç‚¹çŸ­æš‚æ‰çº¿æ—¶ï¼Œé‡æ–°è¿æ¥ä¼šå‘é€è‡ªå·±çš„ offset è¯·æ±‚ä¸»èŠ‚ç‚¹è¡¥å‘ã€‚</p>
<p><strong>é—®é¢˜</strong>ï¼š</p>
<ul>
<li>å¦‚æœ backlog å¤ªå°ï¼Œä»èŠ‚ç‚¹æ–­çº¿æœŸé—´å†™æ“ä½œå¤ªå¤šï¼Œbacklog æ•°æ®è¢«è¦†ç›–ï¼›</li>
<li>å¯¼è‡´æ— æ³•è¿›è¡Œå¢é‡åŒæ­¥ï¼Œè¢«è¿«è¿›è¡Œå…¨é‡åŒæ­¥ã€‚</li>
</ul>
<p><strong>ä¼˜åŒ–åšæ³•</strong>ï¼š</p>
<ul>
<li>å¢åŠ  <code>repl_backlog_size</code>ï¼Œå¦‚è®¾ç½®ä¸º 64MB æˆ–æ›´é«˜ï¼›</li>
<li>æé«˜æ–­çº¿åå¯å®¹å¿çš„ offset å›æ»šæ—¶é—´ï¼Œ<strong>å°½å¯èƒ½é¿å…å…¨é‡å¤åˆ¶</strong>ã€‚</li>
</ul>
<p>ğŸ“Œ <strong>æ•ˆæœï¼šæå‡ä»èŠ‚ç‚¹çš„æ•…éšœæ¢å¤èƒ½åŠ›ï¼Œå‡å°‘å…¨é‡å¤åˆ¶å‘ç”Ÿæ¦‚ç‡ã€‚</strong></p>
<h4 id="4ï¸âƒ£-æ§åˆ¶ä»èŠ‚ç‚¹æ•°é‡ï¼Œé‡‡ç”¨â€œä¸»-ä»-ä»â€é“¾å¼ç»“æ„"><a href="#4ï¸âƒ£-æ§åˆ¶ä»èŠ‚ç‚¹æ•°é‡ï¼Œé‡‡ç”¨â€œä¸»-ä»-ä»â€é“¾å¼ç»“æ„" class="headerlink" title="4ï¸âƒ£ æ§åˆ¶ä»èŠ‚ç‚¹æ•°é‡ï¼Œé‡‡ç”¨â€œä¸»-ä»-ä»â€é“¾å¼ç»“æ„"></a>4ï¸âƒ£ æ§åˆ¶ä»èŠ‚ç‚¹æ•°é‡ï¼Œé‡‡ç”¨â€œä¸»-ä»-ä»â€é“¾å¼ç»“æ„</h4><p><strong>é—®é¢˜</strong>ï¼š</p>
<ul>
<li>ä¸€ä¸ªä¸»èŠ‚ç‚¹å¸¦å¤ªå¤šä»èŠ‚ç‚¹ï¼Œä¼šå¯¼è‡´ï¼š<ul>
<li>å†™æ“ä½œä¼ æ’­æ…¢ï¼›</li>
<li>å…¨é‡åŒæ­¥åŒæ—¶è¿›è¡Œï¼Œæ‹‰çˆ†ä¸»èŠ‚ç‚¹èµ„æºã€‚</li>
</ul>
</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ <strong><code>ä¸»-ä»-ä»</code>æ¶æ„</strong> æ¶æ„ï¼Œå¦‚ï¼š</li>
</ul>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-427-1024x311.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-429.png" alt="img"></p>
<ul>
<li>è®©éƒ¨åˆ† slave æŒ‚è½½åˆ°å…¶ä»– slave ä¸Šï¼Œå‡å°‘ master å‹åŠ›ã€‚</li>
</ul>
<p>ğŸ“Œ <strong>ç»“æœï¼šé™ä½ä¸»èŠ‚ç‚¹è¿æ¥å‹åŠ›ï¼Œæé«˜ç³»ç»Ÿç¨³å®šæ€§å’Œæ‰©å±•èƒ½åŠ›ã€‚</strong></p>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><div class="table-container">
<table>
<thead>
<tr>
<th>ä¼˜åŒ–ç‚¹</th>
<th>ä½œç”¨</th>
<th>æ•ˆæœ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>repl-diskless-sync</code></td>
<td>è·³è¿‡ RDB è½ç›˜</td>
<td>é™ä½ IOï¼Œæå‡æ€§èƒ½</td>
</tr>
<tr>
<td>å‡å°‘å®ä¾‹å†…å­˜</td>
<td>æ§åˆ¶å¿«ç…§å¤§å°</td>
<td>æé«˜ç¨³å®šæ€§</td>
</tr>
<tr>
<td>å¢å¤§ <code>repl_backlog_size</code></td>
<td>ä¿ç•™æ›´å¤šå†™æ“ä½œè®°å½•</td>
<td>ä¼˜å…ˆå¢é‡åŒæ­¥ï¼Œé¿å…å…¨é‡</td>
</tr>
<tr>
<td>é“¾å¼ä¸»ä»æ¶æ„</td>
<td>æ§åˆ¶ä¸»èŠ‚ç‚¹å‹åŠ›</td>
<td>æå‡é›†ç¾¤æ‰©å±•èƒ½åŠ›</td>
</tr>
</tbody>
</table>
</div>
<h3 id="å‡ é“å¸¸è§çš„é¢è¯•é¢˜ï¼Ÿ"><a href="#å‡ é“å¸¸è§çš„é¢è¯•é¢˜ï¼Ÿ" class="headerlink" title="å‡ é“å¸¸è§çš„é¢è¯•é¢˜ï¼Ÿ"></a>å‡ é“å¸¸è§çš„é¢è¯•é¢˜ï¼Ÿ</h3><p>1.ç®€è¿°å…¨é‡åŒæ­¥å’Œå¢é‡åŒæ­¥åŒºåˆ«ï¼Ÿ</p>
<ul>
<li>å…¨é‡åŒæ­¥ï¼šmasterå°†å®Œæ•´å†…å­˜æ•°æ®ç”ŸæˆRDBï¼Œå‘é€RDBåˆ°slaveã€‚åç»­å‘½ä»¤åˆ™è®°å½•åœ¨repl_baklogï¼Œé€ä¸ªå‘é€ç»™slaveã€‚</li>
<li>å¢é‡åŒæ­¥ï¼šslaveæäº¤è‡ªå·±çš„offsetåˆ°masterï¼Œmasterè·å–repl_baklogä¸­ä»offsetä¹‹åçš„å‘½ä»¤ç»™slave</li>
</ul>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-430.png" alt="img"></p>
<p>2.ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå…¨é‡åŒæ­¥ï¼Ÿ</p>
<ul>
<li>slaveèŠ‚ç‚¹ç¬¬ä¸€æ¬¡è¿æ¥masterèŠ‚ç‚¹æ—¶</li>
<li>slaveèŠ‚ç‚¹æ–­å¼€æ—¶é—´å¤ªä¹…ï¼Œrepl_baklogä¸­çš„offsetå·²ç»è¢«è¦†ç›–æ—¶</li>
</ul>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-431.png" alt="img"></p>
<p>3.ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå¢é‡åŒæ­¥ï¼Ÿ</p>
<ul>
<li>slaveèŠ‚ç‚¹æ–­å¼€åˆæ¢å¤ï¼Œå¹¶ä¸”åœ¨<code>repl_baklog</code>ä¸­èƒ½æ‰¾åˆ°offsetæ—¶</li>
</ul>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-432.png" alt="img"></p>
<h2 id="2-Rediså“¨å…µ"><a href="#2-Rediså“¨å…µ" class="headerlink" title="2.Rediså“¨å…µ"></a>2.Rediså“¨å…µ</h2><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-442.png" alt="img"></p>
<p>ä¸»ä»ç»“æ„ä¸­masterèŠ‚ç‚¹çš„ä½œç”¨éå¸¸é‡è¦ï¼Œä¸€æ—¦æ•…éšœå°±ä¼šå¯¼è‡´é›†ç¾¤ä¸å¯ç”¨ã€‚é‚£ä¹ˆæœ‰ä»€ä¹ˆåŠæ³•èƒ½ä¿è¯ä¸»ä»é›†ç¾¤çš„é«˜å¯ç”¨æ€§å‘¢ï¼Ÿ</p>
<h3 id="2-1-å“¨å…µå·¥ä½œåŸç†"><a href="#2-1-å“¨å…µå·¥ä½œåŸç†" class="headerlink" title="2.1.å“¨å…µå·¥ä½œåŸç†"></a>2.1.å“¨å…µå·¥ä½œåŸç†</h3><p>Redisæä¾›äº†<code>å“¨å…µ</code>ï¼ˆ<code>Sentinel</code>ï¼‰æœºåˆ¶æ¥ç›‘æ§ä¸»ä»é›†ç¾¤ç›‘æ§çŠ¶æ€ï¼Œç¡®ä¿é›†ç¾¤çš„é«˜å¯ç”¨æ€§ã€‚</p>
<h4 id="2-1-1-å“¨å…µä½œç”¨"><a href="#2-1-1-å“¨å…µä½œç”¨" class="headerlink" title="2.1.1.å“¨å…µä½œç”¨"></a>2.1.1.å“¨å…µä½œç”¨</h4><p>å“¨å…µé›†ç¾¤ä½œç”¨åŸç†å›¾ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-433-1024x781.png" alt="img"></p>
<p>å“¨å…µçš„ä½œç”¨å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>çŠ¶æ€ç›‘æ§</strong>ï¼š<code>Sentinel</code> ä¼šä¸æ–­æ£€æŸ¥æ‚¨çš„<code>master</code>å’Œ<code>slave</code>æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œ</li>
<li><strong>æ•…éšœæ¢å¤ï¼ˆfailoverï¼‰</strong>ï¼šå¦‚æœ<code>master</code>æ•…éšœï¼Œ<code>Sentinel</code>ä¼šå°†ä¸€ä¸ª<code>slave</code>æå‡ä¸º<code>master</code>ã€‚å½“æ•…éšœå®ä¾‹æ¢å¤åä¼šæˆä¸º<code>slave</code></li>
<li><strong>çŠ¶æ€é€šçŸ¥</strong>ï¼š<code>Sentinel</code>å……å½“<code>Redis</code>å®¢æˆ·ç«¯çš„æœåŠ¡å‘ç°æ¥æºï¼Œå½“é›†ç¾¤å‘ç”Ÿ<code>failover</code>æ—¶ï¼Œä¼šå°†æœ€æ–°é›†ç¾¤ä¿¡æ¯æ¨é€ç»™<code>Redis</code>çš„å®¢æˆ·ç«¯</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>åŠŸèƒ½</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>çŠ¶æ€ç›‘æ§</td>
<td>ä¸æ–­ ping master å’Œ slaveï¼Œç¡®è®¤æ˜¯å¦å¥åº·</td>
</tr>
<tr>
<td>æ•…éšœè½¬ç§»</td>
<td>master å®•æœºåï¼Œä» slave ä¸­é€‰ä¸€ä¸ªæ™‹å‡ä¸º master</td>
</tr>
<tr>
<td>çŠ¶æ€é€šçŸ¥</td>
<td>å®¢æˆ·ç«¯è¿æ¥å“¨å…µï¼Œè·å–æœ€æ–°çš„ä¸»èŠ‚ç‚¹ä¿¡æ¯</td>
</tr>
</tbody>
</table>
</div>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå“¨å…µå¦‚ä½•çŸ¥é“RedisèŠ‚ç‚¹æ˜¯å¦å®•æœºï¼Ÿå“¨å…µå¦‚ä½•é€‰ä¸¾æ–°çš„master?å“¨å…µå¦‚ä½•å®ç°æ•…éšœè½¬ç§»ï¼Ÿåœ¨ä¸‹æ–‡æˆ‘ä»¬ä¸€ä¸€è®²è§£</p>
<h4 id="2-1-2-çŠ¶æ€ç›‘æ§-Sentinel-å¦‚ä½•åˆ¤æ–­ä¸»èŠ‚ç‚¹æ•…éšœï¼Ÿ"><a href="#2-1-2-çŠ¶æ€ç›‘æ§-Sentinel-å¦‚ä½•åˆ¤æ–­ä¸»èŠ‚ç‚¹æ•…éšœï¼Ÿ" class="headerlink" title="2.1.2.çŠ¶æ€ç›‘æ§-Sentinel å¦‚ä½•åˆ¤æ–­ä¸»èŠ‚ç‚¹æ•…éšœï¼Ÿ"></a>2.1.2.çŠ¶æ€ç›‘æ§-Sentinel å¦‚ä½•åˆ¤æ–­ä¸»èŠ‚ç‚¹æ•…éšœï¼Ÿ</h4><p><code>Sentinel</code>åŸºäºå¿ƒè·³æœºåˆ¶ç›‘æµ‹æœåŠ¡çŠ¶æ€ï¼Œæ¯éš”1ç§’å‘é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹å‘é€pingå‘½ä»¤ï¼Œå¹¶é€šè¿‡å®ä¾‹çš„å“åº”ç»“æœæ¥åšå‡ºåˆ¤æ–­ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-443.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-434-1024x601.png" alt="img"></p>
<h4 id="å¦‚ä½•é€‰å‡ºæ–°çš„-masterï¼Ÿ"><a href="#å¦‚ä½•é€‰å‡ºæ–°çš„-masterï¼Ÿ" class="headerlink" title="å¦‚ä½•é€‰å‡ºæ–°çš„ masterï¼Ÿ"></a>å¦‚ä½•é€‰å‡ºæ–°çš„ masterï¼Ÿ</h4><p>ä¸€æ—¦å‘ç°masteræ•…éšœï¼Œsentineléœ€è¦åœ¨salveä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºæ–°çš„masterï¼Œé€‰æ‹©ä¾æ®æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>é¦–å…ˆä¼šåˆ¤æ–­slaveèŠ‚ç‚¹ä¸masterèŠ‚ç‚¹æ–­å¼€æ—¶é—´é•¿çŸ­ï¼Œå¦‚æœè¶…è¿‡<code>down-after-milliseconds * 10</code>åˆ™ä¼šæ’é™¤è¯¥slaveèŠ‚ç‚¹</li>
<li>ç„¶ååˆ¤æ–­slaveèŠ‚ç‚¹çš„<code>slave-priority</code>å€¼ï¼ˆå†³å®šæ¡ä»¶ï¼šè´Ÿè½½çŠ¶æ€ã€åœ°ç†ä½ç½®ã€ç¡¬ä»¶é…ç½®ç­‰ç­‰ï¼‰ï¼Œè¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼Œå¦‚æœæ˜¯0åˆ™æ°¸ä¸å‚ä¸é€‰ä¸¾ï¼ˆé»˜è®¤éƒ½æ˜¯1ï¼‰ã€‚</li>
<li>å¦‚æœ<code>slave-prority</code>ä¸€æ ·ï¼Œåˆ™åˆ¤æ–­slaveèŠ‚ç‚¹çš„<code>offset</code>å€¼ï¼ˆä½“ç°æ•°æ®çš„å®Œæ•´æ€§ï¼‰ï¼Œè¶Šå¤§è¯´æ˜æ•°æ®è¶Šæ–°ï¼Œä¼˜å…ˆçº§è¶Šé«˜</li>
<li>æœ€åæ˜¯åˆ¤æ–­slaveèŠ‚ç‚¹çš„<code>run_id</code>å¤§å°ï¼Œè¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼ˆ<code>é€šè¿‡info serverå¯ä»¥æŸ¥çœ‹run_id</code>ï¼‰ã€‚</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>ä¼˜å…ˆçº§é¡ºåº</th>
<th>æ¡ä»¶è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>â‘ </td>
<td>ä¸ master æ–­è¿æ—¶é—´æ˜¯å¦è¿‡é•¿ï¼ˆ&gt; down_after_milliseconds * 10ï¼‰</td>
</tr>
<tr>
<td>â‘¡</td>
<td>slave-priority å€¼è¶Šå°ä¼˜å…ˆï¼ˆé»˜è®¤éƒ½æ˜¯1ï¼Œ0è¡¨ç¤ºä¸å‚ä¸é€‰ä¸¾ï¼‰</td>
</tr>
<tr>
<td>â‘¢</td>
<td>offset è¶Šå¤§è¯´æ˜æ•°æ®è¶Šæ–°ï¼ˆè¶Šé å‰ï¼‰</td>
</tr>
<tr>
<td>â‘£</td>
<td>run_id å­—å…¸åºè¶Šå°è€…ä¼˜å…ˆ</td>
</tr>
</tbody>
</table>
</div>
<p>é—®é¢˜æ¥äº†ï¼Œå½“é€‰å‡ºä¸€ä¸ªæ–°çš„masteråï¼Œè¯¥å¦‚ä½•å®ç°èº«ä»½åˆ‡æ¢å‘¢ï¼Ÿ</p>
<p>å¤§æ¦‚åˆ†ä¸ºä¸¤æ­¥ï¼š</p>
<ul>
<li>åœ¨å¤šä¸ª<code>sentinel</code>ä¸­é€‰ä¸¾ä¸€ä¸ª<code>leader</code></li>
<li>ç”±<code>leader</code>æ‰§è¡Œ<code>failover</code></li>
</ul>
<h4 id="2-1-3-é€‰ä¸¾leader"><a href="#2-1-3-é€‰ä¸¾leader" class="headerlink" title="2.1.3.é€‰ä¸¾leader"></a>2.1.3.é€‰ä¸¾leader</h4><p>é¦–å…ˆï¼ŒSentinelé›†ç¾¤è¦é€‰å‡ºä¸€ä¸ªæ‰§è¡Œ<code>failover</code>çš„SentinelèŠ‚ç‚¹ï¼Œå¯ä»¥æˆä¸º<code>leader</code>ã€‚è¦æˆä¸º<code>leader</code>è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</p>
<ul>
<li>æœ€å…ˆè·å¾—è¶…è¿‡åŠæ•°çš„æŠ•ç¥¨</li>
<li>è·å¾—çš„æŠ•ç¥¨æ•°ä¸å°äº<code>quorum</code>å€¼</li>
</ul>
<p>è€ŒsentinelæŠ•ç¥¨çš„åŸåˆ™æœ‰ä¸¤æ¡ï¼š</p>
<ul>
<li>ä¼˜å…ˆæŠ•ç¥¨ç»™ç›®å‰å¾—ç¥¨æœ€å¤šçš„</li>
<li>å¦‚æœç›®å‰æ²¡æœ‰ä»»ä½•èŠ‚ç‚¹çš„ç¥¨ï¼Œå°±æŠ•ç»™è‡ªå·±</li>
</ul>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-444.png" alt="img"></p>
<p>æ¯”å¦‚æœ‰3ä¸ªsentinelèŠ‚ç‚¹ï¼Œ<code>s1</code>ã€<code>s2</code>ã€<code>s3</code>ï¼Œå‡å¦‚<code>s2</code>å…ˆæŠ•ç¥¨ï¼š</p>
<ul>
<li>æ­¤æ—¶å‘ç°æ²¡æœ‰ä»»ä½•äººåœ¨æŠ•ç¥¨ï¼Œé‚£å°±æŠ•ç»™è‡ªå·±ã€‚<code>s2</code>å¾—1ç¥¨</li>
<li>æ¥ç€<code>s1</code>å’Œ<code>s3</code>å¼€å§‹æŠ•ç¥¨ï¼Œå‘ç°ç›®å‰<code>s2</code>ç¥¨æœ€å¤šï¼Œäºæ˜¯ä¹ŸæŠ•ç»™<code>s2</code>ï¼Œ<code>s2</code>å¾—3ç¥¨</li>
<li><code>s2</code>ç§°ä¸º<code>leader</code>ï¼Œå¼€å§‹æ•…éšœè½¬ç§»</li>
</ul>
<p>ä¸éš¾çœ‹å‡ºï¼Œ<strong>è°å…ˆ**</strong>æŠ•ç¥¨<strong><strong>ï¼Œè°å°±ä¼šç§°ä¸º</strong></strong>leader**ï¼Œé‚£ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘æŠ•ç¥¨å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯<strong>ç¬¬ä¸€ä¸ªç¡®è®¤**</strong>master<strong><strong>å®¢è§‚ä¸‹çº¿</strong></strong>çš„äºº<strong><strong>ä¼šç«‹åˆ»å‘èµ·</strong></strong>æŠ•ç¥¨<strong><strong>ï¼Œä¸€å®šä¼šæˆä¸º</strong></strong>leader**ã€‚</p>
<p><code>sentinel</code>æ‰¾åˆ°<code>leader</code>ä»¥åï¼Œè¯¥å¦‚ä½•å®Œæˆ<code>failover</code>å‘¢ï¼Ÿ</p>
<h4 id="2-1-4-failover-æ•…éšœæ¢å¤"><a href="#2-1-4-failover-æ•…éšœæ¢å¤" class="headerlink" title="2.1.4.failover æ•…éšœæ¢å¤"></a>2.1.4.failover æ•…éšœæ¢å¤</h4><p>æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼Œæœ‰ä¸€ä¸ªé›†ç¾¤ï¼Œåˆå§‹çŠ¶æ€ä¸‹7001ä¸º<code>master</code>ï¼Œ7002å’Œ7003ä¸º<code>slave</code>ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-435-1024x607.png" alt="img"></p>
<p>å‡å¦‚masterå‘ç”Ÿæ•…éšœï¼Œslave1å½“é€‰ã€‚åˆ™æ•…éšœè½¬ç§»çš„æµç¨‹å¦‚ä¸‹ï¼š</p>
<p>1ï¼‰<code>sentinel</code>ï¼ˆleaderï¼‰ç»™å¤‡é€‰çš„<code>slave1</code>èŠ‚ç‚¹å‘é€<code>slaveof no one</code>å‘½ä»¤ï¼Œè®©è¯¥èŠ‚ç‚¹æˆä¸º<code>master</code></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-436-1024x607.png" alt="img"></p>
<p>2ï¼‰<code>sentinel</code>ç»™æ‰€æœ‰å…¶å®ƒ<code>slave</code>å‘é€<code>slaveof 192.168.150.101 7002</code> å‘½ä»¤ï¼Œè®©è¿™äº›èŠ‚ç‚¹æˆä¸ºæ–°masterçš„slaveèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯<code>7002</code>çš„<code>slave</code>èŠ‚ç‚¹ï¼Œå¼€å§‹ä»æ–°çš„<code>master</code>ä¸ŠåŒæ­¥æ•°æ®ã€‚</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-437-1024x609.png" alt="img"></p>
<p>3ï¼‰æœ€åï¼Œå½“æ•…éšœèŠ‚ç‚¹æ¢å¤åä¼šæ¥æ”¶åˆ°å“¨å…µä¿¡å·ï¼Œæ‰§è¡Œ<code>slaveof 192.168.150.101 7002</code>å‘½ä»¤ï¼Œæˆä¸º<code>slave</code>ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-439-1024x607.png" alt="img"></p>
<p>sentinelç›´æ¥ä¿®æ”¹æ•…éšœèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ï¼Œæ•…éšœèŠ‚ç‚¹æ¢å¤åè‡ªåŠ¨å°±ä¼šæˆä¸º7002çš„slave</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-445.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-440-1024x836.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-446.png" alt="img"></p>
<p>æ€»ç»“ï¼šRedis å“¨å…µæœºåˆ¶å°±æ˜¯ä¸€å¥— <strong>åŸºäºæŠ•ç¥¨æœºåˆ¶å®ç°çš„è‡ªåŠ¨æ•…éšœæ¢å¤ç³»ç»Ÿ</strong>ï¼Œå®ƒè´Ÿè´£ç›‘æ§ã€é€‰ä¸¾å’Œé€šçŸ¥ï¼Œç¡®ä¿ Redis é›†ç¾¤åœ¨ master å®•æœºæ—¶èƒ½è‡ªåŠ¨æ¢å¤æœåŠ¡ï¼Œä¿è¯é«˜å¯ç”¨ã€‚</p>
<h4 id="è¡¥å……ä¸€ä¸ªç»†èŠ‚ï¼š"><a href="#è¡¥å……ä¸€ä¸ªç»†èŠ‚ï¼š" class="headerlink" title="è¡¥å……ä¸€ä¸ªç»†èŠ‚ï¼š"></a>è¡¥å……ä¸€ä¸ªç»†èŠ‚ï¼š</h4><p>æœ‰ä¸ªç–‘é—®ï¼Œå¦‚æœä¸»èŠ‚ç‚¹7001æŒ‚äº†ï¼Œä¼šé‡æ–°é€‰æ‹©ä¸€ä¸ªä½œä¸ºä¸»èŠ‚ç‚¹(å‡å¦‚æ˜¯7002)ï¼Œå¦‚æœ7002ä¹ŸæŒ‚æ‰è¿˜ä¼šåœ¨è¿›è¡Œé€‰æ‹©ä¸»èŠ‚ç‚¹å—ï¼ˆå‡å¦‚æœ‰å¾ˆå¤šredisä»èŠ‚ç‚¹ï¼‰ï¼Œå› ä¸ºå‰é¢å“¨å…µé…ç½®æ–‡ä»¶é‡Œé¢ï¼ŒæŒ‡å®šäº†é›†ç¾¤çš„ä¸»èŠ‚ç‚¹ä¿¡æ¯ ï¼ˆ7001ï¼‰ï¼Œé‡æ–°é€‰æ‹©çš„ä¸»èŠ‚ç‚¹7002ä¼šè¢«å“¨å…µç›‘æ§å—</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-449-1024x617.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-450-1024x409.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-451-1024x633.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-452.png" alt="img"></p>
<h3 id="2-2-æ­å»ºå“¨å…µé›†ç¾¤"><a href="#2-2-æ­å»ºå“¨å…µé›†ç¾¤" class="headerlink" title="2.2.æ­å»ºå“¨å…µé›†ç¾¤"></a>2.2.æ­å»ºå“¨å…µé›†ç¾¤</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬åœæ‰ä¹‹å‰çš„redisé›†ç¾¤ï¼Œé¿å…å’Œæ¥ä¸‹æ¥æ­å»ºé›†ç¾¤äº§ç”Ÿå†²çªï¼š</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># è€ç‰ˆæœ¬DockerCompose</span></span><br><span class="line">docker<span class="punctuation">-</span>compose down</span><br><span class="line"></span><br><span class="line"><span class="meta"># æ–°ç‰ˆæœ¬Docker</span></span><br><span class="line">docker compose down</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ‰¾åˆ°è¯¾å‰èµ„æ–™æä¾›çš„sentinel.confæ–‡ä»¶</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sentinel announce-ip <span class="string">&quot;192.168.150.101&quot;</span></span><br><span class="line">sentinel<span class="built_in"> monitor </span>hmaster 192.168.150.101 7001 2</span><br><span class="line">sentinel down-after-milliseconds hmaster 5000</span><br><span class="line">sentinel failover-timeout hmaster 60000</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š</p>
<ul>
<li><p><code>sentinel announce-ip &quot;192.168.150.101&quot;</code>ï¼šå£°æ˜å½“å‰sentinelçš„ip</p>
</li>
<li><p>```<br>sentinel monitor hmaster 192.168.150.101 7001 2</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  ï¼šæŒ‡å®šé›†ç¾¤çš„ä¸»èŠ‚ç‚¹ä¿¡æ¯</span><br><span class="line"></span><br><span class="line"><span class="bullet">  -</span> <span class="code">`hmaster`</span>ï¼šä¸»èŠ‚ç‚¹åç§°ï¼Œè‡ªå®šä¹‰ï¼Œä»»æ„å†™</span><br><span class="line"><span class="bullet">  -</span> <span class="code">`192.168.150.101 7001`</span>ï¼šä¸»èŠ‚ç‚¹çš„ipå’Œç«¯å£</span><br><span class="line"><span class="bullet">  -</span> <span class="code">`2`</span>ï¼šè®¤å®š<span class="code">`master`</span>ä¸‹çº¿æ—¶çš„<span class="code">`quorum`</span>å€¼ï¼ˆä¸‰ä¸ªå“¨å…µï¼Œ2ä¸ªè®¤ä¸ºä¸»è§‚ä¸‹çº¿å°±æ˜¯å®¢è§‚ä¸‹çº¿ï¼‰</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="code">`sentinel down-after-milliseconds hmaster 5000`</span>ï¼šå£°æ˜masterèŠ‚ç‚¹è¶…æ—¶å¤šä¹…åè¢«æ ‡è®°ä¸‹çº¿</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="code">`sentinel failover-timeout hmaster 60000`</span>ï¼šåœ¨ç¬¬ä¸€æ¬¡æ•…éšœè½¬ç§»å¤±è´¥åå¤šä¹…å†æ¬¡é‡è¯•ï¼ˆæ•…éšœæ¢å¤è¶…æ—¶æ—¶é—´ï¼‰</span><br><span class="line"></span><br><span class="line">æˆ‘ä»¬åœ¨è™šæ‹Ÿæœºçš„<span class="code">`/root/redis`</span>ç›®å½•ä¸‹æ–°å»º3ä¸ªæ–‡ä»¶å¤¹ï¼š<span class="code">`s1`</span>ã€<span class="code">`s2`</span>ã€<span class="code">`s3`</span>:</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>mkdir s1 s2 s3</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">å°†è¯¾å‰èµ„æ–™æä¾›çš„`sentinel.conf`æ–‡ä»¶åˆ†åˆ«æ‹·è´ä¸€ä»½åˆ°<span class="number">3</span>ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>cp s1/sentinel.conf s2<br>cp s1/sentinel.conf s3</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">æ¥ç€ä¿®æ”¹`docker-compose.yaml`æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>version: â€œ3.2â€</p>
</li>
</ul>
<p>services:<br>  r1:<br>    image: redis<br>    container_name: r1<br>    network_mode: â€œhostâ€<br>    entrypoint: [â€œredis-serverâ€, â€œâ€”portâ€, â€œ7001â€]<br>  r2:<br>    image: redis<br>    container_name: r2<br>    network_mode: â€œhostâ€<br>    entrypoint: [â€œredis-serverâ€, â€œâ€”portâ€, â€œ7002â€, â€œâ€”slaveofâ€, â€œ192.168.150.101â€, â€œ7001â€]<br>  r3:<br>    image: redis<br>    container_name: r3<br>    network_mode: â€œhostâ€<br>    entrypoint: [â€œredis-serverâ€, â€œâ€”portâ€, â€œ7003â€, â€œâ€”slaveofâ€, â€œ192.168.150.101â€, â€œ7001â€]<br>  s1:<br>    image: redis<br>    container_name: s1<br>    volumes:</p>
<pre><code>  - /root/redis/s1:/etc/redis
network_mode: &quot;host&quot;
entrypoint: [&quot;redis-sentinel&quot;, &quot;/etc/redis/sentinel.conf&quot;, &quot;--port&quot;, &quot;27001&quot;]
</code></pre><p>  s2:<br>    image: redis<br>    container_name: s2<br>    volumes:</p>
<pre><code>  - /root/redis/s2:/etc/redis
network_mode: &quot;host&quot;
entrypoint: [&quot;redis-sentinel&quot;, &quot;/etc/redis/sentinel.conf&quot;, &quot;--port&quot;, &quot;27002&quot;]
</code></pre><p>  s3:<br>    image: redis<br>    container_name: s3<br>    volumes:</p>
<pre><code>  - /root/redis/s3:/etc/redis
network_mode: &quot;host&quot;
entrypoint: [&quot;redis-sentinel&quot;, &quot;/etc/redis/sentinel.conf&quot;, &quot;--port&quot;, &quot;27003&quot;]
</code></pre><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ç›´æ¥è¿è¡Œå‘½ä»¤ï¼Œå¯åŠ¨é›†ç¾¤ï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>docker-compose up -d<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line"></span><br><span class="line">![img](https:<span class="regexp">//</span>www.legendkiller.xyz<span class="regexp">/wp-content/u</span>ploads<span class="regexp">/2025/</span><span class="number">08</span>/image-<span class="number">447</span>-<span class="number">1024</span>x242.png)</span><br><span class="line"></span><br><span class="line">æˆ‘ä»¬ä»¥s1èŠ‚ç‚¹ä¸ºä¾‹ï¼ŒæŸ¥çœ‹å…¶è¿è¡Œæ—¥å¿—</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>docker logs -f s1</p>
<h1 id="Sentinel-ID-is-8e91bd24ea8e5eb2aee38f1cf796dcb26bb88acf"><a href="#Sentinel-ID-is-8e91bd24ea8e5eb2aee38f1cf796dcb26bb88acf" class="headerlink" title="Sentinel ID is 8e91bd24ea8e5eb2aee38f1cf796dcb26bb88acf"></a>Sentinel ID is 8e91bd24ea8e5eb2aee38f1cf796dcb26bb88acf</h1><h1 id="monitor-master-hmaster-192-168-150-101-7001-quorum-2"><a href="#monitor-master-hmaster-192-168-150-101-7001-quorum-2" class="headerlink" title="+monitor master hmaster 192.168.150.101 7001 quorum 2"></a>+monitor master hmaster 192.168.150.101 7001 quorum 2</h1><ul>
<li>+slave slave 192.168.150.101:7003 192.168.150.101 7003 @ hmaster 192.168.150.101 7001</li>
<li>+sentinel sentinel 5bafeb97fc16a82b431c339f67b015a51dad5e4f 192.168.150.101 27002 @ hmaster 192.168.150.101 7001</li>
<li>+sentinel sentinel 56546568a2f7977da36abd3d2d7324c6c3f06b8d 192.168.150.101 27003 @ hmaster 192.168.150.101 7001</li>
<li>+slave slave 192.168.150.101:7002 192.168.150.101 7002 @ hmaster 192.168.150.101 7001<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">å¯ä»¥çœ‹åˆ°`sentinel`å·²ç»è”ç³»åˆ°äº†`7001`è¿™ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”ä¸å…¶å®ƒå‡ ä¸ªå“¨å…µä¹Ÿå»ºç«‹äº†é“¾æ¥ã€‚å“¨å…µä¿¡æ¯å¦‚ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line">- `27001`ï¼š`Sentinel ID`æ˜¯`8e91bd24ea8e5eb2aee38f1cf796dcb26bb88acf`</span><br><span class="line">- `27002`ï¼š`Sentinel ID`æ˜¯`5bafeb97fc16a82b431c339f67b015a51dad5e4f`</span><br><span class="line">- `27003`ï¼š`Sentinel ID`æ˜¯`56546568a2f7977da36abd3d2d7324c6c3f06b8d`</span><br><span class="line"></span><br><span class="line">### <span class="number">2.3</span>.æ¼”ç¤ºfailover</span><br><span class="line"></span><br><span class="line">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¼”ç¤ºä¸€ä¸‹å½“ä¸»èŠ‚ç‚¹æ•…éšœæ—¶ï¼Œå“¨å…µæ˜¯å¦‚ä½•å®Œæˆé›†ç¾¤æ•…éšœæ¢å¤ï¼ˆfailoverï¼‰çš„ã€‚</span><br><span class="line"></span><br><span class="line">æˆ‘ä»¬è¿æ¥`7001`è¿™ä¸ª`master`èŠ‚ç‚¹ï¼Œç„¶åé€šè¿‡å‘½ä»¤è®©å…¶ä¼‘çœ <span class="number">60</span>ç§’ï¼Œæ¨¡æ‹Ÿå®•æœºï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="è¿æ¥7001è¿™ä¸ªmasterèŠ‚ç‚¹ï¼Œé€šè¿‡sleepæ¨¡æ‹ŸæœåŠ¡å®•æœºï¼Œ60ç§’åè‡ªåŠ¨æ¢å¤"><a href="#è¿æ¥7001è¿™ä¸ªmasterèŠ‚ç‚¹ï¼Œé€šè¿‡sleepæ¨¡æ‹ŸæœåŠ¡å®•æœºï¼Œ60ç§’åè‡ªåŠ¨æ¢å¤" class="headerlink" title="è¿æ¥7001è¿™ä¸ªmasterèŠ‚ç‚¹ï¼Œé€šè¿‡sleepæ¨¡æ‹ŸæœåŠ¡å®•æœºï¼Œ60ç§’åè‡ªåŠ¨æ¢å¤"></a>è¿æ¥7001è¿™ä¸ªmasterèŠ‚ç‚¹ï¼Œé€šè¿‡sleepæ¨¡æ‹ŸæœåŠ¡å®•æœºï¼Œ60ç§’åè‡ªåŠ¨æ¢å¤</h1>docker exec -it r1 redis-cli -p 7001 DEBUG sleep 60<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ç¨å¾®ç­‰å¾…ä¸€æ®µæ—¶é—´åï¼Œä¼šå‘ç°sentinelèŠ‚ç‚¹è§¦å‘äº†<span class="code">`failover`</span>ï¼š</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-448-1024x440.png</span>)</span><br><span class="line"></span><br><span class="line"><span class="section">### 2.4.æ€»ç»“-Rediså“¨å…µçš„å‡ ä¸ªé¢è¯•é¢˜</span></span><br><span class="line"></span><br><span class="line">1.Sentinelçš„ä¸‰ä¸ªä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> é›†ç¾¤ç›‘æ§</span><br><span class="line"><span class="bullet">-</span> æ•…éšœæ¢å¤</span><br><span class="line"><span class="bullet">-</span> çŠ¶æ€é€šçŸ¥</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-456.png</span>)</span><br><span class="line"></span><br><span class="line">2.Sentinelå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªrediså®ä¾‹æ˜¯å¦å¥åº·ï¼Ÿ</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> æ¯éš”1ç§’å‘é€ä¸€æ¬¡pingå‘½ä»¤ï¼Œå¦‚æœè¶…è¿‡ä¸€å®šæ—¶é—´æ²¡æœ‰ç›¸å‘åˆ™è®¤ä¸ºæ˜¯ä¸»è§‚ä¸‹çº¿ï¼ˆ<span class="code">`sdown`</span>ï¼‰</span><br><span class="line"><span class="bullet">-</span> å¦‚æœå¤§å¤šæ•°sentineléƒ½è®¤ä¸ºå®ä¾‹ä¸»è§‚ä¸‹çº¿ï¼Œåˆ™åˆ¤å®šæœåŠ¡å®¢è§‚ä¸‹çº¿ï¼ˆ<span class="code">`odown`</span>ï¼‰</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-457.png</span>)</span><br><span class="line"></span><br><span class="line">3.æ•…éšœè½¬ç§»æ­¥éª¤æœ‰å“ªäº›ï¼Ÿ</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> é¦–å…ˆè¦åœ¨<span class="code">`sentinel`</span>ä¸­é€‰å‡ºä¸€ä¸ª<span class="code">`leader`</span>ï¼Œç”±leaderæ‰§è¡Œ<span class="code">`failover`</span></span><br><span class="line"><span class="bullet">-</span> é€‰å®šä¸€ä¸ª<span class="code">`slave`</span>ä½œä¸ºæ–°çš„<span class="code">`master`</span>ï¼Œæ‰§è¡Œ<span class="code">`slaveof noone`</span>ï¼Œåˆ‡æ¢åˆ°masteræ¨¡å¼</span><br><span class="line"><span class="bullet">-</span> ç„¶åè®©æ‰€æœ‰èŠ‚ç‚¹éƒ½æ‰§è¡Œ<span class="code">`slaveof`</span> æ–°master</span><br><span class="line"><span class="bullet">-</span> ä¿®æ”¹æ•…éšœèŠ‚ç‚¹é…ç½®ï¼Œæ·»åŠ <span class="code">`slaveof`</span> æ–°master</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-458.png</span>)</span><br><span class="line"></span><br><span class="line">4.sentinelé€‰ä¸¾leaderçš„ä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿ</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> ç¥¨æ•°è¶…è¿‡sentinelèŠ‚ç‚¹æ•°é‡1åŠ</span><br><span class="line"><span class="bullet">-</span> ç¥¨æ•°è¶…è¿‡quorumæ•°é‡</span><br><span class="line"><span class="bullet">-</span> ä¸€èˆ¬æƒ…å†µä¸‹æœ€å…ˆå‘èµ·failoverçš„èŠ‚ç‚¹ä¼šå½“é€‰</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-459.png</span>)</span><br><span class="line"></span><br><span class="line">5.sentinelä»slaveä¸­é€‰å–masterçš„ä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿ</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> é¦–å…ˆä¼šåˆ¤æ–­slaveèŠ‚ç‚¹ä¸masterèŠ‚ç‚¹æ–­å¼€æ—¶é—´é•¿çŸ­ï¼Œå¦‚æœè¶…è¿‡<span class="code">`down-after-milliseconds`</span><span class="code">` * 10`</span>åˆ™ä¼šæ’é™¤è¯¥slaveèŠ‚ç‚¹</span><br><span class="line"><span class="bullet">-</span> ç„¶ååˆ¤æ–­slaveèŠ‚ç‚¹çš„<span class="code">`slave-priority`</span>å€¼ï¼Œè¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼Œå¦‚æœæ˜¯0åˆ™æ°¸ä¸å‚ä¸é€‰ä¸¾ï¼ˆé»˜è®¤éƒ½æ˜¯1ï¼‰ã€‚</span><br><span class="line"><span class="bullet">-</span> å¦‚æœ<span class="code">`slave-prority`</span>ä¸€æ ·ï¼Œåˆ™åˆ¤æ–­slaveèŠ‚ç‚¹çš„<span class="code">`offset`</span>å€¼ï¼Œè¶Šå¤§è¯´æ˜æ•°æ®è¶Šæ–°ï¼Œä¼˜å…ˆçº§è¶Šé«˜</span><br><span class="line"><span class="bullet">-</span> æœ€åæ˜¯åˆ¤æ–­slaveèŠ‚ç‚¹çš„<span class="code">`run_id`</span>å¤§å°ï¼Œè¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼ˆ<span class="code">`é€šè¿‡info serverå¯ä»¥æŸ¥çœ‹run_id`</span>ï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-460.png</span>)</span><br><span class="line"></span><br><span class="line"><span class="section">### 2.5.RedisTemplateè¿æ¥å“¨å…µé›†ç¾¤çš„ä¸‰å¤§æ­¥éª¤</span></span><br><span class="line"></span><br><span class="line">åˆ†ä¸ºä¸‰æ­¥ï¼š</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> 1ï¼‰å¼•å…¥ä¾èµ–</span><br><span class="line"><span class="bullet">-</span> 2ï¼‰é…ç½®å“¨å…µåœ°å€</span><br><span class="line"><span class="bullet">-</span> 3ï¼‰é…ç½®è¯»å†™åˆ†ç¦»</span><br><span class="line"></span><br><span class="line"><span class="section">#### 2.5.1.å¼•å…¥ Spring Data Redis ä¾èµ–</span></span><br><span class="line"></span><br><span class="line">å°±æ˜¯SpringDataRedisçš„ä¾èµ–ï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<dependency><br>  <groupId>org.springframework.boot</groupId><br>  <artifactId>spring-boot-starter-data-redis</artifactId>
</dependency><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">-</span> ä½œç”¨ï¼šè¿™æ˜¯ Spring Boot å®˜æ–¹æä¾›çš„ Redis æ”¯æŒï¼Œè‡ªåŠ¨é›†æˆäº†åº•å±‚ Redis å®¢æˆ·ç«¯ï¼ˆé»˜è®¤ä½¿ç”¨ Lettuceï¼Œä¹Ÿå¯ä»¥åˆ‡æ¢ä¸º Jedisï¼‰ã€‚</span><br><span class="line"><span class="bullet">-</span> è‡ªåŠ¨é…ç½®ï¼šå¼•å…¥åï¼ŒSpring Boot ä¼šè‡ªåŠ¨è¯†åˆ«ä½ åœ¨ <span class="code">`application.yml`</span> ä¸­çš„ Redis é…ç½®ï¼Œåˆ›å»ºå¥½ <span class="code">`RedisTemplate`</span> ç­‰å¸¸ç”¨ Beanã€‚</span><br><span class="line"></span><br><span class="line"><span class="section">#### 2.5.2.é…ç½®å“¨å…µåœ°å€</span></span><br><span class="line"></span><br><span class="line">è¿æ¥å“¨å…µé›†ç¾¤ä¸ä¼ ç»Ÿå•ç‚¹æ¨¡å¼ä¸åŒï¼Œä¸å†éœ€è¦è®¾ç½®æ¯ä¸€ä¸ªredisçš„åœ°å€ï¼Œè€Œæ˜¯ç›´æ¥æŒ‡å®šå“¨å…µåœ°å€ï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure>
spring:<br>redis:<br>  sentinel:<pre><code>master: hmaster # é›†ç¾¤å
nodes: # å“¨å…µåœ°å€åˆ—è¡¨
  - 192.168.150.101:27001
  - 192.168.150.101:27002
  - 192.168.150.101:27003
</code></pre><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="code">`master: hmaster`</span>ï¼šè¿™ä¸ª <span class="code">`hmaster`</span> æ˜¯å“¨å…µç›‘æ§çš„ä¸»èŠ‚ç‚¹åå­—ï¼Œå’Œå“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ <span class="code">`sentinel monitor`</span> åé¢çš„åå­—ä¿æŒä¸€è‡´ã€‚</span><br><span class="line"><span class="bullet">-</span> <span class="code">`nodes`</span>ï¼šè¿™é‡Œé…ç½®çš„æ˜¯<span class="strong">**å“¨å…µèŠ‚ç‚¹åœ°å€**</span>ï¼Œå®¢æˆ·ç«¯é€šè¿‡å“¨å…µå‘ç°ä¸»ä»èŠ‚ç‚¹ï¼Œå¹¶è‡ªåŠ¨å®Œæˆä¸»ä»åˆ‡æ¢çš„è¿æ¥ç®¡ç†ã€‚</span><br><span class="line"><span class="bullet">-</span> é‡ç‚¹ï¼šå®¢æˆ·ç«¯ä¸å†å…³æ³¨ä¸»ä»èŠ‚ç‚¹çš„å®é™… IP å’Œç«¯å£ï¼Œåªè¦è¿æ¥å“¨å…µï¼Œç”±å“¨å…µæ¥å‘Šè¯‰å®¢æˆ·ç«¯è°æ˜¯ä¸»è°æ˜¯ä»ã€‚</span><br><span class="line"></span><br><span class="line"><span class="section">#### 2.5.3.é…ç½®è¯»å†™åˆ†ç¦»ç­–ç•¥</span></span><br><span class="line"></span><br><span class="line">æœ€åï¼Œè¿˜è¦é…ç½®è¯»å†™åˆ†ç¦»ï¼Œè®©javaå®¢æˆ·ç«¯å°†å†™è¯·æ±‚å‘é€åˆ°masterèŠ‚ç‚¹ï¼Œè¯»è¯·æ±‚å‘é€åˆ°slaveèŠ‚ç‚¹ã€‚å®šä¹‰ä¸€ä¸ªbeanå³å¯ï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure>
@Bean<br>public LettuceClientConfigurationBuilderCustomizer clientConfigurationBuilderCustomizer(){<br>  return clientConfigurationBuilder -&gt; clientConfigurationBuilder.readFrom(ReadFrom.REPLICA_PREFERRED);<br>}<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#### ä¸ºä»€ä¹ˆè¦é…ç½®è¿™ä¸ªï¼Ÿ</span></span><br><span class="line"></span><br><span class="line">- é»˜è®¤æƒ…å†µä¸‹ï¼ŒRedis æ‰€æœ‰è¯»å†™éƒ½ä¼šèµ°ä¸»èŠ‚ç‚¹ï¼Œå‹åŠ›é›†ä¸­åœ¨ä¸»èŠ‚ç‚¹ä¸Šï¼Œslave æ²¡æœ‰å‘æŒ¥ä½œç”¨ã€‚</span><br><span class="line">- é€šè¿‡è®¾ç½® `ReadFrom.REPLICA_PREFERRED`ï¼Œå¯ä»¥è®©<span class="symbol">*</span><span class="symbol">*</span>è¯»è¯·æ±‚ä¼˜å…ˆèµ°ä»èŠ‚ç‚¹<span class="symbol">*</span><span class="symbol">*</span>ï¼Œåªæœ‰å½“ä»èŠ‚ç‚¹éƒ½ä¸å¯ç”¨æ—¶æ‰èµ°ä¸»èŠ‚ç‚¹ï¼ŒçœŸæ­£å®ç° <span class="symbol">*</span><span class="symbol">*</span>è¯»å†™åˆ†ç¦»ã€è´Ÿè½½å‡è¡¡<span class="symbol">*</span><span class="symbol">*</span>ã€‚</span><br><span class="line"></span><br><span class="line">|<span class="string"> ç­–ç•¥å              </span>|<span class="string"> è¡Œä¸ºæè¿°                                                     </span>|</span><br><span class="line">|<span class="string"> ------------------- </span>|<span class="string"> ------------------------------------------------------------ </span>|</span><br><span class="line">|<span class="string"> `MASTER`            </span>|<span class="string"> æ‰€æœ‰è¯·æ±‚åªè¯»ä¸»èŠ‚ç‚¹                                           </span>|</span><br><span class="line">|<span class="string"> `MASTER_PREFERRED`  </span>|<span class="string"> ä¼˜å…ˆè¯»ä¸»èŠ‚ç‚¹ï¼Œä¸»ä¸å¯ç”¨æ—¶æ‰è¯»ä»èŠ‚ç‚¹                           </span>|</span><br><span class="line">|<span class="string"> `REPLICA`           </span>|<span class="string"> æ‰€æœ‰è¯·æ±‚åªè¯»ä»èŠ‚ç‚¹ï¼ˆä¸»èŠ‚ç‚¹æ°¸è¿œä¸ä¼šè¢«ç”¨æ¥è¯»ï¼‰                 </span>|</span><br><span class="line">|<span class="string"> `REPLICA_PREFERRED` </span>|<span class="string"> ä¼˜å…ˆè¯»ä»èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹éƒ½æŒ‚äº†æ‰è¯»ä¸»èŠ‚ç‚¹ï¼ˆæ¨èç­–ç•¥ï¼Œå…¼é¡¾æ€§èƒ½ä¸å¯ç”¨æ€§ï¼‰ </span>|</span><br><span class="line"></span><br><span class="line"><span class="comment">#### æ€»ç»“</span></span><br><span class="line"></span><br><span class="line">è¿™å¥—é…ç½®å®Œæˆäº†ï¼š</span><br><span class="line"></span><br><span class="line">- é€šè¿‡å“¨å…µé›†ç¾¤è‡ªåŠ¨å‘ç°ä¸»ä»èŠ‚ç‚¹</span><br><span class="line">- å®ç°å®¢æˆ·ç«¯è‡ªåŠ¨åˆ‡æ¢ä¸»èŠ‚ç‚¹çš„èƒ½åŠ›</span><br><span class="line">- å®ç°äº†è¯»å†™åˆ†ç¦»ï¼Œæé«˜æ€§èƒ½ä¸å¯ç”¨æ€§</span><br><span class="line"></span><br><span class="line"><span class="comment">## 3.Redisåˆ†ç‰‡é›†ç¾¤</span></span><br><span class="line"></span><br><span class="line">ä¸»ä»æ¨¡å¼å¯ä»¥è§£å†³é«˜å¯ç”¨ã€é«˜å¹¶å‘è¯»çš„é—®é¢˜ã€‚ä½†ä¾ç„¶æœ‰ä¸¤ä¸ªé—®é¢˜æ²¡æœ‰è§£å†³ï¼š</span><br><span class="line"></span><br><span class="line">- æµ·é‡æ•°æ®å­˜å‚¨</span><br><span class="line">- é«˜å¹¶å‘å†™</span><br><span class="line"></span><br><span class="line">![img](https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-465.png)</span><br><span class="line"></span><br><span class="line">è¦è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜å°±éœ€è¦ç”¨åˆ°åˆ†ç‰‡é›†ç¾¤äº†ã€‚åˆ†ç‰‡çš„æ„æ€ï¼Œå°±æ˜¯æŠŠæ•°æ®æ‹†åˆ†å­˜å‚¨åˆ°ä¸åŒèŠ‚ç‚¹ï¼Œè¿™æ ·æ•´ä¸ªé›†ç¾¤çš„å­˜å‚¨æ•°æ®é‡å°±æ›´å¤§äº†ã€‚</span><br><span class="line"></span><br><span class="line">Redisåˆ†ç‰‡é›†ç¾¤çš„ç»“æ„å¦‚å›¾ï¼š</span><br><span class="line"></span><br><span class="line">![img](https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-453-1024x658.png)</span><br><span class="line"></span><br><span class="line">åˆ†ç‰‡é›†ç¾¤ç‰¹å¾ï¼š</span><br><span class="line"></span><br><span class="line">|<span class="string"> ç‰¹æ€§                        </span>|<span class="string"> æè¿°                                   </span>|</span><br><span class="line">|<span class="string"> --------------------------- </span>|<span class="string"> -------------------------------------- </span>|</span><br><span class="line">|<span class="string"> å¤šä¸ª Master                 </span>|<span class="string"> æ¯ä¸ª Master è´Ÿè´£éƒ¨åˆ†æ•°æ®ï¼ˆä¸åŒæ§½ä½ï¼‰   </span>|</span><br><span class="line">|<span class="string"> æ¯ä¸ª Master æœ‰å¤šä¸ª Slave    </span>|<span class="string"> é«˜å¯ç”¨                                 </span>|</span><br><span class="line">|<span class="string"> Master ä¹‹é—´äº’ç›¸ç›‘æ§å¥åº·çŠ¶æ€ </span>|<span class="string"> ç±»ä¼¼äº Sentinel çš„ä½œç”¨                 </span>|</span><br><span class="line">|<span class="string"> å®¢æˆ·ç«¯å¯ä»¥è®¿é—®ä»»æ„èŠ‚ç‚¹      </span>|<span class="string"> èŠ‚ç‚¹ä¼šé‡å®šå‘åˆ°æ­£ç¡®çš„ä¸»èŠ‚ç‚¹ï¼ˆæ•°æ®æ‰€åœ¨ï¼‰ </span>|</span><br><span class="line"></span><br><span class="line"><span class="comment">### 3.1.æ­å»ºåˆ†ç‰‡é›†ç¾¤</span></span><br><span class="line"></span><br><span class="line">Redisåˆ†ç‰‡é›†ç¾¤æœ€å°‘ä¹Ÿéœ€è¦3ä¸ªmasterèŠ‚ç‚¹ï¼Œç”±äºæˆ‘ä»¬çš„æœºå™¨æ€§èƒ½æœ‰é™ï¼Œæˆ‘ä»¬åªç»™æ¯ä¸ªmasteré…ç½®1ä¸ªslaveï¼Œå½¢æˆæœ€å°çš„åˆ†ç‰‡é›†ç¾¤ï¼š</span><br><span class="line"></span><br><span class="line">![img](https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-454-1024x506.png)</span><br><span class="line"></span><br><span class="line">![img](https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-455-1024x488.png)</span><br><span class="line"></span><br><span class="line"><span class="comment">#### 3.1.1.é›†ç¾¤é…ç½®</span></span><br><span class="line"></span><br><span class="line">åˆ†ç‰‡é›†ç¾¤ä¸­çš„RedisèŠ‚ç‚¹å¿…é¡»å¼€å¯é›†ç¾¤æ¨¡å¼ï¼Œä¸€èˆ¬åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢å‚æ•°ï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure>
port 7000<br>cluster-enabled yes<br>cluster-config-file nodes.conf<br>cluster-node-timeout 5000<br>appendonly yes<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">AOF(append only file)æŒä¹…åŒ–ï¼šä»¥ç‹¬ç«‹æ—¥å¿—çš„æ–¹å¼è®°å½•æ¯æ¬¡å†™å‘½ä»¤ï¼Œé‡å¯æ—¶å†é‡æ–°æ‰§è¡ŒAOFæ–‡ä»¶ä¸­å‘½ä»¤ï¼Œè¾¾åˆ°æ¢å¤æ•°æ®çš„ç›®çš„ã€‚ä¸RDBç›¸æ¯”å¯ä»¥ç®€å•æè¿°ä¸ºæ”¹è®°å½•æ•°æ®ä¸ºè®°å½•æ•°æ®äº§ç”Ÿçš„è¿‡ç¨‹</span><br><span class="line"></span><br><span class="line">å…¶ä¸­æœ‰<span class="number">3</span>ä¸ªæˆ‘ä»¬æ²¡è§è¿‡çš„å‚æ•°ï¼š</span><br><span class="line"></span><br><span class="line">- `cluster-enabled`ï¼šæ˜¯å¦å¼€å¯é›†ç¾¤æ¨¡å¼</span><br><span class="line">- `cluster-config-file`ï¼šé›†ç¾¤æ¨¡å¼çš„é…ç½®æ–‡ä»¶åç§°ï¼Œæ— éœ€æ‰‹åŠ¨åˆ›å»ºï¼Œç”±é›†ç¾¤è‡ªåŠ¨ç»´æŠ¤</span><br><span class="line">- `cluster-node-timeout`ï¼šé›†ç¾¤ä¸­èŠ‚ç‚¹ä¹‹é—´å¿ƒè·³è¶…æ—¶æ—¶é—´</span><br><span class="line"></span><br><span class="line">| å‚æ•°                   | å«ä¹‰                                |</span><br><span class="line">| ---------------------- | ----------------------------------- |</span><br><span class="line">| `cluster-enabled yes`  | å¼€å¯é›†ç¾¤æ¨¡å¼                        |</span><br><span class="line">| `cluster-config-file`  | é›†ç¾¤å…ƒæ•°æ®æ–‡ä»¶ï¼ˆç”± Redis è‡ªåŠ¨ç®¡ç†ï¼‰ |</span><br><span class="line">| `cluster-node-timeout` | èŠ‚ç‚¹å¿ƒè·³è¶…æ—¶æ—¶é—´                    |</span><br><span class="line">| `appendonly yes`       | å¼€å¯ AOF æŒä¹…åŒ–ï¼Œä¿éšœæ•°æ®ä¸ä¸¢å¤±     |</span><br><span class="line"></span><br><span class="line">ä¸€èˆ¬æ­å»ºéƒ¨ç½²é›†ç¾¤è‚¯å®šæ˜¯ç»™æ¯ä¸ªèŠ‚ç‚¹éƒ½é…ç½®ä¸Šè¿°å‚æ•°ï¼Œä¸è¿‡è€ƒè™‘åˆ°æˆ‘ä»¬è®¡åˆ’ç”¨`docker-compose`éƒ¨ç½²ï¼Œå› æ­¤å¯ä»¥ç›´æ¥åœ¨å¯åŠ¨å‘½ä»¤ä¸­æŒ‡å®šå‚æ•°ï¼Œå·ä¸ªæ‡’ã€‚</span><br><span class="line"></span><br><span class="line">åœ¨è™šæ‹Ÿæœºçš„`/root`ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª`redis-cluster`ç›®å½•ï¼Œç„¶ååœ¨å…¶ä¸­æ–°å»ºä¸€ä¸ª`docker-compose.yaml`æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure>
version: â€œ3.2â€</li>
</ul>
<p>services:<br>  r1:<br>    image: redis<br>    container_name: r1<br>    network_mode: â€œhostâ€<br>    entrypoint: [â€œredis-serverâ€, â€œâ€”portâ€, â€œ7001â€, â€œâ€”cluster-enabledâ€, â€œyesâ€, â€œâ€”cluster-config-fileâ€, â€œnode.confâ€]<br>  r2:<br>    image: redis<br>    container_name: r2<br>    network_mode: â€œhostâ€<br>    entrypoint: [â€œredis-serverâ€, â€œâ€”portâ€, â€œ7002â€, â€œâ€”cluster-enabledâ€, â€œyesâ€, â€œâ€”cluster-config-fileâ€, â€œnode.confâ€]<br>  r3:<br>    image: redis<br>    container_name: r3<br>    network_mode: â€œhostâ€<br>    entrypoint: [â€œredis-serverâ€, â€œâ€”portâ€, â€œ7003â€, â€œâ€”cluster-enabledâ€, â€œyesâ€, â€œâ€”cluster-config-fileâ€, â€œnode.confâ€]<br>  r4:<br>    image: redis<br>    container_name: r4<br>    network_mode: â€œhostâ€<br>    entrypoint: [â€œredis-serverâ€, â€œâ€”portâ€, â€œ7004â€, â€œâ€”cluster-enabledâ€, â€œyesâ€, â€œâ€”cluster-config-fileâ€, â€œnode.confâ€]<br>  r5:<br>    image: redis<br>    container_name: r5<br>    network_mode: â€œhostâ€<br>    entrypoint: [â€œredis-serverâ€, â€œâ€”portâ€, â€œ7005â€, â€œâ€”cluster-enabledâ€, â€œyesâ€, â€œâ€”cluster-config-fileâ€, â€œnode.confâ€]<br>  r6:<br>    image: redis<br>    container_name: r6<br>    network_mode: â€œhostâ€<br>    entrypoint: [â€œredis-serverâ€, â€œâ€”portâ€, â€œ7006â€, â€œâ€”cluster-enabledâ€, â€œyesâ€, â€œâ€”cluster-config-fileâ€, â€œnode.confâ€]<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**æ³¨æ„**ï¼šä½¿ç”¨Dockeréƒ¨ç½²Redisé›†ç¾¤ï¼Œnetworkæ¨¡å¼å¿…é¡»é‡‡ç”¨hostï¼ˆé‡‡ç”¨ä¸»æœºç½‘ç»œè¿æ¥ï¼Œçœå»äº†ç½‘ç»œè½¬æ¢çš„å¼€é”€ï¼‰</span><br><span class="line"></span><br><span class="line">#### <span class="number">3.1</span><span class="number">.2</span>.å¯åŠ¨é›†ç¾¤</span><br><span class="line"></span><br><span class="line">è¿›å…¥`/root/redis-cluster`ç›®å½•ï¼Œä½¿ç”¨å‘½ä»¤å¯åŠ¨redisï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>docker-compose up -d<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">å¯åŠ¨æˆåŠŸï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤æŸ¥çœ‹å¯åŠ¨è¿›ç¨‹ï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>ps -ef | grep redis</p>
<h1 id="ç»“æœï¼š"><a href="#ç»“æœï¼š" class="headerlink" title="ç»“æœï¼š"></a>ç»“æœï¼š</h1><p>root       4822   4743  0 14:29 ?        00:00:02 redis-server <em>:7002 [cluster]<br>root       4827   4745  0 14:29 ?        00:00:01 redis-server </em>:7005 [cluster]<br>root       4897   4778  0 14:29 ?        00:00:01 redis-server <em>:7004 [cluster]<br>root       4903   4759  0 14:29 ?        00:00:01 redis-server </em>:7006 [cluster]<br>root       4905   4775  0 14:29 ?        00:00:02 redis-server <em>:7001 [cluster]<br>root       4912   4732  0 14:29 ?        00:00:01 redis-server </em>:7003 [cluster]<br><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">å¯ä»¥å‘ç°æ¯ä¸ªredisèŠ‚ç‚¹éƒ½ä»¥<span class="keyword">cluster</span>æ¨¡å¼è¿è¡Œã€‚ä¸è¿‡èŠ‚ç‚¹ä¸èŠ‚ç‚¹ä¹‹é—´å¹¶æœªå»ºç«‹è¿æ¥ã€‚</span><br><span class="line"></span><br><span class="line">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨å‘½ä»¤åˆ›å»ºé›†ç¾¤ï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<h1 id="è¿›å…¥ä»»æ„èŠ‚ç‚¹å®¹å™¨"><a href="#è¿›å…¥ä»»æ„èŠ‚ç‚¹å®¹å™¨" class="headerlink" title="è¿›å…¥ä»»æ„èŠ‚ç‚¹å®¹å™¨"></a>è¿›å…¥ä»»æ„èŠ‚ç‚¹å®¹å™¨</h1><p>docker exec -it r1 bash</p>
<h1 id="ç„¶åï¼Œæ‰§è¡Œå‘½ä»¤"><a href="#ç„¶åï¼Œæ‰§è¡Œå‘½ä»¤" class="headerlink" title="ç„¶åï¼Œæ‰§è¡Œå‘½ä»¤"></a>ç„¶åï¼Œæ‰§è¡Œå‘½ä»¤</h1><p>redis-cli â€”cluster create â€”cluster-replicas 1 \<br>192.168.150.101:7001 192.168.150.101:7002 192.168.150.101:7003 \<br>192.168.150.101:7004 192.168.150.101:7005 192.168.150.101:7006<br><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">å‘½ä»¤è¯´æ˜ï¼š</span><br><span class="line"></span><br><span class="line">- `redis-cli --cluster`ï¼šä»£è¡¨é›†ç¾¤æ“ä½œå‘½ä»¤</span><br><span class="line"></span><br><span class="line">- `create`ï¼šä»£è¡¨æ˜¯åˆ›å»ºé›†ç¾¤</span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  --cluster-replicas <span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<p>   ï¼šæŒ‡å®šé›†ç¾¤ä¸­æ¯ä¸ª</p>
  <figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">master</span></span><br></pre></td></tr></table></figure>
<p>  çš„å‰¯æœ¬ä¸ªæ•°ä¸º1</p>
<ul>
<li>æ­¤æ—¶<code>èŠ‚ç‚¹æ€»æ•° Ã· (replicas + 1)</code> å¾—åˆ°çš„å°±æ˜¯<code>master</code>çš„æ•°é‡<code>n</code>ã€‚å› æ­¤èŠ‚ç‚¹åˆ—è¡¨ä¸­çš„å‰<code>n</code>ä¸ªèŠ‚ç‚¹å°±æ˜¯<code>master</code>ï¼Œå…¶å®ƒèŠ‚ç‚¹éƒ½æ˜¯<code>slave</code>èŠ‚ç‚¹ï¼Œéšæœºåˆ†é…åˆ°ä¸åŒ<code>master</code></li>
</ul>
<p>è¾“å…¥å‘½ä»¤åæ§åˆ¶å°ä¼šå¼¹å‡ºä¸‹é¢çš„ä¿¡æ¯ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-462-1024x730.png" alt="img"></p>
<p>è¿™é‡Œå±•ç¤ºäº†é›†ç¾¤ä¸­<code>master</code>ä¸<code>slave</code>èŠ‚ç‚¹åˆ†é…æƒ…å†µï¼Œå¹¶è¯¢é—®ä½ æ˜¯å¦åŒæ„ã€‚èŠ‚ç‚¹ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>7001</code>æ˜¯<code>master</code>ï¼ŒèŠ‚ç‚¹<code>id</code>å6ä½æ˜¯<code>da134f</code></li>
<li><code>7002</code>æ˜¯<code>master</code>ï¼ŒèŠ‚ç‚¹<code>id</code>å6ä½æ˜¯<code>862fa0</code></li>
<li><code>7003</code>æ˜¯<code>master</code>ï¼ŒèŠ‚ç‚¹<code>id</code>å6ä½æ˜¯<code>ad5083</code></li>
<li><code>7004</code>æ˜¯<code>slave</code>ï¼ŒèŠ‚ç‚¹<code>id</code>å6ä½æ˜¯<code>391f8b</code>ï¼Œè®¤<code>ad5083</code>ï¼ˆ7003ï¼‰ä¸º<code>master</code></li>
<li><code>7005</code>æ˜¯<code>slave</code>ï¼ŒèŠ‚ç‚¹<code>id</code>å6ä½æ˜¯<code>e152cd</code>ï¼Œè®¤<code>da134f</code>ï¼ˆ7001ï¼‰ä¸º<code>master</code></li>
<li><code>7006</code>æ˜¯<code>slave</code>ï¼ŒèŠ‚ç‚¹<code>id</code>å6ä½æ˜¯<code>4a018a</code>ï¼Œè®¤<code>862fa0</code>ï¼ˆ7002ï¼‰ä¸º<code>master</code></li>
</ul>
<p>è¾“å…¥<code>yes</code>ç„¶åå›è½¦ã€‚ä¼šå‘ç°é›†ç¾¤å¼€å§‹åˆ›å»ºï¼Œå¹¶è¾“å‡ºä¸‹åˆ—ä¿¡æ¯ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-463-1024x878.png" alt="img"></p>
<p>æ¥ç€ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‘½ä»¤æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-<span class="keyword">cli</span> -p 7001 <span class="keyword">cluster</span> nodes</span><br></pre></td></tr></table></figure>
<p>ç»“æœï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-464-1024x123.png" alt="img"></p>
<p>ä½ ä¼šçœ‹åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„è§’è‰²ã€çŠ¶æ€ã€IPã€æ§½ä½åˆ†é…ç­‰ä¿¡æ¯ï¼š</p>
<ul>
<li>Master æ‹¥æœ‰å“ˆå¸Œæ§½</li>
<li>Slave ä¼šæœ‰ <code>-&gt; master</code> çš„ä»å±å…³ç³»</li>
</ul>
<p>æ€»ç»“ä¸€ä¸‹</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>ä¼˜åŠ¿</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ¨ªå‘æ‰©å±•</td>
<td>æ¯ä¸ª Master åªè´Ÿè´£ä¸€éƒ¨åˆ†æ•°æ®ï¼ˆslotï¼‰ï¼Œçªç ´å•æœºå®¹é‡é™åˆ¶</td>
</tr>
<tr>
<td>é«˜å¹¶å‘å†™</td>
<td>å†™æ“ä½œæ‰“æ•£åˆ°å¤šä¸ª Master</td>
</tr>
<tr>
<td>é«˜å¯ç”¨</td>
<td>Master æŒ‚äº†ï¼ŒSlave æ¥æ›¿</td>
</tr>
<tr>
<td>è‡ªåŠ¨åˆ†ç‰‡</td>
<td>é€šè¿‡å“ˆå¸Œæ§½æœºåˆ¶è‡ªåŠ¨å†³å®šæ•°æ®æ”¾å“ªä¸ªèŠ‚ç‚¹</td>
</tr>
</tbody>
</table>
</div>
<h3 id="3-2-æ•£åˆ—æ’æ§½"><a href="#3-2-æ•£åˆ—æ’æ§½" class="headerlink" title="3.2.æ•£åˆ—æ’æ§½"></a>3.2.æ•£åˆ—æ’æ§½</h3><p>æ•°æ®è¦åˆ†ç‰‡å­˜å‚¨åˆ°ä¸åŒçš„RedisèŠ‚ç‚¹ï¼Œè‚¯å®šéœ€è¦æœ‰åˆ†ç‰‡çš„ä¾æ®ï¼Œè¿™æ ·ä¸‹æ¬¡æŸ¥è¯¢çš„æ—¶å€™æ‰èƒ½çŸ¥é“å»å“ªä¸ªèŠ‚ç‚¹æŸ¥è¯¢ã€‚å¾ˆå¤šæ•°æ®åˆ†ç‰‡éƒ½ä¼šé‡‡ç”¨ä¸€è‡´æ€§hashç®—æ³•ã€‚è€ŒRedisåˆ™æ˜¯åˆ©ç”¨æ•£åˆ—æ’æ§½ï¼ˆ<strong><code>hash slot</code></strong>ï¼‰çš„æ–¹å¼å®ç°æ•°æ®åˆ†ç‰‡ã€‚</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-471-1024x458.png" alt="img"></p>
<p>åœ¨Redisé›†ç¾¤ä¸­ï¼Œå…±æœ‰16384ä¸ª<code>hash slots</code>ï¼Œé›†ç¾¤ä¸­çš„æ¯ä¸€ä¸ªmasterèŠ‚ç‚¹éƒ½ä¼šåˆ†é…ä¸€å®šæ•°é‡çš„<code>hash slots</code>ã€‚å…·ä½“çš„åˆ†é…åœ¨é›†ç¾¤åˆ›å»ºæ—¶å°±å·²ç»æŒ‡å®šäº†ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-467-1024x292.png" alt="img"></p>
<p>å¦‚å›¾ä¸­æ‰€ç¤ºï¼š</p>
<ul>
<li>Master[0]ï¼Œæœ¬ä¾‹ä¸­å°±æ˜¯7001èŠ‚ç‚¹ï¼Œåˆ†é…åˆ°çš„æ’æ§½æ˜¯0~5460</li>
<li>Master[1]ï¼Œæœ¬ä¾‹ä¸­å°±æ˜¯7002èŠ‚ç‚¹ï¼Œåˆ†é…åˆ°çš„æ’æ§½æ˜¯5461~10922</li>
<li>Master[2]ï¼Œæœ¬ä¾‹ä¸­å°±æ˜¯7003èŠ‚ç‚¹ï¼Œåˆ†é…åˆ°çš„æ’æ§½æ˜¯10923~16383</li>
</ul>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-472-1024x561.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-473.png" alt="img"></p>
<h4 id="å®éªŒï¼šæ’æ§½æœºåˆ¶æ¼”ç¤º"><a href="#å®éªŒï¼šæ’æ§½æœºåˆ¶æ¼”ç¤º" class="headerlink" title="å®éªŒï¼šæ’æ§½æœºåˆ¶æ¼”ç¤º"></a>å®éªŒï¼šæ’æ§½æœºåˆ¶æ¼”ç¤º</h4><p>1.ä½ è¿æ¥åˆ° 7001ï¼Œç„¶åå°è¯•è®¾ç½®ä¸€ä¸ª keyï¼š</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># è¿›å…¥å®¹å™¨</span></span><br><span class="line">docker exec -it <span class="built_in">r1</span> bash</span><br><span class="line"><span class="meta"># è¿›å…¥redis-cli</span></span><br><span class="line">redis-<span class="keyword">cli</span> -p <span class="number">7001</span></span><br><span class="line"><span class="meta"># æµ‹è¯•</span></span><br><span class="line"><span class="keyword">set</span> user jack</span><br></pre></td></tr></table></figure>
<p>ä¼šå‘ç°æŠ¥é”™äº†ï¼š</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">MOVED</span> <span class="number">5474</span> <span class="number">127.0.0.1:7002</span></span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>è®¡ç®—å‡º key=<code>user</code> å±äº slot=5474</li>
<li>5474 å±äº 7002ï¼Œæ‰€ä»¥æç¤ºä½ å»æ‰¾ 7002</li>
</ul>
<p>2.æ­£ç¡®ä½¿ç”¨æ–¹å¼</p>
<p>Redis æä¾›äº†é›†ç¾¤æ¨¡å¼ä¸‹çš„å®¢æˆ·ç«¯æ”¯æŒï¼š<code>-c</code> å‚æ•°</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡7001è¿æ¥é›†ç¾¤</span></span><br><span class="line">redis-cli -c -p <span class="number">7001</span></span><br><span class="line"><span class="comment"># å­˜å…¥æ•°æ®</span></span><br><span class="line">set <span class="keyword">user</span> <span class="title">jack</span></span><br></pre></td></tr></table></figure>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-469-1024x213.png" alt="img"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå®¢æˆ·ç«¯è‡ªåŠ¨è·³è½¬åˆ°äº†<code>5474</code>è¿™ä¸ª<code>slot</code>æ‰€åœ¨çš„<code>7002</code>èŠ‚ç‚¹ã€‚</p>
<p>3.æµ‹è¯•å¸¦ <code>&#123;&#125;</code> çš„ key</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¯•ä¸€ä¸‹keyä¸­å¸¦&#123;&#125;</span></span><br><span class="line"><span class="built_in">set</span> user:&#123;age&#125; 21</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†è¯•ä¸€ä¸‹keyä¸­ä¸å¸¦&#123;&#125;</span></span><br><span class="line"><span class="built_in">set</span> age 20</span><br></pre></td></tr></table></figure>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-470-1024x371.png" alt="img"></p>
<ul>
<li>è¿™ä¸¤ä¸ª key è®¡ç®—å‡ºçš„ slot éƒ½æ˜¯ 741ï¼Œå› æ­¤ä¼šè¢«è·¯ç”±åˆ°åŒä¸€ä¸ªèŠ‚ç‚¹ã€‚</li>
<li>è¿™ä¸ªç‰¹æ€§å¯ä»¥ç”¨äº <strong>ç¡®ä¿å¤šä¸ª key è·¯ç”±åˆ°åŒä¸€ä¸ªèŠ‚ç‚¹</strong>ï¼Œä»¥æ”¯æŒ Lua è„šæœ¬ã€å¤š key æ“ä½œç­‰ã€‚</li>
</ul>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-474.png" alt="img"></p>
<h3 id="3-3-æ•…éšœè½¬ç§»"><a href="#3-3-æ•…éšœè½¬ç§»" class="headerlink" title="3.3.æ•…éšœè½¬ç§»"></a>3.3.æ•…éšœè½¬ç§»</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-477-1024x354.png" alt="img"></p>
<p>åˆ†ç‰‡é›†ç¾¤çš„èŠ‚ç‚¹ä¹‹é—´ä¼šäº’ç›¸é€šè¿‡pingçš„æ–¹å¼åšå¿ƒè·³æ£€æµ‹ï¼Œè¶…æ—¶æœªå›åº”çš„èŠ‚ç‚¹ä¼šè¢«æ ‡è®°ä¸ºä¸‹çº¿çŠ¶æ€ã€‚å½“å‘ç°masterä¸‹çº¿æ—¶ï¼Œä¼šå°†è¿™ä¸ªmasterçš„æŸä¸ªslaveæå‡ä¸ºmasterã€‚</p>
<ol>
<li>è§‚å¯Ÿé›†ç¾¤çŠ¶æ€ï¼ˆä½¿ç”¨ <code>watch</code> å‘½ä»¤ï¼‰</li>
</ol>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">watch</span> docker exec -<span class="keyword">it</span> <span class="built_in">r1</span> redis-cli -p <span class="number">7001</span> cluster nodes</span><br></pre></td></tr></table></figure>
<p>è¿™æ¡å‘½ä»¤çš„æ„æ€æ˜¯ï¼šæ¯éš”å‡ ç§’è‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡ <code>cluster nodes</code> çŠ¶æ€ï¼ŒæŸ¥çœ‹å„èŠ‚ç‚¹è§’è‰²å˜åŒ–ã€‚</p>
<p>2.æ•…æ„è®© 7002 ä¸»èŠ‚ç‚¹â€œå®•æœºâ€è¾“å…¥ä¸‹é¢å‘½ä»¤ï¼š</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it <span class="built_in">r2</span> redis-<span class="keyword">cli</span> -p <span class="number">7002</span> DEBUG <span class="keyword">sleep</span> <span class="number">30</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ¡å‘½ä»¤æ˜¯è®© <code>7002</code> è¿™ä¸ªä¸»èŠ‚ç‚¹â€œç¡çœ â€30ç§’ï¼Œæ¨¡æ‹Ÿå®ƒå®•æœºäº†ï¼ŒæœŸé—´æ— æ³•å“åº”ä»»ä½•è¯·æ±‚æˆ–å¿ƒè·³åŒ…ã€‚</p>
<p>3.Redis å‘ç° 7002 æ— å“åº”ï¼Œè‡ªåŠ¨è§¦å‘æ•…éšœè½¬ç§»</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-475-1024x144.png" alt="img"></p>
<p>è¿‡äº†ä¸€æ®µæ—¶é—´åï¼Œ7002åŸæœ¬çš„å°å¼Ÿ7006å˜æˆäº†<code>master</code>ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-476-1024x140.png" alt="img"></p>
<p>è€Œ7002è¢«æ ‡è®°ä¸º<code>slave</code>ï¼Œè€Œä¸”å…¶<code>master</code>æ­£å¥½æ˜¯7006ï¼Œä¸»ä»åœ°ä½äº’æ¢ã€‚</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-478.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-480.png" alt="img"></p>
<p>Redis åˆ†ç‰‡é›†ç¾¤ä¸­çš„æ•…éšœè½¬ç§»æ˜¯è‡ªåŠ¨å®Œæˆçš„ï¼Œä¸»è¦ä¾æ®ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>æ¡ä»¶</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¿ƒè·³ä¸¢å¤±</td>
<td>èŠ‚ç‚¹é—´å®šæœŸäº’ç›¸ pingï¼Œå¦‚æœè¿ç»­è¶…æ—¶ï¼Œè¯´æ˜å¯èƒ½æ•…éšœ</td>
</tr>
<tr>
<td>è¿‡æœŸæ—¶é—´</td>
<td>èŠ‚ç‚¹ä¸€æ®µæ—¶é—´å†…æœªæ¢å¤ï¼Œåˆ™è¢«æ ‡è®°ä¸º FAIL</td>
</tr>
<tr>
<td>æœ‰ä»èŠ‚ç‚¹</td>
<td>ä»èŠ‚ç‚¹å¯ç”¨ï¼Œæ‰å¯ä»¥è¿›è¡Œä¸»ä»åˆ‡æ¢</td>
</tr>
<tr>
<td>å¤šæ•°èŠ‚ç‚¹ä¸€è‡´</td>
<td>æ•…éšœåˆ¤å®šè¦å¤šæ•°èŠ‚ç‚¹è¾¾æˆå…±è¯†ï¼Œé¿å…è¯¯åˆ¤</td>
</tr>
</tbody>
</table>
</div>
<h3 id="3-4-æ€»ç»“-Redisåˆ†ç‰‡é›†ç¾¤å‡ ä¸ªé¢è¯•é¢˜"><a href="#3-4-æ€»ç»“-Redisåˆ†ç‰‡é›†ç¾¤å‡ ä¸ªé¢è¯•é¢˜" class="headerlink" title="3.4.æ€»ç»“-Redisåˆ†ç‰‡é›†ç¾¤å‡ ä¸ªé¢è¯•é¢˜"></a>3.4.æ€»ç»“-Redisåˆ†ç‰‡é›†ç¾¤å‡ ä¸ªé¢è¯•é¢˜</h3><p>1.Redisåˆ†ç‰‡é›†ç¾¤å¦‚ä½•åˆ¤æ–­æŸä¸ªkeyåº”è¯¥åœ¨å“ªä¸ªå®ä¾‹ï¼Ÿ</p>
<ul>
<li>å°†16384ä¸ªæ’æ§½åˆ†é…åˆ°ä¸åŒçš„å®ä¾‹</li>
<li>æ ¹æ®keyè®¡ç®—å“ˆå¸Œå€¼ï¼Œå¯¹16384å–ä½™</li>
<li>ä½™æ•°ä½œä¸ºæ’æ§½ï¼Œå¯»æ‰¾æ’æ§½æ‰€åœ¨å®ä¾‹å³å¯</li>
</ul>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-481-1024x159.png" alt="img"></p>
<p>2.å¦‚ä½•å°†åŒä¸€ç±»æ•°æ®å›ºå®šçš„ä¿å­˜åœ¨åŒä¸€ä¸ªRediså®ä¾‹ï¼Ÿ</p>
<ul>
<li>Redisè®¡ç®—keyçš„æ’æ§½å€¼æ—¶ä¼šåˆ¤æ–­keyä¸­æ˜¯å¦åŒ…å«<code>&#123;&#125;</code>ï¼Œå¦‚æœæœ‰åˆ™åŸºäº<code>&#123;&#125;</code>å†…çš„å­—ç¬¦è®¡ç®—æ’æ§½</li>
<li>æ•°æ®çš„keyä¸­å¯ä»¥åŠ å…¥<code>&#123;ç±»å‹&#125;</code>ï¼Œä¾‹å¦‚keyéƒ½ä»¥<code>&#123;typeId&#125;</code>ä¸ºå‰ç¼€ï¼Œè¿™æ ·åŒç±»å‹æ•°æ®è®¡ç®—çš„æ’æ§½ä¸€å®šç›¸åŒ</li>
</ul>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-482.png" alt="img"></p>
<h3 id="3-5-Javaå®¢æˆ·ç«¯è¿æ¥åˆ†ç‰‡é›†ç¾¤"><a href="#3-5-Javaå®¢æˆ·ç«¯è¿æ¥åˆ†ç‰‡é›†ç¾¤" class="headerlink" title="3.5.Javaå®¢æˆ·ç«¯è¿æ¥åˆ†ç‰‡é›†ç¾¤"></a>3.5.Javaå®¢æˆ·ç«¯è¿æ¥åˆ†ç‰‡é›†ç¾¤</h3><p>RedisTemplateåº•å±‚åŒæ ·åŸºäºlettuceå®ç°äº†åˆ†ç‰‡é›†ç¾¤çš„æ”¯æŒï¼Œè€Œä½¿ç”¨çš„æ­¥éª¤ä¸å“¨å…µæ¨¡å¼åŸºæœ¬ä¸€è‡´ï¼Œå‚è€ƒ<code>2.5èŠ‚</code>ï¼š</p>
<p>1ï¼‰å¼•å…¥redisçš„starterä¾èµ–</p>
<p>2ï¼‰é…ç½®åˆ†ç‰‡é›†ç¾¤åœ°å€</p>
<p>3ï¼‰é…ç½®è¯»å†™åˆ†ç¦»</p>
<p>ä¸å“¨å…µæ¨¡å¼ç›¸æ¯”ï¼Œå…¶ä¸­åªæœ‰åˆ†ç‰‡é›†ç¾¤çš„é…ç½®æ–¹å¼ç•¥æœ‰å·®å¼‚ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">spring</span><span class="punctuation">:</span></span><br><span class="line">  <span class="attribute">redis</span><span class="punctuation">:</span></span><br><span class="line">    <span class="attribute">cluster</span><span class="punctuation">:</span></span><br><span class="line">      <span class="attribute">nodes</span><span class="punctuation">:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">192.168.150.101:7001</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">192.168.150.101:7002</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">192.168.150.101:7003</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">192.168.150.101:8001</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">192.168.150.101:8002</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">192.168.150.101:8003</span></span><br></pre></td></tr></table></figure>
<h2 id="4-Redisæ•°æ®ç»“æ„"><a href="#4-Redisæ•°æ®ç»“æ„" class="headerlink" title="4.Redisæ•°æ®ç»“æ„"></a>4.Redisæ•°æ®ç»“æ„</h2><p>æˆ‘ä»¬å¸¸ç”¨çš„Redisæ•°æ®ç±»å‹æœ‰5ç§ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>æ•°æ®ç»“æ„</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody>
<tr>
<td>String</td>
<td>æœ€å¸¸è§çš„é”®å€¼å¯¹å­˜å‚¨ï¼Œæ¯”å¦‚è®¡æ•°ã€ç¼“å­˜ç­‰</td>
</tr>
<tr>
<td>List</td>
<td>æœ‰åºåˆ—è¡¨ï¼Œå¦‚æ¶ˆæ¯é˜Ÿåˆ—</td>
</tr>
<tr>
<td>Set</td>
<td>æ— åºä¸é‡å¤é›†åˆï¼Œå¦‚æ ‡ç­¾ç³»ç»Ÿ</td>
</tr>
<tr>
<td>SortedSet</td>
<td>æœ‰åºé›†åˆï¼Œå¯æŒ‰æƒé‡æ’åº</td>
</tr>
<tr>
<td>Hash</td>
<td>ç±»ä¼¼äºJavaçš„Mapç»“æ„ï¼Œé€‚åˆå­˜å‚¨å¯¹è±¡</td>
</tr>
</tbody>
</table>
</div>
<p>è¿˜æœ‰ä¸€äº›é«˜çº§æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚Bitmapã€HyperLogLogã€GEOç­‰ï¼Œå…¶åº•å±‚éƒ½æ˜¯åŸºäºä¸Šè¿°5ç§åŸºæœ¬æ•°æ®ç±»å‹ã€‚å› æ­¤åœ¨Redisçš„æºç ä¸­ï¼Œå…¶å®åªæœ‰5ç§æ•°æ®ç±»å‹ã€‚</p>
<h3 id="4-1-RedisObjectï¼šRedisä¸­çš„â€œå¯¹è±¡å¤´â€"><a href="#4-1-RedisObjectï¼šRedisä¸­çš„â€œå¯¹è±¡å¤´â€" class="headerlink" title="4.1.RedisObjectï¼šRedisä¸­çš„â€œå¯¹è±¡å¤´â€"></a>4.1.RedisObjectï¼šRedisä¸­çš„â€œå¯¹è±¡å¤´â€</h3><p>Redis ä¸­æ¯ä¸ªé”®å€¼å¯¹ï¼ˆæ— è®ºç±»å‹ï¼‰éƒ½è¢«å°è£…æˆä¸€ä¸ªé€šç”¨çš„ç»“æ„ <code>RedisObject</code>ã€‚å®ƒåƒ Java ä¸­çš„å¯¹è±¡ï¼ŒCè¯­è¨€ä¸­çš„ structã€‚</p>
<p>å®ƒæœ¬èº«ä¸ä¿å­˜æ•°æ®ï¼Œè€Œæ˜¯é€šè¿‡ <code>ptr</code> æŒ‡é’ˆæŒ‡å‘çœŸæ­£çš„æ•°æ®åœ°å€ã€‚</p>
<p>ç»“æ„å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-483-1024x352.png" alt="img"></p>
<p>RedisObjectçš„å…³é”®å­—æ®µï¼š</p>
<ul>
<li><code>type</code>: æ•°æ®ç±»å‹ï¼ˆStringã€Listç­‰ï¼‰</li>
<li><code>encoding</code>: æ•°æ®çš„ç¼–ç æ–¹å¼ï¼ˆæ¯”å¦‚ intã€embstrã€ziplist ç­‰ï¼‰</li>
<li><code>ptr</code>: æŒ‡å‘çœŸæ­£çš„æ•°æ®åœ°å€</li>
</ul>
<p><strong>è¯´æ˜</strong>ï¼š<br>Redis å¯¹ä¸åŒç±»å‹æ•°æ®ä¼šé‡‡ç”¨ä¸åŒçš„ç¼–ç æ–¹å¼ï¼Œæå‡å†…å­˜æ•ˆç‡ä¸æ“ä½œæ•ˆç‡ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°æ•´ä¸ªç»“æ„ä½“ä¸­å¹¶ä¸åŒ…å«çœŸå®çš„æ•°æ®ï¼Œä»…ä»…æ˜¯å¯¹è±¡å¤´ä¿¡æ¯ï¼Œå†…å­˜å ç”¨çš„å¤§å°ä¸º4+4+24+32+64 = 128bit</p>
<p>ä¹Ÿå°±æ˜¯16å­—èŠ‚ï¼Œç„¶åæŒ‡é’ˆ<code>ptr</code>æŒ‡é’ˆæŒ‡å‘çš„æ‰æ˜¯çœŸå®æ•°æ®å­˜å‚¨çš„å†…å­˜åœ°å€ã€‚æ‰€ä»¥RedisObjectçš„å†…å­˜å¼€é”€æ˜¯å¾ˆå¤§çš„ã€‚</p>
<p>å±æ€§ä¸­çš„<code>encoding</code>å°±æ˜¯å½“å‰å¯¹è±¡åº•å±‚é‡‡ç”¨çš„<strong>æ•°æ®ç»“æ„</strong>æˆ–<strong>ç¼–ç æ–¹å¼</strong>ï¼Œå¯é€‰çš„æœ‰12ç§ä¹‹å¤šï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th><strong>ç¼–å·</strong></th>
<th><strong>ç¼–ç æ–¹å¼</strong></th>
<th><strong>è¯´æ˜</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>OBJ_ENCODING_RAW</td>
<td>rawç¼–ç åŠ¨æ€å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td>1</td>
<td>OBJ_ENCODING_INT</td>
<td>longç±»å‹çš„æ•´æ•°çš„å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td>2</td>
<td>OBJ_ENCODING_HT</td>
<td>hashè¡¨ï¼ˆä¹Ÿå«dictï¼‰</td>
</tr>
<tr>
<td>3</td>
<td>OBJ_ENCODING_ZIPMAP</td>
<td>å·²åºŸå¼ƒ</td>
</tr>
<tr>
<td>4</td>
<td>OBJ_ENCODING_LINKEDLIST</td>
<td>åŒç«¯é“¾è¡¨</td>
</tr>
<tr>
<td>5</td>
<td>OBJ_ENCODING_ZIPLIST</td>
<td>å‹ç¼©åˆ—è¡¨</td>
</tr>
<tr>
<td>6</td>
<td>OBJ_ENCODING_INTSET</td>
<td>æ•´æ•°é›†åˆ</td>
</tr>
<tr>
<td>7</td>
<td>OBJ_ENCODING_SKIPLIST</td>
<td>è·³è¡¨</td>
</tr>
<tr>
<td>8</td>
<td>OBJ_ENCODING_EMBSTR</td>
<td>embstrç¼–ç çš„åŠ¨æ€å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td>9</td>
<td>OBJ_ENCODING_QUICKLIST</td>
<td>å¿«é€Ÿåˆ—è¡¨</td>
</tr>
<tr>
<td>10</td>
<td>OBJ_ENCODING_STREAM</td>
<td>Streamæµ</td>
</tr>
<tr>
<td>11</td>
<td>OBJ_ENCODING_LISTPACK</td>
<td>ç´§å‡‘åˆ—è¡¨</td>
</tr>
</tbody>
</table>
</div>
<p>Redisä¸­çš„5ç§ä¸åŒçš„æ•°æ®ç±»å‹é‡‡ç”¨çš„åº•å±‚æ•°æ®ç»“æ„å’Œç¼–ç æ–¹å¼å¦‚ä¸‹ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th><strong>æ•°æ®ç±»å‹</strong></th>
<th><strong>ç¼–ç æ–¹å¼</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>STRING</td>
<td><code>int</code>ã€<code>embstr</code>ã€<code>raw</code></td>
</tr>
<tr>
<td>LIST</td>
<td><code>LinkedListå’ŒZipList</code>(3.2ä»¥å‰)ã€<code>QuickList</code>ï¼ˆ3.2ä»¥åï¼‰</td>
</tr>
<tr>
<td>SET</td>
<td><code>intset</code>ã€<code>HT</code></td>
</tr>
<tr>
<td>ZSET</td>
<td><code>ZipList</code>ï¼ˆ7.0ä»¥å‰ï¼‰ã€<code>Listpack</code>ï¼ˆ7.0ä»¥åï¼‰ã€<code>HT</code>ã€<code>SkipList</code></td>
</tr>
<tr>
<td>HASH</td>
<td><code>ZipList</code>ï¼ˆ7.0ä»¥å‰ï¼‰ã€<code>Listpack</code>ï¼ˆ7.0ä»¥åï¼‰ã€<code>HT</code></td>
</tr>
</tbody>
</table>
</div>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-484.png" alt="img"></p>
<h3 id="4-2-SkipList"><a href="#4-2-SkipList" class="headerlink" title="4.2.SkipList"></a>4.2.SkipList</h3><p>SkipList æ˜¯ä¸€ä¸ª<strong>å¸¦æœ‰å¤šçº§ç´¢å¼•</strong>çš„é“¾è¡¨ï¼Œé€‚ç”¨äºéœ€è¦â€œæœ‰åºè®¿é—®â€å’Œâ€œå¿«é€ŸæŸ¥æ‰¾â€çš„åœºæ™¯ï¼Œ<strong>Redis çš„ SortedSet å°±æ˜¯ç”¨å®ƒå®ç°çš„</strong>ã€‚</p>
<p>è·³è¡¨ vs æ™®é€šé“¾è¡¨ï¼š</p>
<ul>
<li>æ™®é€šé“¾è¡¨æŸ¥æ‰¾æ…¢ï¼Œè¦æŒ¨ä¸ªæ‰¾</li>
<li>è·³è¡¨æ”¯æŒè·³è·ƒæŸ¥æ‰¾ï¼Œå¤šä¸ªâ€œé«˜åº¦â€ï¼Œç±»ä¼¼ç”µæ¢¯ç»“æ„ï¼ŒæŸ¥æ‰¾æ•ˆç‡æ›´é«˜ï¼ˆå¯¹æ ‡ BSTï¼‰</li>
</ul>
<p>ä¼ ç»Ÿé“¾è¡¨åªæœ‰æŒ‡å‘å‰åå…ƒç´ çš„æŒ‡é’ˆï¼Œå› æ­¤åªèƒ½é¡ºåºä¾æ¬¡è®¿é—®ã€‚å¦‚æœæŸ¥æ‰¾çš„å…ƒç´ åœ¨é“¾è¡¨ä¸­é—´ï¼ŒæŸ¥è¯¢çš„æ•ˆç‡ä¼šæ¯”è¾ƒä½ã€‚è€ŒSkipListåˆ™ä¸åŒï¼Œå®ƒå†…éƒ¨åŒ…å«è·¨åº¦ä¸åŒçš„å¤šçº§æŒ‡é’ˆï¼Œå¯ä»¥è®©æˆ‘ä»¬è·³è·ƒæŸ¥æ‰¾é“¾è¡¨ä¸­é—´çš„å…ƒç´ ï¼Œæ•ˆç‡éå¸¸é«˜ã€‚</p>
<p>å…¶ç»“æ„å¦‚å›¾ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-485-1024x337.png" alt="img"></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°1å·å…ƒç´ å°±æœ‰æŒ‡å‘3ã€5ã€10çš„å¤šä¸ªæŒ‡é’ˆï¼ŒæŸ¥è¯¢æ—¶å°±å¯ä»¥è·³è·ƒæŸ¥æ‰¾ã€‚ä¾‹å¦‚æˆ‘ä»¬è¦æ‰¾å¤§å°ä¸º14çš„å…ƒç´ ï¼ŒæŸ¥æ‰¾çš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-486-1024x339.png" alt="img"></p>
<ul>
<li>é¦–å…ˆæ‰¾å…ƒç´ 1èŠ‚ç‚¹æœ€é«˜çº§æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯4çº§æŒ‡é’ˆï¼Œèµ·å§‹å…ƒç´ å¤§å°ä¸º1ï¼ŒæŒ‡é’ˆè·¨åº¦ä¸º9ï¼Œå¯ä»¥åˆ¤æ–­å‡ºç›®æ ‡å…ƒç´ å¤§å°ä¸º10ã€‚ç”±äº14æ¯”10å¤§ï¼Œè‚¯å®šè¦ä»10è¿™ä¸ªå…ƒç´ å‘ä¸‹æ¥ç€æ‰¾ã€‚</li>
<li>æ‰¾åˆ°10è¿™ä¸ªå…ƒç´ ï¼Œå‘ç°10è¿™ä¸ªå…ƒç´ çš„æœ€é«˜çº§æŒ‡é’ˆè·¨åº¦ä¸º5ï¼Œåˆ¤æ–­å‡ºç›®æ ‡å…ƒç´ å¤§å°ä¸º15ï¼Œå¤§äº14ï¼Œéœ€è¦åˆ¤æ–­ä¸‹çº§æŒ‡é’ˆ</li>
<li>10è¿™ä¸ªå…ƒç´ çš„2çº§æŒ‡é’ˆè·¨åº¦ä¸º3ï¼Œåˆ¤æ–­å‡ºç›®æ ‡å…ƒç´ ä¸º13ï¼Œå°äº14ï¼Œå› æ­¤è¦åŸºäºå…ƒç´ 13æ¥ç€æ‰¾</li>
<li>13è¿™ä¸ªå…ƒç´ æœ€é«˜çº§çº§æŒ‡é’ˆè·¨åº¦ä¸º2ï¼Œåˆ¤æ–­å‡ºç›®æ ‡å…ƒç´ ä¸º15ï¼Œæ¯”14å¤§ï¼Œéœ€è¦åˆ¤æ–­ä¸‹çº§æŒ‡é’ˆã€‚</li>
<li>13çš„ä¸‹çº§æŒ‡é’ˆè·¨åº¦ä¸º1ï¼Œå› æ­¤ç›®æ ‡å…ƒç´ æ˜¯14ï¼Œåˆšå¥½äºç›®æ ‡ä¸€è‡´ï¼Œæ‰¾åˆ°ã€‚</li>
</ul>
<p>è¿™ç§å¤šçº§æŒ‡é’ˆçš„æŸ¥è¯¢æ–¹å¼å°±é¿å…äº†ä¼ ç»Ÿé“¾è¡¨çš„é€ä¸ªéå†å¯¼è‡´çš„æŸ¥è¯¢æ•ˆç‡ä¸‹é™é—®é¢˜ã€‚åœ¨å¯¹æœ‰åºæ•°æ®åšéšæœºæŸ¥è¯¢å’Œæ’åºæ—¶æ•ˆç‡éå¸¸é«˜ã€‚</p>
<p>è·³è¡¨çš„ç»“æ„ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">zskiplist</span> &#123;</span><br><span class="line">    <span class="comment">// å¤´å°¾èŠ‚ç‚¹æŒ‡é’ˆ</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">zskiplistNode</span> *header, *tail;</span><br><span class="line">    <span class="comment">// èŠ‚ç‚¹æ•°é‡</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> length;</span><br><span class="line">    <span class="comment">// æœ€å¤§çš„ç´¢å¼•å±‚çº§</span></span><br><span class="line">    <span class="type">int</span> level;</span><br><span class="line">&#125; zskiplist;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°SkipListä¸»è¦å±æ€§æ˜¯headerå’Œtailï¼Œä¹Ÿå°±æ˜¯å¤´å°¾æŒ‡é’ˆï¼Œå› æ­¤å®ƒæ˜¯æ”¯æŒåŒå‘éå†çš„ã€‚</p>
<p>è·³è¡¨ä¸­èŠ‚ç‚¹çš„ç»“æ„ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">zskiplistNode</span> &#123;</span><br><span class="line">    sds ele; <span class="comment">// èŠ‚ç‚¹å­˜å‚¨çš„å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="type">double</span> score;<span class="comment">// èŠ‚ç‚¹åˆ†æ•°ï¼Œæ’åºã€æŸ¥æ‰¾ç”¨</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">zskiplistNode</span> *backward; <span class="comment">// å‰ä¸€ä¸ªèŠ‚ç‚¹æŒ‡é’ˆ</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">zskiplistLevel</span> &#123;</span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">zskiplistNode</span> *forward; <span class="comment">// ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æŒ‡é’ˆ</span></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">long</span> span; <span class="comment">// ç´¢å¼•è·¨åº¦</span></span><br><span class="line">    &#125; level[]; <span class="comment">// å¤šçº§ç´¢å¼•æ•°ç»„</span></span><br><span class="line">&#125; zskiplistNode;</span><br></pre></td></tr></table></figure>
<p>æ¯ä¸ªèŠ‚ç‚¹ä¸­éƒ½åŒ…å«eleå’Œscoreä¸¤ä¸ªå±æ€§ï¼Œå…¶ä¸­scoreæ˜¯å¾—åˆ†ï¼Œä¹Ÿå°±æ˜¯èŠ‚ç‚¹æ’åºçš„ä¾æ®ã€‚eleåˆ™æ˜¯èŠ‚ç‚¹å­˜å‚¨çš„å­—ç¬¦ä¸²æ•°æ®æŒ‡é’ˆã€‚</p>
<p>å…¶å†…å­˜ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-487-1024x418.png" alt="img"></p>
<h3 id="4-3-SortedSet"><a href="#4-3-SortedSet" class="headerlink" title="4.3.SortedSet"></a>4.3.SortedSet</h3><p>SortedSet æ˜¯ Redis ä¸­ç”¨äºæ’åºçš„é›†åˆï¼Œå…¶ç‰¹ç‚¹æ˜¯ï¼š</p>
<ul>
<li>æ¯ä¸ªå…ƒç´ åŒ…å« <code>value + score</code>ã€‚</li>
<li>æ”¯æŒæ ¹æ® <code>score</code> æ’åºï¼Œå¹¶æ ¹æ® <code>value</code> å¿«é€ŸæŸ¥æ‰¾ã€‚</li>
</ul>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-491-1024x467.png" alt="img"></p>
<p>ä¸ºå®ç°ä¸Šè¿°åŠŸèƒ½ï¼Œåº•å±‚ç»“æ„ç”¨äº†ä¸¤ç§ï¼š</p>
<ol>
<li><strong>HashTable</strong>ï¼ˆæŸ¥æ‰¾ score by valueï¼‰</li>
<li><strong>SkipList</strong>ï¼ˆæ ¹æ® score æ’åºå’ŒèŒƒå›´æŸ¥è¯¢ï¼‰</li>
</ol>
<p>æ‰€ä»¥ï¼Œå®ƒç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">typedef <span class="keyword">struct</span> <span class="keyword">zset</span> &#123;</span><br><span class="line">    <span class="built_in">dict</span> <span class="operator">*</span><span class="built_in">dict</span>;        <span class="comment">// HashTable æ˜ å°„å…³ç³»</span></span><br><span class="line">    zskiplist <span class="operator">*</span>zsl;    <span class="comment">// è·³è¡¨ï¼Œç”¨äºæ’åº</span></span><br><span class="line">&#125; zset;</span><br></pre></td></tr></table></figure>
<p>å…¶å†…å­˜ç»“æ„å¦‚å›¾ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-488-1024x548.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-489-1024x600.png" alt="img"></p>
<p><strong>é¢è¯•é¢˜</strong>ï¼šRedisçš„<code>SortedSet</code>åº•å±‚çš„æ•°æ®ç»“æ„æ˜¯æ€æ ·çš„ï¼Ÿ</p>
<p><strong>ç­”</strong>ï¼šSortedSetæ˜¯æœ‰åºé›†åˆï¼Œåº•å±‚çš„å­˜å‚¨çš„æ¯ä¸ªæ•°æ®éƒ½åŒ…å«elementå’Œscoreä¸¤ä¸ªå€¼ã€‚scoreæ˜¯å¾—åˆ†ï¼Œelementåˆ™æ˜¯å­—ç¬¦ä¸²å€¼ã€‚SortedSetä¼šæ ¹æ®æ¯ä¸ªelementçš„scoreå€¼æ’åºï¼Œå½¢æˆæœ‰åºé›†åˆã€‚</p>
<p>å®ƒæ”¯æŒçš„æ“ä½œå¾ˆå¤šï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>æ ¹æ®elementæŸ¥è¯¢scoreå€¼</li>
<li>æŒ‰ç…§scoreå€¼å‡åºæˆ–é™åºæŸ¥è¯¢element</li>
</ul>
<p>è¦å®ç°æ ¹æ®elementæŸ¥è¯¢å¯¹åº”çš„scoreå€¼ï¼Œå°±å¿…é¡»å®ç°elementä¸scoreä¹‹é—´çš„é”®å€¼æ˜ å°„ã€‚SortedSetåº•å±‚æ˜¯åŸºäº<strong>HashTable</strong>æ¥å®ç°çš„ã€‚</p>
<p>è¦å®ç°å¯¹scoreå€¼æ’åºï¼Œå¹¶ä¸”æŸ¥è¯¢æ•ˆç‡è¿˜é«˜ï¼Œå°±éœ€è¦æœ‰ä¸€ç§é«˜æ•ˆçš„æœ‰åºæ•°æ®ç»“æ„ï¼ŒSortedSetæ˜¯åŸºäº<strong>è·³è¡¨</strong>å®ç°çš„ã€‚</p>
<p>åŠ åˆ†é¡¹ï¼šå› ä¸ºSortedSetåº•å±‚éœ€è¦ç”¨åˆ°ä¸¤ç§æ•°æ®ç»“æ„ï¼Œå¯¹å†…å­˜å ç”¨æ¯”è¾ƒé«˜ã€‚å› æ­¤Redisåº•å±‚ä¼šå¯¹SortedSetä¸­çš„å…ƒç´ å¤§å°åšåˆ¤æ–­ã€‚å¦‚æœ<strong>å…ƒç´ å¤§å°**</strong>å°äº128<strong>ä¸”</strong>æ¯ä¸ªå…ƒç´ éƒ½å°äº64å­—èŠ‚<strong>ï¼ŒSortedSetåº•å±‚ä¼šé‡‡ç”¨</strong>ZipList<strong>ï¼Œä¹Ÿå°±æ˜¯</strong>å‹ç¼©åˆ—<strong>è¡¨æ¥ä»£æ›¿</strong>HashTable<strong>å’Œ</strong>SkipList**</p>
<p>ä¸è¿‡ï¼Œ<code>ZipList</code>å­˜åœ¨è¿é”æ›´æ–°é—®é¢˜ï¼Œå› æ­¤è€Œåœ¨Redis7.0ç‰ˆæœ¬ä»¥åï¼Œ<code>ZipList</code>åˆè¢«æ›¿æ¢ä¸º<strong>Listpack</strong>ï¼ˆç´§å‡‘åˆ—è¡¨ï¼‰ã€‚</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-490-1024x324.png" alt="img"></p>
<h4 id="é¢è¯•é¢˜ä¸ºä»€ä¹ˆ-ZSet-è¦ç”¨è·³è¡¨ï¼Œè€Œä¸æ˜¯å¹³è¡¡æ ‘ï¼ˆå¦‚-AVL-æˆ–çº¢é»‘æ ‘ï¼‰ï¼Ÿ"><a href="#é¢è¯•é¢˜ä¸ºä»€ä¹ˆ-ZSet-è¦ç”¨è·³è¡¨ï¼Œè€Œä¸æ˜¯å¹³è¡¡æ ‘ï¼ˆå¦‚-AVL-æˆ–çº¢é»‘æ ‘ï¼‰ï¼Ÿ" class="headerlink" title="é¢è¯•é¢˜ä¸ºä»€ä¹ˆ ZSet è¦ç”¨è·³è¡¨ï¼Œè€Œä¸æ˜¯å¹³è¡¡æ ‘ï¼ˆå¦‚ AVL æˆ–çº¢é»‘æ ‘ï¼‰ï¼Ÿ"></a>é¢è¯•é¢˜ä¸ºä»€ä¹ˆ ZSet è¦ç”¨è·³è¡¨ï¼Œè€Œä¸æ˜¯å¹³è¡¡æ ‘ï¼ˆå¦‚ AVL æˆ–çº¢é»‘æ ‘ï¼‰ï¼Ÿ</h4><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-492-1024x710.png" alt="img"></p>
<h2 id="5-Rediså†…å­˜å›æ”¶"><a href="#5-Rediså†…å­˜å›æ”¶" class="headerlink" title="5.Rediså†…å­˜å›æ”¶"></a>5.Rediså†…å­˜å›æ”¶</h2><p>Redisä¹‹æ‰€ä»¥æ€§èƒ½å¼ºï¼Œæœ€ä¸»è¦çš„åŸå› å°±æ˜¯åŸºäºå†…å­˜å­˜å‚¨ã€‚ç„¶è€Œå•èŠ‚ç‚¹çš„Rediså…¶å†…å­˜å¤§å°ä¸å®œè¿‡å¤§ï¼Œä¼šå½±å“æŒä¹…åŒ–æˆ–ä¸»ä»åŒæ­¥æ€§èƒ½ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹redis.confæ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢çš„é…ç½®æ¥é…ç½®Redisçš„æœ€å¤§å†…å­˜ï¼š</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">maxmemory</span> <span class="number">1</span>gb</span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-495.png" alt="img"></p>
<h3 id="5-1-å†…å­˜è¿‡æœŸå¤„ç†"><a href="#5-1-å†…å­˜è¿‡æœŸå¤„ç†" class="headerlink" title="5.1.å†…å­˜è¿‡æœŸå¤„ç†"></a>5.1.å†…å­˜è¿‡æœŸå¤„ç†</h3><p>å­˜å…¥Redisä¸­çš„æ•°æ®å¯ä»¥é…ç½®è¿‡æœŸæ—¶é—´ï¼Œåˆ°æœŸåå†æ¬¡è®¿é—®ä¼šå‘ç°è¿™äº›æ•°æ®éƒ½ä¸å­˜åœ¨äº†ï¼Œä¹Ÿå°±æ˜¯è¢«è¿‡æœŸæ¸…ç†äº†ã€‚</p>
<h4 id="5-1-1-è¿‡æœŸå‘½ä»¤"><a href="#5-1-1-è¿‡æœŸå‘½ä»¤" class="headerlink" title="5.1.1.è¿‡æœŸå‘½ä»¤"></a>5.1.1.è¿‡æœŸå‘½ä»¤</h4><p>Redisä¸­é€šè¿‡<code>expire</code>å‘½ä»¤å¯ä»¥ç»™KEYè®¾ç½®<code>TTL</code>ï¼ˆè¿‡æœŸæ—¶é—´ï¼‰ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å†™å…¥ä¸€æ¡æ•°æ®</span></span><br><span class="line"><span class="built_in">set</span> <span class="built_in">num</span> <span class="number">123</span></span><br><span class="line"><span class="comment"># è®¾ç½®20ç§’è¿‡æœŸæ—¶é—´</span></span><br><span class="line">expire <span class="built_in">num</span> <span class="number">20</span></span><br></pre></td></tr></table></figure>
<p>ä¸è¿‡setå‘½ä»¤æœ¬èº«ä¹Ÿå¯ä»¥æ”¯æŒè¿‡æœŸæ—¶é—´çš„è®¾ç½®ï¼š</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å†™å…¥ä¸€æ¡æ•°æ®å¹¶è®¾ç½®20sè¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="built_in">set</span> <span class="built_in">num</span> EX <span class="number">20</span></span><br></pre></td></tr></table></figure>
<p>å½“è¿‡æœŸæ—¶é—´åˆ°äº†ä»¥åï¼Œå†å»æŸ¥è¯¢æ•°æ®ï¼Œä¼šå‘ç°æ•°æ®å·²ç»ä¸å­˜åœ¨ã€‚</p>
<h4 id="5-1-2-è¿‡æœŸç­–ç•¥"><a href="#5-1-2-è¿‡æœŸç­–ç•¥" class="headerlink" title="5.1.2.è¿‡æœŸç­–ç•¥"></a>5.1.2.è¿‡æœŸç­–ç•¥</h4><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼š</p>
<ul>
<li>Rediså¦‚ä½•åˆ¤æ–­ä¸€ä¸ªKEYæ˜¯å¦è¿‡æœŸå‘¢ï¼Ÿ</li>
<li>Redisåˆæ˜¯ä½•æ—¶åˆ é™¤è¿‡æœŸKEYçš„å‘¢ï¼Ÿ</li>
</ul>
<p>Redisä¸ç®¡æœ‰å¤šå°‘ç§æ•°æ®ç±»å‹ï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ª<code>KEY-VALUE</code>çš„é”®å€¼å‹æ•°æ®åº“ï¼Œè€Œè¿™ç§é”®å€¼æ˜ å°„åº•å±‚æ­£å¼åŸºäºHashTableæ¥å®ç°çš„ï¼Œåœ¨Redisä¸­å«åšDict.</p>
<p>æ¥çœ‹ä¸‹RedisDBçš„åº•å±‚æºç ï¼š</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">typedef struct redisDb &#123;</span><br><span class="line">    dict dict;                 / <span class="type">The</span> keyspace for this <span class="type">DB</span> , ä¹Ÿå°±æ˜¯å­˜æ”¾<span class="type">KEY</span>å’Œ<span class="type">VALUE</span>çš„å“ˆå¸Œè¡¨*/</span><br><span class="line">    dict *expires;              /* åŒæ ·æ˜¯å“ˆå¸Œè¡¨ï¼Œä½†ä¿å­˜çš„æ˜¯è®¾ç½®äº†<span class="type">TTL</span>çš„<span class="type">KEY</span>ï¼ŒåŠå…¶åˆ°æœŸæ—¶é—´*/</span><br><span class="line">    dict *blocking_keys;        /* <span class="type">Keys</span> with clients waiting for data (<span class="type">BLPOP</span>)*/</span><br><span class="line">    dict *ready_keys;           /* <span class="type">Blocked</span> keys that received a <span class="type">PUSH</span> */</span><br><span class="line">    dict *watched_keys;         /* <span class="type">WATCHED</span> keys for <span class="type">MULTI</span>/<span class="type">EXEC</span> <span class="type">CAS</span> /</span><br><span class="line">    int id;                     / <span class="type">Database</span> <span class="type">ID</span>, 0 ~ 15 /</span><br><span class="line">    long long avg_ttl;          / <span class="type">Average</span> <span class="type">TTL</span>, just for stats /</span><br><span class="line">    unsigned long expires_cursor; / <span class="type">Cursor</span> of the active expire cycle. */</span><br><span class="line">    list *defrag_later;         /* <span class="type">List</span> of key names to attempt to defrag one by one, gradually. */</span><br><span class="line">&#125; redisDb;</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨å›ç­”ç¬¬ä¸€ä¸ªé—®é¢˜ï¼š</p>
<h4 id="é¢è¯•é¢˜ï¼š"><a href="#é¢è¯•é¢˜ï¼š" class="headerlink" title="é¢è¯•é¢˜ï¼š"></a><strong>é¢è¯•é¢˜</strong>ï¼š</h4><p>1.Rediså¦‚ä½•åˆ¤æ–­KEYæ˜¯å¦è¿‡æœŸå‘¢ï¼Ÿ</p>
<p><strong>ç­”</strong>ï¼šåœ¨Redisä¸­ä¼šæœ‰ä¸¤ä¸ªDictï¼Œä¹Ÿå°±æ˜¯HashTableï¼Œå…¶ä¸­ä¸€ä¸ªè®°å½•KEY-VALUEé”®å€¼å¯¹ï¼Œå¦ä¸€ä¸ªè®°å½•KEYå’Œè¿‡æœŸæ—¶é—´ã€‚è¦åˆ¤æ–­ä¸€ä¸ªKEYæ˜¯å¦è¿‡æœŸï¼Œåªéœ€è¦åˆ°è®°å½•è¿‡æœŸæ—¶é—´çš„Dictä¸­æ ¹æ®KEYæŸ¥è¯¢å³å¯ã€‚</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-496.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-493-1024x523.png" alt="img"></p>
<p>2.Redisæ˜¯ä½•æ—¶åˆ é™¤è¿‡æœŸKEYçš„å‘¢ï¼Ÿ</p>
<p>Rediså¹¶ä¸ä¼šåœ¨KEYè¿‡æœŸæ—¶ç«‹åˆ»åˆ é™¤KEYï¼Œå› ä¸ºè¦å®ç°è¿™æ ·çš„æ•ˆæœå°±å¿…é¡»ç»™æ¯ä¸€ä¸ªè¿‡æœŸçš„KEYè®¾ç½®æ—¶é’Ÿï¼Œå¹¶ç›‘æ§è¿™äº›KEYçš„è¿‡æœŸçŠ¶æ€ã€‚æ— è®ºå¯¹CPUè¿˜æ˜¯å†…å­˜éƒ½ä¼šå¸¦æ¥æå¤§çš„è´Ÿæ‹…ã€‚</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-498.png" alt="img"></p>
<p>Redisçš„è¿‡æœŸKEYåˆ é™¤ç­–ç•¥æœ‰ä¸¤ç§ï¼š</p>
<ul>
<li>æƒ°æ€§åˆ é™¤</li>
<li>å‘¨æœŸåˆ é™¤</li>
</ul>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-497.png" alt="img"></p>
<p><strong>æƒ°æ€§åˆ é™¤</strong>ï¼Œé¡¾æ˜æ€è®®å°±æ˜¯è¿‡æœŸåä¸ä¼šç«‹åˆ»åˆ é™¤ã€‚é‚£åœ¨ä»€ä¹ˆæ—¶å€™åˆ é™¤å‘¢ï¼Ÿ</p>
<p>Redisä¼šåœ¨æ¯æ¬¡è®¿é—®KEYçš„æ—¶å€™åˆ¤æ–­å½“å‰KEYæœ‰æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœæœ‰ï¼Œè¿‡æœŸæ—¶é—´æ˜¯å¦å·²ç»åˆ°æœŸã€‚å¯¹åº”çš„æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// db.c</span></span><br><span class="line"><span class="comment">// å¯»æ‰¾è¦æ‰§è¡Œå†™æ“ä½œçš„key</span></span><br><span class="line">robj *<span class="built_in">lookupKeyWriteWithFlags</span>(redisDb *db, robj *<span class="built_in">key</span>, int flags) &#123;</span><br><span class="line">    <span class="comment">// æ£€æŸ¥keyæ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸåˆ™åˆ é™¤</span></span><br><span class="line">    <span class="built_in">expireIfNeeded</span>(db,<span class="built_in">key</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">lookupKey</span>(db,<span class="built_in">key</span>,flags);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯»æ‰¾è¦æ‰§è¡Œè¯»æ“ä½œçš„key</span></span><br><span class="line">robj *<span class="built_in">lookupKeyReadWithFlags</span>(redisDb *db, robj *<span class="built_in">key</span>, int flags) &#123;</span><br><span class="line">    robj *val;</span><br><span class="line">    <span class="comment">// æ£€æŸ¥keyæ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸåˆ™åˆ é™¤</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">expireIfNeeded</span>(db,<span class="built_in">key</span>) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// ç•¥ ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    val = <span class="built_in">lookupKey</span>(db,<span class="built_in">key</span>,flags);</span><br><span class="line">    <span class="keyword">if</span> (val == <span class="built_in">NULL</span>)</span><br><span class="line">        <span class="keyword">goto</span> keymiss;</span><br><span class="line">    server.stat_keyspace_hits++;</span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>å‘¨æœŸåˆ é™¤</strong>ï¼šé¡¾æ˜æ€ä¹‰æ˜¯é€šè¿‡ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œå‘¨æœŸæ€§çš„æŠ½æ ·éƒ¨åˆ†è¿‡æœŸçš„keyï¼Œç„¶åæ‰§è¡Œåˆ é™¤ã€‚</p>
<p>æ‰§è¡Œå‘¨æœŸæœ‰ä¸¤ç§ï¼š</p>
<ul>
<li><strong>SLOWæ¨¡å¼ï¼š</strong>Redisä¼šè®¾ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡<code>serverCron()</code>ï¼ŒæŒ‰ç…§<code>server.hz</code>çš„é¢‘ç‡æ¥æ‰§è¡Œè¿‡æœŸkeyæ¸…ç†</li>
<li><strong>FASTæ¨¡å¼ï¼š</strong>Redisçš„æ¯ä¸ªäº‹ä»¶å¾ªç¯å‰æ‰§è¡Œè¿‡æœŸkeyæ¸…ç†ï¼ˆäº‹ä»¶å¾ªç¯å°±æ˜¯NIOäº‹ä»¶å¤„ç†çš„å¾ªç¯ï¼‰ã€‚</li>
</ul>
<p><strong>SLOW</strong>æ¨¡å¼è§„åˆ™ï¼š</p>
<ul>
<li>â‘  æ‰§è¡Œé¢‘ç‡å—<code>server.hz</code>å½±å“ï¼ˆæ§åˆ¶äº†Redisæ¯ç§’é’Ÿæ‰§è¡Œå®šæ—¶å™¨çš„é¢‘ç‡ï¼‰ï¼Œé»˜è®¤ä¸º10ï¼Œå³æ¯ç§’æ‰§è¡Œ10æ¬¡ï¼Œæ¯ä¸ªæ‰§è¡Œå‘¨æœŸ100msã€‚</li>
<li>â‘¡ æ‰§è¡Œæ¸…ç†è€—æ—¶ä¸è¶…è¿‡ä¸€æ¬¡æ‰§è¡Œå‘¨æœŸçš„25%ï¼Œå³25ms.</li>
<li>â‘¢ é€ä¸ªéå†dbï¼Œé€ä¸ªéå†dbä¸­çš„bucketï¼ŒæŠ½å–20ä¸ªkeyåˆ¤æ–­æ˜¯å¦è¿‡æœŸ</li>
<li>â‘£ å¦‚æœæ²¡è¾¾åˆ°æ—¶é—´ä¸Šé™ï¼ˆ25msï¼‰å¹¶ä¸”è¿‡æœŸkeyæ¯”ä¾‹å¤§äº10%ï¼Œå†è¿›è¡Œä¸€æ¬¡æŠ½æ ·ï¼Œå¦åˆ™ç»“æŸ</li>
</ul>
<p><strong>FAST</strong>æ¨¡å¼è§„åˆ™ï¼ˆè¿‡æœŸkeyæ¯”ä¾‹å°äº10%ä¸æ‰§è¡Œï¼‰ï¼š</p>
<ul>
<li>â‘  æ‰§è¡Œé¢‘ç‡å—<code>beforeSleep()</code>è°ƒç”¨é¢‘ç‡å½±å“ï¼Œä½†ä¸¤æ¬¡FASTæ¨¡å¼é—´éš”ä¸ä½äº2ms</li>
<li>â‘¡ æ‰§è¡Œæ¸…ç†è€—æ—¶ä¸è¶…è¿‡1ms</li>
<li>â‘¢ é€ä¸ªéå†dbï¼Œé€ä¸ªéå†dbä¸­çš„bucketï¼ŒæŠ½å–20ä¸ªkeyåˆ¤æ–­æ˜¯å¦è¿‡æœŸ</li>
<li>â‘£ å¦‚æœæ²¡è¾¾åˆ°æ—¶é—´ä¸Šé™ï¼ˆ1msï¼‰å¹¶ä¸”è¿‡æœŸkeyæ¯”ä¾‹å¤§äº10%ï¼Œå†è¿›è¡Œä¸€æ¬¡æŠ½æ ·ï¼Œå¦åˆ™ç»“æŸ</li>
</ul>
<p>ä¸¤ç§åˆ é™¤ç­–ç•¥æ€»ç»“å¯¹æ¯”</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>ç­–ç•¥</th>
<th>è§¦å‘æ–¹å¼</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>æƒ°æ€§åˆ é™¤</td>
<td>è®¿é—® key æ—¶è§¦å‘</td>
<td>é«˜æ•ˆï¼Œåªå¤„ç†å¿…è¦çš„ key</td>
<td>ä¸è®¿é—®å°±ä¸åˆ ï¼Œæ˜“å†…å­˜æ³„æ¼</td>
</tr>
<tr>
<td>å‘¨æœŸåˆ é™¤</td>
<td>å®šæ—¶ä»»åŠ¡è§¦å‘</td>
<td>è‡ªåŠ¨æ¸…ç†ï¼Œé˜²å†…å­˜ç§¯å‹</td>
<td>éå®æ—¶ï¼Œæœ‰ä¸€å®šå»¶è¿Ÿ</td>
</tr>
</tbody>
</table>
</div>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-494-1024x503.png" alt="img"></p>
<h3 id="5-2-å†…å­˜æ·˜æ±°ç­–ç•¥"><a href="#5-2-å†…å­˜æ·˜æ±°ç­–ç•¥" class="headerlink" title="5.2.å†…å­˜æ·˜æ±°ç­–ç•¥"></a>5.2.å†…å­˜æ·˜æ±°ç­–ç•¥</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-501.png" alt="img"></p>
<p>å¯¹äºæŸäº›ç‰¹åˆ«ä¾èµ–äºRedisçš„é¡¹ç›®è€Œè¨€ï¼Œä»…ä»…ä¾é è¿‡æœŸKEYæ¸…ç†æ˜¯ä¸å¤Ÿçš„ï¼Œå†…å­˜å¯èƒ½å¾ˆå¿«å°±è¾¾åˆ°ä¸Šé™ã€‚å› æ­¤Rediså…è®¸è®¾ç½®å†…å­˜å‘Šè­¦é˜ˆå€¼ï¼Œå½“å†…å­˜ä½¿ç”¨è¾¾åˆ°é˜ˆå€¼æ—¶å°±ä¼šä¸»åŠ¨æŒ‘é€‰éƒ¨åˆ†KEYåˆ é™¤ä»¥é‡Šæ”¾æ›´å¤šå†…å­˜ã€‚è¿™å«åš<strong>å†…å­˜æ·˜æ±°</strong>æœºåˆ¶ã€‚</p>
<h4 id="5-2-1-Redis-ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘å†…å­˜æ·˜æ±°ï¼Ÿ"><a href="#5-2-1-Redis-ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘å†…å­˜æ·˜æ±°ï¼Ÿ" class="headerlink" title="5.2.1.Redis ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘å†…å­˜æ·˜æ±°ï¼Ÿ"></a>5.2.1.Redis ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘å†…å­˜æ·˜æ±°ï¼Ÿ</h4><p>æ¯æ¬¡å®¢æˆ·ç«¯æ‰§è¡Œå‘½ä»¤æ—¶ï¼ˆå¦‚ <code>set</code>ã€<code>get</code> ç­‰ï¼‰ï¼ŒRedis éƒ½ä¼šå…ˆåˆ¤æ–­å½“å‰å†…å­˜æ˜¯å¦è¶…è¿‡é˜ˆå€¼ï¼š</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.cä¸­å¤„ç†å‘½ä»¤çš„éƒ¨åˆ†æºç </span></span><br><span class="line"><span class="built_in">int</span> processCommand(<span class="keyword">client</span> *c) &#123;</span><br><span class="line">    <span class="comment">// ... ç•¥</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">server</span>.maxmemory &amp;&amp; !<span class="keyword">server</span>.lua_timedout) &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨performEvictions()æ–¹æ³•å°è¯•è¿›è¡Œå†…å­˜æ·˜æ±°</span></span><br><span class="line">        <span class="built_in">int</span> out_of_memory = (performEvictions() == EVICT_FAIL);</span><br><span class="line">        <span class="comment">// ... ç•¥</span></span><br><span class="line">        <span class="keyword">if</span> (out_of_memory &amp;&amp; reject_cmd_on_oom) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœå†…å­˜ä¾ç„¶ä¸è¶³ï¼Œç›´æ¥æ‹’ç»å‘½ä»¤</span></span><br><span class="line">            rejectCommand(c, shared.oomerr);</span><br><span class="line">            <span class="keyword">return</span> C_OK;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¶…å‡ºï¼Œå°±ä¼šå°è¯•è°ƒç”¨ <code>performEvictions()</code> è¿›è¡Œæ·˜æ±°ã€‚</p>
<h4 id="5-2-2-å†…å­˜æ·˜æ±°ç­–ç•¥"><a href="#5-2-2-å†…å­˜æ·˜æ±°ç­–ç•¥" class="headerlink" title="5.2.2.å†…å­˜æ·˜æ±°ç­–ç•¥"></a>5.2.2.å†…å­˜æ·˜æ±°ç­–ç•¥</h4><p>å¥½äº†ï¼ŒçŸ¥é“ä»€ä¹ˆæ—¶å€™å°è¯•æ·˜æ±°äº†ï¼Œé‚£å…·ä½“Redisæ˜¯å¦‚ä½•åˆ¤æ–­è¯¥æ·˜æ±°å“ªäº›<code>Key</code>çš„å‘¢ï¼Ÿ</p>
<p>Redisæ”¯æŒ8ç§ä¸åŒçš„å†…å­˜æ·˜æ±°ç­–ç•¥ï¼š</p>
<ul>
<li><code>noeviction</code>ï¼š ä¸æ·˜æ±°ä»»ä½•keyï¼Œä½†æ˜¯å†…å­˜æ»¡æ—¶ä¸å…è®¸å†™å…¥æ–°æ•°æ®ï¼Œé»˜è®¤å°±æ˜¯è¿™ç§ç­–ç•¥ã€‚</li>
<li><code>volatile``-ttl</code>ï¼š å¯¹è®¾ç½®äº†TTLçš„keyï¼Œæ¯”è¾ƒkeyçš„å‰©ä½™TTLå€¼ï¼ŒTTLè¶Šå°è¶Šå…ˆè¢«æ·˜æ±°</li>
<li><code>allkeys``-random</code>ï¼šå¯¹å…¨ä½“key ï¼Œéšæœºè¿›è¡Œæ·˜æ±°ã€‚ä¹Ÿå°±æ˜¯ç›´æ¥ä»db-&gt;dictä¸­éšæœºæŒ‘é€‰</li>
<li><code>volatile-random</code>ï¼šå¯¹è®¾ç½®äº†TTLçš„key ï¼Œéšæœºè¿›è¡Œæ·˜æ±°ã€‚ä¹Ÿå°±æ˜¯ä»db-&gt;expiresä¸­éšæœºæŒ‘é€‰ã€‚</li>
<li><code>allkeys-lru</code>ï¼š å¯¹å…¨ä½“keyï¼ŒåŸºäºLRUç®—æ³•è¿›è¡Œæ·˜æ±°</li>
<li><code>volatile-lru</code>ï¼š å¯¹è®¾ç½®äº†TTLçš„keyï¼ŒåŸºäºLRUç®—æ³•è¿›è¡Œæ·˜æ±°</li>
<li><code>allkeys-lfu</code>ï¼š å¯¹å…¨ä½“keyï¼ŒåŸºäºLFUç®—æ³•è¿›è¡Œæ·˜æ±°</li>
<li><code>volatile-lfu</code>ï¼š å¯¹è®¾ç½®äº†TTLçš„keyï¼ŒåŸºäºLFUç®—æ³•è¿›è¡Œæ·˜æ±°</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>ç­–ç•¥å</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>noeviction</code></td>
<td>ä¸æ·˜æ±°ï¼Œå†…å­˜æ»¡æ—¶ç›´æ¥æŠ¥é”™ï¼Œé»˜è®¤ç­–ç•¥</td>
</tr>
<tr>
<td><code>volatile-ttl</code></td>
<td>ä»…æ·˜æ±°è®¾ç½®äº† TTL çš„ keyï¼Œä¼˜å…ˆæ·˜æ±° TTL æœ€å°çš„</td>
</tr>
<tr>
<td><code>allkeys-random</code></td>
<td>æ‰€æœ‰ key ä¸­éšæœºæ·˜æ±°</td>
</tr>
<tr>
<td><code>volatile-random</code></td>
<td>TTL key ä¸­éšæœºæ·˜æ±°</td>
</tr>
<tr>
<td><code>allkeys-lru</code></td>
<td>æ‰€æœ‰ key ä¸­æ·˜æ±°æœ€ä¹…æœªä½¿ç”¨çš„ï¼ˆè¿‘ä¼¼LRUï¼‰</td>
</tr>
<tr>
<td><code>volatile-lru</code></td>
<td>TTL key ä¸­æ·˜æ±°æœ€ä¹…æœªä½¿ç”¨çš„</td>
</tr>
<tr>
<td><code>allkeys-lfu</code></td>
<td>æ‰€æœ‰ key ä¸­æ·˜æ±°è®¿é—®é¢‘ç‡æœ€ä½çš„ï¼ˆè¿‘ä¼¼LFUï¼‰</td>
</tr>
<tr>
<td><code>volatile-lfu</code></td>
<td>TTL key ä¸­æ·˜æ±°è®¿é—®é¢‘ç‡æœ€ä½çš„</td>
</tr>
</tbody>
</table>
</div>
<p>æ¯”è¾ƒå®¹æ˜“æ··æ·†çš„æœ‰ä¸¤ä¸ªç®—æ³•ï¼š</p>
<ul>
<li><strong>LRU</strong>ï¼ˆ<strong><code>L</code></strong><code>east</code><strong><code>R</code></strong><code>ecently</code><strong><code>U</code></strong><code>sed</code>ï¼‰ï¼Œæœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ã€‚ç”¨å½“å‰æ—¶é—´å‡å»æœ€åä¸€æ¬¡è®¿é—®æ—¶é—´ï¼Œè¿™ä¸ªå€¼è¶Šå¤§åˆ™æ·˜æ±°ä¼˜å…ˆçº§è¶Šé«˜ã€‚</li>
<li><strong>LFU</strong>ï¼ˆ<strong><code>L</code></strong><code>east</code><strong><code>F</code></strong><code>requently</code><strong><code>U</code></strong><code>sed</code>ï¼‰ï¼Œæœ€å°‘é¢‘ç‡ä½¿ç”¨ã€‚ä¼šç»Ÿè®¡æ¯ä¸ªkeyçš„è®¿é—®é¢‘ç‡ï¼Œå€¼è¶Šå°æ·˜æ±°ä¼˜å…ˆçº§è¶Šé«˜ã€‚</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>LRUï¼ˆLeast Recently Usedï¼‰</td>
<td>æ·˜æ±°æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„ keyã€‚ä¼˜å…ˆçº§ = å½“å‰æ—¶é—´ - æœ€åè®¿é—®æ—¶é—´</td>
</tr>
<tr>
<td>LFUï¼ˆLeast Frequently Usedï¼‰</td>
<td>æ·˜æ±°è®¿é—®é¢‘ç‡æœ€ä½çš„ keyã€‚ä¼˜å…ˆçº§ = è®¿é—®æ¬¡æ•°ï¼ˆå¸¦æ—¶é—´è¡°å‡ï¼‰</td>
</tr>
</tbody>
</table>
</div>
<p>Redisæ€ä¹ˆçŸ¥é“æŸä¸ªKEYçš„<code>æœ€è¿‘ä¸€æ¬¡è®¿é—®æ—¶é—´</code>æˆ–è€…æ˜¯<code>è®¿é—®é¢‘ç‡</code>å‘¢ï¼Ÿ</p>
<p>RedisObjectçš„ç»“æ„</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-499-1024x352.png" alt="img"></p>
<p>Redis ä½¿ç”¨ RedisObject ç»“æ„ä½“ä¸­çš„ <code>lru</code> å­—æ®µæ¥è®°å½•è®¿é—®ä¿¡æ¯ï¼š</p>
<ul>
<li><strong>LRU æ¨¡å¼</strong>ï¼šè®°å½•è®¿é—®æ—¶é—´ï¼ˆ24 bitï¼‰</li>
<li><strong>LFU æ¨¡å¼</strong>ï¼šé«˜16ä½è®°å½•è®¿é—®æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰ï¼Œä½8ä½è®°å½•â€œé€»è¾‘è®¿é—®æ¬¡æ•°â€ï¼ˆä¸æ˜¯æ¯æ¬¡è®¿é—®éƒ½åŠ ä¸€ï¼‰</li>
</ul>
<p><strong>LFU è®¡æ•°è§„åˆ™ï¼š</strong></p>
<ol>
<li>éšæœºç”Ÿæˆ [0,1) æ•° Rï¼›</li>
<li>è®¡ç®—æ¦‚ç‡ P = <code>1 / (old_countæ—§æ¬¡æ•° * lfu_log_factor + 1)</code>ï¼Œ<code>lfu_log_factor + 1</code>é»˜è®¤ä¸º10ï¼›</li>
<li>è‹¥ R &lt; Pï¼Œåˆ™è®¡æ•°å™¨ +1ï¼ˆæœ€å¤§ 255ï¼‰ï¼›</li>
<li>æ¯éš”ä¸€æ®µæ—¶é—´ä¼šè¡°å‡ countï¼ˆé»˜è®¤æ¯ 1 åˆ†é’Ÿ -1ï¼‰</li>
</ol>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-504.png" alt="img"></p>
<p>è¿™ä¹Ÿæ˜¯å®˜æ–¹ç»™å‡ºçš„çœŸæ­£LRUä¸è¿‘ä¼¼LRUçš„ç»“æœå¯¹æ¯”ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-500-1024x512.png" alt="img"></p>
<p>ä½ å¯ä»¥åœ¨å›¾è¡¨ä¸­çœ‹åˆ°ä¸‰ç§é¢œè‰²çš„ç‚¹å½¢æˆä¸‰ä¸ªä¸åŒçš„å¸¦ï¼Œæ¯ä¸ªç‚¹å°±æ˜¯ä¸€ä¸ªåŠ å…¥çš„<code>KEY</code>ã€‚</p>
<ul>
<li>æµ…ç°è‰²å¸¦æ˜¯è¢«é©±é€çš„å¯¹è±¡</li>
<li>ç°è‰²å¸¦æ˜¯æ²¡æœ‰è¢«é©±é€çš„å¯¹è±¡</li>
<li>ç»¿è‰²å¸¦æ˜¯è¢«æ·»åŠ çš„å¯¹è±¡</li>
</ul>
<h4 id="5-2-3æ€»ç»“"><a href="#5-2-3æ€»ç»“" class="headerlink" title="5.2.3æ€»ç»“"></a>5.2.3æ€»ç»“</h4><blockquote>
<p>Redis å†…å­˜æ»¡äº†ä¹‹åä¼šé€šè¿‡å†…å­˜æ·˜æ±°æœºåˆ¶æ¥é‡Šæ”¾å†…å­˜ã€‚å®ƒæ”¯æŒ 8 ç§ç­–ç•¥ï¼Œæ¯”å¦‚ LRUã€LFUã€éšæœºç­‰ï¼ŒåŒºåˆ«åœ¨äºæ˜¯å¯¹æ‰€æœ‰ key è¿˜æ˜¯ä»…é™è®¾ç½®äº† TTL çš„ keyã€‚Redis ä¸æ˜¯å¯¹æ‰€æœ‰ key åšå…¨é‡æ’åºï¼Œè€Œæ˜¯é€šè¿‡æŠ½æ ·+å€™é€‰æ± çš„æ–¹å¼æ¥å¿«é€Ÿé€‰å‡ºè¦æ·˜æ±°çš„ keyï¼Œæ•ˆç‡å¾ˆé«˜ã€‚</p>
<p>å¦‚æœä¸šåŠ¡å¯¹å†…å­˜æ•æ„Ÿï¼Œæ¨èä½¿ç”¨ <code>allkeys-lfu</code>ï¼Œè¿™èƒ½æœ€å¤§ç¨‹åº¦ä¸Šä¿ç•™çƒ­é—¨æ•°æ®ï¼Œæ¸…ç†å†·é—¨æ•°æ®ï¼Œæ¯”è¾ƒé€‚åˆé«˜é¢‘è®¿é—®çš„åœºæ™¯ã€‚</p>
</blockquote>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/Untitled-diagram-_-Mermaid-Chart-2025-08-06-093450-294x1024.png" alt="img"></p>
<h3 id="5-3æ€»ç»“-Rediså†…å­˜å›æ”¶çš„å‡ é“é¢è¯•é¢˜"><a href="#5-3æ€»ç»“-Rediså†…å­˜å›æ”¶çš„å‡ é“é¢è¯•é¢˜" class="headerlink" title="5.3æ€»ç»“ -Rediså†…å­˜å›æ”¶çš„å‡ é“é¢è¯•é¢˜"></a>5.3æ€»ç»“ -Rediså†…å­˜å›æ”¶çš„å‡ é“é¢è¯•é¢˜</h3><p>1.<strong>é¢è¯•é¢˜</strong>ï¼š<strong>Rediså¦‚ä½•åˆ¤æ–­KEYæ˜¯å¦è¿‡æœŸå‘¢ï¼Ÿ</strong></p>
<p><strong>ç­”</strong>ï¼šåœ¨Redisä¸­ä¼šæœ‰ä¸¤ä¸ªDictï¼Œä¹Ÿå°±æ˜¯HashTableï¼Œå…¶ä¸­ä¸€ä¸ªè®°å½•KEY-VALUEé”®å€¼å¯¹ï¼Œå¦ä¸€ä¸ªè®°å½•KEYå’Œè¿‡æœŸæ—¶é—´ã€‚è¦åˆ¤æ–­ä¸€ä¸ªKEYæ˜¯å¦è¿‡æœŸï¼Œåªéœ€è¦åˆ°è®°å½•è¿‡æœŸæ—¶é—´çš„Dictä¸­æ ¹æ®KEYæŸ¥è¯¢å³å¯ã€‚</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-509.png" alt="img"></p>
<p>2.<strong>é¢è¯•é¢˜</strong>ï¼š<strong>Redisä½•æ—¶åˆ é™¤è¿‡æœŸKEYï¼Ÿå¦‚ä½•åˆ é™¤ï¼Ÿ</strong></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-510.png" alt="img"></p>
<p><strong>ç­”</strong>ï¼šRedisçš„è¿‡æœŸKEYå¤„ç†æœ‰ä¸¤ç§ç­–ç•¥ï¼Œåˆ†åˆ«æ˜¯æƒ°æ€§åˆ é™¤å’Œå‘¨æœŸåˆ é™¤ã€‚</p>
<p><strong>æƒ°æ€§åˆ é™¤</strong>æ˜¯æŒ‡åœ¨æ¯æ¬¡ç”¨æˆ·è®¿é—®æŸä¸ªKEYæ—¶ï¼Œåˆ¤æ–­KEYçš„è¿‡æœŸæ—¶é—´ï¼šå¦‚æœè¿‡æœŸåˆ™åˆ é™¤ï¼›å¦‚æœæœªè¿‡æœŸåˆ™å¿½ç•¥ã€‚</p>
<p><strong>å‘¨æœŸåˆ é™¤</strong>æœ‰ä¸¤ç§æ¨¡å¼ï¼š</p>
<ul>
<li><strong>SLOW</strong>æ¨¡å¼ï¼šé€šè¿‡ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œå®šæœŸçš„æŠ½æ ·éƒ¨åˆ†å¸¦æœ‰TTLçš„KEYï¼Œåˆ¤æ–­å…¶æ˜¯å¦è¿‡æœŸã€‚é»˜è®¤æƒ…å†µä¸‹å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œé¢‘ç‡æ˜¯æ¯ç§’10æ¬¡ï¼Œä½†æ¯æ¬¡æ‰§è¡Œä¸èƒ½è¶…è¿‡25æ¯«ç§’ã€‚å¦‚æœæ‰§è¡ŒæŠ½æ ·åå‘ç°æ—¶é—´è¿˜æœ‰å‰©ä½™ï¼Œå¹¶ä¸”è¿‡æœŸKEYçš„æ¯”ä¾‹è¾ƒé«˜ï¼Œåˆ™ä¼šå¤šæ¬¡æŠ½æ ·ã€‚</li>
<li><strong>FAST</strong>æ¨¡å¼ï¼šåœ¨Redisæ¯æ¬¡å¤„ç†NIOäº‹ä»¶ä¹‹å‰ï¼Œéƒ½ä¼šæŠ½æ ·éƒ¨åˆ†å¸¦æœ‰TTLçš„KEYï¼Œåˆ¤æ–­æ˜¯å¦è¿‡æœŸï¼Œå› æ­¤æ‰§è¡Œé¢‘ç‡è¾ƒé«˜ã€‚ä½†æ˜¯æ¯æ¬¡æ‰§è¡Œæ—¶é•¿ä¸èƒ½è¶…è¿‡1msï¼Œå¦‚æœæ—¶é—´å……è¶³å¹¶ä¸”è¿‡æœŸKEYæ¯”ä¾‹è¿‡é«˜ï¼Œä¹Ÿä¼šå¤šæ¬¡æŠ½æ ·</li>
</ul>
<p>3.<strong>é¢è¯•é¢˜</strong>ï¼š<strong>å½“Redis**</strong>å†…å­˜<strong>**ä¸è¶³æ—¶ä¼šæ€ä¹ˆåš</strong>ï¼Ÿ</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-511.png" alt="img"></p>
<p><strong>ç­”</strong>ï¼šè¿™å–å†³äºé…ç½®çš„å†…å­˜æ·˜æ±°ç­–ç•¥ï¼ŒRedisæ”¯æŒå¾ˆå¤šç§å†…å­˜æ·˜æ±°ç­–ç•¥ï¼Œä¾‹å¦‚LRUã€LFUã€Random. ä½†é»˜è®¤çš„ç­–ç•¥æ˜¯ç›´æ¥æ‹’ç»æ–°çš„å†™å…¥è¯·æ±‚ã€‚è€Œå¦‚æœè®¾ç½®äº†å…¶å®ƒç­–ç•¥ï¼Œåˆ™ä¼šåœ¨æ¯æ¬¡æ‰§è¡Œå‘½ä»¤ååˆ¤æ–­å ç”¨å†…å­˜æ˜¯å¦è¾¾åˆ°é˜ˆå€¼ã€‚å¦‚æœè¾¾åˆ°é˜ˆå€¼åˆ™ä¼šåŸºäºé…ç½®çš„æ·˜æ±°ç­–ç•¥å°è¯•è¿›è¡Œå†…å­˜æ·˜æ±°ï¼Œç›´åˆ°å ç”¨å†…å­˜å°äºé˜ˆå€¼ä¸ºæ­¢ã€‚</p>
<p>4.<strong>é¢è¯•é¢˜</strong>ï¼š<strong>é‚£ä½ èƒ½èŠèŠ**</strong>LRU<strong><strong>å’Œ</strong></strong>LFU<strong>**å—</strong>ï¼Ÿ</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-512.png" alt="img"></p>
<p><strong>ç­”</strong>ï¼š<code>LRU</code>æ˜¯æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ã€‚Redisçš„Keyéƒ½æ˜¯RedisObjectï¼Œå½“å¯ç”¨LRUç®—æ³•åï¼ŒRedisä¼šåœ¨Keyçš„å¤´ä¿¡æ¯ä¸­ä½¿ç”¨24ä¸ªbitè®°å½•æ¯ä¸ªkeyçš„æœ€è¿‘ä¸€æ¬¡ä½¿ç”¨çš„æ—¶é—´<code>lru</code>ã€‚æ¯æ¬¡éœ€è¦å†…å­˜æ·˜æ±°æ—¶ï¼Œå°±ä¼šæŠ½æ ·ä¸€éƒ¨åˆ†KEYï¼Œæ‰¾å‡ºå…¶ä¸­ç©ºé—²æ—¶é—´æœ€é•¿çš„ï¼Œä¹Ÿå°±æ˜¯<code>now - lru</code>ç»“æœæœ€å¤§çš„ï¼Œç„¶åå°†å…¶åˆ é™¤ã€‚å¦‚æœå†…å­˜ä¾ç„¶ä¸è¶³ï¼Œå°±é‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚</p>
<p>ç”±äºé‡‡ç”¨äº†æŠ½æ ·æ¥è®¡ç®—ï¼Œè¿™ç§ç®—æ³•åªèƒ½è¯´æ˜¯ä¸€ç§è¿‘ä¼¼LRUç®—æ³•ã€‚å› æ­¤åœ¨Redis4.0ä»¥ååˆå¼•å…¥äº†<code>LFU</code>ç®—æ³•ï¼Œè¿™ç§ç®—æ³•æ˜¯ç»Ÿè®¡æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯æŒ‰keyçš„è®¿é—®é¢‘ç‡æ¥ç»Ÿè®¡ã€‚å½“å¯ç”¨LFUç®—æ³•åï¼ŒRedisä¼šåœ¨keyçš„å¤´ä¿¡æ¯ä¸­ä½¿ç”¨24bitè®°å½•æœ€è¿‘ä¸€æ¬¡ä½¿ç”¨æ—¶é—´å’Œé€»è¾‘è®¿é—®é¢‘ç‡ã€‚å…¶ä¸­é«˜16ä½æ˜¯ä»¥åˆ†é’Ÿä¸ºå•ä½çš„æœ€è¿‘è®¿é—®æ—¶é—´ï¼Œå8ä½æ˜¯é€»è¾‘è®¿é—®æ¬¡æ•°ã€‚ä¸LFUç±»ä¼¼ï¼Œæ¯æ¬¡éœ€è¦å†…å­˜æ·˜æ±°æ—¶ï¼Œå°±ä¼šæŠ½æ ·ä¸€éƒ¨åˆ†KEYï¼Œæ‰¾å‡ºå…¶ä¸­é€»è¾‘è®¿é—®æ¬¡æ•°æœ€å°çš„ï¼Œå°†å…¶æ·˜æ±°ã€‚</p>
<p>5.<strong>é¢è¯•é¢˜</strong>ï¼š<strong>é€»è¾‘è®¿é—®æ¬¡æ•°æ˜¯å¦‚ä½•è®¡ç®—çš„</strong>ï¼Ÿ</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-513.png" alt="img"></p>
<p><strong>ç­”</strong>ï¼šç”±äºè®°å½•è®¿é—®æ¬¡æ•°çš„åªæœ‰<code>8bit</code>ï¼Œå³ä¾¿æ˜¯æ— ç¬¦å·æ•°ï¼Œæœ€å¤§å€¼åªæœ‰255ï¼Œä¸å¯èƒ½è®°å½•çœŸå®çš„è®¿é—®æ¬¡æ•°ã€‚å› æ­¤Redisç»Ÿè®¡çš„å…¶å®æ˜¯é€»è¾‘è®¿é—®æ¬¡æ•°ã€‚è¿™å…¶ä¸­æœ‰ä¸€ä¸ªè®¡ç®—å…¬å¼ï¼Œä¼šæ ¹æ®å½“å‰çš„è®¿é—®æ¬¡æ•°åšè®¡ç®—ï¼Œç»“æœè¦ä¹ˆæ˜¯æ¬¡æ•°<code>+1</code>ï¼Œè¦ä¹ˆæ˜¯æ¬¡æ•°ä¸å˜ã€‚ä½†éšç€å½“å‰è®¿é—®æ¬¡æ•°è¶Šå¤§ï¼Œ<code>+1</code>çš„æ¦‚ç‡ä¹Ÿä¼šè¶Šä½ï¼Œå¹¶ä¸”æœ€å¤§å€¼ä¸è¶…è¿‡255.</p>
<p>é™¤æ­¤ä»¥å¤–ï¼Œé€»è¾‘è®¿é—®æ¬¡æ•°è¿˜æœ‰ä¸€ä¸ªè¡°å‡å‘¨æœŸï¼Œé»˜è®¤ä¸º1åˆ†é’Ÿï¼Œå³æ¯éš”1åˆ†é’Ÿé€»è¾‘è®¿é—®æ¬¡æ•°ä¼š<code>-1</code>ã€‚è¿™æ ·é€»è¾‘è®¿é—®æ¬¡æ•°å°±èƒ½åŸºæœ¬åæ˜ å‡ºä¸€ä¸ª<code>key</code>çš„è®¿é—®çƒ­åº¦äº†ã€‚</p>
<h2 id="6-ç¼“å­˜é—®é¢˜"><a href="#6-ç¼“å­˜é—®é¢˜" class="headerlink" title="6.ç¼“å­˜é—®é¢˜"></a>6.ç¼“å­˜é—®é¢˜</h2><p>Redisç»å¸¸è¢«ç”¨ä½œç¼“å­˜ï¼Œè€Œç¼“å­˜åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­å­˜åœ¨å¾ˆå¤šé—®é¢˜éœ€è¦è§£å†³ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>ç¼“å­˜çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜</li>
<li>ç¼“å­˜å‡»ç©¿</li>
<li>ç¼“å­˜ç©¿é€</li>
<li>ç¼“å­˜é›ªå´©</li>
</ul>
<h3 id="6-1-ç¼“å­˜ä¸€è‡´æ€§"><a href="#6-1-ç¼“å­˜ä¸€è‡´æ€§" class="headerlink" title="6.1.ç¼“å­˜ä¸€è‡´æ€§"></a>6.1.ç¼“å­˜ä¸€è‡´æ€§</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-519.png" alt="img"></p>
<p>æˆ‘ä»¬å…ˆçœ‹ä¸‹ç›®å‰ä¼ä¸šç”¨çš„æœ€å¤šçš„ç¼“å­˜æ¨¡å‹ã€‚</p>
<h4 id="ç¼“å­˜çš„é€šç”¨æ¨¡å‹"><a href="#ç¼“å­˜çš„é€šç”¨æ¨¡å‹" class="headerlink" title="ç¼“å­˜çš„é€šç”¨æ¨¡å‹"></a>ç¼“å­˜çš„é€šç”¨æ¨¡å‹</h4><p>æœ‰ä¸‰ç§ï¼š</p>
<ul>
<li><p>```<br>Cache Aside</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  ï¼šæœ‰ç¼“å­˜è°ƒç”¨è€…è‡ªå·±ç»´æŠ¤æ•°æ®åº“ä¸ç¼“å­˜çš„ä¸€è‡´æ€§ã€‚å³ï¼š</span><br><span class="line"></span><br><span class="line"><span class="bullet">  -</span> æŸ¥è¯¢æ—¶ï¼šå‘½ä¸­åˆ™ç›´æ¥è¿”å›ï¼Œæœªå‘½ä¸­åˆ™æŸ¥è¯¢æ•°æ®åº“å¹¶å†™å…¥ç¼“å­˜</span><br><span class="line"><span class="bullet">  -</span> æ›´æ–°æ—¶ï¼šæ›´æ–°æ•°æ®åº“å¹¶åˆ é™¤ç¼“å­˜ï¼ŒæŸ¥è¯¢æ—¶è‡ªç„¶ä¼šæ›´æ–°ç¼“å­˜</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-520.png</span>)</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="code">```</span></span><br><span class="line"><span class="code">  Read/Write Through</span></span><br></pre></td></tr></table></figure>
<p>ï¼šæ•°æ®åº“è‡ªå·±ç»´æŠ¤ä¸€ä»½ç¼“å­˜ï¼Œåº•å±‚å®ç°å¯¹è°ƒç”¨è€…é€æ˜ã€‚åº•å±‚å®ç°ï¼š</p>
<ul>
<li>æŸ¥è¯¢æ—¶ï¼šå‘½ä¸­åˆ™ç›´æ¥è¿”å›ï¼Œæœªå‘½ä¸­åˆ™æŸ¥è¯¢æ•°æ®åº“å¹¶å†™å…¥ç¼“å­˜</li>
<li>æ›´æ–°æ—¶ï¼šåˆ¤æ–­ç¼“å­˜æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨ç›´æ¥æ›´æ–°æ•°æ®åº“ã€‚å­˜åœ¨åˆ™æ›´æ–°ç¼“å­˜ï¼ŒåŒæ­¥æ›´æ–°æ•°æ®åº“</li>
</ul>
</li>
</ul>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-521.png" alt="img"></p>
<ul>
<li><code>Write Behind Cahing</code>ï¼šè¯»å†™æ“ä½œéƒ½ç›´æ¥æ“ä½œç¼“å­˜ï¼Œç”±çº¿ç¨‹å¼‚æ­¥çš„å°†ç¼“å­˜æ•°æ®åŒæ­¥åˆ°æ•°æ®åº“</li>
</ul>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-522.png" alt="img"></p>
<p>ç›®å‰ä¼ä¸šä¸­ä½¿ç”¨æœ€å¤šçš„å°±æ˜¯<code>Cache Aside</code>æ¨¡å¼ï¼Œå› ä¸ºå®ç°èµ·æ¥éå¸¸ç®€å•ã€‚ä½†ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯æ— æ³•ä¿è¯æ•°æ®åº“ä¸ç¼“å­˜çš„å¼ºä¸€è‡´æ€§ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬ä¸€èµ·æ¥åˆ†æä¸€ä¸‹ã€‚</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-523.png" alt="img"></p>
<h4 id="å…³é”®é—®é¢˜ï¼šæ›´æ–°æ—¶ç¼“å­˜å’Œæ•°æ®åº“çš„æ“ä½œé¡ºåº"><a href="#å…³é”®é—®é¢˜ï¼šæ›´æ–°æ—¶ç¼“å­˜å’Œæ•°æ®åº“çš„æ“ä½œé¡ºåº" class="headerlink" title="å…³é”®é—®é¢˜ï¼šæ›´æ–°æ—¶ç¼“å­˜å’Œæ•°æ®åº“çš„æ“ä½œé¡ºåº"></a>å…³é”®é—®é¢˜ï¼šæ›´æ–°æ—¶ç¼“å­˜å’Œæ•°æ®åº“çš„æ“ä½œé¡ºåº</h4><p>é‚£åˆ°åº•æ˜¯å…ˆæ›´æ–°æ•°æ®åº“å†åˆ é™¤ç¼“å­˜ï¼Œè¿˜æ˜¯å…ˆåˆ é™¤ç¼“å­˜å†æ›´æ–°æ•°æ®åº“å‘¢ï¼Ÿ</p>
<p>ç°åœ¨å‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªæ¥æ›´æ–°æ•°æ®ï¼Œä¸€ä¸ªæ¥æŸ¥è¯¢æ•°æ®ã€‚æˆ‘ä»¬åˆ†åˆ«åˆ†æä¸¤ç§ç­–ç•¥çš„è¡¨ç°ã€‚</p>
<p>æˆ‘ä»¬å…ˆåˆ†æç­–ç•¥1ï¼Œå…ˆåˆ é™¤ç¼“å­˜å†æ›´æ–°æ•°æ®åº“</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-524.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-505.png" alt="img"></p>
<p><strong>å¼‚å¸¸æƒ…å†µ</strong></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-506.png" alt="img"></p>
<p>ç”±äºæ›´æ–°æ•°æ®åº“çš„æ“ä½œæœ¬èº«æ¯”è¾ƒè€—æ—¶ï¼Œåœ¨æœŸé—´æœ‰çº¿ç¨‹æ¥æŸ¥è¯¢æ•°æ®åº“å¹¶æ›´æ–°ç¼“å­˜çš„æ¦‚ç‡éå¸¸é«˜ã€‚å› æ­¤ä¸æ¨èè¿™ç§æ–¹æ¡ˆã€‚</p>
<p>å†æ¥çœ‹ç­–ç•¥2ï¼Œå…ˆæ›´æ–°æ•°æ®åº“å†åˆ é™¤ç¼“å­˜</p>
<p><strong>æ­£å¸¸æƒ…å†µ</strong></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-525.png" alt="img"></p>
<p><strong>å¼‚å¸¸æƒ…å†µ</strong></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-508.png" alt="img"></p>
<h4 id="æœ€ä½³å®è·µæ€»ç»“"><a href="#æœ€ä½³å®è·µæ€»ç»“" class="headerlink" title="æœ€ä½³å®è·µæ€»ç»“"></a>æœ€ä½³å®è·µæ€»ç»“</h4><ul>
<li>ä½¿ç”¨ <code>Cache Aside</code>ï¼›</li>
<li><strong>å†™æ“ä½œæ—¶ï¼Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</strong>ï¼›</li>
<li>ç»™ç¼“å­˜åŠ ä¸Šåˆç†çš„<strong>è¿‡æœŸæ—¶é—´</strong>ï¼Œä½œä¸ºæœ€ç»ˆä¸€è‡´æ€§çš„å…œåº•ä¿éšœï¼›</li>
<li>å¦‚æœå¯¹å¼ºä¸€è‡´æ€§è¦æ±‚æé«˜ï¼Œéœ€è¦è€ƒè™‘åŠ é”æ§åˆ¶ï¼ˆæ¯”å¦‚åˆ†å¸ƒå¼é”ï¼‰ï¼Œä½†æ€§èƒ½ä¼šä¸‹é™ã€‚</li>
</ul>
<p>ä»€ä¹ˆæ˜¯ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-526.png" alt="img"></p>
<h3 id="6-2-ç¼“å­˜ç©¿é€"><a href="#6-2-ç¼“å­˜ç©¿é€" class="headerlink" title="6.2.ç¼“å­˜ç©¿é€"></a>6.2.ç¼“å­˜ç©¿é€</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-527.png" alt="img"></p>
<p>å‡å¦‚æœ‰ä¸æ€€å¥½æ„çš„äººï¼Œå¼€å¯å¾ˆå¤šçº¿ç¨‹é¢‘ç¹çš„è®¿é—®ä¸€ä¸ªæ•°æ®åº“ä¸­ä¹Ÿä¸å­˜åœ¨çš„æ•°æ®ã€‚ç”±äºç¼“å­˜ä¸å¯èƒ½ç”Ÿæ•ˆï¼Œé‚£ä¹ˆæ‰€æœ‰çš„è¯·æ±‚éƒ½è®¿é—®æ•°æ®åº“ï¼Œå¯èƒ½å°±ä¼šå¯¼è‡´æ•°æ®åº“å› è¿‡é«˜çš„å‹åŠ›è€Œå®•æœºã€‚</p>
<p>è§£å†³è¿™ä¸ªé—®é¢˜æœ‰ä¸¤ç§æ€è·¯ï¼š</p>
<ul>
<li>ç¼“å­˜ç©ºå€¼</li>
<li>å¸ƒéš†è¿‡æ»¤å™¨</li>
</ul>
<h4 id="6-2-1-ç¼“å­˜ç©ºå€¼"><a href="#6-2-1-ç¼“å­˜ç©ºå€¼" class="headerlink" title="6.2.1.ç¼“å­˜ç©ºå€¼"></a>6.2.1.ç¼“å­˜ç©ºå€¼</h4><p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å½“æˆ‘ä»¬å‘ç°è¯·æ±‚çš„æ•°æ®å³ä¸å­˜åœ¨ä¸ç¼“å­˜ï¼Œä¹Ÿä¸å­˜åœ¨ä¸æ•°æ®åº“æ—¶ï¼Œå°†ç©ºå€¼ç¼“å­˜åˆ°Redisï¼Œé¿å…é¢‘ç¹æŸ¥è¯¢æ•°æ®åº“ã€‚å®ç°æ€è·¯å¦‚ä¸‹ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-514.png" alt="img"></p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>å®ç°ç®€å•ï¼Œç»´æŠ¤æ–¹ä¾¿</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>é¢å¤–çš„å†…å­˜æ¶ˆè€—</li>
</ul>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-528.png" alt="img"></p>
<h4 id="6-2-2-å¸ƒéš†è¿‡æ»¤å™¨"><a href="#6-2-2-å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="6.2.2.å¸ƒéš†è¿‡æ»¤å™¨"></a>6.2.2.å¸ƒéš†è¿‡æ»¤å™¨</h4><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-515-1024x534.png" alt="img"></p>
<p><strong>åŸç†ï¼š</strong><br>å¸ƒéš†è¿‡æ»¤å™¨æ˜¯<strong>ä¸€ç§ç©ºé—´æ•ˆç‡æé«˜çš„é›†åˆåˆ¤æ–­ç®—æ³•</strong>ï¼Œç”¨äºåˆ¤æ–­â€œæŸä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºé›†åˆä¸­â€ã€‚</p>
<ul>
<li>æ¯ä¸ªåˆæ³•çš„æ•°æ®åœ¨å†™å…¥æ•°æ®åº“å‰ï¼Œä¼šè¢«åŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨ã€‚</li>
<li>è¯»å–è¯·æ±‚åˆ°æ¥æ—¶ï¼Œå¦‚æœå¸ƒéš†è¿‡æ»¤å™¨è®¤ä¸ºâ€œä¸å­˜åœ¨â€ï¼Œç›´æ¥æ‹’ç»è®¿é—®æ•°æ®åº“ã€‚</li>
</ul>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>åˆ¤æ–­â€œå­˜åœ¨â€æ—¶å¯èƒ½è¯¯åˆ¤ï¼ˆå³å­˜åœ¨ä¹Ÿå¯èƒ½æ˜¯å‡çš„ï¼‰</li>
<li>åˆ¤æ–­â€œä¸å­˜åœ¨â€æ—¶ä¸€å®šå‡†ç¡®ï¼ˆè‚¯å®šä¸å­˜åœ¨ï¼‰</li>
</ul>
<p><strong>å¥½å¤„ï¼š</strong></p>
<ul>
<li>å¯ä»¥å¤§å¹…å‡å°‘æ— æ•ˆè¯·æ±‚å¯¹æ•°æ®åº“çš„å‹åŠ›</li>
</ul>
<p><strong>å¸ƒéš†è¿‡æ»¤å™¨å·¥ä½œæœºåˆ¶ï¼ˆç®€è¦ï¼‰ï¼š</strong></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-529.png" alt="img"></p>
<p>å¸ƒéš†è¿‡æ»¤ç»´æŠ¤ä¸€ä¸ªè¶…å¤§ bit æ•°ç»„ï¼Œæ‰€æœ‰ä½é»˜è®¤æ˜¯ 0</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-516-1024x174.png" alt="img"></p>
<p>ç„¶åè¿˜éœ€è¦<code>K</code>ä¸ª<code>hash</code>å‡½æ•°ï¼Œå°†å…ƒç´ åŸºäºè¿™äº›hashå‡½æ•°åšè¿ç®—çš„ç»“æœæ˜ å°„åˆ°bitæ•°ç»„çš„ä¸åŒä½ç½®ï¼Œå¹¶å°†è¿™äº›ä½ç½®ç½®ä¸º1ï¼Œä¾‹å¦‚ç°åœ¨k=3ï¼š</p>
<ul>
<li><code>hello</code>ç»è¿‡è¿ç®—å¾—åˆ°3ä¸ªè§’æ ‡ï¼š1ã€5ã€12</li>
<li><code>world</code>ç»è¿‡è¿ç®—å¾—åˆ°3ä¸ªè§’æ ‡ï¼š8ã€17ã€21</li>
<li><code>java</code>ç»è¿‡è¿ç®—å¾—åˆ°3ä¸ªè§’æ ‡ï¼š17ã€25ã€28</li>
</ul>
<p>åˆ™éœ€è¦å°†æ¯ä¸ªå…ƒç´ å¯¹åº”è§’æ ‡ä½ç½®ç½®ä¸º1ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-517-1024x329.png" alt="img"></p>
<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬è¦åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œåªéœ€è¦å†æ¬¡åŸºäº<code>K</code>ä¸ª<code>hash</code>å‡½æ•°åšè¿ç®—ï¼Œ å¾—åˆ°<code>K</code>ä¸ªè§’æ ‡ï¼Œåˆ¤æ–­æ¯ä¸ªè§’æ ‡çš„ä½ç½®æ˜¯ä¸æ˜¯1ï¼š</p>
<ul>
<li>åªè¦å…¨æ˜¯1ï¼Œå°±è¯æ˜å…ƒç´ å­˜åœ¨</li>
<li>ä»»æ„ä½ç½®ä¸º0ï¼Œå°±è¯æ˜å…ƒç´ ä¸€å®šä¸å­˜åœ¨</li>
</ul>
<p>å‡å¦‚æŸä¸ªå…ƒç´ æœ¬èº«å¹¶ä¸å­˜åœ¨ï¼Œä¹Ÿæ²¡æ·»åŠ åˆ°å¸ƒéš†è¿‡æ»¤å™¨è¿‡ã€‚ä½†æ˜¯ç”±äºå­˜åœ¨hashç¢°æ’çš„å¯èƒ½æ€§ï¼Œè¿™å°±ä¼šå‡ºç°è¿™ä¸ªå…ƒç´ è®¡ç®—å‡ºçš„è§’æ ‡å·²ç»è¢«å…¶å®ƒå…ƒç´ ç½®ä¸º1çš„æƒ…å†µã€‚é‚£ä¹ˆè¿™ä¸ªå…ƒç´ ä¹Ÿä¼šè¢«è¯¯åˆ¤ä¸ºå·²ç»å­˜åœ¨ã€‚</p>
<p>å› æ­¤ï¼Œå¸ƒéš†è¿‡æ»¤å™¨çš„åˆ¤æ–­å­˜åœ¨è¯¯å·®ï¼š</p>
<ul>
<li>å½“å¸ƒéš†è¿‡æ»¤å™¨è®¤ä¸ºå…ƒç´ ä¸å­˜åœ¨æ—¶ï¼Œå®ƒ<strong>è‚¯å®šä¸å­˜åœ¨</strong></li>
<li>å½“å¸ƒéš†è¿‡æ»¤å™¨è®¤ä¸ºå…ƒç´ å­˜åœ¨æ—¶ï¼Œå®ƒ<strong>å¯èƒ½å­˜åœ¨ï¼Œä¹Ÿå¯èƒ½ä¸å­˜åœ¨</strong></li>
</ul>
<p>å½“<code>bit</code>æ•°ç»„è¶Šå¤§ã€<code>Hash</code>å‡½æ•°<code>K</code>è¶Šå¤æ‚ï¼Œ<code>K</code>è¶Šå¤§æ—¶ï¼Œè¿™ä¸ªè¯¯åˆ¤çš„æ¦‚ç‡ä¹Ÿå°±è¶Šä½ã€‚ç”±äºé‡‡ç”¨<code>bit</code>æ•°ç»„æ¥æ ‡ç¤ºæ•°æ®ï¼Œå³ä¾¿<code>4,294,967,296</code>ä¸ª<code>bit</code>ä½ï¼Œä¹Ÿåªå <code>512mb</code>çš„ç©ºé—´</p>
<p>æˆ‘ä»¬å¯ä»¥æŠŠæ•°æ®åº“ä¸­çš„æ•°æ®åˆ©ç”¨å¸ƒéš†è¿‡æ»¤å™¨æ ‡è®°å‡ºæ¥ï¼Œå½“ç”¨æˆ·è¯·æ±‚ç¼“å­˜æœªå‘½ä¸­æ—¶ï¼Œå…ˆåŸºäºå¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­ã€‚å¦‚æœä¸å­˜åœ¨åˆ™ç›´æ¥æ‹’ç»è¯·æ±‚ï¼Œå­˜åœ¨åˆ™å»æŸ¥è¯¢æ•°æ®åº“ã€‚å°½ç®¡å¸ƒéš†è¿‡æ»¤å­˜åœ¨è¯¯å·®ï¼Œä½†ä¸€èˆ¬éƒ½åœ¨0.01%å·¦å³ï¼Œå¯ä»¥å¤§å¤§å‡å°‘æ•°æ®åº“å‹åŠ›ã€‚</p>
<p>ä½¿ç”¨å¸ƒéš†è¿‡æ»¤åçš„æµç¨‹å¦‚ä¸‹(å¸ƒéš†è¿‡æ»¤å™¨å’Œç¼“å­˜ç©ºå¯¹è±¡ä¸€èµ·ä½¿ç”¨å¯ä»¥å…œåº•)ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-518.png" alt="img"></p>
<p>æœ€ç»ˆæ¨èåšæ³•ï¼š</p>
<p>å¯ä»¥å°†ä¸¤ç§æ–¹å¼ç»“åˆä½¿ç”¨ï¼š</p>
<blockquote>
<p>âœ… <strong>å¸ƒéš†è¿‡æ»¤å™¨æ‹¦æˆªéæ³•è¯·æ±‚</strong>ï¼ˆé˜²æ­¢ç©¿é€ï¼‰<br>âœ… <strong>ç¼“å­˜ç©ºå€¼å…œåº•åˆæ³•ä½†ä¸å­˜åœ¨çš„è¯·æ±‚</strong>ï¼ˆå‡å°‘æ— æ„ä¹‰æ•°æ®åº“è®¿é—®ï¼‰</p>
</blockquote>
<div class="table-container">
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>åŸç†</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç¼“å­˜ç©ºå€¼</td>
<td>ç©ºå¯¹è±¡å†™å…¥ Redis</td>
<td>ç®€å•</td>
<td>å å†…å­˜</td>
</tr>
<tr>
<td>å¸ƒéš†è¿‡æ»¤å™¨</td>
<td>è¿‡æ»¤éæ³•è¯·æ±‚</td>
<td>é«˜æ•ˆã€èŠ‚çœèµ„æº</td>
<td>æœ‰è¯¯åˆ¤ç‡</td>
</tr>
</tbody>
</table>
</div>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-530.png" alt="img"></p>
<h3 id="6-3-ç¼“å­˜é›ªå´©"><a href="#6-3-ç¼“å­˜é›ªå´©" class="headerlink" title="6.3.ç¼“å­˜é›ªå´©"></a>6.3.ç¼“å­˜é›ªå´©</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-539.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-540.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-532-1024x528.png" alt="img"></p>
<p>å¸¸è§çš„è§£å†³æ–¹æ¡ˆæœ‰ï¼š</p>
<ul>
<li>ç»™ä¸åŒçš„Keyçš„TTLæ·»åŠ éšæœºå€¼ï¼Œè¿™æ ·KEYçš„è¿‡æœŸæ—¶é—´ä¸åŒï¼Œä¸ä¼šå¤§é‡KEYåŒæ—¶è¿‡æœŸ</li>
<li>åˆ©ç”¨Redisé›†ç¾¤æé«˜æœåŠ¡çš„å¯ç”¨æ€§ï¼Œé¿å…ç¼“å­˜æœåŠ¡å®•æœº</li>
<li>ç»™ç¼“å­˜ä¸šåŠ¡æ·»åŠ é™çº§é™æµç­–ç•¥</li>
<li>ç»™ä¸šåŠ¡æ·»åŠ å¤šçº§ç¼“å­˜ï¼ˆæ¯”å¦‚æµè§ˆå™¨çº§åˆ«ç¼“å­˜ã€nginxçº§åˆ«ç¼“å­˜ã€jvmæœ¬åœ°ç¼“å­˜ç­‰ï¼Œç„¶åå°±æ˜¯redisç¼“å­˜å’Œæ•°æ®åº“ï¼‰ï¼Œæ¯”å¦‚å…ˆæŸ¥è¯¢æœ¬åœ°ç¼“å­˜ï¼Œæœ¬åœ°ç¼“å­˜æœªå‘½ä¸­å†æŸ¥è¯¢Redisï¼ŒRedisæœªå‘½ä¸­å†æŸ¥è¯¢æ•°æ®åº“ã€‚å³ä¾¿Rediså®•æœºï¼Œä¹Ÿè¿˜æœ‰æœ¬åœ°ç¼“å­˜å¯ä»¥æŠ—å‹åŠ›</li>
</ul>
<p>å¦‚ä½•è§£å†³ç¼“å­˜é›ªå´©é—®é¢˜ï¼Ÿ</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>æ–¹æ¡ˆ</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>âœ… <strong>è®¾ç½®éšæœº TTL</strong></td>
<td>ç»™ä¸åŒçš„ key è®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´ï¼ˆåŠ ä¸Šéšæœºæ•°ï¼‰ï¼Œè®©å®ƒä»¬é”™å³°è¿‡æœŸ</td>
</tr>
<tr>
<td>âœ… <strong>Redis é«˜å¯ç”¨éƒ¨ç½²</strong></td>
<td>ä½¿ç”¨ Redis Sentinel æˆ–é›†ç¾¤æ¨¡å¼ï¼Œæé«˜ Redis çš„å®¹ç¾èƒ½åŠ›</td>
</tr>
<tr>
<td>âœ… <strong>é™æµ+é™çº§</strong></td>
<td>å½“ Redis å®•æœºæ—¶ï¼Œé™åˆ¶è¯·æ±‚æµé‡ï¼Œæˆ–è€…ç»™å‡ºé™çº§å“åº”ï¼ˆå¦‚â€œç¨åå†è¯•â€ï¼‰</td>
</tr>
<tr>
<td>âœ… <strong>å¤šçº§ç¼“å­˜</strong></td>
<td>æ·»åŠ æœ¬åœ°ç¼“å­˜ï¼ˆJVMã€æµè§ˆå™¨ã€nginxï¼‰ä½œä¸ºç¬¬ä¸€é“é˜²çº¿ï¼Œå‡å°‘ Redis å‹åŠ›</td>
</tr>
<tr>
<td>âœ… <strong>é¢„çƒ­æœºåˆ¶</strong></td>
<td>Redis é‡å¯åï¼Œæå‰æŠŠçƒ­ç‚¹æ•°æ®é‡æ–°åŠ è½½è¿›ç¼“å­˜ï¼Œé¿å…åˆšå¯åŠ¨æ—¶å°±é›ªå´©</td>
</tr>
</tbody>
</table>
</div>
<p>ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©å¦‚ä½•è§£å†³</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-541.png" alt="img"></p>
<h3 id="6-4-ç¼“å­˜å‡»ç©¿"><a href="#6-4-ç¼“å­˜å‡»ç©¿" class="headerlink" title="6.4.ç¼“å­˜å‡»ç©¿"></a>6.4.ç¼“å­˜å‡»ç©¿</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-542.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-533-1024x644.png" alt="img"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼š</p>
<ul>
<li>çº¿ç¨‹ 1 å‘ç°ç¼“å­˜æ²¡å‘½ä¸­ï¼Œå»æŸ¥æ•°æ®åº“ï¼›</li>
<li>æ•°æ®åº“è®¿é—®è¾ƒæ…¢ï¼Œçº¿ç¨‹ 1 è¿˜æ²¡æ„å»ºç¼“å­˜ï¼›</li>
<li>çº¿ç¨‹ 2ã€3ã€4 ç´§éšå…¶åï¼Œä¹Ÿå‘ç°æ²¡ç¼“å­˜ï¼Œäºæ˜¯<strong>éƒ½å»æ•°æ®åº“æŸ¥è¯¢</strong>ï¼›</li>
<li>æ•°æ®åº“è¢«å‹å®ï¼</li>
<li>è¿™å°±æ˜¯å…¸å‹çš„â€œå‡»ç©¿â€åœºæ™¯ã€‚</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong></p>
<h4 id="æ–¹æ¡ˆä¸€ï¼šäº’æ–¥é”ï¼ˆåŠ é”é˜²æ­¢é‡å¤æ„å»ºï¼‰"><a href="#æ–¹æ¡ˆä¸€ï¼šäº’æ–¥é”ï¼ˆåŠ é”é˜²æ­¢é‡å¤æ„å»ºï¼‰" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼šäº’æ–¥é”ï¼ˆåŠ é”é˜²æ­¢é‡å¤æ„å»ºï¼‰"></a>æ–¹æ¡ˆä¸€ï¼šäº’æ–¥é”ï¼ˆåŠ é”é˜²æ­¢é‡å¤æ„å»ºï¼‰</h4><p><strong>æ ¸å¿ƒæ€è·¯ï¼š</strong></p>
<ul>
<li>åŒä¸€æ—¶é—´åªå…è®¸ä¸€ä¸ªçº¿ç¨‹å»é‡å»ºç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…æˆ–è¿”å›æ—§æ•°æ®ã€‚</li>
</ul>
<p><strong>å¸¸è§å®ç°ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨åˆ†å¸ƒå¼é”ï¼ˆå¦‚ Redis çš„ SETNX + TTLï¼‰æ§åˆ¶ï¼›</li>
<li>åŠ é”åï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è®¿é—®æ•°æ®åº“å¹¶åˆ·æ–°ç¼“å­˜ï¼›</li>
<li>å…¶ä»–çº¿ç¨‹ç­‰å¾…æˆ–å¿«é€Ÿè¿”å›æ—§å€¼ã€‚</li>
</ul>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>ç²¾ç¡®æ§åˆ¶ï¼Œé¿å…å¹¶å‘è®¿é—®æ•°æ®åº“ã€‚</li>
<li><p>ä¿è¯ä¸€è‡´æ€§</p>
<p>ç¼ºç‚¹ï¼š</p>
</li>
<li><p>é”ç«äº‰æ¿€çƒˆæ—¶å¯èƒ½ä¼šå½±å“æ€§èƒ½ï¼›</p>
</li>
<li>å¯èƒ½æœ‰æ­»é”é£é™©</li>
</ul>
<h4 id="æ–¹æ¡ˆäºŒï¼šé€»è¾‘è¿‡æœŸï¼ˆç¼“å­˜ä¸­ä¿å­˜ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼‰"><a href="#æ–¹æ¡ˆäºŒï¼šé€»è¾‘è¿‡æœŸï¼ˆç¼“å­˜ä¸­ä¿å­˜ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼‰" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šé€»è¾‘è¿‡æœŸï¼ˆç¼“å­˜ä¸­ä¿å­˜ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼‰"></a>æ–¹æ¡ˆäºŒï¼šé€»è¾‘è¿‡æœŸï¼ˆç¼“å­˜ä¸­ä¿å­˜ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼‰</h4><p><strong>æ ¸å¿ƒæ€è·¯ï¼š</strong></p>
<ul>
<li>ç¼“å­˜ä¸­å­˜å‚¨çš„æ•°æ®é™¤äº†valueå¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå­—æ®µæ˜¯è¿‡æœŸæ—¶é—´ï¼ˆexpireTimeï¼‰ï¼›</li>
<li>è¯»å–ç¼“å­˜æ—¶ï¼Œå¦‚æœæ²¡æœ‰è¿‡æœŸå°±ç›´æ¥è¿”å›ï¼›</li>
<li>å¦‚æœè¿‡æœŸäº†ï¼Œåˆ™å…ˆè¿”å›æ—§æ•°æ®ï¼ŒåŒæ—¶å¼‚æ­¥åˆ·æ–°ç¼“å­˜ï¼ˆæ¯”å¦‚ç”±ä¸€ä¸ªåå°çº¿ç¨‹æ¥åšï¼‰ï¼›</li>
</ul>
<p>ğŸ“Œ ä¼˜ç‚¹ï¼š</p>
<ul>
<li>æ•°æ®ä¸ä¼šå®Œå…¨å¤±æ•ˆï¼Œç”¨æˆ·å§‹ç»ˆèƒ½è¯»åˆ°æ—§æ•°æ®ï¼Œé¿å…å¹¶å‘æ‰“åˆ°æ•°æ®åº“ï¼›</li>
<li>æé«˜ç³»ç»Ÿé²æ£’æ€§ã€‚</li>
<li>çº¿ç¨‹æ— éœ€ç­‰å¾…æ€§èƒ½è¾ƒå¥½</li>
</ul>
<p>ğŸ“Œ ç¼ºç‚¹ï¼š</p>
<ul>
<li>ä»£ç å¤æ‚åº¦é«˜ä¸€äº›ï¼ˆéœ€è¦ç»´æŠ¤é€»è¾‘è¿‡æœŸå’Œåå°åˆ·æ–°çº¿ç¨‹ï¼‰ï¼›</li>
<li>æ•°æ®å¯èƒ½æ˜¯â€œæ—§çš„â€ï¼Œä¸æ˜¯å®æ—¶çš„ã€‚ï¼ˆä¸ä¿è¯ä¸€è‡´æ€§ï¼‰</li>
<li>æœ‰é¢å¤–å†…å­˜æ¶ˆè€—</li>
</ul>
<p>åŸºäºäº’æ–¥é”çš„æ–¹æ¡ˆå¦‚å›¾ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-535.png" alt="img"></p>
<p>é€»è¾‘è¿‡æœŸçš„æ€è·¯å¦‚å›¾ï¼š</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-536-1024x712.png" alt="img"></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>æ–¹æ¡ˆ</th>
<th>åŸç†</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>äº’æ–¥é”</td>
<td>åŠ é”æ§åˆ¶åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æ„å»ºç¼“å­˜</td>
<td>ç²¾ç¡®æ§åˆ¶ï¼Œé˜²æ­¢å¹¶å‘é‡å»º</td>
<td>æ€§èƒ½å½±å“å¤§ï¼Œé”ç«äº‰é—®é¢˜</td>
</tr>
<tr>
<td>é€»è¾‘è¿‡æœŸ</td>
<td>ç¼“å­˜ä¸­å¢åŠ è¿‡æœŸæ—¶é—´å­—æ®µ</td>
<td>æ°¸ä¸å¤±æ•ˆï¼Œä¸æ‰“çˆ†æ•°æ®åº“</td>
<td>å®ç°å¤æ‚ï¼Œæœ‰æ•°æ®å»¶è¿Ÿé£é™©</td>
</tr>
</tbody>
</table>
</div>
<h3 id="6-5-é¢è¯•æ€»ç»“-ç¼“å­˜é—®é¢˜"><a href="#6-5-é¢è¯•æ€»ç»“-ç¼“å­˜é—®é¢˜" class="headerlink" title="6.5.é¢è¯•æ€»ç»“ -ç¼“å­˜é—®é¢˜"></a>6.5.é¢è¯•æ€»ç»“ -ç¼“å­˜é—®é¢˜</h3><p>1.<strong>é¢è¯•é¢˜</strong>ï¼š<strong>å¦‚ä½•ä¿è¯ç¼“å­˜çš„**</strong>åŒå†™ä¸€è‡´æ€§**ï¼Ÿ</p>
<p><strong>ç­”</strong>ï¼šç¼“å­˜çš„åŒå†™ä¸€è‡´æ€§å¾ˆéš¾ä¿è¯å¼ºä¸€è‡´ï¼Œåªèƒ½å°½å¯èƒ½é™ä½ä¸ä¸€è‡´çš„æ¦‚ç‡ï¼Œç¡®ä¿æœ€ç»ˆä¸€è‡´ã€‚æˆ‘ä»¬é¡¹ç›®ä¸­é‡‡ç”¨çš„æ˜¯<code>Cache Aside</code>æ¨¡å¼ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯åœ¨æ›´æ–°æ•°æ®åº“ä¹‹ååˆ é™¤ç¼“å­˜ï¼›åœ¨æŸ¥è¯¢æ—¶å…ˆæŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœæœªå‘½ä¸­åˆ™æŸ¥è¯¢æ•°æ®åº“å¹¶å†™å…¥ç¼“å­˜ã€‚åŒæ—¶æˆ‘ä»¬ä¼šç»™ç¼“å­˜è®¾ç½®è¿‡æœŸæ—¶é—´ä½œä¸ºå…œåº•æ–¹æ¡ˆï¼Œå¦‚æœçœŸçš„å‡ºç°äº†ä¸ä¸€è‡´çš„æƒ…å†µï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç¼“å­˜è¿‡æœŸæ¥ä¿è¯æœ€ç»ˆä¸€è‡´ã€‚</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-543.png" alt="img"></p>
<p><strong>è¿½é—®</strong>ï¼šä¸ºä»€ä¹ˆä¸é‡‡ç”¨å»¶è¿ŸåŒåˆ æœºåˆ¶ï¼Ÿ</p>
<p><strong>ç­”</strong>ï¼šå»¶è¿ŸåŒåˆ çš„ç¬¬ä¸€æ¬¡åˆ é™¤å¹¶æ²¡æœ‰å®é™…æ„ä¹‰ï¼Œç¬¬äºŒæ¬¡é‡‡ç”¨å»¶è¿Ÿåˆ é™¤ä¸»è¦æ˜¯è§£å†³æ•°æ®åº“ä¸»ä»åŒæ­¥çš„å»¶è¿Ÿé—®é¢˜ï¼Œæˆ‘è®¤ä¸ºè¿™æ˜¯æ•°æ®åº“ä¸»ä»çš„ä¸€è‡´æ€§é—®é¢˜ï¼Œä¸ç¼“å­˜åŒæ­¥æ— å…³ã€‚æ—¢ç„¶ä¸»èŠ‚ç‚¹æ•°æ®å·²ç»æ›´æ–°ï¼ŒRedisçš„ç¼“å­˜ç†åº”æ›´æ–°ã€‚è€Œä¸”å»¶è¿ŸåŒåˆ ä¼šå¢åŠ ç¼“å­˜ä¸šåŠ¡å¤æ‚åº¦ï¼Œä¹Ÿæ²¡èƒ½å®Œå…¨é¿å…ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ï¼ŒæŠ•å…¥å›æŠ¥æ¯”å¤ªä½ã€‚</p>
<p>2.<strong>é¢è¯•é¢˜</strong>ï¼š<strong>å¦‚ä½•è§£å†³ç¼“å­˜ç©¿é€é—®é¢˜</strong>ï¼Ÿ</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-544.png" alt="img"></p>
<p><strong>ç­”</strong>ï¼šç¼“å­˜ç©¿é€ä¹Ÿå¯ä»¥è¯´æ˜¯ç©¿é€æ”»å‡»ï¼Œå…·ä½“æ¥è¯´æ˜¯å› ä¸ºè¯·æ±‚è®¿é—®åˆ°äº†æ•°æ®åº“ä¸å­˜åœ¨çš„å€¼ï¼Œè¿™æ ·ç¼“å­˜æ— æ³•å‘½ä¸­ï¼Œå¿…ç„¶è®¿é—®æ•°æ®åº“ã€‚å¦‚æœé«˜å¹¶å‘çš„è®¿é—®è¿™æ ·çš„æ¥å£ï¼Œä¼šç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§å‹åŠ›ã€‚</p>
<p>æˆ‘ä»¬é¡¹ç›®ä¸­éƒ½æ˜¯åŸºäºå¸ƒéš†è¿‡æ»¤å™¨æ¥è§£å†³ç¼“å­˜ç©¿é€é—®é¢˜çš„ï¼Œå½“ç¼“å­˜æœªå‘½ä¸­æ—¶åŸºäºå¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœä¸å­˜åœ¨åˆ™ä¸å»è®¿é—®æ•°æ®åº“ã€‚</p>
<p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç¼“å­˜ç©ºå€¼çš„æ–¹å¼è§£å†³ï¼Œä¸è¿‡è¿™ç§æ–¹æ¡ˆæ¯”è¾ƒæµªè´¹å†…å­˜ã€‚</p>
<p>3.<strong>é¢è¯•é¢˜</strong>ï¼š<strong>å¦‚ä½•è§£å†³ç¼“å­˜é›ªå´©é—®é¢˜</strong>ï¼Ÿ</p>
<p><strong>ç­”</strong>ï¼šç¼“å­˜é›ªå´©çš„å¸¸è§åŸå› æœ‰ä¸¤ä¸ªï¼Œç¬¬ä¸€æ˜¯å› ä¸ºå¤§é‡keyåŒæ—¶è¿‡æœŸã€‚é’ˆå¯¹é—®è¿™ä¸ªé¢˜æˆ‘ä»¬å¯ä»¥å¯ä»¥ç»™ç¼“å­˜keyè®¾ç½®ä¸åŒçš„TTLå€¼ï¼Œé¿å…keyåŒæ—¶è¿‡æœŸã€‚</p>
<p>ç¬¬äºŒä¸ªåŸå› æ˜¯Rediså®•æœºå¯¼è‡´ç¼“å­˜ä¸å¯ç”¨ã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜æˆ‘ä»¬å¯ä»¥åˆ©ç”¨é›†ç¾¤æé«˜Redisçš„å¯ç”¨æ€§ã€‚ä¹Ÿå¯ä»¥æ·»åŠ å¤šçº§ç¼“å­˜ï¼Œå½“Rediså®•æœºæ—¶è¿˜æœ‰æœ¬åœ°ç¼“å­˜å¯ç”¨ã€‚</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-545.png" alt="img"></p>
<p>4.<strong>é¢è¯•é¢˜</strong>ï¼š<strong>å¦‚ä½•è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜</strong>ï¼Ÿ</p>
<p><strong>ç­”</strong>ï¼šç¼“å­˜å‡»ç©¿å¾€å¾€æ˜¯ç”±çƒ­ç‚¹Keyå¼•èµ·çš„ï¼Œå½“çƒ­ç‚¹Keyè¿‡æœŸæ—¶ï¼Œå¤§é‡è¯·æ±‚æ¶Œå…¥åŒæ—¶æŸ¥è¯¢ï¼Œå‘ç°ç¼“å­˜æœªå‘½ä¸­éƒ½ä¼šå»è®¿é—®æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›æ¿€å¢ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸»è¦æ€è·¯å°±æ˜¯é¿å…å¤šçº¿ç¨‹å¹¶å‘å»é‡å»ºç¼“å­˜ï¼Œå› æ­¤æ–¹æ¡ˆæœ‰ä¸¤ç§ã€‚</p>
<p>ç¬¬ä¸€ç§æ˜¯åŸºäºäº’æ–¥é”ï¼Œå½“å‘ç°ç¼“å­˜æœªå‘½ä¸­æ—¶éœ€è¦å…ˆè·å–äº’æ–¥é”ï¼Œå†é‡å»ºç¼“å­˜ï¼Œç¼“å­˜é‡å»ºå®Œæˆé‡Šæ”¾é”ã€‚è¿™æ ·å°±å¯ä»¥ä¿è¯ç¼“å­˜é‡å»ºåŒä¸€æ—¶åˆ»åªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚ä¸è¿‡è¿™ç§åšæ³•ä¼šå¯¼è‡´ç¼“å­˜é‡å»ºæ—¶æ€§èƒ½ä¸‹é™ä¸¥é‡ã€‚</p>
<p>ç¬¬äºŒç§æ˜¯åŸºäºé€»è¾‘è¿‡æœŸï¼Œä¹Ÿå°±æ˜¯ä¸ç»™çƒ­ç‚¹Keyè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè€Œæ˜¯ç»™æ•°æ®æ·»åŠ ä¸€ä¸ªè¿‡æœŸæ—¶é—´çš„å­—æ®µã€‚è¿™æ ·çƒ­ç‚¹Keyå°±ä¸ä¼šè¿‡æœŸï¼Œç¼“å­˜ä¸­æ°¸è¿œæœ‰æ•°æ®ã€‚</p>
<p>æŸ¥è¯¢åˆ°æ•°æ®æ—¶åŸºäºå…¶ä¸­çš„è¿‡æœŸæ—¶é—´åˆ¤æ–­keyæ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸå¼€å¯ç‹¬ç«‹æ–°çº¿ç¨‹å¼‚æ­¥çš„é‡å»ºç¼“å­˜ï¼Œè€ŒæŸ¥è¯¢è¯·æ±‚å…ˆè¿”å›æ—§æ•°æ®å³å¯ã€‚å½“ç„¶ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿè¦åŠ äº’æ–¥é”ï¼Œä½†ç”±äºé‡å»ºç¼“å­˜æ˜¯å¼‚æ­¥çš„ï¼Œè€Œä¸”è·å–é”å¤±è´¥ä¹Ÿæ— éœ€ç­‰å¾…ï¼Œè€Œæ˜¯è¿”å›æ—§æ•°æ®ï¼Œè¿™æ ·æ€§èƒ½å‡ ä¹ä¸å—å½±å“ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ— è®ºæ˜¯é‡‡ç”¨å“ªç§æ–¹å¼ï¼Œåœ¨è·å–äº’æ–¥é”åä¸€å®šè¦å†æ¬¡åˆ¤æ–­ç¼“å­˜æ˜¯å¦å‘½ä¸­ï¼Œåšdubbo check. å› ä¸ºå½“ä½ è·å–é”æˆåŠŸæ—¶ï¼Œå¯èƒ½æ˜¯åœ¨ä½ ä¹‹å‰æœ‰å…¶å®ƒçº¿ç¨‹å·²ç»é‡å»ºç¼“å­˜äº†ã€‚</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/08/image-546.png" alt="img"></p>
<h3 id="6-6ä¸€å¼ è¡¨ææ‡‚ç¼“å­˜é—®é¢˜"><a href="#6-6ä¸€å¼ è¡¨ææ‡‚ç¼“å­˜é—®é¢˜" class="headerlink" title="6.6ä¸€å¼ è¡¨ææ‡‚ç¼“å­˜é—®é¢˜"></a>6.6ä¸€å¼ è¡¨ææ‡‚ç¼“å­˜é—®é¢˜</h3><div class="table-container">
<table>
<thead>
<tr>
<th>é—®é¢˜åç§°</th>
<th>å®šä¹‰</th>
<th>æˆå› </th>
<th>è§£å†³æ–¹æ¡ˆ</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç¼“å­˜ä¸€è‡´æ€§</td>
<td>ç¼“å­˜ä¸æ•°æ®åº“çš„æ•°æ®ä¸ä¸€è‡´</td>
<td>æ•°æ®åº“æ›´æ–°äº†ä½†ç¼“å­˜æ²¡æ›´æ–°æˆ–å»¶è¿Ÿæ›´æ–°</td>
<td>å…ˆæ›´æ–°æ•°æ®åº“å†åˆ ç¼“å­˜ï¼›åˆç†è®¾ç½® TTLï¼›æ¥å—æœ€ç»ˆä¸€è‡´æ€§</td>
<td>å¯¹ä¸€è‡´æ€§è¦æ±‚é«˜çš„ç³»ç»Ÿï¼Œå¦‚è®¢å•çŠ¶æ€</td>
</tr>
<tr>
<td>ç¼“å­˜ç©¿é€</td>
<td>è¯·æ±‚çš„æ˜¯æ•°æ®åº“å’Œç¼“å­˜éƒ½æ²¡æœ‰çš„æ•°æ®</td>
<td>æ¶æ„è¯·æ±‚æˆ–æŸ¥è¯¢ç©ºå€¼</td>
<td>ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨æ‹¦æˆªï¼›ç¼“å­˜ç©ºå€¼</td>
<td>è¯·æ±‚å‚æ•°æ— æ•ˆæˆ–ä¸å¸¸è§ï¼Œæ¯”å¦‚æ— æ•ˆç”¨æˆ·ID</td>
</tr>
<tr>
<td>ç¼“å­˜é›ªå´©</td>
<td>å¤§é‡ç¼“å­˜åŒä¸€æ—¶é—´è¿‡æœŸï¼Œå¯¼è‡´è¯·æ±‚æ‰“çˆ†æ•°æ®åº“</td>
<td>è®¾ç½®äº†ç›¸åŒè¿‡æœŸæ—¶é—´ï¼›Redis å®•æœº</td>
<td>è¿‡æœŸæ—¶é—´åŠ éšæœºï¼›ä½¿ç”¨æœ¬åœ°ç¼“å­˜å…œåº•ï¼›éƒ¨ç½²é«˜å¯ç”¨ Redis é›†ç¾¤</td>
<td>ç§’æ€æ´»åŠ¨ã€å¤§é‡ç¼“å­˜é›†ä¸­è®¾ç½®ä¸€è‡´è¿‡æœŸæ—¶é—´åœºæ™¯</td>
</tr>
<tr>
<td>ç¼“å­˜å‡»ç©¿</td>
<td>æŸä¸ªçƒ­ç‚¹ key è¿‡æœŸï¼Œç¬é—´å¤§é‡è¯·æ±‚æ‰“åˆ°æ•°æ®åº“</td>
<td>çƒ­ç‚¹æ•°æ®åˆšå¥½è¿‡æœŸï¼Œé«˜å¹¶å‘åŒæ—¶è¯·æ±‚</td>
<td>åŠ äº’æ–¥é”é˜²æ­¢é‡å¤æ„å»ºï¼›é€»è¾‘è¿‡æœŸ+åå°å¼‚æ­¥é‡å»º</td>
<td>çƒ­ç‚¹å•†å“è¯¦æƒ…é¡µã€ç”¨æˆ·èµ„æ–™é¡µç­‰</td>
</tr>
</tbody>
</table>
</div>
<h2 id="é¢è¯•ç¯‡å®Œç»“æ’’èŠ±"><a href="#é¢è¯•ç¯‡å®Œç»“æ’’èŠ±" class="headerlink" title="é¢è¯•ç¯‡å®Œç»“æ’’èŠ±"></a>é¢è¯•ç¯‡å®Œç»“æ’’èŠ±</h2></article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>Redisé¢è¯•ç¯‡</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://itgeqian.github.io/posts/35.html">https://itgeqian.github.io/posts/35.html</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>ä½œè€…</h><div class="post-copyright-cc-info"><h>geqian's BlogğŸ­</h></div></div><div class="post-copyright-c"><h>å‘å¸ƒäº</h><div class="post-copyright-cc-info"><h>2025-08-07</h></div></div><div class="post-copyright-u"><h>æ›´æ–°äº</h><div class="post-copyright-cc-info"><h>2025-08-08</h></div></div><div class="post-copyright-c"><h>è®¸å¯åè®®</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Redis/"><div class="tags-punctuation"><svg class="faa-tada icon" style="height:1.1em;width:1.1em;fill:currentColor;position:relative;top:2px;margin-right:3px" aria-hidden="true"><use xlink:href="#icon-sekuaibiaoqian"></use></svg></div>Redis</a></div></div><link rel="stylesheet" href="/css/coin.css" media="defer" onload="this.media='all'"/><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">æŠ•å–‚ä½œè€…</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://java-geqian.oss-cn-beijing.aliyuncs.com/%E5%BE%AE%E4%BF%A1PAY.jpg" target="_blank"><img class="post-qr-code-img" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/%E5%BE%AE%E4%BF%A1PAY.jpg" alt="å¾®ä¿¡"/></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="https://java-geqian.oss-cn-beijing.aliyuncs.com/%E6%94%AF%E4%BB%98%E5%AE%9DPAY.jpg" target="_blank"><img class="post-qr-code-img" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/%E6%94%AF%E4%BB%98%E5%AE%9DPAY.jpg" alt="æ”¯ä»˜å®"/></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li></ul></div></button></div><audio id="coinAudio" src="https://npm.elemecdn.com/akilar-candyassets@1.0.36/audio/aowu.m4a"></audio><script defer="defer" src="/js/coin.js"></script><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/38.html"><img class="prev-cover" src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">è½¯ä»¶æ¨èBongoCat</div></div></a></div><div class="next-post pull-right"><a href="/posts/34.html"><img class="next-cover" src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">Elasticsearché«˜çº§ç¯‡</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/posts/73.html" title="Redisç›¸å…³é¢è¯•é¢˜"><img class="cover" src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-10-09</div><div class="title">Redisç›¸å…³é¢è¯•é¢˜</div></div></a></div><div><a href="/posts/5.html" title="RedisåŸºç¡€ç¯‡"><img class="cover" src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2024-09-12</div><div class="title">RedisåŸºç¡€ç¯‡</div></div></a></div><div><a href="/posts/6.html" title="Rediså®æˆ˜ç¯‡"><img class="cover" src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2024-09-17</div><div class="title">Rediså®æˆ˜ç¯‡</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><svg class="meta_icon" style="width:22px;height:22px;position:relative;top:5px"><use xlink:href="#icon-mulu1"></use></svg><span style="font-weight:bold">ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Redis%E4%B8%BB%E4%BB%8E"><span class="toc-text">1.Redisä¸»ä»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E4%B8%BB%E4%BB%8E%E9%9B%86%E7%BE%A4%E7%BB%93%E6%9E%84"><span class="toc-text">1.1.ä¸»ä»é›†ç¾¤ç»“æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E6%90%AD%E5%BB%BA%E4%B8%BB%E4%BB%8E%E9%9B%86%E7%BE%A4"><span class="toc-text">1.2.æ­å»ºä¸»ä»é›†ç¾¤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E9%9B%86%E7%BE%A4"><span class="toc-text">å»ºç«‹é›†ç¾¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-text">æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E5%8E%9F%E7%90%86"><span class="toc-text">1.3.ä¸»ä»åŒæ­¥åŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-%E5%85%A8%E9%87%8F%E5%90%8C%E6%AD%A5"><span class="toc-text">1.3.1.å…¨é‡åŒæ­¥</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%A8%E9%87%8F%E5%90%8C%E6%AD%A5%E7%9A%84%E8%A7%A6%E5%8F%91%E6%97%B6%E6%9C%BA"><span class="toc-text">å…¨é‡åŒæ­¥çš„è§¦å‘æ—¶æœº</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%AF%B4%E6%98%8E"><span class="toc-text">æ ¸å¿ƒæ•°æ®ç»“æ„è¯´æ˜</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-2-%E5%A2%9E%E9%87%8F%E5%90%8C%E6%AD%A5"><span class="toc-text">1.3.2.å¢é‡åŒæ­¥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-3-repl-baklog%E5%8E%9F%E7%90%86"><span class="toc-text">1.3.3.repl_baklogåŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A8%A1%E6%8B%9F%E5%A2%9E%E9%87%8F%E5%90%8C%E6%AD%A5%E7%9A%84%E5%87%A0%E4%B8%AA%E5%9C%BA%E6%99%AF"><span class="toc-text">æ¨¡æ‹Ÿå¢é‡åŒæ­¥çš„å‡ ä¸ªåœºæ™¯</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B3%E4%BA%8Eslave-%E6%81%A2%E5%A4%8D%E8%BF%9E%E6%8E%A5%E6%97%B6%E5%8F%91%E9%80%81%E8%87%AA%E5%B7%B1%E7%9A%84-offset-%E6%98%AF%E6%80%8E%E4%B9%88%E5%9B%9E%E4%BA%8B"><span class="toc-text">å…³äºslave æ¢å¤è¿æ¥æ—¶å‘é€è‡ªå·±çš„ offset æ˜¯æ€ä¹ˆå›äº‹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E4%BC%98%E5%8C%96"><span class="toc-text">1.4.ä¸»ä»åŒæ­¥ä¼˜åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%B8%8F%E2%83%A3-%E5%90%AF%E7%94%A8%E6%97%A0%E7%A3%81%E7%9B%98%E5%A4%8D%E5%88%B6%EF%BC%9A"><span class="toc-text">1ï¸âƒ£ å¯ç”¨æ— ç£ç›˜å¤åˆ¶ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%B8%8F%E2%83%A3-%E5%87%8F%E5%B0%91%E5%8D%95%E8%8A%82%E7%82%B9%E5%86%85%E5%AD%98%E5%A4%A7%E5%B0%8F%EF%BC%88%E5%BB%BA%E8%AE%AE-%E2%89%A4-8GB%EF%BC%89"><span class="toc-text">2ï¸âƒ£ å‡å°‘å•èŠ‚ç‚¹å†…å­˜å¤§å°ï¼ˆå»ºè®® â‰¤ 8GBï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%B8%8F%E2%83%A3-%E5%A2%9E%E5%A4%A7-repl-backlog-%E5%A4%A7%E5%B0%8F%EF%BC%88%E9%BB%98%E8%AE%A4%E4%BB%85-1MB%EF%BC%89"><span class="toc-text">3ï¸âƒ£ å¢å¤§ repl_backlog å¤§å°ï¼ˆé»˜è®¤ä»… 1MBï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%EF%B8%8F%E2%83%A3-%E6%8E%A7%E5%88%B6%E4%BB%8E%E8%8A%82%E7%82%B9%E6%95%B0%E9%87%8F%EF%BC%8C%E9%87%87%E7%94%A8%E2%80%9C%E4%B8%BB-%E4%BB%8E-%E4%BB%8E%E2%80%9D%E9%93%BE%E5%BC%8F%E7%BB%93%E6%9E%84"><span class="toc-text">4ï¸âƒ£ æ§åˆ¶ä»èŠ‚ç‚¹æ•°é‡ï¼Œé‡‡ç”¨â€œä¸»-ä»-ä»â€é“¾å¼ç»“æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%A0%E9%81%93%E5%B8%B8%E8%A7%81%E7%9A%84%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%9F"><span class="toc-text">å‡ é“å¸¸è§çš„é¢è¯•é¢˜ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Redis%E5%93%A8%E5%85%B5"><span class="toc-text">2.Rediså“¨å…µ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%93%A8%E5%85%B5%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-text">2.1.å“¨å…µå·¥ä½œåŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-%E5%93%A8%E5%85%B5%E4%BD%9C%E7%94%A8"><span class="toc-text">2.1.1.å“¨å…µä½œç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-%E7%8A%B6%E6%80%81%E7%9B%91%E6%8E%A7-Sentinel-%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E4%B8%BB%E8%8A%82%E7%82%B9%E6%95%85%E9%9A%9C%EF%BC%9F"><span class="toc-text">2.1.2.çŠ¶æ€ç›‘æ§-Sentinel å¦‚ä½•åˆ¤æ–­ä¸»èŠ‚ç‚¹æ•…éšœï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E9%80%89%E5%87%BA%E6%96%B0%E7%9A%84-master%EF%BC%9F"><span class="toc-text">å¦‚ä½•é€‰å‡ºæ–°çš„ masterï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-%E9%80%89%E4%B8%BEleader"><span class="toc-text">2.1.3.é€‰ä¸¾leader</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4-failover-%E6%95%85%E9%9A%9C%E6%81%A2%E5%A4%8D"><span class="toc-text">2.1.4.failover æ•…éšœæ¢å¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A5%E5%85%85%E4%B8%80%E4%B8%AA%E7%BB%86%E8%8A%82%EF%BC%9A"><span class="toc-text">è¡¥å……ä¸€ä¸ªç»†èŠ‚ï¼š</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E6%90%AD%E5%BB%BA%E5%93%A8%E5%85%B5%E9%9B%86%E7%BE%A4"><span class="toc-text">2.2.æ­å»ºå“¨å…µé›†ç¾¤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Sentinel-ID-is-8e91bd24ea8e5eb2aee38f1cf796dcb26bb88acf"><span class="toc-text">Sentinel ID is 8e91bd24ea8e5eb2aee38f1cf796dcb26bb88acf</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#monitor-master-hmaster-192-168-150-101-7001-quorum-2"><span class="toc-text">+monitor master hmaster 192.168.150.101 7001 quorum 2</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A57001%E8%BF%99%E4%B8%AAmaster%E8%8A%82%E7%82%B9%EF%BC%8C%E9%80%9A%E8%BF%87sleep%E6%A8%A1%E6%8B%9F%E6%9C%8D%E5%8A%A1%E5%AE%95%E6%9C%BA%EF%BC%8C60%E7%A7%92%E5%90%8E%E8%87%AA%E5%8A%A8%E6%81%A2%E5%A4%8D"><span class="toc-text">è¿æ¥7001è¿™ä¸ªmasterèŠ‚ç‚¹ï¼Œé€šè¿‡sleepæ¨¡æ‹ŸæœåŠ¡å®•æœºï¼Œ60ç§’åè‡ªåŠ¨æ¢å¤</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C%EF%BC%9A"><span class="toc-text">ç»“æœï¼š</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5%E4%BB%BB%E6%84%8F%E8%8A%82%E7%82%B9%E5%AE%B9%E5%99%A8"><span class="toc-text">è¿›å…¥ä»»æ„èŠ‚ç‚¹å®¹å™¨</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%EF%BC%8C%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-text">ç„¶åï¼Œæ‰§è¡Œå‘½ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E6%95%A3%E5%88%97%E6%8F%92%E6%A7%BD"><span class="toc-text">3.2.æ•£åˆ—æ’æ§½</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%EF%BC%9A%E6%8F%92%E6%A7%BD%E6%9C%BA%E5%88%B6%E6%BC%94%E7%A4%BA"><span class="toc-text">å®éªŒï¼šæ’æ§½æœºåˆ¶æ¼”ç¤º</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB"><span class="toc-text">3.3.æ•…éšœè½¬ç§»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E6%80%BB%E7%BB%93-Redis%E5%88%86%E7%89%87%E9%9B%86%E7%BE%A4%E5%87%A0%E4%B8%AA%E9%9D%A2%E8%AF%95%E9%A2%98"><span class="toc-text">3.4.æ€»ç»“-Redisåˆ†ç‰‡é›†ç¾¤å‡ ä¸ªé¢è¯•é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-Java%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5%E5%88%86%E7%89%87%E9%9B%86%E7%BE%A4"><span class="toc-text">3.5.Javaå®¢æˆ·ç«¯è¿æ¥åˆ†ç‰‡é›†ç¾¤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-text">4.Redisæ•°æ®ç»“æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-RedisObject%EF%BC%9ARedis%E4%B8%AD%E7%9A%84%E2%80%9C%E5%AF%B9%E8%B1%A1%E5%A4%B4%E2%80%9D"><span class="toc-text">4.1.RedisObjectï¼šRedisä¸­çš„â€œå¯¹è±¡å¤´â€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-SkipList"><span class="toc-text">4.2.SkipList</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-SortedSet"><span class="toc-text">4.3.SortedSet</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%BA%E4%BB%80%E4%B9%88-ZSet-%E8%A6%81%E7%94%A8%E8%B7%B3%E8%A1%A8%EF%BC%8C%E8%80%8C%E4%B8%8D%E6%98%AF%E5%B9%B3%E8%A1%A1%E6%A0%91%EF%BC%88%E5%A6%82-AVL-%E6%88%96%E7%BA%A2%E9%BB%91%E6%A0%91%EF%BC%89%EF%BC%9F"><span class="toc-text">é¢è¯•é¢˜ä¸ºä»€ä¹ˆ ZSet è¦ç”¨è·³è¡¨ï¼Œè€Œä¸æ˜¯å¹³è¡¡æ ‘ï¼ˆå¦‚ AVL æˆ–çº¢é»‘æ ‘ï¼‰ï¼Ÿ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Redis%E5%86%85%E5%AD%98%E5%9B%9E%E6%94%B6"><span class="toc-text">5.Rediså†…å­˜å›æ”¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E5%86%85%E5%AD%98%E8%BF%87%E6%9C%9F%E5%A4%84%E7%90%86"><span class="toc-text">5.1.å†…å­˜è¿‡æœŸå¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-1-%E8%BF%87%E6%9C%9F%E5%91%BD%E4%BB%A4"><span class="toc-text">5.1.1.è¿‡æœŸå‘½ä»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-2-%E8%BF%87%E6%9C%9F%E7%AD%96%E7%95%A5"><span class="toc-text">5.1.2.è¿‡æœŸç­–ç•¥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%9A"><span class="toc-text">é¢è¯•é¢˜ï¼š</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5"><span class="toc-text">5.2.å†…å­˜æ·˜æ±°ç­–ç•¥</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-1-Redis-%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E4%BC%9A%E8%A7%A6%E5%8F%91%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0%EF%BC%9F"><span class="toc-text">5.2.1.Redis ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘å†…å­˜æ·˜æ±°ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-2-%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5"><span class="toc-text">5.2.2.å†…å­˜æ·˜æ±°ç­–ç•¥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-3%E6%80%BB%E7%BB%93"><span class="toc-text">5.2.3æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3%E6%80%BB%E7%BB%93-Redis%E5%86%85%E5%AD%98%E5%9B%9E%E6%94%B6%E7%9A%84%E5%87%A0%E9%81%93%E9%9D%A2%E8%AF%95%E9%A2%98"><span class="toc-text">5.3æ€»ç»“ -Rediså†…å­˜å›æ”¶çš„å‡ é“é¢è¯•é¢˜</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E7%BC%93%E5%AD%98%E9%97%AE%E9%A2%98"><span class="toc-text">6.ç¼“å­˜é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7"><span class="toc-text">6.1.ç¼“å­˜ä¸€è‡´æ€§</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E7%9A%84%E9%80%9A%E7%94%A8%E6%A8%A1%E5%9E%8B"><span class="toc-text">ç¼“å­˜çš„é€šç”¨æ¨¡å‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E9%97%AE%E9%A2%98%EF%BC%9A%E6%9B%B4%E6%96%B0%E6%97%B6%E7%BC%93%E5%AD%98%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%93%8D%E4%BD%9C%E9%A1%BA%E5%BA%8F"><span class="toc-text">å…³é”®é—®é¢˜ï¼šæ›´æ–°æ—¶ç¼“å­˜å’Œæ•°æ®åº“çš„æ“ä½œé¡ºåº</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E6%80%BB%E7%BB%93"><span class="toc-text">æœ€ä½³å®è·µæ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F"><span class="toc-text">6.2.ç¼“å­˜ç©¿é€</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-1-%E7%BC%93%E5%AD%98%E7%A9%BA%E5%80%BC"><span class="toc-text">6.2.1.ç¼“å­˜ç©ºå€¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-text">6.2.2.å¸ƒéš†è¿‡æ»¤å™¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9"><span class="toc-text">6.3.ç¼“å­˜é›ªå´©</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF"><span class="toc-text">6.4.ç¼“å­˜å‡»ç©¿</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%B8%80%EF%BC%9A%E4%BA%92%E6%96%A5%E9%94%81%EF%BC%88%E5%8A%A0%E9%94%81%E9%98%B2%E6%AD%A2%E9%87%8D%E5%A4%8D%E6%9E%84%E5%BB%BA%EF%BC%89"><span class="toc-text">æ–¹æ¡ˆä¸€ï¼šäº’æ–¥é”ï¼ˆåŠ é”é˜²æ­¢é‡å¤æ„å»ºï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%BA%8C%EF%BC%9A%E9%80%BB%E8%BE%91%E8%BF%87%E6%9C%9F%EF%BC%88%E7%BC%93%E5%AD%98%E4%B8%AD%E4%BF%9D%E5%AD%98%E4%B8%80%E4%B8%AA%E8%BF%87%E6%9C%9F%E6%97%B6%E9%97%B4%EF%BC%89"><span class="toc-text">æ–¹æ¡ˆäºŒï¼šé€»è¾‘è¿‡æœŸï¼ˆç¼“å­˜ä¸­ä¿å­˜ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼‰</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-5-%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93-%E7%BC%93%E5%AD%98%E9%97%AE%E9%A2%98"><span class="toc-text">6.5.é¢è¯•æ€»ç»“ -ç¼“å­˜é—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-6%E4%B8%80%E5%BC%A0%E8%A1%A8%E6%90%9E%E6%87%82%E7%BC%93%E5%AD%98%E9%97%AE%E9%A2%98"><span class="toc-text">6.6ä¸€å¼ è¡¨ææ‡‚ç¼“å­˜é—®é¢˜</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E7%AF%87%E5%AE%8C%E7%BB%93%E6%92%92%E8%8A%B1"><span class="toc-text">é¢è¯•ç¯‡å®Œç»“æ’’èŠ±</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background-color: transparent;"><div id="footer-wrap"><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">æ ¼è¨€ğŸ§¬</p><div class="bg-ad"><div>å†çœ‹çœ‹é‚£ä¸ªå…‰ç‚¹ï¼Œå®ƒå°±åœ¨è¿™é‡Œï¼Œè¿™æ˜¯å®¶å›­ï¼Œè¿™æ˜¯æˆ‘ä»¬ â€”â€” ä½ æ‰€çˆ±çš„æ¯ä¸€ä¸ªäººï¼Œä½ è®¤è¯†çš„ä¸€ä¸ªäººï¼Œä½ å¬è¯´è¿‡çš„æ¯ä¸€ä¸ªäººï¼Œæ›¾ç»æœ‰è¿‡çš„æ¯ä¸€ä¸ªäººï¼Œéƒ½åœ¨å®ƒä¸Šé¢åº¦è¿‡ä»–ä»¬çš„ä¸€ç”Ÿâœ¨</div><div class="btn-xz-box"><a class="btn-xz" target="_blank" rel="noopener" href="https://stellarium.org/">ç‚¹å‡»å¼€å¯æ˜Ÿè¾°ä¹‹æ—…</a></div></div></div><div class="t-t-r"><p class="ft-t t-l-t">çŒœä½ æƒ³çœ‹ğŸ’¡</p><ul class="ft-links"><li><a href="/comments/">ç•™ç‚¹ä»€ä¹ˆ</a><a href="/archives/">æ–‡ç« å½’æ¡£</a></li><li><a href="/categories/">æ–‡ç« åˆ†ç±»</a><a href="/tags/">æ–‡ç« æ ‡ç­¾</a></li><li><a href="/box/Gallery/">æˆ‘çš„ç”»å»Š</a><a href="/personal/bb/">æˆ‘çš„å” å¨</a></li><li><a href="/site/time/">å»ºè®¾è¿›ç¨‹</a><a href="/site/census/">ç½‘ç«™ç»Ÿè®¡</a></li></ul></div></div></div><div class="ft-item-2"><p class="ft-t">æ¨èå‹é“¾âŒ›</p><div class="ft-img-group"><div class="img-group-item"></div></div></div></div><div class="copyright"><span><b>&copy;2022-2025</b></span><span><b>&nbsp;&nbsp;By geqian's BlogğŸ­</b></span></div><div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://icp.gov.moe/?keyword=20230913" style="margin-inline:5px" title="æœ¬ç«™å·²åŠ å…¥èŒICPè±ªåå¥—é¤ï¼ŒèŒICPå¤‡20230913å·"><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/20230913.svg" alt=""/></a></p></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><a class="icon-V hidden" onclick="switchNightMode()" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button><button class="share" type="button" title="å³é”®æ¨¡å¼" onclick="changeMouseMode()"><i class="fas fa-mouse"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog right_side"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button class="share" type="button" title="åˆ†äº«é“¾æ¥" onclick="share()"><i class="fas fa-share-nodes"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i><span id="percent">0<span>%</span></span></button><button id="go-down" type="button" title="ç›´è¾¾åº•éƒ¨" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();"><i class="fa fa-arrow-up"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa fa-copy"></i><span>å¤åˆ¶</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();"><i class="fa fa-search"></i><span>ç™¾åº¦æœç´¢</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();"><i class="fa fa-link"></i><span>è½¬åˆ°é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()"><i class="fa fa-copy"></i><span>ç²˜è´´</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="#post-comment"><i class="fas fa-comment"></i><span>ç©ºé™è¯„è®º</span></a><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()"><i class="fa fa-link"></i><span>å¤åˆ¶æœ¬æ–‡åœ°å€</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>æ–°çª—å£æ‰“å¼€</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()"><i class="fa fa-link"></i><span>è½¬åˆ°é“¾æ¥</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>å¤åˆ¶é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()"><i class="fa fa-download"></i><span>ä¿å­˜å›¾ç‰‡</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>åœ¨æ–°çª—å£æ‰“å¼€</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>å¤åˆ¶å›¾ç‰‡é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:randomPost()"><i class="fa fa-paper-plane"></i><span>éšä¾¿é€›é€›</span></a><a class="rightMenu-item" href="javascript:switchNightMode();"><i class="fa fa-moon"></i><span>æ˜¼å¤œåˆ‡æ¢</span></a><a class="rightMenu-item" href="/personal/about/"><i class="fa fa-info-circle"></i><span>å…³äºåšå®¢</span></a><a class="rightMenu-item" href="javascript:toggleWinbox();"><i class="fas fa-cog"></i><span>ç¾åŒ–è®¾ç½®</span></a><a class="rightMenu-item" href="javascript:rmf.fullScreen();"><i class="fas fa-expand"></i><span>åˆ‡æ¢å…¨å±</span></a><a class="rightMenu-item" href="javascript:window.print();"><i class="fa-solid fa-print"></i><span>æ‰“å°é¡µé¢</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><script async="async">var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())
setTimeout(function(){preloader.endLoading();}, 5000);
document.getElementById('loading-box').addEventListener('click',()=> {preloader.endLoading()})</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: '',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: '',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.staticfile.org/twikoo/1.6.8/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script async src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><script async src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script><script defer type="text/javascript" src="https://cdn1.tianli0.top/npm/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script defer src="https://cdn1.tianli0.top/gh/nextapps-de/winbox/dist/winbox.bundle.min.js"></script><script async src="//at.alicdn.com/t/c/font_3586335_hsivh70x0fm.js"></script><script async src="//at.alicdn.com/t/c/font_3636804_gr02jmjr3y9.js"></script><script async src="//at.alicdn.com/t/c/font_3612150_kfv55xn3u2g.js"></script><script async src="https://cdn.wpon.cn/2022-sucai/Gold-ingot.js"></script><canvas id="universe"></canvas><canvas id="snow"></canvas><script defer src="/js/fomal.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn1.tianli0.top/npm/js-heo@1.0.12/metingjs/Meting.min.js"></script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax","#bibi","body > title","#app","#tag-echarts","#posts-echart","#categories-echarts"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/å­¦ä¹ ç¬”è®°/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¡ geqianã®å­¦ä¹ ç¬”è®° (10)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/æ‚é¡¹/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¼ geqianã®æ‚é¡¹ (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/é¡¹ç›®/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ‰ geqianã®é¡¹ç›®ç¬”è®° (6)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/AI/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¨ geqianã®AIå¤§æ¨¡å‹ (6)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/ç®—æ³•/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸŸ geqianã®ç®—æ³•å­¦ä¹ ç¬”è®° (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/é¢è¯•/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¥ geqianã®é¢è¯• (18)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/JUC/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸŒ geqianã®JUC (4)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/JVM/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸœ geqianã®JVM (5)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/äº‘åŸç”Ÿ/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ” geqianã®äº‘åŸç”Ÿç›¸å…³ (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/MQ/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ“± geqianã®æ¶ˆæ¯é˜Ÿåˆ— (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/å‰ç«¯/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ›ï¸ geqianã®å‰ç«¯å·¥ç¨‹ (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/mybatis-mybatis-plus/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¨ geqianã®mybatisç³»åˆ— (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/å¾®æœåŠ¡/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ—ºï¸ geqianã®SpringCloudç³»åˆ— (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/SSM/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ“– geqianã®SSM+SpringBootç³»åˆ— (7)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/ruoyi/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ“ geqianã®è‹¥ä¾æ¡†æ¶ (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/mysql/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">â“ geqianã®mysql (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/Redis/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ’– geqianã®Redis (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item" style="visibility: hidden"></div><a class="magnet_link_more"  href="https://itgeqian.github.io/categories/" style="flex:1;text-align: center;margin-bottom: 10px;">æŸ¥çœ‹æ›´å¤š...</a></div></div>';
    console.log('å·²æŒ‚è½½magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(33.333333333333336% - 5px);background: #e9e9e9;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: var(--text-bg-hover)}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/60.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-09-30</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/60.html&quot;);" href="javascript:void(0);" alt="">é€Ÿé€šSpring AI Alibaba </a><div class="blog-slider__text">é€Ÿé€šSpring AI Alibaba å®Œç»“</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/60.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/37.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-04-02</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/37.html&quot;);" href="javascript:void(0);" alt="">GQ Videoå•æœåŠ¡ç‰ˆæœ¬è®°å½•</a><div class="blog-slider__text">GQ Videoå•æœåŠ¡ç‰ˆæœ¬è®°å½•ï¼ˆå®Œæ•´è®°å½•GQ Videoä»0åˆ°1çš„å…¨è®°å½•ï¼‰</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/37.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/1.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-05-20</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/1.html&quot;);" href="javascript:void(0);" alt="">å®éªŒä¸‰ æ±½è½¦ç§Ÿèµç³»ç»Ÿçš„UMLè®¾è®¡å»ºæ¨¡ ï¼ˆå®Œç»“ï¼‰</a><div class="blog-slider__text">å…³äºæ±½è½¦ç§Ÿèµç³»ç»Ÿçš„UMLè®¾è®¡å»ºæ¨¡</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/1.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/74.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-09-06</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/74.html&quot;);" href="javascript:void(0);" alt="">Mysqlç›¸å…³é¢è¯•é¢˜</a><div class="blog-slider__text">æˆ‘å¯¹mysqlçš„ç›¸å…³ç†è§£</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/74.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/77.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-10-07</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/77.html&quot;);" href="javascript:void(0);" alt="">javase+é›†åˆç›¸å…³é¢è¯•é¢˜</a><div class="blog-slider__text">æˆ‘å¯¹javaåŸºç¡€å’Œé›†åˆç±»çš„ç›¸å…³ç†è§£</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/77.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/68.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/wallhaven-o59q2m.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-10-01</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/68.html&quot;);" href="javascript:void(0);" alt="">JUCé¢è¯•é¢˜</a><div class="blog-slider__text">æˆ‘å¯¹JUCçš„ç†è§£</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/68.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('å·²æŒ‚è½½butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper@1.0.12/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper@1.0.12/lib/swiper_init.js"></script><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementById('gitZone');
      var item_html = '<div class="recent-post-item" id="gitcalendarBar" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 320px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('å·²æŒ‚è½½gitcalendar')
      }

    if( document.getElementById('gitZone') && (location.pathname ==='/site/census/'|| '/site/census/' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("/api?null",['#d9e0df', '#c6e0dc', '#a8dcd4', '#9adcd2', '#89ded1', '#77e0d0', '#5fdecb', '#47dcc6', '#39dcc3', '#1fdabe', '#00dab9'],'null')
    }
  </script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>