<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><div id="myscoll"></div><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>JVM面试篇 | geqian's Blog🍭</title><meta name="keywords" content="JVM"><meta name="author" content="geqian's Blog🍭"><meta name="copyright" content="geqian's Blog🍭"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="黑马程序员JVM-面试篇（精选18道高频面试题）">
<meta property="og:type" content="article">
<meta property="og:title" content="JVM面试篇">
<meta property="og:url" content="https://itgeqian.github.io/posts/26.html">
<meta property="og:site_name" content="geqian&#39;s Blog🍭">
<meta property="og:description" content="黑马程序员JVM-面试篇（精选18道高频面试题）">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/53.jpg">
<meta property="article:published_time" content="2025-07-29T02:19:03.000Z">
<meta property="article:modified_time" content="2025-07-30T15:42:00.000Z">
<meta property="article:author" content="geqian&#39;s Blog🍭">
<meta property="article:tag" content="JVM">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/53.jpg"><link rel="shortcut icon" href="/"><link rel="canonical" href="https://itgeqian.github.io/posts/26"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.js',
      css: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'JVM面试篇',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-07-30 23:42:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><style id="themeColor"></style><style id="rightSide"></style><style id="transPercent"></style><style id="blurNum"></style><style id="settingStyle"></style><span id="fps"></span><style id="defineBg"></style><style id="menu_shadow"></style><script src="https://cdn.jsdelivr.net/npm/echarts@6/dist/echarts.min.js"></script><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper@1.0.12/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper@1.0.12/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="geqian's Blog🍭" type="application/atom+xml">
</head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/assets/avatar.png" onerror="onerror=null;src='/assets/r1.jpg'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">83</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">51</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">18</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> 首页</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--article"></use></svg><span class="menu_word" style="font-size:17px"> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei">                   </use></svg><span class="menu_word" style="font-size:17px"> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pinweishenghuo"></use></svg><span class="menu_word" style="font-size:17px"> 休闲</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/life/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-yinle">                   </use></svg><span class="menu_word" style="font-size:17px"> 八音盒</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-dianying1">                   </use></svg><span class="menu_word" style="font-size:17px"> 影院</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-youxishoubing">                   </use></svg><span class="menu_word" style="font-size:17px"> 游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xiangzi"></use></svg><span class="menu_word" style="font-size:17px"> 八宝箱</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/box/gallery/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-tubiaozhizuomoban">                   </use></svg><span class="menu_word" style="font-size:17px"> 画廊</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/animation/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-nvwumao">                   </use></svg><span class="menu_word" style="font-size:17px"> 动画</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-zhifengche">                   </use></svg><span class="menu_word" style="font-size:17px"> 网址导航</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> 社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pengyouquan">                   </use></svg><span class="menu_word" style="font-size:17px"> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangye"></use></svg><span class="menu_word" style="font-size:17px"> 网站</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/site/census/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--tongjibiao">                   </use></svg><span class="menu_word" style="font-size:17px"> 网站统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujutongji1">                   </use></svg><span class="menu_word" style="font-size:17px"> 文章统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/time/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xianxingshalou">                   </use></svg><span class="menu_word" style="font-size:17px"> 旧时光</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">geqian's Blog🍭</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> 首页</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--article"></use></svg><span class="menu_word" style="font-size:17px"> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei">                   </use></svg><span class="menu_word" style="font-size:17px"> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pinweishenghuo"></use></svg><span class="menu_word" style="font-size:17px"> 休闲</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/life/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-yinle">                   </use></svg><span class="menu_word" style="font-size:17px"> 八音盒</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-dianying1">                   </use></svg><span class="menu_word" style="font-size:17px"> 影院</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-youxishoubing">                   </use></svg><span class="menu_word" style="font-size:17px"> 游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xiangzi"></use></svg><span class="menu_word" style="font-size:17px"> 八宝箱</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/box/gallery/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-tubiaozhizuomoban">                   </use></svg><span class="menu_word" style="font-size:17px"> 画廊</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/animation/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-nvwumao">                   </use></svg><span class="menu_word" style="font-size:17px"> 动画</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-zhifengche">                   </use></svg><span class="menu_word" style="font-size:17px"> 网址导航</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> 社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pengyouquan">                   </use></svg><span class="menu_word" style="font-size:17px"> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangye"></use></svg><span class="menu_word" style="font-size:17px"> 网站</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/site/census/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--tongjibiao">                   </use></svg><span class="menu_word" style="font-size:17px"> 网站统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujutongji1">                   </use></svg><span class="menu_word" style="font-size:17px"> 文章统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/time/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xianxingshalou">                   </use></svg><span class="menu_word" style="font-size:17px"> 旧时光</span></a></li></ul></div></div><center id="name-container"><a id="page-name" href="javascript:scrollToTop()">PAGE_NAME</a></center><div id="nav-right"><div id="search-button"><a class="search faa-parent animated-hover" title="检索站内任何你想要的信息"><svg class="faa-tada icon" style="height:24px;width:24px;fill:currentColor;position:relative;top:6px" aria-hidden="true"><use xlink:href="#icon-valentine_-search-love-find-heart"></use></svg><span> 搜索</span></a></div><a class="meihua faa-parent animated-hover" onclick="toggleWinbox()" title="美化设置-自定义你的风格" id="meihua-button"><svg class="faa-tada icon" style="height:26px;width:26px;fill:currentColor;position:relative;top:8px" aria-hidden="true"><use xlink:href="#icon-tupian1"></use></svg></a><a class="sun_moon faa-parent animated-hover" onclick="switchNightMode()" title="浅色和深色模式转换" id="nightmode-button"><svg class="faa-tada" style="height:25px;width:25px;fill:currentColor;position:relative;top:7px" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon">       </use></svg></a><div id="toggle-menu"><a><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-info"><h1 class="post-title">JVM面试篇</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><svg class="meta_icon post-meta-icon" style="width:30px;height:30px;position:relative;top:10px"><use xlink:href="#icon-rili"></use></svg><span class="post-meta-label">发表于 </span><time class="post-meta-date-created" datetime="2025-07-29T02:19:03.000Z" title="发表于 2025-07-29 10:19:03">2025-07-29</time><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-gengxin1"></use></svg><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-07-30T15:42:00.000Z" title="更新于 2025-07-30 23:42:00">2025-07-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-biaoqian"></use></svg><a class="post-meta-categories" href="/categories/JVM/">JVM</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:8px"><use xlink:href="#icon-charuword"></use></svg><span class="post-meta-label">字数总计:</span><span class="word-count">2w</span><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:20px;height:20px;position:relative;top:5px"><use xlink:href="#icon-shizhong"></use></svg><span class="post-meta-label">阅读时长:</span><span>66分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="JVM面试篇"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:5px"><use xlink:href="#icon-eye"></use></svg><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="面试篇">面试篇</h1>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/whiteboard_exported_image-684x1024.png" alt="img"></p>
<h2 id="1-什么是JVM？">1.什么是JVM？</h2>
<ul>
<li>关联课程内容
<ul>
<li>基础篇-初识JVM</li>
<li>基础篇-Java虚拟机的组成</li>
</ul>
</li>
</ul>
<p>回答路径</p>
<ul>
<li>组成</li>
<li>JVM的定义</li>
<li>作用</li>
<li>功能</li>
</ul>
<h3 id="1、定义：">1、定义：</h3>
<p>JVM 指的是Java虚拟机（ Java Virtual Machine ）。JVM 本质上是一个运行在计算机上的程序，他的职责是运行Java字节码文件，Java虚拟机上可以运行Java、Kotlin、Scala、Groovy等语言。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1060.png" alt="img"></p>
<p>通过<code>jps</code>命令也可以看到java进程，<code>jps</code>是JDK自带的一共显示Java进程的小工具：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1062.png" alt="img"></p>
<p>只要能编译成Java字节码文件的语言，Java虚拟机都可以运行。下图是Groovy语言在Java虚拟机上成功运行的结果：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1063.png" alt="img"></p>
<h3 id="2、作用：">2、作用：</h3>
<p>为了支持Java中Write Once，Run Anywhere；<strong>编写一次，到处运行</strong>的跨平台特性。</p>
<p>对于C/C++这类语言来说，需要将源代码编译成对应平台（不同的操作系统+CPU架构)的机器码，才能让计算机运行。不满足一次编译，到处运行的跨平台特性。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1064-1024x357.png" alt="img"></p>
<p>但是Java语言不同，Java语言将源代码编译成字节码文件之后，就可以交由不同平台下已经安装好的Java虚拟机。Java虚拟机会将字节码指令实时解释成机器码。这样就满足了一次编译（编译成字节码），到处运行的跨平台特性。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1065-1024x390.png" alt="img"></p>
<h3 id="3、功能">3、功能</h3>
<ul>
<li>解释和运行，对字节码文件中的指令，实时的解释成机器码，让计算机执行。</li>
<li>内存管理，自动为对象、方法等分配内存，自动的垃圾回收机制，回收不再使用的对象。</li>
<li>即时编译，对热点代码进行优化，提升执行效率。</li>
</ul>
<p>执行以下代码：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">package q1jvm;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-Xint 禁止JIT即时编译器优化</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">C03Usage</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] <span class="keyword">args</span></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">long</span> start = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        C03Usage test = <span class="keyword">new</span> C03Usage();</span><br><span class="line">        test.jitTest();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">long</span> end = System.currentTimeMillis();</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;执行耗时:&quot;</span> + (end - start) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">add</span> (<span class="params"><span class="built_in">int</span> a,<span class="built_in">int</span> b</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">jitTest</span>()</span>&#123;</span><br><span class="line">        <span class="built_in">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000000</span>; i++) &#123;</span><br><span class="line">            sum = <span class="keyword">add</span>(sum,<span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>加上JIT即时编译优化之后，代码执行只需要3ms。但是如果加上<code>-Xint</code>参数关闭即时编译器优化，执行时间需要233ms。</p>
<h3 id="4、组成">4、组成</h3>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1066-1024x421.png" alt="img"></p>
<ul>
<li>编译器：不属于Java虚拟机的一部分，负责将源代码文件编译成字节码文件。</li>
<li>类加载子系统，负责将字节码文件读取、解析并保存到内存中。其核心就是类加载器。</li>
<li>运行时数据区，管理JVM使用到的内存。</li>
<li>执行引用，分为解释器 解释执行字节码指令；即时编译器 优化代码执行性能； 垃圾回收器 将不再使用的对象进行回收。</li>
<li>本地接口，保存了本地已经编译好的方法，使用C/C++语言实现。</li>
</ul>
<h3 id="5、常见的JVM">5、常见的JVM</h3>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1067-1024x394.png" alt="img"></p>
<h3 id="总结">总结</h3>
<p>1、JVM 指的是Java虚拟机，本质上是一个运行在计算机上的程序，他的职责是运行Java字节码文件，作用是为了支持跨平台特性。</p>
<p>2、JVM的功能有三项：第一是解释执行字节码指令；第二是管理内存中对象的分配，完成自动的垃圾回收；第三是优化热点代码提升执行效率。</p>
<p>3、JVM组成分为类加载子系统、运行时数据区、执行引擎、本地接口这四部分。</p>
<p>4、常用的JVM是Oracle提供的Hotspot虚拟机，也可以选择GraalVM、龙井、OpenJ9等虚拟机。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1068.png" alt="img"></p>
<h2 id="2-了解过字节码文件的组成吗？">2.了解过字节码文件的组成吗？</h2>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1073.png" alt="img"></p>
<ul>
<li>
<p>关联课程内容</p>
<ul>
<li>基础篇-字节码文件的组成</li>
<li>基础篇-字节码文件的工具</li>
</ul>
</li>
<li>
<p>回答路径</p>
<ul>
<li>查看字节码文件常用工具</li>
<li>字节码文件的组成</li>
<li>应用场景：工作中一般不直接查看字节码文件，深入学习JVM的基础</li>
</ul>
</li>
</ul>
<p>字节码文件本质上是一个二进制的文件，无法直接用记事本等工具打开阅读其内容。需要通过专业的工具打开。</p>
<ul>
<li>服务器环境使用javap –v命令</li>
<li>开发环境使用jclasslib插件</li>
</ul>
<h3 id="1、基本信息">1、基本信息</h3>
<p>魔数、字节码文件对应的Java版本号、访问标识(public final等等)、父类和接口。</p>
<p>类代码:</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> q2class;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> <span class="keyword">extends</span> <span class="title">MyParent</span> <span class="keyword">implements</span> <span class="title">MyInterface</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">        j++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> MyClass();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>父类代码:</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> q2class;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyParent</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接口代码:</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> q2class;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyInterface</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译之后用notepad++打开：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1069-1024x283.png" alt="img"></p>
<p>魔数前四个字节是固定的内容0xcafebabe，只有前四个字节满足这个内容才是字节码文件。</p>
<p>使用jclasslib查看到基本信息：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1070.png" alt="img"></p>
<p>如果在服务器上，可以通过<code>javap -v</code>命令打开字节码文件查看内容：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1071.png" alt="img"></p>
<p>结果：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1072.png" alt="img"></p>
<h3 id="2、常量池">2、常量池</h3>
<p>保存了字符串常量、类或接口名、字段名，主要在字节码指令中使用。</p>
<p>常量池是一个数组，比如这个序号为10的常量就是一个UTF8的字符串。保存了MyClass的全限定名。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1074.png" alt="img"></p>
<h3 id="3、字段">3、字段</h3>
<p>当前类或接口声明的字段信息</p>
<p>字段里保存的是名字、描述符（字段类型）、访问标识。其中名字和描述符都指向常量池中的内容。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1075.png" alt="img"></p>
<h3 id="4、方法">4、方法</h3>
<p>当前类或接口声明的方法信息、字节码指令。</p>
<p>方法中保存了方法名、描述符（参数和返回值）、访问标识。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1077.png" alt="img"></p>
<p>还有字节码指令，代码编译后就变成了字节码指令：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1078.png" alt="img"></p>
<h3 id="5、属性">5、属性</h3>
<p>类的属性，比如源码的文件名、内部类的列表等。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1079.png" alt="img"></p>
<h3 id="总结：">总结：</h3>
<p>“嗯，这块我了解过一些。Java 源码编译后会生成 <code>.class</code> 字节码文件，它其实就是一段 JVM 能识别的二进制格式。我平时会用像 <code>javap -v</code> 或者 IDEA 的 <code>jclasslib</code> 插件来查看里面的结构。</p>
<p>一般来说，字节码文件主要有几个组成部分：</p>
<ul>
<li>首先基本信息区里面包含了开头的魔数（就是 <code>CAFEBABE</code>），还有 Java 的版本号、访问标识、分类和接口等；</li>
<li>然后是一个<strong>常量池</strong>，里面存着类名、方法名、字符串这些信息，相当于一个符号表；</li>
<li>后面就是字段表和方法表，分别对应我们类里的成员变量和方法；</li>
<li>最后还有一些属性表，比如记录源码文件名、调试信息、注解这些内容。</li>
</ul>
<p>像我们平时说的方法调用、字段访问，其实在 JVM 层面就是通过这些结构来解析和执行的。</p>
<p>我觉得了解这些字节码结构，虽然日常用得不多，但能帮助我更清楚底层怎么运作，特别是在调优或者看一些反编译工具输出时很有用。”</p>
<h2 id="3-说一下运行时数据区">3.说一下运行时数据区</h2>
<ul>
<li>关联课程内容
<ul>
<li>基础篇-程序计数器</li>
<li>基础篇-栈</li>
<li>基础篇-堆</li>
<li>基础篇-方法区</li>
<li>基础篇-直接内存</li>
</ul>
</li>
</ul>
<p>回答路径</p>
<ul>
<li>方法区</li>
<li>程序计数器</li>
<li>栈</li>
<li>堆</li>
</ul>
<p>直接内存（可选）</p>
<p>运行时数据区指的是JVM所管理的内存区域，其中分成两大类：</p>
<p>线程共享 – 方法区、堆 线程不共享 – 本地方法栈、虚拟机栈、程序计数器</p>
<p>直接内存主要是NIO使用，由操作系统直接管理，不属于JVM内存。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1081-1024x378.png" alt="img"></p>
<h3 id="程序计数器">程序计数器</h3>
<p>程序计数器（Program Counter Register）也叫PC寄存器，每个线程会通过程序计数器记录当前要执行的的字节码指令的地址。主要有两个作用：</p>
<p>1、程序计数器可以控制程序指令的进行，实现分支、跳转、异常等逻辑。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1083.png" alt="img"></p>
<p>2、在多线程执行情况下，Java虚拟机需要通过程序计数器记录CPU切换前解释执行到那一句指令并继续解释运行。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1084.png" alt="img"></p>
<h3 id="栈-Java虚拟机栈">栈 - Java虚拟机栈</h3>
<p>Java虚拟机栈采用栈的数据结构来管理方法调用中的基本数据，先进后出 ,每一个方法的调用使用一个栈帧来保存。每个线程都会包含一个自己的虚拟机栈，它的生命周期和线程相同。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1085.png" alt="img"></p>
<p>栈帧主要包含三部分内容：</p>
<p>1、局部变量表，在方法执行过程中存放所有的局部变量。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1086-1024x317.png" alt="img"></p>
<p>2、操作数栈，虚拟机在执行指令过程中用来存放临时数据的一块区域。</p>
<p>如下图中，iadd指令会将操作数栈上的两个数相加，为了实现<code>i+1</code>。最终结果也会放到操作数上。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1087-1024x402.png" alt="img"></p>
<p>3、帧数据，主要包含动态链接、方法出口、异常表等内容。</p>
<p>动态链接：方法中要用到其他类的属性和方法，这些内容在字节码文件中是以编号保存的，运行过程中需要替换成内存中的地址，这个编号到内存地址的映射关系就保存在动态链接中。</p>
<p>方法出口：方法调用完需要弹出栈帧，回到上一个方法，程序计数器要切换到上一个方法的地址继续执行，方法出口保存的就是这个地址。</p>
<p>异常表：存放的是代码中异常的处理信息，包含了异常捕获的生效范围以及异常发生后跳转到的字节码指令位置。</p>
<h3 id="本地方法栈">本地方法栈</h3>
<p>Java虚拟机栈存储了Java方法调用时的栈帧，而本地方法栈存储的是native本地方法的栈帧。</p>
<p>在Hotspot虚拟机中，Java虚拟机栈和本地方法栈实现上使用了同一个栈空间。本地方法栈会在栈内存上生成一个栈帧，临时保存方法的参数同时方便出现异常时也把本地方法的栈信息打印出来。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1088.png" alt="img"></p>
<h3 id="堆">堆</h3>
<ul>
<li>一般Java程序中堆内存是空间最大的一块内存区域。创建出来的对象都存在于堆上。</li>
<li>栈上的局部变量表中，可以存放堆上对象的引用。静态变量也可以存放堆对象的引用，通过静态变量就可以实现对象在线程之间共享。</li>
<li>堆是垃圾回收最主要的部分，堆结构更详细的划分与垃圾回收器有关。</li>
</ul>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1089-1024x298.png" alt="img"></p>
<h3 id="方法区">方法区</h3>
<p>方法区是Java虚拟机规范中提出来的一个虚拟机概念，在HotSpot不同版本中会用永久代或者元空间来实现。方法区主要存放的是基础信息，包含：</p>
<p>1、每一个加载的类的元信息（基础信息）。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1090.png" alt="img"></p>
<p>2、运行时常量池，保存了字节码文件中的常量池内容，避免常量内容重复创建减少内存开销。</p>
<p>3、字符串常量池，存储字符串的常量。</p>
<h3 id="直接内存">直接内存</h3>
<p>直接内存并不在《Java虚拟机规范》中存在，所以并不属于Java运行时的内存区域。在 JDK 1.4 中引入了 NIO 机制，由操作系统直接管理这部分内容，主要为了提升读写数据的性能。在网络编程框架如Netty中被大量使用。(Netty使用了Reactor模型，主线程去负责链接，然后分发子任务给Reactor子线程)</p>
<p>要创建直接内存上的数据，可以使用ByteBuffer。</p>
<p>语法： ByteBuffer directBuffer = ByteBuffer.allocateDirect(size);</p>
<h3 id="总结-2">总结</h3>
<p>运行时数据区指的是JVM所管理的内存区域，其中分成两大类：</p>
<ul>
<li>线程共享 方法区、堆</li>
</ul>
<p>方法区：存放每一个加载的类的元信息、运行时常量池、字符串常量池。</p>
<p>堆：存放创建出来的对象。</p>
<ul>
<li>线程不共享 – 本地方法栈、虚拟机栈、程序计数器</li>
</ul>
<p>本地方法栈和虚拟机栈都存放了线程中执行方法时需要使用的基础数据。</p>
<p>程序计数器存放了当前线程执行的字节码指令在内存中的地址。</p>
<p>直接内存主要是NIO使用，由操作系统直接管理，不属于JVM内存。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1091.png" alt="img"></p>
<h2 id="4-哪些区域会出现内存溢出，会有什么现象？">4.哪些区域会出现内存溢出，会有什么现象？</h2>
<p>内存溢出指的是内存中某一块区域的使用量超过了允许使用的最大值，从而使用内存时因空间不足而失败，虚拟机一般会抛出指定的错误。</p>
<p>在Java虚拟机中，只有程序计数器不会出现内存溢出的情况，因为每个线程的程序计数器只保存一个固定长度的地址。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1092-1024x372.png" alt="img"></p>
<h3 id="堆内存溢出：">堆内存溢出：</h3>
<p>堆内存溢出指的是在堆上分配的对象空间超过了堆的最大大小，从而导致的内存溢出。堆的最大大小使用-Xmx参数进行设置，如-Xmx10m代表最大堆内存大小为10m。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> q1oom;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-Xmx10m</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeapOOM</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        ArrayList&lt;Object&gt; objects = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Object&gt;();</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            objects.add(<span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span> * <span class="number">1024</span> * <span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>溢出之后会抛出OutOfMemoryError，并提示是Java heap Space导致的：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1093-1024x98.png" alt="img"></p>
<h3 id="栈内存溢出：">栈内存溢出：</h3>
<p>栈内存溢出指的是所有栈帧空间的占用内存超过了最大值，最大值使用-Xss进行设置，比如-Xss256k代表所有栈帧占用内存大小加起来不能超过256k。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package q1oom;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * -Xss180k 每个线程栈内存最大180k</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">StackOOM</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] <span class="keyword">args</span></span>)</span> &#123;</span><br><span class="line">        recursion();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//递归方法调用自己</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">recursion</span>()</span> &#123;</span><br><span class="line">        <span class="built_in">long</span> a,b,c,d,f,g,h,i,j,k;</span><br><span class="line">        System.<span class="keyword">out</span>.println(++count);</span><br><span class="line">        recursion();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>溢出之后会抛出StackOverflowError：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1094.png" alt="img"></p>
<h3 id="方法区内存溢出：">方法区内存溢出：</h3>
<p>方法区内存溢出指的是方法区中存放的内容比如类的元信息超过了方法区内存的最大值，JDK7及之前版本方法区使用永久代（-XX:MaxPermSize=值）来实现，JDK8及之后使用元空间（-XX:MaxMetaspaceSize=值）来实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> q1oom;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.bytebuddy.jar.asm.ClassWriter;</span><br><span class="line"><span class="keyword">import</span> net.bytebuddy.jar.asm.Opcodes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JDK8 -XX:MaxMetaspaceSize=20m JDK7 -XX:MaxPermSize=20m</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodAreaOOM</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">MethodAreaOOM</span> <span class="variable">demo1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MethodAreaOOM</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;Class&quot;</span> + count;</span><br><span class="line">            <span class="type">ClassWriter</span> <span class="variable">classWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassWriter</span>(<span class="number">0</span>);</span><br><span class="line">            classWriter.visit(Opcodes.V1_7, Opcodes.ACC_PUBLIC, name, <span class="literal">null</span></span><br><span class="line">                    , <span class="string">&quot;java/lang/Object&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">            <span class="type">byte</span>[] bytes = classWriter.toByteArray();</span><br><span class="line">            demo1.defineClass(name, bytes, <span class="number">0</span>, bytes.length);</span><br><span class="line">            System.out.println(++count);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>元空间溢出：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1095.png" alt="img"></p>
<p>永久代溢出：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1096-1024x158.png" alt="img"></p>
<h3 id="直接内存溢出：">直接内存溢出：</h3>
<p>直接内存溢出指的是申请的直接内存空间大小超过了最大值，使用 -XX:MaxDirectMemorySize=值 设置最大值。</p>
<p>溢出之后会抛出OutOfMemoryError：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> q1oom;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * -XX:MaxDirectMemorySize=50m</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DirectOOM</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">100</span>; <span class="comment">//100mb</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;ByteBuffer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;ByteBuffer&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="type">ByteBuffer</span> <span class="variable">directBuffer</span> <span class="operator">=</span> ByteBuffer.allocateDirect(size);</span><br><span class="line">            list.add(directBuffer);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>溢出之后出现：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1097-1024x174.png" alt="img"></p>
<h3 id="总结：-2">总结：</h3>
<p>内存溢出指的是内存中某一块区域的使用量超过了允许使用的最大值，从而使用内存时因空间不足而失败，虚拟机一般会抛出指定的错误。</p>
<p>堆：溢出之后会抛出OutOfMemoryError，并提示是Java heap Space导致的。</p>
<p>栈：溢出之后会抛出StackOverflowError。</p>
<p>方法区：溢出之后会抛出OutOfMemoryError，JDK7及之前提示永久代，JDK8及之后提示元空间。</p>
<p>直接内存：溢出之后会抛出OutOfMemoryError。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1098.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1099.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1100.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1101.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1102.png" alt="img"></p>
<h2 id="5-JVM在JDK6-8之间在内存区域上有什么不同">5.JVM在JDK6-8之间在内存区域上有什么不同</h2>
<h3 id="方法区的实现">方法区的实现</h3>
<p>方法区是《Java虚拟机规范》中设计的虚拟概念，每款Java虚拟机在实现上都各不相同。Hotspot设计如下：</p>
<p>JDK8及之后的版本将方法区存放在元空间中，元空间位于操作系统维护的直接内存中，默认情况下只要不超过操作系统承受的上限，可以一直分配。也可以手动设置最大大小。</p>
<p>JDK7及之前的版本将方法区存放在堆区域中的永久代空间，堆的大小由虚拟机参数来控制。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1103-1024x271.png" alt="img"></p>
<p>使用元空间替换永久代的原因：</p>
<p>1、提高内存上限：元空间使用的是操作系统内存，而不是JVM内存。如果不设置上限，只要不超过操作系统内存上限，就可以持续分配。而永久代在堆中，可使用的内存上限是有限的。所以使用元空间可以有效减少OOM情况的出现。</p>
<p>2、优化垃圾回收的策略：永久代在堆上，垃圾回收机制一般使用老年代的垃圾回收方式，不够灵活。使用元空间之后单独设计了一套适合方法区的垃圾回收机制。</p>
<h3 id="字符串常量池的位置">字符串常量池的位置</h3>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1104-1024x457.png" alt="img"></p>
<p>字符串常量池从方法区移动到堆的原因：</p>
<p>1、垃圾回收优化：字符串常量池的回收逻辑和对象的回收逻辑类似，内存不足的情况下，如果字符串常量池中的常量不被使用就可以被回收；方法区中的类的元信息回收逻辑更复杂一些。移动到堆之后，就可以利用对象的垃圾回收器，对字符串常量池进行回收。</p>
<p>2、让方法区大小更可控：一般在项目中，类的元信息不会占用特别大的空间，所以会给方法区设置一个比较小的上限。如果字符串常量池在方法区中，会让方法区的空间大小变得不可控。</p>
<p>3、intern方法的优化：JDK6版本中intern () 方法会把第一次遇到的字符串实例复制到永久代的字符串常量池中。JDK7及之后版本中由于字符串常量池在堆上，就可以进行优化：字符串保存在堆上，把字符串的引用放入字符串常量池，减少了复制的操作。</p>
<h3 id="总结-3">总结</h3>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1105-1024x436.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1106-1024x437.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1107-1024x429.png" alt="img"></p>
<p>嗯，我有了解过这个问题。主要变化集中在两个方面：<strong>方法区</strong> 和 <strong>字符串常量池</strong>。</p>
<p>首先是 <strong>方法区</strong>。在 JDK6 和 JDK7 中，方法区是通过一个叫 <strong>永久代（PermGen）</strong> 的结构实现的。它其实就是 JVM 堆中的一块区域，用来存储类的元信息、静态变量、常量池等。但是永久代有个问题就是大小不太好调整，如果类多了，容易出现内存溢出。</p>
<p>从 <strong>JDK8开始，永久代就被废弃了</strong>，取而代之的是 <strong>元空间（Metaspace）</strong>。这个元空间不再是JVM内存的一部分，而是用 <strong>操作系统的本地内存</strong>，所以理论上只要系统还有内存就可以一直分配，能有效减少OOM问题。更重要的是，元空间设计了一套专门的垃圾回收策略，比以前更灵活。</p>
<p>然后是 <strong>字符串常量池</strong>，也发生了位置上的调整。JDK6 及以前，这个池子也在方法区，也就是永久代里。但是在 JDK7 之后，它被移到了 <strong>堆内存</strong>中。好处是显而易见的，首先垃圾回收变得更统一了，能一起清理；其次也避免了字符串池撑爆方法区导致内存溢出的问题。</p>
<p>最后还有个变化是 JDK7 对 <code>intern()</code> 方法也做了优化，不再复制字符串对象，而是直接存引用，也减少了内存浪费。</p>
<p>总的来说，<strong>JDK8相比之前版本对内存结构做了简化和优化</strong>，让内存使用更加灵活、垃圾回收效率更高，也更容易进行性能调优。</p>
<h2 id="6-类的生命周期">6.类的生命周期</h2>
<ul>
<li>
<p>关联课程内容</p>
<ul>
<li>基础篇-类的生命周期-加载阶段</li>
<li>基础篇-类的生命周期-连接阶段</li>
<li>基础篇-类的生命周期-初始化阶段</li>
<li>基础篇-方法区的回收</li>
</ul>
</li>
<li>
<p>回答路径</p>
<ul>
<li>加载</li>
<li>连接（验证、准备、解析）</li>
<li>初始化</li>
<li>卸载</li>
</ul>
</li>
</ul>
<p>类的生命周期分为以下几个阶段：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1108-1024x432.png" alt="img"></p>
<h3 id="加载阶段">加载阶段</h3>
<p>1、加载(Loading)阶段第一步是类加载器根据类的全限定名通过不同的渠道以二进制流的方式获取字节码信息。</p>
<p>程序员可以使用Java代码拓展的不同的渠道。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1109-1024x408.png" alt="img"></p>
<p>2、类加载器在加载完类之后，Java虚拟机会将字节码中的信息保存到内存的方法区中。在方法区生成一个InstanceKlass对象，保存类的所有信息。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1110.png" alt="img"></p>
<p>3、在堆中生成一份与方法区中数据类似的java.lang.Class对象， 作用是在Java代码中去获取类的信息。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1111.png" alt="img"></p>
<p>比如这段代码中，就会访问堆中的Class对象：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1112.png" alt="img"></p>
<h3 id="连接阶段">连接阶段</h3>
<p>连接阶段分为三个小阶段：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1113.png" alt="img"></p>
<p>连接（Linking）阶段的第一个环节是<strong>验证</strong>，验证的主要目的是检测Java字节码文件是否遵守了《Java虚拟机规范》中的约束。这个阶段一般不需要程序员参与。</p>
<p>主要包含如下四部分，具体详见《Java虚拟机规范》：</p>
<p>1.文件格式验证，比如文件是否以0xCAFEBABE开头，主次版本号是否满足当前Java虚拟机版本要求。</p>
<p>2.元信息验证，例如类必须有父类（super不能为空）。</p>
<p>3.验证程序执行指令的语义，比如方法内的指令执行到一半强行跳转到其他方法中去。</p>
<p>4.符号引用验证，例如是否访问了其他类中private的方法等。</p>
<p><strong>准备阶段</strong>为静态变量（static）分配内存并设置初值。final修饰的基本数据类型的静态变量，准备阶段直接会将代码中的值进行赋值。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1114-1024x321.png" alt="img"></p>
<p><strong>解析阶段</strong>主要是将常量池中的符号引用替换为直接引用。符号引用就是在字节码文件中使用编号来访问常量池中的内容。直接引用不在使用编号，而是使用内存中地址进行访问具体的数据。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1115-1024x345.png" alt="img"></p>
<h3 id="初始化阶段">初始化阶段</h3>
<p>初始化阶段会执行静态代码块中的代码，并为静态变量赋值。</p>
<p>初始化阶段会执行字节码文件中clinit部分的字节码指令。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1116-1024x350.png" alt="img"></p>
<p>以如下代码为例：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package q3loadclass;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Demo1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="keyword">value</span> = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">value</span> = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">value</span> = <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] <span class="keyword">args</span></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> Demo1();</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="keyword">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1.连接的准备阶段value赋初值为0</p>
<p>2.初始化阶段执行clinit方法中的指令,value赋值为2</p>
<p>3.如果创建对象，会执行对象的init方法，value赋值为3 （类中代码块中的内容被放到了构造方法中）</p>
<h3 id="卸载阶段">卸载阶段</h3>
<p>判定一个类可以被卸载。需要同时满足下面三个条件：</p>
<p>1、此类所有实例对象都已经被回收，在堆中不存在任何该类的实例对象以及子类对象。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1117.png" alt="img"></p>
<p>2、加载该类的类加载器已经被回收。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1118.png" alt="img"></p>
<p>3、该类对应的 java.lang.Class 对象没有在任何地方被引用。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1119.png" alt="img"></p>
<p>总结</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1120-1024x515.png" alt="img"></p>
<p>“你了解类的生命周期吗？&quot;</p>
<p>当然了解一点，Java 里的类从被加载到被卸载，其实是有一套生命周期的，大致分为五个阶段：<strong>加载、验证、准备、解析、初始化</strong>，这四个属于类被使用前的阶段，之后就是使用阶段，最后还有一个是<strong>卸载</strong>。</p>
<p>首先是 <strong>加载</strong>，这一步是由类加载器来完成的，它会根据类的全限定名把字节码文件读取进来，然后在方法区里创建一个结构化的对象来保存类的相关信息。</p>
<p>接下来是 <strong>连接</strong>，连接又细分成三个小阶段：</p>
<ul>
<li><strong>验证</strong>：确保字节码文件的格式合法，符合 JVM 规范；</li>
<li><strong>准备</strong>：为类的静态变量分配内存，赋默认值；</li>
<li><strong>解析</strong>：把类中的符号引用变成直接引用，比如方法调用时就要知道实际地址。</li>
</ul>
<p>然后是 <strong>初始化</strong>，这是类真正开始能用的阶段，会执行静态代码块，同时给静态变量赋上我们在代码中写的初始值，比如 <code>static int a = 5;</code> 就会在这时候赋值。</p>
<p>类如果不再被使用，还会进入 <strong>卸载阶段</strong>。不过类要被卸载得满足几个条件：它的对象都被 GC 掉了、它的类加载器也被回收了，而且对应的 <code>Class</code> 对象不能被其他地方引用了。这个阶段其实在普通项目中比较少见，除非用到了自定义类加载器，比如插件系统。</p>
<h2 id="7-什么是类加载器？">7.什么是类加载器？</h2>
<ul>
<li>关联课程内容
<ul>
<li>基础篇-类加载器的分类</li>
<li>基础篇-启动类加载器</li>
<li>基础篇-扩展和引用程序类加载器</li>
<li>基础篇-JDK9之后的类加载器</li>
</ul>
</li>
<li>回答路径
<ul>
<li>类加载器的作用</li>
<li>启动类加载器</li>
<li>扩展/平台类加载器</li>
<li>应用程序类加载器</li>
<li>自定义类加载器（加分项）</li>
</ul>
</li>
</ul>
<p>类加载器负载在类的加载过程中将字节码信息以流的方式获取并加载到内存中。JDK8及之前如下：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1121-1024x461.png" alt="img"></p>
<p>JDK9之后均由Java实现：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1122-1024x416.png" alt="img"></p>
<h3 id="启动类加载器">启动类加载器</h3>
<p>启动类加载器（Bootstrap ClassLoader）是由Hotspot虚拟机提供的类加载器，JDK9之前使用C++编写的、JDK9之后使用Java编写。</p>
<p>默认加载Java安装目录/jre/lib下的类文件，比如rt.jar，tools.jar，resources.jar等。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1123.png" alt="img"></p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//String类 核心类 由启动类加载器加载，在Java中无法获得启动类加载器</span></span><br><span class="line">System.<span class="keyword">out</span>.println(java.lang.<span class="keyword">String</span>.<span class="keyword">class</span>.getClassLoader());</span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1125.png" alt="img"></p>
<p>在Java代码中无法获得启动类加载器。</p>
<h3 id="扩展类加载器">扩展类加载器</h3>
<p>扩展类加载器（Extension Class Loader）是JDK中提供的、使用Java编写的类加载器。JDK9之后由于采用了模块化，改名为Platform平台类加载器。</p>
<p>默认加载Java安装目录/jre/lib/ext下的类文件。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1126.png" alt="img"></p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//nashorn包中的类，使用java script引擎打印Hello World 由扩展类加载器加载</span><br><span class="line">ScriptEngine engine <span class="operator">=</span> new ScriptEngineManager().getEngineByName(<span class="string">&quot;nashorn&quot;</span>)<span class="comment">;</span></span><br><span class="line">engine.eval(<span class="string">&quot;print(&#x27;Hello World!&#x27;);&quot;</span>)<span class="comment">;</span></span><br><span class="line">System.out.println(ScriptEngineManager.class.getClassLoader())<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>打印结果（JDK17平台类加载器)：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1127.png" alt="img"></p>
<h3 id="应用程序类加载器">应用程序类加载器</h3>
<p>应用程序类加载器（Application Class Loader）是JDK中提供的、使用Java编写的类加载器。默认加载为应用程序classpath下的类。</p>
<h3 id="自定义类加载器">自定义类加载器</h3>
<p>自定义类加载器允许用户自行实现类加载的逻辑，可以从网络、数据库等来源加载类信息。自定义类加载器需要继承自ClassLoader抽象类，重写findClass方法。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1128.png" alt="img"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> q4classloader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="comment">//自定义类加载器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClassLoader</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> name.substring(name.lastIndexOf(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            bytes = FileUtils.readFileToByteArray(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\jvm\\data\\&quot;</span> + filename + <span class="string">&quot;.class&quot;</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获取字节码信息的二进制数据，调用defineClass方法</span></span><br><span class="line">        <span class="keyword">return</span> defineClass(name, bytes, <span class="number">0</span>, bytes.length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, InstantiationException, IllegalAccessException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">MyClassLoader</span> <span class="variable">myClassLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyClassLoader</span>();</span><br><span class="line"></span><br><span class="line">        Class&lt;?&gt; clazz = myClassLoader.loadClass(<span class="string">&quot;com.itheima.springbootclassfile.pojo.vo.UserVO&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//打印字段</span></span><br><span class="line">        Field[] fields = clazz.getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">            System.out.println(field.getName());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="总结：-3">总结：</h3>
<p>1.启动类加载器（Bootstrap ClassLoader）加载核心类</p>
<p>2.扩展类加载器（Extension ClassLoader）加载扩展类</p>
<p>3.应用程序类加载器（Application ClassLoader）加载应用classpath中的类</p>
<p>4.自定义类加载器，重写findClass方法。</p>
<p>JDK9及之后扩展类加载器（Extension ClassLoader）变成了平台类加载器（Platform ClassLoader）</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1129.png" alt="img"></p>
<h2 id="8-什么是双亲委派机制">8.什么是双亲委派机制</h2>
<ul>
<li>关联课程内容
<ul>
<li>基础篇-双亲委派机制</li>
<li>基础篇-打破双亲委派机制</li>
</ul>
</li>
<li>回答路径
<ul>
<li>类加载器和父类加载器</li>
<li>什么是双亲委派机制</li>
<li>双亲委派机制的作用</li>
</ul>
</li>
</ul>
<p>类加载有层级关系，上一级称之为下一级的父类加载器。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1130.png" alt="img"></p>
<p>测试代码:</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> q4classloader;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.script.ScriptEngineManager;</span><br><span class="line"><span class="keyword">import</span> javax.script.ScriptException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> PrintParentClassLoader &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String[] args) <span class="keyword">throws</span> ScriptException &#123;</span><br><span class="line">        <span class="keyword">new</span> ScriptEngineManager();</span><br><span class="line">        <span class="comment">//扩展类加载器的父类加载器</span></span><br><span class="line">        System.out.<span class="keyword">println</span>(ScriptEngineManager.<span class="keyword">class</span>.getClassLoader().getParent());</span><br><span class="line">        <span class="comment">//应用程序类加载器的父类加载器</span></span><br><span class="line">        System.out.<span class="keyword">println</span>(PrintParentClassLoader.<span class="keyword">class</span>.getClassLoader().getParent());</span><br><span class="line">        <span class="comment">//自定义类加载器的父类加载器</span></span><br><span class="line">        System.out.<span class="keyword">println</span>(<span class="keyword">new</span> MyClassLoader().getParent());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>打印结果:</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1131.png" alt="img"></p>
<ul>
<li>扩展类加载器的父类加载器但是在java中无法获得，所以打印null</li>
<li>应用程序类加载器的父类加载器是扩展类加载器（平台类加载器）</li>
<li>自定义类加载器的父类加载器是应用程序类加载器</li>
</ul>
<p><strong>双亲委派机制指的是：当一个类加载器接收到加载类的任务时，会向上查找是否加载过，再由顶向下进行加载。</strong></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1132.png" alt="img"></p>
<p>每个类加载器都有一个父类加载器，在类加载的过程中，每个类加载器都会先检查是否已经加载了该类，如果已经加载则直接返回，否则会将加载请求委派给父类加载器。</p>
<p>应用程序类加载器接收到加载类的任务，首先先检查自己有没有加载过：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1133.png" alt="img"></p>
<p>没有加载过就一层一层向上传递，都检查下自己有没有加载过这个类：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1134-1024x375.png" alt="img"></p>
<p>到了启动类加载器发现已经加载过，就返回。</p>
<p>另一个案例：com.itheima.my.C 这个类在当前程序的classpath中，看看是如何加载的。</p>
<p>先由应用程序类加载器检查，发现没有加载过，向上传递检查发现都没有加载过。此时启动类加载器会优先加载：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1135-1024x503.png" alt="img"></p>
<p>接下来向下传递加载：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1137-1024x511.png" alt="img"></p>
<p>最后由应用程序类加载器加载成功：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1138-1024x509.png" alt="img"></p>
<h3 id="双亲委派机制有什么用？">双亲委派机制有什么用？</h3>
<p>1.保证类加载的安全性，通过双亲委派机制避免恶意代码替换JDK中的核心类库，比如java.lang.String，确保核心类库的完整性和安全性。</p>
<p>2.避免重复加载，双亲委派机制可以避免同一个类被多次加载。</p>
<h3 id="总结-4">总结</h3>
<p>双亲委派机制指的是：当一个类加载器去加载某个类的时候，会自底向上查找是否加载过，如果加载过就直接返回，如果一直到最顶层的类加载器都没有加载，再由顶向下进行加载。</p>
<p>应用程序类加载器的父类加载器是扩展类加载器，扩展类加载器的父类加载器是启动类加载器。</p>
<p>双亲委派机制的好处有两点：第一是避免恶意代码替换 JDK 中的核心类库，比如 java.lang.String，确保核心类库的完整性和安全性。第二是避免一个类重复地被加载。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1139.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1140.png" alt="img"></p>
<h2 id="9-如何打破双亲委派机制">9.如何打破双亲委派机制</h2>
<h3 id="先了解下双亲委派机制的原理：">先了解下双亲委派机制的原理：</h3>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1141-1024x473.png" alt="img"></p>
<p>调用关系如下：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1142-1024x355.png" alt="img"></p>
<p>ClassLoader中包含了4个核心方法，对Java程序员来说，打破双亲委派机制的唯一方法就是实现自定义类加载器重写loadClass方法，将其中的双亲委派机制代码去掉。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1143-1024x353.png" alt="img"></p>
<p>打破双亲委派机制的源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> q4classloader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ItheimaClassLoader</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; loadClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="keyword">if</span>(name.startsWith(<span class="string">&quot;java.&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">super</span>.loadClass(name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//com.itheima.springbootclassfile.pojo.vo.UserVO .class</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> name.substring(name.lastIndexOf(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>) + <span class="string">&quot;.class&quot;</span>;</span><br><span class="line">        <span class="comment">//加载 D:/jvm/data</span></span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            bytes = FileUtils.readFileToByteArray(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\教学\\同步课程资料\\BaiduSyncdisk\\实战Java虚拟机\\实战Java虚拟机\\代码\\day12\\jvm-interview\\target\\classes\\q4classloader\\&quot;</span> + filename));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> defineClass(name,bytes,<span class="number">0</span>,bytes.length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ItheimaClassLoader</span> <span class="variable">itheimaClassLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ItheimaClassLoader</span>();</span><br><span class="line"></span><br><span class="line">        Class&lt;?&gt; clazz = itheimaClassLoader.loadClass(<span class="string">&quot;q4classloader.PrintParentClassLoader&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//打印类字段</span></span><br><span class="line"><span class="comment">//        Field[] declaredFields = clazz.getDeclaredFields();</span></span><br><span class="line"><span class="comment">//        for (Field declaredField : declaredFields) &#123;</span></span><br><span class="line"><span class="comment">//            System.out.println(declaredField.getName());</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//打印类加载器名字</span></span><br><span class="line">        System.out.println(clazz.getClassLoader());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="总结-5">总结</h3>
<p>双亲委派机制指的是：当一个类加载器接收到加载类的任务时，会自底向上交给父类加载器查找是否加载过，再由顶向下进行加载。</p>
<p>双亲委派机制的作用：保证类加载的安全性，避免重复加载。</p>
<p>打破双亲委派机制的方法：实现自定义类加载器，重写loadClass方法，将双亲委派机制的代码去除。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1144-1024x947.png" alt="img"></p>
<h2 id="10-为什么不建议打破双亲委派机制？（扩展）">10.为什么不建议打破双亲委派机制？（扩展）</h2>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1145-1024x816.png" alt="img"></p>
<h2 id="11-Tomcat的自定义类加载器">11.Tomcat的自定义类加载器</h2>
<p>Tomcat中，实现了一套自定义的类加载器。这一小节使用目前应用比较广泛的Tomcat9（9.0.84）源码进行分析。</p>
<h3 id="环境搭建：">环境搭建：</h3>
<p>可以直接运行代码文件夹下的tomcat源码，这个项目已经修改过源码了，但是为了保证将来版本更新后还能搭建最新代码版本的环境，将搭建过程在这里记录一下。</p>
<p>1、打开tomcat找到9.0版本的源代码，下载：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1146.png" alt="img"></p>
<p>2、使用Idea打开，整个项目没有使用Maven，为了方便进行项目管理。在项目中创建pom文件，内容如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>tomcat<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>c<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>tomcat<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sourceDirectory</span>&gt;</span>java<span class="tag">&lt;/<span class="name">sourceDirectory</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;testSourceDirectory&gt;test&lt;/testSourceDirectory&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">testResources</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">testResource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>test<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">testResource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">testResources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.easymock<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easymock<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.ant<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ant<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.10.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>wsdl4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>wsdl4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.xml<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxrpc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.eclipse.jdt.core.compiler<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ecj<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>biz.aQute.bnd<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>biz.aQute.bndlib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.unboundid<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>unboundid-ldapsdk<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>3、选择Application,添加应用。JDK选择JDK8：</p>
<p>4、添加JVM参数：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Duser.<span class="attribute">language</span>=en   -Duser.<span class="attribute">region</span>=US</span><br></pre></td></tr></table></figure>
<p>5、将JDTCompiler.java中这一段内容报错删除，这里我已经删除了：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1147-1024x387.png" alt="img"></p>
<p>6、在StringManager.java中添加这段代码，强制用iso8859-1编码获取字符串。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1148-1024x454.png" alt="img"></p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    value = <span class="keyword">new</span> <span class="built_in">String</span>(value.getBytes(<span class="string">&quot;iso8859-1&quot;</span>),<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>7、在ContextConfig.java文件中添加JSP初始化器：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1149-1024x454.png" alt="img"></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">context</span><span class="variable">.addServletContainerInitializer</span>(<span class="keyword">new</span> JasperInitializer(),<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<p>8、将web项目放入webapps目录下，运行项目：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1150-1024x627.png" alt="img"></p>
<p>Tomcat类加载器整体结构图如下：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1151-1024x439.png" alt="img"></p>
<h3 id="common类加载器">common类加载器</h3>
<p>common类加载器主要加载tomcat自身使用以及应用使用的jar包，默认配置在catalina.properties文件中。</p>
<p>common.loader=“${catalina.base}/lib”,“${catalina.base}/lib/*.jar”</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1152.png" alt="img"></p>
<p>debug调试common累类加载器初始化代码:</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1153-1024x569.png" alt="img"></p>
<p>它是URLClassLoader类的子类对象，根据URL获取jar包中的class字节码文件。</p>
<h3 id="catalina类加载器">catalina类加载器</h3>
<p>catalina类加载器主要加载tomcat自身使用的jar包，不让应用使用，默认配置在catalina.properties文件中。</p>
<p>server.loader= 默认配置为空，为空时catalina加载器和common加载器是同一个。</p>
<p>配置参数之前，catalina加载器其实就是common加载器：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1154-1024x519.png" alt="img"></p>
<p>配置catalina加载的路径：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1155-1024x382.png" alt="img"></p>
<p>这次就创建了一个新的Catalina类加载器，专门加载配置目录下的类：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1156-1024x456.png" alt="img"></p>
<h3 id="shared类加载器">shared类加载器</h3>
<p>shared类加载器主要加载应用使用的jar包，不让tomcat使用，默认配置在catalina.properties文件中。</p>
<p>shared.loader= 默认配置为空，为空时shared加载器和common加载器是同一个。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1157-1024x339.png" alt="img"></p>
<h3 id="ParallelWebappClassLoader类加载器">ParallelWebappClassLoader类加载器</h3>
<p>ParallelWebappClassLoader类加载器可以多线程并行加载应用中使用到的类，每个应用都拥有一个自己的该类加载器。</p>
<p>demo1项目的类加载器：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1158-1024x512.png" alt="img"></p>
<p>demo2的类加载器：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1159-1024x456.png" alt="img"></p>
<p><strong>为什么每个应用会拥有一个独立的ParallelWebappClassLoader类加载器呢？</strong></p>
<p>同一个类加载器，只能加载一个同名的类。两个应用中相同名称的类都必须要加载。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1160.png" alt="img"></p>
<p>所以tomcat的做法是为每个应用创建一个web应用类加载器(这样tomcat不同应用中同名的类就可以独立加载了)：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1161.png" alt="img"></p>
<p><strong>ParallelWebappClassLoader的执行流程：</strong></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1162.png" alt="img"></p>
<p>默认这里打破了双亲委派机制，应用中的类如果没有加载过。会先从当前类加载器加载，然后再交给父类加载器通过双亲委派机制加载。(开启代理之后走的是双亲委派机制，不开启代理打破了双亲委派机制)</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1163.png" alt="img"></p>
<h3 id="JasperLoader类加载器">JasperLoader类加载器</h3>
<p>JasperLoader类加载器负责加载JSP文件编译出来的class字节码文件，为了实现热部署（不重启让修改的jsp生效），每一个jsp文件都由一个独立的JasperLoader负责加载。（每当你修改某个jsp文件，那么该jsp文件对应的JasperLoader就会被弃用掉，然后重新创建一个新的JasperLoader来加载修改后的jsp文件，这样就实现了热部署。）</p>
<p>访问一个JSP文件，会触发JasperLoader类加载器的创建：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1164.png" alt="img"></p>
<p>修改JSP文件：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1165-1024x442.png" alt="img"></p>
<p>用Arthas看类加载器情况：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1166.png" alt="img"></p>
<p>类加载器数量变多了。</p>
<h3 id="总结：-4">总结：</h3>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1167-1024x457.png" alt="img"></p>
<p>“简单介绍一下Tomcat的自定义类加载器”</p>
<p>Tomcat为了支持多个Web应用同时运行，而且彼此之间不互相影响，就实现了一套自己的类加载器体系。它并没有完全遵循Java默认的双亲委派模型，而是根据不同的加载需求，做了定制化设计。我们可以简单把它理解成：Tomcat给自己和每个Web项目都配了专属的“搬运工”，这些“搬运工”只负责搬自己指定区域的jar包和class文件。</p>
<p>Tomcat中主要有五类类加载器，咱们逐个说一下：</p>
<p><strong>1. Common类加载器</strong><br>
这个加载器相当于大家都能用的公共搬运工，负责加载<code>$CATALINA_HOME/lib</code>目录下的jar包，不管是Tomcat自身还是Web应用都能用。</p>
<p><strong>2. Catalina类加载器</strong><br>
它是Tomcat的“私人专属”，只加载Tomcat核心功能所需要的类。默认它和Common加载器是一个对象，但你也可以配置让它只加载指定目录的类，让Tomcat的类和应用的类更好隔离。</p>
<p><strong>3. Shared类加载器</strong><br>
这是Web应用的“共享搬运工”，只为Web应用服务，不提供给Tomcat本体用。默认情况下也是指向Common加载器，但可以单独配置。</p>
<p><strong>4. ParallelWebappClassLoader</strong><br>
这是每个Web应用自己专属的类加载器，相当于每个项目自己带了一个“私有搬运工”。为什么要这么做？因为同一个Tomcat里可能会部署多个项目，而这些项目里可能存在同名的类，比如两个项目里都有一个<code>com.example.User</code>，如果不隔离就容易冲突，所以Tomcat为每个项目创建独立加载器。</p>
<p>这个加载器还有个特点就是“并行”——支持多线程同时加载类，提高效率。而且它默认是<strong>打破双亲委派机制</strong>的，也就是说它优先加载自己目录下的类，再去找父类加载器。这样就保证了项目优先使用自己的依赖，不被Tomcat默认依赖“污染”。</p>
<p><strong>5. JasperLoader类加载器</strong><br>
这个加载器专门用来加载JSP编译出来的class文件。它的妙处在于：每个JSP页面都有一个自己的类加载器，这样当你修改了某个JSP文件的时候，Tomcat就会丢掉旧的JasperLoader，重新生成一个加载器加载新的JSP class，这就实现了<strong>JSP热部署</strong>，不需要重启Tomcat也能让改动生效。</p>
<p>总结来说，Tomcat之所以要做这一套自定义的类加载器，是为了实现“应用隔离、热部署、高效率”的目标。每种加载器都有明确的职责和加载路径，互相配合又互不干扰，这是Tomcat作为Web容器的核心能力之一。</p>
<p>而且这套体系打破了传统双亲委派机制，给了开发者更多灵活性。</p>
<h2 id="12-如何判断堆上的对象没有被引用？？">12.如何判断堆上的对象没有被引用？？</h2>
<ul>
<li>
<p>关联课程内容</p>
<ul>
<li>基础篇-引用计数法</li>
<li>基础篇-可达性分析法</li>
</ul>
</li>
<li>
<p>回答路径</p>
<ul>
<li>引用计数法</li>
<li>可达性分析法</li>
<li>使用可达性分析法原因</li>
</ul>
</li>
</ul>
<h3 id="引用计数法">引用计数法</h3>
<p>引用计数法会为每个对象维护一个引用计数器，当对象被引用时加1，取消引用时减1。</p>
<p>当局部变量对A对象产生引用之后，A的计数器就会加1：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1168-1024x413.png" alt="img"></p>
<p>同样，当A对象对B对象产生引用之后，B的计数器会加1：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1169-1024x415.png" alt="img"></p>
<p>引用计数法的优点是实现简单，缺点有两点：</p>
<p>1.每次引用和取消引用都需要维护计数器，对系统性能会有一定的影响</p>
<p>2.存在循环引用问题，所谓循环引用就是当A引用B，B同时引用A时会出现对象无法回收的问题。</p>
<p>如下图：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1170-1024x384.png" alt="img"></p>
<p>A对象和B对象在局部变量中已经无法访问了，但是由于他们互相引用对方，导致对象不能被回收。</p>
<h3 id="可达性分析法">可达性分析法</h3>
<p>Java使用的是可达性分析算法来判断对象是否可以被回收。可达性分析将对象分为两类：垃圾回收的根对象（GC Root）和普通对象，对象与对象之间存在引用关系。</p>
<p>下图中A到B再到C和D，形成了一个引用链，可达性分析算法指的是如果从某个到GC Root对象是可达的，对象就不可被回收。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1171-1024x358.png" alt="img"></p>
<p>哪些对象被称之为GC Root对象呢？</p>
<ul>
<li>线程Thread对象，引用线程栈帧中的方法参数、局部变量等。</li>
<li>系统类加载器加载的java.lang.Class对象，引用类中的静态变量。</li>
<li>监视器对象，用来保存同步锁synchronized关键字持有的对象。</li>
<li>本地方法调用时使用的全局对象。</li>
</ul>
<h3 id="总结：-5">总结：</h3>
<p>引用计数法会为每个对象维护一个引用计数器，当对象被引用时加1，取消引用时减1，存在循环引用问题所以Java没有使用这种方法。</p>
<p>Java使用的是可达性分析算法来判断对象是否可以被回收。可达性分析将对象分为两类：垃圾回收的根对象（GC Root）和普通对象。</p>
<p>可达性分析算法指的是如果从某个到GC Root对象是可达的，对象就不可被回收。最常见的是GC Root对象会引用栈上的局部变量和静态变量导致对象不可回收。</p>
<p>「如何判断堆上的对象没有被引用？为什么 Java 使用可达性分析法而不是引用计数法？」</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1172.png" alt="img"></p>
<h2 id="13-JVM-中都有哪些引用类型？">13. JVM 中都有哪些引用类型？</h2>
<ul>
<li>关联课程内容
<ul>
<li>基础篇-软引用</li>
<li>基础篇-弱虚终结器引用</li>
</ul>
</li>
</ul>
<p>回答路径</p>
<ul>
<li>强引用</li>
<li>软引用</li>
<li>弱引用</li>
<li>虚引用</li>
<li>终结器引用</li>
</ul>
<h3 id="强引用">强引用</h3>
<p>强引用，JVM中默认引用关系就是强引用，即是对象被局部变量、静态变量等GC Root关联的对象引用，只要这层关系存在，普通对象就不会被回收。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> q5reference;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-Xmx10m -verbose:gc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StrongReferenceDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">_1MB</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Object&gt; objects = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[_1MB];</span><br><span class="line">            <span class="comment">//强引用</span></span><br><span class="line">            objects.add(bytes);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>强引用的对象不会被回收掉，所以会出现内存溢出：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1173.png" alt="img"></p>
<h3 id="软引用">软引用</h3>
<p>软引用，软引用相对于强引用是一种比较弱的引用关系，如果一个对象只有软引用关联到它，当程序内存不足时，就会将软引用中的数据进行回收。软引用主要在缓存框架中使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> q5reference;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.ref.SoftReference;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-Xmx10m -verbose:gc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SoftReferenceDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">_1MB</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;SoftReference&gt; objects = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[_1MB];</span><br><span class="line">            <span class="comment">//软引用</span></span><br><span class="line">            SoftReference&lt;<span class="type">byte</span>[]&gt; softReferences = <span class="keyword">new</span> <span class="title class_">SoftReference</span>&lt;<span class="type">byte</span>[]&gt;(bytes);</span><br><span class="line">            <span class="comment">//软引用对象放入集合中</span></span><br><span class="line">            objects.add(softReferences);</span><br><span class="line"></span><br><span class="line">            System.out.println(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//有一部分对象因为内存不足，已经被回收了</span></span><br><span class="line">        <span class="keyword">for</span> (SoftReference softReference : objects) &#123;</span><br><span class="line">            System.out.println(softReference.get());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>内存不足时，触发了垃圾回收。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1174.png" alt="img"></p>
<p>所以前几个对象已经被回收了，但是后边几个会保留下来：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1175.png" alt="img"></p>
<h3 id="弱引用">弱引用</h3>
<p>弱引用，弱引用的整体机制和软引用基本一致，区别在于弱引用包含的对象在垃圾回收时，不管内存够不够都会直接被回收，弱引用主要在ThreadLocal中使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> q5reference;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.ref.SoftReference;</span><br><span class="line"><span class="keyword">import</span> java.lang.ref.WeakReference;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-Xmx100m -verbose:gc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeakReferenceDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">_1MB</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;WeakReference&lt;<span class="type">byte</span>[]&gt;&gt; objects = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        System.out.println(<span class="string">&quot;-------------------&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[_1MB];</span><br><span class="line">            <span class="comment">//弱引用</span></span><br><span class="line">            WeakReference&lt;<span class="type">byte</span>[]&gt; weakReference = <span class="keyword">new</span> <span class="title class_">WeakReference</span>&lt;<span class="type">byte</span>[]&gt;(bytes);</span><br><span class="line">            <span class="comment">//弱引用对象放入集合中</span></span><br><span class="line">            objects.add(weakReference);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置一个强引用</span></span><br><span class="line">        <span class="type">byte</span>[] last = objects.get(<span class="number">9</span>).get();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//手动执行一次垃圾回收，弱引用对象只要没有强引用，就会被直接回收</span></span><br><span class="line">        System.gc();</span><br><span class="line">        System.out.println(<span class="string">&quot;-------------------&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (WeakReference softReference : objects) &#123;</span><br><span class="line">            System.out.println(softReference.get());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>手动触发垃圾回收之后，前9个都被回收了，最后一个由于存在强引用会保留下来：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1176.png" alt="img"></p>
<h3 id="虚引用">虚引用</h3>
<p>虚引用（幽灵引用/幻影引用），不能通过虚引用对象获取到包含的对象。虚引用唯一的用途是当对象被垃圾回收器回收时可以接收到对应的通知。直接内存中为了及时知道直接内存对象不再使用，从而回收内存，使用了虚引用来实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> q5reference;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.ref.PhantomReference;</span><br><span class="line"><span class="keyword">import</span> java.lang.ref.Reference;</span><br><span class="line"><span class="keyword">import</span> java.lang.ref.ReferenceQueue;</span><br><span class="line"><span class="keyword">import</span> java.lang.ref.WeakReference;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-Xmx10m -verbose:gc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PhantomReferenceDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">_1MB</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ReferenceQueue&lt;<span class="type">byte</span>[]&gt; queue = <span class="keyword">new</span> <span class="title class_">ReferenceQueue</span>();</span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[_1MB];</span><br><span class="line">        <span class="type">MyPhantomReference</span> <span class="variable">phantomReference</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyPhantomReference</span>(bytes, queue);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//去除强引用</span></span><br><span class="line">        bytes = <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//执行垃圾回收</span></span><br><span class="line">        System.gc();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查看队列</span></span><br><span class="line">        <span class="type">MyPhantomReference</span> <span class="variable">ref</span> <span class="operator">=</span> (MyPhantomReference) queue.poll();</span><br><span class="line">        <span class="comment">//清理</span></span><br><span class="line">        ref.clean();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPhantomReference</span> <span class="keyword">extends</span> <span class="title class_">PhantomReference</span>&lt;<span class="type">byte</span>[]&gt;&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clean</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;清理...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyPhantomReference</span><span class="params">(<span class="type">byte</span>[] referent, ReferenceQueue&lt;<span class="type">byte</span>[]&gt; q)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(referent, q);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对象回收之后虚引用对象会进入队列，这样就可以获取对象执行指定的方法了。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1177-1024x545.png" alt="img"></p>
<h3 id="终结器引用">终结器引用</h3>
<p>终结器引用，终结器引用指的是在对象需要被回收时，终结器引用会关联对象并放置在Finalizer类中的引用队列中，在稍后由一条由FinalizerThread线程从队列中获取对象，然后执行对象的finalize方法（本意是方便对象回收前可以在finalize方法中做一些收尾工作，但finalize方法里如果存在执行特别慢的逻辑甚至抛出异常反而更不好处理。因此实际开发中很少使用），在对象第二次被回收时，该对象才真正的被回收。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> q5reference;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-verbose:gc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FinalizeReferenceDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">Demo</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo</span>();</span><br><span class="line">        demo = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        System.gc();</span><br><span class="line"></span><br><span class="line">        System.in.read();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Demo</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;触发finalize&quot;</span>);</span><br><span class="line">        <span class="built_in">super</span>.finalize();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对象回收时，触发了finalize方法：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1178.png" alt="img"></p>
<h3 id="总结-6">总结</h3>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1179-1024x498.png" alt="img"></p>
<p>面试官您好，其实在 JVM 中，引用的强度是分等级的，一共分为五种类型，分别是：<strong>强引用、软引用、弱引用、虚引用</strong>和<strong>终结器引用</strong>。</p>
<p><strong>首先是强引用</strong>，这个是最常见的引用类型，比如我们平时 new 出一个对象，被一个变量引用着，这就是强引用。只要这个强引用还在，垃圾回收器是不会动这个对象的，所以容易出现内存溢出。</p>
<p><strong>软引用</strong>是一个比强引用弱一点的引用类型。它的特点是<strong>在内存足够时不会回收，一旦内存吃紧了，就会被 GC 回收</strong>。这个引用特别<strong>适合做缓存</strong>，比如内存缓存就是用软引用实现的。</p>
<p><strong>弱引用</strong>就更“脆弱”了，<strong>它在 GC 扫描到时就会被回收，不管内存紧不紧张</strong>。像 Java 里的 <code>ThreadLocal</code> 就是用弱引用来实现的，这样可以避免线程没结束但对象还一直被强引用绑着。</p>
<p><strong>虚引用</strong>听起来很玄，<strong>它的最大特点是你根本不能通过虚引用拿到对象本身，它的存在只是为了接收一个“通知”</strong>：当这个对象被 GC 回收时，会通知你一下。这个机制在管理<strong>直接内存（off-heap）资源</strong>的时候非常有用，方便做一些清理动作。</p>
<p><strong>最后是终结器引用</strong>，这个主要和对象的 <code>finalize()</code> 方法有关。当对象没有引用但没被立即回收时，它会被放到一个引用队列中，之后会被 Finalizer 线程处理，执行 <code>finalize()</code> 方法再回收。这个机制已经被官方建议少用了，因为不确定性比较大、性能也差。</p>
<p>总结一下的话，就是：</p>
<table>
<thead>
<tr>
<th>引用类型</th>
<th>是否影响 GC 回收</th>
<th>特点用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>强引用</td>
<td>否</td>
<td>默认引用类型，不可回收</td>
</tr>
<tr>
<td>软引用</td>
<td>视内存情况而定</td>
<td>用于缓存</td>
</tr>
<tr>
<td>弱引用</td>
<td>是</td>
<td>GC 一扫就回收，用于 ThreadLocal 等</td>
</tr>
<tr>
<td>虚引用</td>
<td>是</td>
<td>接收 GC 通知，用于资源释放</td>
</tr>
<tr>
<td>终结器引用</td>
<td>是</td>
<td>与 finalize 方法绑定，不推荐使用</td>
</tr>
</tbody>
</table>
<p>这些引用类型共同构成了 JVM 内存管理和垃圾回收策略中的一部分，让 Java 对内存的控制更加灵活。</p>
<h2 id="14-ThreadLocal中为什么要使用弱引用？">14.ThreadLocal中为什么要使用弱引用？</h2>
<p>ThreadLocal可以在线程中存放线程的本地变量，保证数据的线程安全。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1180-1024x329.png" alt="img"></p>
<h3 id="ThreadLocal的底层结构">ThreadLocal的底层结构</h3>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1185.png" alt="img"></p>
<p>ThreadLocal中是这样去保存对象的：</p>
<p>1、在每个线程中，存放了一个ThreadLocalMap对象，本质上就是一个数组实现的哈希表，里边存放多个Entry对象。</p>
<p>2、每个Entry对象继承自弱引用，内部存放ThreadLocal对象。同时用强引用，引用保存的ThreadLocal对应的value值。</p>
<p>注：</p>
<ul>
<li>
<ol>
<li>Entry对象的key是ThreadLocal对象，value是该ThreadLocal对象对应的值（我们想放入ThreadLocal数据）。</li>
</ol>
</li>
<li>
<ol start="2">
<li>ThreadLocalMap属于线程，其中保存的是一个个Entry对象，我们想要放入ThreadLocal的数据是作为Entry对象的value值，并不是保存在对应的ThreadLocal对象本身。</li>
</ol>
</li>
<li>
<ol start="3">
<li>Entry对象继承自弱引用，它本身是弱引用对象，它对ThreadLocal对象是弱引用，而对value值是强引用。ThreadLocalMap对Entry对象是强引用。所以GC时只会回收ThreadLocal对象而不会回收Entry对象和Value值。</li>
</ol>
</li>
</ul>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1181-1024x322.png" alt="img"></p>
<p>以代码为例：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">threadLocal.<span class="keyword">set</span>(<span class="built_in">new</span> <span class="keyword">User</span>(<span class="number">1</span>,&quot;main线程对象&quot;));</span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1182-1024x369.png" alt="img"></p>
<p>获取数据时：</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">User</span> <span class="title">user</span> = threadLocal.get();</span><br></pre></td></tr></table></figure>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1183-1024x372.png" alt="img"></p>
<p>不再使用Threadlocal对象时， threadlocal = null；由于是弱引用，那么在垃圾回收之后，ThreadLocal对象就可以被回收。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1184-1024x349.png" alt="img"></p>
<p>此时还有Entry对象和value对象没有能被回收，所以在ThreadLocal类的set、get、remove方法中，在某些特定条件满足的情况下，会主动删除这两个对象。</p>
<p>如果一直不调用set、get、remove方法或者调用了没有满足条件，这部分对象就会出现内存泄漏。<strong>强烈建议在ThreadLocal不再使用时，调用remove方法回收将Entry对象的引用关系去掉</strong>，这样就可以回收这两个对象了。</p>
<h3 id="总结：-6">总结：</h3>
<p>当threadlocal对象不再使用时，使用弱引用可以让对象被回收；因为仅有弱引用没有强引用的情况下，对象是可以被回收的。</p>
<p>弱引用并没有完全解决掉对象回收的问题，Entry对象和value值无法被回收，所以合理的做法是手动调用remove方法进行回收，然后再将threadlocal对象的强引用解除。</p>
<ul>
<li><code>remove()</code> 方法只是移除当前线程对 value 的引用；</li>
<li>但 <code>ThreadLocal</code> 对象本身，如果你还有地方（比如静态变量）强引用它，它就不会被 GC；</li>
<li>所以，如果确定不再用了，<strong>要手动把你自己代码里定义的 <code>ThreadLocal</code> 变量设为 null</strong>，这样连强引用都断掉了，它就能被 GC 回收。</li>
</ul>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1186-1024x278.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1187.png" alt="img"></p>
<p>面试这样答：</p>
<p>“<code>ThreadLocal</code> 里用的是弱引用，是为了避免内存泄漏。因为我们自己写的代码可能在用完 ThreadLocal 后没有清理，如果用强引用，JVM 就不会帮我们自动回收，线程不销毁，ThreadLocalMap 就会一直把这些值挂着。弱引用一旦没强引用支撑就能被 GC 回收，但仅靠弱引用也不保险，因为 Entry 中的 value 仍是强引用，所以建议在使用完 ThreadLocal 后手动调用 <code>remove()</code> 方法，这样 value 也能回收掉，彻底释放引用，更安全”</p>
<h2 id="15-有哪些常见的垃圾回收算法">15.有哪些常见的垃圾回收算法</h2>
<ul>
<li>
<p>关联课程内容</p>
<ul>
<li>基础篇-垃圾回收算法的评价标准</li>
<li>基础篇-垃圾回收算法</li>
<li>基础篇-分代垃圾回收</li>
</ul>
</li>
<li>
<p>回答路径</p>
<ul>
<li>垃圾回收算法的机制、优缺点</li>
<li>标记清除</li>
<li>标记整理</li>
<li>复制</li>
<li>分代GC</li>
</ul>
</li>
</ul>
<p>1960年John McCarthy发布了第一个GC算法：标记-清除算法。</p>
<p>1963年Marvin L. Minsky 发布了复制算法。</p>
<p>本质上后续所有的垃圾回收算法，都是在上述两种算法的基础上优化而来。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1188-1024x242.png" alt="img"></p>
<h3 id="标记清除算法">标记清除算法</h3>
<p>标记清除算法的核心思想分为两个阶段：</p>
<p>1.标记阶段，将所有存活的对象进行标记。Java中使用可达性分析算法，从GC Root开始通过引用链遍历出所有存活对象。</p>
<p>2.清除阶段，从内存中删除没有被标记也就是非存活对象。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1189-1024x379.png" alt="img"></p>
<p>优点：实现简单，只需要在第一阶段给每个对象维护标志位，第二阶段删除对象即可。</p>
<p>缺点：1.碎片化问题</p>
<p>由于内存是连续的，所以在对象被删除之后，内存中会出现很多细小的可用内存单元。如果我们需要的是一个比较大的空间，很有可能这些内存单元的大小过小无法进行分配。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1190-1024x370.png" alt="img"></p>
<p>2.分配速度慢。由于内存碎片的存在，需要维护一个空闲链表，极有可能发生每次需要遍历到链表的最后才能获得合适的内存空间。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1191-1024x283.png" alt="img"></p>
<h3 id="复制算法">复制算法</h3>
<p>复制算法的核心思想是：</p>
<p>1.准备两块空间From空间和To空间，每次在对象分配阶段，只能使用其中一块空间（From空间）。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1192-1024x298.png" alt="img"></p>
<p>2.在垃圾回收GC阶段，将From中存活对象复制到To空间。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1193-1024x308.png" alt="img"></p>
<p>3.将两块空间的From和To名字互换。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1194-1024x291.png" alt="img"></p>
<p>优点：</p>
<ul>
<li>吞吐量高，复制算法只需要遍历一次存活对象复制到To空间即可，比标记-整理算法少了一次遍历的过程，因而性能较好，但是不如标记-清除算法，因为标记清除算法不需要进行对象的移动</li>
<li>不会发生碎片化，复制算法在复制之后就会将对象按顺序放入To空间中，所以对象以外的区域都是可用空间，不存在碎片化内存空间。</li>
</ul>
<p>缺点：</p>
<ul>
<li>内存使用效率低，每次只能让一半的内存空间来为创建对象使用</li>
</ul>
<h3 id="标记整理算法">标记整理算法</h3>
<p>标记整理算法也叫标记压缩算法，是对标记清理算法中容易产生内存碎片问题的一种解决方案。</p>
<p>核心思想分为两个阶段：</p>
<p>1.标记阶段，将所有存活的对象进行标记。Java中使用可达性分析算法，从GC Root开始通过引用链遍历出所有存活对象。</p>
<p>2.整理阶段，将存活对象移动到堆的一端。清理掉存活对象的内存空间。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1196-1024x256.png" alt="img"></p>
<p>优点：</p>
<ul>
<li>内存使用效率高，整个堆内存都可以使用，不会像复制算法只能使用半个堆内存</li>
<li>不会发生碎片化，在整理阶段可以将对象往内存的一侧进行移动，剩下的空间都是可以分配对象的有效空间</li>
</ul>
<p>缺点：</p>
<ul>
<li>整理阶段的效率不高，整理算法有很多种，比如Lisp2整理算法需要对整个堆中的对象搜索3次，整体性能不佳。可以通过Two-Finger、表格算法、ImmixGC等高效的整理算法优化此阶段的性能</li>
</ul>
<h3 id="分代垃圾回收算法">分代垃圾回收算法</h3>
<p>现代优秀的垃圾回收算法，会将上述描述的垃圾回收算法组合进行使用，其中应用最广的就是分代垃圾回收算法(Generational GC)。</p>
<p>分代垃圾回收将整个内存区域划分为年轻代和老年代：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1197.png" alt="img"></p>
<p>分代回收时，创建出来的对象，首先会被放入Eden伊甸园区。</p>
<p>随着对象在Eden区越来越多，如果Eden区满，新创建的对象已经无法放入，就会触发年轻代的GC，称为Minor GC或者Young GC。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1198-1024x338.png" alt="img"></p>
<p>Minor GC会把需要eden中和From需要回收的对象回收，把没有回收的对象放入To区。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1199-1024x330.png" alt="img"></p>
<p>接下来，S0会变成To区，S1变成From区。当eden区满时再往里放入对象，依然会发生Minor GC。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1200-1024x342.png" alt="img"></p>
<p>此时会回收eden区和S1(from)中的对象，并把eden和from区中剩余的对象放入S0。</p>
<p>注意：每次Minor GC中都会为对象记录他的年龄，初始值为0，每次GC完加1。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1201-1024x333.png" alt="img"></p>
<p>如果Minor GC后对象的年龄达到阈值（最大15，默认值和垃圾回收器有关），对象就会被晋升至老年代。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1202-1024x325.png" alt="img"></p>
<p>当整个新生代的空间都被使用时，无法放入新的对象时，先尝试 Minor GC，把未达到年龄阈值但是最老的对象放入老年代，如果老年代空间也被占满了，会触发 Full GC（回收整个堆的所有对象）</p>
<p>一个长时间运行的应用可能积累了许多长生命周期的对象，导致老年代逐渐填满，即使新生代并未完全填满，JVM 也可能触发 Full GC 来清理老年代</p>
<p>如果 Full GC 依然无法回收掉老年代的对象，那么当对象继续放入老年代时，就会抛出 Out Of Memory 异常。</p>
<p>至于为什么不会被回收：因为这里的回收条件依然要满足可达性分析，如果不满足，是不能被回收的</p>
<p>程序中大部分对象都是朝生夕死，在年轻代创建并且回收，只有少量对象会长期存活进入老年代。分代垃圾回收的优点有：</p>
<p>1、可以通过调整年轻代和老年代的比例来适应不同类型的应用程序，提高内存的利用率和性能。</p>
<p>2、新生代和老年代使用不同的垃圾回收算法，新生代一般选择复制算法效率高、不会产生内存碎片，老年代可以选择标记-清除和标记-整理算法，由程序员来选择灵活度较高。</p>
<p>3、分代的设计中允许只回收新生代（minor gc），如果能满足对象分配的要求就不需要对整个堆进行回收(full gc),STW（Stop The World）由垃圾回收引起的停顿时间就会减少。</p>
<h3 id="总结：-7">总结：</h3>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1203.png" alt="img"></p>
<p><strong>面试官问：有哪些常见的垃圾回收算法？你了解吗？</strong></p>
<p>答：</p>
<p>嗯，我简单介绍一下常见的几种垃圾回收算法，其实大多数 GC 算法都是基于两个“祖宗级”的思想演变而来的：一个是“标记-清除”算法，一个是“复制”算法。</p>
<ol>
<li><strong>标记-清除（Mark-Sweep）</strong>：<br>
就是先把所有还活着的对象标记一下，然后把没被标记的直接清除掉。这种方式实现简单，但问题是容易产生内存碎片，比如清掉很多小块内存后，剩下的零碎空间可能凑不出一个新对象需要的空间。</li>
<li><strong>复制（Copying）算法</strong>：<br>
它的想法是：准备两块内存区域，每次只用一块，把存活的对象从当前区域复制到另一块区域，然后整体清空原来的区域。这样做虽然避免了内存碎片的问题，但缺点是只能用一半的空间，浪费比较大。</li>
<li><strong>标记-整理（Mark-Compact）算法</strong>：<br>
也是先标记存活对象，但不同于“清除”，这个算法会把所有存活对象往内存的一边移动，然后清理掉后面的一大片空闲内存，这样既解决了碎片问题，又保留了内存的连续性。不过移动对象的成本较高，效率会稍低。</li>
<li><strong>分代垃圾回收（Generational GC）</strong>：<br>
现代 JVM 一般都采用分代的方式，把堆内存分成“年轻代”和“老年代”，不同代使用不同算法。<br>
年轻代通常用“复制”算法，因为这里对象生命周期短、回收频繁；而老年代则常用“标记-清除”或“标记-整理”，因为对象通常存活时间较长，不适合频繁复制。</li>
</ol>
<p>这个分代回收机制有个好处：大部分新创建的对象很快就不再用了，所以可以快速在年轻代清理掉，减少对整个堆的 Full GC 影响，从而提升应用的吞吐量和响应性能。</p>
<h2 id="16-有哪些常用的垃圾回收器？">16.有哪些常用的垃圾回收器？</h2>
<ul>
<li>
<p>关联课程内容</p>
<ul>
<li>基础篇-垃圾回收器1</li>
<li>基础篇-垃圾回收器2</li>
<li>基础篇-垃圾回收器3</li>
<li>基础篇-g1垃圾回收器</li>
<li>实战篇-垃圾回收器的选择</li>
<li>高级篇-ShenandoahGC</li>
<li>高级篇-ZG</li>
</ul>
</li>
<li>
<p>回答路径</p>
<ul>
<li>Serial垃圾回收器 + SerialOld垃圾回收器</li>
<li>ParNew + CMS</li>
<li>PS + PO</li>
<li>G1</li>
<li>Shenandoah 和 ZGC</li>
</ul>
</li>
</ul>
<p>垃圾回收器是垃圾回收算法的具体实现。</p>
<p>由于垃圾回收器分为年轻代和老年代，除了G1之外其他垃圾回收器必须成对组合进行使用。</p>
<p>具体的关系图如下：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1204-1024x359.png" alt="img"></p>
<h3 id="Serial垃圾回收器-SerialOld垃圾回收器">Serial垃圾回收器 + SerialOld垃圾回收器</h3>
<p>Serial是是一种单线程串行回收年轻代的垃圾回收器。</p>
<p>-XX:+UseSerialGC 新生代、老年代都使用串行回收器。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1205.png" alt="img"></p>
<p><strong>回收年代和算法</strong></p>
<ul>
<li>年轻代复制算法</li>
<li>老年代标记-整理算法</li>
</ul>
<p><strong>优点</strong></p>
<p>单CPU处理器下吞吐量非常出色</p>
<p><strong>缺点</strong></p>
<p>多CPU下吞吐量不如其他垃圾回收器，堆如果偏大会让用户线程处于长时间的等待</p>
<p><strong>适用场景</strong></p>
<p>Java编写的客户端程序或者硬件配置有限的场景</p>
<p>老年代 - SerialOld 垃圾回收器</p>
<p>SerialOld 是 Serial 垃圾回收器的老年代版本，采用<strong>单线程串行回收</strong></p>
<p>-XX:+UseSerialGC 新生代、老年代都使用串行回收器。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1206.png" alt="img"></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1207.png" alt="img"></p>
<h3 id="Parallel-Scavenge垃圾回收器-Parallel-Old垃圾回收器">Parallel Scavenge垃圾回收器 + Parallel Old垃圾回收器</h3>
<p>PS+PO是JDK8默认的垃圾回收器，多线程并行回收，关注的是系统的吞吐量。具备自动调整堆内存大小的特点。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1208.png" alt="img"></p>
<p><strong>回收年代和算法</strong></p>
<ul>
<li>年轻代复制算法</li>
<li>老年代标记-整理算法</li>
</ul>
<p><strong>优点</strong></p>
<p>吞吐量高，而且手动可控。为了提高吞吐量，虚拟机会动态调整堆的参数</p>
<p><strong>缺点</strong></p>
<p>不能保证单次的停顿时间</p>
<p><strong>适用场景</strong></p>
<p>后台任务，不需要与用户交互，并且容易产生大量的对象</p>
<p>比如：大数据的处理，大文件导出</p>
<h3 id="ParNew垃圾回收器-CMS垃圾回收器">ParNew垃圾回收器 +CMS垃圾回收器</h3>
<p>ParNew垃圾回收器本质上是对Serial在多CPU下的优化，使用多线程进行垃圾回收</p>
<p>-XX:+UseParNewGC 新生代使用ParNew回收器，老年代使用串行回收器</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1209.png" alt="img"></p>
<p><strong>回收年代和算法</strong></p>
<ul>
<li>年轻代</li>
<li>复制算法</li>
</ul>
<p><strong>优点</strong></p>
<p>多CPU处理器下停顿时间较短</p>
<p><strong>缺点</strong></p>
<p>吞吐量和停顿时间不如G1，所以在JDK9之后不建议使用</p>
<p><strong>适用场景</strong></p>
<p>JDK8及之前的版本中，与CMS老年代垃圾回收器搭配使用</p>
<p>老年代- CMS(Concurrent Mark Sweep)垃圾回收器</p>
<p>CMS垃圾回收器关注的是系统的暂停时间，允许用户线程和垃圾回收线程在某些步骤中同时执行，减少了用户线程的等待时间。</p>
<p>参数：-XX:+UseConcMarkSweepGC</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1210.png" alt="img"></p>
<p><strong>回收年代和算法</strong></p>
<ul>
<li>老年代</li>
<li>标记清除算法</li>
</ul>
<p><strong>优点</strong></p>
<p>系统由于垃圾回收出现的停顿时间较短，用户体验好</p>
<p><strong>缺点</strong></p>
<p>1、内存碎片问题</p>
<p>2、退化问题</p>
<p>3、浮动垃圾问题</p>
<p><strong>适用场景</strong></p>
<p>大型的互联网系统中用户请求数据量大、频率高的场景</p>
<p>比如订单接口、商品接口等</p>
<p><strong>CMS垃圾回收器存在的问题</strong></p>
<p>1、CMS使用了标记-清除算法，在垃圾收集结束之后会出现大量的内存碎片，CMS会在Full GC时进行碎片的整理。这样会导致用户线程暂停，可以使用-XX:CMSFullGCsBeforeCompaction=N 参数（默认0）调整N次Full GC之后再整理。</p>
<p>2.、无法处理在并发清理过程中产生的“浮动垃圾”，不能做到完全的垃圾回收。</p>
<p>3、如果老年代内存不足无法分配对象，CMS就会退化成Serial Old单线程回收老年代。</p>
<p>4、并发阶段会影响用户线程执行的性能</p>
<h3 id="G1-–-Garbage-First-垃圾回收器">G1 – Garbage First 垃圾回收器</h3>
<p>参数1： -XX:+UseG1GC 打开G1的开关，JDK9之后默认不需要打开</p>
<p>参数2：-XX:MaxGCPauseMillis=毫秒值</p>
<p>最大暂停的时间</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1211.png" alt="img"></p>
<p><strong>回收年代和算法</strong></p>
<ul>
<li>年轻代+老年代</li>
<li>复制算法</li>
</ul>
<p><strong>优点</strong></p>
<p>对比较大的堆如超过6G的堆回收时，延迟可控</p>
<p>不会产生内存碎片</p>
<p>并发标记的SATB算法效率高</p>
<p><strong>缺点</strong></p>
<p>JDK8之前还不够成熟</p>
<p><strong>适用场景</strong></p>
<p>JDK8最新版本、JDK9之后建议默认使用</p>
<h3 id="什么是Shenandoah？">什么是Shenandoah？</h3>
<p>Shenandoah 是由Red Hat开发的一款低延迟的垃圾收集器，Shenandoah 并发执行大部分 GC 工作，包括并发的整理，堆大小对STW的时间基本没有影响。</p>
<h3 id="什么是ZGC？">什么是ZGC？</h3>
<p>ZGC 是一种可扩展的低延迟垃圾回收器。ZGC 在垃圾回收过程中，STW的时间不会超过一毫秒，适合需要低延迟的应用。支持几百兆到16TB 的堆大小，堆大小对STW的时间基本没有影响。</p>
<h3 id="垃圾回收器的技术演进">垃圾回收器的技术演进</h3>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1212-1024x497.png" alt="img"></p>
<h3 id="总结：-8">总结：</h3>
<p>垃圾回收器的组合关系虽然很多，但是针对几个特定的版本，比较好的组合选择如下：</p>
<p>JDK8及之前：</p>
<p>ParNew + CMS（关注暂停时间）、Parallel Scavenge + Parallel Old (关注吞吐量)、 G1（JDK8之前不建议，较大堆并且关注暂停时间）</p>
<p>JDK9之后:</p>
<p>G1（默认）</p>
<p>从JDK9之后，由于G1日趋成熟，JDK默认的垃圾回收器已经修改为G1，所以强烈建议在生产环境上使用G1。</p>
<p>如果对低延迟有较高的要求，可以使用Shenandoah或者ZGC。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1213.png" alt="img"></p>
<p><strong>对比一下 G1、Shenandoah 和 ZGC 这三款垃圾回收器</strong></p>
<p>G1、Shenandoah 和 ZGC 都是现代 Java 的低延迟 GC 回收器。G1 将堆划分为 Region，通过并发标记和 STW 压缩来减少 full GC，适合通用场景；Shenandoah 实现了并发压缩，通过转发表解决引用更新问题，可将 GC 停顿控制在毫秒级；ZGC 采用 colored pointer 技术，实现了全并发、几乎全程无停顿的 GC，停顿时间低于 1ms，适用于延迟极敏感的大型系统。</p>
<table>
<thead>
<tr>
<th>回收器</th>
<th>一句话记住它</th>
</tr>
</thead>
<tbody>
<tr>
<td>G1 GC</td>
<td><strong>区域化管理，目标是均衡停顿和吞吐</strong></td>
</tr>
<tr>
<td>Shenandoah</td>
<td><strong>并发压缩，目标是最小停顿（MS 级）</strong></td>
</tr>
<tr>
<td>ZGC</td>
<td><strong>染色指针，全并发回收，目标是亚毫秒级停顿</strong></td>
</tr>
</tbody>
</table>
<h2 id="17-如何解决内存泄漏问题？">17.如何解决内存泄漏问题？</h2>
<ul>
<li>关联课程内容
<ul>
<li>实战篇-内存泄漏和内存溢出</li>
<li>…</li>
<li>实战篇-btrace和arthas在线定位问题</li>
</ul>
</li>
</ul>
<p>回答路径</p>
<ul>
<li>内存泄漏和内存溢出</li>
<li>解决内存泄漏问题的思路</li>
<li>常用的工具</li>
</ul>
<p>内存泄漏（memory leak）：在Java中如果不再使用一个对象，但是该对象依然在GC ROOT的引用链上，这个对象就不会被垃圾回收器回收，这种情况就称之为内存泄漏。</p>
<p>少量的内存泄漏可以容忍，但是如果发生持续的内存泄漏，就像滚雪球雪球越滚越大，不管有多大的内存迟早会被消耗完，最终导致的结果就是内存溢出。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1214.png" alt="img"></p>
<p>解决内存泄漏问题总共分为四个步骤，其中前两个步骤是最核心的：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1215.png" alt="img"></p>
<h3 id="发现问题-–-堆内存状况的对比">发现问题 – 堆内存状况的对比</h3>
<p><strong>正常情况</strong></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1216.png" alt="img"></p>
<ul>
<li>处理业务时会出现上下起伏，业务对象频繁创建内存会升高，触发MinorGC之后内存会降下来。</li>
<li>手动执行FULL GC之后，内存大小会骤降，而且每次降完之后的大小是接近的。</li>
<li>长时间观察内存曲线应该是在一个范围内。</li>
</ul>
<p><strong>出现内存泄漏</strong></p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1217.png" alt="img"></p>
<ul>
<li>处于持续增长的情况，即使Minor GC也不能把大部分对象回收</li>
<li>手动FULL GC之后的内存量每一次都在增长</li>
<li>长时间观察内存曲线持续增长</li>
</ul>
<p>生产环境通过运维提供的Prometheus + Grafana等监控平台查看</p>
<p>开发、测试环境通过visualvm查看</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> q7oom;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-Xmx10m -verbose:gc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OOMDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">_1MB</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        List&lt;Object&gt; objects = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[_1MB];</span><br><span class="line">            <span class="comment">//强引用</span></span><br><span class="line">            objects.add(bytes);</span><br><span class="line">            Thread.sleep(<span class="number">50</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码执行之后，使用visualvm查看结果：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1218-1024x584.png" alt="img"></p>
<p>处于持续增长的情况，手动FULL GC之后的内存量每一次都在增长，长时间观察内存曲线持续增长。属于内存泄漏的情况。</p>
<h3 id="诊断-–-生成内存快照">诊断 – 生成内存快照</h3>
<p>当堆内存溢出时，需要在堆内存溢出时将整个堆内存保存下来，生成内存快照(Heap Profile )文件。</p>
<p>生成方式有两种</p>
<p>1、内存溢出时自动生成，添加生成内存快照的Java虚拟机参数：</p>
<p>-XX:+HeapDumpOnOutOfMemoryError：发生OutOfMemoryError错误时，自动生成hprof内存快照文件。</p>
<p>-XX:HeapDumpPath=<path>：指定hprof文件的输出路径。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1219.png" alt="img"></p>
<p>发生oom之后，就会生成内存快照文件：</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1220.png" alt="img"></p>
<p>2、导出运行中系统的内存快照，比较简单的方式有两种，注意只需要导出标记为存活的对象：</p>
<p>通过JDK自带的jmap命令导出，格式为：</p>
<p>jmap -dump:live,format=b,file=文件路径和文件名 进程ID</p>
<p>通过arthas的heapdump命令导出，格式为：</p>
<p>heapdump --live 文件路径和文件名</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1221.png" alt="img"></p>
<h3 id="诊断-–-MAT定位问题">诊断 – MAT定位问题</h3>
<p>使用MAT打开hprof文件，并选择内存泄漏检测功能，MAT会自行根据内存快照中保存的数据分析内存泄漏的根源。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1222.png" alt="img"></p>
<h3 id="修复问题">修复问题</h3>
<p>修复内存溢出问题的要具体问题具体分析，问题总共可以分成三类：</p>
<ul>
<li>代码中的内存泄漏，由于代码的不合理写法存在隐患，导致内存泄漏</li>
<li>并发引起内存溢出 - 参数不当,由于参数设置不当，比如堆内存设置过小，导致并发量增加之后超过堆内存的上限。解决方案：设置合理参数</li>
<li>并发引起内存溢出 – 设计不当，系统的方案设计不当，比如：
<ul>
<li>从数据库获取超大数据量的数据</li>
<li>线程池设计不当</li>
<li>生产者-消费者模型，消费者消费性能问题</li>
</ul>
</li>
</ul>
<p>解决方案：优化设计方案</p>
<h3 id="常用的JVM工具">常用的JVM工具</h3>
<p>JDK自带的命令行工具：</p>
<p>jps 查看java进程，打印main方法所在类名和进程id</p>
<p>jmap 1、生成堆内存快照</p>
<p>2、打印类的直方图</p>
<p>第三方工具：</p>
<p>VisualVM 监控</p>
<p>Arthas 综合性工具</p>
<p>MAT 堆内存分析工具</p>
<p>监控工具：</p>
<p>Prometheus + grafana</p>
<h3 id="总结：-9">总结：</h3>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1227-1007x1024.png" alt="img"></p>
<h2 id="18-常见的JVM参数？">18.常见的JVM参数？</h2>
<ul>
<li>
<p>关联课程内容</p>
<ul>
<li>实战篇-基础JVM参数的设置</li>
<li>实战篇-垃圾回收器的选择</li>
<li>实战篇-垃圾回收参数调优</li>
</ul>
</li>
<li>
<p>回答路径</p>
<ul>
<li>最大堆内存参数</li>
<li>最大栈内存参数</li>
<li>最大元空间内存参数</li>
<li>日志参数</li>
<li>堆内存快照参数</li>
<li>垃圾回收器参数</li>
<li>垃圾回收器调优参数</li>
</ul>
</li>
</ul>
<h3 id="参数1-：-Xmx-和-–Xms">参数1 ： -Xmx 和 –Xms</h3>
<p>-Xmx参数设置的是最大堆内存，但是由于程序是运行在服务器或者容器上，计算可用内存时，要将元空间、操作系统、其它软件占用的内存排除掉。</p>
<p>案例： 服务器内存4G，操作系统+元空间最大值+其它软件占用1.5G，-Xmx可以设置为2g。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1223.png" alt="img"></p>
<p>最合理的设置方式应该是根据最大并发量估算服务器的配置，然后再根据服务器配置计算最大堆内存的值。</p>
<p>建议将-Xms设置的和-Xmx一样大,运行过程中不再产生扩容的开销。</p>
<h3 id="参数2-：-XX-MaxMetaspaceSize-和-Xss">参数2 ： -XX:MaxMetaspaceSize 和 -Xss</h3>
<p>-XX:MaxMetaspaceSize=值 参数指的是最大元空间大小，默认值比较大，如果出现元空间内存泄漏会让操作系统可用内存不可控，建议根据测试情况设置最大值，一般设置为256m。</p>
<p>-Xss256k 栈内存大小，如果我们不指定栈的大小，JVM 将创建一个具有默认大小的栈。大小取决于操作系统和计算机的体系结构。比如Linux x86 64位 ： 1MB，如果不需要用到这么大的栈内存，完全可以将此值调小节省内存空间，合理值为256k – 1m之间。</p>
<h3 id="参数3：-Xmn-年轻代的大小">参数3：-Xmn 年轻代的大小</h3>
<p>默认值为整个堆的1/3，可以根据峰值流量计算最大的年轻代大小，尽量让对象只存放在年轻代，不进入老年代。但是实际的场景中，接口的响应时间、创建对象的大小、程序内部还会有一些定时任务等不确定因素都会导致这个值的大小并不能仅凭计算得出，如果设置该值要进行大量的测试。G1垃圾回收器尽量不要设置该值，G1会动态调整年轻代的大小。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1224.png" alt="img"></p>
<h3 id="打印GC日志">打印GC日志</h3>
<p>JDK8及之前 ： -XX:+PrintGCDetails -XX:+PrintGCDateStamps -Xloggc:文件路径</p>
<p>JDK9及之后 ： -Xlog:gc*:file=文件路径</p>
<p>-XX:+DisableExplicitGC</p>
<p>禁止在代码中使用System.gc()， System.gc()可能会引起FULLGC，在代码中尽量不要使用。使用DisableExplicitGC参数可以禁止使用System.gc()方法调用。</p>
<p>-XX:+HeapDumpOnOutOfMemoryError：发生OutOfMemoryError错误时，自动生成hprof内存快照文件。</p>
<p>-XX:HeapDumpPath=<path>：指定hprof文件的输出路径。</p>
<h3 id="JVM参数模板：">JVM参数模板：</h3>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-<span class="title class_">Xms1g</span>-<span class="title class_">Xmx1g</span>-<span class="title class_">Xss256k</span></span><br><span class="line">-<span class="variable constant_">XX</span><span class="symbol">:MaxMetaspaceSize=</span>512m </span><br><span class="line">-<span class="variable constant_">XX</span><span class="symbol">:+DisableExplicitGC</span></span><br><span class="line">-<span class="variable constant_">XX</span><span class="symbol">:+HeapDumpOnOutOfMemoryError</span></span><br><span class="line">-<span class="variable constant_">XX</span><span class="symbol">:HeapDumpPath=/opt/dumps/my-service</span>.hprof</span><br><span class="line">-<span class="variable constant_">XX</span><span class="symbol">:+PrintGCDetails</span> </span><br><span class="line">-<span class="variable constant_">XX</span><span class="symbol">:+PrintGCDateStamps</span> </span><br><span class="line">-<span class="title class_">Xloggc</span><span class="symbol">:</span>文件路径</span><br></pre></td></tr></table></figure>
<p>注意：</p>
<p>JDK9及之后gc日志输出修改为 -Xlog:gc*:file=文件名</p>
<p>堆内存大小和栈内存大小根据实际情况灵活调整。</p>
<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/07/image-1225.png" alt="img"></p>
<h3 id="总结：-10">总结：</h3>
<p><strong>面试官：</strong> “你能说说常见的JVM参数吗？”</p>
<p><strong>你：</strong><br>
“当然！JVM 参数在优化 Java 应用的性能时非常重要，常见的有以下几种：</p>
<ol>
<li>
<p>-Xmx 和 -Xms</p>
<p>：</p>
<ul>
<li><code>-Xmx</code> 设置的是 <strong>最大堆内存</strong>，表示 JVM 可以使用的最大内存，通常根据系统总内存来设置。</li>
<li><code>-Xms</code> 设置的是 <strong>初始堆内存</strong>，它决定了 JVM 启动时的堆内存大小。为了避免堆内存在运行时频繁扩容，建议将 <code>-Xms</code> 和 <code>-Xmx</code> 设置为相同的值。</li>
</ul>
</li>
<li>
<p>-XX:MaxMetaspaceSize 和 -Xss</p>
<p>：</p>
<ul>
<li><code>-XX:MaxMetaspaceSize</code> 设置 <strong>元空间</strong> 的最大大小，默认值比较大。如果元空间泄漏，会影响系统的可用内存，通常可以根据实际需求设置为 256MB。</li>
<li><code>-Xss</code> 设置每个线程的 <strong>栈内存大小</strong>，例如 <code>-Xss256k</code>，可以通过调整栈内存来节省内存空间，尤其是在创建大量线程时。</li>
</ul>
</li>
<li>
<p>-Xmn</p>
<p>：</p>
<ul>
<li><code>-Xmn</code> 设置的是 <strong>年轻代的大小</strong>，默认是整个堆的三分之一。合理设置年轻代的大小可以帮助对象更快被回收，从而减少 GC 压力。对于 G1 垃圾回收器来说，这个值一般不需要手动调整，因为 G1 会动态调整年轻代大小。</li>
</ul>
</li>
<li>
<p>打印GC日志</p>
<p>：</p>
<ul>
<li>在 <strong>JDK 8 及之前版本</strong>，可以使用：<br>
<code>-XX:+PrintGCDetails -XX:+PrintGCDateStamps -Xloggc:文件路径</code></li>
<li>在 <strong>JDK 9 及之后版本</strong>，推荐使用：<br>
<code>-Xlog:gc*:file=文件路径</code></li>
<li>这些参数可以帮助我们记录和分析垃圾回收的情况，从而优化内存管理。</li>
</ul>
</li>
<li>
<p>-XX:+DisableExplicitGC</p>
<p>：</p>
<ul>
<li>该参数可以禁止 <code>System.gc()</code> 的显式调用，因为 <code>System.gc()</code> 会强制执行 Full GC，这对性能有很大影响。</li>
</ul>
</li>
<li>
<p>-XX:+HeapDumpOnOutOfMemoryError 和 -XX:HeapDumpPath</p>
<p>：</p>
<ul>
<li><code>-XX:+HeapDumpOnOutOfMemoryError</code> 参数在发生 <strong>OutOfMemoryError</strong> 时，自动生成堆内存快照文件，方便我们后续的分析。</li>
<li><code>-XX:HeapDumpPath</code> 则指定生成堆快照的存储路径。</li>
</ul>
</li>
</ol>
<h1 id="面试篇完结">面试篇完结</h1>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>JVM面试篇</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://itgeqian.github.io/posts/26.html">https://itgeqian.github.io/posts/26.html</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>作者</h><div class="post-copyright-cc-info"><h>geqian's Blog🍭</h></div></div><div class="post-copyright-c"><h>发布于</h><div class="post-copyright-cc-info"><h>2025-07-29</h></div></div><div class="post-copyright-u"><h>更新于</h><div class="post-copyright-cc-info"><h>2025-07-30</h></div></div><div class="post-copyright-c"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/JVM/"><div class="tags-punctuation"><svg class="faa-tada icon" style="height:1.1em;width:1.1em;fill:currentColor;position:relative;top:2px;margin-right:3px" aria-hidden="true"><use xlink:href="#icon-sekuaibiaoqian"></use></svg></div>JVM</a></div></div><link rel="stylesheet" href="/css/coin.css" media="defer" onload="this.media='all'"/><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">投喂作者</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://java-geqian.oss-cn-beijing.aliyuncs.com/%E5%BE%AE%E4%BF%A1PAY.jpg" target="_blank"><img class="post-qr-code-img" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/%E5%BE%AE%E4%BF%A1PAY.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://java-geqian.oss-cn-beijing.aliyuncs.com/%E6%94%AF%E4%BB%98%E5%AE%9DPAY.jpg" target="_blank"><img class="post-qr-code-img" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/%E6%94%AF%E4%BB%98%E5%AE%9DPAY.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></button></div><audio id="coinAudio" src="https://npm.elemecdn.com/akilar-candyassets@1.0.36/audio/aowu.m4a"></audio><script defer="defer" src="/js/coin.js"></script><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/28.html"><img class="prev-cover" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/47.jpg" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">JUC并发编程中篇</div></div></a></div><div class="next-post pull-right"><a href="/posts/25.html"><img class="next-cover" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/54.jpg" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">JVM原理篇</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/71.html" title="JVM面试题"><img class="cover" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/21.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-10-20</div><div class="title">JVM面试题</div></div></a></div><div><a href="/posts/24.html" title="JVM高级篇"><img class="cover" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/51.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-07-28</div><div class="title">JVM高级篇</div></div></a></div><div><a href="/posts/25.html" title="JVM原理篇"><img class="cover" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/54.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-07-30</div><div class="title">JVM原理篇</div></div></a></div><div><a href="/posts/8.html" title="JVM基础篇"><img class="cover" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/52.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-06-18</div><div class="title">JVM基础篇</div></div></a></div><div><a href="/posts/23.html" title="JVM实战篇"><img class="cover" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/49.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2025-07-25</div><div class="title">JVM实战篇</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><svg class="meta_icon" style="width:22px;height:22px;position:relative;top:5px"><use xlink:href="#icon-mulu1"></use></svg><span style="font-weight:bold">目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E7%AF%87"><span class="toc-text">面试篇</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AFJVM%EF%BC%9F"><span class="toc-text">1.什么是JVM？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%AE%9A%E4%B9%89%EF%BC%9A"><span class="toc-text">1、定义：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E4%BD%9C%E7%94%A8%EF%BC%9A"><span class="toc-text">2、作用：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%8A%9F%E8%83%BD"><span class="toc-text">3、功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E7%BB%84%E6%88%90"><span class="toc-text">4、组成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E5%B8%B8%E8%A7%81%E7%9A%84JVM"><span class="toc-text">5、常见的JVM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BA%86%E8%A7%A3%E8%BF%87%E5%AD%97%E8%8A%82%E7%A0%81%E6%96%87%E4%BB%B6%E7%9A%84%E7%BB%84%E6%88%90%E5%90%97%EF%BC%9F"><span class="toc-text">2.了解过字节码文件的组成吗？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF"><span class="toc-text">1、基本信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%B8%B8%E9%87%8F%E6%B1%A0"><span class="toc-text">2、常量池</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%AD%97%E6%AE%B5"><span class="toc-text">3、字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%96%B9%E6%B3%95"><span class="toc-text">4、方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E5%B1%9E%E6%80%A7"><span class="toc-text">5、属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="toc-text">总结：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%AF%B4%E4%B8%80%E4%B8%8B%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA"><span class="toc-text">3.说一下运行时数据区</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="toc-text">程序计数器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%88-Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88"><span class="toc-text">栈 - Java虚拟机栈</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E6%A0%88"><span class="toc-text">本地方法栈</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86"><span class="toc-text">堆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%8C%BA"><span class="toc-text">方法区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98"><span class="toc-text">直接内存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-2"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%93%AA%E4%BA%9B%E5%8C%BA%E5%9F%9F%E4%BC%9A%E5%87%BA%E7%8E%B0%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%EF%BC%8C%E4%BC%9A%E6%9C%89%E4%BB%80%E4%B9%88%E7%8E%B0%E8%B1%A1%EF%BC%9F"><span class="toc-text">4.哪些区域会出现内存溢出，会有什么现象？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%EF%BC%9A"><span class="toc-text">堆内存溢出：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%88%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%EF%BC%9A"><span class="toc-text">栈内存溢出：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%8C%BA%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%EF%BC%9A"><span class="toc-text">方法区内存溢出：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%EF%BC%9A"><span class="toc-text">直接内存溢出：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A-2"><span class="toc-text">总结：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-JVM%E5%9C%A8JDK6-8%E4%B9%8B%E9%97%B4%E5%9C%A8%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F%E4%B8%8A%E6%9C%89%E4%BB%80%E4%B9%88%E4%B8%8D%E5%90%8C"><span class="toc-text">5.JVM在JDK6-8之间在内存区域上有什么不同</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%8C%BA%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-text">方法区的实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B8%B8%E9%87%8F%E6%B1%A0%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="toc-text">字符串常量池的位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-3"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E7%B1%BB%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-text">6.类的生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E9%98%B6%E6%AE%B5"><span class="toc-text">加载阶段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E9%98%B6%E6%AE%B5"><span class="toc-text">连接阶段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%98%B6%E6%AE%B5"><span class="toc-text">初始化阶段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%B8%E8%BD%BD%E9%98%B6%E6%AE%B5"><span class="toc-text">卸载阶段</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E4%BB%80%E4%B9%88%E6%98%AF%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%EF%BC%9F"><span class="toc-text">7.什么是类加载器？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-text">启动类加载器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-text">扩展类加载器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-text">应用程序类加载器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-text">自定义类加载器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A-3"><span class="toc-text">总结：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E4%BB%80%E4%B9%88%E6%98%AF%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%9C%BA%E5%88%B6"><span class="toc-text">8.什么是双亲委派机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%9C%BA%E5%88%B6%E6%9C%89%E4%BB%80%E4%B9%88%E7%94%A8%EF%BC%9F"><span class="toc-text">双亲委派机制有什么用？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-4"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E5%A6%82%E4%BD%95%E6%89%93%E7%A0%B4%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%9C%BA%E5%88%B6"><span class="toc-text">9.如何打破双亲委派机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%88%E4%BA%86%E8%A7%A3%E4%B8%8B%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%9C%BA%E5%88%B6%E7%9A%84%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="toc-text">先了解下双亲委派机制的原理：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-5"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E5%BB%BA%E8%AE%AE%E6%89%93%E7%A0%B4%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%9C%BA%E5%88%B6%EF%BC%9F%EF%BC%88%E6%89%A9%E5%B1%95%EF%BC%89"><span class="toc-text">10.为什么不建议打破双亲委派机制？（扩展）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-Tomcat%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-text">11.Tomcat的自定义类加载器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%EF%BC%9A"><span class="toc-text">环境搭建：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#common%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-text">common类加载器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#catalina%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-text">catalina类加载器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shared%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-text">shared类加载器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ParallelWebappClassLoader%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-text">ParallelWebappClassLoader类加载器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JasperLoader%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-text">JasperLoader类加载器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A-4"><span class="toc-text">总结：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E5%A0%86%E4%B8%8A%E7%9A%84%E5%AF%B9%E8%B1%A1%E6%B2%A1%E6%9C%89%E8%A2%AB%E5%BC%95%E7%94%A8%EF%BC%9F%EF%BC%9F"><span class="toc-text">12.如何判断堆上的对象没有被引用？？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0%E6%B3%95"><span class="toc-text">引用计数法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E8%BE%BE%E6%80%A7%E5%88%86%E6%9E%90%E6%B3%95"><span class="toc-text">可达性分析法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A-5"><span class="toc-text">总结：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-JVM-%E4%B8%AD%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B%EF%BC%9F"><span class="toc-text">13. JVM 中都有哪些引用类型？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%BA%E5%BC%95%E7%94%A8"><span class="toc-text">强引用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%AF%E5%BC%95%E7%94%A8"><span class="toc-text">软引用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%B1%E5%BC%95%E7%94%A8"><span class="toc-text">弱引用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%99%9A%E5%BC%95%E7%94%A8"><span class="toc-text">虚引用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%88%E7%BB%93%E5%99%A8%E5%BC%95%E7%94%A8"><span class="toc-text">终结器引用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-6"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-ThreadLocal%E4%B8%AD%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8%E5%BC%B1%E5%BC%95%E7%94%A8%EF%BC%9F"><span class="toc-text">14.ThreadLocal中为什么要使用弱引用？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ThreadLocal%E7%9A%84%E5%BA%95%E5%B1%82%E7%BB%93%E6%9E%84"><span class="toc-text">ThreadLocal的底层结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A-6"><span class="toc-text">总结：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-%E6%9C%89%E5%93%AA%E4%BA%9B%E5%B8%B8%E8%A7%81%E7%9A%84%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AE%97%E6%B3%95"><span class="toc-text">15.有哪些常见的垃圾回收算法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E8%AE%B0%E6%B8%85%E9%99%A4%E7%AE%97%E6%B3%95"><span class="toc-text">标记清除算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E5%88%B6%E7%AE%97%E6%B3%95"><span class="toc-text">复制算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E8%AE%B0%E6%95%B4%E7%90%86%E7%AE%97%E6%B3%95"><span class="toc-text">标记整理算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E4%BB%A3%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AE%97%E6%B3%95"><span class="toc-text">分代垃圾回收算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A-7"><span class="toc-text">总结：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-%E6%9C%89%E5%93%AA%E4%BA%9B%E5%B8%B8%E7%94%A8%E7%9A%84%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%EF%BC%9F"><span class="toc-text">16.有哪些常用的垃圾回收器？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Serial%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8-SerialOld%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8"><span class="toc-text">Serial垃圾回收器 + SerialOld垃圾回收器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Parallel-Scavenge%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8-Parallel-Old%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8"><span class="toc-text">Parallel Scavenge垃圾回收器 + Parallel Old垃圾回收器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ParNew%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8-CMS%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8"><span class="toc-text">ParNew垃圾回收器 +CMS垃圾回收器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#G1-%E2%80%93-Garbage-First-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8"><span class="toc-text">G1 – Garbage First 垃圾回收器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFShenandoah%EF%BC%9F"><span class="toc-text">什么是Shenandoah？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFZGC%EF%BC%9F"><span class="toc-text">什么是ZGC？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E7%9A%84%E6%8A%80%E6%9C%AF%E6%BC%94%E8%BF%9B"><span class="toc-text">垃圾回收器的技术演进</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A-8"><span class="toc-text">总结：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="toc-text">17.如何解决内存泄漏问题？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E7%8E%B0%E9%97%AE%E9%A2%98-%E2%80%93-%E5%A0%86%E5%86%85%E5%AD%98%E7%8A%B6%E5%86%B5%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-text">发现问题 – 堆内存状况的对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%8A%E6%96%AD-%E2%80%93-%E7%94%9F%E6%88%90%E5%86%85%E5%AD%98%E5%BF%AB%E7%85%A7"><span class="toc-text">诊断 – 生成内存快照</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%8A%E6%96%AD-%E2%80%93-MAT%E5%AE%9A%E4%BD%8D%E9%97%AE%E9%A2%98"><span class="toc-text">诊断 – MAT定位问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E9%97%AE%E9%A2%98"><span class="toc-text">修复问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84JVM%E5%B7%A5%E5%85%B7"><span class="toc-text">常用的JVM工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A-9"><span class="toc-text">总结：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-%E5%B8%B8%E8%A7%81%E7%9A%84JVM%E5%8F%82%E6%95%B0%EF%BC%9F"><span class="toc-text">18.常见的JVM参数？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B01-%EF%BC%9A-Xmx-%E5%92%8C-%E2%80%93Xms"><span class="toc-text">参数1 ： -Xmx 和 –Xms</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B02-%EF%BC%9A-XX-MaxMetaspaceSize-%E5%92%8C-Xss"><span class="toc-text">参数2 ： -XX:MaxMetaspaceSize 和 -Xss</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B03%EF%BC%9A-Xmn-%E5%B9%B4%E8%BD%BB%E4%BB%A3%E7%9A%84%E5%A4%A7%E5%B0%8F"><span class="toc-text">参数3：-Xmn 年轻代的大小</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%8D%B0GC%E6%97%A5%E5%BF%97"><span class="toc-text">打印GC日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JVM%E5%8F%82%E6%95%B0%E6%A8%A1%E6%9D%BF%EF%BC%9A"><span class="toc-text">JVM参数模板：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A-10"><span class="toc-text">总结：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E7%AF%87%E5%AE%8C%E7%BB%93"><span class="toc-text">面试篇完结</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background-color: transparent;"><div id="footer-wrap"><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">格言🧬</p><div class="bg-ad"><div>再看看那个光点，它就在这里，这是家园，这是我们 —— 你所爱的每一个人，你认识的一个人，你听说过的每一个人，曾经有过的每一个人，都在它上面度过他们的一生✨</div><div class="btn-xz-box"><a class="btn-xz" target="_blank" rel="noopener" href="https://stellarium.org/">点击开启星辰之旅</a></div></div></div><div class="t-t-r"><p class="ft-t t-l-t">猜你想看💡</p><ul class="ft-links"><li><a href="/comments/">留点什么</a><a href="/archives/">文章归档</a></li><li><a href="/categories/">文章分类</a><a href="/tags/">文章标签</a></li><li><a href="/box/Gallery/">我的画廊</a><a href="/personal/bb/">我的唠叨</a></li><li><a href="/site/time/">建设进程</a><a href="/site/census/">网站统计</a></li></ul></div></div></div><div class="ft-item-2"><p class="ft-t">推荐友链⌛</p><div class="ft-img-group"><div class="img-group-item"></div></div></div></div><div class="copyright"><span><b>&copy;2022-2025</b></span><span><b>&nbsp;&nbsp;By geqian's Blog🍭</b></span></div><div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://icp.gov.moe/?keyword=20230913" style="margin-inline:5px" title="本站已加入萌ICP豪华套餐，萌ICP备20230913号"><img src="https://u7imgblog.oss-cn-hangzhou.aliyuncs.com/blogbackground/20230913.svg" alt=""/></a></p></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><a class="icon-V hidden" onclick="switchNightMode()" title="浅色和深色模式转换"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button class="share" type="button" title="右键模式" onclick="changeMouseMode()"><i class="fas fa-mouse"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog right_side"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button class="share" type="button" title="分享链接" onclick="share()"><i class="fas fa-share-nodes"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i><span id="percent">0<span>%</span></span></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();"><i class="fa fa-arrow-up"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa fa-copy"></i><span>复制</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();"><i class="fa fa-search"></i><span>百度搜索</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();"><i class="fa fa-link"></i><span>转到链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()"><i class="fa fa-copy"></i><span>粘贴</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="#post-comment"><i class="fas fa-comment"></i><span>空降评论</span></a><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()"><i class="fa fa-link"></i><span>复制本文地址</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>新窗口打开</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()"><i class="fa fa-link"></i><span>转到链接</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()"><i class="fa fa-download"></i><span>保存图片</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>在新窗口打开</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制图片链接</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:randomPost()"><i class="fa fa-paper-plane"></i><span>随便逛逛</span></a><a class="rightMenu-item" href="javascript:switchNightMode();"><i class="fa fa-moon"></i><span>昼夜切换</span></a><a class="rightMenu-item" href="/personal/about/"><i class="fa fa-info-circle"></i><span>关于博客</span></a><a class="rightMenu-item" href="javascript:toggleWinbox();"><i class="fas fa-cog"></i><span>美化设置</span></a><a class="rightMenu-item" href="javascript:rmf.fullScreen();"><i class="fas fa-expand"></i><span>切换全屏</span></a><a class="rightMenu-item" href="javascript:window.print();"><i class="fa-solid fa-print"></i><span>打印页面</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><script async="async">var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())
setTimeout(function(){preloader.endLoading();}, 5000);
document.getElementById('loading-box').addEventListener('click',()=> {preloader.endLoading()})</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: '',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: '',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.staticfile.org/twikoo/1.6.8/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script async src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><script async src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script><script defer type="text/javascript" src="https://cdn1.tianli0.top/npm/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script defer src="https://cdn1.tianli0.top/gh/nextapps-de/winbox/dist/winbox.bundle.min.js"></script><script async src="//at.alicdn.com/t/c/font_3586335_hsivh70x0fm.js"></script><script async src="//at.alicdn.com/t/c/font_3636804_gr02jmjr3y9.js"></script><script async src="//at.alicdn.com/t/c/font_3612150_kfv55xn3u2g.js"></script><script async src="https://cdn.wpon.cn/2022-sucai/Gold-ingot.js"></script><canvas id="universe"></canvas><canvas id="snow"></canvas><script defer src="/js/fomal.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn1.tianli0.top/npm/js-heo@1.0.12/metingjs/Meting.min.js"></script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax","#bibi","body > title","#app","#tag-echarts","#posts-echart","#categories-echarts"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/学习笔记/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍡 geqianの学习笔记 (10)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/杂项/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍼 geqianの杂项 (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/项目/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍉 geqianの项目笔记 (6)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/AI/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍨 geqianのAI大模型 (6)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/算法/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍟 geqianの算法学习笔记 (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/面试/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍥 geqianの面试 (20)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/JUC/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🌏 geqianのJUC (4)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/JVM/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍜 geqianのJVM (5)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/云原生/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🔐 geqianの云原生相关 (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/MQ/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📱 geqianの消息队列 (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/前端/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🏛️ geqianの前端工程 (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/mybatis-mybatis-plus/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🎨 geqianのmybatis系列 (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/微服务/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🗺️ geqianのSpringCloud系列 (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/SSM/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📖 geqianのSSM+SpringBoot系列 (7)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/ruoyi/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📞 geqianの若依框架 (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/mysql/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">❓ geqianのmysql (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://itgeqian.github.io/categories/Redis/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">💖 geqianのRedis (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item" style="visibility: hidden"></div><a class="magnet_link_more"  href="https://itgeqian.github.io/categories/" style="flex:1;text-align: center;margin-bottom: 10px;">查看更多...</a></div></div>';
    console.log('已挂载magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(33.333333333333336% - 5px);background: #e9e9e9;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: var(--text-bg-hover)}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/71.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/21.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-10-07</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/71.html&quot;);" href="javascript:void(0);" alt="">JVM面试题</a><div class="blog-slider__text">我对JVM的相关理解</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/71.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/60.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/%E5%8F%A4%E9%A3%8E.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-09-30</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/60.html&quot;);" href="javascript:void(0);" alt="">速通Spring AI Alibaba </a><div class="blog-slider__text">速通Spring AI Alibaba 完结</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/60.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/37.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/27.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-04-02</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/37.html&quot;);" href="javascript:void(0);" alt="">GQ Video单服务版本记录</a><div class="blog-slider__text">GQ Video单服务版本记录（完整记录GQ Video从0到1的全记录）</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/37.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/74.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/35.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-09-06</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/74.html&quot;);" href="javascript:void(0);" alt="">Mysql相关面试题</a><div class="blog-slider__text">我对mysql的相关理解</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/74.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/77.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/31.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-10-07</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/77.html&quot;);" href="javascript:void(0);" alt="">javase+集合相关面试题</a><div class="blog-slider__text">我对java基础和集合类的相关理解</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/77.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/68.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="https://java-geqian.oss-cn-beijing.aliyuncs.com/geqian-Blos/22.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-10-01</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/68.html&quot;);" href="javascript:void(0);" alt="">JUC面试题</a><div class="blog-slider__text">我对JUC的理解</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/68.html&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper@1.0.12/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper@1.0.12/lib/swiper_init.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementById('gitZone');
      var item_html = '<div class="recent-post-item" id="gitcalendarBar" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 320px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('已挂载gitcalendar')
      }

    if( document.getElementById('gitZone') && (location.pathname ==='/site/census/'|| '/site/census/' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("/api?null",['#d9e0df', '#c6e0dc', '#a8dcd4', '#9adcd2', '#89ded1', '#77e0d0', '#5fdecb', '#47dcc6', '#39dcc3', '#1fdabe', '#00dab9'],'null')
    }
  </script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>