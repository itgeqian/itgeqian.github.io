<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>geqian&#39;s BlogğŸ­</title>
  
  
  <link href="https://itgeqian.github.io/atom.xml" rel="self"/>
  
  <link href="https://itgeqian.github.io/"/>
  <updated>2025-10-06T14:00:00.000Z</updated>
  <id>https://itgeqian.github.io/</id>
  
  <author>
    <name>geqian&#39;s BlogğŸ­</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>GQ Videoé¡¹ç›®éƒ¨ç½²</title>
    <link href="https://itgeqian.github.io/posts/2.html"/>
    <id>https://itgeqian.github.io/posts/2.html</id>
    <published>2025-10-06T10:19:03.000Z</published>
    <updated>2025-10-06T14:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<table><thead><tr><th>æœåŠ¡åç§°</th><th>è‹±æ–‡å</th><th>ç«¯å£å·</th><th>ç‰ˆæœ¬å·</th><th>æœåŠ¡ç±»åˆ«</th></tr></thead><tbody><tr><td>æ•°æ®åº“</td><td>mysql</td><td>3306</td><td>v8.26</td><td>ç¯å¢ƒä¾èµ–</td></tr><tr><td>æœç´¢å¼•æ“</td><td>es</td><td>9201</td><td>3.1.9</td><td>ç¯å¢ƒä¾èµ–</td></tr><tr><td>ç¼“å­˜</td><td>Redis</td><td>6379</td><td>v8</td><td>ç¯å¢ƒä¾èµ–</td></tr><tr><td>æ¶ˆæ¯é˜Ÿåˆ—</td><td>RocketMQ</td><td></td><td>2.3.0</td><td>ç¯å¢ƒä¾èµ–</td></tr><tr><td>æ³¨å†Œä¸­å¿ƒ</td><td>nacos</td><td>8848</td><td>v2.2.0</td><td>ç¯å¢ƒä¾èµ–</td></tr><tr><td>ç½‘å…³æœåŠ¡</td><td>easylive-cloud-gateway</td><td>7071</td><td>java8</td><td>é¡¹ç›®</td></tr><tr><td>åˆ†å¸ƒå¼äº‹åŠ¡</td><td>Seata</td><td>7091</td><td>2021.0.5.0</td><td>ç¯å¢ƒä¾èµ–</td></tr><tr><td>å¯¹è±¡å­˜å‚¨</td><td>Minio</td><td>9000</td><td>2024-09-13T20-26-02Z</td><td>ç¯å¢ƒä¾èµ–</td></tr><tr><td>ç®¡ç†ç«¯æœåŠ¡</td><td>easylive-cloud-admin</td><td>7070</td><td>java8</td><td>é¡¹ç›®</td></tr><tr><td>ç”¨æˆ·ç«¯æœåŠ¡</td><td>easylive-cloud-web</td><td>7072</td><td>java8</td><td>é¡¹ç›®</td></tr><tr><td>äº¤äº’æœåŠ¡</td><td>easylive-cloud-interact</td><td>7073</td><td>java8</td><td>é¡¹ç›®</td></tr><tr><td>èµ„æºæœåŠ¡</td><td>easylive-cloud-resource</td><td>7074</td><td>java8</td><td>é¡¹ç›®</td></tr><tr><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><h1 id="å¾®æœåŠ¡é¡¹ç›®éƒ¨ç½²æŒ‡å¯¼">å¾®æœåŠ¡é¡¹ç›®éƒ¨ç½²æŒ‡å¯¼</h1><p><em>Exported on 2025/10/6 at GMT+8 0:12:27 from Cursor (1.4.2)</em></p><hr><p><strong>User</strong></p><p>æ•´ä¸ªé¡¹ç›®å·²ç»å®Œç»“ï¼Œè¯·ä½ ä»”ç»†æŸ¥çœ‹ä¸€ä¸‹é¡¹ç›®çš„ç»“æ„ï¼Œæˆ‘ç°åœ¨æƒ³è¦æŠŠè¿™ä¸ªå¾®æœåŠ¡é¡¹ç›®éƒ¨ç½²åˆ°ä¸€ä¸ªæˆ‘å·²ç»å‡†å¤‡å¥½çš„4æ ¸4gçš„æœåŠ¡å™¨ä¸Šè¯¥å¦‚ä½•éƒ¨ç½²ï¼Œæ˜¯é€‰æ‹©ç”¨å®å¡”é¢æ¿è¿˜æ˜¯ç”¨docker composeéƒ¨ç½²å‘¢ï¼Œè¯·ä½ æŒ‡å¼•ç€æˆ‘ä¸€æ­¥æ­¥å®Œæˆéƒ¨ç½²@c:\Users\wanglei\Desktop\<a href="http://xn--i0yq5pe7ol9g.md">é¡¹ç›®éƒ¨ç½².md</a></p><hr><p><strong>Cursor</strong></p><p>æˆ‘å…ˆå¿«é€ŸæŸ¥çœ‹å„å¾®æœåŠ¡çš„é…ç½®æ–‡ä»¶ç«¯å£ä¸å¤–éƒ¨ä¾èµ–ï¼ˆNacosã€Redisã€RocketMQã€Minio ç­‰ï¼‰çš„æŒ‡å‘ï¼Œç¡®ä¿ docker-compose æ–¹æ¡ˆèƒ½ä¸€æ¬¡æ€§æŠŠä¾èµ–ä¸æœåŠ¡éƒ½ç¼–æ’å¥½ã€‚éšåæˆ‘ä¼šç»™å‡ºä¸€æ­¥æ­¥éƒ¨ç½²æ¸…å•ä¸å¯ç›´æ¥ä½¿ç”¨çš„ compose æ–‡ä»¶ä¸æ„å»ºå‘½ä»¤ã€‚</p><p>æˆ‘å°†å…ˆåˆ›å»ºä¸€ä¸ªéƒ¨ç½²ä»»åŠ¡æ¸…å•ï¼Œéšåç›´æ¥ç»™å‡ºæ¨èæ–¹æ¡ˆï¼ˆDocker Composeï¼‰ä¸å¯è¿è¡Œçš„å‘½ä»¤ã€é…ç½®ä¸æ–‡ä»¶æ¨¡æ¿ã€‚æ¥ä¸‹æ¥æˆ‘ä¼šæŠŠå…¨éƒ¨æ­¥éª¤ä¸€æ¬¡æ€§å†™å…¨ï¼Œä¾¿äºä½ æŒ‰éƒ¨å°±ç­æ‰§è¡Œã€‚</p><p>æˆ‘å…ˆå¹¶è¡Œæ‰“å¼€å„å¾®æœåŠ¡çš„é…ç½®æ–‡ä»¶ï¼Œç¡®è®¤æ³¨å†Œä¸­å¿ƒã€é…ç½®åä¸ç«¯å£è®¾ç½®ï¼Œä»¥ä¾¿ç»™å‡ºå¯ç›´æ¥å¯ç”¨çš„ docker-compose å‚æ•°å’Œç¯å¢ƒå˜é‡ã€‚æ¥ç€æˆ‘ä¼šç¡®å®šé‡‡ç”¨ Docker Compose çš„æ€»ä½“ç­–ç•¥å¹¶å¼€å§‹ç»™å‡ºè„šæœ¬ã€‚</p><p>æˆ‘å·²ç¡®è®¤å„æœåŠ¡çš„ <code>bootstrap.yml</code> é€šè¿‡ Nacos åŠ è½½å…±äº«é…ç½®ä¸”é»˜è®¤æŒ‡å‘ 127.0.0.1:8848ï¼Œå®¹å™¨åŒ–æ—¶éœ€ç”¨ç¯å¢ƒå˜é‡è¦†ç›–ä¸º nacos:8848ã€‚ç°åœ¨æˆ‘å…ˆç¡®å®šé‡‡ç”¨ Docker Compose æ–¹æ¡ˆï¼Œå¹¶å¼€å§‹ç»™å‡ºå®‰è£…ä¸ç¼–æ’æ–‡ä»¶ã€‚æ¥ä¸‹æ¥æŠŠâ€œå®‰è£… Docker/Composeâ€è®¾ä¸ºè¿›è¡Œä¸­ã€‚</p><p>æˆ‘å°†å¹¶è¡Œæ‰“å¼€å„æœåŠ¡çš„ dev é…ç½®æ–‡ä»¶ï¼Œç¡®è®¤æ•°æ®åº“ã€å­˜å‚¨å’Œæ¶ˆæ¯é˜Ÿåˆ—çš„è¿æ¥ä¿¡æ¯ï¼Œä»¥ä¾¿åœ¨ docker-compose ä¸­æ­£ç¡®æ³¨å…¥ç¯å¢ƒå˜é‡ã€‚</p><p>æˆ‘å°†æŠŠâ€œå®‰è£… Docker/Composeâ€å®Œæˆå¹¶å¼€å§‹â€œåˆ›å»ºç›®å½•ç»“æ„ä¸ .env æœºå¯†å˜é‡â€ï¼Œéšåç»™å‡º<code>.env</code>å’Œ<code>docker-compose.yml</code>æ¨¡æ¿ä¸æ‰§è¡Œå‘½ä»¤ã€‚æ¥ç€æˆ‘ä¼šç»§ç»­æ¨è¿›ä¾èµ–ä¸åº”ç”¨ç¼–æ’ç­‰æ­¥éª¤ï¼Œå¹¶åŒæ­¥å‹¾é€‰å¯¹åº”å¾…åŠã€‚</p><p>æˆ‘å·²ç»ç¡®å®šé‡‡ç”¨ Docker Compose éƒ¨ç½²ï¼Œå¹¶å¼€å§‹è¾“å‡ºç›®å½•ç»“æ„ã€<code>.env</code> ä¸ä¾èµ–ç¼–æ’æ¨¡æ¿ï¼Œéšåç»™å‡ºåç«¯é•œåƒæ„å»ºä¸åº”ç”¨ç¼–æ’ã€å‰ç«¯ä¸ Nginx é…ç½®ã€‚æ¥ç€æˆ‘ä¼šæŠŠâ€œåˆ›å»ºç›®å½•ç»“æ„ä¸ .envâ€æ ‡è®°å®Œæˆï¼Œå¹¶å¼€å¯â€œä¾èµ–æœåŠ¡ç¼–æ’â€å’Œâ€œåº”ç”¨ç¼–æ’â€ã€‚</p><p>æˆ‘å·²ç¡®è®¤é‡‡ç”¨ Docker Compose å¹¶æ ¸å¯¹äº†å„å¾®æœåŠ¡çš„ Nacos é…ç½®ä¸ç«¯å£ã€‚ç°åœ¨æˆ‘ä¼šç›´æ¥ç»™å‡ºä¸€æ­¥æ­¥éƒ¨ç½²æ¸…å•ã€å¿…è¦å‘½ä»¤ä¸å¯ç”¨æ¨¡æ¿ï¼ˆ.envã€docker-composeã€Dockerfileã€Nginxï¼‰ï¼Œä½ å¯ä»¥æŒ‰é¡ºåºæ‰§è¡Œã€‚éšåæˆ‘ä¼šæŠŠæ¸…å•é¡¹å‹¾é€‰å®Œæˆã€‚### ç»“è®ºä¸å»ºè®®</p><ul><li>å»ºè®®ä½¿ç”¨ Docker Compose éƒ¨ç½²ã€‚åŸå› ï¼š<ul><li>å¤šä¸ªåŸºç¡€ä¾èµ–ï¼ˆMySQL/Redis/Nacos/RocketMQ/Minio/ES/Seataï¼‰ä¸ 5 ä¸ª SpringBoot å¾®æœåŠ¡éœ€è¦ç»Ÿä¸€ç¼–æ’ã€ç½‘ç»œä¸æŒä¹…åŒ–ï¼Œæ›´æ˜“å¤ç°ä¸ç»´æŠ¤ã€‚</li><li>æ—¥å¿—ã€é‡å¯ç­–ç•¥ã€èµ„æºé™åˆ¶ã€å¤‡ä»½ä¸è¿ç§»éƒ½æ›´å®¹æ˜“æ ‡å‡†åŒ–ã€‚</li></ul></li><li>4 æ ¸ 4G æœºå™¨èµ„æºåç´§ã€‚å»ºè®®å…ˆä¸Šçº¿æ ¸å¿ƒé“¾è·¯ï¼ˆMySQLã€Redisã€Nacosã€Minioã€ç½‘å…³ä¸æ ¸å¿ƒä¸‰æœåŠ¡ï¼‰ï¼ŒRocketMQ/ES/Seataå¦‚éå¼ºä¾èµ–å¯å»¶åå¯ç”¨ï¼Œæˆ–æŒ‰éœ€ç‹¬ç«‹æœºå™¨ã€‚</li></ul><h3 id="ç«¯å£è§„åˆ’ï¼ˆæ¥è‡ªä½ çš„éƒ¨ç½²æ–‡æ¡£ï¼‰">ç«¯å£è§„åˆ’ï¼ˆæ¥è‡ªä½ çš„éƒ¨ç½²æ–‡æ¡£ï¼‰</h3><ul><li>æ•°æ®åº“ MySQL: 3306</li><li>Nacos: 8848</li><li>ç½‘å…³ <code>easylive-cloud-gateway</code>: 7071</li><li>ç®¡ç†ç«¯ <code>easylive-cloud-admin</code>: 7070</li><li>ç”¨æˆ·ç«¯ <code>easylive-cloud-web</code>: 7072</li><li>äº¤äº’ <code>easylive-cloud-interact</code>: 7073</li><li>èµ„æº <code>easylive-cloud-resource</code>: 7074</li><li>Redis: 6379</li><li>Minio: 9000(æœåŠ¡) + 9001(æ§åˆ¶å°)</li><li>RocketMQ/ES/Seataï¼šæŒ‰éœ€å¯ç”¨ï¼ˆå»ºè®®åç½®ï¼‰</li></ul><p>ä¸‹é¢æ­¥éª¤ç›´æ¥å¯æ‰§è¡Œï¼ŒæŒ‰é¡ºåºæ¥ã€‚</p><h3 id="1-å®‰è£…-Docker-Composeï¼ˆä»¥-Ubuntu-20-04-22-04-ä¸ºä¾‹ï¼‰">1) å®‰è£… Docker &amp; Composeï¼ˆä»¥ Ubuntu 20.04/22.04 ä¸ºä¾‹ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1) åŸºç¡€ä¾èµ–</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get update -y</span><br><span class="line"><span class="built_in">sudo</span> apt-get install -y ca-certificates curl gnupg lsb-release</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2) Docker ä»“åº“</span></span><br><span class="line"><span class="built_in">sudo</span> install -m 0755 -d /etc/apt/keyrings</span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg \</span><br><span class="line"> | <span class="built_in">sudo</span> gpg --dearmor -o /etc/apt/keyrings/docker.gpg</span><br><span class="line"><span class="built_in">echo</span> \</span><br><span class="line">  <span class="string">&quot;deb [arch=<span class="subst">$(dpkg --print-architecture)</span> signed-by=/etc/apt/keyrings/docker.gpg] \</span></span><br><span class="line"><span class="string">  https://download.docker.com/linux/ubuntu <span class="subst">$(lsb_release -cs)</span> stable&quot;</span> \</span><br><span class="line"> | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br><span class="line"><span class="built_in">sudo</span> apt-get update -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3) å®‰è£…</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4) å… sudoï¼ˆé‡æ–°ç™»å½•ç”Ÿæ•ˆï¼‰</span></span><br><span class="line"><span class="built_in">sudo</span> usermod -aG docker <span class="variable">$USER</span></span><br></pre></td></tr></table></figure><h3 id="2-ç›®å½•ç»“æ„ä¸æ—¶åŒº">2) ç›®å½•ç»“æ„ä¸æ—¶åŒº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /opt/easylive/&#123;mysql/data,mysql/init,redis,data,nacos,data,minio/data,nginx/conf.d,frontend/&#123;web,admin&#125;,logs&#125;</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /opt/easylive/&#123;gateway,admin,web,interact,resource&#125;/config</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /opt/easylive/&#123;rocketmq/&#123;namesrv,broker&#125;,es/data,seata&#125;</span><br><span class="line"><span class="built_in">sudo</span> timedatectl set-timezone Asia/Shanghai</span><br></pre></td></tr></table></figure><h3 id="3-envï¼ˆæ”¾åˆ°-opt-easylive-envï¼‰">3) .envï¼ˆæ”¾åˆ° /opt/easylive/.envï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">TZ=Asia/Shanghai</span><br><span class="line"></span><br><span class="line"><span class="comment"># MySQL</span></span><br><span class="line">MYSQL_ROOT_PASSWORD=YourStrongRootPass!</span><br><span class="line">MYSQL_DATABASE=easylive</span><br><span class="line"></span><br><span class="line"><span class="comment"># Nacos</span></span><br><span class="line">NACOS_VERSION=v2.2.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># Minio</span></span><br><span class="line">MINIO_ROOT_USER=admin</span><br><span class="line">MINIO_ROOT_PASSWORD=YourStrongMinioPass!</span><br><span class="line"></span><br><span class="line"><span class="comment"># Java å†…å­˜å»ºè®®ï¼ˆ4G æœºå™¨å°½é‡å…‹åˆ¶ï¼‰</span></span><br><span class="line">JAVA_XMS=256m</span><br><span class="line">JAVA_XMX=512m</span><br></pre></td></tr></table></figure><h3 id="4-docker-compose-ymlï¼ˆæ”¾åˆ°-opt-easylive-docker-compose-ymlï¼‰">4) docker-compose.ymlï¼ˆæ”¾åˆ° /opt/easylive/docker-compose.ymlï¼‰</h3><p>ä¸ºèŠ‚çœå†…å­˜ï¼ŒRocketMQ/ES/Seata å…ˆæ³¨é‡Šï¼Œæ ¸å¿ƒé“¾è·¯å…ˆè·‘é€šã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.9&quot;</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">easylive</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">easylive-net:</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">mysql-data:</span></span><br><span class="line">  <span class="attr">redis-data:</span></span><br><span class="line">  <span class="attr">nacos-data:</span></span><br><span class="line">  <span class="attr">minio-data:</span></span><br><span class="line">  <span class="attr">es-data:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:8.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">--default-authentication-plugin=mysql_native_password</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">--character-set-server=utf8mb4</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">--collation-server=utf8mb4_unicode_ci</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=$&#123;TZ&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_ROOT_PASSWORD=$&#123;MYSQL_ROOT_PASSWORD&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_DATABASE=$&#123;MYSQL_DATABASE&#125;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3306:3306&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql-data:/var/lib/mysql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./mysql/init:/docker-entrypoint-initdb.d</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">&quot;CMD-SHELL&quot;</span>,<span class="string">&quot;mysqladmin ping -uroot -p$&#123;MYSQL_ROOT_PASSWORD&#125; | grep &#x27;mysqld is alive&#x27;&quot;</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">10s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">5s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">30</span></span><br><span class="line">    <span class="attr">networks:</span> [<span class="string">easylive-net</span>]</span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:6.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">command:</span> [ <span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;--appendonly&quot;</span>, <span class="string">&quot;yes&quot;</span> ]</span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6379:6379&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-data:/data</span></span><br><span class="line">    <span class="attr">networks:</span> [<span class="string">easylive-net</span>]</span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">nacos:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nacos/nacos-server:$&#123;NACOS_VERSION&#125;</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nacos</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MODE=standalone</span></span><br><span class="line">      <span class="comment"># ä½¿ç”¨ MySQL åšæŒä¹…åŒ–ï¼ˆæ¨èï¼‰</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_PLATFORM=mysql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_SERVICE_HOST=mysql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_SERVICE_DB_NAME=nacos_config</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_SERVICE_PORT=3306</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_SERVICE_USER=root</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_SERVICE_PASSWORD=$&#123;MYSQL_ROOT_PASSWORD&#125;</span></span><br><span class="line">      <span class="comment"># JVM ç¼©å°</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">JVM_XMS=256m</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">JVM_XMX=512m</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">JVM_XMN=256m</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=$&#123;TZ&#125;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="attr">mysql:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8848:8848&quot;</span></span><br><span class="line">    <span class="attr">networks:</span> [<span class="string">easylive-net</span>]</span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">minio:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">minio/minio:RELEASE.2024-09-13T20-26-02Z</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">minio</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MINIO_ROOT_USER=$&#123;MINIO_ROOT_USER&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MINIO_ROOT_PASSWORD=$&#123;MINIO_ROOT_PASSWORD&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=$&#123;TZ&#125;</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">server</span> <span class="string">/data</span> <span class="string">--console-address</span> <span class="string">&quot;:9001&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">minio-data:/data</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9000:9000&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9001:9001&quot;</span></span><br><span class="line">    <span class="attr">networks:</span> [<span class="string">easylive-net</span>]</span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># å¦‚æ— å¼ºä¾èµ–ï¼Œå…ˆä¸å¯åŠ¨ä¸‹åˆ—æœåŠ¡ï¼Œç¨³å®šåå†å¯ç”¨</span></span><br><span class="line">  <span class="comment"># rocketmq-namesrv:</span></span><br><span class="line">  <span class="comment">#   image: apache/rocketmq:5.2.0</span></span><br><span class="line">  <span class="comment">#   container_name: rmq-namesrv</span></span><br><span class="line">  <span class="comment">#   ports: [&quot;9876:9876&quot;]</span></span><br><span class="line">  <span class="comment">#   environment:</span></span><br><span class="line">  <span class="comment">#     - TZ=$&#123;TZ&#125;</span></span><br><span class="line">  <span class="comment">#     - JAVA_OPT_EXT=-Xms256m -Xmx512m</span></span><br><span class="line">  <span class="comment">#   networks: [easylive-net]</span></span><br><span class="line">  <span class="comment">#   restart: always</span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># rocketmq-broker:</span></span><br><span class="line">  <span class="comment">#   image: apache/rocketmq:5.2.0</span></span><br><span class="line">  <span class="comment">#   container_name: rmq-broker</span></span><br><span class="line">  <span class="comment">#   environment:</span></span><br><span class="line">  <span class="comment">#     - NAMESRV_ADDR=rmq-namesrv:9876</span></span><br><span class="line">  <span class="comment">#     - TZ=$&#123;TZ&#125;</span></span><br><span class="line">  <span class="comment">#     - JAVA_OPT_EXT=-Xms256m -Xmx512m</span></span><br><span class="line">  <span class="comment">#   depends_on: [rocketmq-namesrv]</span></span><br><span class="line">  <span class="comment">#   ports: [&quot;10911:10911&quot;,&quot;10909:10909&quot;,&quot;10912:10912&quot;]</span></span><br><span class="line">  <span class="comment">#   networks: [easylive-net]</span></span><br><span class="line">  <span class="comment">#   restart: always</span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># es:</span></span><br><span class="line">  <span class="comment">#   image: docker.elastic.co/elasticsearch/elasticsearch:7.17.22</span></span><br><span class="line">  <span class="comment">#   container_name: es</span></span><br><span class="line">  <span class="comment">#   environment:</span></span><br><span class="line">  <span class="comment">#     - discovery.type=single-node</span></span><br><span class="line">  <span class="comment">#     - xpack.security.enabled=false</span></span><br><span class="line">  <span class="comment">#     - ES_JAVA_OPTS=-Xms512m -Xmx512m</span></span><br><span class="line">  <span class="comment">#     - TZ=$&#123;TZ&#125;</span></span><br><span class="line">  <span class="comment">#   ulimits:</span></span><br><span class="line">  <span class="comment">#     memlock:</span></span><br><span class="line">  <span class="comment">#       soft: -1</span></span><br><span class="line">  <span class="comment">#       hard: -1</span></span><br><span class="line">  <span class="comment">#   ports:</span></span><br><span class="line">  <span class="comment">#     - &quot;9201:9200&quot;</span></span><br><span class="line">  <span class="comment">#   volumes:</span></span><br><span class="line">  <span class="comment">#     - es-data:/usr/share/elasticsearch/data</span></span><br><span class="line">  <span class="comment">#   networks: [easylive-net]</span></span><br><span class="line">  <span class="comment">#   restart: always</span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># seata:</span></span><br><span class="line">  <span class="comment">#   image: seataio/seata-server:1.6.1</span></span><br><span class="line">  <span class="comment">#   container_name: seata</span></span><br><span class="line">  <span class="comment">#   environment:</span></span><br><span class="line">  <span class="comment">#     - SEATA_PORT=7091</span></span><br><span class="line">  <span class="comment">#     - TZ=$&#123;TZ&#125;</span></span><br><span class="line">  <span class="comment">#   ports: [&quot;7091:7091&quot;]</span></span><br><span class="line">  <span class="comment">#   networks: [easylive-net]</span></span><br><span class="line">  <span class="comment">#   restart: always</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># ------------------ åº”ç”¨æœåŠ¡ ------------------</span></span><br><span class="line">  <span class="attr">gateway:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">easylive-cloud-gateway:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">gateway</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=$&#123;TZ&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SERVER_PORT=7071</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_PROFILES_ACTIVE=dev</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_CLOUD_NACOS_DISCOVERY_SERVER_ADDR=nacos:8848</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_CLOUD_NACOS_CONFIG_SERVER_ADDR=nacos:8848</span></span><br><span class="line">    <span class="attr">depends_on:</span> [<span class="string">nacos</span>]</span><br><span class="line">    <span class="attr">ports:</span> [<span class="string">&quot;7071:7071&quot;</span>]</span><br><span class="line">    <span class="attr">networks:</span> [<span class="string">easylive-net</span>]</span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">admin:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">easylive-cloud-admin:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">admin</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=$&#123;TZ&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SERVER_PORT=7070</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_PROFILES_ACTIVE=dev</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_CLOUD_NACOS_DISCOVERY_SERVER_ADDR=nacos:8848</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_CLOUD_NACOS_CONFIG_SERVER_ADDR=nacos:8848</span></span><br><span class="line">      <span class="comment"># è¦†ç›–æ•°æ®åº“ä¸ Redisï¼ˆå¦‚ Nacos æœªé…ç½®å®Œæ•´ï¼‰</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_URL=jdbc:mysql://mysql:3306/easylive?serverTimezone=GMT%2B8&amp;useUnicode=true&amp;characterEncoding=utf8&amp;autoReconnect=true&amp;allowMultiQueries=true&amp;useSSL=false</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_USERNAME=root</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_PASSWORD=$&#123;MYSQL_ROOT_PASSWORD&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_REDIS_HOST=redis</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_REDIS_PORT=6379</span></span><br><span class="line">    <span class="attr">depends_on:</span> [<span class="string">mysql</span>, <span class="string">redis</span>, <span class="string">nacos</span>]</span><br><span class="line">    <span class="attr">ports:</span> [<span class="string">&quot;7070:7070&quot;</span>]</span><br><span class="line">    <span class="attr">networks:</span> [<span class="string">easylive-net</span>]</span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">easylive-cloud-web:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">web</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=$&#123;TZ&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SERVER_PORT=7072</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_PROFILES_ACTIVE=dev</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_CLOUD_NACOS_DISCOVERY_SERVER_ADDR=nacos:8848</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_CLOUD_NACOS_CONFIG_SERVER_ADDR=nacos:8848</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_URL=jdbc:mysql://mysql:3306/easylive?serverTimezone=GMT%2B8&amp;useUnicode=true&amp;characterEncoding=utf8&amp;autoReconnect=true&amp;allowMultiQueries=true&amp;useSSL=false</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_USERNAME=root</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_PASSWORD=$&#123;MYSQL_ROOT_PASSWORD&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_REDIS_HOST=redis</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_REDIS_PORT=6379</span></span><br><span class="line">    <span class="attr">depends_on:</span> [<span class="string">mysql</span>, <span class="string">redis</span>, <span class="string">nacos</span>]</span><br><span class="line">    <span class="attr">ports:</span> [<span class="string">&quot;7072:7072&quot;</span>]</span><br><span class="line">    <span class="attr">networks:</span> [<span class="string">easylive-net</span>]</span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">interact:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">easylive-cloud-interact:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">interact</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=$&#123;TZ&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SERVER_PORT=7073</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_PROFILES_ACTIVE=dev</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_CLOUD_NACOS_DISCOVERY_SERVER_ADDR=nacos:8848</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_CLOUD_NACOS_CONFIG_SERVER_ADDR=nacos:8848</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_URL=jdbc:mysql://mysql:3306/easylive?serverTimezone=GMT%2B8&amp;useUnicode=true&amp;characterEncoding=utf8&amp;autoReconnect=true&amp;allowMultiQueries=true&amp;useSSL=false</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_USERNAME=root</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_PASSWORD=$&#123;MYSQL_ROOT_PASSWORD&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_REDIS_HOST=redis</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_REDIS_PORT=6379</span></span><br><span class="line">    <span class="attr">depends_on:</span> [<span class="string">mysql</span>, <span class="string">redis</span>, <span class="string">nacos</span>]</span><br><span class="line">    <span class="attr">ports:</span> [<span class="string">&quot;7073:7073&quot;</span>]</span><br><span class="line">    <span class="attr">networks:</span> [<span class="string">easylive-net</span>]</span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">resource:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">easylive-cloud-resource:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">resource</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=$&#123;TZ&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SERVER_PORT=7074</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_PROFILES_ACTIVE=dev</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_CLOUD_NACOS_DISCOVERY_SERVER_ADDR=nacos:8848</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_CLOUD_NACOS_CONFIG_SERVER_ADDR=nacos:8848</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_URL=jdbc:mysql://mysql:3306/easylive?serverTimezone=GMT%2B8&amp;useUnicode=true&amp;characterEncoding=utf8&amp;autoReconnect=true&amp;allowMultiQueries=true&amp;useSSL=false</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_USERNAME=root</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_PASSWORD=$&#123;MYSQL_ROOT_PASSWORD&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_REDIS_HOST=redis</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_REDIS_PORT=6379</span></span><br><span class="line">      <span class="comment"># å¦‚èµ„æºæœåŠ¡ç”¨åˆ° Minioï¼Œè¯·åœ¨ Nacos é…ç½®æˆ–æ­¤å¤„è¡¥å……è®¿é—®å‚æ•°</span></span><br><span class="line">      <span class="comment"># - MINIO_ENDPOINT=http://minio:9000</span></span><br><span class="line">      <span class="comment"># - MINIO_ACCESS_KEY=$&#123;MINIO_ROOT_USER&#125;</span></span><br><span class="line">      <span class="comment"># - MINIO_SECRET_KEY=$&#123;MINIO_ROOT_PASSWORD&#125;</span></span><br><span class="line">      <span class="comment"># - MINIO_BUCKET=your-bucket</span></span><br><span class="line">    <span class="attr">depends_on:</span> [<span class="string">mysql</span>, <span class="string">redis</span>, <span class="string">nacos</span>, <span class="string">minio</span>]</span><br><span class="line">    <span class="attr">ports:</span> [<span class="string">&quot;7074:7074&quot;</span>]</span><br><span class="line">    <span class="attr">networks:</span> [<span class="string">easylive-net</span>]</span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.25</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">depends_on:</span> [<span class="string">gateway</span>]</span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;80:80&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx/conf.d:/etc/nginx/conf.d</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./frontend/web:/usr/share/nginx/html</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./frontend/admin:/usr/share/nginx/html/admin</span></span><br><span class="line">    <span class="attr">networks:</span> [<span class="string">easylive-net</span>]</span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br></pre></td></tr></table></figure><h3 id="5-åç«¯æœåŠ¡é•œåƒæ„å»º">5) åç«¯æœåŠ¡é•œåƒæ„å»º</h3><p>å»ºè®®æ¯ä¸ªæœåŠ¡æ”¾ä¸€ä¸ªæœ€ç®€ Dockerfileï¼ˆä»¥ <code>easylive-cloud-gateway</code> ä¸ºä¾‹ï¼‰ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ”¾åœ¨ easylive-server/easylive-cloud/easylive-cloud-gateway/Dockerfile</span></span><br><span class="line"><span class="keyword">FROM</span> eclipse-temurin:<span class="number">8</span>-jre</span><br><span class="line"><span class="keyword">ENV</span> TZ=Asia/Shanghai</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> target/*.jar app.jar</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">7071</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>,<span class="string">&quot;-Xms<span class="variable">$&#123;JAVA_XMS:-256m&#125;</span>&quot;</span>,<span class="string">&quot;-Xmx<span class="variable">$&#123;JAVA_XMX:-512m&#125;</span>&quot;</span>,<span class="string">&quot;-jar&quot;</span>,<span class="string">&quot;/app/app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>æ„å»ºæ­¥éª¤ï¼ˆåœ¨ä½ çš„ä»“åº“æ ¹ç›®å½•æ‰§è¡Œï¼›å…¶ä»–å››ä¸ªæœåŠ¡åŒç†æ›´æ¢è·¯å¾„ä¸é•œåƒå/ç«¯å£ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰“åŒ…å…¨éƒ¨ï¼ˆè·³è¿‡æµ‹è¯•ï¼‰</span></span><br><span class="line"><span class="built_in">cd</span> /path/to/easylive-springcloud/easylive-server</span><br><span class="line">./mvnw -v || mvn -v</span><br><span class="line">mvn -DskipTests clean package</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºé•œåƒï¼ˆäº”ä¸ªæœåŠ¡ï¼‰</span></span><br><span class="line">docker build -t easylive-cloud-gateway:latest \</span><br><span class="line">  easylive-cloud/easylive-cloud-gateway</span><br><span class="line"></span><br><span class="line">docker build -t easylive-cloud-admin:latest \</span><br><span class="line">  easylive-cloud/easylive-cloud-admin</span><br><span class="line"></span><br><span class="line">docker build -t easylive-cloud-web:latest \</span><br><span class="line">  easylive-cloud/easylive-cloud-web</span><br><span class="line"></span><br><span class="line">docker build -t easylive-cloud-interact:latest \</span><br><span class="line">  easylive-cloud/easylive-cloud-interact</span><br><span class="line"></span><br><span class="line">docker build -t easylive-cloud-resource:latest \</span><br><span class="line">  easylive-cloud/easylive-cloud-resource</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><ul><li>ç«¯å£é€šè¿‡ <code>SERVER_PORT</code> è¦†ç›–ä¸º 7071/7070/7072/7073/7074ï¼Œè·Ÿä½ çš„è¡¨ä¸€è‡´ã€‚</li><li>Nacos åœ°å€åœ¨å®¹å™¨é—´ä¸º <code>nacos:8848</code>ï¼ˆå·²åœ¨ compose ä¸­ç”¨ç¯å¢ƒå˜é‡è¦†ç›–ï¼‰ã€‚</li><li>æ•°æ®åº“/Redis åœ¨å®¹å™¨é—´ä¸º <code>mysql:3306</code>ã€<code>redis:6379</code>ã€‚</li></ul><h3 id="6-Nginx-åä»£ä¸å‰ç«¯">6) Nginx åä»£ä¸å‰ç«¯</h3><p><code>/opt/easylive/nginx/conf.d/easylive.conf</code>ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">  <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">  <span class="attribute">server_name</span> _;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># ç”¨æˆ·ç«¯ Web é™æ€</span></span><br><span class="line">  <span class="attribute">root</span> /usr/share/nginx/html;</span><br><span class="line">  <span class="attribute">index</span> index.html;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># ç®¡ç†ç«¯é™æ€ï¼ˆè®¿é—® /admin/ï¼‰</span></span><br><span class="line">  <span class="section">location</span> /admin/ &#123;</span><br><span class="line">    <span class="attribute">alias</span> /usr/share/nginx/html/admin/;</span><br><span class="line">    <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ /admin/index.html;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># åå‘ä»£ç†åˆ°ç½‘å…³ï¼ˆå’Œ gateway çš„è·¯ç”±ä¿æŒä¸€è‡´ï¼‰</span></span><br><span class="line">  <span class="section">location</span> /web/       &#123; <span class="attribute">proxy_pass</span> http://gateway:7071/web/; &#125;</span><br><span class="line">  <span class="section">location</span> /interact/  &#123; <span class="attribute">proxy_pass</span> http://gateway:7071/interact/; &#125;</span><br><span class="line">  <span class="section">location</span> /user/      &#123; <span class="attribute">proxy_pass</span> http://gateway:7071/user/; &#125;</span><br><span class="line">  <span class="section">location</span> /file/      &#123; <span class="attribute">proxy_pass</span> http://gateway:7071/file/; &#125;</span><br><span class="line">  <span class="section">location</span> /adminapi/  &#123; <span class="attribute">proxy_pass</span> http://gateway:7071/admin/; &#125; <span class="comment"># é¿å…é™æ€è·¯å¾„å†²çªï¼Œç»™ç®¡ç†ç«¯ API æ¢å‰ç¼€</span></span><br><span class="line"></span><br><span class="line">  <span class="attribute">proxy_set_header</span> Host              <span class="variable">$host</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Real-IP         <span class="variable">$remote_addr</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-For   <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ„å»ºå‰ç«¯å¹¶æ‹·è´é™æ€èµ„æºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”¨æˆ·ç«¯</span></span><br><span class="line"><span class="built_in">cd</span> /path/to/easylive-springcloud/easylive-front/easylive-front-web</span><br><span class="line">npm ci || npm install</span><br><span class="line">npm run build</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> -r dist/* /opt/easylive/frontend/web/</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç®¡ç†ç«¯</span></span><br><span class="line"><span class="built_in">cd</span> /path/to/easylive-springcloud/easylive-front/easylive-front-admin</span><br><span class="line">npm ci || npm install</span><br><span class="line">npm run build</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /opt/easylive/frontend/admin</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> -r dist/* /opt/easylive/frontend/admin/</span><br></pre></td></tr></table></figure><p>å¦‚å‰ç«¯è¯·æ±‚ç½‘å…³çš„åŸºåœ°å€å¯é…ç½®ï¼Œå»ºè®®æ”¹ä¸ºç›¸å¯¹è·¯å¾„å¹¶æŒ‰ä¸Šé¢ Nginx åä»£è§„åˆ™è®¿é—®ã€‚</p><h3 id="7-Minio-åˆå§‹åŒ–ï¼ˆå¯é€‰ï¼‰">7) Minio åˆå§‹åŒ–ï¼ˆå¯é€‰ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run --<span class="built_in">rm</span> --network easylive_easylive-net -it \</span><br><span class="line">  minio/mc sh -c <span class="string">&quot;</span></span><br><span class="line"><span class="string">mc alias set minio http://minio:9000 <span class="variable">$&#123;MINIO_ROOT_USER&#125;</span> <span class="variable">$&#123;MINIO_ROOT_PASSWORD&#125;</span> &amp;&amp; \</span></span><br><span class="line"><span class="string">mc mb -p minio/easylive &amp;&amp; \</span></span><br><span class="line"><span class="string">mc anonymous set download minio/easylive&quot;</span></span><br></pre></td></tr></table></figure><h3 id="8-Nacos-é…ç½®">8) Nacos é…ç½®</h3><ul><li>è®¿é—® <code>http://æœåŠ¡å™¨IP:8848/nacos</code>ï¼Œé»˜è®¤æ— é‰´æƒæˆ–æŒ‰é•œåƒé»˜è®¤è®¾ç½®ã€‚</li><li>ä¸ºæ¯ä¸ªæœåŠ¡æ–°å¢é…ç½®ï¼š<ul><li><code>easylive-cloud-admin-dev.yml</code></li><li><code>easylive-cloud-web-dev.yml</code></li><li><code>easylive-cloud-interact-dev.yml</code></li><li><code>easylive-cloud-resource-dev.yml</code></li><li>å†…å®¹è‡³å°‘åŒ…å«æ•°æ®åº“ä¸ Redis è¿æ¥ï¼ˆå‚è€ƒä½ ä»“åº“ä¸­ dev ymlï¼Œå°† host ä» 127.0.0.1 æ”¹ä¸º <code>mysql</code>ã€<code>redis</code>ï¼‰ï¼š</li></ul></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://mysql:3306/easylive?serverTimezone=GMT%2B8&amp;useUnicode=true&amp;characterEncoding=utf8&amp;autoReconnect=true&amp;allowMultiQueries=true&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">$&#123;MYSQL_ROOT_PASSWORD&#125;</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br></pre></td></tr></table></figure><ul><li>èµ„æºæœåŠ¡è‹¥ä½¿ç”¨ Minioï¼Œè¯·åœ¨å¯¹åº” yml å¢åŠ  Minio é…ç½®é¡¹ï¼ˆæŒ‰ä½ é¡¹ç›®å±æ€§å‘½åï¼‰ï¼ŒæŒ‡å‘ <code>http://minio:9000</code>ã€‚</li></ul><h3 id="9-å¯åŠ¨ä¸éªŒè¯">9) å¯åŠ¨ä¸éªŒè¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/easylive</span><br><span class="line">docker compose pull   <span class="comment"># ç¬¬ä¸€æ¬¡å¯å¿½ç•¥</span></span><br><span class="line">docker compose up -d  <span class="comment"># å¯åŠ¨</span></span><br><span class="line">docker compose ps     <span class="comment"># æŸ¥çœ‹çŠ¶æ€</span></span><br><span class="line">docker logs -f gateway</span><br><span class="line">docker logs -f admin</span><br><span class="line">docker logs -f web</span><br><span class="line">docker logs -f interact</span><br><span class="line">docker logs -f resource</span><br></pre></td></tr></table></figure><ul><li>æµè§ˆå™¨è®¿é—®ï¼š<ul><li>Nacos: <code>http://æœåŠ¡å™¨IP:8848/nacos</code></li><li>Minio: <code>http://æœåŠ¡å™¨IP:9001</code></li><li>å‰ç«¯: <code>http://æœåŠ¡å™¨IP/</code>ï¼ˆç”¨æˆ·ç«¯ï¼‰ä¸ <code>http://æœåŠ¡å™¨IP/admin/</code>ï¼ˆç®¡ç†ç«¯ï¼‰</li></ul></li><li>åç«¯è¿é€šæ€§ï¼šç½‘å…³ <code>http://æœåŠ¡å™¨IP:7071</code> ä¸‹çš„ <code>/web/**</code>ã€<code>/interact/**</code>ã€<code>/user/**</code>ã€<code>/file/**</code>ã€<code>/admin/**</code>ã€‚</li></ul><h3 id="10-åŸŸåä¸-HTTPSï¼ˆå¯é€‰å¿«é€Ÿï¼‰">10) åŸŸåä¸ HTTPSï¼ˆå¯é€‰å¿«é€Ÿï¼‰</h3><ul><li>ç”¨ Nginx + Certbotï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt-get install -y certbot python3-certbot-nginx</span><br><span class="line"><span class="built_in">sudo</span> certbot --nginx -d your.domain.com -m your@email \</span><br><span class="line">  --agree-tos --no-eff-email --redirect</span><br></pre></td></tr></table></figure><ul><li>æˆ–ç”¨ Caddyï¼ˆæ›´ç®€å•ï¼Œè‡ªåŠ¨ç­¾å‘ï¼‰ï¼šå°† Nginx æ¢æˆ <code>caddy:2</code>ï¼Œç”¨ Caddyfile ä¸€è¡Œåä»£ç½‘å…³å’Œé™æ€ã€‚</li></ul><h3 id="11-å¸¸è§èµ„æºä¸ä¼˜åŒ–å»ºè®®">11) å¸¸è§èµ„æºä¸ä¼˜åŒ–å»ºè®®</h3><ul><li>4G æœºå™¨å†…å­˜ç´§å¼ ï¼šå…ˆä¸ä¸Š RocketMQ/ES/Seataï¼ŒJVM å †ä¿æŒ <code>-Xms256m -Xmx512m</code>ï¼›Nacos JVM ä¹Ÿå·²æ”¶æ•›ã€‚</li><li>MySQL/ES/Minio æ•°æ®è¯·ä½¿ç”¨å·æŒä¹…åŒ–ï¼ˆcompose å·²é…ç½®ï¼‰ã€‚</li><li>æ—¥å¿—è½ç›˜åˆ°å®¹å™¨ stdoutï¼Œå»ºè®®å†é… ELK/Vector åç»­æ¥å…¥ã€‚</li></ul><p>ä½ ç°åœ¨å¯ä»¥æŒ‰ä»¥ä¸Šé¡ºåºæ‰§è¡Œï¼›å¦‚æœé‡åˆ°ç«¯å£/å†…å­˜/é…ç½®é—®é¢˜ï¼Œå‘æˆ‘æŠ¥é”™æˆ‘ç»§ç»­å¸®ä½ æ’æŸ¥ã€‚</p><ul><li>æˆ‘å·²ç»å®Œæˆéƒ¨ç½²æ–¹æ¡ˆé€‰æ‹©ä¸å…¨éƒ¨æ­¥éª¤æŒ‡å¼•ï¼ŒåŒ…å« <code>.env</code>ã€<code>docker-compose.yml</code>ã€åç«¯ Dockerfileã€Nginx åä»£ä¸åˆå§‹åŒ–è¦ç‚¹ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 1) åŸºç¡€ä¾èµ–</span><br><span class="line">sudo apt-get update -y</span><br><span class="line">sudo apt-get install -y ca-certificates curl gnupg lsb-release</span><br><span class="line"></span><br><span class="line"># 2) Docker ä»“åº“</span><br><span class="line">sudo install -m 0755 -d /etc/apt/keyrings</span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg \</span><br><span class="line"> | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg</span><br><span class="line">echo \</span><br><span class="line">  &quot;deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] \</span><br><span class="line">  https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&quot; \</span><br><span class="line"> | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br><span class="line">sudo apt-get update -y</span><br><span class="line"></span><br><span class="line"># 3) å®‰è£…</span><br><span class="line">sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br><span class="line"></span><br><span class="line"># 4) å… sudoï¼ˆé‡æ–°ç™»å½•ç”Ÿæ•ˆï¼‰</span><br><span class="line">sudo usermod -aG docker $USER</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /opt/easylive/&#123;mysql/data,mysql/init,redis,data,nacos,data,minio/data,nginx/conf.d,frontend/&#123;web,admin&#125;,logs&#125;</span><br><span class="line">sudo mkdir -p /opt/easylive/&#123;gateway,admin,web,interact,resource&#125;/config</span><br><span class="line">sudo mkdir -p /opt/easylive/&#123;rocketmq/&#123;namesrv,broker&#125;,es/data,seata&#125;</span><br><span class="line">sudo timedatectl set-timezone Asia/Shanghai</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">TZ=Asia/Shanghai</span><br><span class="line"></span><br><span class="line"># MySQL</span><br><span class="line">MYSQL_ROOT_PASSWORD=YourStrongRootPass!</span><br><span class="line">MYSQL_DATABASE=easylive</span><br><span class="line"></span><br><span class="line"># Nacos</span><br><span class="line">NACOS_VERSION=v2.2.0</span><br><span class="line"></span><br><span class="line"># Minio</span><br><span class="line">MINIO_ROOT_USER=admin</span><br><span class="line">MINIO_ROOT_PASSWORD=YourStrongMinioPass!</span><br><span class="line"></span><br><span class="line"># Java å†…å­˜å»ºè®®ï¼ˆ4G æœºå™¨å°½é‡å…‹åˆ¶ï¼‰</span><br><span class="line">JAVA_XMS=256m</span><br><span class="line">JAVA_XMX=512m</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.9&quot;</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">easylive</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">easylive-net:</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">mysql-data:</span></span><br><span class="line">  <span class="attr">redis-data:</span></span><br><span class="line">  <span class="attr">nacos-data:</span></span><br><span class="line">  <span class="attr">minio-data:</span></span><br><span class="line">  <span class="attr">es-data:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:8.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">--default-authentication-plugin=mysql_native_password</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">--character-set-server=utf8mb4</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">--collation-server=utf8mb4_unicode_ci</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=$&#123;TZ&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_ROOT_PASSWORD=$&#123;MYSQL_ROOT_PASSWORD&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_DATABASE=$&#123;MYSQL_DATABASE&#125;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3306:3306&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql-data:/var/lib/mysql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./mysql/init:/docker-entrypoint-initdb.d</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">&quot;CMD-SHELL&quot;</span>,<span class="string">&quot;mysqladmin ping -uroot -p$&#123;MYSQL_ROOT_PASSWORD&#125; | grep &#x27;mysqld is alive&#x27;&quot;</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">10s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">5s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">30</span></span><br><span class="line">    <span class="attr">networks:</span> [<span class="string">easylive-net</span>]</span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:6.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">command:</span> [ <span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;--appendonly&quot;</span>, <span class="string">&quot;yes&quot;</span> ]</span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6379:6379&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-data:/data</span></span><br><span class="line">    <span class="attr">networks:</span> [<span class="string">easylive-net</span>]</span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">nacos:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nacos/nacos-server:$&#123;NACOS_VERSION&#125;</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nacos</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MODE=standalone</span></span><br><span class="line">      <span class="comment"># ä½¿ç”¨ MySQL åšæŒä¹…åŒ–ï¼ˆæ¨èï¼‰</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_PLATFORM=mysql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_SERVICE_HOST=mysql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_SERVICE_DB_NAME=nacos_config</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_SERVICE_PORT=3306</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_SERVICE_USER=root</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_SERVICE_PASSWORD=$&#123;MYSQL_ROOT_PASSWORD&#125;</span></span><br><span class="line">      <span class="comment"># JVM ç¼©å°</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">JVM_XMS=256m</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">JVM_XMX=512m</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">JVM_XMN=256m</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=$&#123;TZ&#125;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="attr">mysql:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8848:8848&quot;</span></span><br><span class="line">    <span class="attr">networks:</span> [<span class="string">easylive-net</span>]</span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">minio:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">minio/minio:RELEASE.2024-09-13T20-26-02Z</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">minio</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MINIO_ROOT_USER=$&#123;MINIO_ROOT_USER&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MINIO_ROOT_PASSWORD=$&#123;MINIO_ROOT_PASSWORD&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=$&#123;TZ&#125;</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">server</span> <span class="string">/data</span> <span class="string">--console-address</span> <span class="string">&quot;:9001&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">minio-data:/data</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9000:9000&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9001:9001&quot;</span></span><br><span class="line">    <span class="attr">networks:</span> [<span class="string">easylive-net</span>]</span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># å¦‚æ— å¼ºä¾èµ–ï¼Œå…ˆä¸å¯åŠ¨ä¸‹åˆ—æœåŠ¡ï¼Œç¨³å®šåå†å¯ç”¨</span></span><br><span class="line">  <span class="comment"># rocketmq-namesrv:</span></span><br><span class="line">  <span class="comment">#   image: apache/rocketmq:5.2.0</span></span><br><span class="line">  <span class="comment">#   container_name: rmq-namesrv</span></span><br><span class="line">  <span class="comment">#   ports: [&quot;9876:9876&quot;]</span></span><br><span class="line">  <span class="comment">#   environment:</span></span><br><span class="line">  <span class="comment">#     - TZ=$&#123;TZ&#125;</span></span><br><span class="line">  <span class="comment">#     - JAVA_OPT_EXT=-Xms256m -Xmx512m</span></span><br><span class="line">  <span class="comment">#   networks: [easylive-net]</span></span><br><span class="line">  <span class="comment">#   restart: always</span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># rocketmq-broker:</span></span><br><span class="line">  <span class="comment">#   image: apache/rocketmq:5.2.0</span></span><br><span class="line">  <span class="comment">#   container_name: rmq-broker</span></span><br><span class="line">  <span class="comment">#   environment:</span></span><br><span class="line">  <span class="comment">#     - NAMESRV_ADDR=rmq-namesrv:9876</span></span><br><span class="line">  <span class="comment">#     - TZ=$&#123;TZ&#125;</span></span><br><span class="line">  <span class="comment">#     - JAVA_OPT_EXT=-Xms256m -Xmx512m</span></span><br><span class="line">  <span class="comment">#   depends_on: [rocketmq-namesrv]</span></span><br><span class="line">  <span class="comment">#   ports: [&quot;10911:10911&quot;,&quot;10909:10909&quot;,&quot;10912:10912&quot;]</span></span><br><span class="line">  <span class="comment">#   networks: [easylive-net]</span></span><br><span class="line">  <span class="comment">#   restart: always</span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># es:</span></span><br><span class="line">  <span class="comment">#   image: docker.elastic.co/elasticsearch/elasticsearch:7.17.22</span></span><br><span class="line">  <span class="comment">#   container_name: es</span></span><br><span class="line">  <span class="comment">#   environment:</span></span><br><span class="line">  <span class="comment">#     - discovery.type=single-node</span></span><br><span class="line">  <span class="comment">#     - xpack.security.enabled=false</span></span><br><span class="line">  <span class="comment">#     - ES_JAVA_OPTS=-Xms512m -Xmx512m</span></span><br><span class="line">  <span class="comment">#     - TZ=$&#123;TZ&#125;</span></span><br><span class="line">  <span class="comment">#   ulimits:</span></span><br><span class="line">  <span class="comment">#     memlock:</span></span><br><span class="line">  <span class="comment">#       soft: -1</span></span><br><span class="line">  <span class="comment">#       hard: -1</span></span><br><span class="line">  <span class="comment">#   ports:</span></span><br><span class="line">  <span class="comment">#     - &quot;9201:9200&quot;</span></span><br><span class="line">  <span class="comment">#   volumes:</span></span><br><span class="line">  <span class="comment">#     - es-data:/usr/share/elasticsearch/data</span></span><br><span class="line">  <span class="comment">#   networks: [easylive-net]</span></span><br><span class="line">  <span class="comment">#   restart: always</span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># seata:</span></span><br><span class="line">  <span class="comment">#   image: seataio/seata-server:1.6.1</span></span><br><span class="line">  <span class="comment">#   container_name: seata</span></span><br><span class="line">  <span class="comment">#   environment:</span></span><br><span class="line">  <span class="comment">#     - SEATA_PORT=7091</span></span><br><span class="line">  <span class="comment">#     - TZ=$&#123;TZ&#125;</span></span><br><span class="line">  <span class="comment">#   ports: [&quot;7091:7091&quot;]</span></span><br><span class="line">  <span class="comment">#   networks: [easylive-net]</span></span><br><span class="line">  <span class="comment">#   restart: always</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># ------------------ åº”ç”¨æœåŠ¡ ------------------</span></span><br><span class="line">  <span class="attr">gateway:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">easylive-cloud-gateway:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">gateway</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=$&#123;TZ&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SERVER_PORT=7071</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_PROFILES_ACTIVE=dev</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_CLOUD_NACOS_DISCOVERY_SERVER_ADDR=nacos:8848</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_CLOUD_NACOS_CONFIG_SERVER_ADDR=nacos:8848</span></span><br><span class="line">    <span class="attr">depends_on:</span> [<span class="string">nacos</span>]</span><br><span class="line">    <span class="attr">ports:</span> [<span class="string">&quot;7071:7071&quot;</span>]</span><br><span class="line">    <span class="attr">networks:</span> [<span class="string">easylive-net</span>]</span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">admin:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">easylive-cloud-admin:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">admin</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=$&#123;TZ&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SERVER_PORT=7070</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_PROFILES_ACTIVE=dev</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_CLOUD_NACOS_DISCOVERY_SERVER_ADDR=nacos:8848</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_CLOUD_NACOS_CONFIG_SERVER_ADDR=nacos:8848</span></span><br><span class="line">      <span class="comment"># è¦†ç›–æ•°æ®åº“ä¸ Redisï¼ˆå¦‚ Nacos æœªé…ç½®å®Œæ•´ï¼‰</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_URL=jdbc:mysql://mysql:3306/easylive?serverTimezone=GMT%2B8&amp;useUnicode=true&amp;characterEncoding=utf8&amp;autoReconnect=true&amp;allowMultiQueries=true&amp;useSSL=false</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_USERNAME=root</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_PASSWORD=$&#123;MYSQL_ROOT_PASSWORD&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_REDIS_HOST=redis</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_REDIS_PORT=6379</span></span><br><span class="line">    <span class="attr">depends_on:</span> [<span class="string">mysql</span>, <span class="string">redis</span>, <span class="string">nacos</span>]</span><br><span class="line">    <span class="attr">ports:</span> [<span class="string">&quot;7070:7070&quot;</span>]</span><br><span class="line">    <span class="attr">networks:</span> [<span class="string">easylive-net</span>]</span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">easylive-cloud-web:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">web</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=$&#123;TZ&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SERVER_PORT=7072</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_PROFILES_ACTIVE=dev</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_CLOUD_NACOS_DISCOVERY_SERVER_ADDR=nacos:8848</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_CLOUD_NACOS_CONFIG_SERVER_ADDR=nacos:8848</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_URL=jdbc:mysql://mysql:3306/easylive?serverTimezone=GMT%2B8&amp;useUnicode=true&amp;characterEncoding=utf8&amp;autoReconnect=true&amp;allowMultiQueries=true&amp;useSSL=false</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_USERNAME=root</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_PASSWORD=$&#123;MYSQL_ROOT_PASSWORD&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_REDIS_HOST=redis</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_REDIS_PORT=6379</span></span><br><span class="line">    <span class="attr">depends_on:</span> [<span class="string">mysql</span>, <span class="string">redis</span>, <span class="string">nacos</span>]</span><br><span class="line">    <span class="attr">ports:</span> [<span class="string">&quot;7072:7072&quot;</span>]</span><br><span class="line">    <span class="attr">networks:</span> [<span class="string">easylive-net</span>]</span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">interact:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">easylive-cloud-interact:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">interact</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=$&#123;TZ&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SERVER_PORT=7073</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_PROFILES_ACTIVE=dev</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_CLOUD_NACOS_DISCOVERY_SERVER_ADDR=nacos:8848</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_CLOUD_NACOS_CONFIG_SERVER_ADDR=nacos:8848</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_URL=jdbc:mysql://mysql:3306/easylive?serverTimezone=GMT%2B8&amp;useUnicode=true&amp;characterEncoding=utf8&amp;autoReconnect=true&amp;allowMultiQueries=true&amp;useSSL=false</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_USERNAME=root</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_PASSWORD=$&#123;MYSQL_ROOT_PASSWORD&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_REDIS_HOST=redis</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_REDIS_PORT=6379</span></span><br><span class="line">    <span class="attr">depends_on:</span> [<span class="string">mysql</span>, <span class="string">redis</span>, <span class="string">nacos</span>]</span><br><span class="line">    <span class="attr">ports:</span> [<span class="string">&quot;7073:7073&quot;</span>]</span><br><span class="line">    <span class="attr">networks:</span> [<span class="string">easylive-net</span>]</span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">resource:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">easylive-cloud-resource:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">resource</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=$&#123;TZ&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SERVER_PORT=7074</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_PROFILES_ACTIVE=dev</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_CLOUD_NACOS_DISCOVERY_SERVER_ADDR=nacos:8848</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_CLOUD_NACOS_CONFIG_SERVER_ADDR=nacos:8848</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_URL=jdbc:mysql://mysql:3306/easylive?serverTimezone=GMT%2B8&amp;useUnicode=true&amp;characterEncoding=utf8&amp;autoReconnect=true&amp;allowMultiQueries=true&amp;useSSL=false</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_USERNAME=root</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_PASSWORD=$&#123;MYSQL_ROOT_PASSWORD&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_REDIS_HOST=redis</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_REDIS_PORT=6379</span></span><br><span class="line">      <span class="comment"># å¦‚èµ„æºæœåŠ¡ç”¨åˆ° Minioï¼Œè¯·åœ¨ Nacos é…ç½®æˆ–æ­¤å¤„è¡¥å……è®¿é—®å‚æ•°</span></span><br><span class="line">      <span class="comment"># - MINIO_ENDPOINT=http://minio:9000</span></span><br><span class="line">      <span class="comment"># - MINIO_ACCESS_KEY=$&#123;MINIO_ROOT_USER&#125;</span></span><br><span class="line">      <span class="comment"># - MINIO_SECRET_KEY=$&#123;MINIO_ROOT_PASSWORD&#125;</span></span><br><span class="line">      <span class="comment"># - MINIO_BUCKET=your-bucket</span></span><br><span class="line">    <span class="attr">depends_on:</span> [<span class="string">mysql</span>, <span class="string">redis</span>, <span class="string">nacos</span>, <span class="string">minio</span>]</span><br><span class="line">    <span class="attr">ports:</span> [<span class="string">&quot;7074:7074&quot;</span>]</span><br><span class="line">    <span class="attr">networks:</span> [<span class="string">easylive-net</span>]</span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.25</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">depends_on:</span> [<span class="string">gateway</span>]</span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;80:80&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx/conf.d:/etc/nginx/conf.d</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./frontend/web:/usr/share/nginx/html</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./frontend/admin:/usr/share/nginx/html/admin</span></span><br><span class="line">    <span class="attr">networks:</span> [<span class="string">easylive-net</span>]</span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br></pre></td></tr></table></figure><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ”¾åœ¨ easylive-server/easylive-cloud/easylive-cloud-gateway/Dockerfile</span></span><br><span class="line"><span class="keyword">FROM</span> eclipse-temurin:<span class="number">8</span>-jre</span><br><span class="line"><span class="keyword">ENV</span> TZ=Asia/Shanghai</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> target/*.jar app.jar</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">7071</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>,<span class="string">&quot;-Xms<span class="variable">$&#123;JAVA_XMS:-256m&#125;</span>&quot;</span>,<span class="string">&quot;-Xmx<span class="variable">$&#123;JAVA_XMX:-512m&#125;</span>&quot;</span>,<span class="string">&quot;-jar&quot;</span>,<span class="string">&quot;/app/app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># æ‰“åŒ…å…¨éƒ¨ï¼ˆè·³è¿‡æµ‹è¯•ï¼‰</span><br><span class="line">cd /path/to/easylive-springcloud/easylive-server</span><br><span class="line">./mvnw -v || mvn -v</span><br><span class="line">mvn -DskipTests clean package</span><br><span class="line"></span><br><span class="line"># æ„å»ºé•œåƒï¼ˆäº”ä¸ªæœåŠ¡ï¼‰</span><br><span class="line">docker build -t easylive-cloud-gateway:latest \</span><br><span class="line">  easylive-cloud/easylive-cloud-gateway</span><br><span class="line"></span><br><span class="line">docker build -t easylive-cloud-admin:latest \</span><br><span class="line">  easylive-cloud/easylive-cloud-admin</span><br><span class="line"></span><br><span class="line">docker build -t easylive-cloud-web:latest \</span><br><span class="line">  easylive-cloud/easylive-cloud-web</span><br><span class="line"></span><br><span class="line">docker build -t easylive-cloud-interact:latest \</span><br><span class="line">  easylive-cloud/easylive-cloud-interact</span><br><span class="line"></span><br><span class="line">docker build -t easylive-cloud-resource:latest \</span><br><span class="line">  easylive-cloud/easylive-cloud-resource</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  server_name _;</span><br><span class="line"></span><br><span class="line">  # ç”¨æˆ·ç«¯ Web é™æ€</span><br><span class="line">  root /usr/share/nginx/html;</span><br><span class="line">  index index.html;</span><br><span class="line"></span><br><span class="line">  # ç®¡ç†ç«¯é™æ€ï¼ˆè®¿é—® /admin/ï¼‰</span><br><span class="line">  location /admin/ &#123;</span><br><span class="line">    alias /usr/share/nginx/html/admin/;</span><br><span class="line">    try_files $uri $uri/ /admin/index.html;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  # åå‘ä»£ç†åˆ°ç½‘å…³ï¼ˆå’Œ gateway çš„è·¯ç”±ä¿æŒä¸€è‡´ï¼‰</span><br><span class="line">  location /web/       &#123; proxy_pass http://gateway:7071/web/; &#125;</span><br><span class="line">  location /interact/  &#123; proxy_pass http://gateway:7071/interact/; &#125;</span><br><span class="line">  location /user/      &#123; proxy_pass http://gateway:7071/user/; &#125;</span><br><span class="line">  location /file/      &#123; proxy_pass http://gateway:7071/file/; &#125;</span><br><span class="line">  location /adminapi/  &#123; proxy_pass http://gateway:7071/admin/; &#125; # é¿å…é™æ€è·¯å¾„å†²çªï¼Œç»™ç®¡ç†ç«¯ API æ¢å‰ç¼€</span><br><span class="line"></span><br><span class="line">  proxy_set_header Host              $host;</span><br><span class="line">  proxy_set_header X-Real-IP         $remote_addr;</span><br><span class="line">  proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;</span><br><span class="line">  proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># ç”¨æˆ·ç«¯</span><br><span class="line">cd /path/to/easylive-springcloud/easylive-front/easylive-front-web</span><br><span class="line">npm ci || npm install</span><br><span class="line">npm run build</span><br><span class="line">sudo cp -r dist/* /opt/easylive/frontend/web/</span><br><span class="line"></span><br><span class="line"># ç®¡ç†ç«¯</span><br><span class="line">cd /path/to/easylive-springcloud/easylive-front/easylive-front-admin</span><br><span class="line">npm ci || npm install</span><br><span class="line">npm run build</span><br><span class="line">sudo mkdir -p /opt/easylive/frontend/admin</span><br><span class="line">sudo cp -r dist/* /opt/easylive/frontend/admin/</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm --network easylive_easylive-net -it \</span><br><span class="line">  minio/mc sh -c &quot;</span><br><span class="line">mc alias set minio http://minio:9000 $&#123;MINIO_ROOT_USER&#125; $&#123;MINIO_ROOT_PASSWORD&#125; &amp;&amp; \</span><br><span class="line">mc mb -p minio/easylive &amp;&amp; \</span><br><span class="line">mc anonymous set download minio/easylive&quot;</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://mysql:3306/easylive?serverTimezone=GMT%2B8&amp;useUnicode=true&amp;characterEncoding=utf8&amp;autoReconnect=true&amp;allowMultiQueries=true&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">$&#123;MYSQL_ROOT_PASSWORD&#125;</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/easylive</span><br><span class="line">docker compose pull   # ç¬¬ä¸€æ¬¡å¯å¿½ç•¥</span><br><span class="line">docker compose up -d  # å¯åŠ¨</span><br><span class="line">docker compose ps     # æŸ¥çœ‹çŠ¶æ€</span><br><span class="line">docker logs -f gateway</span><br><span class="line">docker logs -f admin</span><br><span class="line">docker logs -f web</span><br><span class="line">docker logs -f interact</span><br><span class="line">docker logs -f resource</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install -y certbot python3-certbot-nginx</span><br><span class="line">sudo certbot --nginx -d your.domain.com -m your@email \</span><br><span class="line">  --agree-tos --no-eff-email --redirect</span><br></pre></td></tr></table></figure><hr><p><strong>User</strong></p><p>4æ ¸8gçš„æœåŠ¡å™¨æ˜¯å¦å¤Ÿç”¨èƒ½æŠŠæ‰€æœ‰çš„ç¯å¢ƒéƒ½é…ä¸Šå‘¢ï¼Œä¿é™©èµ·è§æˆ‘æ˜¯ä¸æ˜¯åº”è¯¥æ¢ä¸ª4æ ¸8gçš„æœåŠ¡å™¨</p><hr><p><strong>Cursor</strong></p><p>ç»“è®ºå…ˆè¯´ï¼š</p><ul><li>4æ ¸8GåŸºæœ¬èƒ½æŠŠå…¨å¥—ï¼ˆMySQL/Redis/Nacos/Minio/ES/RocketMQ/Seata + 5ä¸ªJavaæœåŠ¡ + ç½‘å…³ï¼‰è·‘èµ·æ¥ï¼Œä½†æ¯”è¾ƒâ€œç´§â€ï¼Œéœ€è¦ä¸¥æ ¼é™å†…å­˜ä¸ä½è´Ÿè½½åœºæ™¯ï¼Œå±äºå¯ç”¨ä½†ä¸å¤ªå®½è£•ã€‚</li><li>è‹¥è®¡åˆ’â€œå…¨éƒ¨ç»„ä»¶é•¿æœŸå¼€å¯ + æœ‰ä¸€å®šå¹¶å‘â€ï¼Œå»ºè®®è‡³å°‘æ¢åˆ°4æ ¸8Gï¼›è‹¥è¦æ›´ç¨³ï¼Œä¼˜å…ˆæŠŠ ES æˆ– RocketMQ å•ç‹¬æ‹†æœºï¼Œæˆ–ç›´æ¥ä¸Šæ›´é«˜è§„æ ¼ï¼ˆå¦‚8æ ¸16Gï¼‰ã€‚</li></ul><p>å¿«é€Ÿå†…å­˜é¢„ç®—ï¼ˆä¿å®ˆå»ºè®®ï¼Œå•ä½â‰ˆGiBï¼‰ï¼š</p><ul><li>Nacos: 0.5</li><li>MySQL: 0.5â€“1.0ï¼ˆå–å†³äº innodb_buffer_pool_sizeï¼‰</li><li>Redis: 0.1â€“0.3</li><li>Minio: 0.3â€“0.5</li><li>RocketMQ: 0.8â€“1.2ï¼ˆnamesrv 0.3â€“0.5ï¼Œbroker 0.5â€“0.7ï¼‰</li><li>Elasticsearch: 1.0â€“2.0ï¼ˆå †1â€“2Gï¼Œä¸”éœ€ vm.max_map_countï¼‰</li><li>Seata: 0.3â€“0.5</li><li>5ä¸ªSpringBootæœåŠ¡: 1.3â€“2.5ï¼ˆæ¯ä¸ª 256â€“512Mï¼‰</li><li>åˆè®¡ï¼šçº¦ 5.3â€“8.5Gï¼ˆéšè®¾ç½®å’Œè´Ÿè½½æµ®åŠ¨ï¼‰<br>=&gt; 4æ ¸8Gåœ¨â€œå…¨éƒ¨å¼€å¯â€æ—¶è¾¹ç¼˜å¯ç”¨ï¼Œéœ€éå¸¸å…‹åˆ¶çš„JVMä¸DBé…ç½®ã€‚</li></ul><p>ç»™ä½ ä¸¤ç§é€‰æ‹©ï¼š</p><ul><li>æƒ³çœäº‹ç¨³ä¸€ç‚¹ï¼šæ¢æˆ4æ ¸8Gï¼ˆæˆ–æ›´é«˜ï¼‰ï¼Œç„¶åä¸¥æ ¼æ§å†…å­˜å³å¯å…¨å¼€ï¼›æ›´ç†æƒ³æ˜¯æŠŠ ES æˆ– RocketMQ ç‹¬ç«‹å‡ºå»ã€‚</li><li>å…ˆä¸æ¢æœåŠ¡å™¨ï¼šä¿ç•™4æ ¸4G/8Gï¼Œåªå¯æ ¸å¿ƒé“¾è·¯ï¼ˆMySQL/Redis/Nacos/Minio/ç½‘å…³+ä¸šåŠ¡æœåŠ¡ï¼‰ï¼ŒæŠŠ ES/RocketMQ/Seata æš‚æ—¶å…³é—­æˆ–æ‰˜ç®¡åˆ°äº‘ä¸Šï¼Œç­‰ä¸šåŠ¡é‡èµ·æ¥å†æ‰©ã€‚</li></ul><p>è‹¥åšæŒåœ¨4æ ¸8Gå…¨å¼€è¿è¡Œï¼ŒåŠ¡å¿…ï¼š</p><ul><li>JVMï¼šæ‰€æœ‰Javaè¿›ç¨‹ç»Ÿä¸€ -Xms256m -Xmx512mï¼ˆNacosã€å„å¾®æœåŠ¡ã€Seataã€RocketMQï¼‰ï¼ŒES å †è®¾ 1G èµ·æ­¥ã€‚</li><li>MySQLï¼šinnodb_buffer_pool_size 512M èµ·ï¼›æ…¢æ…¢å†è°ƒå¤§ã€‚</li><li>å¼€å¯2â€“4G swap å…œåº•ï¼ˆä»…å…œåº•ï¼Œä¸å¯ä¾èµ–ï¼‰ã€‚</li><li>ç”¨ docker-compose é™åˆ¶æ¯ä¸ªå®¹å™¨å†…å­˜å¹¶ç›‘æ§ docker statsã€‚</li><li>ä¼˜å…ˆä¸Šçº¿æ— å¼ºä¾èµ–çš„è·¯å¾„ï¼›ES/RocketMQ è´Ÿè½½ä¸Šæ¥åä¼˜å…ˆæ‹†åˆ†æˆ–å‡é…ã€‚</li></ul><p>ç®€çŸ­å»ºè®®ï¼š</p><ul><li>å¦‚æœä½ å¸Œæœ›â€œä¸€å°æœºå…¨å®¶æ¡¶ + å¯ç•™æœ‰ä½™é‡â€ï¼Œæˆ‘å»ºè®®æ¢åˆ°4æ ¸8Gï¼ˆæ›´ç¨³ï¼‰æˆ–æŠŠ ES/RocketMQ å¤–ç½®/æ‰˜ç®¡ã€‚</li><li>å¦‚æœæ˜¯æ¼”ç¤º/ä½QPSåœºæ™¯ï¼Œ4æ ¸8Gå¯è¡Œï¼›4æ ¸4Gå°±å»ºè®®æŒ‰æˆ‘ç»™çš„æœ€å°åŒ–ç¼–æ’å…ˆè·‘æ ¸å¿ƒé“¾è·¯ã€‚</li></ul>]]></content>
    
    
    <summary type="html">å¾®æœåŠ¡é¡¹ç›®GQ Videoé¡¹ç›®éƒ¨ç½²</summary>
    
    
    
    <category term="é¡¹ç›®ç›¸å…³" scheme="https://itgeqian.github.io/categories/%E9%A1%B9%E7%9B%AE%E7%9B%B8%E5%85%B3/"/>
    
    
    <category term="é¡¹ç›®éƒ¨ç½²" scheme="https://itgeqian.github.io/tags/%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2/"/>
    
    <category term="GQ Video" scheme="https://itgeqian.github.io/tags/GQ-Video/"/>
    
  </entry>
  
  <entry>
    <title>JavaWeb+AIï¼ˆå®æˆ˜ç¯‡  tliasæ•™åŠ¡ç³»ç»Ÿï¼‰</title>
    <link href="https://itgeqian.github.io/posts/11.html"/>
    <id>https://itgeqian.github.io/posts/11.html</id>
    <published>2025-06-23T01:19:03.000Z</published>
    <updated>2025-06-26T09:12:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="4-é¡¹ç›®å®æˆ˜-tliasæ•™åŠ¡ç³»ç»Ÿ">4.é¡¹ç›®å®æˆ˜ <code>tlias</code>æ•™åŠ¡ç³»ç»Ÿ</h1><p><strong>åœ¨æ•´ä¸ªå®æˆ˜ç¯‡ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®Œæˆå¦‚ä¸‹åŠŸèƒ½ï¼š</strong></p><ul><li>éƒ¨é—¨ç®¡ç†ï¼šæŸ¥è¯¢ã€æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤</li><li>å‘˜å·¥ç®¡ç†ï¼š<ul><li>æŸ¥è¯¢ã€æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤</li><li>æ–‡ä»¶ä¸Šä¼ </li></ul></li><li>æŠ¥è¡¨ç»Ÿè®¡</li><li>ç™»å½•è®¤è¯</li><li>æ—¥å¿—ç®¡ç†</li><li>ç­çº§ç®¡ç†ï¼ˆè‡ªå·±å®æˆ˜å†…å®¹ï¼‰</li><li>å­¦å‘˜ç®¡ç†ï¼ˆè‡ªå·±å®æˆ˜å†…å®¹ï¼‰</li></ul><h1 id="â€“éƒ¨é—¨ç®¡ç†æ¨¡å—">â€“éƒ¨é—¨ç®¡ç†æ¨¡å—</h1><h2 id="1-éƒ¨é—¨ç®¡ç†">1.éƒ¨é—¨ç®¡ç†</h2><h3 id="1-1åŸºç¡€çŸ¥è¯†">1.1åŸºç¡€çŸ¥è¯†</h3><h4 id="1-1-1å‰åç«¯åˆ†ç¦»å¼€å‘">1.1.1å‰åç«¯åˆ†ç¦»å¼€å‘</h4><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-247-1024x454.png" alt="img"></p><p>æˆ‘ä»¬å°†åŸå…ˆçš„å·¥ç¨‹åˆ†ä¸ºå‰ç«¯å·¥ç¨‹å’Œåç«¯å·¥ç¨‹è¿™2ä¸ªå·¥ç¨‹ï¼Œç„¶åå‰ç«¯å·¥ç¨‹äº¤ç»™ä¸“ä¸šçš„å‰ç«¯äººå‘˜å¼€å‘ï¼Œåç«¯å·¥ç¨‹äº¤ç»™ä¸“ä¸šçš„åç«¯äººå‘˜å¼€å‘ã€‚</p><p>å‰ç«¯é¡µé¢éœ€è¦æ•°æ®ï¼Œå¯ä»¥é€šè¿‡å‘é€å¼‚æ­¥è¯·æ±‚ï¼Œä»åå°å·¥ç¨‹è·å–ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å‰åå°æ˜¯åˆ†å¼€æ¥å¼€å‘çš„ï¼Œé‚£ä¹ˆå‰ç«¯äººå‘˜æ€ä¹ˆçŸ¥é“åå°è¿”å›æ•°æ®çš„æ ¼å¼å‘¢ï¼Ÿåç«¯äººå‘˜å¼€å‘ï¼Œæ€ä¹ˆçŸ¥é“å‰ç«¯äººå‘˜éœ€è¦çš„æ•°æ®æ ¼å¼å‘¢ï¼Ÿ</p><p>æ‰€ä»¥é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å‰åå°ç»Ÿä¸€åˆ¶å®šä¸€å¥—è§„èŒƒï¼æˆ‘ä»¬å‰åå°å¼€å‘äººå‘˜éƒ½éœ€è¦éµå¾ªè¿™å¥—è§„èŒƒå¼€å‘ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬çš„<strong>æ¥å£****æ–‡æ¡£</strong>ã€‚</p><p>é‚£ä¹ˆæ¥å£æ–‡æ¡£çš„å†…å®¹æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿæ˜¯æˆ‘ä»¬åå°å¼€å‘è€…æ ¹æ®äº§å“ç»ç†æä¾›çš„äº§å“åŸå‹å’Œéœ€æ±‚æ–‡æ¡£æ‰€æ’°å†™å‡ºæ¥çš„</p><p>é‚£ä¹ˆåŸºäºå‰åå°åˆ†ç¦»å¼€å‘çš„æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬åå°å¼€å‘è€…å¼€å‘ä¸€ä¸ªåŠŸèƒ½çš„å…·ä½“æµç¨‹å¦‚ä½•å‘¢ï¼Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-276-1024x113.png" alt="img"></p><ol><li>éœ€æ±‚åˆ†æï¼šé¦–å…ˆæˆ‘ä»¬éœ€è¦é˜…è¯»éœ€æ±‚æ–‡æ¡£ï¼Œåˆ†æéœ€æ±‚ï¼Œç†è§£éœ€æ±‚ã€‚</li><li>æ¥å£å®šä¹‰ï¼šæŸ¥è¯¢æ¥å£æ–‡æ¡£ä¸­å…³äºéœ€æ±‚çš„æ¥å£çš„å®šä¹‰ï¼ŒåŒ…æ‹¬åœ°å€ï¼Œå‚æ•°ï¼Œå“åº”æ•°æ®ç±»å‹ç­‰ç­‰</li><li>å‰åå°å¹¶è¡Œå¼€å‘ï¼šå„è‡ªæŒ‰ç…§æ¥å£æ–‡æ¡£è¿›è¡Œå¼€å‘ï¼Œå®ç°éœ€æ±‚</li><li>æµ‹è¯•ï¼šå‰åå°å¼€å‘å®Œäº†ï¼Œå„è‡ªæŒ‰ç…§æ¥å£æ–‡æ¡£è¿›è¡Œæµ‹è¯•</li><li>å‰åæ®µè”è°ƒæµ‹è¯•ï¼šå‰æ®µå·¥ç¨‹è¯·æ±‚åç«¯å·¥ç¨‹ï¼Œæµ‹è¯•åŠŸèƒ½</li></ol><h4 id="1-1-2Restfulé£æ ¼">1.1.2Restfulé£æ ¼</h4><p>è€Œåœ¨å‰åç«¯è¿›è¡Œäº¤äº’çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åŸºäºå½“å‰ä¸»æµçš„RESTé£æ ¼çš„APIæ¥å£è¿›è¡Œäº¤äº’ã€‚</p><p><strong>ä»€ä¹ˆæ˜¯RESTé£æ ¼å‘¢?</strong></p><ul><li>RESTï¼ˆRepresentational State Transferï¼‰ï¼Œè¡¨è¿°æ€§çŠ¶æ€è½¬æ¢ï¼Œå®ƒæ˜¯ä¸€ç§è½¯ä»¶æ¶æ„é£æ ¼ã€‚</li></ul><p><strong>ä¼ ç»ŸURLé£æ ¼å¦‚ä¸‹ï¼š</strong></p><ul><li><a href="http://localhost:8080/user/getById?id=1">http://localhost:8080/user/getById?id=1</a> GETï¼šæŸ¥è¯¢idä¸º1çš„ç”¨æˆ·</li><li><a href="http://localhost:8080/user/saveUser">http://localhost:8080/user/saveUser</a> POSTï¼šæ–°å¢ç”¨æˆ·</li><li><a href="http://localhost:8080/user/updateUser">http://localhost:8080/user/updateUser</a> POSTï¼šä¿®æ”¹ç”¨æˆ·</li><li><a href="http://localhost:8080/user/deleteUser?id=1">http://localhost:8080/user/deleteUser?id=1</a> GETï¼šåˆ é™¤idä¸º1çš„ç”¨æˆ·</li></ul><p>æˆ‘ä»¬çœ‹åˆ°ï¼ŒåŸå§‹çš„ä¼ ç»ŸURLå‘¢ï¼Œå®šä¹‰æ¯”è¾ƒå¤æ‚ï¼Œè€Œä¸”å°†èµ„æºçš„è®¿é—®è¡Œä¸ºå¯¹å¤–æš´éœ²å‡ºæ¥äº†ã€‚è€Œä¸”ï¼Œå¯¹äºå¼€å‘äººå‘˜æ¥è¯´ï¼Œæ¯ä¸€ä¸ªå¼€å‘äººå‘˜éƒ½æœ‰è‡ªå·±çš„å‘½åä¹ æƒ¯ï¼Œå°±æ‹¿æ ¹æ®idæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯æ¥è¯´çš„ï¼Œä¸åŒçš„å¼€å‘äººå‘˜å®šä¹‰çš„è·¯å¾„å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š<code>getById</code>ï¼Œ<code>selectById</code>ï¼Œ<code>queryById</code>ï¼Œ<code>loadById</code>â€¦ ã€‚ æ¯ä¸€ä¸ªäººéƒ½æœ‰è‡ªå·±çš„å‘½åä¹ æƒ¯ï¼Œå¦‚æœéƒ½æŒ‰ç…§å„è‡ªçš„ä¹ æƒ¯æ¥ï¼Œä¸€ä¸ªé¡¹ç›®ç»„ï¼Œå‡ åå·æˆ–ä¸Šç™¾å·äººï¼Œé‚£æœ€ç»ˆå¼€å‘å‡ºæ¥çš„é¡¹ç›®ï¼Œå°†ä¼šå˜å¾—éš¾ä»¥ç»´æŠ¤ï¼Œæ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„æ ‡å‡†ã€‚</p><p><strong>åŸºäºRESTé£æ ¼URLå¦‚ä¸‹ï¼š</strong></p><ul><li><a href="http://localhost:8080/users/1">http://localhost:8080/users/1</a> GETï¼šæŸ¥è¯¢idä¸º1çš„ç”¨æˆ·</li><li><a href="http://localhost:8080/users">http://localhost:8080/users</a> POSTï¼šæ–°å¢ç”¨æˆ·</li><li><a href="http://localhost:8080/users">http://localhost:8080/users</a> PUTï¼šä¿®æ”¹ç”¨æˆ·</li><li><a href="http://localhost:8080/users/1">http://localhost:8080/users/1</a> DELETEï¼šåˆ é™¤idä¸º1çš„ç”¨æˆ·</li></ul><p>å…¶ä¸­æ€»ç»“èµ·æ¥ï¼Œå°±ä¸€å¥è¯ï¼š<strong>é€šè¿‡URLå®šä½è¦æ“ä½œçš„èµ„æºï¼Œé€šè¿‡HTTPåŠ¨è¯(è¯·æ±‚æ–¹å¼)æ¥æè¿°å…·ä½“çš„æ“ä½œã€‚</strong></p><p>åœ¨RESTé£æ ¼çš„URLä¸­ï¼Œé€šè¿‡å››ç§è¯·æ±‚æ–¹å¼ï¼Œæ¥æ“ä½œæ•°æ®çš„å¢åˆ æ”¹æŸ¥ã€‚</p><ul><li>GET ï¼š æŸ¥è¯¢</li><li>POST ï¼šæ–°å¢</li><li>PUT ï¼š ä¿®æ”¹</li><li>DELETE ï¼šåˆ é™¤</li></ul><p>æ³¨ï¼š</p><ul><li>RESTæ˜¯é£æ ¼ï¼Œæ˜¯çº¦å®šæ–¹å¼ï¼Œçº¦å®šä¸æ˜¯è§„å®šï¼Œå¯ä»¥æ‰“ç ´</li><li>æè¿°æ¨¡å—çš„åŠŸèƒ½é€šå¸¸ä½¿ç”¨å¤æ•°ï¼Œä¹Ÿå°±æ˜¯åŠ sçš„æ ¼å¼æ¥æè¿°ï¼Œè¡¨ç¤ºæ­¤ç±»èµ„æºï¼Œè€Œéå•ä¸ªèµ„æºã€‚å¦‚ï¼šusersã€empsã€booksâ€¦</li></ul><h4 id="1-1-3Apifoxçš„ä½¿ç”¨">1.1.3Apifoxçš„ä½¿ç”¨</h4><ul><li>å‰åç«¯éƒ½åœ¨å¹¶è¡Œå¼€å‘ï¼Œåç«¯å¼€å‘å®Œå¯¹åº”çš„æ¥å£ä¹‹åï¼Œå¦‚ä½•å¯¹æ¥å£è¿›è¡Œè¯·æ±‚æµ‹è¯•å‘¢ï¼Ÿ</li><li>å‰åç«¯éƒ½åœ¨å¹¶è¡Œå¼€å‘ï¼Œå‰ç«¯å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¦‚ä½•è·å–åˆ°æ•°æ®ï¼Œæµ‹è¯•é¡µé¢çš„æ¸²æŸ“å±•ç¤ºå‘¢ï¼Ÿ</li></ul><p>é‚£è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥å€ŸåŠ©ä¸€äº›æ¥å£æµ‹è¯•å·¥å…·ï¼Œæ¯”å¦‚é¡¹ï¼šPostmanã€Apipostã€Apifoxç­‰ã€‚</p><p>è¯¦ç»†ä½¿ç”¨å¯ä»¥åœ¨bç«™å®˜æ–¹è´¦å·è‡ªè¡Œå­¦ä¹ </p><h3 id="1-2å·¥ç¨‹æ­å»º">1.2å·¥ç¨‹æ­å»º</h3><p><strong>1).</strong> <strong>åˆ›å»ºSpringBootå·¥ç¨‹ï¼Œå¹¶å¼•å…¥<strong><strong>webå¼€å‘èµ·æ­¥ä¾èµ–ã€mybatisã€mysqlé©±åŠ¨ã€lombok</strong></strong>ã€‚</strong></p><p><em><strong>*2). åˆ›å»ºæ•°æ®åº“åŠå¯¹åº”çš„è¡¨ç»“æ„ï¼Œå¹¶åœ¨application.ymlä¸­é…ç½®æ•°æ®åº“çš„åŸºæœ¬ä¿¡æ¯ã€‚*</strong></em></p><p>åˆ›å»º<code>tlias</code>æ•°æ®åº“ï¼Œå¹¶å‡†å¤‡<code>dept</code>éƒ¨é—¨è¡¨ã€‚</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> dept (</span><br><span class="line">  id <span class="type">int</span> unsigned <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">&#x27;ID, ä¸»é”®&#x27;</span>,</span><br><span class="line">  <span class="type">name</span> <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">UNIQUE</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;éƒ¨é—¨åç§°&#x27;</span>,</span><br><span class="line">  create_time datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  update_time datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span></span><br><span class="line">) <span class="keyword">COMMENT</span> <span class="string">&#x27;éƒ¨é—¨è¡¨&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dept <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">&#x27;å­¦å·¥éƒ¨&#x27;</span>,<span class="string">&#x27;2023-09-25 09:47:40&#x27;</span>,<span class="string">&#x27;2024-07-25 09:47:40&#x27;</span>),</span><br><span class="line">                      (<span class="number">2</span>,<span class="string">&#x27;æ•™ç ”éƒ¨&#x27;</span>,<span class="string">&#x27;2023-09-25 09:47:40&#x27;</span>,<span class="string">&#x27;2024-08-09 15:17:04&#x27;</span>),</span><br><span class="line">                      (<span class="number">3</span>,<span class="string">&#x27;å’¨è¯¢éƒ¨&#x27;</span>,<span class="string">&#x27;2023-09-25 09:47:40&#x27;</span>,<span class="string">&#x27;2024-07-30 21:26:24&#x27;</span>),</span><br><span class="line">                      (<span class="number">4</span>,<span class="string">&#x27;å°±ä¸šéƒ¨&#x27;</span>,<span class="string">&#x27;2023-09-25 09:47:40&#x27;</span>,<span class="string">&#x27;2024-07-25 09:47:40&#x27;</span>),</span><br><span class="line">                      (<span class="number">5</span>,<span class="string">&#x27;äººäº‹éƒ¨&#x27;</span>,<span class="string">&#x27;2023-09-25 09:47:40&#x27;</span>,<span class="string">&#x27;2024-07-25 09:47:40&#x27;</span>),</span><br><span class="line">                      (<span class="number">6</span>,<span class="string">&#x27;è¡Œæ”¿éƒ¨&#x27;</span>,<span class="string">&#x27;2023-11-30 20:56:37&#x27;</span>,<span class="string">&#x27;2024-07-30 20:56:37&#x27;</span>);</span><br></pre></td></tr></table></figure><p>åœ¨ <code>application.yml</code> é…ç½®æ–‡ä»¶ä¸­é…ç½®æ•°æ®åº“çš„è¿æ¥ä¿¡æ¯ã€‚</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">spring:</span></span><br><span class="line">  <span class="params">application:</span></span><br><span class="line">    <span class="params">name:</span> tlias-web-management</span><br><span class="line">  <span class="comment">#mysqlè¿æ¥é…ç½®</span></span><br><span class="line">  <span class="params">datasource:</span></span><br><span class="line">    <span class="params">driver-class-name:</span> com.mysql.cj.jdbc.Driver</span><br><span class="line">    <span class="params">url:</span> jdbc:mysql:<span class="operator">//</span>localhost:<span class="number">3306</span><span class="symbol">/tlias</span></span><br><span class="line">    <span class="params">username:</span> root</span><br><span class="line">    <span class="params">password:</span> <span class="number">1234</span></span><br><span class="line"><span class="params">mybatis:</span></span><br><span class="line">  <span class="params">configuration:</span></span><br><span class="line">    <span class="params">log-impl:</span> org.apache.ibatis.logging.stdout.StdOutImpl</span><br></pre></td></tr></table></figure><p><strong>3). å‡†å¤‡åŸºç¡€åŒ…ç»“æ„ï¼Œå¹¶å¼•å…¥å®ä½“ç±»DeptåŠç»Ÿä¸€çš„å“åº”ç»“æœå°è£…ç±»Result</strong></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-248.png" alt="img"></p><p>å®ä½“ç±»Dept</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_"><span class="keyword">class</span> <span class="title">Dept</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»Ÿä¸€å“åº”ç»“æœResult</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">package com.<span class="property">itheima</span>.<span class="property">pojo</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.<span class="property">Data</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.<span class="property">Serializable</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åç«¯ç»Ÿä¸€è¿”å›ç»“æœ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Integer</span> code; <span class="comment">//ç¼–ç ï¼š1æˆåŠŸï¼Œ0ä¸ºå¤±è´¥</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> msg; <span class="comment">//é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Object</span> data; <span class="comment">//æ•°æ®</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="title class_">Result</span> <span class="title function_">success</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Result</span> result = <span class="keyword">new</span> <span class="title class_">Result</span>();</span><br><span class="line">        result.<span class="property">code</span> = <span class="number">1</span>;</span><br><span class="line">        result.<span class="property">msg</span> = <span class="string">&quot;success&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="title class_">Result</span> <span class="title function_">success</span>(<span class="params"><span class="title class_">Object</span> <span class="built_in">object</span></span>) &#123;</span><br><span class="line">        <span class="title class_">Result</span> result = <span class="keyword">new</span> <span class="title class_">Result</span>();</span><br><span class="line">        result.<span class="property">data</span> = <span class="built_in">object</span>;</span><br><span class="line">        result.<span class="property">code</span> = <span class="number">1</span>;</span><br><span class="line">        result.<span class="property">msg</span> = <span class="string">&quot;success&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="title class_">Result</span> <span class="title function_">error</span>(<span class="params"><span class="title class_">String</span> msg</span>) &#123;</span><br><span class="line">        <span class="title class_">Result</span> result = <span class="keyword">new</span> <span class="title class_">Result</span>();</span><br><span class="line">        result.<span class="property">msg</span> = msg;</span><br><span class="line">        result.<span class="property">code</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åŸºç¡€ä»£ç ç»“æ„<ul><li>DeptMapper</li><li>DeptService</li><li>DeptServiceImpl</li><li>DeptController</li></ul></li></ul><h2 id="2-æŸ¥è¯¢éƒ¨é—¨">2.æŸ¥è¯¢éƒ¨é—¨</h2><h3 id="2-1åŸºæœ¬å®ç°">2.1åŸºæœ¬å®ç°</h3><h4 id="2-1-1éœ€æ±‚">2.1.1éœ€æ±‚</h4><p>æŸ¥è¯¢æ‰€æœ‰çš„éƒ¨é—¨æ•°æ®ï¼ŒæŸ¥è¯¢å‡ºæ¥å±•ç¤ºåœ¨éƒ¨é—¨ç®¡ç†çš„é¡µé¢ä¸­ã€‚é¡µé¢åŸå‹æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-277-1024x472.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-285.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-286.png" alt="img"></p><h4 id="2-1-2å®ç°æ€è·¯">2.1.2å®ç°æ€è·¯</h4><ul><li>Controllerå±‚ï¼Œè´Ÿè´£æ¥æ”¶å‰ç«¯å‘èµ·çš„è¯·æ±‚ï¼Œå¹¶è°ƒç”¨serviceæŸ¥è¯¢éƒ¨é—¨æ•°æ®ï¼Œç„¶åå“åº”ç»“æœã€‚</li><li>Serviceå±‚ï¼Œè´Ÿè´£è°ƒç”¨Mapperæ¥å£æ–¹æ³•ï¼ŒæŸ¥è¯¢æ‰€æœ‰éƒ¨é—¨æ•°æ®ã€‚</li><li>Mapperå±‚ï¼Œæ‰§è¡ŒæŸ¥è¯¢æ‰€æœ‰éƒ¨é—¨æ•°æ®çš„æ“ä½œã€‚</li></ul><h4 id="2-1-3ä»£ç å®ç°">2.1.3ä»£ç å®ç°</h4><p><strong>1). Controllerå±‚</strong></p><p>åœ¨ <code>DeptController</code> ä¸­ï¼Œå¢åŠ  <code>list</code> æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** * éƒ¨é—¨ç®¡ç†æ§åˆ¶å™¨ */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_"><span class="keyword">class</span> <span class="title">DeptController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DeptService deptService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**     * æŸ¥è¯¢éƒ¨é—¨åˆ—è¡¨     */</span><span class="meta">@RequestMapping</span>(<span class="string">&quot;/depts&quot;</span>)</span><br><span class="line">    <span class="keyword">public</span> Result list()&#123;</span><br><span class="line">        List&lt;Dept&gt; deptList = deptService.findAll();</span><br><span class="line">        <span class="keyword">return</span> Result.success(deptList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2). Serviceå±‚</strong></p><p>åœ¨ <code>DeptService</code> ä¸­ï¼Œå¢åŠ  <code>findAll</code>æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">DeptService</span> &#123;</span><br><span class="line">    <span class="comment">/**     * æŸ¥è¯¢æ‰€æœ‰éƒ¨é—¨     */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Dept&gt; <span class="title">findAll</span>()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>DeptServiceImpl</code> ä¸­ï¼Œå¢åŠ  <code>findAll</code>æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_"><span class="keyword">class</span> <span class="title">DeptServiceImpl</span> <span class="keyword"><span class="keyword">implements</span> <span class="type">DeptService</span></span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DeptMapper deptMapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Dept&gt; findAll() &#123;</span><br><span class="line">        <span class="keyword">return</span> deptMapper.findAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3). Mapperå±‚</strong></p><p>åœ¨ <code>DeptMapper</code> ä¸­ï¼Œå¢åŠ  <code>findAll</code>æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_"><span class="keyword">interface</span> <span class="title">DeptMapper</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**     * æŸ¥è¯¢æ‰€æœ‰éƒ¨é—¨     */</span></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">&quot;select * from dept&quot;</span>)</span><br><span class="line">    <span class="keyword">public</span> List&lt;Dept&gt; findAll();</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-1-4æ¥å£æµ‹è¯•">2.1.4æ¥å£æµ‹è¯•</h4><p>æ‰“å¼€Apifoxè¿›è¡Œæµ‹è¯•</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-278-1024x647.png" alt="img"></p><p>æˆ‘ä»¬å‘ç°ï¼Œå·²ç»æŸ¥è¯¢å‡ºäº†æ‰€æœ‰çš„éƒ¨é—¨æ•°æ®ï¼Œå¹¶ä¸”å“åº”å›æ¥çš„å°±æ˜¯jsonæ ¼å¼çš„æ•°æ®ï¼Œä¸æ¥å£æ–‡æ¡£ä¸€è‡´ã€‚ é‚£æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œè¿™ä¸ªæŸ¥è¯¢æ“ä½œï¼Œæˆ‘ä»¬ä½¿ç”¨postã€putã€deleteæ–¹å¼æ¥è¯·æ±‚ï¼Œæ˜¯å¦å¯ä»¥è·å–åˆ°æ•°æ®ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-279-1024x633.png" alt="img"></p><p>ç»è¿‡æµ‹è¯•ï¼Œæˆ‘ä»¬å‘ç°ï¼Œç°åœ¨æˆ‘ä»¬å…¶å®æ˜¯å¯ä»¥é€šè¿‡ä»»ä½•æ–¹å¼çš„è¯·æ±‚æ¥è®¿é—®æŸ¥è¯¢éƒ¨é—¨çš„è¿™ä¸ªæ¥å£çš„ã€‚ è€Œåœ¨æ¥å£æ–‡æ¡£ä¸­ï¼Œæ˜ç¡®è¦æ±‚è¯¥æ¥å£çš„è¯·æ±‚æ–¹å¼ä¸ºGETï¼Œé‚£ä¹ˆå¦‚ä½•é™åˆ¶è¯·æ±‚æ–¹å¼å‘¢ï¼Ÿ</p><p>æ–¹å¼ä¸€ï¼šåœ¨controlleræ–¹æ³•çš„@RequestMappingæ³¨è§£ä¸­é€šè¿‡methodå±æ€§æ¥é™å®šã€‚</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@RestController</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">DeptController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@Autowired</span></span><br><span class="line">    private DeptService deptService;</span><br><span class="line"></span><br><span class="line">    <span class="regexp">/**     </span></span><br><span class="line"><span class="regexp">     * æŸ¥è¯¢éƒ¨é—¨åˆ—è¡¨     </span></span><br><span class="line"><span class="regexp">     */</span></span><br><span class="line"><span class="variable">@RequestMapping</span>(value = <span class="string">&quot;/depts&quot;</span>, <span class="function"><span class="keyword">method</span> = <span class="title">RequestMethod</span>.<span class="title">GET</span>)</span></span><br><span class="line"><span class="function">    <span class="title">public</span> <span class="title">Result</span> <span class="title">list</span></span>()&#123;</span><br><span class="line">        List&lt;Dept&gt; deptList = deptService.findAll();</span><br><span class="line">        <span class="keyword">return</span> Result.success(deptList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–¹å¼äºŒï¼šåœ¨controlleræ–¹æ³•ä¸Šä½¿ç”¨ï¼Œ@RequestMappingçš„è¡ç”Ÿæ³¨è§£ @GetMappingã€‚ è¯¥æ³¨è§£å°±æ˜¯æ ‡è¯†å½“å‰æ–¹æ³•ï¼Œå¿…é¡»ä»¥GETæ–¹å¼è¯·æ±‚ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DeptService deptService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢éƒ¨é—¨åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(<span class="string">&quot;/depts&quot;</span>)</span></span><br><span class="line">    <span class="keyword">public</span> Result list()&#123;</span><br><span class="line">        List&lt;Dept&gt; deptList = deptService.findAll();</span><br><span class="line">        <span class="keyword">return</span> Result.success(deptList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¨èä½¿ç”¨ç¬¬äºŒç§æ–¹å¼</p><ul><li>GETæ–¹å¼ï¼š@GetMapping</li><li>POSTæ–¹å¼ï¼š@PostMapping</li><li>PUTæ–¹å¼ï¼š@PutMapping</li><li>DELETEæ–¹å¼ï¼š@DeleteMapping</li></ul><h4 id="2-1-5æ•°æ®å°è£…">2.1.5æ•°æ®å°è£…</h4><p>åœ¨æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬å‘ç°éƒ¨é—¨çš„æ•°æ®ä¸­ï¼Œidã€nameä¸¤ä¸ªå±æ€§æ˜¯æœ‰å€¼çš„ï¼Œä½†æ˜¯createTimeã€updateTimeä¸¤ä¸ªå­—æ®µå€¼å¹¶æœªæˆåŠŸå°è£…ï¼Œè€Œæ•°æ®åº“ä¸­æ˜¯æœ‰å¯¹åº”çš„å­—æ®µå€¼çš„ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-280-1024x242.png" alt="img"></p><p>åŸå› å¦‚ä¸‹ï¼š</p><ul><li>å®ä½“ç±»å±æ€§åå’Œæ•°æ®åº“è¡¨æŸ¥è¯¢è¿”å›çš„å­—æ®µåä¸€è‡´ï¼Œmybatisä¼šè‡ªåŠ¨å°è£…ã€‚</li><li>å¦‚æœå®ä½“ç±»å±æ€§åå’Œæ•°æ®åº“è¡¨æŸ¥è¯¢è¿”å›çš„å­—æ®µåä¸ä¸€è‡´ï¼Œä¸èƒ½è‡ªåŠ¨å°è£…ã€‚</li></ul><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>æ‰‹åŠ¨ç»“æœæ˜ å°„</li><li>èµ·åˆ«å</li><li>å¼€å¯é©¼å³°å‘½å</li></ul><p><strong>1).</strong> <strong>æ‰‹åŠ¨ç»“æœæ˜ å°„</strong></p><p>åœ¨DeptMapperæ¥å£æ–¹æ³•ä¸Šï¼Œé€šè¿‡ @ResultsåŠ@Result è¿›è¡Œæ‰‹åŠ¨ç»“æœæ˜ å°„ã€‚</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Results</span>(&#123;<span class="variable">@Result</span>(column = <span class="string">&quot;create_time&quot;</span>, property = <span class="string">&quot;createTime&quot;</span>),</span><br><span class="line">          <span class="variable">@Result</span>(column = <span class="string">&quot;update_time&quot;</span>, property = <span class="string">&quot;updateTime&quot;</span>)&#125;)</span><br><span class="line"><span class="variable">@Select</span>(<span class="string">&quot;select id, name, create_time, update_time from dept&quot;</span>)</span><br><span class="line">public List&lt;Dept&gt; <span class="built_in">findAll</span>();</span><br></pre></td></tr></table></figure><p><strong>2). èµ·åˆ«å</strong></p><p>åœ¨SQLè¯­å¥ä¸­ï¼Œå¯¹ä¸ä¸€æ ·çš„åˆ—åèµ·åˆ«åï¼Œåˆ«åå’Œå®ä½“ç±»å±æ€§åä¸€æ ·ã€‚</p><p><strong>3). å¼€å¯é©¼å³°å‘½å</strong>**(æ¨è)**</p><p>å¦‚æœå­—æ®µåä¸å±æ€§åç¬¦åˆé©¼å³°å‘½åè§„åˆ™ï¼Œmybatisä¼šè‡ªåŠ¨é€šè¿‡é©¼å³°å‘½åè§„åˆ™æ˜ å°„ã€‚é©¼å³°å‘½åè§„åˆ™ï¼š abc_xyz =&gt; abcXyz</p><ul><li>è¡¨ä¸­å­—æ®µåï¼šabc_xyz</li><li>ç±»ä¸­å±æ€§åï¼šabcXyz</li></ul><p>åœ¨application.ymlä¸­åšå¦‚ä¸‹é…ç½®ï¼Œå¼€å¯å¼€å…³ã€‚</p><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mybatis:</span><br><span class="line">  <span class="keyword">configuration</span>:</span><br><span class="line">    <span class="keyword">map</span>-underscore-<span class="keyword">to</span>-camel-<span class="keyword">case</span>: <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="2-2äº†è§£å‰åç«¯è”è°ƒæ—¶çš„è¯·æ±‚è®¿é—®è¿‡ç¨‹ï¼ˆåå‘ä»£ç†ï¼‰">2.2äº†è§£å‰åç«¯è”è°ƒæ—¶çš„è¯·æ±‚è®¿é—®è¿‡ç¨‹ï¼ˆåå‘ä»£ç†ï¼‰</h3><p>å‰ç«¯å·¥ç¨‹è¯·æ±‚æœåŠ¡å™¨çš„åœ°å€ä¸º <code>http://localhost:90/api/depts</code>ï¼Œæ˜¯å¦‚ä½•è®¿é—®åˆ°åç«¯çš„tomcatæœåŠ¡å™¨çš„ï¼Ÿ</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-281.png" alt="img"></p><p>å…¶å®è¿™é‡Œï¼Œæ˜¯é€šè¿‡å‰ç«¯æœåŠ¡Nginxä¸­æä¾›çš„åå‘ä»£ç†åŠŸèƒ½å®ç°çš„ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-283.png" alt="img"></p><p>1). æµè§ˆå™¨å‘èµ·è¯·æ±‚ï¼Œè¯·æ±‚çš„æ˜¯localhost:90 ï¼Œé‚£å…¶å®è¯·æ±‚çš„æ˜¯nginxæœåŠ¡å™¨ã€‚</p><p>2). åœ¨nginxæœåŠ¡å™¨ä¸­å‘¢ï¼Œå¹¶æ²¡æœ‰å¯¹è¯·æ±‚ç›´æ¥è¿›è¡Œå¤„ç†ï¼Œè€Œæ˜¯å°†è¯·æ±‚è½¬å‘ç»™äº†åç«¯çš„tomcatæœåŠ¡å™¨ï¼Œæœ€ç»ˆç”±tomcatæœåŠ¡å™¨æ¥å¤„ç†è¯¥è¯·æ±‚ã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯é€šè¿‡nginxçš„åå‘ä»£ç†å®ç°çš„ã€‚</p><p><strong>é—®ï¼šé‚£ä¸ºä»€ä¹ˆæµè§ˆå™¨ä¸ç›´æ¥è¯·æ±‚åç«¯çš„tomcatæœåŠ¡å™¨ï¼Œè€Œæ˜¯ç›´æ¥è¯·æ±‚nginxæœåŠ¡å™¨å‘¢ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹åŸå› ï¼š</strong></p><p>1). å®‰å…¨ï¼šç”±äºåç«¯çš„tomcatæœåŠ¡å™¨ä¸€èˆ¬éƒ½ä¼šæ­å»ºé›†ç¾¤ï¼Œä¼šæœ‰å¾ˆå¤šçš„æœåŠ¡å™¨ï¼ŒæŠŠæ‰€æœ‰çš„tomcatæš´éœ²ç»™å‰ç«¯ï¼Œè®©å‰ç«¯ç›´æ¥è¯·æ±‚tomcatï¼Œå¯¹äºåç«¯æœåŠ¡å™¨æ˜¯æ¯”è¾ƒå±é™©çš„ã€‚</p><p>2). çµæ´»ï¼šåŸºäºnginxçš„åå‘ä»£ç†å®ç°ï¼Œæ›´åŠ çµæ´»ï¼Œåç«¯æƒ³å¢åŠ ã€å‡å°‘æœåŠ¡å™¨ï¼Œå¯¹äºå‰ç«¯æ¥è¯´æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œåªéœ€è¦åœ¨nginxä¸­é…ç½®å³å¯ã€‚</p><p>3). è´Ÿè½½å‡è¡¡ï¼šåŸºäºnginxçš„åå‘ä»£ç†ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„å®ç°åç«¯tomcatçš„è´Ÿè½½å‡è¡¡æ“ä½œã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-328-1024x251.png" alt="img"></p><p>å…·ä½“çš„è¯·æ±‚è®¿é—®æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-284-1024x321.png" alt="img"></p><ol><li>locationï¼šç”¨äºå®šä¹‰åŒ¹é…ç‰¹å®šuriè¯·æ±‚çš„è§„åˆ™ã€‚</li><li>^~ /api/ï¼šè¡¨ç¤ºç²¾ç¡®åŒ¹é…ï¼Œå³åªåŒ¹é…ä»¥/api/å¼€å¤´çš„è·¯å¾„ã€‚</li><li>rewriteï¼šè¯¥æŒ‡ä»¤ç”¨äºé‡å†™åŒ¹é…åˆ°çš„uriè·¯å¾„ã€‚</li><li>proxy_passï¼šè¯¥æŒ‡ä»¤ç”¨äºä»£ç†è½¬å‘ï¼Œå®ƒå°†åŒ¹é…åˆ°çš„è¯·æ±‚è½¬å‘ç»™ä½äºåç«¯çš„æŒ‡ä»¤æœåŠ¡å™¨ã€‚</li></ol><h2 id="3-åˆ é™¤éƒ¨é—¨">3.åˆ é™¤éƒ¨é—¨</h2><h3 id="3-1åŸºæœ¬å®ç°">3.1åŸºæœ¬å®ç°</h3><h4 id="3-1-1éœ€æ±‚">3.1.1éœ€æ±‚</h4><p>åˆ é™¤éƒ¨é—¨æ•°æ®ã€‚åœ¨ç‚¹å‡» â€œåˆ é™¤â€ æŒ‰é’®ï¼Œä¼šæ ¹æ®IDåˆ é™¤éƒ¨é—¨æ•°æ®ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-287-1024x419.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-289-707x1024.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-290.png" alt="img"></p><h4 id="3-1-2å®ç°æ€è·¯">3.1.2å®ç°æ€è·¯</h4><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-291-1024x263.png" alt="img"></p><h4 id="3-1-3ç®€å•å‚æ•°æ¥æ”¶">3.1.3ç®€å•å‚æ•°æ¥æ”¶</h4><p>åœ¨controllerä¸­ï¼Œéœ€è¦æ¥æ”¶å‰ç«¯ä¼ é€’çš„è¯·æ±‚å‚æ•°ã€‚ é‚£æ¥ä¸‹æ¥ï¼Œå°±å…ˆæ¥çœ‹çœ‹åœ¨æœåŠ¡å™¨ç«¯çš„Controllerç¨‹åºä¸­ï¼Œå¦‚ä½•è·å–è¿™ç±»ç®€å•å‚æ•°ã€‚ å…·ä½“çš„æ–¹æ¡ˆæœ‰å¦‚ä¸‹ä¸‰ç§ï¼š</p><p><strong>æ–¹æ¡ˆä¸€ï¼šé€šè¿‡åŸå§‹çš„ <code>HttpServletRequest</code> å¯¹è±¡è·å–è¯·æ±‚å‚æ•°</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ ¹æ®IDåˆ é™¤éƒ¨é—¨ - ç®€å•å‚æ•°æ¥æ”¶: æ–¹å¼ä¸€ (HttpServletRequest)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">@DeleteMapping(&quot;/depts&quot;)</span><br><span class="line"><span class="built_in">public</span> Result <span class="keyword">delete</span>(HttpServletRequest request)&#123;</span><br><span class="line">    String idStr = request.getParameter(&quot;id&quot;);</span><br><span class="line">    <span class="type">int</span> id = <span class="type">Integer</span>.parseInt(idStr);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;æ ¹æ®IDåˆ é™¤éƒ¨é—¨: &quot; + id);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹æ¡ˆå®ç°è¾ƒä¸ºç¹çï¼Œè€Œä¸”è¿˜éœ€è¦è¿›è¡Œæ‰‹åŠ¨ç±»å‹è½¬æ¢ã€‚<strong>ã€é¡¹ç›®å¼€å‘å¾ˆå°‘ç”¨ã€‘</strong></p><p><strong>æ–¹æ¡ˆäºŒï¼šé€šè¿‡Springæä¾›çš„ <code>@RequestParam</code> æ³¨è§£ï¼Œå°†è¯·æ±‚å‚æ•°ç»‘å®šç»™æ–¹æ³•å½¢å‚</strong></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@DeleteMapping</span>(<span class="string">&quot;/depts&quot;</span>)</span><br><span class="line">public Result <span class="built_in">delete</span>(<span class="variable">@RequestParam</span>(<span class="string">&quot;id&quot;</span>) Integer deptId)&#123;</span><br><span class="line">    <span class="selector-tag">System</span><span class="selector-class">.out</span><span class="selector-class">.println</span>(<span class="string">&quot;æ ¹æ®IDåˆ é™¤éƒ¨é—¨: &quot;</span> + deptId);</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">Result</span><span class="selector-class">.success</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>@RequestParam</code> æ³¨è§£çš„valueå±æ€§ï¼Œéœ€è¦ä¸å‰ç«¯ä¼ é€’çš„å‚æ•°åä¿æŒä¸€è‡´ ã€‚</p><p>@RequestParamæ³¨è§£requiredå±æ€§é»˜è®¤ä¸ºtrueï¼Œä»£è¡¨è¯¥å‚æ•°å¿…é¡»ä¼ é€’ï¼Œå¦‚æœä¸ä¼ é€’å°†æŠ¥é”™ã€‚ å¦‚æœå‚æ•°å¯é€‰ï¼Œå¯ä»¥å°†å±æ€§è®¾ç½®ä¸ºfalseã€‚</p><p><strong>æ–¹æ¡ˆä¸‰ï¼šå¦‚æœè¯·æ±‚å‚æ•°åä¸å½¢å‚å˜é‡åç›¸åŒï¼Œç›´æ¥å®šä¹‰æ–¹æ³•å½¢å‚å³å¯æ¥æ”¶ã€‚ï¼ˆçœç•¥@RequestParamï¼‰</strong></p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(<span class="string">&quot;/depts&quot;</span>)</span></span><br><span class="line"><span class="keyword">public</span> Result delete(Integer id)&#123;</span><br><span class="line">    System.<span class="keyword">out</span>.println(<span class="string">&quot;æ ¹æ®IDåˆ é™¤éƒ¨é—¨: &quot;</span> + deptId);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºä»¥ä¸Šçš„è¿™ä¸‰ç§æ–¹æ¡ˆï¼Œ<strong>æ¨èç¬¬ä¸‰ç§æ–¹æ¡ˆ</strong>ã€‚</p><h4 id="3-1-4ä»£ç å®ç°">3.1.4ä»£ç å®ç°</h4><p><strong>1). Controllerå±‚</strong></p><p>åœ¨ <code>DeptMapper</code> ä¸­ï¼Œå¢åŠ  <code>delete</code> æ–¹æ³•ï¼Œä»£ç å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * æ ¹æ®<span class="built_in">id</span>åˆ é™¤éƒ¨é—¨ - delete http://localhost:8080/depts?<span class="built_in">id</span>=1</span><br><span class="line"> */</span><br><span class="line">@DeleteMapping(<span class="string">&quot;/depts&quot;</span>)</span><br><span class="line">public Result delete(Integer <span class="built_in">id</span>)&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ ¹æ®idåˆ é™¤éƒ¨é—¨, id=&quot;</span> + <span class="built_in">id</span>);</span><br><span class="line">    deptService.deleteById(<span class="built_in">id</span>);</span><br><span class="line">    <span class="built_in">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2). Serviceå±‚</strong></p><p>åœ¨ <code>DeptService</code> ä¸­ï¼Œå¢åŠ  <code>deleteById</code> æ–¹æ³•ï¼Œä»£ç å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** * æ ¹æ®idåˆ é™¤éƒ¨é—¨ */</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">deleteById</span><span class="params">(Integer id)</span></span>;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>DeptServiceImpl</code> ä¸­ï¼Œå¢åŠ  <code>deleteById</code> æ–¹æ³•ï¼Œä»£ç å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> deleteById(Integer <span class="built_in">id</span>) &#123;</span><br><span class="line">    deptMapper.deleteById(<span class="built_in">id</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3). Mapperå±‚</strong></p><p>åœ¨ <code>DeptMapper</code> ä¸­ï¼Œå¢åŠ  <code>deleteById</code> æ–¹æ³•ï¼Œä»£ç å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** * æ ¹æ®idåˆ é™¤éƒ¨é—¨ */</span></span><br><span class="line"><span class="variable">@Delete</span>(<span class="string">&quot;delete from dept where id = #&#123;id&#125;&quot;</span>)</span><br><span class="line">void <span class="built_in">deleteById</span>(Integer id);</span><br></pre></td></tr></table></figure><p>å¯¹äº DML è¯­å¥æ¥è¯´ï¼Œæ‰§è¡Œå®Œæ¯•ï¼Œä¹Ÿæ˜¯æœ‰è¿”å›å€¼çš„ï¼Œè¿”å›å€¼ä»£è¡¨çš„æ˜¯å¢åˆ æ”¹æ“ä½œï¼Œå½±å“çš„è®°å½•æ•°ï¼Œæ‰€ä»¥å¯ä»¥å°†æ‰§è¡Œ DML è¯­å¥çš„æ–¹æ³•è¿”å›å€¼è®¾ç½®ä¸º Integerã€‚ ä½†æ˜¯ä¸€èˆ¬å¼€å‘æ—¶ï¼Œæ˜¯ä¸éœ€è¦è¿™ä¸ªè¿”å›å€¼çš„ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºvoidã€‚</p><h2 id="4-æ–°å¢éƒ¨é—¨">4.æ–°å¢éƒ¨é—¨</h2><h3 id="4-1åŸºæœ¬å®ç°">4.1åŸºæœ¬å®ç°</h3><h4 id="4-1-1éœ€æ±‚">4.1.1éœ€æ±‚</h4><p>ç‚¹å‡» â€œæ–°å¢éƒ¨é—¨â€ çš„æŒ‰é’®ä¹‹åï¼Œå¼¹å‡ºæ–°å¢éƒ¨é—¨è¡¨å•ï¼Œå¡«å†™éƒ¨é—¨åç§°ä¹‹åï¼Œç‚¹å‡»ç¡®å®šä¹‹åï¼Œä¿å­˜éƒ¨é—¨æ•°æ®ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-292-1024x404.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-293-1024x602.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-295-1024x533.png" alt="img"></p><h4 id="4-1-2å®ç°æ€è·¯">4.1.2å®ç°æ€è·¯</h4><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-294-1024x266.png" alt="img"></p><h4 id="4-1-3jsonå‚æ•°æ¥æ”¶">4.1.3jsonå‚æ•°æ¥æ”¶</h4><p>åœ¨controllerä¸­ï¼Œéœ€è¦æ¥æ”¶å‰ç«¯ä¼ é€’çš„è¯·æ±‚å‚æ•°ã€‚ é‚£æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å…ˆæ¥çœ‹çœ‹åœ¨æœåŠ¡å™¨ç«¯çš„Controllerç¨‹åºä¸­ï¼Œå¦‚ä½•è·å–jsonæ ¼å¼çš„å‚æ•°ã€‚</p><ul><li>JSONæ ¼å¼çš„å‚æ•°ï¼Œé€šå¸¸ä¼šä½¿ç”¨ä¸€ä¸ªå®ä½“å¯¹è±¡è¿›è¡Œæ¥æ”¶ ã€‚</li><li>è§„åˆ™ï¼šJSONæ•°æ®çš„é”®åä¸æ–¹æ³•å½¢å‚å¯¹è±¡çš„å±æ€§åç›¸åŒï¼Œå¹¶éœ€è¦ä½¿ç”¨<code>@RequestBody</code>æ³¨è§£æ ‡è¯†ã€‚</li></ul><p>å‰ç«¯ä¼ é€’çš„è¯·æ±‚å‚æ•°æ ¼å¼ä¸ºjsonï¼Œå†…å®¹å¦‚ä¸‹ï¼š<code>&#123;&quot;name&quot;:&quot;ç ”å‘éƒ¨&quot;&#125;</code>ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªå¯¹è±¡æ¥æ¥æ”¶ï¼Œåªéœ€è¦ä¿è¯å¯¹è±¡ä¸­æœ‰nameå±æ€§å³å¯ã€‚</p><h4 id="4-1-4ä»£ç å®ç°">4.1.4ä»£ç å®ç°</h4><p><strong>1). Controllerå±‚</strong></p><p>åœ¨<code>DeptController</code>ä¸­å¢åŠ æ–¹æ³•saveï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** * æ–°å¢éƒ¨é—¨ - POST http://localhost:8080/depts   è¯·æ±‚å‚æ•°ï¼š&#123;&quot;name&quot;:&quot;ç ”å‘éƒ¨&quot;&#125; */</span></span><br><span class="line"><span class="variable">@PostMapping</span>(<span class="string">&quot;/depts&quot;</span>)</span><br><span class="line">public Result <span class="built_in">save</span>(<span class="variable">@RequestBody</span> Dept dept)&#123;</span><br><span class="line">    <span class="selector-tag">System</span><span class="selector-class">.out</span><span class="selector-class">.println</span>(<span class="string">&quot;æ–°å¢éƒ¨é—¨, dept=&quot;</span> + dept);</span><br><span class="line">    <span class="selector-tag">deptService</span><span class="selector-class">.save</span>(dept);</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">Result</span><span class="selector-class">.success</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2). Serviceå±‚</strong></p><p>åœ¨<code>DeptService</code>ä¸­å¢åŠ æ¥å£æ–¹æ³•saveï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** * æ–°å¢éƒ¨é—¨ */</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">save</span><span class="params">(Dept dept)</span></span>;</span><br></pre></td></tr></table></figure><p>åœ¨<code>DeptServiceImpl</code>ä¸­å¢åŠ saveæ–¹æ³•ï¼Œå®Œæˆæ·»åŠ éƒ¨é—¨çš„æ“ä½œï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public void <span class="built_in">save</span>(Dept dept) &#123;</span><br><span class="line">    <span class="comment">//è¡¥å…¨åŸºç¡€å±æ€§</span></span><br><span class="line">    dept<span class="selector-class">.setCreateTime</span>(LocalDateTime.now());</span><br><span class="line">    dept<span class="selector-class">.setUpdateTime</span>(LocalDateTime.now());</span><br><span class="line">    <span class="comment">//ä¿å­˜éƒ¨é—¨</span></span><br><span class="line">    deptMapper<span class="selector-class">.insert</span>(dept);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3). Mapperå±‚</strong></p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** * ä¿å­˜éƒ¨é—¨ */</span></span><br><span class="line">@Insert(<span class="string">&quot;insert into dept(name,create_time,update_time) values(<span class="subst">#&#123;name&#125;</span>,<span class="subst">#&#123;createTime&#125;</span>,<span class="subst">#&#123;updateTime&#125;</span>)&quot;</span>)</span><br><span class="line"><span class="literal">void</span> insert(Dept dept);</span><br></pre></td></tr></table></figure><p>å¦‚æœåœ¨mapperæ¥å£ä¸­ï¼Œéœ€è¦ä¼ é€’å¤šä¸ªå‚æ•°ï¼Œå¯ä»¥æŠŠå¤šä¸ªå‚æ•°å°è£…åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ã€‚ åœ¨SQLè¯­å¥ä¸­è·å–å‚æ•°çš„æ—¶å€™ï¼Œ<code>#&#123;...&#125;</code> é‡Œé¢å†™çš„æ˜¯<strong>å¯¹è±¡çš„å±æ€§å</strong>ã€æ³¨æ„æ˜¯å±æ€§åï¼Œä¸æ˜¯è¡¨çš„å­—æ®µåã€‘ã€‚</p><h2 id="5-ä¿®æ”¹éƒ¨é—¨">5.ä¿®æ”¹éƒ¨é—¨</h2><p>å¯¹äºä»»ä½•ä¸šåŠ¡çš„ä¿®æ”¹åŠŸèƒ½æ¥è¯´ï¼Œä¸€èˆ¬éƒ½ä¼šåˆ†ä¸ºä¸¤æ­¥è¿›è¡Œï¼šæŸ¥è¯¢å›æ˜¾ã€ä¿®æ”¹æ•°æ®ã€‚</p><h3 id="5-1æŸ¥è¯¢å›æ˜¾">5.1æŸ¥è¯¢å›æ˜¾</h3><h4 id="5-1-1éœ€æ±‚">5.1.1éœ€æ±‚</h4><p>å½“æˆ‘ä»¬ç‚¹å‡» â€œç¼–è¾‘â€ çš„æ—¶å€™ï¼Œéœ€è¦æ ¹æ®IDæŸ¥è¯¢éƒ¨é—¨æ•°æ®ï¼Œç„¶åç”¨äºé¡µé¢å›æ˜¾å±•ç¤ºã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-324-1024x220.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-296-1024x556.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-297-1024x811.png" alt="img"></p><h4 id="5-1-2å®ç°æ€è·¯">5.1.2å®ç°æ€è·¯</h4><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-326-1024x259.png" alt="img"></p><h4 id="5-1-3è·¯å¾„å‚æ•°æ¥æ”¶">5.1.3è·¯å¾„å‚æ•°æ¥æ”¶</h4><p><code>/depts/1</code>ï¼Œ<code>/depts/2</code> è¿™ç§åœ¨urlä¸­ä¼ é€’çš„å‚æ•°ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<strong>è·¯å¾„å‚æ•°</strong>ã€‚ é‚£ä¹ˆå¦‚ä½•æ¥æ”¶è¿™æ ·çš„è·¯å¾„å‚æ•°å‘¢ ï¼Ÿ</p><p>è·¯å¾„å‚æ•°ï¼šé€šè¿‡è¯·æ±‚URLç›´æ¥ä¼ é€’å‚æ•°ï¼Œä½¿ç”¨{â€¦}æ¥æ ‡è¯†è¯¥è·¯å¾„å‚æ•°ï¼Œéœ€è¦ä½¿ç”¨ **<code>@PathVariable</code>**è·å–è·¯å¾„å‚æ•°ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-325-1024x210.png" alt="img"></p><p>å¦‚æœè·¯å¾„å‚æ•°åä¸controlleræ–¹æ³•å½¢å‚åç§°ä¸€è‡´ï¼Œ<code>@PathVariable</code>æ³¨è§£çš„valueå±æ€§æ˜¯å¯ä»¥çœç•¥çš„</p><h4 id="5-1-4ä»£ç å®ç°">5.1.4ä»£ç å®ç°</h4><p><strong>1). Controllerå±‚</strong></p><p>åœ¨ <code>DeptController</code> ä¸­å¢åŠ  <code>getById</code>æ–¹æ³•ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** * æ ¹æ®IDæŸ¥è¯¢ - GET http://localhost:8080/depts/1 */</span></span><br><span class="line"><span class="meta">@GetMapping(<span class="string">&quot;/depts/&#123;id&#125;&quot;</span>)</span></span><br><span class="line"><span class="keyword">public</span> Result getById(<span class="meta">@PathVariable</span> Integer id)&#123;</span><br><span class="line">    System.<span class="keyword">out</span>.println(<span class="string">&quot;æ ¹æ®IDæŸ¥è¯¢, id=&quot;</span> + id);</span><br><span class="line">    Dept dept = deptService.getById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success(dept);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2). Serviceå±‚</strong></p><p>åœ¨ <code>DeptService</code> ä¸­å¢åŠ  <code>getById</code>æ–¹æ³•ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** * æ ¹æ®idæŸ¥è¯¢éƒ¨é—¨ */</span></span><br><span class="line">Dept <span class="built_in">getById</span>(Integer id);</span><br></pre></td></tr></table></figure><p>åœ¨ <code>DeptServiceImpl</code> ä¸­å¢åŠ  <code>getById</code>æ–¹æ³•ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function">Dept <span class="title">getById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">return</span> deptMapper.<span class="title">getById</span><span class="params">(id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3). Mapperå±‚</strong></p><p>åœ¨ <code>DeptMapper</code> ä¸­å¢åŠ  <code>getById</code> æ–¹æ³•ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><p>/** * æ ¹æ®IDæŸ¥è¯¢éƒ¨é—¨æ•°æ® */ @Select(â€œselect id, name, create_time, update_time from dept where id = #{id}â€) Dept getById(Integer id);</p><h3 id="5-2ä¿®æ”¹æ•°æ®">5.2ä¿®æ”¹æ•°æ®</h3><h4 id="5-2-1éœ€æ±‚">5.2.1éœ€æ±‚</h4><p>æŸ¥è¯¢å›æ˜¾å›æ¥ä¹‹åï¼Œå°±å¯ä»¥å¯¹éƒ¨é—¨çš„ä¿¡æ¯è¿›è¡Œä¿®æ”¹äº†ï¼Œä¿®æ”¹å®Œæ¯•ä¹‹åï¼Œç‚¹å‡»ç¡®å®šï¼Œæ­¤æ—¶ï¼Œå°±éœ€è¦æ ¹æ®IDä¿®æ”¹éƒ¨é—¨çš„æ•°æ®ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-298-1024x597.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-299-1024x654.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-300-1024x537.png" alt="img"></p><h4 id="5-2-2å®ç°æ€è·¯">5.2.2å®ç°æ€è·¯</h4><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-301-1024x269.png" alt="img"></p><p>é€šè¿‡æ¥å£æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‰ç«¯ä¼ é€’çš„è¯·æ±‚å‚æ•°æ˜¯jsonæ ¼å¼çš„è¯·æ±‚å‚æ•°ï¼Œåœ¨Controllerçš„æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>@RequestBody</code> æ³¨è§£æ¥æ¥æ”¶ï¼Œå¹¶å°†å…¶å°è£…åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ã€‚</p><h4 id="5-2-3ä»£ç å®ç°">5.2.3ä»£ç å®ç°</h4><ol><li></li></ol><p><strong>1). Controllerå±‚</strong></p><p>åœ¨ <code>DeptController</code> ä¸­å¢åŠ  <code>update</code> æ–¹æ³•ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** * ä¿®æ”¹éƒ¨é—¨ - PUT http://localhost:8080/depts  è¯·æ±‚å‚æ•°ï¼š&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;ç ”å‘éƒ¨&quot;&#125; */</span></span><br><span class="line"><span class="variable">@PutMapping</span>(<span class="string">&quot;/depts&quot;</span>)</span><br><span class="line">public Result <span class="built_in">update</span>(<span class="variable">@RequestBody</span> Dept dept)&#123;</span><br><span class="line">    <span class="selector-tag">System</span><span class="selector-class">.out</span><span class="selector-class">.println</span>(<span class="string">&quot;ä¿®æ”¹éƒ¨é—¨, dept=&quot;</span> + dept);</span><br><span class="line">    <span class="selector-tag">deptService</span><span class="selector-class">.update</span>(dept);</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">Result</span><span class="selector-class">.success</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2). Serviceå±‚</strong></p><p>åœ¨ <code>DeptService</code> ä¸­å¢åŠ  <code>update</code> æ–¹æ³•ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** * ä¿®æ”¹éƒ¨é—¨ */</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(Dept dept)</span></span>;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>DeptServiceImpl</code> ä¸­å¢åŠ  <code>update</code> æ–¹æ³•ã€‚ ç”±äºæ˜¯ä¿®æ”¹æ“ä½œï¼Œæ¯ä¸€æ¬¡ä¿®æ”¹æ•°æ®ï¼Œéƒ½éœ€è¦æ›´æ–°updateTimeã€‚æ‰€ä»¥ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public void <span class="built_in">update</span>(Dept dept) &#123;</span><br><span class="line">    <span class="comment">//è¡¥å…¨åŸºç¡€å±æ€§</span></span><br><span class="line">    dept<span class="selector-class">.setUpdateTime</span>(LocalDateTime.now());</span><br><span class="line">    <span class="comment">//ä¿å­˜éƒ¨é—¨</span></span><br><span class="line">    deptMapper<span class="selector-class">.update</span>(dept);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3). Mapperå±‚</strong></p><p>åœ¨ <code>DeptMapper</code> ä¸­å¢åŠ  <code>update</code> æ–¹æ³•ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** * æ›´æ–°éƒ¨é—¨ */</span></span><br><span class="line">@Update(<span class="string">&quot;update dept set name = <span class="subst">#&#123;name&#125;</span>,update_time = <span class="subst">#&#123;updateTime&#125;</span> where id = <span class="subst">#&#123;id&#125;</span>&quot;</span>)</span><br><span class="line"><span class="literal">void</span> update(Dept dept);</span><br></pre></td></tr></table></figure><h3 id="5-3-RequestMapping">5.3@RequestMapping</h3><p>åˆ°æ­¤ï¼Œå…³äºåŸºæœ¬çš„éƒ¨é—¨çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½ï¼Œå·²ç»å®ç°äº†ã€‚ æˆ‘ä»¬ä¼šå‘ç°ï¼Œæˆ‘ä»¬åœ¨ <code>DeptController</code> ä¸­æ‰€å®šä¹‰çš„æ–¹æ³•ï¼Œæ‰€æœ‰çš„è¯·æ±‚è·¯å¾„ï¼Œéƒ½æ˜¯ <code>/depts</code> å¼€å¤´çš„ï¼Œåªè¦æ“ä½œçš„æ˜¯éƒ¨é—¨æ•°æ®ï¼Œè¯·æ±‚è·¯å¾„éƒ½æ˜¯ <code>/depts</code> å¼€å¤´ã€‚</p><p>é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å…¶å®æ˜¯å¯ä»¥æŠŠè¿™ä¸ªå…¬å…±çš„è·¯å¾„ <code>/depts</code> æŠ½å–åˆ°ç±»ä¸Šçš„ï¼Œé‚£åœ¨å„ä¸ªæ–¹æ³•ä¸Šï¼Œå°±å¯ä»¥çœç•¥äº†è¿™ä¸ª <code>/depts</code> è·¯å¾„ã€‚ ä»£ç å¦‚ä¸‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-327-1024x579.png" alt="img"></p><p>ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚è·¯å¾„ï¼Œåº”è¯¥æ˜¯ç±»ä¸Šçš„ @RequestMapping çš„valueå±æ€§ + æ–¹æ³•ä¸Šçš„ @RequestMappingçš„valueå±æ€§ã€‚</p><h2 id="6-æ—¥å¿—æŠ€æœ¯ï¼ˆLogbackï¼‰">6.æ—¥å¿—æŠ€æœ¯ï¼ˆLogbackï¼‰</h2><h3 id="6-1æ—¥å¿—æ¡†æ¶">6.1æ—¥å¿—æ¡†æ¶</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-302-1024x296.png" alt="img"></p><ul><li><strong>JUL</strong>**ï¼š**è¿™æ˜¯JavaSEå¹³å°æä¾›çš„å®˜æ–¹æ—¥å¿—æ¡†æ¶ï¼Œä¹Ÿè¢«ç§°ä¸ºJULã€‚é…ç½®ç›¸å¯¹ç®€å•ï¼Œä½†ä¸å¤Ÿçµæ´»ï¼Œæ€§èƒ½è¾ƒå·®ã€‚</li><li><strong>Log4j</strong>**ï¼š**ä¸€ä¸ªæµè¡Œçš„æ—¥å¿—æ¡†æ¶ï¼Œæä¾›äº†çµæ´»çš„é…ç½®é€‰é¡¹ï¼Œæ”¯æŒå¤šç§è¾“å‡ºç›®æ ‡ã€‚</li><li>**Logbackï¼š**åŸºäºLog4jå‡çº§è€Œæ¥ï¼Œæä¾›äº†æ›´å¤šçš„åŠŸèƒ½å’Œé…ç½®é€‰é¡¹ï¼Œæ€§èƒ½ç”±äºLog4jã€‚</li><li><strong>Slf4j</strong>**ï¼š**ï¼ˆSimple Logging Facade for Javaï¼‰ç®€å•æ—¥å¿—é—¨é¢ï¼Œæä¾›äº†ä¸€å¥—æ—¥å¿—æ“ä½œçš„æ ‡å‡†æ¥å£åŠæŠ½è±¡ç±»ï¼Œå…è®¸åº”ç”¨ç¨‹åºä½¿ç”¨ä¸åŒçš„åº•å±‚æ—¥å¿—æ¡†æ¶ã€‚</li></ul><h3 id="6-2Logbackå…¥é—¨">6.2Logbackå…¥é—¨</h3><p><strong>1). å‡†å¤‡å·¥ä½œï¼šå¼•å…¥logbackçš„ä¾èµ–ï¼ˆspringbootä¸­æ— éœ€å¼•å…¥ï¼Œåœ¨springbootä¸­å·²ç»ä¼ é€’äº†æ­¤ä¾èµ–ï¼‰</strong></p><p><strong>2). å¼•å…¥é…ç½®æ–‡ä»¶ <code>logback.xml</code> ï¼ˆç›´æ¥AIç”Ÿæˆï¼‰</strong></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- æ§åˆ¶å°è¾“å‡º --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="comment">&lt;!--æ ¼å¼åŒ–è¾“å‡ºï¼š%dè¡¨ç¤ºæ—¥æœŸï¼Œ%threadè¡¨ç¤ºçº¿ç¨‹åï¼Œ%-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦  %msgï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ%næ˜¯æ¢è¡Œç¬¦ --&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d</span><span class="template-variable">&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;</span><span class="language-xml"> [%thread] %-5level %logger</span><span class="template-variable">&#123;50&#125;</span><span class="language-xml">-%msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- æ—¥å¿—è¾“å‡ºçº§åˆ« --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;ALL&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><strong>3). è®°å½•æ—¥å¿—ï¼šå®šä¹‰æ—¥å¿—è®°å½•å¯¹è±¡Loggerï¼Œè®°å½•æ—¥å¿—</strong></p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//å®šä¹‰æ—¥å¿—è®°å½•å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(LogTest.<span class="keyword">class</span>);</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> testLog()&#123;</span><br><span class="line">        log.debug(<span class="string">&quot;å¼€å§‹è®¡ç®—...&quot;</span>);</span><br><span class="line">        <span class="built_in">int</span> <span class="keyword">sum</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">int</span>[] nums = &#123;<span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">34</span>, <span class="number">2</span>, <span class="number">23</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="keyword">sum</span> += nums[i];</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">&quot;è®¡ç®—ç»“æœä¸º: &quot;</span>+<span class="keyword">sum</span>);log.debug(<span class="string">&quot;ç»“æŸè®¡ç®—...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œå•å…ƒæµ‹è¯•ï¼Œå¯ä»¥åœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°è¾“å‡ºçš„æ—¥å¿—ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-303-1024x540.png" alt="img"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨è¾“å‡ºçš„æ—¥å¿—ä¿¡æ¯ä¸­ï¼Œä¸ä»…è¾“å‡ºäº†æ—¥å¿—çš„ä¿¡æ¯ï¼Œè¿˜åŒ…æ‹¬ï¼šæ—¥å¿—çš„è¾“å‡ºæ—¶é—´ã€çº¿ç¨‹åã€å…·ä½“åœ¨é‚£ä¸ªç±»ä¸­è¾“å‡ºçš„ã€‚</p><h3 id="6-3Logbacké…ç½®æ–‡ä»¶">6.3Logbacké…ç½®æ–‡ä»¶</h3><p>Logbackæ—¥å¿—æ¡†æ¶çš„é…ç½®æ–‡ä»¶å« <code>logback.xml</code> ã€‚</p><p>è¯¥é…ç½®æ–‡ä»¶æ˜¯å¯¹Logbackæ—¥å¿—æ¡†æ¶è¾“å‡ºçš„æ—¥å¿—è¿›è¡Œæ§åˆ¶çš„ï¼Œå¯ä»¥æ¥é…ç½®è¾“å‡ºçš„æ ¼å¼ã€ä½ç½®åŠæ—¥å¿—å¼€å…³ç­‰ã€‚</p><p>å¸¸ç”¨çš„ä¸¤ç§è¾“å‡ºæ—¥å¿—çš„ä½ç½®ï¼šæ§åˆ¶å°ã€ç³»ç»Ÿæ–‡ä»¶ã€‚</p><p><strong>1). å¦‚æœéœ€è¦è¾“å‡ºæ—¥å¿—åˆ°æ§åˆ¶å°ã€‚æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</strong></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="comment">&lt;!-- æ§åˆ¶å°è¾“å‡º --&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="comment">&lt;!--æ ¼å¼åŒ–è¾“å‡ºï¼š%d è¡¨ç¤ºæ—¥æœŸï¼Œ%thread è¡¨ç¤ºçº¿ç¨‹åï¼Œ%-5levelè¡¨ç¤ºçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦ï¼Œ%msgè¡¨ç¤ºæ—¥å¿—æ¶ˆæ¯ï¼Œ%nè¡¨ç¤ºæ¢è¡Œç¬¦ --&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d</span><span class="template-variable">&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;</span><span class="language-xml"> [%thread] %-5level %logger</span><span class="template-variable">&#123;50&#125;</span><span class="language-xml">-%msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><strong>2). å¦‚æœéœ€è¦è¾“å‡ºæ—¥å¿—åˆ°æ–‡ä»¶ã€‚æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</strong></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="comment">&lt;!-- æŒ‰ç…§æ¯å¤©ç”Ÿæˆæ—¥å¿—æ–‡ä»¶ --&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;FILE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!-- æ—¥å¿—æ–‡ä»¶è¾“å‡ºçš„æ–‡ä»¶å, %iè¡¨ç¤ºåºå· --&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">FileNamePattern</span>&gt;</span>D:/tlias-%d</span><span class="template-variable">&#123;yyyy-MM-dd&#125;</span><span class="language-xml">-%i.log<span class="tag">&lt;/<span class="name">FileNamePattern</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!-- æœ€å¤šä¿ç•™çš„å†å²æ—¥å¿—æ–‡ä»¶æ•°é‡ --&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">MaxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">MaxHistory</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!-- æœ€å¤§æ–‡ä»¶å¤§å°ï¼Œè¶…è¿‡è¿™ä¸ªå¤§å°ä¼šè§¦å‘æ»šåŠ¨åˆ°æ–°æ–‡ä»¶ï¼Œé»˜è®¤ä¸º 10MB --&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>10MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!--æ ¼å¼åŒ–è¾“å‡ºï¼š%d è¡¨ç¤ºæ—¥æœŸï¼Œ%thread è¡¨ç¤ºçº¿ç¨‹åï¼Œ%-5levelè¡¨ç¤ºçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦ï¼Œ%msgè¡¨ç¤ºæ—¥å¿—æ¶ˆæ¯ï¼Œ%nè¡¨ç¤ºæ¢è¡Œç¬¦ --&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d</span><span class="template-variable">&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;</span><span class="language-xml"> [%thread] %-5level %logger</span><span class="template-variable">&#123;50&#125;</span><span class="language-xml">-%msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><strong>3). æ—¥å¿—å¼€å…³é…ç½® ï¼ˆå¼€å¯æ—¥å¿—ï¼ˆALLï¼‰ï¼Œå–æ¶ˆæ—¥å¿—ï¼ˆOFFï¼‰ï¼‰</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ—¥å¿—è¾“å‡ºçº§åˆ« --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;ALL&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--è¾“å‡ºåˆ°æ§åˆ¶å°--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--è¾“å‡ºåˆ°æ–‡ä»¶--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="6-4æ—¥å¿—çº§åˆ«">6.4æ—¥å¿—çº§åˆ«</h3><p>å¸¸è§çš„æ—¥å¿—çº§åˆ«å¦‚ä¸‹ï¼ˆä¼˜å…ˆçº§ç”±ä½åˆ°é«˜ï¼‰ï¼š</p><table><thead><tr><th>æ—¥å¿—çº§åˆ«</th><th>è¯´æ˜</th><th>è®°å½•æ–¹å¼</th></tr></thead><tbody><tr><td>trace</td><td>è¿½è¸ªï¼Œè®°å½•ç¨‹åºè¿è¡Œè½¨è¿¹ ã€ä½¿ç”¨å¾ˆå°‘ã€‘</td><td>log.trace(â€œâ€¦â€)</td></tr><tr><td>debug</td><td>è°ƒè¯•ï¼Œè®°å½•ç¨‹åºè°ƒè¯•è¿‡ç¨‹ä¸­çš„ä¿¡æ¯ï¼Œå®é™…åº”ç”¨ä¸­ä¸€èˆ¬å°†å…¶è§†ä¸ºæœ€ä½çº§åˆ« ã€ä½¿ç”¨è¾ƒå¤šã€‘</td><td>log.debug(â€œâ€¦â€)</td></tr><tr><td>info</td><td>è®°å½•ä¸€èˆ¬ä¿¡æ¯ï¼Œæè¿°ç¨‹åºè¿è¡Œçš„å…³é”®äº‹ä»¶ï¼Œå¦‚ï¼šç½‘ç»œè¿æ¥ã€ioæ“ä½œ ã€ä½¿ç”¨è¾ƒå¤šã€‘</td><td><a href="http://log.info">log.info</a>(â€œâ€¦â€)</td></tr><tr><td>warn</td><td>è­¦å‘Šä¿¡æ¯ï¼Œè®°å½•æ½œåœ¨æœ‰å®³çš„æƒ…å†µ ã€ä½¿ç”¨è¾ƒå¤šã€‘</td><td>log.warn(â€œâ€¦â€)</td></tr><tr><td>error</td><td>é”™è¯¯ä¿¡æ¯ ã€ä½¿ç”¨è¾ƒå¤šã€‘</td><td>log.error(â€œâ€¦â€)</td></tr></tbody></table><p>å¯ä»¥åœ¨é…ç½®æ–‡ä»¶<code>logback.xml</code>ä¸­ï¼Œçµæ´»çš„æ§åˆ¶è¾“å‡ºé‚£äº›ç±»å‹çš„æ—¥å¿—ã€‚ï¼ˆå¤§äºç­‰äºé…ç½®çš„æ—¥å¿—çº§åˆ«çš„æ—¥å¿—æ‰ä¼šè¾“å‡ºï¼‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ—¥å¿—è¾“å‡ºçº§åˆ« --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--è¾“å‡ºåˆ°æ§åˆ¶å°--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--è¾“å‡ºåˆ°æ–‡ä»¶--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="6-5æ¡ˆä¾‹æ—¥å¿—è®°å½•">6.5æ¡ˆä¾‹æ—¥å¿—è®°å½•</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * éƒ¨é—¨ç®¡ç†æ§åˆ¶å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">@Slf4j</span><br><span class="line">@RequestMapping(&quot;/depts&quot;)</span><br><span class="line">@RestController</span><br><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> DeptController &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private DeptService deptService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢éƒ¨é—¨åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    //@RequestMapping(<span class="keyword">value</span> = &quot;/depts&quot;, <span class="keyword">method</span> = RequestMethod.<span class="keyword">GET</span>)</span><br><span class="line">    @GetMapping</span><br><span class="line">    <span class="built_in">public</span> Result list()&#123;</span><br><span class="line">        //<span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;æŸ¥è¯¢éƒ¨é—¨åˆ—è¡¨&quot;);</span><br><span class="line">        <span class="keyword">log</span>.<span class="keyword">info</span>(&quot;æŸ¥è¯¢éƒ¨é—¨åˆ—è¡¨&quot;);</span><br><span class="line">        List&lt;Dept&gt; deptList = deptService.findAll();</span><br><span class="line">        <span class="keyword">return</span> Result.success(deptList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®idåˆ é™¤éƒ¨é—¨ - delete http://localhost:8080/depts?id=1</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @DeleteMapping</span><br><span class="line">    <span class="built_in">public</span> Result <span class="keyword">delete</span>(<span class="type">Integer</span> id)&#123;</span><br><span class="line">        //<span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;æ ¹æ®idåˆ é™¤éƒ¨é—¨, id=&quot; + id);</span><br><span class="line">        <span class="keyword">log</span>.<span class="keyword">info</span>(&quot;æ ¹æ®idåˆ é™¤éƒ¨é—¨, id: &#123;&#125;&quot; , id);</span><br><span class="line">        deptService.deleteById(id);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢éƒ¨é—¨ - POST http://localhost:8080/depts   è¯·æ±‚å‚æ•°ï¼š&#123;&quot;name&quot;:&quot;ç ”å‘éƒ¨&quot;&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @PostMapping</span><br><span class="line">    <span class="built_in">public</span> Result save(@RequestBody Dept dept)&#123;</span><br><span class="line">        //<span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;æ–°å¢éƒ¨é—¨, dept=&quot; + dept);</span><br><span class="line">        <span class="keyword">log</span>.<span class="keyword">info</span>(&quot;æ–°å¢éƒ¨é—¨, dept: &#123;&#125;&quot; , dept);</span><br><span class="line">        deptService.save(dept);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®IDæŸ¥è¯¢ - GET http://localhost:8080/depts/1</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @GetMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="line">    <span class="built_in">public</span> Result getById(@PathVariable <span class="type">Integer</span> id)&#123;</span><br><span class="line">        //<span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;æ ¹æ®IDæŸ¥è¯¢, id=&quot; + id);</span><br><span class="line">        <span class="keyword">log</span>.<span class="keyword">info</span>(&quot;æ ¹æ®IDæŸ¥è¯¢, id: &#123;&#125;&quot; , id);</span><br><span class="line">        Dept dept = deptService.getById(id);</span><br><span class="line">        <span class="keyword">return</span> Result.success(dept);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿®æ”¹éƒ¨é—¨ - PUT http://localhost:8080/depts  è¯·æ±‚å‚æ•°ï¼š&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;ç ”å‘éƒ¨&quot;&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @PutMapping</span><br><span class="line">    <span class="built_in">public</span> Result <span class="keyword">update</span>(@RequestBody Dept dept)&#123;</span><br><span class="line">        //<span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;ä¿®æ”¹éƒ¨é—¨, dept=&quot; + dept);</span><br><span class="line">        <span class="keyword">log</span>.<span class="keyword">info</span>(&quot;ä¿®æ”¹éƒ¨é—¨, dept: &#123;&#125;&quot; , dept);</span><br><span class="line">        deptService.<span class="keyword">update</span>(dept);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>lombokä¸­æä¾›çš„@Slf4jæ³¨è§£ï¼Œå¯ä»¥ç®€åŒ–å®šä¹‰æ—¥å¿—è®°å½•å™¨è¿™æ­¥æ“ä½œã€‚æ·»åŠ äº†è¯¥æ³¨è§£ï¼Œå°±ç›¸å½“äºåœ¨ç±»ä¸­å®šä¹‰äº†æ—¥å¿—è®°å½•å™¨ï¼Œå°±ä¸‹é¢è¿™å¥ä»£ç ï¼š</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private static Logger <span class="keyword">log</span> = LoggerFactory. getLogger(Xxx. <span class="class"><span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šè¯·æŒ‡å®šç¨³å®šçš„lombokï¼Œå› ä¸ºæœ€è¿‘jdkå¯èƒ½ä¼šå‡ºç°å…¼å®¹é—®é¢˜ï¼Œé€šè¿‡æŒ‡å®šç‰ˆæœ¬ 1.18.30é˜²æ­¢æŠ¥é”™</p><h1 id="â€“å‘˜å·¥ç®¡ç†æ¨¡å—">â€“å‘˜å·¥ç®¡ç†æ¨¡å—</h1><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-304.png" alt="img"></p><p>ä»é¡µé¢åŸå‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯çš„æ—¶å€™ï¼Œé™¤äº†è¦å±•ç¤º å§“åã€æ€§åˆ«ã€å¤´åƒã€èŒä½ã€å…¥èŒæ—¥æœŸã€æœ€åæ“ä½œæ—¶é—´è¿™äº›å‘˜å·¥ä¿¡æ¯å¤–ï¼Œè¿˜è¦å±•ç¤ºå‡ºæ‰€å±éƒ¨é—¨ï¼Œé‚£æ­¤æ—¶å°±éœ€è¦ä»ä¸¤å¼ è¡¨ä¸­æŸ¥è¯¢æ•°æ®ï¼Œä¸€å¼ æ˜¯éƒ¨é—¨è¡¨ï¼Œä¸€å¼ æ˜¯å‘˜å·¥è¡¨ï¼Œæ­¤æ—¶å°±ä¼šæ¶‰åŠåˆ°å¤šè¡¨æ“ä½œã€‚ï¼ˆå…·ä½“è§mysqlå†…å®¹ï¼Œè¿™é‡Œä¸èŠ±æ—¶é—´é˜è¿°ï¼‰</p><h2 id="1-å‘˜å·¥åˆ—è¡¨æŸ¥è¯¢">1.å‘˜å·¥åˆ—è¡¨æŸ¥è¯¢</h2><p>é‚£æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦æ¥å®Œæˆçš„æ˜¯å‘˜å·¥åˆ—è¡¨çš„æŸ¥è¯¢åŠŸèƒ½å®ç°ã€‚ å…·ä½“çš„éœ€æ±‚å¦‚ä¸‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-329-1024x565.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-309-1024x721.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-310-1024x1007.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-311-1024x878.png" alt="img"></p><p>åœ¨æŸ¥è¯¢å‘˜å·¥åˆ—è¡¨æ•°æ®æ—¶ï¼Œæ—¢éœ€è¦æŸ¥è¯¢ å‘˜å·¥çš„åŸºæœ¬ä¿¡æ¯ï¼Œè¿˜éœ€è¦æŸ¥è¯¢å‘˜å·¥æ‰€å±çš„éƒ¨é—¨åç§°ï¼Œæ‰€ä»¥è¿™é‡Œï¼Œä¼šæ¶‰åŠåˆ°å¤šè¡¨æŸ¥è¯¢çš„æ“ä½œã€‚</p><p>è€Œä¸”ï¼Œåœ¨æŸ¥è¯¢å‘˜å·¥åˆ—è¡¨æ•°æ®æ—¶ï¼Œæ—¢è¦è€ƒè™‘æœç´¢æ ä¸­çš„æŸ¥è¯¢æ¡ä»¶ï¼Œè¿˜è¦è€ƒè™‘å¯¹æŸ¥è¯¢çš„ç»“æœè¿›è¡Œåˆ†é¡µå¤„ç†ã€‚</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨å®ç°è¿™ä¸ªåŠŸèƒ½æ—¶ï¼Œå°†ä¼šåˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†æ¥é€ä¸€å®ç°ï¼š</p><ul><li>å‡†å¤‡å·¥ä½œ</li><li>åˆ†é¡µæŸ¥è¯¢</li><li>æ¡ä»¶åˆ†é¡µæŸ¥è¯¢</li></ul><h3 id="1-1å‡†å¤‡å·¥ä½œ">1.1å‡†å¤‡å·¥ä½œ</h3><p>éœ€æ±‚ï¼šæŸ¥è¯¢æ‰€æœ‰å‘˜å·¥ä¿¡æ¯ï¼Œå¹¶æŸ¥è¯¢å‡ºéƒ¨é—¨åç§°ã€‚ï¼ˆæ¶‰åŠåˆ°çš„è¡¨ï¼šempã€deptï¼‰</p><h4 id="1-1-1åŸºç¡€ä»£ç å‡†å¤‡">1.1.1åŸºç¡€ä»£ç å‡†å¤‡</h4><p><strong>1). åˆ›å»ºå‘˜å·¥ç®¡ç†ç›¸å…³è¡¨ç»“æ„</strong></p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">-</span><span class="punctuation">-</span> å‘˜å·¥è¡¨</span><br><span class="line">create table emp<span class="punctuation">(</span></span><br><span class="line">    id int unsigned primary key auto_increment comment &#x27;ID,ä¸»é”®&#x27;<span class="punctuation">,</span></span><br><span class="line">    username varchar<span class="punctuation">(</span><span class="number">20</span><span class="punctuation">)</span> not <span class="literal">null</span> unique comment &#x27;ç”¨æˆ·å&#x27;<span class="punctuation">,</span></span><br><span class="line">    password varchar<span class="punctuation">(</span><span class="number">50</span><span class="punctuation">)</span> default &#x27;<span class="number">123456</span>&#x27; comment &#x27;å¯†ç &#x27;<span class="punctuation">,</span></span><br><span class="line">    name varchar<span class="punctuation">(</span><span class="number">10</span><span class="punctuation">)</span> not <span class="literal">null</span> comment &#x27;å§“å&#x27;<span class="punctuation">,</span></span><br><span class="line">    gender tinyint unsigned not <span class="literal">null</span> comment &#x27;æ€§åˆ«, 1:ç”·, 2:å¥³&#x27;<span class="punctuation">,</span></span><br><span class="line">    phone char<span class="punctuation">(</span><span class="number">11</span><span class="punctuation">)</span> not <span class="literal">null</span> unique comment &#x27;æ‰‹æœºå·&#x27;<span class="punctuation">,</span></span><br><span class="line">    job tinyint unsigned comment &#x27;èŒä½, 1 ç­ä¸»ä»», 2 è®²å¸ˆ , 3 å­¦å·¥ä¸»ç®¡, 4 æ•™ç ”ä¸»ç®¡, 5 å’¨è¯¢å¸ˆ&#x27;<span class="punctuation">,</span></span><br><span class="line">    salary int unsigned comment &#x27;è–ªèµ„&#x27;<span class="punctuation">,</span></span><br><span class="line">    image varchar<span class="punctuation">(</span><span class="number">300</span><span class="punctuation">)</span> comment &#x27;å¤´åƒ&#x27;<span class="punctuation">,</span></span><br><span class="line">    entry_date date comment &#x27;å…¥èŒæ—¥æœŸ&#x27;<span class="punctuation">,</span></span><br><span class="line">    dept_id int unsigned comment &#x27;éƒ¨é—¨ID&#x27;<span class="punctuation">,</span></span><br><span class="line">    create_time datetime comment &#x27;åˆ›å»ºæ—¶é—´&#x27;<span class="punctuation">,</span></span><br><span class="line">    update_time datetime comment &#x27;ä¿®æ”¹æ—¶é—´&#x27;</span><br><span class="line"><span class="punctuation">)</span> comment &#x27;å‘˜å·¥è¡¨&#x27;<span class="punctuation">;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO emp VALUES </span><br><span class="line">    <span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span>&#x27;shinaian&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;æ–½è€åºµ&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909000</span>1&#x27;<span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">15000</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2000-01-01</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-11-16</span> 16:11:26&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span>&#x27;songjiang&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;å®‹æ±Ÿ&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909000</span>2&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">8600</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2015-01-01</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:37&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span>&#x27;lujunyi&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;å¢ä¿Šä¹‰&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909000</span>3&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">8900</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2008-05-01</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:39&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span>&#x27;wuyong&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;å´ç”¨&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909000</span>4&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">9200</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2007-01-01</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:41&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span>&#x27;gongsunsheng&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;å…¬å­™èƒœ&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909000</span>5&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">9500</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2012-12-05</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:43&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">6</span><span class="punctuation">,</span>&#x27;huosanniang&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;æ‰ˆä¸‰å¨˜&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">1330909000</span>6&#x27;<span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">6500</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2013-09-05</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:45&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">7</span><span class="punctuation">,</span>&#x27;chaijin&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;æŸ´è¿›&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909000</span>7&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">4700</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2005-08-01</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:47&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">8</span><span class="punctuation">,</span>&#x27;likui&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;æé€µ&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909000</span>8&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">4800</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2014-11-09</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:49&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">9</span><span class="punctuation">,</span>&#x27;wusong&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;æ­¦æ¾&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909000</span>9&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">4900</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2011-03-11</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:51&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span>&#x27;linchong&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;æ—å†²&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909001</span>0&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">5000</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2013-09-05</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:53&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">11</span><span class="punctuation">,</span>&#x27;huyanzhuo&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;å‘¼å»¶ç¼&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909001</span>1&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">9700</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2007-02-01</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:55&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">12</span><span class="punctuation">,</span>&#x27;xiaoliguang&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;å°æå¹¿&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909001</span>2&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">10000</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2008-08-18</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:57&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">13</span><span class="punctuation">,</span>&#x27;yangzhi&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;æ¨å¿—&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909001</span>3&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">5300</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2012-11-01</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:59&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">14</span><span class="punctuation">,</span>&#x27;shijin&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;å²è¿›&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909001</span>4&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">10600</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2002-08-01</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:36:01&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">15</span><span class="punctuation">,</span>&#x27;sunerniang&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;å­™äºŒå¨˜&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">1330909001</span>5&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">10900</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2011-05-01</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:36:03&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">16</span><span class="punctuation">,</span>&#x27;luzhishen&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;é²æ™ºæ·±&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909001</span>6&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">9600</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2010-01-01</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:36:05&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">17</span><span class="punctuation">,</span>&#x27;liying&#x27;<span class="punctuation">,</span>&#x27;<span class="number">12345678</span>&#x27;<span class="punctuation">,</span>&#x27;æåº”&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909001</span>7&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">5800</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2015-03-21</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:36:07&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">18</span><span class="punctuation">,</span>&#x27;shiqian&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;æ—¶è¿&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909001</span>8&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">10200</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2015-01-01</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:36:09&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">19</span><span class="punctuation">,</span>&#x27;gudasao&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;é¡¾å¤§å«‚&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">1330909001</span>9&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">10500</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2008-01-01</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:36:11&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">20</span><span class="punctuation">,</span>&#x27;ruanxiaoer&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;é˜®å°äºŒ&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909002</span>0&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">10800</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2018-01-01</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:36:13&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">21</span><span class="punctuation">,</span>&#x27;ruanxiaowu&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;é˜®å°äº”&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909002</span>1&#x27;<span class="punctuation">,</span><span class="number">5</span><span class="punctuation">,</span><span class="number">5200</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2015-01-01</span>&#x27;<span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:36:15&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">22</span><span class="punctuation">,</span>&#x27;ruanxiaoqi&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;é˜®å°ä¸ƒ&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909002</span>2&#x27;<span class="punctuation">,</span><span class="number">5</span><span class="punctuation">,</span><span class="number">5500</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2016-01-01</span>&#x27;<span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:36:17&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">23</span><span class="punctuation">,</span>&#x27;ruanji&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;é˜®ç±&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909002</span>3&#x27;<span class="punctuation">,</span><span class="number">5</span><span class="punctuation">,</span><span class="number">5800</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2012-01-01</span>&#x27;<span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:36:19&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">24</span><span class="punctuation">,</span>&#x27;tongwei&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;ç«¥å¨&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909002</span>4&#x27;<span class="punctuation">,</span><span class="number">5</span><span class="punctuation">,</span><span class="number">5000</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2006-01-01</span>&#x27;<span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:36:21&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">25</span><span class="punctuation">,</span>&#x27;tongmeng&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;ç«¥çŒ›&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909002</span>5&#x27;<span class="punctuation">,</span><span class="number">5</span><span class="punctuation">,</span><span class="number">4800</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2002-01-01</span>&#x27;<span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:36:23&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">26</span><span class="punctuation">,</span>&#x27;yanshun&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;ç‡•é¡º&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909002</span>6&#x27;<span class="punctuation">,</span><span class="number">5</span><span class="punctuation">,</span><span class="number">5400</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2011-01-01</span>&#x27;<span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-11-08</span> 22:12:46&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">27</span><span class="punctuation">,</span>&#x27;lijun&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;æä¿Š&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909002</span>7&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">6600</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2004-01-01</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-11-16</span> 17:56:59&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">28</span><span class="punctuation">,</span>&#x27;lizhong&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;æå¿ &#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909002</span>8&#x27;<span class="punctuation">,</span><span class="number">5</span><span class="punctuation">,</span><span class="number">5000</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2007-01-01</span>&#x27;<span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-11-17</span> 16:34:22&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">30</span><span class="punctuation">,</span>&#x27;liyun&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;æäº‘&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909003</span>0&#x27;<span class="punctuation">,</span><span class="literal">NULL</span><span class="punctuation">,</span><span class="literal">NULL</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2020-03-01</span>&#x27;<span class="punctuation">,</span><span class="literal">NULL</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:35:33&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 16:36:31&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">36</span><span class="punctuation">,</span>&#x27;linghuchong&#x27;<span class="punctuation">,</span>&#x27;<span class="number">123456</span>&#x27;<span class="punctuation">,</span>&#x27;ä»¤ç‹å†²&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1880909121</span>2&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">6800</span><span class="punctuation">,</span>&#x27;https://web-framework.oss-cn-hangzhou.aliyuncs.com/<span class="number">2023</span>/1.jpg&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-10-19</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">2023-10-20</span> 20:44:54&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2023-11-09</span> 09:41:04&#x27;<span class="punctuation">)</span><span class="punctuation">;</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="punctuation">-</span><span class="punctuation">-</span> å‘˜å·¥å·¥ä½œç»å†ä¿¡æ¯</span><br><span class="line">create table emp_expr<span class="punctuation">(</span></span><br><span class="line">    id int unsigned primary key auto_increment comment &#x27;ID, ä¸»é”®&#x27;<span class="punctuation">,</span></span><br><span class="line">    emp_id int unsigned comment &#x27;å‘˜å·¥ID&#x27;<span class="punctuation">,</span></span><br><span class="line">    begin date comment &#x27;å¼€å§‹æ—¶é—´&#x27;<span class="punctuation">,</span></span><br><span class="line">    end  date comment &#x27;ç»“æŸæ—¶é—´&#x27;<span class="punctuation">,</span></span><br><span class="line">    company varchar<span class="punctuation">(</span><span class="number">50</span><span class="punctuation">)</span> comment &#x27;å…¬å¸åç§°&#x27;<span class="punctuation">,</span></span><br><span class="line">    job varchar<span class="punctuation">(</span><span class="number">50</span><span class="punctuation">)</span> comment &#x27;èŒä½&#x27;</span><br><span class="line"><span class="punctuation">)</span>comment &#x27;å·¥ä½œç»å†&#x27;<span class="punctuation">;</span></span><br></pre></td></tr></table></figure><p><strong>2). å‡†å¤‡empè¡¨å¯¹åº”çš„å®ä½“ç±»Empã€EmpExpr</strong></p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.<span class="built_in">Data</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.<span class="built_in">List</span>;</span><br><span class="line"></span><br><span class="line">@<span class="built_in">Data</span></span><br><span class="line"><span class="keyword">public</span> class Emp &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Integer</span> id; <span class="comment">//ID,ä¸»é”®</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">String</span> username; <span class="comment">//ç”¨æˆ·å</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">String</span> password; <span class="comment">//å¯†ç </span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">String</span> name; <span class="comment">//å§“å</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Integer</span> gender; <span class="comment">//æ€§åˆ«, 1:ç”·, 2:å¥³</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">String</span> phone; <span class="comment">//æ‰‹æœºå·</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Integer</span> job; <span class="comment">//èŒä½, 1:ç­ä¸»ä»»,2:è®²å¸ˆ,3:å­¦å·¥ä¸»ç®¡,4:æ•™ç ”ä¸»ç®¡,5:å’¨è¯¢å¸ˆ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Integer</span> salary; <span class="comment">//è–ªèµ„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">String</span> image; <span class="comment">//å¤´åƒ</span></span><br><span class="line">    <span class="keyword">private</span> LocalDate entryDate; <span class="comment">//å…¥èŒæ—¥æœŸ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Integer</span> deptId; <span class="comment">//å…³è”çš„éƒ¨é—¨ID</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime; <span class="comment">//åˆ›å»ºæ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime; <span class="comment">//ä¿®æ”¹æ—¶é—´</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°è£…éƒ¨é—¨åç§°æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">String</span> deptName; <span class="comment">//éƒ¨é—¨åç§°</span></span><br><span class="line">&#125;</span><br><span class="line">package com.itheima.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.<span class="built_in">Data</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å·¥ä½œç»å†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">@<span class="built_in">Data</span></span><br><span class="line"><span class="keyword">public</span> class EmpExpr &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Integer</span> id; <span class="comment">//ID</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Integer</span> empId; <span class="comment">//å‘˜å·¥ID</span></span><br><span class="line">    <span class="keyword">private</span> LocalDate begin; <span class="comment">//å¼€å§‹æ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> LocalDate end; <span class="comment">//ç»“æŸæ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">String</span> company; <span class="comment">//å…¬å¸åç§°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">String</span> job; <span class="comment">//èŒä½</span></span><br><span class="line">&#125;</span><br><span class="line">package com.itheima.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.<span class="built_in">Data</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å·¥ä½œç»å†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">@<span class="built_in">Data</span></span><br><span class="line"><span class="keyword">public</span> class EmpExpr &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Integer</span> id; <span class="comment">//ID</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Integer</span> empId; <span class="comment">//å‘˜å·¥ID</span></span><br><span class="line">    <span class="keyword">private</span> LocalDate begin; <span class="comment">//å¼€å§‹æ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> LocalDate end; <span class="comment">//ç»“æŸæ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">String</span> company; <span class="comment">//å…¬å¸åç§°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">String</span> job; <span class="comment">//èŒä½</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3). å‡†å¤‡Empå‘˜å·¥ç®¡ç†çš„åŸºç¡€ç»“æ„ï¼ŒåŒ…æ‹¬****Controllerã€Serviceã€Mapper</strong></p><p>EmpMapperï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Emp;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>EmpService:</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title class_"><span class="keyword">interface</span> <span class="title">EmpService</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>EmpServiceImpl:</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.mapper.EmpMapper;</span><br><span class="line"><span class="keyword">import</span> com.itheima.service.EmpService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** * å‘˜å·¥ç®¡ç† */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_"><span class="keyword">class</span> <span class="title">EmpServiceImpl</span> <span class="keyword"><span class="keyword">implements</span> <span class="type">EmpService</span></span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmpMapper empMapper;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>EmpController:</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.service.EmpService;</span><br><span class="line"><span class="keyword">import</span> lombok.<span class="keyword">extern</span>.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** * å‘˜å·¥ç®¡ç† */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_"><span class="keyword">class</span> <span class="title">EmpController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmpService empService;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1-1-2SQL-Mapperæ¥å£">1.1.2SQL&amp;Mapperæ¥å£</h4><p><strong>1). å¯¹åº”çš„SQLè¯­å¥</strong></p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- æŸ¥è¯¢æ‰€æœ‰çš„å‘˜å·¥ä¿¡æ¯ï¼Œå¦‚æœå‘˜å·¥å…³è”äº†éƒ¨é—¨ï¼Œä¹Ÿè¦æŸ¥è¯¢å‡ºéƒ¨é—¨åç§°</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">e</span>.*, d.name <span class="keyword">as</span> dept_name <span class="keyword">from</span> emp <span class="built_in">e</span> <span class="keyword">left</span> <span class="keyword">join</span> dept d <span class="keyword">on</span> <span class="built_in">e</span>.dept_id = d.id;</span><br></pre></td></tr></table></figure><p><strong>2). Mapperæ¥å£æ–¹æ³•å®šä¹‰</strong></p><p>é‚£æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å®šä¹‰ä¸€ä¸ªå‘˜å·¥ç®¡ç†çš„mapperæ¥å£ <code>EmpMapper</code> å¹¶åœ¨å…¶ä¸­å®Œæˆå‘˜å·¥ä¿¡æ¯çš„æŸ¥è¯¢ã€‚ å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_"><span class="keyword">interface</span> <span class="title">EmpMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢æ‰€æœ‰çš„å‘˜å·¥åŠå…¶å¯¹åº”çš„éƒ¨é—¨åç§°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">&quot;select e.*, d.name as deptName from emp e left join dept d on e.dept_id = d.id&quot;</span>)</span><br><span class="line">    <span class="keyword">public</span> List&lt;Emp&gt; list();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œä¸Šè¿°SQLè¯­å¥ä¸­ï¼Œç»™ éƒ¨é—¨åç§°èµ·äº†åˆ«å <code>deptName</code> ï¼Œæ˜¯å› ä¸ºåœ¨æ¥å£æ–‡æ¡£ä¸­ï¼Œè¦æ±‚éƒ¨é—¨åç§°ç»™å‰ç«¯è¿”å›çš„æ•°æ®ä¸­ï¼Œå°±å¿…é¡»å« <code>deptName</code>ã€‚ è€Œè¿™é‡Œæˆ‘ä»¬éœ€è¦å°†æŸ¥è¯¢è¿”å›çš„æ¯ä¸€æ¡è®°å½•éƒ½å°è£…åˆ°Empå¯¹è±¡ä¸­ï¼Œé‚£ä¹ˆå°±å¿…é¡»ä¿è¯æŸ¥è¯¢è¿”å›çš„å­—æ®µåä¸å±æ€§åæ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚</p><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨Empä¸­å®šä¹‰ä¸€ä¸ªå±æ€§ <code>deptName</code> ç”¨æ¥å°è£…éƒ¨é—¨åç§°ã€‚ å…·ä½“å¦‚ä¸‹ï¼š</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">Data</span></span><br><span class="line"><span class="keyword">public</span> class Emp &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Integer</span> id; <span class="comment">//ID,ä¸»é”®</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">String</span> username; <span class="comment">//ç”¨æˆ·å</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">String</span> password; <span class="comment">//å¯†ç </span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">String</span> name; <span class="comment">//å§“å</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Integer</span> gender; <span class="comment">//æ€§åˆ«, 1:ç”·, 2:å¥³</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">String</span> phone; <span class="comment">//æ‰‹æœºå·</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Integer</span> job; <span class="comment">//èŒä½, 1:ç­ä¸»ä»»,2:è®²å¸ˆ,3:å­¦å·¥ä¸»ç®¡,4:æ•™ç ”ä¸»ç®¡,5:å’¨è¯¢å¸ˆ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Integer</span> salary; <span class="comment">//è–ªèµ„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">String</span> image; <span class="comment">//å¤´åƒ</span></span><br><span class="line">    <span class="keyword">private</span> LocalDate entryDate; <span class="comment">//å…¥èŒæ—¥æœŸ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Integer</span> deptId; <span class="comment">//å…³è”çš„éƒ¨é—¨ID</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime; <span class="comment">//åˆ›å»ºæ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime; <span class="comment">//ä¿®æ”¹æ—¶é—´</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°è£…éƒ¨é—¨åç§°æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">String</span> deptName; <span class="comment">//éƒ¨é—¨åç§°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç ç¼–å†™å®Œæ¯•åï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªå•å…ƒæµ‹è¯•ï¼Œå¯¹ä¸Šè¿°çš„ç¨‹åºè¿›è¡Œæµ‹è¯•ï¼š</p><h3 id="1-2åˆ†é¡µæŸ¥è¯¢">1.2åˆ†é¡µæŸ¥è¯¢</h3><p>æ¯æ¬¡åªå±•ç¤ºä¸€é¡µçš„æ•°æ®ï¼Œæ¯”å¦‚ï¼šä¸€é¡µå±•ç¤º10æ¡æ•°æ®ï¼Œå¦‚æœè¿˜æƒ³çœ‹å…¶ä»–çš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ç‚¹å‡»é¡µç è¿›è¡ŒæŸ¥è¯¢ã€‚</p><p>è€Œåœ¨å‘˜å·¥ç®¡ç†çš„éœ€æ±‚ä¸­ï¼Œå°±è¦æ±‚æˆ‘ä»¬è¿›è¡Œåˆ†é¡µæŸ¥è¯¢ï¼Œå±•ç¤ºå‡ºå¯¹åº”çš„æ•°æ®ã€‚ å…·ä½“çš„é¡µé¢åŸå‹å¦‚ä¸‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-338-1024x432.png" alt="img"></p><p>è¦æƒ³ä»æ•°æ®åº“ä¸­è¿›è¡Œåˆ†é¡µæŸ¥è¯¢ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨<code>LIMIT</code>å…³é”®å­—ï¼Œæ ¼å¼ä¸ºï¼šlimit å¼€å§‹ç´¢å¼• æ¯é¡µæ˜¾ç¤ºçš„æ¡æ•°ã€‚</p><p>æŸ¥è¯¢ç¬¬1,2,3é¡µæ•°æ®çš„SQLè¯­å¥æ˜¯ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp  <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">10</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp  <span class="keyword">limit</span> <span class="number">10</span>,<span class="number">10</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp  <span class="keyword">limit</span> <span class="number">20</span>,<span class="number">10</span>;</span><br></pre></td></tr></table></figure><p>è§‚å¯Ÿä»¥ä¸ŠSQLè¯­å¥ï¼Œå‘ç°ï¼š å¼€å§‹ç´¢å¼•ä¸€ç›´åœ¨æ”¹å˜ ï¼Œ æ¯é¡µæ˜¾ç¤ºæ¡æ•°æ˜¯å›ºå®šçš„</p><p><strong>å¼€å§‹ç´¢å¼•çš„è®¡ç®—å…¬å¼ï¼š <code>å¼€å§‹ç´¢å¼• = (å½“å‰é¡µç  - 1) \* æ¯é¡µæ˜¾ç¤ºæ¡æ•°</code></strong></p><p>æˆ‘ä»¬ç»§ç»­åŸºäºé¡µé¢åŸå‹ï¼Œç»§ç»­åˆ†æï¼Œå¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š</p><ol><li>å‰ç«¯åœ¨è¯·æ±‚æœåŠ¡ç«¯æ—¶ï¼Œä¼ é€’çš„å‚æ•°<ol><li>å½“å‰é¡µç  page</li><li>æ¯é¡µæ˜¾ç¤ºæ¡æ•° pageSize</li></ol></li><li>åç«¯éœ€è¦å“åº”ä»€ä¹ˆæ•°æ®ç»™å‰ç«¯<ol><li>æ‰€æŸ¥è¯¢åˆ°çš„æ•°æ®åˆ—è¡¨ï¼ˆå­˜å‚¨åˆ°List é›†åˆä¸­ï¼‰</li><li>æ€»è®°å½•æ•°</li></ol></li></ol><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-312-1024x407.png" alt="img"></p><p>åå°ç»™å‰ç«¯è¿”å›çš„æ•°æ®åŒ…å«ï¼šListé›†åˆ(æ•°æ®åˆ—è¡¨)ã€total(æ€»è®°å½•æ•°)</p><p>è€Œè¿™ä¸¤éƒ¨åˆ†æˆ‘ä»¬é€šå¸¸å°è£…åˆ°PageResultå¯¹è±¡ä¸­ï¼Œå¹¶å°†è¯¥å¯¹è±¡è½¬æ¢ä¸ºjsonæ ¼å¼çš„æ•°æ®å“åº”å›ç»™æµè§ˆå™¨ã€‚</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Data</span></span><br><span class="line"><span class="variable">@NoArgsConstructor</span></span><br><span class="line"><span class="variable">@AllArgsConstructor</span></span><br><span class="line">public class PageResult &#123;</span><br><span class="line">        <span class="selector-tag">private</span> <span class="selector-tag">Long</span> <span class="selector-tag">total</span>; <span class="comment">//æ€»è®°å½•æ•°</span></span><br><span class="line">        <span class="selector-tag">private</span> <span class="selector-tag">List</span> <span class="selector-tag">rows</span>; <span class="comment">//å½“å‰é¡µæ•°æ®åˆ—è¡¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤§å®¶ä¼šå‘ç°ï¼šåˆ†é¡µæŸ¥è¯¢åŠŸèƒ½ç¼–å†™èµ·æ¥æ¯”è¾ƒç¹çã€‚ è€Œåˆ†é¡µæŸ¥è¯¢çš„åŠŸèƒ½æ˜¯éå¸¸å¸¸è§çš„ï¼Œåˆ†é¡µæŸ¥è¯¢çš„æ€è·¯ã€æ­¥éª¤æ˜¯æ¯”è¾ƒå›ºå®šçš„ã€‚ åœ¨Mapperæ¥å£ä¸­å®šä¹‰ä¸¤ä¸ªæ–¹æ³•æ‰§è¡Œä¸¤æ¡ä¸åŒçš„SQLè¯­å¥ï¼š</p><ol><li>æŸ¥è¯¢æ€»è®°å½•æ•°</li><li>æŒ‡å®šé¡µç çš„æ•°æ®åˆ—è¡¨</li></ol><p>åœ¨Serviceå½“ä¸­ï¼Œè°ƒç”¨Mapperæ¥å£çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«è·å–ï¼šæ€»è®°å½•æ•°ã€æŸ¥è¯¢ç»“æœåˆ—è¡¨ï¼Œç„¶ååœ¨å°†è·å–çš„æ•°æ®ç»“æœå°è£…åˆ°PageBeanå¯¹è±¡ä¸­ã€‚</p><p>å¦‚æœåœ¨æœªæ¥å¼€å‘å…¶ä»–é¡¹ç›®ï¼Œåªè¦æ¶‰åŠåˆ°åˆ†é¡µæŸ¥è¯¢åŠŸèƒ½(ä¾‹ï¼šè®¢å•ã€ç”¨æˆ·ã€æ”¯ä»˜ã€å•†å“)ï¼Œéƒ½å¿…é¡»æŒ‰ç…§ä»¥ä¸Šæ“ä½œå®ŒæˆåŠŸèƒ½å¼€å‘</p><p>ç»“è®ºï¼šåŸå§‹æ–¹å¼çš„åˆ†é¡µæŸ¥è¯¢ï¼Œå­˜åœ¨ç€&quot;æ­¥éª¤å›ºå®š&quot;ã€&quot;ä»£ç é¢‘ç¹&quot;çš„é—®é¢˜</p><p>è§£å†³æ–¹æ¡ˆï¼šå¯ä»¥ä½¿ç”¨ä¸€äº›ç°æˆçš„åˆ†é¡µæ’ä»¶å®Œæˆã€‚å¯¹äºMybatisæ¥è®²ç°åœ¨æœ€ä¸»æµçš„å°±æ˜¯PageHelperã€‚</p><h3 id="1-3PageHelperåˆ†é¡µæ’ä»¶">1.3PageHelperåˆ†é¡µæ’ä»¶</h3><h4 id="1-3-1ä»‹ç»">1.3.1ä»‹ç»</h4><p><strong>PageHelperæ˜¯ç¬¬ä¸‰æ–¹æä¾›çš„Mybatisæ¡†æ¶ä¸­çš„ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§ã€æ–¹ä¾¿æ˜“ç”¨çš„åˆ†é¡µæ’ä»¶ï¼Œæ”¯æŒä»»ä½•å½¢å¼çš„å•æ ‡ã€å¤šè¡¨çš„åˆ†é¡µæŸ¥è¯¢ã€‚</strong></p><p>å®˜ç½‘ï¼š<a href="https://pagehelper.github.io/">https://pagehelper.github.io/</a></p><p>é‚£æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ¯”ä¸€ä¸‹ï¼Œä½¿ç”¨PageHelperåˆ†é¡µæ’ä»¶è¿›è¡Œåˆ†é¡µ ä¸ åŸå§‹æ–¹å¼è¿›è¡Œåˆ†é¡µä»£ç å®ç°çš„ä¸Šçš„å·®åˆ«ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-313-1024x466.png" alt="img"></p><ul><li>Mapperæ¥å£å±‚ï¼š<ul><li>åŸå§‹çš„åˆ†é¡µæŸ¥è¯¢åŠŸèƒ½ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åœ¨Mapperæ¥å£ä¸­å®šä¹‰ä¸¤æ¡SQLè¯­å¥ã€‚</li><li>PageHelperå®ç°åˆ†é¡µæŸ¥è¯¢ä¹‹åï¼Œåªéœ€è¦ç¼–å†™ä¸€æ¡SQLè¯­å¥ï¼Œè€Œä¸”ä¸éœ€è¦è€ƒè™‘åˆ†é¡µæ“ä½œï¼Œå°±æ˜¯ä¸€æ¡æ­£å¸¸çš„æŸ¥è¯¢è¯­å¥ã€‚</li></ul></li><li>Serviceå±‚ï¼š<ul><li>éœ€è¦æ ¹æ®é¡µç ã€æ¯é¡µå±•ç¤ºè®°å½•æ•°ï¼Œæ‰‹åŠ¨çš„è®¡ç®—èµ·å§‹ç´¢å¼•ã€‚</li><li>æ— éœ€æ‰‹åŠ¨è®¡ç®—èµ·å§‹ç´¢å¼•ï¼Œç›´æ¥å‘Šè¯‰PageHelperéœ€è¦æŸ¥è¯¢é‚£ä¸€é¡µçš„æ•°æ®ï¼Œæ¯é¡µå±•ç¤ºå¤šå°‘æ¡è®°å½•å³å¯ã€‚</li></ul></li></ul><h4 id="1-3-2ä»£ç å®ç°">1.3.2ä»£ç å®ç°</h4><p>å½“ä½¿ç”¨äº†PageHelperåˆ†é¡µæ’ä»¶è¿›è¡Œåˆ†é¡µï¼Œå°±æ— éœ€å†Mapperä¸­è¿›è¡Œæ‰‹åŠ¨åˆ†é¡µäº†ã€‚ åœ¨Mapperä¸­æˆ‘ä»¬åªéœ€è¦è¿›è¡Œæ­£å¸¸çš„åˆ—è¡¨æŸ¥è¯¢å³å¯ã€‚åœ¨Serviceå±‚ä¸­ï¼Œè°ƒç”¨Mapperçš„æ–¹æ³•ä¹‹å‰è®¾ç½®åˆ†é¡µå‚æ•°ï¼Œåœ¨è°ƒç”¨Mapperæ–¹æ³•æ‰§è¡ŒæŸ¥è¯¢ä¹‹åï¼Œè§£æåˆ†é¡µç»“æœï¼Œå¹¶å°†ç»“æœå°è£…åˆ°PageResultå¯¹è±¡ä¸­è¿”å›ã€‚</p><p>1). åœ¨pom.xmlå¼•å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--åˆ†é¡µæ’ä»¶PageHelper--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2). EmpMapper</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢æ‰€æœ‰çš„å‘˜å·¥åŠå…¶å¯¹åº”çš„éƒ¨é—¨åç§°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">@Select(<span class="string">&quot;select e.*, d.name deptName from emp as e left join dept as d on e.dept_id = d.id&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Emp&gt; <span class="title">list</span>()</span>;</span><br></pre></td></tr></table></figure><p>3). EmpServiceImpl</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">PageResult</span> page(<span class="type">Integer</span> page, <span class="type">Integer</span> pageSize) &#123;</span><br><span class="line">    <span class="comment">//1. è®¾ç½®åˆ†é¡µå‚æ•°</span></span><br><span class="line">    <span class="type">PageHelper</span>.startPage(page,pageSize);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. æ‰§è¡ŒæŸ¥è¯¢</span></span><br><span class="line">    <span class="type">List</span>&lt;<span class="type">Emp</span>&gt; empList <span class="operator">=</span> empMapper.list();</span><br><span class="line">    <span class="type">Page</span>&lt;<span class="type">Emp</span>&gt; p <span class="operator">=</span> (<span class="type">Page</span>&lt;<span class="type">Emp</span>&gt;) empList;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3. å°è£…ç»“æœ</span></span><br><span class="line">    <span class="keyword">return</span> new <span class="type">PageResult</span>(p.getTotal(), p.getResult());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1-3-3pageHelperçš„å®ç°æœºåˆ¶">1.3.3pageHelperçš„å®ç°æœºåˆ¶</h4><p>æˆ‘ä»¬æ‰“å¼€Ideaçš„æ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ°åœ¨è¿›è¡Œåˆ†é¡µæŸ¥è¯¢æ—¶ï¼Œè¾“å‡ºçš„SQLè¯­å¥ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-334-1024x214.png" alt="img"></p><p>æˆ‘ä»¬çœ‹åˆ°æ‰§è¡Œäº†ä¸¤æ¡SQLè¯­å¥ï¼Œè€Œè¿™ä¸¤æ¡SQLè¯­å¥ï¼Œå…¶å®æ˜¯ä»æˆ‘ä»¬åœ¨Mapperæ¥å£ä¸­å®šä¹‰çš„SQLæ¼”å˜è€Œæ¥çš„ã€‚</p><ul><li>ç¬¬ä¸€æ¡SQLè¯­å¥ï¼Œç”¨æ¥æŸ¥è¯¢æ€»è®°å½•æ•°ã€‚</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-336-1024x78.png" alt="img"></p><p>å…¶å®å°±æ˜¯å°†æˆ‘ä»¬ç¼–å†™çš„SQLè¯­å¥è¿›è¡Œçš„æ”¹é€ å¢å¼ºï¼Œå°†æŸ¥è¯¢è¿”å›çš„å­—æ®µåˆ—è¡¨æ›¿æ¢æˆäº† <code>count(0)</code> æ¥ç»Ÿè®¡æ€»è®°å½•æ•°ã€‚</p><ul><li>ç¬¬äºŒæ¡SQLè¯­å¥ï¼Œç”¨æ¥è¿›è¡Œåˆ†é¡µæŸ¥è¯¢ï¼ŒæŸ¥è¯¢æŒ‡å®šé¡µç å¯¹åº” çš„æ•°æ®åˆ—è¡¨ã€‚</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-337-1024x86.png" alt="img"></p><p>å…¶å®å°±æ˜¯å°†æˆ‘ä»¬ç¼–å†™çš„SQLè¯­å¥è¿›è¡Œçš„æ”¹é€ å¢å¼ºï¼Œåœ¨SQLè¯­å¥ä¹‹åæ‹¼æ¥ä¸Šäº†limitè¿›è¡Œåˆ†é¡µæŸ¥è¯¢ï¼Œè€Œç”±äºæµ‹è¯•æ—¶æŸ¥è¯¢çš„æ˜¯ç¬¬ä¸€é¡µï¼Œèµ·å§‹ç´¢å¼•æ˜¯0ï¼Œæ‰€ä»¥ç®€å†™ä¸ºlimit ï¼Ÿã€‚</p><p>è€ŒPageHelperåœ¨è¿›è¡Œåˆ†é¡µæŸ¥è¯¢æ—¶ï¼Œä¼šæ‰§è¡Œä¸Šè¿°ä¸¤æ¡SQLè¯­å¥ï¼Œå¹¶å°†æŸ¥è¯¢åˆ°çš„æ€»è®°å½•æ•°ï¼Œä¸æ•°æ®åˆ—è¡¨å°è£…åˆ°äº† <code>Page&lt;Emp&gt;</code> å¯¹è±¡ä¸­ï¼Œæˆ‘ä»¬å†è·å–æŸ¥è¯¢ç»“æœæ—¶ï¼Œåªéœ€è¦è°ƒç”¨Pageå¯¹è±¡çš„æ–¹æ³•å°±å¯ä»¥è·å–ã€‚</p><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>PageHelperå®ç°åˆ†é¡µæŸ¥è¯¢æ—¶ï¼ŒSQLè¯­å¥çš„ç»“å°¾ä¸€å®šä¸€å®šä¸€å®šä¸è¦åŠ åˆ†å·(;).ï¼Œå®¹æ˜“å‡ºç°æ‹¼æ¥é—®é¢˜</li><li>PageHelperåªä¼šå¯¹ç´§è·Ÿåœ¨å…¶åçš„ç¬¬ä¸€æ¡SQLè¯­å¥è¿›è¡Œåˆ†é¡µå¤„ç†ã€‚</li></ul><h3 id="1-4æ¡ä»¶åˆ†é¡µæŸ¥è¯¢">1.4æ¡ä»¶åˆ†é¡µæŸ¥è¯¢</h3><p>å®Œäº†åˆ†é¡µæŸ¥è¯¢åï¼Œä¸‹é¢æˆ‘ä»¬éœ€è¦åœ¨åˆ†é¡µæŸ¥è¯¢çš„åŸºç¡€ä¸Šï¼Œæ·»åŠ æ¡ä»¶ã€‚</p><h4 id="1-4-1éœ€æ±‚">1.4.1éœ€æ±‚</h4><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-317-1024x567.png" alt="img"></p><p>é€šè¿‡å‘˜å·¥ç®¡ç†çš„é¡µé¢åŸå‹æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå‘˜å·¥åˆ—è¡¨é¡µé¢çš„æŸ¥è¯¢ï¼Œä¸ä»…ä»…éœ€è¦è€ƒè™‘åˆ†é¡µï¼Œè¿˜éœ€è¦è€ƒè™‘æŸ¥è¯¢æ¡ä»¶ã€‚ åˆ†é¡µæŸ¥è¯¢æˆ‘ä»¬å·²ç»å®ç°äº†ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘åœ¨åˆ†é¡µæŸ¥è¯¢çš„åŸºç¡€ä¸Šï¼Œå†åŠ ä¸ŠæŸ¥è¯¢æ¡ä»¶ã€‚</p><p>æˆ‘ä»¬çœ‹åˆ°é¡µé¢åŸå‹åŠéœ€æ±‚ä¸­æè¿°ï¼Œæœç´¢æ çš„æœç´¢æ¡ä»¶æœ‰ä¸‰ä¸ªï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li>å§“åï¼šæ¨¡ç³ŠåŒ¹é…</li><li>æ€§åˆ«ï¼šç²¾ç¡®åŒ¹é…</li><li>å…¥èŒæ—¥æœŸï¼šèŒƒå›´åŒ¹é…</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-318-1024x729.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-319-1024x904.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-320.png" alt="img"></p><h4 id="1-4-2å®ç°æ€è·¯">1.4.2å®ç°æ€è·¯</h4><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-321-1024x286.png" alt="img"></p><h4 id="1-4-3ä»£ç å®ç°">1.4.3ä»£ç å®ç°</h4><p>åœ¨åŸæœ‰åˆ†é¡µæŸ¥è¯¢çš„ä»£ç åŸºç¡€ä¸Šè¿›è¡Œæ”¹é€ ã€‚</p><p><strong>1). åœ¨EmpControlleræ–¹æ³•ä¸­é€šè¿‡å¤šä¸ªæ–¹æ³•å½¢å‚ï¼Œä¾æ¬¡æ¥æ”¶è¿™å‡ ä¸ªå‚æ•°</strong></p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(<span class="string">&quot;/emps&quot;</span>)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmpService empService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> Result page(<span class="meta">@RequestParam(defaultValue = <span class="string">&quot;1&quot;</span>)</span> Integer page,</span><br><span class="line">                       <span class="meta">@RequestParam(defaultValue = <span class="string">&quot;10&quot;</span>)</span> Integer pageSize,</span><br><span class="line">                       String name, Integer gender,</span><br><span class="line">                       <span class="meta">@DateTimeFormat(pattern = <span class="string">&quot;yyyy-MM-dd&quot;</span>)</span> LocalDate begin,</span><br><span class="line">                       <span class="meta">@DateTimeFormat(pattern = <span class="string">&quot;yyyy-MM-dd&quot;</span>)</span> LocalDate end) &#123;</span><br><span class="line">        log.info(<span class="string">&quot;æŸ¥è¯¢è¯·æ±‚å‚æ•°ï¼š &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;&quot;</span>, page, pageSize, name, gender, begin, end);</span><br><span class="line">        PageResult pageResult = empService.page(page, pageSize);</span><br><span class="line">        <span class="keyword">return</span> Result.success(pageResult);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2). ä¿®æ”¹EmpServiceåŠEmpServiceImplä¸­çš„ä»£ç é€»è¾‘</strong></p><p>EmpServiceï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">public</span> interface EmpService &#123;</span><br><span class="line">    <span class="comment">/**    </span></span><br><span class="line"><span class="comment">   * åˆ†é¡µæŸ¥è¯¢    </span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">PageResult page(<span class="type">Integer</span> page, <span class="type">Integer</span> pageSize, String <span class="type">name</span>, <span class="type">Integer</span> gender, LocalDate <span class="keyword">begin</span>, LocalDate <span class="keyword">end</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>EmpServiceImpl:</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">* å‘˜å·¥ç®¡ç† </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_"><span class="keyword">class</span> <span class="title">EmpServiceImpl</span> <span class="keyword"><span class="keyword">implements</span> <span class="type">EmpService</span></span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmpMapper empMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageResult page(Integer page, Integer pageSize, <span class="keyword">String</span> name, Integer gender, LocalDate begin, LocalDate end) &#123;</span><br><span class="line">        <span class="comment">//1. è®¾ç½®PageHelperåˆ†é¡µå‚æ•°</span></span><br><span class="line">        PageHelper.startPage(page, pageSize);</span><br><span class="line">        <span class="comment">//2. æ‰§è¡ŒæŸ¥è¯¢</span></span><br><span class="line">        List&lt;Emp&gt; empList = empMapper.list(name, gender, begin, end);</span><br><span class="line">        <span class="comment">//3. å°è£…åˆ†é¡µç»“æœ</span></span><br><span class="line">        Page&lt;Emp&gt; p = (Page&lt;Emp&gt;) empList;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span><span class="type"></span> PageResult(p.getTotal(), p.getResult());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3). è°ƒæ•´EmpMapperæ¥å£æ–¹æ³•</strong></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Mapper</span><br><span class="line"><span class="keyword">public</span> interface EmpMapper &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**     </span></span><br><span class="line"><span class="comment">    * æŸ¥è¯¢æ‰€æœ‰çš„å‘˜å·¥åŠå…¶å¯¹åº”çš„éƒ¨é—¨åç§°    </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Emp&gt; <span class="title">list</span><span class="params">(<span class="type">String</span> name, Integer gender, LocalDate begin, LocalDate end)</span></span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºSQLè¯­å¥æ¯”è¾ƒå¤æ‚ï¼Œå»ºè®®å°†SQLè¯­å¥é…ç½®åœ¨XMLæ˜ å°„æ–‡ä»¶ä¸­ã€‚</p><p><strong>4). æ–°å¢Mapperæ˜ å°„æ–‡ä»¶</strong>**<code>EmpMapper.xml</code>**</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="comment">&lt;!--å®šä¹‰Mapperæ˜ å°„æ–‡ä»¶çš„çº¦æŸå’ŒåŸºæœ¬ç»“æ„--&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span></span><br><span class="line"><span class="meta"><span class="language-xml">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span></span><br><span class="line"><span class="meta"><span class="language-xml">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.mapper.EmpMapper&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.Emp&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        select e.*, d.name deptName from emp as e left join dept as d on e.dept_id = d.id</span></span><br><span class="line"><span class="language-xml">        where e.name like concat(&#x27;%&#x27;,#</span><span class="template-variable">&#123;name&#125;</span><span class="language-xml">,&#x27;%&#x27;)</span></span><br><span class="line"><span class="language-xml">          and e.gender = #</span><span class="template-variable">&#123;gender&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">          and e.entry_date between #</span><span class="template-variable">&#123;begin&#125;</span><span class="language-xml"> and #</span><span class="template-variable">&#123;end&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="1-4-4ç¨‹åºä¼˜åŒ–1ï¼ˆè¯·æ±‚å‚æ•°å°è£…å®ä½“ç±»ç®€åŒ–ä»£ç ï¼‰">1.4.4ç¨‹åºä¼˜åŒ–1ï¼ˆè¯·æ±‚å‚æ•°å°è£…å®ä½“ç±»ç®€åŒ–ä»£ç ï¼‰</h4><p>åœ¨ä¸Šè¿°åˆ†é¡µæ¡ä»¶æŸ¥è¯¢ä¸­ï¼Œè¯·æ±‚å‚æ•°æ¯”è¾ƒå¤šï¼Œæœ‰6ä¸ªï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li>è¯·æ±‚å‚æ•°ï¼š/emps?name=å¼ &amp;gender=1&amp;begin=2007-09-01&amp;end=2022-09-01&amp;page=1&amp;pageSize=10</li></ul><p>é‚£æˆ‘ä»¬åœ¨controllerå±‚æ–¹æ³•ä¸­ï¼Œæ¥æ”¶è¯·æ±‚å‚æ•°çš„æ—¶å€™ï¼Œç›´æ¥åœ¨controlleræ–¹æ³•ä¸­å£°æ˜è¿™æ ·6ä¸ªå‚æ•°å³å¯ï¼Œè¿™æ ·åšï¼ŒåŠŸèƒ½å¯ä»¥å®ç°ï¼Œä½†æ˜¯ä¸æ–¹ä¾¿ç»´æŠ¤å’Œç®¡ç†ã€‚</p><p>ä¼˜åŒ–æ€è·¯ï¼šå®šä¹‰ä¸€ä¸ªå®ä½“ç±»ï¼Œæ¥å°è£…è¿™å‡ ä¸ªè¯·æ±‚å‚æ•°ã€‚ <strong>ã€éœ€è¦ä¿è¯ï¼Œå‰ç«¯ä¼ é€’çš„è¯·æ±‚å‚æ•°å’Œå®ä½“ç±»çš„å±æ€§åæ˜¯ä¸€æ ·çš„ã€‘</strong></p><p><strong>1). å®šä¹‰å®ä½“ç±»ï¼šEmpQueryParam</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.format.annotation.DateTimeFormat;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpQueryParam</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">page</span> <span class="operator">=</span> <span class="number">1</span>; <span class="comment">//é¡µç </span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">pageSize</span> <span class="operator">=</span> <span class="number">10</span>; <span class="comment">//æ¯é¡µå±•ç¤ºè®°å½•æ•°</span></span><br><span class="line">    <span class="keyword">private</span> String name; <span class="comment">//å§“å</span></span><br><span class="line">    <span class="keyword">private</span> Integer gender; <span class="comment">//æ€§åˆ«</span></span><br><span class="line">    <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDate begin; <span class="comment">//å…¥èŒå¼€å§‹æ—¶é—´</span></span><br><span class="line">    <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDate end; <span class="comment">//å…¥èŒç»“æŸæ—¶é—´</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2). EmpControlleræ¥æ”¶è¯·æ±‚å‚æ•°</strong></p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line"><span class="keyword">public</span> <span class="function">Result <span class="title">page</span><span class="params">(EmpQueryParam empQueryParam)</span> </span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;æŸ¥è¯¢è¯·æ±‚å‚æ•°ï¼š &#123;&#125;&quot;</span>, empQueryParam);</span><br><span class="line">    PageResult pageResult = empService.page(empQueryParam);</span><br><span class="line">    <span class="function"><span class="keyword">return</span> Result.<span class="title">success</span><span class="params">(pageResult)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3). ä¿®æ”¹EmpServiceæ¥å£æ–¹æ³•</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">public</span> interface EmpService &#123;</span><br><span class="line">    <span class="comment">/**     * åˆ†é¡µæŸ¥è¯¢     */</span></span><br><span class="line">//PageResult page(<span class="type">Integer</span> page, <span class="type">Integer</span> pageSize, String <span class="type">name</span>, <span class="type">Integer</span> gender, LocalDate <span class="keyword">begin</span>, LocalDate <span class="keyword">end</span>);</span><br><span class="line">    PageResult page(EmpQueryParam empQueryParam);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>4). ä¿®æ”¹EmpServiceImplä¸­çš„pageæ–¹æ³•</strong></p><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">@</span>Service</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> EmpServiceImpl implements EmpService &#123;</span><br><span class="line"></span><br><span class="line">    <span class="operator">@</span>Autowired</span><br><span class="line">    <span class="keyword">private</span> EmpMapper empMapper;</span><br><span class="line"></span><br><span class="line">    <span class="operator">/*@</span>Override</span><br><span class="line">    <span class="keyword">public</span> PageResult page(Integer page, Integer pageSize, String name, Integer gender, LocalDate <span class="keyword">begin</span>, LocalDate <span class="keyword">end</span>) &#123;</span><br><span class="line">        <span class="comment">//1. è®¾ç½®PageHelperåˆ†é¡µå‚æ•°</span></span><br><span class="line">        PageHelper.startPage(page, pageSize);</span><br><span class="line">        <span class="comment">//2. æ‰§è¡ŒæŸ¥è¯¢</span></span><br><span class="line">        List<span class="operator">&lt;</span>Emp<span class="operator">&gt;</span> empList <span class="operator">=</span> empMapper.list(name, gender, <span class="keyword">begin</span>, <span class="keyword">end</span>);</span><br><span class="line">        <span class="comment">//3. å°è£…åˆ†é¡µç»“æœ</span></span><br><span class="line">        Page<span class="operator">&lt;</span>Emp<span class="operator">&gt;</span> p <span class="operator">=</span> (Page<span class="operator">&lt;</span>Emp<span class="operator">&gt;</span>) empList;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PageResult(p.getTotal(), p.getResult());</span><br><span class="line">    &#125;<span class="operator">*/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> PageResult page(EmpQueryParam empQueryParam) &#123;</span><br><span class="line">        <span class="comment">//1. è®¾ç½®PageHelperåˆ†é¡µå‚æ•°</span></span><br><span class="line">        PageHelper.startPage(empQueryParam.getPage(), empQueryParam.getPageSize());</span><br><span class="line">        <span class="comment">//2. æ‰§è¡ŒæŸ¥è¯¢</span></span><br><span class="line">        List<span class="operator">&lt;</span>Emp<span class="operator">&gt;</span> empList <span class="operator">=</span> empMapper.list(empQueryParam);</span><br><span class="line">        <span class="comment">//3. å°è£…åˆ†é¡µç»“æœ</span></span><br><span class="line">        Page<span class="operator">&lt;</span>Emp<span class="operator">&gt;</span> p <span class="operator">=</span> (Page<span class="operator">&lt;</span>Emp<span class="operator">&gt;</span>)empList;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PageResult(p.getTotal(), p.getResult());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>5). ä¿®æ”¹EmpMapperæ¥å£æ–¹æ³•</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Mapper</span><br><span class="line"><span class="built_in">public</span> interface EmpMapper &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**     * æŸ¥è¯¢æ‰€æœ‰çš„å‘˜å·¥åŠå…¶å¯¹åº”çš„éƒ¨é—¨åç§°     */</span></span><br><span class="line">//    @<span class="keyword">Select</span>(&quot;select e.*, d.name as deptName from emp e left join dept d on e.dept_id = d.id&quot;)</span><br><span class="line">//    <span class="built_in">public</span> List&lt;Emp&gt; list(String <span class="type">name</span>, <span class="type">Integer</span> gender, LocalDate <span class="keyword">begin</span>, LocalDate <span class="keyword">end</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**     * æ ¹æ®æŸ¥è¯¢æ¡ä»¶æŸ¥è¯¢å‘˜å·¥     */</span></span><br><span class="line">List&lt;Emp&gt; list(EmpQueryParam empQueryParam);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>EmpMapper.xml ä¸­çš„é…ç½®æ— éœ€ä¿®æ”¹ã€‚</p><p>ä½†å½“æˆ‘ä»¬åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œé¡µç è¾“å…¥è´Ÿæ•°ï¼ŒæŸ¥è¯¢æ˜¯æœ‰é—®é¢˜çš„ï¼ŒæŸ¥ä¸åˆ°å¯¹åº”çš„æ•°æ®äº†ã€‚</p><p>é‚£å…¶å®åœ¨PageHelperä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆç†åŒ–å‚æ•°é…ç½®ï¼Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ç›´æ¥åœ¨application.ymlä¸­ï¼Œå¼•å…¥å¦‚ä¸‹é…ç½®å³å¯ï¼š</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">pagehelper:</span></span><br><span class="line">  <span class="params">reasonable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="params">helper-dialect:</span> mysql</span><br></pre></td></tr></table></figure><p>reasonableï¼šåˆ†é¡µåˆç†åŒ–å‚æ•°ï¼Œé»˜è®¤å€¼ä¸ºfalseã€‚å½“è¯¥å‚æ•°è®¾ç½®ä¸ºtrueæ—¶ï¼ŒpageNum&lt;=0æ—¶ä¼šæŸ¥è¯¢ç¬¬ä¸€é¡µï¼ŒpageNum&gt;pagesï¼ˆè¶…è¿‡æ€»æ•°æ—¶ï¼‰ï¼Œä¼šæŸ¥è¯¢æœ€åä¸€é¡µã€‚é»˜è®¤false æ—¶ï¼Œç›´æ¥æ ¹æ®å‚æ•°è¿›è¡ŒæŸ¥è¯¢ã€‚</p><h4 id="1-4-5ç¨‹åºä¼˜åŒ–2ï¼ˆåŠ¨æ€SQLæ”¹é€ ï¼‰">1.4.5ç¨‹åºä¼˜åŒ–2ï¼ˆåŠ¨æ€SQLæ”¹é€ ï¼‰</h4><p>å½“å‰ï¼Œæˆ‘ä»¬åœ¨æŸ¥è¯¢çš„æ—¶å€™ï¼ŒMapperæ˜ å°„é…ç½®æ–‡ä»¶ä¸­çš„SQLè¯­å¥ä¸­ï¼ŒæŸ¥è¯¢æ¡ä»¶æ˜¯å†™æ­»çš„ã€‚ è€Œæˆ‘ä»¬åœ¨å‘˜å·¥ç®¡ç†ä¸­ï¼Œæ ¹æ®æ¡ä»¶æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯æ—¶ï¼ŒæŸ¥è¯¢æ¡ä»¶æ˜¯å¯é€‰çš„ï¼Œå¯ä»¥è¾“å…¥ä¹Ÿå¯ä»¥ä¸è¾“å…¥ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-322-1024x94.png" alt="img"></p><ul><li>å¦‚æœåªè¾“å…¥ <strong>å§“å</strong> è¿™ä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œåˆ™SQLè¯­å¥ä¸­åªæ ¹æ®nameå­—æ®µæŸ¥è¯¢ï¼ŒSQLå¦‚ä¸‹ï¼š</li></ul><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">e</span>.*, d.name deptName <span class="keyword">from</span> emp <span class="keyword">as</span> <span class="built_in">e</span> <span class="keyword">left</span> <span class="keyword">join</span> dept <span class="keyword">as</span> d <span class="keyword">on</span> <span class="built_in">e</span>.dept_id = d.id <span class="keyword">where</span> <span class="built_in">e</span>.name <span class="keyword">like</span> concat(<span class="string">&#x27;%&#x27;</span>,#&#123;name&#125;,<span class="string">&#x27;%&#x27;</span>)ï¼›</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœåªè¾“å…¥ <strong>æ€§åˆ«</strong> è¿™ä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œåˆ™SQLè¯­å¥ä¸­åªæ ¹æ®genderå­—æ®µæŸ¥è¯¢ï¼ŒSQLå¦‚ä¸‹ï¼š</li></ul><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">e</span>.*, d.name deptName <span class="keyword">from</span> emp <span class="keyword">as</span> <span class="built_in">e</span> <span class="keyword">left</span> <span class="keyword">join</span> dept <span class="keyword">as</span> d <span class="keyword">on</span> <span class="built_in">e</span>.dept_id = d.id <span class="keyword">where</span> <span class="built_in">e</span>.gender = #&#123;gender&#125;ï¼›</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœè¾“å…¥ <strong>å§“å</strong> å’Œ <strong>æ€§åˆ«</strong> è¿™ä¸¤ä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œåˆ™SQLè¯­å¥ä¸­è¦æ ¹æ®nameã€genderä¸¤ä¸ªå­—æ®µæŸ¥è¯¢ï¼ŒSQLå¦‚ä¸‹ï¼š</li></ul><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">e</span>.*, d.name deptName <span class="keyword">from</span> emp <span class="keyword">as</span> <span class="built_in">e</span> <span class="keyword">left</span> <span class="keyword">join</span> dept <span class="keyword">as</span> d <span class="keyword">on</span> <span class="built_in">e</span>.dept_id = d.id</span><br><span class="line"><span class="keyword">where</span> <span class="built_in">e</span>.name <span class="keyword">like</span> concat(<span class="string">&#x27;%&#x27;</span>,#&#123;name&#125;,<span class="string">&#x27;%&#x27;</span>) <span class="keyword">and</span> <span class="built_in">e</span>.gender = #&#123;gender&#125;ï¼›</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œè¿™ä¸ªSQLè¯­å¥ä¸åº”è¯¥æ˜¯å†™æ­»çš„ï¼Œè€Œåº”è¯¥æ ¹æ®ç”¨æˆ·è¾“å…¥çš„æ¡ä»¶çš„å˜åŒ–è€Œå˜åŒ–ã€‚ é‚£è¿™é‡Œå‘¢ï¼Œå°±è¦é€šè¿‡Mybatisä¸­çš„<strong>åŠ¨æ€SQL</strong>æ¥å®ç°ã€‚</p><p><strong>æ‰€è°“åŠ¨æ€SQLï¼ŒæŒ‡çš„å°±æ˜¯éšç€ç”¨æˆ·çš„è¾“å…¥æˆ–å¤–éƒ¨çš„æ¡ä»¶çš„å˜åŒ–è€Œå˜åŒ–çš„SQLè¯­å¥ã€‚</strong></p><p>å…·ä½“çš„ä»£ç å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="comment">&lt;!--å®šä¹‰Mapperæ˜ å°„æ–‡ä»¶çš„çº¦æŸå’ŒåŸºæœ¬ç»“æ„--&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span></span><br><span class="line"><span class="meta"><span class="language-xml">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span></span><br><span class="line"><span class="meta"><span class="language-xml">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.mapper.EmpMapper&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.Emp&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        select e.*, d.name deptName from emp as e left join dept as d on e.dept_id = d.id</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                e.name like concat(&#x27;%&#x27;,#</span><span class="template-variable">&#123;name&#125;</span><span class="language-xml">,&#x27;%&#x27;)</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                and e.gender = #</span><span class="template-variable">&#123;gender&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;begin != null and end != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                and e.entry_date between #</span><span class="template-variable">&#123;begin&#125;</span><span class="language-xml"> and #</span><span class="template-variable">&#123;end&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œå‘¢ï¼Œæˆ‘ä»¬ç”¨åˆ°äº†ä¸¤ä¸ªåŠ¨æ€SQLçš„æ ‡ç­¾ï¼š<code>&lt;if&gt;``&lt;where&gt;</code>ã€‚ è¿™ä¸¤ä¸ªæ ‡ç­¾çš„å…·ä½“ä½œç”¨å¦‚ä¸‹ï¼š</p><p><code>&lt;if&gt;</code>ï¼šåˆ¤æ–­æ¡ä»¶æ˜¯å¦æˆç«‹ï¼Œå¦‚æœæ¡ä»¶ä¸ºtrueï¼Œåˆ™æ‹¼æ¥SQLã€‚</p><p><code>&lt;where&gt;</code>ï¼šæ ¹æ®æŸ¥è¯¢æ¡ä»¶ï¼Œæ¥ç”Ÿæˆwhereå…³é”®å­—ï¼Œå¹¶ä¼šè‡ªåŠ¨å»é™¤æ¡ä»¶å‰é¢å¤šä½™çš„andæˆ–orã€‚</p><p>å½“æˆ‘ä»¬è¾“å…¥ä¸åŒçš„æœç´¢æ¡ä»¶æ—¶ï¼Œä¼šåŠ¨æ€çš„æ ¹æ®æŸ¥è¯¢æ¡ä»¶ï¼ŒåŠ¨æ€æ‹¼æ¥SQLè¯­å¥ã€‚</p><h2 id="2-æ–°å¢å‘˜å·¥">2.æ–°å¢å‘˜å·¥</h2><h3 id="2-1éœ€æ±‚">2.1éœ€æ±‚</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-323.png" alt="img"></p><p>åœ¨æ–°å¢å‘˜å·¥çš„æ—¶å€™ï¼Œåœ¨è¡¨å•ä¸­ï¼Œæˆ‘ä»¬æ—¢è¦å½•å…¥å‘˜å·¥çš„åŸºæœ¬ä¿¡æ¯ï¼Œåˆè¦å½•å…¥å‘˜å·¥çš„å·¥ä½œç»å†ä¿¡æ¯ã€‚ å‘˜å·¥åŸºæœ¬ä¿¡æ¯ï¼Œå¯¹åº”çš„è¡¨ç»“æ„æ˜¯ empè¡¨ï¼Œå‘˜å·¥å·¥ä½œç»å†ä¿¡æ¯ï¼Œå¯¹åº”çš„è¡¨ç»“æ„æ˜¯ emp_expr è¡¨ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è¦æ“ä½œä¸¤å¼ è¡¨ï¼Œå¾€ä¸¤å¼ è¡¨ä¸­ä¿å­˜æ•°æ®ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-330-1024x854.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-331-1024x695.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-332-1024x506.png" alt="img"></p><h3 id="2-2å®ç°æ€è·¯">2.2å®ç°æ€è·¯</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-333-1024x263.png" alt="img"></p><ul><li>æ¥å£æ–‡æ¡£è§„å®šï¼š<ul><li>è¯·æ±‚è·¯å¾„ï¼š/emps</li><li>è¯·æ±‚æ–¹å¼ï¼šPOST</li><li>è¯·æ±‚å‚æ•°ï¼šJsonæ ¼å¼æ•°æ®</li><li>å“åº”æ•°æ®ï¼šJsonæ ¼å¼æ•°æ®</li></ul></li><li>**é—®é¢˜1ï¼š**å¦‚ä½•é™å®šè¯·æ±‚æ–¹å¼æ˜¯POSTï¼Ÿ <strong><code>@PostMapping</code></strong></li><li><strong>é—®é¢˜2ï¼š<strong>æ€ä¹ˆåœ¨controllerä¸­æ¥æ”¶jsonæ ¼å¼çš„è¯·æ±‚å‚æ•°ï¼Ÿ</strong><code>@RequestBody</code></strong></li></ul><h3 id="2-3åŠŸèƒ½å¼€å‘">2.3åŠŸèƒ½å¼€å‘</h3><h4 id="2-3-1å‡†å¤‡å·¥ä½œ">2.3.1å‡†å¤‡å·¥ä½œ</h4><p>å‡†å¤‡<code>EmpExprMapper</code>æ¥å£åŠæ˜ å°„é…ç½®æ–‡ä»¶<code>EmpExprMapper.xml</code>ï¼Œå¹¶å‡†å¤‡å®ä½“ç±»æ¥æ”¶å‰ç«¯ä¼ é€’çš„jsonæ ¼å¼çš„è¯·æ±‚å‚æ•°ã€‚</p><p>1). EmpExprMapperæ¥å£</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_"><span class="keyword">interface</span> <span class="title">EmpExprMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2). EmpExprMapper.xml é…ç½®æ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.mapper.EmpExprMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3). éœ€è¦åœ¨ <code>Emp</code> å‘˜å·¥å®ä½“ç±»ä¸­å¢åŠ å±æ€§ <code>exprList</code> æ¥å°è£…å·¥ä½œç»å†æ•°æ®ã€‚ æœ€ç»ˆå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">Data</span></span><br><span class="line"><span class="keyword">public</span> class Emp &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Integer</span> id; <span class="comment">//ID,ä¸»é”®</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">String</span> username; <span class="comment">//ç”¨æˆ·å</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">String</span> password; <span class="comment">//å¯†ç </span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">String</span> name; <span class="comment">//å§“å</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Integer</span> gender; <span class="comment">//æ€§åˆ«, 1:ç”·, 2:å¥³</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">String</span> phone; <span class="comment">//æ‰‹æœºå·</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Integer</span> job; <span class="comment">//èŒä½, 1:ç­ä¸»ä»»,2:è®²å¸ˆ,3:å­¦å·¥ä¸»ç®¡,4:æ•™ç ”ä¸»ç®¡,5:å’¨è¯¢å¸ˆ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Integer</span> salary; <span class="comment">//è–ªèµ„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">String</span> image; <span class="comment">//å¤´åƒ</span></span><br><span class="line">    <span class="keyword">private</span> LocalDate entryDate; <span class="comment">//å…¥èŒæ—¥æœŸ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Integer</span> deptId; <span class="comment">//å…³è”çš„éƒ¨é—¨ID</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime; <span class="comment">//åˆ›å»ºæ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime; <span class="comment">//ä¿®æ”¹æ—¶é—´</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°è£…éƒ¨é—¨åç§°æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">String</span> deptName; <span class="comment">//éƒ¨é—¨åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°è£…å‘˜å·¥å·¥ä½œç»å†ä¿¡æ¯    private List&lt;EmpExpr&gt; exprList;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-3-2ä¿å­˜å‘˜å·¥åŸºæœ¬ä¿¡æ¯">2.3.2ä¿å­˜å‘˜å·¥åŸºæœ¬ä¿¡æ¯</h4><p>1). EmpController</p><p>åœ¨ <code>EmpController</code> ä¸­å¢åŠ saveæ–¹æ³•ã€‚</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ·»åŠ å‘˜å·¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable">@PostMapping</span></span><br><span class="line">public Result <span class="built_in">save</span>(<span class="variable">@RequestBody</span> Emp emp)&#123;</span><br><span class="line">    <span class="selector-tag">log</span><span class="selector-class">.info</span>(<span class="string">&quot;è¯·æ±‚å‚æ•°emp: &#123;&#125;&quot;</span>, emp);</span><br><span class="line">    <span class="selector-tag">empService</span><span class="selector-class">.save</span>(emp);</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">Result</span><span class="selector-class">.success</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2). EmpService &amp; EmpServiceImpl</p><p>åœ¨ <code>EmpService</code> ä¸­å¢åŠ  save æ–¹æ³•</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ·»åŠ å‘˜å·¥</span></span><br><span class="line"><span class="comment">* @param emp</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">save</span><span class="params">(Emp emp)</span></span>;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>EmpServiceImpl</code> ä¸­å¢åŠ saveæ–¹æ³• , å®ç°æ¥å£ä¸­çš„saveæ–¹æ³•</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@Override</span></span><br><span class="line">public void save(Emp emp) &#123;</span><br><span class="line">    <span class="comment">//1.è¡¥å…¨åŸºç¡€å±æ€§</span></span><br><span class="line">    emp<span class="selector-class">.setCreateTime</span>(LocalDateTime.now());</span><br><span class="line">    emp<span class="selector-class">.setUpdateTime</span>(LocalDateTime.now());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//2.ä¿å­˜å‘˜å·¥åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">    empMapper<span class="selector-class">.insert</span>(emp);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3. ä¿å­˜å‘˜å·¥çš„å·¥ä½œç»å†ä¿¡æ¯ - æ‰¹é‡ (ç¨åå®Œæˆ)</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3). EmpMapper</p><p>åœ¨ <code>EmpMapper</code> ä¸­å¢åŠ insertæ–¹æ³•ï¼Œæ–°å¢å‘˜å·¥çš„åŸºæœ¬ä¿¡æ¯ã€‚</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ–°å¢å‘˜å·¥æ•°æ®</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">@Options(useGeneratedKeys = <span class="literal">true</span>, keyProperty = <span class="string">&quot;id&quot;</span>)</span><br><span class="line">@Insert(<span class="string">&quot;insert into emp(username, name, gender, phone, job, salary, image, entry_date, dept_id, create_time, update_time) &quot;</span> +</span><br><span class="line">        <span class="string">&quot;values (<span class="subst">#&#123;username&#125;</span>,<span class="subst">#&#123;name&#125;</span>,<span class="subst">#&#123;gender&#125;</span>,<span class="subst">#&#123;phone&#125;</span>,<span class="subst">#&#123;job&#125;</span>,<span class="subst">#&#123;salary&#125;</span>,<span class="subst">#&#123;image&#125;</span>,<span class="subst">#&#123;entryDate&#125;</span>,<span class="subst">#&#123;deptId&#125;</span>,<span class="subst">#&#123;createTime&#125;</span>,<span class="subst">#&#123;updateTime&#125;</span>)&quot;</span>)</span><br><span class="line"><span class="literal">void</span> insert(Emp emp);</span><br></pre></td></tr></table></figure><p><strong>ä¸»é”®è¿”å›ï¼š</strong><code>@Options(useGeneratedKeys = true, keyProperty = &quot;id&quot;)</code></p><p>ç”±äºç¨åï¼Œæˆ‘ä»¬åœ¨ä¿å­˜å·¥ä½œç»å†ä¿¡æ¯çš„æ—¶å€™ï¼Œéœ€è¦è®°å½•æ˜¯å“ªä½å‘˜å·¥çš„å·¥ä½œç»å†ã€‚ æ‰€ä»¥ï¼Œä¿å­˜å®Œå‘˜å·¥ä¿¡æ¯ä¹‹åï¼Œæ˜¯éœ€è¦è·å–åˆ°å‘˜å·¥çš„IDçš„ï¼Œé‚£è¿™é‡Œå°±éœ€è¦<strong>é€šè¿‡Mybatisä¸­æä¾›çš„ä¸»é”®è¿”å›åŠŸèƒ½æ¥è·å–</strong>ã€‚</p><h4 id="2-3-3æ‰¹é‡ä¿å­˜å·¥ä½œç»å†">2.3.3æ‰¹é‡ä¿å­˜å·¥ä½œç»å†</h4><h5 id="1-åˆ†æ">1.åˆ†æ</h5><p>ä¸€ä¸ªå‘˜å·¥ï¼Œæ˜¯å¯ä»¥æœ‰å¤šæ®µå·¥ä½œç»å†çš„ï¼Œæ‰€ä»¥åœ¨é¡µé¢ä¸Šå°†æ¥ç”¨æˆ·å½•å…¥å‘˜å·¥ä¿¡æ¯æ—¶ï¼Œå¯ä»¥è‡ªå·±æ ¹æ®éœ€è¦æ·»åŠ å¤šæ®µå·¥ä½œç»å†ã€‚é¡µé¢åŸå‹å±•ç¤ºå¦‚ä¸‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-344.png" alt="img"></p><p>é‚£å¦‚æœå‘˜å·¥åªæœ‰ä¸€æ®µå·¥ä½œç»å†ï¼Œæˆ‘ä»¬å°±éœ€è¦å¾€å·¥ä½œç»å†è¡¨ä¸­ä¿å­˜ä¸€æ¡è®°å½•ã€‚ æ‰§è¡Œçš„SQLå¦‚ä¸‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-374-1024x85.png" alt="img"></p><p>å¦‚æœå‘˜å·¥æœ‰ä¸¤æ®µå·¥ä½œç»å†ï¼Œæˆ‘ä»¬å°±éœ€è¦å¾€å·¥ä½œç»å†è¡¨ä¸­ä¿å­˜ä¸¤æ¡è®°å½•ã€‚æ‰§è¡Œçš„SQLå¦‚ä¸‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-375-1024x106.png" alt="img"></p><p>å¦‚æœå‘˜å·¥æœ‰ä¸‰æ®µå·¥ä½œç»å†ï¼Œæˆ‘ä»¬å°±éœ€è¦å¾€å·¥ä½œç»å†è¡¨ä¸­ä¿å­˜ä¸‰æ¡è®°å½•ã€‚æ‰§è¡Œçš„SQLå¦‚ä¸‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-376-1024x119.png" alt="img"></p><p>æ‰€ä»¥ï¼Œè¿™é‡Œæœ€ç»ˆæˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„æ˜¯æ‰¹é‡æ’å…¥æ•°æ®çš„insertè¯­å¥ã€‚</p><h5 id="2-ä»£ç å®ç°">2.ä»£ç å®ç°</h5><p>1). EmpServiceImpl</p><p>å®Œå–„saveæ–¹æ³•ä¸­ä¿å­˜å‘˜å·¥ä¿¡æ¯çš„é€»è¾‘ã€‚å®Œæ•´é€»è¾‘å¦‚ä¸‹ï¼š</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public <span class="keyword">void</span> save(Emp emp) &#123;</span><br><span class="line">    <span class="comment">//1.è¡¥å…¨åŸºç¡€å±æ€§</span></span><br><span class="line">    emp.setCreateTime(LocalDateTime.<span class="built_in">now</span>());</span><br><span class="line">    emp.setUpdateTime(LocalDateTime.<span class="built_in">now</span>());</span><br><span class="line">    <span class="comment">//2.ä¿å­˜å‘˜å·¥åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">    empMapper.<span class="built_in">insert</span>(emp);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3. ä¿å­˜å‘˜å·¥çš„å·¥ä½œç»å†ä¿¡æ¯ - æ‰¹é‡</span></span><br><span class="line">    Integer empId = emp.getId();</span><br><span class="line">    List&lt;EmpExpr&gt; exprList = emp.getExprList();</span><br><span class="line">    <span class="keyword">if</span>(!CollectionUtils.<span class="built_in">isEmpty</span>(exprList))&#123;</span><br><span class="line">        exprList.forEach(empExpr -&gt; empExpr.setEmpId(empId));</span><br><span class="line">        empExprMapper.insertBatch(exprList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2). EmpExprMapper</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Mapper</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="symbol">EmpExprMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡æ’å…¥å‘˜å·¥å·¥ä½œç»å†ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> insertBatch(List&lt;EmpExpr&gt; exprList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3). EmpExprMapper.xml</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span></span><br><span class="line"><span class="meta"><span class="language-xml">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span></span><br><span class="line"><span class="meta"><span class="language-xml">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.mapper.EmpExprMapper&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!--æ‰¹é‡æ’å…¥å‘˜å·¥å·¥ä½œç»å†ä¿¡æ¯--&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertBatch&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        insert into emp_expr (emp_id, begin, end, company, job) values</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;exprList&quot;</span> <span class="attr">item</span>=<span class="string">&quot;expr&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            (#</span><span class="template-variable">&#123;expr.empId&#125;</span><span class="language-xml">, #</span><span class="template-variable">&#123;expr.begin&#125;</span><span class="language-xml">, #</span><span class="template-variable">&#123;expr.end&#125;</span><span class="language-xml">, #</span><span class="template-variable">&#123;expr.company&#125;</span><span class="language-xml">, #</span><span class="template-variable">&#123;expr.job&#125;</span><span class="language-xml">)</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span></span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œç”¨åˆ°Mybatisä¸­çš„åŠ¨æ€SQLé‡Œæä¾›çš„ <code>&lt;foreach&gt;</code> æ ‡ç­¾ï¼Œæ”¹æ ‡ç­¾çš„ä½œç”¨ï¼Œæ˜¯ç”¨æ¥éå†å¾ªç¯ï¼Œå¸¸è§çš„å±æ€§è¯´æ˜ï¼š</p><ol><li>collectionï¼šé›†åˆåç§°</li><li>itemï¼šé›†åˆéå†å‡ºæ¥çš„å…ƒç´ /é¡¹</li><li>separatorï¼šæ¯ä¸€æ¬¡éå†ä½¿ç”¨çš„åˆ†éš”ç¬¦</li><li>openï¼šéå†å¼€å§‹å‰æ‹¼æ¥çš„ç‰‡æ®µ</li><li>closeï¼šéå†ç»“æŸåæ‹¼æ¥çš„ç‰‡æ®µ</li></ol><p>ä¸Šè¿°çš„å±æ€§ï¼Œæ˜¯å¯é€‰çš„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„éƒ½æ˜¯å¿…é¡»çš„ã€‚ å¯ä»¥è‡ªå·±æ ¹æ®å®é™…éœ€æ±‚ï¼Œæ¥æŒ‡å®šå¯¹åº”çš„å±æ€§ã€‚</p></blockquote><p>Apifoxè¯·æ±‚å®Œæ¯•åï¼Œå¯ä»¥æ‰“å¼€ideaçš„æ§åˆ¶å°çœ‹åˆ°æ§åˆ¶å°è¾“å‡ºçš„æ—¥å¿—ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-377-1024x246.png" alt="img"></p><h2 id="3-äº‹åŠ¡ç®¡ç†">3.äº‹åŠ¡ç®¡ç†</h2><h3 id="3-1é—®é¢˜åˆ†æ">3.1é—®é¢˜åˆ†æ</h3><p>ç›®å‰æˆ‘ä»¬å®ç°çš„æ–°å¢å‘˜å·¥åŠŸèƒ½ä¸­ï¼Œæ“ä½œäº†ä¸¤æ¬¡æ•°æ®åº“ï¼Œæ‰§è¡Œäº†ä¸¤æ¬¡ insert æ“ä½œã€‚</p><ul><li>ç¬¬ä¸€æ¬¡ï¼šä¿å­˜å‘˜å·¥çš„åŸºæœ¬ä¿¡æ¯åˆ° <code>emp</code> è¡¨ä¸­ã€‚</li><li>ç¬¬äºŒæ¬¡ï¼šä¿å­˜å‘˜å·¥çš„å·¥ä½œç»å†ä¿¡æ¯åˆ° <code>emp_expr</code> è¡¨ä¸­ã€‚</li></ul><p>å¦‚æœè¯´ï¼Œä¿å­˜å‘˜å·¥çš„åŸºæœ¬ä¿¡æ¯æˆåŠŸäº†ï¼Œè€Œä¿å­˜å‘˜å·¥çš„å·¥ä½œç»å†ä¿¡æ¯å‡ºé”™äº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆç°è±¡å‘¢ï¼Ÿé‚£æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥åšä¸€ä¸ªæµ‹è¯• ã€‚ æˆ‘ä»¬å¯ä»¥åœ¨ä»£ç ä¸­ï¼Œäººä¸ºåœ¨ä¿å­˜å‘˜å·¥çš„serviceå±‚çš„saveæ–¹æ³•ä¸­ï¼Œæ„é€ ä¸€ä¸ªé”™è¯¯ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-345-1024x508.png" alt="img"></p><p>é‚£æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±é‡å¯æœåŠ¡ï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œæ¥åšä¸€ä¸ªæµ‹è¯•ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-378-1024x496.png" alt="img"></p><p>ç‚¹å‡» â€œä¿å­˜â€ ä¹‹åï¼Œæç¤º â€œç³»ç»Ÿæ¥å£å¼‚å¸¸â€ã€‚æˆ‘ä»¬å¯ä»¥æ‰“å¼€IDEAæ§åˆ¶å°çœ‹ä¸€ä¸‹ï¼ŒæŠ¥å‡ºçš„é”™è¯¯ä¿¡æ¯ã€‚ æˆ‘ä»¬çœ‹åˆ°ï¼Œä¿å­˜äº†å‘˜å·¥çš„åŸºæœ¬ä¿¡æ¯ä¹‹åï¼Œç³»ç»Ÿå‡ºç°äº†å¼‚å¸¸ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-379-1024x392.png" alt="img"></p><p>æˆ‘ä»¬å†æ‰“å¼€æ•°æ®åº“ï¼Œçœ‹çœ‹è¡¨ç»“æ„ä¸­çš„æ•°æ®æ˜¯å¦æ­£å¸¸ã€‚</p><p>1). <code>emp</code> å‘˜å·¥è¡¨ä¸­æ˜¯æœ‰ <code>shaseng</code> è¿™æ¡æ•°æ®çš„ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-381-1024x464.png" alt="img"></p><p>2). <code>emp_expr</code> è¡¨ä¸­æ²¡æœ‰è¯¥å‘˜å·¥çš„å·¥ä½œç»å†ä¿¡æ¯ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-380-1024x159.png" alt="img"></p><p>æœ€ç»ˆï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼Œç¨‹åºå‡ºç°äº†å¼‚å¸¸ ï¼Œå‘˜å·¥è¡¨ <code>emp</code> æ•°æ®ä¿å­˜æˆåŠŸäº†, ä½†æ˜¯ <code>emp_expr</code> å‘˜å·¥å·¥ä½œç»å†ä¿¡æ¯è¡¨ï¼Œæ•°æ®ä¿å­˜å¤±è´¥äº†ã€‚ é‚£æ˜¯å¦å…è®¸è¿™ç§æƒ…å†µå‘ç”Ÿå‘¢ï¼Ÿ</p><ul><li>ä¸å…è®¸</li><li>å› ä¸ºè¿™å±äºä¸€ä¸ªä¸šåŠ¡æ“ä½œï¼Œå¦‚æœä¿å­˜å‘˜å·¥ä¿¡æ¯æˆåŠŸäº†ï¼Œä¿å­˜å·¥ä½œç»å†ä¿¡æ¯å¤±è´¥äº†ï¼Œå°±ä¼šé€ æˆæ•°æ®åº“æ•°æ®çš„ä¸å®Œæ•´ã€ä¸ä¸€è‡´ã€‚</li></ul><p>é‚£å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ è¿™éœ€è¦é€šè¿‡æ•°æ®åº“ä¸­çš„<strong>äº‹åŠ¡</strong>æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h3 id="3-2ä»‹ç»">3.2ä»‹ç»</h3><p><strong>æ¦‚å¿µï¼š</strong> äº‹åŠ¡æ˜¯ä¸€ç»„æ“ä½œçš„é›†åˆï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ã€‚äº‹åŠ¡ä¼šæŠŠæ‰€æœ‰çš„æ“ä½œä½œä¸ºä¸€ä¸ªæ•´ä½“ä¸€èµ·å‘ç³»ç»Ÿæäº¤æˆ–æ’¤é”€æ“ä½œè¯·æ±‚ï¼Œå³è¿™äº›æ“ä½œ <strong>è¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥</strong>ã€‚</p><p>å°±æ‹¿æ·»åŠ å‘˜å·¥çš„è¿™ä¸ªä¸šåŠ¡ä¸ºä¾‹ï¼Œåœ¨è¿™ä¸ªä¸šåŠ¡æ“ä½œä¸­ï¼ŒåŒ…å«äº†ä¸¤ä¸ªæ“ä½œï¼Œé‚£è¿™ä¸¤ä¸ªæ“ä½œæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ã€‚</p><p>è¿™ä¸¤ä¸ªæ“ä½œï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ï¼Œè¦ä¹ˆåŒæ—¶æˆåŠŸã€‚</p><p>é»˜è®¤MySQLçš„äº‹åŠ¡æ˜¯è‡ªåŠ¨æäº¤çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æ‰§è¡Œä¸€æ¡DMLè¯­å¥ï¼ŒMySQLä¼šç«‹å³éšå¼çš„æäº¤äº‹åŠ¡ã€‚</p><h3 id="3-3æ“ä½œ">3.3æ“ä½œ</h3><p>äº‹åŠ¡æ§åˆ¶ä¸»è¦ä¸‰æ­¥æ“ä½œï¼šå¼€å¯äº‹åŠ¡ã€æäº¤äº‹åŠ¡/å›æ»šäº‹åŠ¡ã€‚</p><ul><li>éœ€è¦åœ¨è¿™ç»„æ“ä½œæ‰§è¡Œä¹‹å‰ï¼Œå…ˆå¼€å¯äº‹åŠ¡ ( <code>start transaction; / begin;</code>)ã€‚</li><li>æ‰€æœ‰æ“ä½œå¦‚æœå…¨éƒ¨éƒ½æ‰§è¡ŒæˆåŠŸï¼Œåˆ™æäº¤äº‹åŠ¡ ( <code>commit;</code> )ã€‚</li><li>å¦‚æœè¿™ç»„æ“ä½œä¸­ï¼Œæœ‰ä»»ä½•ä¸€ä¸ªæ“ä½œæ‰§è¡Œå¤±è´¥ï¼Œéƒ½åº”è¯¥å›æ»šäº‹åŠ¡ ( <code>rollback</code> )ã€‚</li></ul><p>é‚£æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†æ·»åŠ å‘˜å·¥çš„ä¸šåŠ¡æ“ä½œï¼Œè¿›è¡Œäº‹åŠ¡ç®¡ç†ã€‚ å…·ä½“çš„SQLå¦‚ä¸‹ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¼€å¯äº‹åŠ¡</span></span><br><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span>; / <span class="keyword">begin</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 1. ä¿å­˜å‘˜å·¥åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span> (<span class="number">39</span>, <span class="string">&#x27;Tom&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="string">&#x27;æ±¤å§†&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;13300001111&#x27;</span>, <span class="number">1</span>, <span class="number">4000</span>, <span class="string">&#x27;1.jpg&#x27;</span>, <span class="string">&#x27;2023-11-01&#x27;</span>, <span class="number">1</span>, now(), now());</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. ä¿å­˜å‘˜å·¥çš„å·¥ä½œç»å†ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp_expr(emp_id, <span class="keyword">begin</span>, <span class="keyword">end</span>, company, job) <span class="keyword">values</span> (<span class="number">39</span>,<span class="string">&#x27;2019-01-01&#x27;</span>, <span class="string">&#x27;2020-01-01&#x27;</span>, <span class="string">&#x27;ç™¾åº¦&#x27;</span>, <span class="string">&#x27;å¼€å‘&#x27;</span>),                                                                                                       (<span class="number">39</span>,<span class="string">&#x27;2020-01-10&#x27;</span>, <span class="string">&#x27;2022-02-01&#x27;</span>, <span class="string">&#x27;é˜¿é‡Œ&#x27;</span>, <span class="string">&#x27;æ¶æ„&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æäº¤äº‹åŠ¡(å…¨éƒ¨æˆåŠŸ)</span></span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å›æ»šäº‹åŠ¡(æœ‰ä¸€ä¸ªå¤±è´¥)</span></span><br><span class="line"><span class="keyword">rollback</span>;</span><br></pre></td></tr></table></figure><p>äº‹åŠ¡ç®¡ç†çš„åœºæ™¯ï¼Œæ˜¯éå¸¸å¤šçš„ï¼Œæ¯”å¦‚ï¼š</p><ul><li>é“¶è¡Œè½¬è´¦</li><li>ä¸‹å•æ‰£å‡åº“å­˜</li></ul><h3 id="3-4Springäº‹åŠ¡ç®¡ç†ï¼ˆ-Transactionalï¼‰">3.4Springäº‹åŠ¡ç®¡ç†ï¼ˆ@Transactionalï¼‰</h3><h4 id="3-4-1åˆ†æ">3.4.1åˆ†æ</h4><p>åœ¨ä¸Šè¿°å®ç°çš„æ–°å¢å‘˜å·¥çš„åŠŸèƒ½ä¸­ï¼Œä¸€æ—¦åœ¨ä¿å­˜å‘˜å·¥åŸºæœ¬ä¿¡æ¯åå‡ºç°å¼‚å¸¸ã€‚ æˆ‘ä»¬å°±ä¼šå‘ç°ï¼Œå‘˜å·¥ä¿¡æ¯ä¿å­˜æˆåŠŸï¼Œä½†æ˜¯å·¥ä½œç»å†ä¿¡æ¯ä¿å­˜å¤±è´¥ï¼Œé€ æˆäº†æ•°æ®çš„ä¸å®Œæ•´ä¸ä¸€è‡´ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-382-1024x465.png" alt="img"></p><p>äº§ç”ŸåŸå› ï¼š</p><ul><li>å…ˆæ‰§è¡Œæ–°å¢å‘˜å·¥çš„æ“ä½œï¼Œè¿™æ­¥æ‰§è¡Œå®Œæ¯•ï¼Œå°±å·²ç»å¾€å‘˜å·¥è¡¨ <code>emp</code> æ’å…¥äº†æ•°æ®ã€‚</li><li>æ‰§è¡Œ 1/0 æ“ä½œï¼ŒæŠ›å‡ºå¼‚å¸¸</li><li>æŠ›å‡ºå¼‚å¸¸ä¹‹å‰ï¼Œä¸‹é¢æ‰€æœ‰çš„ä»£ç éƒ½ä¸ä¼šæ‰§è¡Œäº†ï¼Œæ‰¹é‡ä¿å­˜å·¥ä½œç»å†ä¿¡æ¯ï¼Œè¿™ä¸ªæ“ä½œä¹Ÿä¸ä¼šæ‰§è¡Œ ã€‚</li></ul><p>æ­¤æ—¶å°±å‡ºç°é—®é¢˜äº†ï¼Œå‘˜å·¥åŸºæœ¬ä¿¡æ¯ä¿å­˜äº†ï¼Œå‘˜å·¥çš„å·¥ä½œç»å†ä¿¡æ¯æœªä¿å­˜ï¼Œä¸šåŠ¡æ“ä½œå‰åæ•°æ®ä¸ä¸€è‡´ã€‚</p><p>è€Œè¦æƒ³ä¿è¯æ“ä½œå‰åï¼Œæ•°æ®çš„ä¸€è‡´æ€§ï¼Œå°±éœ€è¦è®©æ–°å¢å‘˜å·¥ä¸­æ¶‰åŠåˆ°çš„ä¸¤ä¸ªä¸šåŠ¡æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ ã€‚ é‚£æˆ‘ä»¬å¦‚ä½•ï¼Œè®©è¿™ä¸¤ä¸ªæ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å‘¢ ï¼Ÿ</p><p>é‚£å°±å¯ä»¥é€šè¿‡äº‹åŠ¡æ¥å®ç°ï¼Œå› ä¸ºä¸€ä¸ªäº‹åŠ¡ä¸­çš„å¤šä¸ªä¸šåŠ¡æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚</p><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨æ–°å¢å‘˜å·¥åŠŸèƒ½ä¸­æ·»åŠ äº‹åŠ¡ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-383.png" alt="img"></p><p>åœ¨æ–¹æ³•è¿è¡Œä¹‹å‰ï¼Œå¼€å¯äº‹åŠ¡ï¼Œå¦‚æœæ–¹æ³•æˆåŠŸæ‰§è¡Œï¼Œå°±æäº¤äº‹åŠ¡ï¼Œå¦‚æœæ–¹æ³•æ‰§è¡Œçš„è¿‡ç¨‹å½“ä¸­å‡ºç°å¼‚å¸¸äº†ï¼Œå°±å›æ»šäº‹åŠ¡ã€‚</p><p>**æ€è€ƒï¼š**å¼€å‘ä¸­æ‰€æœ‰çš„ä¸šåŠ¡æ“ä½œï¼Œä¸€æ—¦æˆ‘ä»¬è¦è¿›è¡Œæ§åˆ¶äº‹åŠ¡ï¼Œæ˜¯ä¸æ˜¯éƒ½æ˜¯è¿™æ ·çš„å¥—è·¯ï¼Ÿ</p><p>**ç­”æ¡ˆï¼š**æ˜¯çš„ã€‚</p><p>æ‰€ä»¥åœ¨springæ¡†æ¶å½“ä¸­å°±å·²ç»æŠŠäº‹åŠ¡æ§åˆ¶çš„ä»£ç éƒ½å·²ç»å°è£…å¥½äº†ï¼Œå¹¶ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å®ç°ã€‚æˆ‘ä»¬ä½¿ç”¨äº†springæ¡†æ¶ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡ä¸€ä¸ªç®€å•çš„æ³¨è§£@Transactionalå°±æå®šäº†ã€‚</p><h4 id="3-4-2Transactionalæ³¨è§£">3.4.2Transactionalæ³¨è§£</h4><p><strong>æ³¨è§£ï¼š</strong>@Transactional</p><p>**ä½œç”¨ï¼š**å°±æ˜¯åœ¨å½“å‰è¿™ä¸ªæ–¹æ³•æ‰§è¡Œå¼€å§‹ä¹‹å‰æ¥å¼€å¯äº‹åŠ¡ï¼Œæ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹åæäº¤äº‹åŠ¡ã€‚å¦‚æœåœ¨è¿™ä¸ªæ–¹æ³•æ‰§è¡Œçš„è¿‡ç¨‹å½“ä¸­å‡ºç°äº†å¼‚å¸¸ï¼Œå°±ä¼šè¿›è¡Œäº‹åŠ¡çš„å›æ»šæ“ä½œã€‚</p><p>**ä½ç½®ï¼š**ä¸šåŠ¡å±‚çš„æ–¹æ³•ä¸Šã€ç±»ä¸Šã€æ¥å£ä¸Š</p><p>æ¥å£ä¸Šï¼šæ¥å£ä¸‹æ‰€æœ‰çš„å®ç°ç±»å½“ä¸­æ‰€æœ‰çš„æ–¹æ³•éƒ½äº¤ç»™spring è¿›è¡Œäº‹åŠ¡ç®¡ç†</p><p>æ–¹æ³•ä¸Šï¼šå½“å‰æ–¹æ³•äº¤ç»™springè¿›è¡Œäº‹åŠ¡ç®¡ç†</p><p>ç±»ä¸Šï¼šå½“å‰ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•éƒ½äº¤ç”±springè¿›è¡Œäº‹åŠ¡ç®¡ç†</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ä¸šåŠ¡æ–¹æ³•saveä¸ŠåŠ ä¸Š <code>@Transactional</code> æ¥æ§åˆ¶äº‹åŠ¡ ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Emp emp)</span> &#123;</span><br><span class="line">    <span class="comment">//1.è¡¥å…¨åŸºç¡€å±æ€§</span></span><br><span class="line">    emp.setCreateTime(LocalDateTime.now());</span><br><span class="line">    emp.setUpdateTime(LocalDateTime.now());</span><br><span class="line">    <span class="comment">//2.ä¿å­˜å‘˜å·¥åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">    empMapper.insert(emp);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3. ä¿å­˜å‘˜å·¥çš„å·¥ä½œç»å†ä¿¡æ¯ - æ‰¹é‡</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">empId</span> <span class="operator">=</span> emp.getId();</span><br><span class="line">    List&lt;EmpExpr&gt; exprList = emp.getExprList();</span><br><span class="line">    <span class="keyword">if</span>(!CollectionUtils.isEmpty(exprList))&#123;</span><br><span class="line">        exprList.forEach(empExpr -&gt; empExpr.setEmpId(empId));</span><br><span class="line">        empExprMapper.insertBatch(exprList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>@Transactionalæ³¨è§£ï¼šæˆ‘ä»¬ä¸€èˆ¬ä¼šåœ¨ä¸šåŠ¡å±‚å½“ä¸­æ¥æ§åˆ¶äº‹åŠ¡ï¼Œå› ä¸ºåœ¨ä¸šåŠ¡å±‚å½“ä¸­ï¼Œä¸€ä¸ªä¸šåŠ¡åŠŸèƒ½å¯èƒ½ä¼šåŒ…å«å¤šä¸ªæ•°æ®è®¿é—®çš„æ“ä½œã€‚åœ¨ä¸šåŠ¡å±‚æ¥æ§åˆ¶äº‹åŠ¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å¤šä¸ªæ•°æ®è®¿é—®æ“ä½œæ§åˆ¶åœ¨ä¸€ä¸ªäº‹åŠ¡èŒƒå›´å†…ã€‚</p><p>è¯´æ˜ï¼šå¯ä»¥åœ¨<code>application.yml</code>é…ç½®æ–‡ä»¶ä¸­å¼€å¯äº‹åŠ¡ç®¡ç†æ—¥å¿—ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æ§åˆ¶çœ‹åˆ°å’Œäº‹åŠ¡ç›¸å…³çš„æ—¥å¿—ä¿¡æ¯äº†</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#springäº‹åŠ¡ç®¡ç†æ—¥å¿—</span></span><br><span class="line"><span class="attribute">logging</span><span class="punctuation">: </span></span><br><span class="line">  <span class="attribute">level</span><span class="punctuation">: </span></span><br><span class="line">    <span class="attribute">org.springframework.jdbc.support.JdbcTransactionManager</span><span class="punctuation">:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure><h4 id="3-4-3Transactionalçš„ä¸¤ä¸ªé‡è¦å±æ€§åŠç›¸å…³çŸ¥è¯†ç‚¹">3.4.3Transactionalçš„ä¸¤ä¸ªé‡è¦å±æ€§åŠç›¸å…³çŸ¥è¯†ç‚¹</h4><p>ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼šSpringçš„@Transactionalä¼šé€šè¿‡set autocommit=0åœ¨è¿æ¥å¼€å§‹æ—¶å…³é—­è‡ªåŠ¨æäº¤æ¥ç¦ç”¨MySQLçš„é»˜è®¤è‡ªåŠ¨æäº¤(autocommit)æ¨¡å¼ã€‚</p><p>è¿™é‡Œä¸»è¦ä»‹ç»@Transactionalæ³¨è§£å½“ä¸­çš„ä¸¤ä¸ªå¸¸è§çš„å±æ€§ï¼š</p><ul><li>å¼‚å¸¸å›æ»šçš„å±æ€§ï¼š<code>rollbackFor</code></li><li>äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼š<code>propagation</code></li></ul><p>1.<code>rollbackFor</code></p><p>æˆ‘ä»¬åœ¨ä¹‹å‰ç¼–å†™çš„ä¸šåŠ¡æ–¹æ³•ä¸Šæ·»åŠ äº†@Transactionalæ³¨è§£ï¼Œæ¥å®ç°äº‹åŠ¡ç®¡ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Emp emp)</span> &#123;</span><br><span class="line">    <span class="comment">//1.è¡¥å…¨åŸºç¡€å±æ€§</span></span><br><span class="line">    emp.setCreateTime(LocalDateTime.now());</span><br><span class="line">    emp.setUpdateTime(LocalDateTime.now());</span><br><span class="line">    <span class="comment">//2.ä¿å­˜å‘˜å·¥åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">    empMapper.insert(emp);</span><br><span class="line">        </span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">//3. ä¿å­˜å‘˜å·¥çš„å·¥ä½œç»å†ä¿¡æ¯ - æ‰¹é‡</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">empId</span> <span class="operator">=</span> emp.getId();</span><br><span class="line">    List&lt;EmpExpr&gt; exprList = emp.getExprList();</span><br><span class="line">    <span class="keyword">if</span>(!CollectionUtils.isEmpty(exprList))&#123;</span><br><span class="line">        exprList.forEach(empExpr -&gt; empExpr.setEmpId(empId));</span><br><span class="line">        empExprMapper.insertBatch(exprList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä¸šåŠ¡åŠŸèƒ½saveæ–¹æ³•åœ¨è¿è¡Œæ—¶ï¼Œä¼šå¼•å‘é™¤0çš„ç®—æœ¯è¿ç®—å¼‚å¸¸(è¿è¡Œæ—¶å¼‚å¸¸)ï¼Œå‡ºç°å¼‚å¸¸ä¹‹åï¼Œç”±äºæˆ‘ä»¬åœ¨æ–¹æ³•ä¸ŠåŠ äº†<code>@Transactional</code>æ³¨è§£è¿›è¡Œäº‹åŠ¡ç®¡ç†ï¼Œæ‰€ä»¥å‘ç”Ÿå¼‚å¸¸ä¼šæ‰§è¡Œrollbackå›æ»šæ“ä½œï¼Œä»è€Œä¿è¯äº‹åŠ¡æ“ä½œå‰åæ•°æ®æ˜¯ä¸€è‡´çš„ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬åœ¨åšä¸€ä¸ªæµ‹è¯•ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸šåŠ¡åŠŸèƒ½ä»£ç ï¼Œåœ¨æ¨¡æ‹Ÿå¼‚å¸¸çš„ä½ç½®ä¸Šç›´æ¥æŠ›å‡ºExceptionå¼‚å¸¸ï¼ˆç¼–è¯‘æ—¶å¼‚å¸¸ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Emp emp)</span> &#123;</span><br><span class="line">    <span class="comment">//1.è¡¥å…¨åŸºç¡€å±æ€§</span></span><br><span class="line">    emp.setCreateTime(LocalDateTime.now());</span><br><span class="line">    emp.setUpdateTime(LocalDateTime.now());</span><br><span class="line">    <span class="comment">//2.ä¿å­˜å‘˜å·¥åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">    empMapper.insert(emp);</span><br><span class="line">        </span><br><span class="line">    <span class="comment">//æ¨¡æ‹Ÿï¼šå¼‚å¸¸å‘ç”Ÿ</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;å‡ºç°å¼‚å¸¸äº†~~~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">//3. ä¿å­˜å‘˜å·¥çš„å·¥ä½œç»å†ä¿¡æ¯ - æ‰¹é‡</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">empId</span> <span class="operator">=</span> emp.getId();</span><br><span class="line">    List&lt;EmpExpr&gt; exprList = emp.getExprList();</span><br><span class="line">    <span class="keyword">if</span>(!CollectionUtils.isEmpty(exprList))&#123;</span><br><span class="line">        exprList.forEach(empExpr -&gt; empExpr.setEmpId(empId));</span><br><span class="line">        empExprMapper.insertBatch(exprList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼šåœ¨serviceä¸­å‘ä¸ŠæŠ›å‡ºä¸€ä¸ªExceptionç¼–è¯‘æ—¶å¼‚å¸¸ä¹‹åï¼Œç”±äºæ˜¯controllerè°ƒç”¨serviceï¼Œæ‰€ä»¥åœ¨controllerä¸­è¦æœ‰å¼‚å¸¸å¤„ç†ä»£ç ï¼Œæ­¤æ—¶æˆ‘ä»¬é€‰æ‹©åœ¨controllerä¸­ç»§ç»­æŠŠå¼‚å¸¸å‘ä¸ŠæŠ›ã€‚</p></blockquote><p>é‡æ–°å¯åŠ¨æœåŠ¡åï¼Œæ‰“å¼€Apifoxè¿›è¡Œæµ‹è¯•ï¼Œè¯·æ±‚æ·»åŠ å‘˜å·¥çš„æ¥å£ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-389-1024x497.png" alt="img"></p><p>é€šè¿‡Apifoxè¿”å›çš„ç»“æœï¼Œæˆ‘ä»¬çœ‹åˆ°æŠ›å‡ºå¼‚å¸¸äº†ã€‚ç„¶åæˆ‘ä»¬åœ¨å›åˆ°IDEAçš„æ§åˆ¶å°æ¥çœ‹ä¸€ä¸‹ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-388-1024x435.png" alt="img"></p><p>æˆ‘ä»¬çœ‹åˆ°æ•°æ®åº“çš„äº‹åŠ¡å±…ç„¶æäº¤äº†ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œå›æ»šã€‚</p><p>é€šè¿‡ä»¥ä¸Šæµ‹è¯•å¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºï¼š<strong>é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰å‡ºç°RuntimeException(è¿è¡Œæ—¶å¼‚å¸¸)æ‰ä¼šå›æ»šäº‹åŠ¡ã€‚</strong></p><p>å‡å¦‚æˆ‘ä»¬æƒ³è®©æ‰€æœ‰çš„å¼‚å¸¸éƒ½å›æ»šï¼Œéœ€è¦æ¥é…ç½®@Transactionalæ³¨è§£å½“ä¸­çš„rollbackForå±æ€§ï¼Œé€šè¿‡rollbackForè¿™ä¸ªå±æ€§å¯ä»¥æŒ‡å®šå‡ºç°ä½•ç§å¼‚å¸¸ç±»å‹å›æ»šäº‹åŠ¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Emp emp)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">//1.è¡¥å…¨åŸºç¡€å±æ€§</span></span><br><span class="line">    emp.setCreateTime(LocalDateTime.now());</span><br><span class="line">    emp.setUpdateTime(LocalDateTime.now());</span><br><span class="line">    <span class="comment">//2.ä¿å­˜å‘˜å·¥åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">    empMapper.insert(emp);</span><br><span class="line">        </span><br><span class="line">    <span class="comment">//int i = 1/0;</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;å‡ºå¼‚å¸¸å•¦....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">//3. ä¿å­˜å‘˜å·¥çš„å·¥ä½œç»å†ä¿¡æ¯ - æ‰¹é‡</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">empId</span> <span class="operator">=</span> emp.getId();</span><br><span class="line">    List&lt;EmpExpr&gt; exprList = emp.getExprList();</span><br><span class="line">    <span class="keyword">if</span>(!CollectionUtils.isEmpty(exprList))&#123;</span><br><span class="line">        exprList.forEach(empExpr -&gt; empExpr.setEmpId(empId));</span><br><span class="line">        empExprMapper.insertBatch(exprList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬é‡æ–°å¯åŠ¨æœåŠ¡ï¼Œæµ‹è¯•æ–°å¢å‘˜å·¥çš„æ“ä½œï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-386-1024x498.png" alt="img"></p><p>æ§åˆ¶å°æ—¥å¿—ï¼Œå¯ä»¥çœ‹åˆ°å› ä¸ºå‡ºç°äº†å¼‚å¸¸åˆè¿›è¡Œäº†äº‹åŠ¡å›æ»šã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-387-1024x406.png" alt="img"></p><p><strong>ç»“è®ºï¼š</strong></p><ul><li>åœ¨Springçš„äº‹åŠ¡ç®¡ç†ä¸­ï¼Œé»˜è®¤åªæœ‰è¿è¡Œæ—¶å¼‚å¸¸ RuntimeExceptionæ‰ä¼šå›æ»šã€‚</li><li>å¦‚æœè¿˜éœ€è¦å›æ»šæŒ‡å®šç±»å‹çš„å¼‚å¸¸ï¼Œå¯ä»¥é€šè¿‡rollbackForå±æ€§æ¥æŒ‡å®šã€‚</li></ul><p>2.propagation</p><p>propagationï¼Œè¿™ä¸ªå±æ€§æ˜¯ç”¨æ¥é…ç½®äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºçš„ã€‚</p><p>ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºå‘¢ï¼Ÿ</p><ul><li>å°±æ˜¯å½“ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•è¢«å¦ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•è°ƒç”¨æ—¶ï¼Œè¿™ä¸ªäº‹åŠ¡æ–¹æ³•åº”è¯¥å¦‚ä½•è¿›è¡Œäº‹åŠ¡æ§åˆ¶ã€‚</li></ul><p>ä¾‹å¦‚ï¼šä¸¤ä¸ªäº‹åŠ¡æ–¹æ³•ï¼Œä¸€ä¸ªAæ–¹æ³•ï¼Œä¸€ä¸ªBæ–¹æ³•ã€‚åœ¨è¿™ä¸¤ä¸ªæ–¹æ³•ä¸Šéƒ½æ·»åŠ äº†@Transactionalæ³¨è§£ï¼Œå°±ä»£è¡¨è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½å…·æœ‰äº‹åŠ¡ï¼Œè€Œåœ¨Aæ–¹æ³•å½“ä¸­åˆå»è°ƒç”¨äº†Bæ–¹æ³•ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-464-1024x204.png" alt="img"></p><p>æ‰€è°“äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼ŒæŒ‡çš„å°±æ˜¯åœ¨Aæ–¹æ³•è¿è¡Œçš„æ—¶å€™ï¼Œé¦–å…ˆä¼šå¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œåœ¨Aæ–¹æ³•å½“ä¸­åˆè°ƒç”¨äº†Bæ–¹æ³•ï¼Œ Bæ–¹æ³•è‡ªèº«ä¹Ÿå…·æœ‰äº‹åŠ¡ï¼Œé‚£ä¹ˆBæ–¹æ³•åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œåˆ°åº•æ˜¯åŠ å…¥åˆ°Aæ–¹æ³•çš„äº‹åŠ¡å½“ä¸­æ¥ï¼Œè¿˜æ˜¯Bæ–¹æ³•åœ¨è¿è¡Œçš„æ—¶å€™æ–°å»ºä¸€ä¸ªäº‹åŠ¡ï¼Ÿè¿™ä¸ªå°±æ¶‰åŠåˆ°äº†äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºã€‚</p><p>æˆ‘ä»¬è¦æƒ³æ§åˆ¶äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Œåœ¨@Transactionalæ³¨è§£çš„åé¢æŒ‡å®šä¸€ä¸ªå±æ€§propagationï¼Œé€šè¿‡ propagation å±æ€§æ¥æŒ‡å®šä¼ æ’­è¡Œä¸ºã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥ä»‹ç»ä¸€ä¸‹å¸¸è§çš„äº‹åŠ¡ä¼ æ’­è¡Œä¸ºã€‚</p><table><thead><tr><th>å±æ€§å€¼</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>REQUIRED</td><td>ã€é»˜è®¤å€¼ã€‘éœ€è¦äº‹åŠ¡ï¼Œæœ‰åˆ™åŠ å…¥ï¼Œæ— åˆ™åˆ›å»ºæ–°äº‹åŠ¡</td></tr><tr><td>REQUIRES_NEW</td><td>éœ€è¦æ–°äº‹åŠ¡ï¼Œæ— è®ºæœ‰æ— ï¼Œæ€»æ˜¯åˆ›å»ºæ–°äº‹åŠ¡</td></tr><tr><td>SUPPORTS</td><td>æ”¯æŒäº‹åŠ¡ï¼Œæœ‰åˆ™åŠ å…¥ï¼Œæ— åˆ™åœ¨æ— äº‹åŠ¡çŠ¶æ€ä¸­è¿è¡Œ</td></tr><tr><td>NOT_SUPPORTED</td><td>ä¸æ”¯æŒäº‹åŠ¡ï¼Œåœ¨æ— äº‹åŠ¡çŠ¶æ€ä¸‹è¿è¡Œ,å¦‚æœå½“å‰å­˜åœ¨å·²æœ‰äº‹åŠ¡,åˆ™æŒ‚èµ·å½“å‰äº‹åŠ¡</td></tr><tr><td>MANDATORY</td><td>å¿…é¡»æœ‰äº‹åŠ¡ï¼Œå¦åˆ™æŠ›å¼‚å¸¸</td></tr><tr><td>NEVER</td><td>å¿…é¡»æ²¡äº‹åŠ¡ï¼Œå¦åˆ™æŠ›å¼‚å¸¸</td></tr><tr><td>â€¦</td><td></td></tr></tbody></table><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±é€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹æ¥æ¼”ç¤ºä¸‹äº‹åŠ¡ä¼ æ’­è¡Œä¸ºpropagationå±æ€§çš„ä½¿ç”¨ã€‚</p><p>**éœ€æ±‚ï¼š**åœ¨æ–°å¢å‘˜å·¥ä¿¡æ¯æ—¶ï¼Œæ— è®ºæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½è¦è®°å½•æ“ä½œæ—¥å¿—ã€‚</p><p><strong>æ­¥éª¤ï¼š</strong></p><ol><li>å‡†å¤‡æ—¥å¿—è¡¨ emp_logã€å®ä½“ç±»EmpLogã€Mapperæ¥å£EmpLogMapper</li><li>åœ¨æ–°å¢å‘˜å·¥æ—¶è®°å½•æ—¥å¿—</li></ol><p><strong>å‡†å¤‡å·¥ä½œï¼š</strong></p><p>1). åˆ›å»ºæ•°æ®åº“è¡¨ <code>emp_log</code> æ—¥å¿—è¡¨</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»ºå‘˜å·¥æ—¥å¿—è¡¨</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp_log(</span><br><span class="line">    id <span class="type">int</span> unsigned <span class="keyword">primary key</span> auto_increment <span class="keyword">comment</span> <span class="string">&#x27;ID, ä¸»é”®&#x27;</span>,</span><br><span class="line">    operate_time datetime <span class="keyword">comment</span> <span class="string">&#x27;æ“ä½œæ—¶é—´&#x27;</span>,</span><br><span class="line">    <span class="keyword">info</span> <span class="type">varchar</span>(<span class="number">2000</span>) <span class="keyword">comment</span> <span class="string">&#x27;æ—¥å¿—ä¿¡æ¯&#x27;</span></span><br><span class="line">) <span class="keyword">comment</span> <span class="string">&#x27;å‘˜å·¥æ—¥å¿—è¡¨&#x27;</span>;</span><br></pre></td></tr></table></figure><p>2). å¼•å…¥èµ„æ–™ä¸­æä¾›çš„å®ä½“ç±»ï¼šEmpLog</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Data</span></span><br><span class="line"><span class="variable">@NoArgsConstructor</span></span><br><span class="line"><span class="variable">@AllArgsConstructor</span></span><br><span class="line">public class EmpLog &#123;</span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">Integer</span> <span class="selector-tag">id</span>; <span class="comment">//ID</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">LocalDateTime</span> <span class="selector-tag">operateTime</span>; <span class="comment">//æ“ä½œæ—¶é—´</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">String</span> <span class="selector-tag">info</span>; <span class="comment">//è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3). å¼•å…¥èµ„æ–™ä¸­æä¾›çš„Mapperæ¥å£ï¼šEmpLogMapper</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpLogMapper</span> &#123;</span><br><span class="line">        <span class="comment">//æ’å…¥æ—¥å¿—</span></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into emp_log (operate_time, info) values (#&#123;operateTime&#125;, #&#123;info&#125;)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(EmpLog empLog)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4). å¼•å…¥èµ„æ–™ä¸­æä¾›çš„ä¸šåŠ¡æ¥å£ï¼šEmpLogService</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="symbol">EmpLogService</span> &#123;</span><br><span class="line">        <span class="comment">//è®°å½•æ–°å¢å‘˜å·¥æ—¥å¿—</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> insertLog(EmpLog empLog);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5). å¼•å…¥èµ„æ–™ä¸­æä¾›çš„ä¸šåŠ¡å®ç°ç±»ï¼šEmpLogServiceImpl</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Service</span></span><br><span class="line">public class EmpLogServiceImpl implements EmpLogService &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@Autowired</span></span><br><span class="line">    private EmpLogMapper empLogMapper;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@Transactional</span></span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void <span class="built_in">insertLog</span>(EmpLog empLog) &#123;</span><br><span class="line">        <span class="selector-tag">empLogMapper</span><span class="selector-class">.insert</span>(empLog);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä»£ç å®ç°:</strong></p><p>ä¸šåŠ¡å®ç°ç±»ï¼šEmpServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> EmpMapper empMapper;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> EmpExprMapper empExprMapper;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> EmpLogService empLogService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional(rollbackFor = &#123;Exception.class&#125;)</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Emp emp)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//1.è¡¥å…¨åŸºç¡€å±æ€§</span></span><br><span class="line">        emp.setCreateTime(LocalDateTime.now());</span><br><span class="line">        emp.setUpdateTime(LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.ä¿å­˜å‘˜å·¥åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">        empMapper.insert(emp);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. ä¿å­˜å‘˜å·¥çš„å·¥ä½œç»å†ä¿¡æ¯ - æ‰¹é‡</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">empId</span> <span class="operator">=</span> emp.getId();</span><br><span class="line">        List&lt;EmpExpr&gt; exprList = emp.getExprList();</span><br><span class="line">        <span class="keyword">if</span>(!CollectionUtils.isEmpty(exprList))&#123;</span><br><span class="line">            exprList.forEach(empExpr -&gt; empExpr.setEmpId(empId));</span><br><span class="line">            empExprMapper.insertBatch(exprList);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">//è®°å½•æ“ä½œæ—¥å¿—</span></span><br><span class="line">        <span class="type">EmpLog</span> <span class="variable">empLog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmpLog</span>(<span class="literal">null</span>, LocalDateTime.now(), emp.toString());</span><br><span class="line">        empLogService.insertLog(empLog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•:</strong></p><p>é‡æ–°å¯åŠ¨SpringBootæœåŠ¡ï¼Œæµ‹è¯•æ–°å¢å‘˜å·¥æ“ä½œ ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ§åˆ¶å°ä¸­è¾“å‡ºçš„æ—¥å¿—ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-390-1024x424.png" alt="img"></p><p>ä»æ—¥å¿—ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p><ul><li>æ‰§è¡Œäº†æ’å…¥å‘˜å·¥æ•°æ®çš„æ“ä½œ</li><li>æ‰§è¡Œäº†æ’å…¥æ—¥å¿—æ“ä½œ</li><li>ç¨‹åºå‘ç”ŸExceptionå¼‚å¸¸</li><li>æ‰§è¡Œäº‹åŠ¡å›æ»šï¼ˆä¿å­˜å‘˜å·¥æ•°æ®ã€æ’å…¥æ“ä½œæ—¥å¿— å› ä¸ºåœ¨ä¸€ä¸ªäº‹åŠ¡èŒƒå›´å†…ï¼Œä¸¤ä¸ªæ“ä½œéƒ½ä¼šè¢«å›æ»šï¼‰</li></ul><p>ç„¶ååœ¨ <code>emp_log</code> è¡¨ä¸­æ²¡æœ‰è®°å½•æ—¥å¿—æ•°æ® ã€‚</p><p><strong>åŸå› åˆ†æ:</strong></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±éœ€è¦æ¥åˆ†æä¸€ä¸‹å…·ä½“æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´çš„æ—¥å¿—æ²¡æœ‰æˆåŠŸçš„è®°å½•ã€‚</p><ul><li>åœ¨æ‰§è¡Œ <code>save</code> æ–¹æ³•æ—¶å¼€å¯äº†ä¸€ä¸ªäº‹åŠ¡</li><li>å½“æ‰§è¡Œ <code>empLogService.insertLog</code> æ“ä½œæ—¶ï¼Œ<code>insertLog</code>è®¾ç½®çš„äº‹åŠ¡ä¼ æ’­è¡Œæ˜¯é»˜è®¤å€¼REQUIREDï¼Œè¡¨ç¤ºæœ‰äº‹åŠ¡å°±åŠ å…¥ï¼Œæ²¡æœ‰åˆ™æ–°å»ºäº‹åŠ¡</li><li>æ­¤æ—¶ï¼š<code>save</code> å’Œ <code>insertLog</code> æ“ä½œä½¿ç”¨äº†åŒä¸€ä¸ªäº‹åŠ¡ï¼ŒåŒä¸€ä¸ªäº‹åŠ¡ä¸­çš„å¤šä¸ªæ“ä½œï¼Œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ï¼Œæ‰€ä»¥å½“å¼‚å¸¸å‘ç”Ÿæ—¶è¿›è¡Œäº‹åŠ¡å›æ»šï¼Œå°±ä¼šå›æ»š <code>save</code> å’Œ <code>insertLog</code> æ“ä½œ</li></ul><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><p>åœ¨<code>EmpLogServiceImpl</code>ç±»ä¸­insertLogæ–¹æ³•ä¸Šï¼Œæ·»åŠ  <code>@Transactional(propagation = Propagation.REQUIRES_NEW)</code></p><p>Propagation.REQUIRES_NEW ï¼šä¸è®ºæ˜¯å¦æœ‰äº‹åŠ¡ï¼Œéƒ½åˆ›å»ºæ–°äº‹åŠ¡ ï¼Œè¿è¡Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„äº‹åŠ¡ä¸­ã€‚</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Service</span></span><br><span class="line">public class EmpLogServiceImpl implements EmpLogService &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@Autowired</span></span><br><span class="line">    private EmpLogMapper empLogMapper;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@Transactional</span>(propagation = Propagation.REQUIRES_NEW)</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void <span class="built_in">insertLog</span>(EmpLog empLog) &#123;</span><br><span class="line">        <span class="selector-tag">empLogMapper</span><span class="selector-class">.insert</span>(empLog);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å¯SpringBootæœåŠ¡ï¼Œå†æ¬¡æµ‹è¯• æ–°å¢å‘˜å·¥çš„æ“ä½œ ï¼Œä¼šçœ‹åˆ°å…·ä½“çš„æ—¥å¿—å¦‚ä¸‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-391-1024x651.png" alt="img"></p><p>é‚£æ­¤æ—¶ï¼Œ<code>EmpServiceImpl</code> ä¸­çš„ <code>save</code> æ–¹æ³•è¿è¡Œæ—¶ï¼Œä¼šå¼€å¯ä¸€ä¸ªäº‹åŠ¡ã€‚ å½“è°ƒç”¨ <code>empLogService.insertLog(empLog)</code> æ—¶ï¼Œä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œé‚£æ­¤æ—¶ï¼Œå½“ <code>insertLog</code> æ–¹æ³•è¿è¡Œå®Œæ¯•ä¹‹åï¼Œäº‹åŠ¡å°±å·²ç»æäº¤äº†ã€‚ å³ä½¿å¤–éƒ¨çš„äº‹åŠ¡å‡ºç°å¼‚å¸¸ï¼Œå†…éƒ¨å·²ç»æäº¤çš„äº‹åŠ¡ï¼Œä¹Ÿä¸ä¼šå›æ»šäº†ï¼Œå› ä¸ºæ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„äº‹åŠ¡ã€‚</p><p>åˆ°æ­¤äº‹åŠ¡ä¼ æ’­è¡Œä¸ºå·²æ¼”ç¤ºå®Œæˆï¼Œäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºæˆ‘ä»¬åªéœ€è¦æŒæ¡ä¸¤ä¸ªï¼šREQUIREDã€REQUIRES_NEWã€‚</p><ul><li>**REQUIREDï¼š**å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½æ˜¯ç”¨è¯¥ä¼ æ’­è¡Œä¸ºå³å¯ã€‚</li><li>**REQUIRES_NEWï¼š**å½“æˆ‘ä»¬ä¸å¸Œæœ›äº‹åŠ¡ä¹‹é—´ç›¸äº’å½±å“æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¯¥ä¼ æ’­è¡Œä¸ºã€‚æ¯”å¦‚ï¼šä¸‹è®¢å•å‰éœ€è¦è®°å½•æ—¥å¿—ï¼Œä¸è®ºè®¢å•ä¿å­˜æˆåŠŸä¸å¦ï¼Œéƒ½éœ€è¦ä¿è¯æ—¥å¿—è®°å½•èƒ½å¤Ÿè®°å½•æˆåŠŸã€‚</li></ul><h4 id="3-4-4äº‹åŠ¡å››å¤§ç‰¹æ€§">3.4.4äº‹åŠ¡å››å¤§ç‰¹æ€§</h4><p>äº‹åŠ¡æœ‰å“ªäº›ç‰¹æ€§ï¼Ÿ</p><ul><li>åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°å•å…ƒï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚</li><li>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šäº‹åŠ¡å®Œæˆæ—¶ï¼Œå¿…é¡»ä½¿æ‰€æœ‰çš„æ•°æ®éƒ½ä¿æŒä¸€è‡´çŠ¶æ€ã€‚</li><li>éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šæ•°æ®åº“ç³»ç»Ÿæä¾›çš„éš”ç¦»æœºåˆ¶ï¼Œä¿è¯äº‹åŠ¡åœ¨ä¸å—å¤–éƒ¨å¹¶å‘æ“ä½œå½±å“çš„ç‹¬ç«‹ç¯å¢ƒä¸‹è¿è¡Œã€‚</li><li>æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤æˆ–å›æ»šï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…çš„ã€‚</li></ul><p>äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ç®€ç§°ä¸ºï¼šACID</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-392-1024x311.png" alt="img"></p><p><strong>æŒä¹…æ€§ï¼ˆDurabilityï¼‰</strong>ï¼šä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦è¢«æäº¤æˆ–å›æ»šï¼Œå®ƒå¯¹æ•°æ®åº“çš„æ”¹å˜å°†æ˜¯æ°¸ä¹…æ€§çš„ï¼Œå“ªæ€•æ•°æ®åº“å‘ç”Ÿå¼‚å¸¸ï¼Œé‡å¯ä¹‹åæ•°æ®äº¦ç„¶å­˜åœ¨ã€‚</p><p><strong>åŸå­æ€§ï¼ˆAtomicityï¼‰</strong> ï¼šåŸå­æ€§æ˜¯æŒ‡äº‹åŠ¡åŒ…è£…çš„ä¸€ç»„sqlæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•å…ƒï¼Œäº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚</p><p><strong>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</strong>ï¼šä¸€ä¸ªäº‹åŠ¡å®Œæˆä¹‹åæ•°æ®éƒ½å¿…é¡»å¤„äºä¸€è‡´æ€§çŠ¶æ€ã€‚</p><p>å¦‚æœäº‹åŠ¡æˆåŠŸçš„å®Œæˆï¼Œé‚£ä¹ˆæ•°æ®åº“çš„æ‰€æœ‰å˜åŒ–å°†ç”Ÿæ•ˆã€‚</p><p>å¦‚æœäº‹åŠ¡æ‰§è¡Œå‡ºç°é”™è¯¯ï¼Œé‚£ä¹ˆæ•°æ®åº“çš„æ‰€æœ‰å˜åŒ–å°†ä¼šè¢«å›æ»š(æ’¤é”€)ï¼Œè¿”å›åˆ°åŸå§‹çŠ¶æ€ã€‚</p><p><strong>éš”ç¦»æ€§ï¼ˆIsolationï¼‰</strong>ï¼šå¤šä¸ªç”¨æˆ·å¹¶å‘çš„è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªç”¨æˆ·çš„äº‹åŠ¡ä¸èƒ½è¢«å…¶ä»–ç”¨æˆ·çš„äº‹åŠ¡å¹²æ‰°ï¼Œå¤šä¸ªå¹¶å‘çš„äº‹åŠ¡ä¹‹é—´è¦ç›¸äº’éš”ç¦»ã€‚</p><p>ä¸€ä¸ªäº‹åŠ¡çš„æˆåŠŸæˆ–è€…å¤±è´¥å¯¹äºå…¶ä»–çš„äº‹åŠ¡æ˜¯æ²¡æœ‰å½±å“ã€‚</p><h2 id="4-æ–‡ä»¶ä¸Šä¼ ">4.æ–‡ä»¶ä¸Šä¼ </h2><h3 id="4-1ç®€ä»‹">4.1ç®€ä»‹</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-394-1024x502.png" alt="img"></p><p>æ–‡ä»¶ä¸Šä¼ ï¼Œæ˜¯æŒ‡å°†æœ¬åœ°å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ç­‰æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œä¾›å…¶ä»–ç”¨æˆ·æµè§ˆæˆ–ä¸‹è½½çš„è¿‡ç¨‹ã€‚</p><p>æ–‡ä»¶ä¸Šä¼ åœ¨é¡¹ç›®ä¸­åº”ç”¨éå¸¸å¹¿æ³›ï¼Œæˆ‘ä»¬ç»å¸¸å‘å¾®åšã€å‘å¾®ä¿¡æœ‹å‹åœˆéƒ½ç”¨åˆ°äº†æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ã€‚</p><p>ä¸Šä¼ æ–‡ä»¶çš„åŸå§‹formè¡¨å•ï¼Œè¦æ±‚è¡¨å•å¿…é¡»å…·å¤‡ä»¥ä¸‹ä¸‰ç‚¹ï¼ˆä¸Šä¼ æ–‡ä»¶é¡µé¢ä¸‰è¦ç´ ï¼‰ï¼š</p><ul><li>è¡¨å•å¿…é¡»æœ‰fileåŸŸï¼Œç”¨äºé€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶</li><li>è¡¨å•æäº¤æ–¹å¼å¿…é¡»ä¸ºPOSTï¼šé€šå¸¸ä¸Šä¼ çš„æ–‡ä»¶ä¼šæ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ POST æäº¤æ–¹å¼</li><li>è¡¨å•çš„ç¼–ç ç±»å‹enctypeå¿…é¡»è¦è®¾ç½®ä¸ºï¼šmultipart/form-dataï¼šæ™®é€šé»˜è®¤çš„ç¼–ç æ ¼å¼æ˜¯ä¸é€‚åˆä¼ è¾“å¤§å‹çš„äºŒè¿›åˆ¶æ•°æ®çš„ï¼Œæ‰€ä»¥åœ¨æ–‡ä»¶ä¸Šä¼ æ—¶ï¼Œè¡¨å•çš„ç¼–ç æ ¼å¼å¿…é¡»è®¾ç½®ä¸ºmultipart/form-data</li></ul><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.<span class="keyword">File</span>;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line">@Slf4j</span><br><span class="line">@RestController</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> UploadController &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**     * ä¸Šä¼ æ–‡ä»¶ - å‚æ•°åfile     */</span>@PostMapping(<span class="string">&quot;/upload&quot;</span>)</span><br><span class="line">    <span class="keyword">public</span> Result upload(String username, Integer age , MultipartFile <span class="keyword">file</span>) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        log.info(<span class="string">&quot;ä¸Šä¼ æ–‡ä»¶ï¼š&#123;&#125;, &#123;&#125;, &#123;&#125;&quot;</span>, username, age, <span class="keyword">file</span>);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">file</span>.isEmpty())&#123;</span><br><span class="line">            <span class="keyword">file</span>.transferTo(<span class="keyword">new</span> <span class="keyword">File</span>(<span class="string">&quot;D:\\images\\&quot;</span> + <span class="keyword">file</span>.getOriginalFilename()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å®šä¹‰çš„æ–¹æ³•ä¸­æ¥æ”¶æäº¤è¿‡æ¥çš„æ•°æ® ï¼ˆæ–¹æ³•ä¸­çš„å½¢å‚åå’Œè¯·æ±‚å‚æ•°çš„åå­—ä¿æŒä¸€è‡´ï¼‰</p><ul><li>ç”¨æˆ·åï¼š<code>String name</code></li><li>å¹´é¾„ï¼š <code>Integer age</code></li><li>æ–‡ä»¶ï¼š <code>MultipartFile file</code></li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-395-1024x510.png" alt="img"></p><p>Springä¸­æä¾›äº†ä¸€ä¸ªAPIï¼šMultipartFileï¼Œä½¿ç”¨è¿™ä¸ªAPIå°±å¯ä»¥æ¥æ¥æ”¶åˆ°ä¸Šä¼ çš„æ–‡ä»¶</p><p><strong>é—®é¢˜1ï¼šå¦‚æœè¡¨å•é¡¹çš„åå­—å’Œæ–¹æ³•ä¸­å½¢å‚åä¸ä¸€è‡´ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ</strong></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">upload</span><span class="params">(<span class="type">String</span> username, </span></span></span><br><span class="line"><span class="params"><span class="function">                        Integer age,  </span></span></span><br><span class="line"><span class="params"><span class="function">                        MultipartFile image)</span> <span class="comment">//imageå½¢å‚åå’Œè¯·æ±‚å‚æ•°åfileä¸ä¸€è‡´</span></span></span><br></pre></td></tr></table></figure><p><strong>è§£å†³ï¼šä½¿ç”¨@RequestParamæ³¨è§£è¿›è¡Œå‚æ•°ç»‘å®š</strong></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">public</span> <span class="selector-tag">Result</span> <span class="selector-tag">upload</span>(String username,</span><br><span class="line">                     Integer age, </span><br><span class="line">                     <span class="variable">@RequestParam</span>(<span class="string">&quot;file&quot;</span>) MultipartFile image)</span><br></pre></td></tr></table></figure><h3 id="4-2æœ¬åœ°å­˜å‚¨">4.2æœ¬åœ°å­˜å‚¨</h3><p>ä¸Šé¢æˆ‘ä»¬å·²ç»å®Œæˆäº†æ–‡ä»¶ä¸Šä¼ æœ€åŸºæœ¬çš„åŠŸèƒ½å®ç°ï¼Œå·²ç»å¯ä»¥åœ¨æœåŠ¡ç«¯æ¥æ”¶åˆ°ä¸Šä¼ çš„æ–‡ä»¶ï¼Œå¹¶å°†æ–‡ä»¶ä¿å­˜åœ¨æœ¬åœ°æœåŠ¡å™¨çš„ç£ç›˜ç›®å½•ä¸­äº†ã€‚ ä½†æ˜¯æˆ‘ä»¬æµ‹è¯•çš„æ—¶å€™å‘ç°ï¼Œå¦‚æœä¸Šä¼ çš„æ–‡ä»¶åç›¸åŒï¼Œåé¢ä¸Šä¼ çš„ä¼šè¦†ç›–å‰é¢ä¸Šä¼ çš„æ–‡ä»¶ï¼Œé‚£æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±è¦æ¥ä¼˜åŒ–è¿™ä¸€å—çš„åŠŸèƒ½ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Result;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">UPLOAD_DIR</span> <span class="operator">=</span> <span class="string">&quot;D:/images/&quot;</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸Šä¼ æ–‡ä»¶ - å‚æ•°åfile</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">upload</span><span class="params">(String username, Integer age,MultipartFile file)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        log.info(<span class="string">&quot;ä¸Šä¼ æ–‡ä»¶ï¼š&#123;&#125;, &#123;&#125;, &#123;&#125;&quot;</span>, username, age, file);</span><br><span class="line">        <span class="keyword">if</span> (!file.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">// ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">            <span class="type">String</span> <span class="variable">extName</span> <span class="operator">=</span> originalFilename.substring(originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>));<span class="comment">//è·å–åç¼€å</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">uniqueFileName</span> <span class="operator">=</span> UUID.randomUUID().toString().replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>) + extName;</span><br><span class="line">            <span class="comment">// æ‹¼æ¥å®Œæ•´çš„æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">            <span class="type">File</span> <span class="variable">targetFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(UPLOAD_DIR + uniqueFileName);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¦‚æœç›®æ ‡ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºå®ƒ</span></span><br><span class="line">            <span class="keyword">if</span> (!targetFile.getParentFile().exists()) &#123;</span><br><span class="line">                targetFile.getParentFile().mkdirs();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ä¿å­˜æ–‡ä»¶</span></span><br><span class="line">            file.transferTo(targetFile);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>MultipartFile å¸¸è§æ–¹æ³•ï¼š</strong></p><ul><li><code>String getOriginalFilename();</code> //è·å–åŸå§‹æ–‡ä»¶å</li><li><code>void transferTo(File dest);</code> //å°†æ¥æ”¶çš„æ–‡ä»¶è½¬å­˜åˆ°ç£ç›˜æ–‡ä»¶ä¸­</li><li><code>long getSize();</code> //è·å–æ–‡ä»¶çš„å¤§å°ï¼Œå•ä½ï¼šå­—èŠ‚</li><li><code>byte[] getBytes();</code> //è·å–æ–‡ä»¶å†…å®¹çš„å­—èŠ‚æ•°ç»„</li><li><code>InputStream getInputStream();</code> //è·å–æ¥æ”¶åˆ°çš„æ–‡ä»¶å†…å®¹çš„è¾“å…¥æµ</li></ul><p>åˆ©ç”¨ <code>Apifox</code> æµ‹è¯•ï¼Œæ³¨æ„ï¼šè¯·æ±‚å‚æ•°åå’Œcontrolleræ–¹æ³•å½¢å‚åä¿æŒä¸€è‡´ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-396-1024x582.png" alt="img"></p><p>é€šè¿‡ <code>Apifox</code> æµ‹è¯•ï¼Œæˆ‘ä»¬å‘ç°æ–‡ä»¶ä¸Šä¼ æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</p><p>åœ¨è§£å†³äº†æ–‡ä»¶åå”¯ä¸€æ€§çš„é—®é¢˜åï¼Œæˆ‘ä»¬å†æ¬¡ä¸Šä¼ ä¸€ä¸ªè¾ƒå¤§çš„æ–‡ä»¶(è¶…å‡º1M)æ—¶å‘ç°ï¼Œåç«¯ç¨‹åºæŠ¥é”™ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-397-1024x183.png" alt="img"></p><p>æŠ¥é”™åŸå› å‘¢ï¼Œæ˜¯å› ä¸ºï¼šåœ¨SpringBootä¸­ï¼Œæ–‡ä»¶ä¸Šä¼ æ—¶é»˜è®¤å•ä¸ªæ–‡ä»¶æœ€å¤§å¤§å°ä¸º1M</p><p>é‚£ä¹ˆå¦‚æœéœ€è¦ä¸Šä¼ å¤§æ–‡ä»¶ï¼Œå¯ä»¥åœ¨ <code>application.properties</code> è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">spring</span>ï¼š</span><br><span class="line">  servlet:</span><br><span class="line">    multipart:</span><br><span class="line">      <span class="keyword">max</span>-<span class="keyword">file</span>-<span class="keyword">size</span>: <span class="number">10</span>MB</span><br><span class="line">      <span class="keyword">max</span>-request-<span class="keyword">size</span>: <span class="number">100</span>MB</span><br></pre></td></tr></table></figure><p>ä½†å¦‚æœç›´æ¥å­˜å‚¨åœ¨æœåŠ¡å™¨çš„ç£ç›˜ç›®å½•ä¸­ï¼Œå­˜åœ¨ä»¥ä¸‹ç¼ºç‚¹ï¼š</p><ul><li>ä¸å®‰å…¨ï¼šç£ç›˜å¦‚æœæŸåï¼Œæ‰€æœ‰çš„æ–‡ä»¶å°±ä¼šä¸¢å¤±</li><li>å®¹é‡æœ‰é™ï¼šå¦‚æœå­˜å‚¨å¤§é‡çš„å›¾ç‰‡ï¼Œç£ç›˜ç©ºé—´æœ‰é™(ç£ç›˜ä¸å¯èƒ½æ— é™åˆ¶æ‰©å®¹)</li><li>æ— æ³•ç›´æ¥è®¿é—®</li></ul><h3 id="3-3é˜¿é‡Œäº‘OSSï¼ˆå¯¹è±¡å­˜å‚¨ï¼‰">3.3é˜¿é‡Œäº‘OSSï¼ˆå¯¹è±¡å­˜å‚¨ï¼‰</h3><h4 id="3-3-1ä»‹ç»">3.3.1ä»‹ç»</h4><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-346-1024x135.png" alt="img"></p><p>**Bucketï¼š**å­˜å‚¨ç©ºé—´æ˜¯ç”¨æˆ·ç”¨äºå­˜å‚¨å¯¹è±¡ï¼ˆObjectï¼Œå°±æ˜¯æ–‡ä»¶ï¼‰çš„å®¹å™¨ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½å¿…é¡»éš¶å±äºæŸä¸ªå­˜å‚¨ç©ºé—´ã€‚</p><p>å€ŸåŠ©AIå¸®æˆ‘ç”Ÿæˆäº†ä¸€ä¸ªå·¥å…·ç±»å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.ClientException;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.OSS;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.OSSClientBuilder;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.OSSException;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.common.auth.CredentialsProviderFactory;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.common.auth.EnvironmentVariableCredentialsProvider;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.model.OSSObject;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.model.ObjectListing;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.model.OSSObjectSummary;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.model.PutObjectRequest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OssJavaSdkQuickStart</span> &#123;</span><br><span class="line">    <span class="comment">/** ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ Bucket åç§° */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">generateUniqueBucketName</span><span class="params">(String prefix)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–å½“å‰æ—¶é—´æˆ³</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">timestamp</span> <span class="operator">=</span> String.valueOf(System.currentTimeMillis());</span><br><span class="line">        <span class="comment">// ç”Ÿæˆä¸€ä¸ª 0 åˆ° 9999 ä¹‹é—´çš„éšæœºæ•°</span></span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">randomNum</span> <span class="operator">=</span> random.nextInt(<span class="number">10000</span>); <span class="comment">// ç”Ÿæˆä¸€ä¸ª 0 åˆ° 9999 ä¹‹é—´çš„éšæœºæ•°</span></span><br><span class="line">        <span class="comment">// è¿æ¥ä»¥å½¢æˆä¸€ä¸ªå”¯ä¸€çš„ Bucket åç§°</span></span><br><span class="line">        <span class="keyword">return</span> prefix + <span class="string">&quot;-&quot;</span> + timestamp + <span class="string">&quot;-&quot;</span> + randomNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> com.aliyuncs.exceptions.ClientException &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½® OSS Endpoint å’Œ Bucket åç§°</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">endpoint</span> <span class="operator">=</span> <span class="string">&quot;https://oss-cn-beijing.aliyuncs.com&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">bucketName</span> <span class="operator">=</span> <span class="string">&quot;java-geqian&quot;</span>;</span><br><span class="line">        <span class="comment">// æ›¿æ¢ä¸ºæ‚¨çš„ Bucket åŒºåŸŸ</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">region</span> <span class="operator">=</span> <span class="string">&quot;cn-beijing&quot;</span>;</span><br><span class="line">        <span class="comment">// æœ¬åœ°æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">localFilePath</span> <span class="operator">=</span> <span class="string">&quot;D:/ç¼–ç¨‹/001.png&quot;</span>;</span><br><span class="line">        <span class="comment">// æ–‡ä»¶ä¸Šä¼ åçš„è·¯å¾„å’Œåç§°</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">objectName</span> <span class="operator">=</span> <span class="string">&quot;exampledir/001.png&quot;</span>;</span><br><span class="line">        <span class="comment">// åˆ›å»º OSSClient å®ä¾‹</span></span><br><span class="line">        <span class="type">EnvironmentVariableCredentialsProvider</span> <span class="variable">credentialsProvider</span> <span class="operator">=</span></span><br><span class="line">                CredentialsProviderFactory.newEnvironmentVariableCredentialsProvider();</span><br><span class="line">        <span class="type">OSS</span> <span class="variable">ossClient</span> <span class="operator">=</span> OSSClientBuilder.create()</span><br><span class="line">                .endpoint(endpoint)</span><br><span class="line">                .credentialsProvider(credentialsProvider)</span><br><span class="line">                .region(region)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. åˆ›å»ºå­˜å‚¨ç©ºé—´ï¼ˆBucketï¼‰</span></span><br><span class="line">            ossClient.createBucket(bucketName);</span><br><span class="line">            System.out.println(<span class="string">&quot;1. Bucket &quot;</span> + bucketName + <span class="string">&quot; åˆ›å»ºæˆåŠŸã€‚&quot;</span>);</span><br><span class="line">            <span class="comment">// 2. ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line">            <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(localFilePath);</span><br><span class="line">            <span class="keyword">if</span> (file.exists()) &#123;</span><br><span class="line">                <span class="type">PutObjectRequest</span> <span class="variable">putObjectRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PutObjectRequest</span>(bucketName, objectName, file);</span><br><span class="line">                ossClient.putObject(putObjectRequest);</span><br><span class="line">                System.out.println(<span class="string">&quot;2. æ–‡ä»¶ &quot;</span> + objectName + <span class="string">&quot; ä¸Šä¼ æˆåŠŸã€‚&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æ–‡ä»¶ &quot;</span> + localFilePath + <span class="string">&quot; ä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 3. ä¸‹è½½æ–‡ä»¶</span></span><br><span class="line">            <span class="type">OSSObject</span> <span class="variable">ossObject</span> <span class="operator">=</span> ossClient.getObject(bucketName, objectName);</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">contentStream</span> <span class="operator">=</span> ossObject.getObjectContent();</span><br><span class="line">            <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(contentStream));</span><br><span class="line">            String line;</span><br><span class="line">            System.out.println(<span class="string">&quot;3. ä¸‹è½½çš„æ–‡ä»¶å†…å®¹ï¼š&quot;</span>);</span><br><span class="line">            <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.println(line);</span><br><span class="line">            &#125;</span><br><span class="line">            contentStream.close();</span><br><span class="line">            <span class="comment">// 4. åˆ—å‡ºæ–‡ä»¶</span></span><br><span class="line">            System.out.println(<span class="string">&quot;4. åˆ—å‡º Bucket ä¸­çš„æ–‡ä»¶ï¼š&quot;</span>);</span><br><span class="line">            <span class="type">ObjectListing</span> <span class="variable">objectListing</span> <span class="operator">=</span> ossClient.listObjects(bucketName);</span><br><span class="line">            <span class="keyword">for</span> (OSSObjectSummary objectSummary : objectListing.getObjectSummaries()) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot; - &quot;</span> + objectSummary.getKey() + <span class="string">&quot; (å¤§å° = &quot;</span> + objectSummary.getSize() + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 5. åˆ é™¤æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//            ossClient.deleteObject(bucketName, objectName);</span></span><br><span class="line"><span class="comment">//            System.out.println(&quot;5. æ–‡ä»¶ &quot; + objectName + &quot; åˆ é™¤æˆåŠŸã€‚&quot;);</span></span><br><span class="line">            <span class="comment">// 6. åˆ é™¤å­˜å‚¨ç©ºé—´ï¼ˆBucketï¼‰</span></span><br><span class="line"><span class="comment">//            ossClient.deleteBucket(bucketName);</span></span><br><span class="line"><span class="comment">//            System.out.println(&quot;6. Bucket &quot; + bucketName + &quot; åˆ é™¤æˆåŠŸã€‚&quot;);</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (OSSException oe) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Caught an OSSException, which means your request made it to OSS, &quot;</span></span><br><span class="line">                    + <span class="string">&quot;but was rejected with an error response for some reason.&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;Error Message:&quot;</span> + oe.getErrorMessage());</span><br><span class="line">            System.out.println(<span class="string">&quot;Error Code:&quot;</span> + oe.getErrorCode());</span><br><span class="line">            System.out.println(<span class="string">&quot;Request ID:&quot;</span> + oe.getRequestId());</span><br><span class="line">            System.out.println(<span class="string">&quot;Host ID:&quot;</span> + oe.getHostId());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClientException | IOException ce) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Caught an ClientException, which means the client encountered &quot;</span></span><br><span class="line">                    + <span class="string">&quot;a serious internal problem while trying to communicate with OSS, &quot;</span></span><br><span class="line">                    + <span class="string">&quot;such as not being able to access the network.&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;Error Message:&quot;</span> + ce.getMessage());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (ossClient != <span class="literal">null</span>) &#123;</span><br><span class="line">                ossClient.shutdown();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-3-2é›†æˆOSS">3.3.2é›†æˆOSS</h4><p>é˜¿é‡Œäº‘osså¯¹è±¡å­˜å‚¨æœåŠ¡çš„å‡†å¤‡å·¥ä½œä»¥åŠå…¥é—¨ç¨‹åºæˆ‘ä»¬éƒ½å·²ç»å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±éœ€è¦åœ¨æ¡ˆä¾‹å½“ä¸­é›†æˆosså¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œæ¥å­˜å‚¨å’Œç®¡ç†æ¡ˆä¾‹ä¸­ä¸Šä¼ çš„å›¾ç‰‡ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-398-1024x289.png" alt="img"></p><blockquote><p>åœ¨æ–°å¢å‘˜å·¥çš„æ—¶å€™ï¼Œä¸Šä¼ å‘˜å·¥çš„å›¾åƒï¼Œè€Œä¹‹æ‰€ä»¥éœ€è¦ä¸Šä¼ å‘˜å·¥çš„å›¾åƒï¼Œæ˜¯å› ä¸ºå°†æ¥æˆ‘ä»¬éœ€è¦åœ¨ç³»ç»Ÿé¡µé¢å½“ä¸­è®¿é—®å¹¶å±•ç¤ºå‘˜å·¥çš„å›¾åƒã€‚è€Œè¦æƒ³å®Œæˆè¿™ä¸ªæ“ä½œï¼Œéœ€è¦åšä¸¤ä»¶äº‹ï¼š</p><ol><li>éœ€è¦ä¸Šä¼ å‘˜å·¥çš„å›¾åƒï¼Œå¹¶æŠŠå›¾åƒä¿å­˜èµ·æ¥ï¼ˆå­˜å‚¨åˆ°é˜¿é‡Œäº‘OSSï¼‰</li><li>è®¿é—®å‘˜å·¥å›¾åƒï¼ˆé€šè¿‡å›¾åƒåœ¨é˜¿é‡Œäº‘OSSçš„å­˜å‚¨åœ°å€è®¿é—®å›¾åƒï¼‰<ol><li>OSSä¸­çš„æ¯ä¸€ä¸ªæ–‡ä»¶éƒ½ä¼šåˆ†é…ä¸€ä¸ªè®¿é—®çš„urlï¼Œé€šè¿‡è¿™ä¸ªurlå°±å¯ä»¥è®¿é—®åˆ°å­˜å‚¨åœ¨é˜¿é‡Œäº‘ä¸Šçš„å›¾ç‰‡ã€‚æ‰€ä»¥éœ€è¦æŠŠurlè¿”å›ç»™å‰ç«¯ï¼Œè¿™æ ·å‰ç«¯å°±å¯ä»¥é€šè¿‡urlè·å–åˆ°å›¾åƒã€‚</li></ol></li></ol></blockquote><p>æˆ‘ä»¬å‚ç…§æ¥å£æ–‡æ¡£æ¥å¼€å‘æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼š</p><p><strong>åŸºæœ¬ä¿¡æ¯</strong></p><ul><li>è¯·æ±‚è·¯å¾„ï¼š/upload è¯·æ±‚æ–¹å¼ï¼šPOST æ¥å£æè¿°ï¼šä¸Šä¼ å›¾ç‰‡æ¥å£</li></ul><p><strong>è¯·æ±‚å‚æ•°</strong></p><ul><li>å‚æ•°æ ¼å¼ï¼šmultipart/form-data</li><li>å‚æ•°è¯´æ˜ï¼š</li></ul><table><thead><tr><th>å‚æ•°åç§°</th><th>å‚æ•°ç±»å‹</th><th>æ˜¯å¦å¿…é¡»</th><th>ç¤ºä¾‹</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>image</td><td>file</td><td>æ˜¯</td><td></td><td></td></tr></tbody></table><h4 id="3-3-3å…·ä½“å®ç°">3.3.3å…·ä½“å®ç°</h4><p><strong>1). å¼•å…¥é˜¿é‡Œäº‘OSSä¸Šä¼ æ–‡ä»¶å·¥å…·ç±»ï¼ˆç”±å®˜æ–¹çš„ç¤ºä¾‹ä»£ç æ”¹é€ è€Œæ¥ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.*;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.common.auth.CredentialsProviderFactory;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.common.auth.EnvironmentVariableCredentialsProvider;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.common.comm.SignVersion;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliyunOSSOperator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">endpoint</span> <span class="operator">=</span> <span class="string">&quot;https://oss-cn-beijing.aliyuncs.com&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">bucketName</span> <span class="operator">=</span> <span class="string">&quot;java-ai&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">region</span> <span class="operator">=</span> <span class="string">&quot;cn-beijing&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(<span class="type">byte</span>[] content, String originalFilename)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// ä»ç¯å¢ƒå˜é‡ä¸­è·å–è®¿é—®å‡­è¯ã€‚è¿è¡Œæœ¬ä»£ç ç¤ºä¾‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿å·²è®¾ç½®ç¯å¢ƒå˜é‡OSS_ACCESS_KEY_IDå’ŒOSS_ACCESS_KEY_SECRETã€‚</span></span><br><span class="line">        <span class="type">EnvironmentVariableCredentialsProvider</span> <span class="variable">credentialsProvider</span> <span class="operator">=</span> CredentialsProviderFactory.newEnvironmentVariableCredentialsProvider();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¡«å†™Objectå®Œæ•´è·¯å¾„ï¼Œä¾‹å¦‚202406/1.pngã€‚Objectå®Œæ•´è·¯å¾„ä¸­ä¸èƒ½åŒ…å«Bucketåç§°ã€‚</span></span><br><span class="line">        <span class="comment">//è·å–å½“å‰ç³»ç»Ÿæ—¥æœŸçš„å­—ç¬¦ä¸²,æ ¼å¼ä¸º yyyy/MM</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">dir</span> <span class="operator">=</span> LocalDate.now().format(DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy/MM&quot;</span>));</span><br><span class="line">        <span class="comment">//ç”Ÿæˆä¸€ä¸ªæ–°çš„ä¸é‡å¤çš„æ–‡ä»¶å</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">newFileName</span> <span class="operator">=</span> UUID.randomUUID() + originalFilename.substring(originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">objectName</span> <span class="operator">=</span> dir + <span class="string">&quot;/&quot;</span> + newFileName;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºOSSClientå®ä¾‹ã€‚</span></span><br><span class="line">        <span class="type">ClientBuilderConfiguration</span> <span class="variable">clientBuilderConfiguration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClientBuilderConfiguration</span>();</span><br><span class="line">        clientBuilderConfiguration.setSignatureVersion(SignVersion.V4);</span><br><span class="line">        <span class="type">OSS</span> <span class="variable">ossClient</span> <span class="operator">=</span> OSSClientBuilder.create()</span><br><span class="line">                .endpoint(endpoint)</span><br><span class="line">                .credentialsProvider(credentialsProvider)</span><br><span class="line">                .clientConfiguration(clientBuilderConfiguration)</span><br><span class="line">                .region(region)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ossClient.putObject(bucketName, objectName, <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(content));</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            ossClient.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> endpoint.split(<span class="string">&quot;//&quot;</span>)[<span class="number">0</span>] + <span class="string">&quot;//&quot;</span> + bucketName + <span class="string">&quot;.&quot;</span> + endpoint.split(<span class="string">&quot;//&quot;</span>)[<span class="number">1</span>] + <span class="string">&quot;/&quot;</span> + objectName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2). ä¿®æ”¹UploadControllerä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Result;</span><br><span class="line"><span class="keyword">import</span> com.itheima.utils.AliyunOSSOperator;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AliyunOSSOperator aliyunOSSOperator;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">upload</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        log.info(<span class="string">&quot;ä¸Šä¼ æ–‡ä»¶ï¼š&#123;&#125;&quot;</span>, file);</span><br><span class="line">        <span class="keyword">if</span> (!file.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">// ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">            <span class="type">String</span> <span class="variable">extName</span> <span class="operator">=</span> originalFilename.substring(originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">            <span class="type">String</span> <span class="variable">uniqueFileName</span> <span class="operator">=</span> UUID.randomUUID().toString().replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>) + extName;</span><br><span class="line">            <span class="comment">// ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> aliyunOSSOperator.upload(file.getBytes(), uniqueFileName);</span><br><span class="line">            <span class="keyword">return</span> Result.success(url);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="string">&quot;ä¸Šä¼ å¤±è´¥&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ Apifox æµ‹è¯•ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-400-1024x516.png" alt="img"></p><p>æ¥å£æµ‹è¯•é€šè¿‡ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œå‰åç«¯è”è°ƒäº†ã€‚</p><h4 id="3-3-4åŠŸèƒ½ä¼˜åŒ–">3.3.4åŠŸèƒ½ä¼˜åŒ–</h4><p>åœ¨åˆšæ‰æˆ‘ä»¬åˆ¶ä½œçš„AliyunOSSæ“ä½œçš„å·¥å…·ç±»ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥å°† endpointã€bucketNameå‚æ•°ç›´æ¥åœ¨javaæ–‡ä»¶ä¸­å†™æ­»äº†ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-404.png" alt="img"></p><p>å¦‚æœåç»­ï¼Œé¡¹ç›®è¦éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒã€ä¸Šç”Ÿäº§ç¯å¢ƒï¼Œæˆ‘ä»¬éœ€è¦æ¥ä¿®æ”¹è¿™ä¸¤ä¸ªå‚æ•°ã€‚ è€Œå¦‚æœå¼€å‘ä¸€ä¸ªå¤§å‹é¡¹ç›®ï¼Œæ‰€æœ‰ç”¨åˆ°çš„æŠ€æœ¯æ¶‰åŠåˆ°çš„è¿™äº›ä¸ªå‚æ•°å…¨éƒ¨å†™æ­»åœ¨javaä»£ç ä¸­ï¼Œæ˜¯éå¸¸ä¸ä¾¿äºç»´æŠ¤å’Œç®¡ç†çš„ã€‚</p><p>é‚£ä¹ˆå¯¹äºè¿™äº›å®¹æ˜“å˜åŠ¨çš„å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥<strong>å°†å…¶é…ç½®åœ¨é…ç½®æ–‡ä»¶ä¸­</strong>ï¼Œç„¶åé€šè¿‡ <code>@Value</code> æ³¨è§£æ¥æ³¨è§£å¤–éƒ¨é…ç½®çš„å±æ€§ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>æ–¹å¼ä¸€ï¼š@Valueæ³¨å…¥ï¼ˆç¼ºç‚¹ï¼šå¦‚æœé…ç½®é¡¹å¤šï¼Œæ³¨å…¥ç¹çï¼Œä¸ä¾¿äºç»´æŠ¤ç®¡ç†å’Œå¤ç”¨ã€‚ï¼‰</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-403-1024x478.png" alt="img"></p><p>æ–¹å¼äºŒï¼šè‡ªåŠ¨æ³¨å…¥  åœ¨Springä¸­ç»™æˆ‘ä»¬æä¾›äº†ä¸€ç§ç®€åŒ–æ–¹å¼ï¼Œå¯ä»¥ç›´æ¥å°†é…ç½®æ–‡ä»¶ä¸­é…ç½®é¡¹çš„å€¼è‡ªåŠ¨çš„æ³¨å…¥åˆ°å¯¹è±¡çš„å±æ€§ä¸­ã€‚</p><p>Springæä¾›çš„ç®€åŒ–æ–¹å¼å¥—è·¯ï¼š</p><p>1). éœ€è¦åˆ›å»ºä¸€ä¸ªå®ç°ç±»ï¼Œä¸”å®ä½“ç±»ä¸­çš„å±æ€§åå’Œé…ç½®æ–‡ä»¶å½“ä¸­keyçš„åå­—å¿…é¡»è¦ä¸€è‡´</p><p>æ¯”å¦‚ï¼šé…ç½®æ–‡ä»¶å½“ä¸­å«endpointï¼Œå®ä½“ç±»å½“ä¸­çš„å±æ€§ä¹Ÿå¾—å«endpointï¼Œå¦å¤–å®ä½“ç±»å½“ä¸­çš„å±æ€§è¿˜éœ€è¦æä¾› getter / setteræ–¹æ³•</p><p>2). éœ€è¦å°†å®ä½“ç±»äº¤ç»™Springçš„IOCå®¹å™¨ç®¡ç†ï¼Œæˆä¸ºIOCå®¹å™¨å½“ä¸­çš„beanå¯¹è±¡</p><p>3). åœ¨å®ä½“ç±»ä¸Šæ·»åŠ <code>**@ConfigurationProperties**</code>æ³¨è§£ï¼Œå¹¶é€šè¿‡perfectå±æ€§æ¥æŒ‡å®šé…ç½®å‚æ•°é¡¹çš„å‰ç¼€</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-402-1024x218.png" alt="img"></p><p><strong>å…·ä½“å®ç°æ­¥éª¤:</strong></p><p>1). å®šä¹‰å®ä½“ç±»AliyunOSSProperties ï¼Œå¹¶äº¤ç»™IOCå®¹å™¨ç®¡ç†</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">&quot;aliyun.oss&quot;</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="title class_"><span class="keyword">class</span> <span class="title">AliyunOSSProperties</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> endpoint;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> bucketName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> region;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2). ä¿®æ”¹AliyunOSSOperator</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.*;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.common.auth.CredentialsProviderFactory;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.common.auth.EnvironmentVariableCredentialsProvider;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.common.comm.SignVersion;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliyunOSSOperator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ–¹å¼ä¸€: é€šè¿‡@Valueæ³¨è§£ä¸€ä¸ªå±æ€§ä¸€ä¸ªå±æ€§çš„æ³¨å…¥</span></span><br><span class="line">    <span class="comment">//@Value(&quot;$&#123;aliyun.oss.endpoint&#125;&quot;)</span></span><br><span class="line">    <span class="comment">//private String endpoint;</span></span><br><span class="line">    <span class="comment">//@Value(&quot;$&#123;aliyun.oss.bucketName&#125;&quot;)</span></span><br><span class="line">    <span class="comment">//private String bucketName;</span></span><br><span class="line">    <span class="comment">//@Value(&quot;$&#123;aliyun.oss.region&#125;&quot;)</span></span><br><span class="line">    <span class="comment">//private String region;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span>    <span class="keyword">private</span> AliyunOSSProperties aliyunOSSProperties;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(<span class="type">byte</span>[] content, String originalFilename)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">endpoint</span> <span class="operator">=</span> aliyunOSSProperties.getEndpoint();       </span><br><span class="line">        <span class="type">String</span> <span class="variable">bucketName</span> <span class="operator">=</span> aliyunOSSProperties.getBucketName();     </span><br><span class="line">        <span class="type">String</span> <span class="variable">region</span> <span class="operator">=</span> aliyunOSSProperties.getRegion();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»ç¯å¢ƒå˜é‡ä¸­è·å–è®¿é—®å‡­è¯ã€‚è¿è¡Œæœ¬ä»£ç ç¤ºä¾‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿å·²è®¾ç½®ç¯å¢ƒå˜é‡OSS_ACCESS_KEY_IDå’ŒOSS_ACCESS_KEY_SECRETã€‚</span></span><br><span class="line">        <span class="type">EnvironmentVariableCredentialsProvider</span> <span class="variable">credentialsProvider</span> <span class="operator">=</span> CredentialsProviderFactory.newEnvironmentVariableCredentialsProvider();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¡«å†™Objectå®Œæ•´è·¯å¾„ï¼Œä¾‹å¦‚2024/06/1.pngã€‚Objectå®Œæ•´è·¯å¾„ä¸­ä¸èƒ½åŒ…å«Bucketåç§°ã€‚</span></span><br><span class="line">        <span class="comment">//è·å–å½“å‰ç³»ç»Ÿæ—¥æœŸçš„å­—ç¬¦ä¸²,æ ¼å¼ä¸º yyyy/MM</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">dir</span> <span class="operator">=</span> LocalDate.now().format(DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy/MM&quot;</span>));</span><br><span class="line">        <span class="comment">//ç”Ÿæˆä¸€ä¸ªæ–°çš„ä¸é‡å¤çš„æ–‡ä»¶å</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">newFileName</span> <span class="operator">=</span> UUID.randomUUID() + originalFilename.substring(originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">objectName</span> <span class="operator">=</span> dir + <span class="string">&quot;/&quot;</span> + newFileName;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºOSSClientå®ä¾‹ã€‚</span></span><br><span class="line">        <span class="type">ClientBuilderConfiguration</span> <span class="variable">clientBuilderConfiguration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClientBuilderConfiguration</span>();</span><br><span class="line">        clientBuilderConfiguration.setSignatureVersion(SignVersion.V4);</span><br><span class="line">        <span class="type">OSS</span> <span class="variable">ossClient</span> <span class="operator">=</span> OSSClientBuilder.create()</span><br><span class="line">                .endpoint(endpoint)</span><br><span class="line">                .credentialsProvider(credentialsProvider)</span><br><span class="line">                .clientConfiguration(clientBuilderConfiguration)</span><br><span class="line">                .region(region)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ossClient.putObject(bucketName, objectName, <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(content));</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            ossClient.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> endpoint.split(<span class="string">&quot;//&quot;</span>)[<span class="number">0</span>] + <span class="string">&quot;//&quot;</span> + bucketName + <span class="string">&quot;.&quot;</span> + endpoint.split(<span class="string">&quot;//&quot;</span>)[<span class="number">1</span>] + <span class="string">&quot;/&quot;</span> + objectName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-3-5-ConfigurationPropertiesè¯¦è§£">3.3.5@ConfigurationPropertiesè¯¦è§£</h4><p><code>@ConfigurationProperties</code>æ˜¯ Spring Boot æ¡†æ¶ä¸­ç”¨äºå°†é…ç½®æ–‡ä»¶ï¼ˆå¦‚<code>application.yml</code>æˆ–<code>application.properties</code>ï¼‰ä¸­çš„å±æ€§æ‰¹é‡ç»‘å®šåˆ°Javaå¯¹è±¡çš„æ³¨è§£ã€‚</p><p>1.è§£è€¦é…ç½®ä¸ä»£ç </p><ul><li>æ•æ„Ÿä¿¡æ¯éš”ç¦»ï¼šå°†æ•°æ®åº“å¯†ç ã€API å¯†é’¥ç­‰ä»ä»£ç ä¸­å‰¥ç¦»ï¼Œå­˜å‚¨äºé…ç½®æ–‡ä»¶ã€‚</li><li>ç¯å¢ƒå·®å¼‚åŒ–ï¼šé€šè¿‡ application-dev.ymlã€application-prod.yml å®ç°å¤šç¯å¢ƒé…ç½®åˆ‡æ¢ã€‚</li></ul><p>2.æå‡å¯ç»´æŠ¤æ€§</p><ul><li>é›†ä¸­ç®¡ç†ï¼šæ‰€æœ‰ç›¸å…³é…ç½®å±æ€§èšåˆåœ¨ä¸€ä¸ªç±»ä¸­ï¼Œä¾¿äºæŸ¥æ‰¾å’Œä¿®æ”¹ã€‚</li><li>IDE æ”¯æŒï¼šå­—æ®µè‡ªåŠ¨è¡¥å…¨ã€ç±»å‹æ£€æŸ¥å’Œé…ç½®æç¤ºï¼ˆå¦‚ IntelliJ IDEA çš„ â€œSpring Bootâ€ æ’ä»¶ï¼‰ã€‚</li></ul><p>3.éªŒè¯ä¸çº¦æŸ<br>ç»“åˆ @Validated å’Œ JSR-303 æ³¨è§£ï¼ˆå¦‚ @NotBlankã€@Minï¼‰ï¼Œå®ç°é…ç½®åˆæ³•æ€§æ ¡éªŒã€‚</p><p>ä¸å…¶ä»–æ³¨è§£çš„å¯¹æ¯”</p><table><thead><tr><th>æ³¨è§£</th><th>ç‰¹ç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>@Value</code></td><td>ç›´æ¥æ³¨å…¥å•ä¸ªå±æ€§å€¼ï¼Œé€‚åˆç®€å•åœºæ™¯</td><td>å°‘é‡åˆ†æ•£é…ç½®</td></tr><tr><td><code>@ConfigurationProperties</code></td><td>æ‰¹é‡ç»‘å®šå±æ€§åˆ°å¯¹è±¡ï¼Œæ”¯æŒå¤æ‚ç»“æ„å’Œç±»å‹å®‰å…¨</td><td>ç»“æ„åŒ–ã€æ¨¡å—åŒ–é…ç½®</td></tr><tr><td><code>@PropertySource</code></td><td>æŒ‡å®šè‡ªå®šä¹‰é…ç½®æ–‡ä»¶è·¯å¾„</td><td>éé»˜è®¤é…ç½®æ–‡ä»¶åŠ è½½</td></tr></tbody></table><h2 id="5-åˆ é™¤å‘˜å·¥">5.åˆ é™¤å‘˜å·¥</h2><h3 id="5-1éœ€æ±‚">5.1éœ€æ±‚</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-348-1024x291.png" alt="img"></p><p>å½“æˆ‘ä»¬å‹¾é€‰åˆ—è¡¨å‰é¢çš„å¤é€‰æ¡†ï¼Œç„¶åç‚¹å‡» â€œæ‰¹é‡åˆ é™¤â€ æŒ‰é’®ï¼Œå°±å¯ä»¥å°†è¿™ä¸€æ‰¹æ¬¡çš„å‘˜å·¥ä¿¡æ¯åˆ é™¤æ‰äº†ã€‚ä¹Ÿå¯ä»¥åªå‹¾é€‰ä¸€ä¸ªå¤é€‰æ¡†ï¼Œä»…åˆ é™¤ä¸€ä¸ªå‘˜å·¥ä¿¡æ¯ã€‚</p><p>é—®é¢˜ï¼šæˆ‘ä»¬éœ€è¦å¼€å‘ä¸¤ä¸ªåŠŸèƒ½æ¥å£å—ï¼Ÿä¸€ä¸ªåˆ é™¤å•ä¸ªå‘˜å·¥ï¼Œä¸€ä¸ªåˆ é™¤å¤šä¸ªå‘˜å·¥</p><p>ç­”æ¡ˆï¼šä¸éœ€è¦ã€‚ åªéœ€è¦å¼€å‘ä¸€ä¸ªåŠŸèƒ½æ¥å£å³å¯ï¼ˆåˆ é™¤å¤šä¸ªå‘˜å·¥åŒ…å«åªåˆ é™¤ä¸€ä¸ªå‘˜å·¥ï¼‰</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-349-1024x544.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-350-1024x526.png" alt="img"></p><h3 id="5-2å®ç°æ€è·¯">5.2å®ç°æ€è·¯</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-351-1024x258.png" alt="img"></p><h3 id="5-3åŠŸèƒ½å¼€å‘">5.3åŠŸèƒ½å¼€å‘</h3><h4 id="5-3-1Controlleræ¥æ”¶å‚æ•°">5.3.1Controlleræ¥æ”¶å‚æ•°</h4><p>åœ¨ <code>EmpController</code> ä¸­å¢åŠ å¦‚ä¸‹æ–¹æ³• <code>delete</code> ï¼Œæ¥æ‰§è¡Œæ‰¹é‡åˆ é™¤å‘˜å·¥çš„æ“ä½œã€‚</p><p><strong>æ–¹å¼ä¸€ï¼šåœ¨Controlleræ–¹æ³•ä¸­é€šè¿‡æ•°ç»„æ¥æ¥æ”¶</strong></p><p>å¤šä¸ªå‚æ•°ï¼Œé»˜è®¤å¯ä»¥å°†å…¶å°è£…åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œéœ€è¦ä¿è¯å‰ç«¯ä¼ é€’çš„å‚æ•°å ä¸ æ–¹æ³•å½¢å‚åç§°ä¿æŒä¸€è‡´ã€‚</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ‰¹é‡åˆ é™¤å‘˜å·¥</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">@DeleteMapping</span><br><span class="line"><span class="built_in">public</span> Result <span class="keyword">delete</span>(<span class="type">Integer</span>[] ids)&#123;</span><br><span class="line">    <span class="keyword">log</span>.<span class="keyword">info</span>(&quot;æ‰¹é‡åˆ é™¤éƒ¨é—¨: ids=&#123;&#125; &quot;, Arrays.asList(ids));</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ–¹å¼äºŒï¼šåœ¨Controlleræ–¹æ³•ä¸­é€šè¿‡é›†åˆæ¥æ¥æ”¶</strong></p><p>ä¹Ÿå¯ä»¥å°†å…¶å°è£…åˆ°ä¸€ä¸ªList<Integer> é›†åˆä¸­ï¼Œå¦‚æœè¦å°†å…¶å°è£…åˆ°ä¸€ä¸ªé›†åˆä¸­ï¼Œéœ€è¦åœ¨é›†åˆå‰é¢åŠ ä¸Š <code>@RequestParam</code> æ³¨è§£ã€‚</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ‰¹é‡åˆ é™¤å‘˜å·¥</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="variable">@DeleteMapping</span></span><br><span class="line">public Result <span class="built_in">delete</span>(<span class="variable">@RequestParam</span> List&lt;Integer&gt; ids)&#123;</span><br><span class="line">    <span class="selector-tag">log</span><span class="selector-class">.info</span>(<span class="string">&quot;æ‰¹é‡åˆ é™¤éƒ¨é—¨: ids=&#123;&#125; &quot;</span>, ids);</span><br><span class="line">    <span class="selector-tag">empService</span><span class="selector-class">.deleteByIds</span>(ids);</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">Result</span><span class="selector-class">.success</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸¤ç§æ–¹å¼ï¼Œé€‰æ‹©å…¶ä¸­ä¸€ç§å°±å¯ä»¥ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ¨èé€‰æ‹©é›†åˆï¼Œå› ä¸ºåŸºäºé›†åˆæ“ä½œå…¶ä¸­çš„å…ƒç´ ä¼šæ›´åŠ æ–¹ä¾¿ã€‚</p><h4 id="5-3-2Service">5.3.2Service</h4><p>1). åœ¨æ¥å£ä¸­ <code>EmpService</code> ä¸­å®šä¹‰æ¥å£æ–¹æ³• <code>deleteByIds</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ‰¹é‡åˆ é™¤å‘˜å·¥</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">deleteByIds</span><span class="params">(List&lt;Integer&gt; ids)</span></span>;</span><br></pre></td></tr></table></figure><p>2). åœ¨å®ç°ç±» <code>EmpServiceImpl</code> ä¸­å®ç°æ¥å£æ–¹æ³• <code>deleteByIds</code></p><p>åœ¨åˆ é™¤å‘˜å·¥ä¿¡æ¯æ—¶ï¼Œæ—¢éœ€è¦åˆ é™¤ emp è¡¨ä¸­çš„å‘˜å·¥åŸºæœ¬ä¿¡æ¯ï¼Œè¿˜éœ€è¦åˆ é™¤ emp_expr è¡¨ä¸­å‘˜å·¥çš„å·¥ä½œç»å†ä¿¡æ¯</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Transactional</span></span><br><span class="line"><span class="variable">@Override</span></span><br><span class="line">public void <span class="built_in">deleteByIds</span>(List&lt;Integer&gt; ids) &#123;</span><br><span class="line">    <span class="comment">//1. æ ¹æ®IDæ‰¹é‡åˆ é™¤å‘˜å·¥åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">    <span class="selector-tag">empMapper</span><span class="selector-class">.deleteByIds</span>(ids);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. æ ¹æ®å‘˜å·¥çš„IDæ‰¹é‡åˆ é™¤å‘˜å·¥çš„å·¥ä½œç»å†ä¿¡æ¯</span></span><br><span class="line">    <span class="selector-tag">empExprMapper</span><span class="selector-class">.deleteByEmpIds</span>(ids);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºåˆ é™¤å‘˜å·¥ä¿¡æ¯ï¼Œæ—¢è¦åˆ é™¤å‘˜å·¥åŸºæœ¬ä¿¡æ¯ï¼Œåˆè¦åˆ é™¤å·¥ä½œç»å†ä¿¡æ¯ï¼Œæ“ä½œå¤šæ¬¡æ•°æ®åº“çš„åˆ é™¤ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œäº‹åŠ¡æ§åˆ¶ã€‚</p><h4 id="5-3-3Mapper">5.3.3Mapper</h4><p>1). åœ¨ <code>EmpMapper</code> æ¥å£ä¸­å¢åŠ  <code>deleteByIds</code> æ–¹æ³•å®ç°æ‰¹é‡åˆ é™¤å‘˜å·¥åŸºæœ¬ä¿¡æ¯</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ‰¹é‡åˆ é™¤å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">deleteByIds</span><span class="params">(List&lt;Integer&gt; ids)</span></span>;</span><br></pre></td></tr></table></figure><p>2). åœ¨ <code>EmpMapper.xml</code> é…ç½®æ–‡ä»¶ä¸­, é…ç½®å¯¹åº”çš„SQLè¯­å¥</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="comment">&lt;!--æ‰¹é‡åˆ é™¤å‘˜å·¥ä¿¡æ¯--&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByIds&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    delete from emp where id in</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            #</span><span class="template-variable">&#123;id&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>3). åœ¨ <code>EmpExprMapper</code> æ¥å£ä¸­å¢åŠ  <code>deleteByEmpIds</code> æ–¹æ³•å®ç°æ ¹æ®å‘˜å·¥IDæ‰¹é‡åˆ é™¤å‘˜å·¥çš„å·¥ä½œç»å†ä¿¡æ¯</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ ¹æ®å‘˜å·¥çš„IDæ‰¹é‡åˆ é™¤å·¥ä½œç»å†ä¿¡æ¯</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">deleteByEmpIds</span><span class="params">(List&lt;Integer&gt; empIds)</span></span>;</span><br></pre></td></tr></table></figure><p>4). åœ¨ <code>EmpExprMapper.xml</code> é…ç½®æ–‡ä»¶ä¸­, é…ç½®å¯¹åº”çš„SQLè¯­å¥</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="comment">&lt;!--æ ¹æ®å‘˜å·¥çš„IDæ‰¹é‡åˆ é™¤å·¥ä½œç»å†ä¿¡æ¯--&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByEmpIds&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    delete from emp_expr where emp_id in</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;empIds&quot;</span> <span class="attr">item</span>=<span class="string">&quot;empId&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            #</span><span class="template-variable">&#123;empId&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="6-ä¿®æ”¹å‘˜å·¥">6.ä¿®æ”¹å‘˜å·¥</h2><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-352-1024x587.png" alt="img"></p><p>åœ¨è¿›è¡Œä¿®æ”¹å‘˜å·¥ä¿¡æ¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬é¦–å…ˆå…ˆè¦æ ¹æ®å‘˜å·¥çš„IDæŸ¥è¯¢å‘˜å·¥çš„è¯¦ç»†ä¿¡æ¯ç”¨äºé¡µé¢å›æ˜¾å±•ç¤ºï¼Œç„¶åç”¨æˆ·ä¿®æ”¹å‘˜å·¥æ•°æ®ä¹‹åï¼Œç‚¹å‡»ä¿å­˜æŒ‰é’®ï¼Œå°±å¯ä»¥å°†ä¿®æ”¹çš„æ•°æ®æäº¤åˆ°æœåŠ¡ç«¯ï¼Œä¿å­˜åˆ°æ•°æ®åº“ã€‚ å…·ä½“æ“ä½œä¸ºï¼š</p><ol><li>æ ¹æ®IDæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯</li><li>ä¿å­˜ä¿®æ”¹çš„å‘˜å·¥ä¿¡æ¯</li></ol><h3 id="6-1æŸ¥è¯¢å›æ˜¾">6.1æŸ¥è¯¢å›æ˜¾</h3><h4 id="6-1-1éœ€æ±‚">6.1.1éœ€æ±‚</h4><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-353-1024x542.png" alt="img"></p><p><strong>2.4.3 å“åº”æ•°æ®</strong></p><p>å‚æ•°æ ¼å¼ï¼šapplication/json</p><p>å‚æ•°è¯´æ˜ï¼š</p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>æ˜¯å¦å¿…é¡»</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>code</td><td>number</td><td>å¿…é¡»</td><td>å“åº”ç , 1 æˆåŠŸ , 0 å¤±è´¥</td></tr><tr><td>msg</td><td>string</td><td>éå¿…é¡»</td><td>æç¤ºä¿¡æ¯</td></tr><tr><td>data</td><td>object</td><td>å¿…é¡»</td><td>è¿”å›çš„æ•°æ®</td></tr><tr><td>|- id</td><td>number</td><td>éå¿…é¡»</td><td>id</td></tr><tr><td>|- username</td><td>string</td><td>éå¿…é¡»</td><td>ç”¨æˆ·å</td></tr><tr><td>|- name</td><td>string</td><td>éå¿…é¡»</td><td>å§“å</td></tr><tr><td>|- password</td><td>string</td><td>éå¿…é¡»</td><td>å¯†ç </td></tr><tr><td>|- entryDate</td><td>string</td><td>éå¿…é¡»</td><td>å…¥èŒæ—¥æœŸ</td></tr><tr><td>|- gender</td><td>number</td><td>éå¿…é¡»</td><td>æ€§åˆ« , 1 ç”· ; 2 å¥³</td></tr><tr><td>|- image</td><td>string</td><td>éå¿…é¡»</td><td>å›¾åƒ</td></tr><tr><td>|- job</td><td>number</td><td>éå¿…é¡»</td><td>èŒä½, è¯´æ˜: 1 ç­ä¸»ä»»,2 è®²å¸ˆ, 3 å­¦å·¥ä¸»ç®¡, 4 æ•™ç ”ä¸»ç®¡, 5 å’¨è¯¢å¸ˆ</td></tr><tr><td>|- salary</td><td>number</td><td>éå¿…é¡»</td><td>è–ªèµ„</td></tr><tr><td>|- deptId</td><td>number</td><td>éå¿…é¡»</td><td>éƒ¨é—¨id</td></tr><tr><td>|- createTime</td><td>string</td><td>éå¿…é¡»</td><td>åˆ›å»ºæ—¶é—´</td></tr><tr><td>|- updateTime</td><td>string</td><td>éå¿…é¡»</td><td>æ›´æ–°æ—¶é—´</td></tr><tr><td>|- exprList</td><td>object[]</td><td>éå¿…é¡»</td><td>å·¥ä½œç»å†åˆ—è¡¨</td></tr><tr><td>|- id</td><td>number</td><td>éå¿…é¡»</td><td>ID</td></tr><tr><td>|- company</td><td>string</td><td>éå¿…é¡»</td><td>æ‰€åœ¨å…¬å¸</td></tr><tr><td>|- job</td><td>string</td><td>éå¿…é¡»</td><td>èŒä½</td></tr><tr><td>|- begin</td><td>string</td><td>éå¿…é¡»</td><td>å¼€å§‹æ—¶é—´</td></tr><tr><td>|- end</td><td>string</td><td>éå¿…é¡»</td><td>ç»“æŸæ—¶é—´</td></tr><tr><td>|- empId</td><td>number</td><td>éå¿…é¡»</td><td>å‘˜å·¥ID</td></tr></tbody></table><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-356-1024x890.png" alt="img"></p><h4 id="6-1-2å®ç°æ€è·¯">6.1.2å®ç°æ€è·¯</h4><p>åœ¨æŸ¥è¯¢å›æ˜¾æ—¶ï¼Œæ—¢éœ€è¦æŸ¥è¯¢å‡ºå‘˜å·¥çš„åŸºæœ¬ä¿¡æ¯ï¼Œåˆéœ€è¦æŸ¥è¯¢å‡ºè¯¥å‘˜å·¥çš„å·¥ä½œç»å†ä¿¡æ¯ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-405.png" alt="img"></p><p>æˆ‘ä»¬å¯ä»¥å…ˆé€šè¿‡ä¸€æ¡SQLè¯­å¥ï¼ŒæŸ¥è¯¢å‡ºæŒ‡å®šå‘˜å·¥çš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŠå…¶å‘˜å·¥çš„å·¥ä½œç»å†ä¿¡æ¯ã€‚SQLå¦‚ä¸‹ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">e</span>.*,</span><br><span class="line">       ee.id ee_id,</span><br><span class="line">       ee.<span class="keyword">begin</span> ee_begin,</span><br><span class="line">       ee.<span class="keyword">end</span> ee_end,</span><br><span class="line">       ee.company ee_company,</span><br><span class="line">       ee.job ee_job</span><br><span class="line"><span class="keyword">from</span> emp <span class="built_in">e</span> <span class="keyword">left</span> <span class="keyword">join</span> emp_expr ee <span class="keyword">on</span> <span class="built_in">e</span>.id = ee.emp_id <span class="keyword">where</span> <span class="built_in">e</span>.id = <span class="number">39</span>;</span><br></pre></td></tr></table></figure><p>å…·ä½“çš„å®ç°æ€è·¯å¦‚ä¸‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-406-1024x254.png" alt="img"></p><h4 id="6-1-3ä»£ç å®ç°">6.1.3ä»£ç å®ç°</h4><p>1). <code>EmpController</code> æ·»åŠ  <code>getInfo</code> ç”¨æ¥æ ¹æ®IDæŸ¥è¯¢å‘˜å·¥æ•°æ®ï¼Œç”¨äºé¡µé¢å›æ˜¾</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢å›æ˜¾</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">getInfo</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;æ ¹æ®idæŸ¥è¯¢å‘˜å·¥çš„è¯¦ç»†ä¿¡æ¯&quot;</span>);</span><br><span class="line">    <span class="type">Emp</span> <span class="variable">emp</span>  <span class="operator">=</span> empService.getInfo(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success(emp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2). <code>EmpService</code> æ¥å£ä¸­å¢åŠ  <code>getInfo</code> æ–¹æ³•</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®IDæŸ¥è¯¢å‘˜å·¥çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Emp <span class="built_in">getInfo</span>(Integer id);</span><br></pre></td></tr></table></figure><p>3). <code>EmpServiceImpl</code> å®ç°ç±»ä¸­å®ç° <code>getInfo</code> æ–¹æ³•</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="function">Emp <span class="title">getInfo</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">return</span> empMapper.<span class="title">getById</span><span class="params">(id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4). <code>EmpMapper</code> æ¥å£ä¸­å¢åŠ  <code>getById</code> æ–¹æ³•</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®IDæŸ¥è¯¢å‘˜å·¥è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Emp <span class="built_in">getById</span>(Integer id);</span><br></pre></td></tr></table></figure><p>5). <code>EmpMapper.xml</code> é…ç½®æ–‡ä»¶ä¸­å®šä¹‰å¯¹åº”çš„SQL</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="comment">&lt;!--è‡ªå®šä¹‰ç»“æœé›†ResultMap--&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;empResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.itheima.pojo.Emp&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;job&quot;</span> <span class="attr">property</span>=<span class="string">&quot;job&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;salary&quot;</span> <span class="attr">property</span>=<span class="string">&quot;salary&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;image&quot;</span> <span class="attr">property</span>=<span class="string">&quot;image&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;entry_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;entryDate&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;dept_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;deptId&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createTime&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;update_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;updateTime&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!--å°è£…exprList--&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;exprList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.itheima.pojo.EmpExpr&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;ee_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;ee_company&quot;</span> <span class="attr">property</span>=<span class="string">&quot;company&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;ee_job&quot;</span> <span class="attr">property</span>=<span class="string">&quot;job&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;ee_begin&quot;</span> <span class="attr">property</span>=<span class="string">&quot;begin&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;ee_end&quot;</span> <span class="attr">property</span>=<span class="string">&quot;end&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;ee_empid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;empId&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="comment">&lt;!--æ ¹æ®IDæŸ¥è¯¢å‘˜å·¥çš„è¯¦ç»†ä¿¡æ¯--&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empResultMap&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    select e.*,</span></span><br><span class="line"><span class="language-xml">        ee.id ee_id,</span></span><br><span class="line"><span class="language-xml">        ee.emp_id ee_empid,</span></span><br><span class="line"><span class="language-xml">        ee.begin ee_begin,</span></span><br><span class="line"><span class="language-xml">        ee.end ee_end,</span></span><br><span class="line"><span class="language-xml">        ee.company ee_company,</span></span><br><span class="line"><span class="language-xml">        ee.job ee_job</span></span><br><span class="line"><span class="language-xml">    from emp e left join emp_expr ee on e.id = ee.emp_id</span></span><br><span class="line"><span class="language-xml">    where e.id = #</span><span class="template-variable">&#123;id&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>åœ¨è¿™ç§ä¸€å¯¹å¤šçš„æŸ¥è¯¢ä¸­ï¼Œæˆ‘ä»¬è¦æƒ³æˆåŠŸçš„å°è£…çš„ç»“æœï¼Œéœ€è¦æ‰‹åŠ¨çš„åŸºäº <code>&lt;resultMap&gt;</code> æ¥è¿›è¡Œå°è£…ç»“æœã€‚</p><p>Mybatisä¸­å°è£…æŸ¥è¯¢ç»“æœï¼Œä»€ä¹ˆæ—¶å€™ç”¨ resultTypeï¼Œä»€ä¹ˆæ—¶å€™ç”¨resultMap ï¼Ÿ</p><ul><li>å¦‚æœæŸ¥è¯¢è¿”å›çš„å­—æ®µåä¸å®ä½“çš„å±æ€§åå¯ä»¥ç›´æ¥å¯¹åº”ä¸Šï¼Œç”¨resultType ã€‚</li><li>å¦‚æœæŸ¥è¯¢è¿”å›çš„å­—æ®µåä¸å®ä½“çš„å±æ€§åå¯¹åº”ä¸ä¸Šï¼Œæˆ–å®ä½“å±æ€§æ¯”è¾ƒå¤æ‚ï¼Œå¯ä»¥é€šè¿‡resultMapæ‰‹åŠ¨å°è£…</li></ul><h3 id="6-2ä¿®æ”¹å‘˜å·¥">6.2ä¿®æ”¹å‘˜å·¥</h3><h4 id="6-2-1éœ€æ±‚">6.2.1éœ€æ±‚</h4><p>æŸ¥è¯¢å›æ˜¾ä¹‹åï¼Œå°±å¯ä»¥åœ¨é¡µé¢ä¸Šä¿®æ”¹å‘˜å·¥çš„ä¿¡æ¯äº†ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-407-1024x501.png" alt="img"></p><ul><li>å½“ç”¨æˆ·ä¿®æ”¹å®Œæ•°æ®ä¹‹åï¼Œç‚¹å‡»ä¿å­˜æŒ‰é’®ï¼Œå°±éœ€è¦å°†æ•°æ®æäº¤åˆ°æœåŠ¡ç«¯ï¼Œç„¶åæœåŠ¡ç«¯éœ€è¦å°†ä¿®æ”¹åçš„æ•°æ®æ›´æ–°åˆ°æ•°æ®åº“ä¸­ ã€‚</li><li>è€Œæ­¤æ¬¡æ›´æ–°çš„æ—¶å€™ï¼Œæ—¢éœ€è¦æ›´æ–°å‘˜å·¥çš„åŸºæœ¬ä¿¡æ¯ï¼› åˆéœ€è¦æ›´æ–°å‘˜å·¥çš„å·¥ä½œç»å†ä¿¡æ¯ ã€‚</li></ul><p>åŸºæœ¬ä¿¡æ¯</p><blockquote><p>è¯·æ±‚è·¯å¾„ï¼š/emps</p><p>è¯·æ±‚æ–¹å¼ï¼šPUT</p><p>æ¥å£æè¿°ï¼šè¯¥æ¥å£ç”¨äºä¿®æ”¹å‘˜å·¥çš„æ•°æ®ä¿¡æ¯</p></blockquote><p>è¯·æ±‚å‚æ•°</p><p>å‚æ•°æ ¼å¼ï¼šapplication/json</p><p>å‚æ•°è¯´æ˜ï¼š</p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>æ˜¯å¦å¿…é¡»</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>id</td><td>number</td><td>å¿…é¡»</td><td>id</td></tr><tr><td>username</td><td>string</td><td>å¿…é¡»</td><td>ç”¨æˆ·å</td></tr><tr><td>name</td><td>string</td><td>å¿…é¡»</td><td>å§“å</td></tr><tr><td>gender</td><td>number</td><td>å¿…é¡»</td><td>æ€§åˆ«, è¯´æ˜: 1 ç”·, 2 å¥³</td></tr><tr><td>image</td><td>string</td><td>éå¿…é¡»</td><td>å›¾åƒ</td></tr><tr><td>deptId</td><td>number</td><td>éå¿…é¡»</td><td>éƒ¨é—¨id</td></tr><tr><td>entryDate</td><td>string</td><td>éå¿…é¡»</td><td>å…¥èŒæ—¥æœŸ</td></tr><tr><td>job</td><td>number</td><td>éå¿…é¡»</td><td>èŒä½, è¯´æ˜: 1 ç­ä¸»ä»»,2 è®²å¸ˆ, 3 å­¦å·¥ä¸»ç®¡, 4 æ•™ç ”ä¸»ç®¡, 5 å’¨è¯¢å¸ˆ</td></tr><tr><td>salary</td><td>number</td><td>éå¿…é¡»</td><td>è–ªèµ„</td></tr><tr><td>exprList</td><td>object[]</td><td>éå¿…é¡»</td><td>å·¥ä½œç»å†åˆ—è¡¨</td></tr><tr><td>|- id</td><td>number</td><td>éå¿…é¡»</td><td>ID</td></tr><tr><td>|- company</td><td>string</td><td>éå¿…é¡»</td><td>æ‰€åœ¨å…¬å¸</td></tr><tr><td>|- job</td><td>string</td><td>éå¿…é¡»</td><td>èŒä½</td></tr><tr><td>|- begin</td><td>string</td><td>éå¿…é¡»</td><td>å¼€å§‹æ—¶é—´</td></tr><tr><td>|- end</td><td>string</td><td>éå¿…é¡»</td><td>ç»“æŸæ—¶é—´</td></tr><tr><td>|- empId</td><td>number</td><td>éå¿…é¡»</td><td>å‘˜å·¥ID</td></tr></tbody></table><p>è¯·æ±‚æ•°æ®æ ·ä¾‹ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line"><span class="string">&quot;username&quot;</span>: <span class="string">&quot;zhangwuji&quot;</span>,</span><br><span class="line"><span class="string">&quot;password&quot;</span>: <span class="string">&quot;123456&quot;</span>,</span><br><span class="line"><span class="string">&quot;name&quot;</span>: <span class="string">&quot;å¼ æ— å¿Œ&quot;</span>,</span><br><span class="line"><span class="string">&quot;gender&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="string">&quot;image&quot;</span>: <span class="string">&quot;https://web-framework.oss-cn-hangzhou.aliyuncs.com/2022-09-02-00-27-53B.jpg&quot;</span>,</span><br><span class="line"><span class="string">&quot;job&quot;</span>: <span class="number">2</span>,</span><br><span class="line"><span class="string">&quot;salary&quot;</span>: <span class="number">8000</span>,</span><br><span class="line"><span class="string">&quot;entryDate&quot;</span>: <span class="string">&quot;2015-01-01&quot;</span>,</span><br><span class="line"><span class="string">&quot;deptId&quot;</span>: <span class="number">2</span>,</span><br><span class="line"><span class="string">&quot;createTime&quot;</span>: <span class="string">&quot;2022-09-01T23:06:30&quot;</span>,</span><br><span class="line"><span class="string">&quot;updateTime&quot;</span>: <span class="string">&quot;2022-09-02T00:29:04&quot;</span>,</span><br><span class="line"><span class="string">&quot;exprList&quot;</span>: [</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="string">&quot;begin&quot;</span>: <span class="string">&quot;2012-07-01&quot;</span>,</span><br><span class="line"><span class="string">&quot;end&quot;</span>: <span class="string">&quot;2015-06-20&quot;</span></span><br><span class="line"><span class="string">&quot;company&quot;</span>: <span class="string">&quot;ä¸­è½¯å›½é™…è‚¡ä»½æœ‰é™å…¬å¸&quot;</span></span><br><span class="line"><span class="string">&quot;job&quot;</span>: <span class="string">&quot;javaå¼€å‘&quot;</span>,</span><br><span class="line"><span class="string">&quot;empId&quot;</span>: <span class="number">2</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line"><span class="string">&quot;begin&quot;</span>: <span class="string">&quot;2015-07-01&quot;</span>,</span><br><span class="line"><span class="string">&quot;end&quot;</span>: <span class="string">&quot;2019-03-03&quot;</span></span><br><span class="line"><span class="string">&quot;company&quot;</span>: <span class="string">&quot;ç™¾åº¦ç§‘æŠ€è‚¡ä»½æœ‰é™å…¬å¸&quot;</span></span><br><span class="line"><span class="string">&quot;job&quot;</span>: <span class="string">&quot;javaå¼€å‘&quot;</span>,</span><br><span class="line"><span class="string">&quot;empId&quot;</span>: <span class="number">2</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;id&quot;</span>: <span class="number">3</span>,</span><br><span class="line"><span class="string">&quot;begin&quot;</span>: <span class="string">&quot;2019-3-15&quot;</span>,</span><br><span class="line"><span class="string">&quot;end&quot;</span>: <span class="string">&quot;2023-03-01&quot;</span></span><br><span class="line"><span class="string">&quot;company&quot;</span>: <span class="string">&quot;é˜¿é‡Œå·´å·´ç§‘æŠ€è‚¡ä»½æœ‰é™å…¬å¸&quot;</span></span><br><span class="line"><span class="string">&quot;job&quot;</span>: <span class="string">&quot;æ¶æ„å¸ˆ&quot;</span>,</span><br><span class="line"><span class="string">&quot;empId&quot;</span>: <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="6-2-2å®ç°æ€è·¯">6.2.2å®ç°æ€è·¯</h4><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-357-1024x269.png" alt="img"></p><h4 id="6-2-3ä»£ç å®ç°">6.2.3ä»£ç å®ç°</h4><p>1). <code>EmpController</code> å¢åŠ  <code>update</code> æ–¹æ³•æ¥æ”¶è¯·æ±‚å‚æ•°ï¼Œå“åº”æ•°æ®</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ›´æ–°å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="variable">@PutMapping</span></span><br><span class="line">public Result <span class="built_in">update</span>(<span class="variable">@RequestBody</span> Emp emp)&#123;</span><br><span class="line">    <span class="selector-tag">log</span><span class="selector-class">.info</span>(<span class="string">&quot;ä¿®æ”¹å‘˜å·¥ä¿¡æ¯, &#123;&#125;&quot;</span>, emp);</span><br><span class="line">    <span class="selector-tag">empService</span><span class="selector-class">.update</span>(emp);</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">Result</span><span class="selector-class">.success</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2). <code>EmpService</code> æ¥å£å¢åŠ  <code>update</code> æ–¹æ³•</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ›´æ–°å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="comment">* @param emp</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(Emp emp)</span></span>;</span><br></pre></td></tr></table></figure><p>3). <code>EmpServiceImpl</code>å®ç°ç±»å®ç° <code>update</code> æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Emp emp)</span> &#123;</span><br><span class="line">    <span class="comment">//1. æ ¹æ®IDæ›´æ–°å‘˜å·¥åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">    emp.setUpdateTime(LocalDateTime.now());</span><br><span class="line">    empMapper.updateById(emp);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. æ ¹æ®å‘˜å·¥IDåˆ é™¤å‘˜å·¥çš„å·¥ä½œç»å†ä¿¡æ¯ ã€åˆ é™¤è€çš„ã€‘</span></span><br><span class="line">    empExprMapper.deleteByEmpIds(Arrays.asList(emp.getId()));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3. æ–°å¢å‘˜å·¥çš„å·¥ä½œç»å†æ•°æ® ã€æ–°å¢æ–°çš„ã€‘</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">empId</span> <span class="operator">=</span> emp.getId();</span><br><span class="line">    List&lt;EmpExpr&gt; exprList = emp.getExprList();</span><br><span class="line">    <span class="keyword">if</span>(!CollectionUtils.isEmpty(exprList))&#123;</span><br><span class="line">        exprList.forEach(empExpr -&gt; empExpr.setEmpId(empId));</span><br><span class="line">        empExprMapper.insertBatch(exprList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4). <code>EmpMapper</code> æ¥å£ä¸­å¢åŠ  <code>updateById</code> æ–¹æ³•</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ›´æ–°å‘˜å·¥åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">updateById</span><span class="params">(Emp emp)</span></span>;</span><br></pre></td></tr></table></figure><p>5). <code>EmpMapper.xml</code> é…ç½®æ–‡ä»¶ä¸­å®šä¹‰å¯¹åº”çš„SQLè¯­å¥ï¼ŒåŸºäºåŠ¨æ€SQLæ›´æ–°å‘˜å·¥ä¿¡æ¯</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="comment">&lt;!--æ ¹æ®IDæ›´æ–°å‘˜å·¥ä¿¡æ¯--&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateById&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    update emp</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null and username != &#x27;&#x27;&quot;</span>&gt;</span>username = #</span><span class="template-variable">&#123;username&#125;</span><span class="language-xml">,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;password != null and password != &#x27;&#x27;&quot;</span>&gt;</span>password = #</span><span class="template-variable">&#123;password&#125;</span><span class="language-xml">,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span>name = #</span><span class="template-variable">&#123;name&#125;</span><span class="language-xml">,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender != null&quot;</span>&gt;</span>gender = #</span><span class="template-variable">&#123;gender&#125;</span><span class="language-xml">,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;phone != null and phone != &#x27;&#x27;&quot;</span>&gt;</span>phone = #</span><span class="template-variable">&#123;phone&#125;</span><span class="language-xml">,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;job != null&quot;</span>&gt;</span>job = #</span><span class="template-variable">&#123;job&#125;</span><span class="language-xml">,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;salary != null&quot;</span>&gt;</span>salary = #</span><span class="template-variable">&#123;salary&#125;</span><span class="language-xml">,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;image != null and image != &#x27;&#x27;&quot;</span>&gt;</span>image = #</span><span class="template-variable">&#123;image&#125;</span><span class="language-xml">,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;entryDate != null&quot;</span>&gt;</span>entry_date = #</span><span class="template-variable">&#123;entryDate&#125;</span><span class="language-xml">,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;deptId != null&quot;</span>&gt;</span>dept_id = #</span><span class="template-variable">&#123;deptId&#125;</span><span class="language-xml">,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateTime != null&quot;</span>&gt;</span>update_time = #</span><span class="template-variable">&#123;updateTime&#125;</span><span class="language-xml">,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    where id = #</span><span class="template-variable">&#123;id&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="7-å¼‚å¸¸å¤„ç†">7.å¼‚å¸¸å¤„ç†</h2><h3 id="7-1ä»‹ç»">7.1ä»‹ç»</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-358.png" alt="img"></p><p>å½“æˆ‘ä»¬æ²¡æœ‰åšä»»ä½•çš„å¼‚å¸¸å¤„ç†æ—¶ï¼Œæˆ‘ä»¬ä¸‰å±‚æ¶æ„å¤„ç†å¼‚å¸¸çš„æ–¹æ¡ˆï¼š</p><ul><li>Mapperæ¥å£åœ¨æ“ä½œæ•°æ®åº“çš„æ—¶å€™å‡ºé”™äº†ï¼Œæ­¤æ—¶å¼‚å¸¸ä¼šå¾€ä¸ŠæŠ›(è°è°ƒç”¨Mapperå°±æŠ›ç»™è°)ï¼Œä¼šæŠ›ç»™serviceã€‚</li><li>service ä¸­ä¹Ÿå­˜åœ¨å¼‚å¸¸äº†ï¼Œä¼šæŠ›ç»™controllerã€‚</li><li>è€Œåœ¨controllerå½“ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡æœ‰åšä»»ä½•çš„å¼‚å¸¸å¤„ç†ï¼Œæ‰€ä»¥æœ€ç»ˆå¼‚å¸¸ä¼šå†å¾€ä¸ŠæŠ›ã€‚æœ€ç»ˆæŠ›ç»™æ¡†æ¶ä¹‹åï¼Œæ¡†æ¶å°±ä¼šè¿”å›ä¸€ä¸ªJSONæ ¼å¼çš„æ•°æ®ï¼Œé‡Œé¢å°è£…çš„å°±æ˜¯é”™è¯¯çš„ä¿¡æ¯ï¼Œä½†æ˜¯æ¡†æ¶è¿”å›çš„JSONæ ¼å¼çš„æ•°æ®å¹¶ä¸ç¬¦åˆæˆ‘ä»¬çš„å¼€å‘è§„èŒƒã€‚</li></ul><h3 id="7-2è§£å†³æ–¹æ¡ˆ">7.2è§£å†³æ–¹æ¡ˆ</h3><p>é‚£ä¹ˆåœ¨ä¸‰å±‚æ„æ¶é¡¹ç›®ä¸­ï¼Œå‡ºç°äº†å¼‚å¸¸ï¼Œè¯¥å¦‚ä½•å¤„ç†?</p><ul><li><strong>æ–¹æ¡ˆä¸€ï¼šåœ¨æ‰€æœ‰Controllerçš„æ‰€æœ‰æ–¹æ³•ä¸­è¿›è¡Œtryâ€¦catchå¤„ç†</strong></li></ul><p>ç¼ºç‚¹ï¼šä»£ç è‡ƒè‚¿ï¼ˆä¸æ¨èï¼‰</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-369.png" alt="img"></p><ul><li>**æ–¹æ¡ˆäºŒï¼š**<strong>å…¨å±€å¼‚å¸¸å¤„ç†å™¨</strong></li></ul><p>å¥½å¤„ï¼šç®€å•ã€ä¼˜é›…ï¼ˆæ¨èï¼‰</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-370.png" alt="img"></p><ol><li>å…¨å±€å¼‚å¸¸å¤„ç†å™¨</li></ol><p>æˆ‘ä»¬è¯¥æ€ä¹ˆæ ·å®šä¹‰å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼Ÿ</p><ul><li>å®šä¹‰å…¨å±€å¼‚å¸¸å¤„ç†å™¨éå¸¸ç®€å•ï¼Œå°±æ˜¯å®šä¹‰ä¸€ä¸ªç±»ï¼Œåœ¨ç±»ä¸ŠåŠ ä¸Šä¸€ä¸ªæ³¨è§£@RestControllerAdviceï¼ŒåŠ ä¸Šè¿™ä¸ªæ³¨è§£å°±ä»£è¡¨æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå…¨å±€å¼‚å¸¸å¤„ç†å™¨ã€‚</li><li>åœ¨å…¨å±€å¼‚å¸¸å¤„ç†å™¨å½“ä¸­ï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªæ–¹æ³•æ¥æ•è·å¼‚å¸¸ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸Šéœ€è¦åŠ ä¸Šæ³¨è§£@ExceptionHandlerã€‚é€šè¿‡@ExceptionHandleræ³¨è§£å½“ä¸­çš„valueå±æ€§æ¥æŒ‡å®šæˆ‘ä»¬è¦æ•è·çš„æ˜¯å“ªä¸€ç±»å‹çš„å¼‚å¸¸ã€‚</li></ul><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//å¤„ç†å¼‚å¸¸</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function">Result <span class="title">ex</span><span class="params">(Exception e)</span></span>&#123;<span class="comment">//æ–¹æ³•å½¢å‚ä¸­æŒ‡å®šèƒ½å¤Ÿå¤„ç†çš„å¼‚å¸¸ç±»å‹</span></span><br><span class="line">        e.printStackTrace();<span class="comment">//æ‰“å°å †æ ˆä¸­çš„å¼‚å¸¸ä¿¡æ¯</span></span><br><span class="line">        <span class="comment">//æ•è·åˆ°å¼‚å¸¸ä¹‹åï¼Œå“åº”ä¸€ä¸ªæ ‡å‡†çš„Result</span></span><br><span class="line">        <span class="function"><span class="keyword">return</span> Result.<span class="title">error</span><span class="params">(<span class="string">&quot;å¯¹ä¸èµ·,æ“ä½œå¤±è´¥,è¯·è”ç³»ç®¡ç†å‘˜&quot;</span>)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>@RestControllerAdvice = @ControllerAdvice + @ResponseBody</p><p>å¤„ç†å¼‚å¸¸çš„æ–¹æ³•è¿”å›å€¼ä¼šè½¬æ¢ä¸ºjsonåå†å“åº”ç»™å‰ç«¯</p><p>é‡æ–°å¯åŠ¨SpringBootæœåŠ¡ï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œå†æ¥æµ‹è¯•ä¸€ä¸‹ ä¿®æ”¹å‘˜å·¥ è¿™ä¸ªæ“ä½œï¼Œæˆ‘ä»¬ä¾ç„¶è®¾ç½®å·²å­˜åœ¨çš„ <code>13309090027</code>è¿™ä¸ªæ‰‹æœºå·ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-373-1024x502.png" alt="img"></p><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå‡ºç°å¼‚å¸¸ä¹‹åï¼Œå¼‚å¸¸å·²ç»è¢«å…¨å±€å¼‚å¸¸å¤„ç†å™¨æ•è·äº†ã€‚ç„¶åè¿”å›çš„é”™è¯¯ä¿¡æ¯ï¼Œè¢«å‰ç«¯ç¨‹åºæ­£å¸¸è§£æï¼Œç„¶åæç¤ºå‡ºäº†å¯¹åº”çš„é”™è¯¯æç¤ºä¿¡æ¯ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯å…¨å±€å¼‚å¸¸å¤„ç†å™¨çš„ä½¿ç”¨ï¼Œä¸»è¦æ¶‰åŠåˆ°ä¸¤ä¸ªæ³¨è§£ï¼š</p><ul><li>@RestControllerAdvice //è¡¨ç¤ºå½“å‰ç±»ä¸ºå…¨å±€å¼‚å¸¸å¤„ç†å™¨</li><li>@ExceptionHandler //æŒ‡å®šå¯ä»¥æ•è·å“ªç§ç±»å‹çš„å¼‚å¸¸è¿›è¡Œå¤„ç†</li></ul><h2 id="8-å‘˜å·¥ä¿¡æ¯ç»Ÿè®¡">8.å‘˜å·¥ä¿¡æ¯ç»Ÿè®¡</h2><h3 id="8-1ä»‹ç»">8.1ä»‹ç»</h3><p>å¯¹äºè¿™äº›å›¾å½¢æŠ¥è¡¨çš„å¼€å‘ï¼Œå…¶å®å‘¢ï¼Œéƒ½æ˜¯åŸºäºç°æˆçš„ä¸€äº›å›¾å½¢æŠ¥è¡¨çš„ç»„ä»¶å¼€å‘çš„ï¼Œæ¯”å¦‚ï¼šEchartsã€HighChartsç­‰ã€‚</p><p>è€ŒæŠ¥è¡¨çš„åˆ¶ä½œï¼Œä¸»è¦æ˜¯å‰ç«¯äººå‘˜å¼€å‘ï¼Œå¼•å…¥å¯¹åº”çš„ç»„ä»¶ï¼ˆæ¯”å¦‚ï¼šEChartsï¼‰å³å¯ã€‚ æœåŠ¡ç«¯å¼€å‘äººå‘˜ä»…ä¸ºå…¶æä¾›æ•°æ®å³å¯ã€‚</p><p>å®˜ç½‘ï¼š<a href="https://echarts.apache.org/zh/index.html">https://echarts.apache.org/zh/index.html</a></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-371-1024x502.png" alt="img"></p><h3 id="8-2èŒä½ç»Ÿè®¡">8.2èŒä½ç»Ÿè®¡</h3><h4 id="8-2-1éœ€æ±‚">8.2.1éœ€æ±‚</h4><p>å¯¹äºè¿™ç±»çš„å›¾å½¢æŠ¥è¡¨ï¼ŒæœåŠ¡ç«¯è¦åšçš„ï¼Œå°±æ˜¯ä¸ºå…¶æä¾›æ•°æ®å³å¯ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡å®˜æ–¹çš„ç¤ºä¾‹ï¼Œçœ‹åˆ°æä¾›çš„æ•°æ®å…¶å®å°±æ˜¯Xè½´å±•ç¤ºçš„ä¿¡æ¯ï¼Œå’Œå¯¹åº”çš„æ•°æ®ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-372-1024x464.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-359-1024x733.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-360-1024x292.png" alt="img"></p><h4 id="8-2-2ä»£ç å®ç°">8.2.2ä»£ç å®ç°</h4><p><strong>1). å®šä¹‰****å°è£…ç»“æœå¯¹è±¡JobOption</strong></p><p>åœ¨ <code>com.itheima.pojo</code> åŒ…ä¸­å®šä¹‰å®ä½“ç±» <code>JobOption</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JobOption</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List jobList;</span><br><span class="line">    <span class="keyword">private</span> List dataList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>1). å®šä¹‰ReportControllerï¼Œå¹¶æ·»åŠ æ–¹æ³•ã€‚</strong></p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RequestMapping(<span class="string">&quot;/report&quot;</span>)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReportController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ReportService reportService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»Ÿè®¡å„ä¸ªèŒä½çš„å‘˜å·¥äººæ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(<span class="string">&quot;/empJobData&quot;</span>)</span></span><br><span class="line">    <span class="keyword">public</span> Result getEmpJobData()&#123;</span><br><span class="line">        log.info(<span class="string">&quot;ç»Ÿè®¡å„ä¸ªèŒä½çš„å‘˜å·¥äººæ•°&quot;</span>);</span><br><span class="line">        JobOption jobOption = reportService.getEmpJobData();</span><br><span class="line">        <span class="keyword">return</span> Result.success(jobOption);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2). å®šä¹‰ReportServiceæ¥å£ï¼Œå¹¶æ·»åŠ æ¥å£æ–¹æ³•ã€‚</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ReportService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»Ÿè®¡å„ä¸ªèŒä½çš„å‘˜å·¥äººæ•°</span></span><br><span class="line"><span class="comment">     * @return</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">JobOption <span class="title">getEmpJobData</span>()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3). å®šä¹‰ReportServiceImplå®ç°ç±»ï¼Œå¹¶å®ç°æ–¹æ³•</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReportServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ReportService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">EmpMapper</span> empMapper;</span><br><span class="line">        </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">JobOption</span> <span class="title function_">getEmpJobData</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">Map</span>&lt;<span class="title class_">String</span>,<span class="title class_">Object</span>&gt;&gt; list = empMapper.<span class="title function_">countEmpJobData</span>();</span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">Object</span>&gt; jobList = list.<span class="title function_">stream</span>().<span class="title function_">map</span>(dataMap -&gt; dataMap.<span class="title function_">get</span>(<span class="string">&quot;pos&quot;</span>)).<span class="title function_">toList</span>();</span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">Object</span>&gt; dataList = list.<span class="title function_">stream</span>().<span class="title function_">map</span>(dataMap -&gt; dataMap.<span class="title function_">get</span>(<span class="string">&quot;total&quot;</span>)).<span class="title function_">toList</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JobOption</span>(jobList, dataList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>4). å®šä¹‰EmpMapper æ¥å£</strong></p><p>ç»Ÿè®¡çš„æ˜¯å‘˜å·¥çš„ä¿¡æ¯ï¼Œæ‰€ä»¥éœ€è¦æ“ä½œçš„æ˜¯å‘˜å·¥è¡¨ã€‚ æ‰€ä»¥ä»£ç æˆ‘ä»¬å°±å†™åœ¨ <code>EmpMapper</code> æ¥å£ä¸­å³å¯ã€‚</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»Ÿè®¡å„ä¸ªèŒä½çš„å‘˜å·¥äººæ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">@MapKey(<span class="string">&quot;pos&quot;</span>)</span><br><span class="line">List&lt;<span class="built_in">Map</span>&lt;<span class="built_in">String</span>,<span class="built_in">Object</span>&gt;&gt; countEmpJobData();</span><br></pre></td></tr></table></figure><p>å¦‚æœæŸ¥è¯¢çš„è®°å½•å¾€Mapä¸­å°è£…ï¼Œå¯ä»¥é€šè¿‡@MapKeyæ³¨è§£æŒ‡å®šè¿”å›çš„mapä¸­çš„å”¯ä¸€æ ‡è¯†æ˜¯é‚£ä¸ªå­—æ®µã€‚ã€ä¹Ÿå¯ä»¥ä¸æŒ‡å®šã€‘</p><p><strong>5). å®šä¹‰EmpMapper.xml</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="comment">-- ç»Ÿè®¡å„ä¸ªèŒä½çš„å‘˜å·¥äººæ•° --&gt;</span></span><br><span class="line">&lt;<span class="keyword">select</span> id=&quot;countEmpJobData&quot; resultType=&quot;java.util.Map&quot;&gt;</span><br><span class="line">    <span class="keyword">select</span></span><br><span class="line">    (<span class="keyword">case</span> job <span class="keyword">when</span> <span class="number">1</span> <span class="keyword">then</span> <span class="string">&#x27;ç­ä¸»ä»»&#x27;</span> </span><br><span class="line">                     <span class="keyword">when</span> <span class="number">2</span> <span class="keyword">then</span> <span class="string">&#x27;è®²å¸ˆ&#x27;</span> </span><br><span class="line">                     <span class="keyword">when</span> <span class="number">3</span> <span class="keyword">then</span> <span class="string">&#x27;å­¦å·¥ä¸»ç®¡&#x27;</span> </span><br><span class="line">                     <span class="keyword">when</span> <span class="number">4</span> <span class="keyword">then</span> <span class="string">&#x27;æ•™ç ”ä¸»ç®¡&#x27;</span> </span><br><span class="line">                     <span class="keyword">when</span> <span class="number">5</span> <span class="keyword">then</span> <span class="string">&#x27;å’¨è¯¢å¸ˆ&#x27;</span> </span><br><span class="line">                     <span class="keyword">else</span> <span class="string">&#x27;å…¶ä»–&#x27;</span> <span class="keyword">end</span>)  pos,</span><br><span class="line">    count(*) total</span><br><span class="line">    <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> job</span><br><span class="line">    <span class="keyword">order</span> <span class="keyword">by</span> total</span><br><span class="line">&lt;/<span class="keyword">select</span>&gt;</span><br></pre></td></tr></table></figure><p><strong>caseæµç¨‹æ§åˆ¶å‡½æ•°ï¼š</strong></p><ul><li><p>è¯­æ³•ä¸€ï¼šcase when cond1 then res1 [ when cond2 then res2 ] else res end ;</p></li><li><p>å«ä¹‰ï¼šå¦‚æœ cond1 æˆç«‹ï¼Œ å– res1ã€‚ å¦‚æœ cond2 æˆç«‹ï¼Œå– res2ã€‚ å¦‚æœå‰é¢çš„æ¡ä»¶éƒ½ä¸æˆç«‹ï¼Œåˆ™å– resã€‚</p></li><li><p>è¯­æ³•äºŒï¼ˆä»…é€‚ç”¨äºç­‰å€¼åŒ¹é…ï¼‰ï¼šcase expr when val1 then res1 [ when val2 then res2 ] else res end ;</p></li><li><p>å«ä¹‰ï¼šå¦‚æœ expr çš„å€¼ä¸º val1 ï¼Œ å– res1ã€‚ å¦‚æœ expr çš„å€¼ä¸º val2 ï¼Œå– res2ã€‚ å¦‚æœå‰é¢çš„æ¡ä»¶éƒ½ä¸æˆç«‹ï¼Œåˆ™å– resã€‚</p></li></ul><p>é‡æ–°å¯åŠ¨æœåŠ¡ï¼Œæ‰“å¼€Apifoxè¿›è¡Œæµ‹è¯•ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-408-1024x646.png" alt="img"></p><p>è”è°ƒæµ‹è¯•</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-409-1024x501.png" alt="img"></p><h3 id="8-3æ€§åˆ«ç»Ÿè®¡">8.3æ€§åˆ«ç»Ÿè®¡</h3><h4 id="8-3-1éœ€æ±‚">8.3.1éœ€æ±‚</h4><p>å¯¹äºè¿™ç±»çš„å›¾å½¢æŠ¥è¡¨ï¼ŒæœåŠ¡ç«¯è¦åšçš„ï¼Œå°±æ˜¯ä¸ºå…¶æä¾›æ•°æ®å³å¯ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡å®˜æ–¹çš„ç¤ºä¾‹ï¼Œçœ‹åˆ°æä¾›çš„æ•°æ®å°±æ˜¯ä¸€ä¸ªjsonæ ¼å¼çš„æ•°æ®ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-410.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-361-1024x714.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-362-1024x307.png" alt="img"></p><h4 id="8-3-2ä»£ç å®ç°">8.3.2ä»£ç å®ç°</h4><p><strong>1). åœ¨ReportControllerï¼Œæ·»åŠ æ–¹æ³•ã€‚</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»Ÿè®¡å‘˜å·¥æ€§åˆ«ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">&quot;/empGenderData&quot;</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="title class_">Result</span> <span class="title function_">getEmpGenderData</span>(<span class="params"></span>)&#123;</span><br><span class="line">    log.<span class="title function_">info</span>(<span class="string">&quot;ç»Ÿè®¡å‘˜å·¥æ€§åˆ«ä¿¡æ¯&quot;</span>);</span><br><span class="line">    <span class="title class_">List</span>&lt;<span class="title class_">Map</span>&gt; genderList = reportService.<span class="title function_">getEmpGenderData</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Result</span>.<span class="title function_">success</span>(genderList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2). åœ¨ReportServiceæ¥å£ï¼Œæ·»åŠ æ¥å£æ–¹æ³•ã€‚</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»Ÿè®¡å‘˜å·¥æ€§åˆ«ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">List&lt;Map&gt; <span class="title">getEmpGenderData</span>()</span>;</span><br></pre></td></tr></table></figure><p><strong>3). åœ¨ReportServiceImplå®ç°ç±»ï¼Œå®ç°æ–¹æ³•</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">List</span>&lt;<span class="title class_">Map</span>&gt; <span class="title function_">getEmpGenderData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> empMapper.<span class="title function_">countEmpGenderData</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>4). å®šä¹‰EmpMapper æ¥å£</strong></p><p>ç»Ÿè®¡çš„æ˜¯å‘˜å·¥çš„ä¿¡æ¯ï¼Œæ‰€ä»¥éœ€è¦æ“ä½œçš„æ˜¯å‘˜å·¥è¡¨ã€‚ æ‰€ä»¥ä»£ç æˆ‘ä»¬å°±å†™åœ¨ <code>EmpMapper</code> æ¥å£ä¸­å³å¯ã€‚</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»Ÿè®¡å‘˜å·¥æ€§åˆ«ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable">@MapKey</span>(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">List&lt;Map&gt; <span class="built_in">countEmpGenderData</span>();</span><br></pre></td></tr></table></figure><p><strong>5). å®šä¹‰EmpMapper.xml</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="comment">-- ç»Ÿè®¡å‘˜å·¥çš„æ€§åˆ«ä¿¡æ¯ --&gt;</span></span><br><span class="line">&lt;<span class="keyword">select</span> id=&quot;countEmpGenderData&quot; resultType=&quot;java.util.Map&quot;&gt;</span><br><span class="line">    <span class="keyword">select</span></span><br><span class="line">    <span class="keyword">if</span>(gender = <span class="number">1</span>, <span class="string">&#x27;ç”·&#x27;</span>, <span class="string">&#x27;å¥³&#x27;</span>) <span class="keyword">as</span> <span class="type">name</span>,</span><br><span class="line">    count(*) <span class="keyword">as</span> <span class="keyword">value</span></span><br><span class="line">    <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> gender ;</span><br><span class="line">&lt;/<span class="keyword">select</span>&gt;</span><br></pre></td></tr></table></figure><p>ifå‡½æ•°è¯­æ³•ï¼š<code>if(æ¡ä»¶, æ¡ä»¶ä¸ºtrueå–å€¼, æ¡ä»¶ä¸ºfalseå–å€¼)</code></p><p>ifnullå‡½æ•°è¯­æ³•ï¼š<code>ifnull(expr, val1)</code> å¦‚æœexprä¸ä¸ºnullï¼Œå–è‡ªèº«ï¼Œå¦åˆ™å–val1</p><p>Apifoxæµ‹è¯•</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-411.png" alt="img"></p><p>è”è°ƒæµ‹è¯•</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-412.png" alt="img"></p><h1 id="â€“ç­çº§ç®¡ç†">â€“ç­çº§ç®¡ç†</h1><p>æ•°æ®å‡†å¤‡</p><p>åœ¨æ•°æ®åº“ä¸­ï¼Œåˆ›å»ºå­¦ç”Ÿè¡¨ <code>clazz</code> , <code>student</code>ï¼ŒSQLå¦‚ä¸‹ï¼š</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">create table clazz<span class="punctuation">(</span></span><br><span class="line">    id   int unsigned primary key auto_increment comment &#x27;ID,ä¸»é”®&#x27;<span class="punctuation">,</span></span><br><span class="line">    name  varchar<span class="punctuation">(</span><span class="number">30</span><span class="punctuation">)</span> not <span class="literal">null</span> unique  comment &#x27;ç­çº§åç§°&#x27;<span class="punctuation">,</span></span><br><span class="line">    room  varchar<span class="punctuation">(</span><span class="number">20</span><span class="punctuation">)</span> comment &#x27;ç­çº§æ•™å®¤&#x27;<span class="punctuation">,</span></span><br><span class="line">    begin_date date not <span class="literal">null</span> comment &#x27;å¼€è¯¾æ—¶é—´&#x27;<span class="punctuation">,</span></span><br><span class="line">    end_date date not <span class="literal">null</span> comment &#x27;ç»“è¯¾æ—¶é—´&#x27;<span class="punctuation">,</span></span><br><span class="line">    master_id int unsigned <span class="literal">null</span> comment &#x27;ç­ä¸»ä»»ID, å…³è”å‘˜å·¥è¡¨ID&#x27;<span class="punctuation">,</span></span><br><span class="line">    subject tinyint unsigned not <span class="literal">null</span> comment &#x27;å­¦ç§‘, 1:java, 2:å‰ç«¯, 3:å¤§æ•°æ®, 4:Python, 5:Go, 6: åµŒå…¥å¼&#x27;<span class="punctuation">,</span></span><br><span class="line">    create_time datetime  comment &#x27;åˆ›å»ºæ—¶é—´&#x27;<span class="punctuation">,</span></span><br><span class="line">    update_time datetime  comment &#x27;ä¿®æ”¹æ—¶é—´&#x27;</span><br><span class="line"><span class="punctuation">)</span>comment &#x27;ç­çº§è¡¨&#x27;<span class="punctuation">;</span></span><br><span class="line"></span><br><span class="line">INSERT INTO clazz VALUES <span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span>&#x27;JavaEEå°±ä¸š163æœŸ&#x27;<span class="punctuation">,</span>&#x27;212&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-04-30</span>&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-06-29</span>&#x27;<span class="punctuation">,</span><span class="number">10</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">2024-06-01</span> 17:08:23&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-06-01</span> 17:39:58&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span>&#x27;å‰ç«¯å°±ä¸š90æœŸ&#x27;<span class="punctuation">,</span>&#x27;210&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-07-10</span>&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-01-20</span>&#x27;<span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">2024-06-01</span> 17:45:12&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-06-01</span> 17:45:12&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span>&#x27;JavaEEå°±ä¸š165æœŸ&#x27;<span class="punctuation">,</span>&#x27;108&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-06-15</span>&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-12-25</span>&#x27;<span class="punctuation">,</span><span class="number">6</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">2024-06-01</span> 17:45:40&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-06-01</span> 17:45:40&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span>&#x27;JavaEEå°±ä¸š166æœŸ&#x27;<span class="punctuation">,</span>&#x27;105&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-07-20</span>&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-02-20</span>&#x27;<span class="punctuation">,</span><span class="number">20</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">2024-06-01</span> 17:46:10&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-06-01</span> 17:46:10&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span>&#x27;å¤§æ•°æ®å°±ä¸š58æœŸ&#x27;<span class="punctuation">,</span>&#x27;209&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-08-01</span>&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-02-15</span>&#x27;<span class="punctuation">,</span><span class="number">7</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span>&#x27;<span class="number">2024-06-01</span> 17:51:21&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-06-01</span> 17:51:21&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">6</span><span class="punctuation">,</span>&#x27;JavaEEå°±ä¸š167æœŸ&#x27;<span class="punctuation">,</span>&#x27;325&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-11-20</span>&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-05-10</span>&#x27;<span class="punctuation">,</span><span class="number">36</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">2024-11-15</span> 11:35:46&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-12-13</span> 14:31:24&#x27;<span class="punctuation">)</span><span class="punctuation">;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">create table student<span class="punctuation">(</span></span><br><span class="line">  id int unsigned primary key auto_increment comment &#x27;ID,ä¸»é”®&#x27;<span class="punctuation">,</span></span><br><span class="line">  name varchar<span class="punctuation">(</span><span class="number">10</span><span class="punctuation">)</span>  not <span class="literal">null</span> comment &#x27;å§“å&#x27;<span class="punctuation">,</span></span><br><span class="line">  no char<span class="punctuation">(</span><span class="number">10</span><span class="punctuation">)</span>  not <span class="literal">null</span> unique comment &#x27;å­¦å·&#x27;<span class="punctuation">,</span></span><br><span class="line">  gender tinyint unsigned  not <span class="literal">null</span> comment &#x27;æ€§åˆ«, 1: ç”·, 2: å¥³&#x27;<span class="punctuation">,</span></span><br><span class="line">  phone  varchar<span class="punctuation">(</span><span class="number">11</span><span class="punctuation">)</span>  not <span class="literal">null</span> unique comment &#x27;æ‰‹æœºå·&#x27;<span class="punctuation">,</span></span><br><span class="line">  id_card  char<span class="punctuation">(</span><span class="number">18</span><span class="punctuation">)</span>  not <span class="literal">null</span> unique comment &#x27;èº«ä»½è¯å·&#x27;<span class="punctuation">,</span></span><br><span class="line">  is_college tinyint unsigned  not <span class="literal">null</span> comment &#x27;æ˜¯å¦æ¥è‡ªäºé™¢æ ¡, 1:æ˜¯, 0:å¦&#x27;<span class="punctuation">,</span></span><br><span class="line">  address  varchar<span class="punctuation">(</span><span class="number">100</span><span class="punctuation">)</span>  comment &#x27;è”ç³»åœ°å€&#x27;<span class="punctuation">,</span></span><br><span class="line">  degree  tinyint unsigned  comment &#x27;æœ€é«˜å­¦å†, 1:åˆä¸­, 2:é«˜ä¸­, 3:å¤§ä¸“, 4:æœ¬ç§‘, 5:ç¡•å£«, 6:åšå£«&#x27;<span class="punctuation">,</span></span><br><span class="line">  graduation_date date comment &#x27;æ¯•ä¸šæ—¶é—´&#x27;<span class="punctuation">,</span></span><br><span class="line">  clazz_id  int unsigned not <span class="literal">null</span> comment &#x27;ç­çº§ID, å…³è”ç­çº§è¡¨ID&#x27;<span class="punctuation">,</span></span><br><span class="line">  violation_count tinyint unsigned default &#x27;0&#x27; not <span class="literal">null</span> comment &#x27;è¿çºªæ¬¡æ•°&#x27;<span class="punctuation">,</span></span><br><span class="line">  violation_score tinyint unsigned default &#x27;0&#x27; not <span class="literal">null</span> comment &#x27;è¿çºªæ‰£åˆ†&#x27;<span class="punctuation">,</span></span><br><span class="line">  create_time  datetime  comment &#x27;åˆ›å»ºæ—¶é—´&#x27;<span class="punctuation">,</span></span><br><span class="line">  update_time  datetime  comment &#x27;ä¿®æ”¹æ—¶é—´&#x27;</span><br><span class="line"><span class="punctuation">)</span> comment &#x27;å­¦å‘˜è¡¨&#x27;<span class="punctuation">;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO student VALUES <span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span>&#x27;æ®µèª‰&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2022000001</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1880000000</span>1&#x27;<span class="punctuation">,</span>&#x27;<span class="number">11012000030020</span><span class="number">0001</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;åŒ—äº¬å¸‚æ˜Œå¹³åŒºå»ºæåŸè¥¿è·¯1å·&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">2021-07-01</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-11-15</span> 16:20:59&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span>&#x27;è§å³°&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2022000002</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1880021000</span>3&#x27;<span class="punctuation">,</span>&#x27;<span class="number">11012000030020</span><span class="number">0002</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;åŒ—äº¬å¸‚æ˜Œå¹³åŒºå»ºæåŸè¥¿è·¯2å·&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">2022-07-01</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span>&#x27;è™šç«¹&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2022000003</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1880001300</span>1&#x27;<span class="punctuation">,</span>&#x27;<span class="number">11012000030020</span><span class="number">0003</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;åŒ—äº¬å¸‚æ˜Œå¹³åŒºå»ºæåŸè¥¿è·¯3å·&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">2024-07-01</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span>&#x27;è§è¿œå±±&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2022000004</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1880000321</span>1&#x27;<span class="punctuation">,</span>&#x27;<span class="number">11012000030020</span><span class="number">0004</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;åŒ—äº¬å¸‚æ˜Œå¹³åŒºå»ºæåŸè¥¿è·¯4å·&#x27;<span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span>&#x27;<span class="number">2024-07-01</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span>&#x27;é˜¿æœ±&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2022000005</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">1880016000</span>2&#x27;<span class="punctuation">,</span>&#x27;<span class="number">11012000030020</span><span class="number">0005</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;åŒ—äº¬å¸‚æ˜Œå¹³åŒºå»ºæåŸè¥¿è·¯5å·&#x27;<span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span>&#x27;<span class="number">2020-07-01</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">6</span><span class="punctuation">,</span>&#x27;é˜¿ç´«&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2022000006</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">1880000003</span>4&#x27;<span class="punctuation">,</span>&#x27;<span class="number">11012000030020</span><span class="number">0006</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;åŒ—äº¬å¸‚æ˜Œå¹³åŒºå»ºæåŸè¥¿è·¯6å·&#x27;<span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span>&#x27;<span class="number">2021-07-01</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">7</span><span class="punctuation">,</span>&#x27;æ¸¸å¦ä¹‹&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2022000007</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1880000006</span>7&#x27;<span class="punctuation">,</span>&#x27;<span class="number">11012000030020</span><span class="number">0007</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;åŒ—äº¬å¸‚æ˜Œå¹³åŒºå»ºæåŸè¥¿è·¯7å·&#x27;<span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span>&#x27;<span class="number">2022-07-01</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">8</span><span class="punctuation">,</span>&#x27;åº·æ•&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2022000008</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">1880000007</span>7&#x27;<span class="punctuation">,</span>&#x27;<span class="number">11012000030020</span><span class="number">0008</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;åŒ—äº¬å¸‚æ˜Œå¹³åŒºå»ºæåŸè¥¿è·¯8å·&#x27;<span class="punctuation">,</span><span class="number">5</span><span class="punctuation">,</span>&#x27;<span class="number">2024-07-01</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">9</span><span class="punctuation">,</span>&#x27;å¾é•¿è€&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2022000009</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1880000034</span>1&#x27;<span class="punctuation">,</span>&#x27;<span class="number">11012000030020</span><span class="number">0009</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;åŒ—äº¬å¸‚æ˜Œå¹³åŒºå»ºæåŸè¥¿è·¯9å·&#x27;<span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span>&#x27;<span class="number">2024-07-01</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span>&#x27;äº‘ä¸­é¹¤&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2022000010</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1880000657</span>1&#x27;<span class="punctuation">,</span>&#x27;<span class="number">11012000030020</span><span class="number">0010</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;åŒ—äº¬å¸‚æ˜Œå¹³åŒºå»ºæåŸè¥¿è·¯10å·&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">2020-07-01</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">11</span><span class="punctuation">,</span>&#x27;é’Ÿä¸‡ä»‡&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2022000011</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1880000039</span>1&#x27;<span class="punctuation">,</span>&#x27;<span class="number">11012000030020</span><span class="number">0011</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;åŒ—äº¬å¸‚æ˜Œå¹³åŒºå»ºæåŸè¥¿è·¯11å·&#x27;<span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span>&#x27;<span class="number">2021-07-01</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-11-15</span> 16:21:24&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">12</span><span class="punctuation">,</span>&#x27;å´”ç™¾æ³‰&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2022000012</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1880000078</span>1&#x27;<span class="punctuation">,</span>&#x27;<span class="number">11012000030020</span><span class="number">0018</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;åŒ—äº¬å¸‚æ˜Œå¹³åŒºå»ºæåŸè¥¿è·¯12å·&#x27;<span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span>&#x27;<span class="number">2022-07-05</span>&#x27;<span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">6</span><span class="punctuation">,</span><span class="number">17</span><span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-12-13</span> 14:33:58&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">13</span><span class="punctuation">,</span>&#x27;è€¶å¾‹æ´ªåŸº&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2022000013</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1880000890</span>1&#x27;<span class="punctuation">,</span>&#x27;<span class="number">11012000030020</span><span class="number">0013</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;åŒ—äº¬å¸‚æ˜Œå¹³åŒºå»ºæåŸè¥¿è·¯13å·&#x27;<span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span>&#x27;<span class="number">2024-07-01</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-11-15</span> 16:21:21&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">14</span><span class="punctuation">,</span>&#x27;å¤©å±±ç«¥å§¥&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2022000014</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">1880000920</span>1&#x27;<span class="punctuation">,</span>&#x27;<span class="number">11012000030020</span><span class="number">0014</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;åŒ—äº¬å¸‚æ˜Œå¹³åŒºå»ºæåŸè¥¿è·¯14å·&#x27;<span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span>&#x27;<span class="number">2024-07-01</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-11-15</span> 16:21:17&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">15</span><span class="punctuation">,</span>&#x27;åˆ˜ç«¹åº„&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2022000015</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1880000940</span>1&#x27;<span class="punctuation">,</span>&#x27;<span class="number">11012000030020</span><span class="number">0015</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;åŒ—äº¬å¸‚æ˜Œå¹³åŒºå»ºæåŸè¥¿è·¯15å·&#x27;<span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span>&#x27;<span class="number">2020-07-01</span>&#x27;<span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">16</span><span class="punctuation">,</span>&#x27;ææ˜¥æ¥&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2022000016</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1880000850</span>1&#x27;<span class="punctuation">,</span>&#x27;<span class="number">11012000030020</span><span class="number">0016</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;åŒ—äº¬å¸‚æ˜Œå¹³åŒºå»ºæåŸè¥¿è·¯16å·&#x27;<span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span>&#x27;<span class="number">2021-07-01</span>&#x27;<span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">17</span><span class="punctuation">,</span>&#x27;ç‹è¯­å«£&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2022000017</span>&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">1880000760</span>1&#x27;<span class="punctuation">,</span>&#x27;<span class="number">11012000030020</span><span class="number">0017</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;åŒ—äº¬å¸‚æ˜Œå¹³åŒºå»ºæåŸè¥¿è·¯17å·&#x27;<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>&#x27;<span class="number">2022-07-01</span>&#x27;<span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-11-14</span> 21:22:19&#x27;<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">(</span><span class="number">18</span><span class="punctuation">,</span>&#x27;éƒ‘æˆåŠŸ&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024001101</span>&#x27;<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>&#x27;<span class="number">1330909234</span>5&#x27;<span class="punctuation">,</span>&#x27;<span class="number">11011011011011</span><span class="number">0110</span>&#x27;<span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span>&#x27;åŒ—äº¬å¸‚æ˜Œå¹³åŒºå›é¾™è§‚è¡—é“88å·&#x27;<span class="punctuation">,</span><span class="number">5</span><span class="punctuation">,</span>&#x27;<span class="number">2021-07-01</span>&#x27;<span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">7</span><span class="punctuation">,</span>&#x27;<span class="number">2024-11-15</span> 16:26:18&#x27;<span class="punctuation">,</span>&#x27;<span class="number">2024-11-15</span> 16:40:10&#x27;<span class="punctuation">)</span><span class="punctuation">;</span></span><br></pre></td></tr></table></figure><p>è¡¨ç»“æ„å…³ç³»è¯´æ˜ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-413-1024x562.png" alt="img"></p><p>å®ä½“ç±»Clazzï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Data</span></span><br><span class="line"><span class="variable">@NoArgsConstructor</span></span><br><span class="line"><span class="variable">@AllArgsConstructor</span></span><br><span class="line">public class Clazz &#123;</span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">Integer</span> <span class="selector-tag">id</span>; <span class="comment">//ID</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">String</span> <span class="selector-tag">name</span>; <span class="comment">//ç­çº§åç§°</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">String</span> <span class="selector-tag">room</span>; <span class="comment">//ç­çº§æ•™å®¤</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">LocalDate</span> <span class="selector-tag">beginDate</span>; <span class="comment">//å¼€è¯¾æ—¶é—´</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">LocalDate</span> <span class="selector-tag">endDate</span>; <span class="comment">//ç»“è¯¾æ—¶é—´</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">Integer</span> <span class="selector-tag">masterId</span>; <span class="comment">//ç­ä¸»ä»»</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">Integer</span> <span class="selector-tag">subject</span>; <span class="comment">//å­¦ç§‘</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">LocalDateTime</span> <span class="selector-tag">createTime</span>; <span class="comment">//åˆ›å»ºæ—¶é—´</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">LocalDateTime</span> <span class="selector-tag">updateTime</span>; <span class="comment">//ä¿®æ”¹æ—¶é—´</span></span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">String</span> <span class="selector-tag">masterName</span>; <span class="comment">//ç­ä¸»ä»»å§“å</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">String</span> <span class="selector-tag">status</span>; <span class="comment">//ç­çº§çŠ¶æ€ - æœªå¼€ç­ , åœ¨è¯» , å·²ç»“è¯¾</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ä½“ç±»Studentï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Data</span></span><br><span class="line"><span class="variable">@NoArgsConstructor</span></span><br><span class="line"><span class="variable">@AllArgsConstructor</span></span><br><span class="line">public class Student &#123;</span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">Integer</span> <span class="selector-tag">id</span>; <span class="comment">//ID</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">String</span> <span class="selector-tag">name</span>; <span class="comment">//å§“å</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">String</span> <span class="selector-tag">no</span>; <span class="comment">//åºå·</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">Integer</span> <span class="selector-tag">gender</span>; <span class="comment">//æ€§åˆ« , 1: ç”· , 2 : å¥³</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">String</span> <span class="selector-tag">phone</span>; <span class="comment">//æ‰‹æœºå·</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">String</span> <span class="selector-tag">idCard</span>; <span class="comment">//èº«ä»½è¯å·</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">Integer</span> <span class="selector-tag">isCollege</span>; <span class="comment">//æ˜¯å¦æ¥è‡ªäºé™¢æ ¡, 1: æ˜¯, 0: å¦</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">String</span> <span class="selector-tag">address</span>; <span class="comment">//è”ç³»åœ°å€</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">Integer</span> <span class="selector-tag">degree</span>; <span class="comment">//æœ€é«˜å­¦å†, 1: åˆä¸­, 2: é«˜ä¸­ , 3: å¤§ä¸“ , 4: æœ¬ç§‘ , 5: ç¡•å£« , 6: åšå£«</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">LocalDate</span> <span class="selector-tag">graduationDate</span>; <span class="comment">//æ¯•ä¸šæ—¶é—´</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">Integer</span> <span class="selector-tag">clazzId</span>; <span class="comment">//ç­çº§ID</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">Short</span> <span class="selector-tag">violationCount</span>; <span class="comment">//è¿çºªæ¬¡æ•°</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">Short</span> <span class="selector-tag">violationScore</span>; <span class="comment">//è¿çºªæ‰£åˆ†</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">LocalDateTime</span> <span class="selector-tag">createTime</span>; <span class="comment">//åˆ›å»ºæ—¶é—´</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">LocalDateTime</span> <span class="selector-tag">updateTime</span>; <span class="comment">//ä¿®æ”¹æ—¶é—´</span></span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">String</span> <span class="selector-tag">clazzName</span>;<span class="comment">//ç­çº§åç§°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="1-æ¡ä»¶åˆ†é¡µæŸ¥è¯¢">1.æ¡ä»¶åˆ†é¡µæŸ¥è¯¢</h2><h3 id="1-1éœ€æ±‚">1.1éœ€æ±‚</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-363-1024x474.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-364-1024x718.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-365-1024x761.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-367-759x1024.png" alt="img"></p><h3 id="1-2ä»£ç å®ç°">1.2ä»£ç å®ç°</h3><p>1ï¼‰åœ¨ <code>ClazzController</code> ä¸­</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">Result</span> <span class="title function_">page</span>(<span class="params"><span class="title class_">String</span> name ,</span></span><br><span class="line"><span class="params">                   <span class="meta">@DateTimeFormat</span>(pattern = <span class="string">&quot;yyyy-MM-dd&quot;</span>) <span class="title class_">LocalDate</span> begin ,</span></span><br><span class="line"><span class="params">                   <span class="meta">@DateTimeFormat</span>(pattern = <span class="string">&quot;yyyy-MM-dd&quot;</span>) <span class="title class_">LocalDate</span> end,</span></span><br><span class="line"><span class="params">                   <span class="meta">@RequestParam</span>(defaultValue = <span class="string">&quot;1&quot;</span>) <span class="title class_">Integer</span> page ,</span></span><br><span class="line"><span class="params">                   <span class="meta">@RequestParam</span>(defaultValue = <span class="string">&quot;10&quot;</span>)<span class="title class_">Integer</span> pageSize</span>)&#123;</span><br><span class="line">    <span class="title class_">PageResult</span> pageResult = clazzService.<span class="title function_">page</span>(name , begin , end , page , pageSize);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Result</span>.<span class="title function_">success</span>(pageResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2).<code>Clazz</code>Service &amp; <code>Clazz</code>ServiceImpl</p><p>åœ¨ <code>ClazzService</code> ä¸­</p><figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * æ¡ä»¶åˆ†é¡µæŸ¥è¯¢</span><br><span class="line"> * <span class="meta">@param</span> name</span><br><span class="line"> * <span class="meta">@param</span> <span class="keyword">begin</span></span><br><span class="line"> * <span class="meta">@param</span> <span class="keyword">end</span></span><br><span class="line"> * <span class="meta">@param</span> page</span><br><span class="line"> * <span class="meta">@param</span> pageSize</span><br><span class="line"> * <span class="meta">@return</span></span><br><span class="line"> */</span><br><span class="line">PageResult page(<span class="built_in">String</span> name, LocalDate <span class="keyword">begin</span>, LocalDate <span class="keyword">end</span>, <span class="built_in">Integer</span> page, <span class="built_in">Integer</span> pageSize);</span><br></pre></td></tr></table></figure><p>åœ¨<code>Clazz</code>ServiceImplä¸­</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line"><span class="built_in">public</span> PageResult page(String <span class="type">name</span>, LocalDate <span class="keyword">begin</span>, LocalDate <span class="keyword">end</span>, <span class="type">Integer</span> page, <span class="type">Integer</span> pageSize) &#123;</span><br><span class="line">    PageHelper.startPage(page, pageSize);</span><br><span class="line"></span><br><span class="line">    List&lt;Clazz&gt; dataList = clazzMapper.list(<span class="type">name</span>,<span class="keyword">begin</span>,<span class="keyword">end</span>);</span><br><span class="line">    Page&lt;Clazz&gt; p = (Page&lt;Clazz&gt;) dataList;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">new</span> PageResult(p.getTotal(), p.getResult());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ï¼‰ClazzMapperä¸­</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * åŠ¨æ€æ¡ä»¶æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function">List&lt;Clazz&gt; <span class="title">list</span><span class="params">(<span class="type">String</span> name, LocalDate begin, LocalDate end)</span></span>;</span><br></pre></td></tr></table></figure><p>ClazzMapper.xmlä¸­</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">select</span> id=&quot;list&quot; resultType=&quot;com.itheima.pojo.Clazz&quot;&gt;</span><br><span class="line">    <span class="keyword">select</span></span><br><span class="line">        c.*,</span><br><span class="line">        e.name masterName,</span><br><span class="line">        (<span class="keyword">case</span> <span class="keyword">when</span> begin_date &amp;gt; now() <span class="keyword">then</span> <span class="string">&#x27;æœªå¼€ç­&#x27;</span> <span class="keyword">when</span> now() &amp;gt; end_date <span class="keyword">then</span> <span class="string">&#x27;å·²ç»“è¯¾&#x27;</span> <span class="keyword">else</span>  <span class="string">&#x27;åœ¨è¯»ä¸­&#x27;</span> <span class="keyword">end</span> ) status</span><br><span class="line">    <span class="keyword">from</span> clazz c <span class="keyword">left join</span> emp e <span class="keyword">on</span> c.master_id = e.id</span><br><span class="line">    &lt;<span class="keyword">where</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">if</span> test=&quot;name != null and name != &#x27;&#x27;&quot;&gt;</span><br><span class="line">            c.name <span class="keyword">like</span> concat(<span class="string">&#x27;%&#x27;</span>,#&#123;<span class="type">name</span>&#125;,<span class="string">&#x27;%&#x27;</span>)</span><br><span class="line">        &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">if</span> test=&quot;begin != null and end != null&quot;&gt;</span><br><span class="line">            <span class="keyword">and</span> c.end_date <span class="keyword">between</span> #&#123;<span class="keyword">begin</span>&#125; <span class="keyword">and</span> #&#123;<span class="keyword">end</span>&#125;</span><br><span class="line">        &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">    &lt;/<span class="keyword">where</span>&gt;</span><br><span class="line">    <span class="keyword">order</span> <span class="keyword">by</span> c.update_time <span class="keyword">desc</span></span><br><span class="line">&lt;/<span class="keyword">select</span>&gt;</span><br></pre></td></tr></table></figure><h2 id="2-æŸ¥è¯¢æ‰€æœ‰å‘˜å·¥">2.æŸ¥è¯¢æ‰€æœ‰å‘˜å·¥</h2><h3 id="2-1éœ€æ±‚-2">2.1éœ€æ±‚</h3><p>é‚£å…¶å®ï¼Œå¯¹äºåŸ¹è®­æœºæ„æ¥è¯´ï¼Œç­ä¸»ä»»å°±æ˜¯è¿™ä¸ªä¼ä¸šçš„å‘˜å·¥ã€‚æ‰€ä»¥ï¼Œç­ä¸»ä»»ä¸‹æ‹‰åˆ—è¡¨ä¸­å±•ç¤ºçš„å°±æ˜¯æ‰€æœ‰çš„å‘˜å·¥æ•°æ®ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-368-1024x490.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-415.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-414-1024x775.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-416-1024x841.png" alt="img"></p><h3 id="2-2ä»£ç å®ç°">2.2ä»£ç å®ç°</h3><p>1ï¼‰åœ¨Emp<code>Controller</code> ä¸­</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢æ‰€æœ‰çš„å‘˜å·¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">&quot;/list&quot;</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="function">Result <span class="title">list</span><span class="params">()</span></span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;æŸ¥è¯¢æ‰€æœ‰çš„å‘˜å·¥æ•°æ®&quot;</span>);</span><br><span class="line">        List&lt;Emp&gt; empList = empService.list();</span><br><span class="line">        <span class="function"><span class="keyword">return</span> Result.<span class="title">success</span><span class="params">(empList)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2).<code>Emp</code>Service &amp;EmpServiceImpl</p><p>åœ¨ <code>EmpService</code> ä¸­</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æŸ¥è¯¢æ‰€æœ‰çš„å‘˜å·¥æ•°æ®</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function">List&lt;Emp&gt; <span class="title">list</span>()</span>;</span><br></pre></td></tr></table></figure><p>åœ¨ EmpServiceImplä¸­</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="title class_">List</span>&lt;<span class="title class_">Emp</span>&gt; <span class="title function_">list</span>(<span class="params"></span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> empMapper.<span class="title function_">findAll</span>();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>3ï¼‰EmpMapper ä¸­</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢å…¨éƒ¨å‘˜å·¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable">@Select</span>(<span class="string">&quot;select id, username, password, name, gender, phone, job, salary, image, entry_date, dept_id, create_time, update_time from emp&quot;</span>)</span><br><span class="line">List&lt;Emp&gt; <span class="built_in">findAll</span>();</span><br></pre></td></tr></table></figure><h2 id="3-æ–°å¢ç­çº§ä¿¡æ¯">3.æ–°å¢ç­çº§ä¿¡æ¯</h2><h3 id="3-1éœ€æ±‚">3.1éœ€æ±‚</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-417-1024x481.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-418-1024x640.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-419-1024x830.png" alt="img"></p><h3 id="3-2ä»£ç å®ç°">3.2ä»£ç å®ç°</h3><p>1ï¼‰åœ¨ <code>ClazzController</code> ä¸­</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ–°å¢ç­çº§</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable">@PostMapping</span></span><br><span class="line">public Result <span class="built_in">save</span>(<span class="variable">@RequestBody</span> Clazz clazz)&#123;</span><br><span class="line">    <span class="selector-tag">clazzService</span><span class="selector-class">.save</span>(clazz);</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">Result</span><span class="selector-class">.success</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2).<code>Clazz</code>Service &amp; <code>Clazz</code>ServiceImpl</p><p>åœ¨ <code>ClazzService</code> ä¸­</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ·»åŠ ç­çº§ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> * @param clazz</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">save</span><span class="params">(Clazz clazz)</span></span>;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>Clazz</code>ServiceImpl ä¸­</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line"><span class="built_in">public</span> <span class="type">void</span> save(Clazz clazz) &#123;</span><br><span class="line">    clazz.setCreateTime(LocalDateTime.now());</span><br><span class="line">    clazz.setUpdateTime(LocalDateTime.now());</span><br><span class="line">    clazzMapper.<span class="keyword">insert</span>(clazz);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ï¼‰ClazzMapper ä¸­</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ·»åŠ ç­çº§ä¿¡æ¯</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   @Insert(<span class="string">&quot;insert into clazz VALUES (null,<span class="subst">#&#123;name&#125;</span>,<span class="subst">#&#123;room&#125;</span>,<span class="subst">#&#123;beginDate&#125;</span>,<span class="subst">#&#123;endDate&#125;</span>,<span class="subst">#&#123;masterId&#125;</span>, <span class="subst">#&#123;subject&#125;</span>,<span class="subst">#&#123;createTime&#125;</span>,<span class="subst">#&#123;updateTime&#125;</span>)&quot;</span>)</span><br><span class="line">   <span class="literal">void</span> insert(Clazz clazz);</span><br></pre></td></tr></table></figure><h2 id="4-æ ¹æ®IDæŸ¥è¯¢ç­çº§">4.<strong>æ ¹æ®IDæŸ¥è¯¢ç­çº§</strong></h2><h3 id="4-1éœ€æ±‚">4.1éœ€æ±‚</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-420-1024x488.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-421-1024x524.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-422-1024x644.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-423-1024x427.png" alt="img"></p><h3 id="4-2ä»£ç å®ç°">4.2ä»£ç å®ç°</h3><p>1ï¼‰åœ¨ <code>ClazzController</code> ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®IDæŸ¥è¯¢ç­çº§è¯¦æƒ…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">getInfo</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">    <span class="type">Clazz</span> <span class="variable">clazz</span> <span class="operator">=</span> clazzService.getInfo(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success(clazz);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2).<code>Clazz</code>Service &amp; <code>Clazz</code>ServiceImpl</p><p>åœ¨ <code>ClazzService</code> ä¸­</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * æ ¹æ®IDæŸ¥è¯¢ç­çº§è¯¦æƒ…</span><br><span class="line"> * @param <span class="built_in">id</span></span><br><span class="line"> * @<span class="literal">return</span></span><br><span class="line"> */</span><br><span class="line">Clazz getInfo(Integer <span class="built_in">id</span>);</span><br></pre></td></tr></table></figure><p>åœ¨ <code>Clazz</code>ServiceImpl ä¸­</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="function">Clazz <span class="title">getInfo</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">return</span> clazzMapper.<span class="title">getInfo</span><span class="params">(id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ï¼‰ClazzMapper ä¸­</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®IDæŸ¥è¯¢ç­çº§è¯¦æƒ…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable">@Select</span>(<span class="string">&quot;select * from clazz where  id = #&#123;id&#125;&quot;</span>)</span><br><span class="line">Clazz <span class="built_in">getInfo</span>(Integer id);</span><br></pre></td></tr></table></figure><h2 id="5-ä¿®æ”¹ç­çº§ä¿¡æ¯">5.<strong>ä¿®æ”¹ç­çº§ä¿¡æ¯</strong></h2><h3 id="5-1éœ€æ±‚-2">5.1éœ€æ±‚</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-424-1024x491.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-425-1024x647.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-426-1024x838.png" alt="img"></p><h3 id="5-2ä»£ç å®ç°">5.2ä»£ç å®ç°</h3><p>1ï¼‰åœ¨ <code>ClazzController</code> ä¸­</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ›´æ–°ç­çº§ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable">@PutMapping</span></span><br><span class="line">public Result <span class="built_in">update</span>(<span class="variable">@RequestBody</span> Clazz clazz)&#123;</span><br><span class="line">    <span class="selector-tag">clazzService</span><span class="selector-class">.update</span>(clazz);</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">Result</span><span class="selector-class">.success</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2).<code>Clazz</code>Service &amp; <code>Clazz</code>ServiceImpl</p><p>åœ¨ <code>ClazzService</code> ä¸­</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¿®æ”¹ç­çº§ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> * @param clazz</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(Clazz clazz)</span></span>;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>Clazz</code>ServiceImpl ä¸­</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line"><span class="built_in">public</span> <span class="type">void</span> <span class="keyword">update</span>(Clazz clazz) &#123;</span><br><span class="line">    clazz.setUpdateTime(LocalDateTime.now());</span><br><span class="line">    clazzMapper.<span class="keyword">update</span>(clazz);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ï¼‰ClazzMapper ä¸­</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠ¨æ€æ›´æ–°ç­çº§ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(Clazz clazz)</span></span>;</span><br></pre></td></tr></table></figure><p>ClazzMapper.xml ä¸­</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="comment">&lt;!--åŠ¨æ€æ›´æ–°ç­çº§ä¿¡æ¯--&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       update clazz</span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;<span class="name">set</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">               name = #</span><span class="template-variable">&#123;name&#125;</span><span class="language-xml">,</span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;room != null and room != &#x27;&#x27;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">               room = #</span><span class="template-variable">&#123;room&#125;</span><span class="language-xml">,</span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;beginDate != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">               begin_date = #</span><span class="template-variable">&#123;beginDate&#125;</span><span class="language-xml">,</span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;endDate != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">               end_date = #</span><span class="template-variable">&#123;endDate&#125;</span><span class="language-xml">,</span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;masterId != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">               master_id = #</span><span class="template-variable">&#123;masterId&#125;</span><span class="language-xml">,</span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;subject != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">               subject = #</span><span class="template-variable">&#123;subject&#125;</span><span class="language-xml">,</span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateTime != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">               update_time = #</span><span class="template-variable">&#123;updateTime&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       where id = #</span><span class="template-variable">&#123;id&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="6-åˆ é™¤ç­çº§ä¿¡æ¯">6.åˆ é™¤ç­çº§ä¿¡æ¯</h2><h3 id="6-1éœ€æ±‚">6.1éœ€æ±‚</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-427-1024x491.png" alt="img"></p><p><strong>æ³¨æ„ï¼šåœ¨é¡µé¢åŸå‹ä¸­ï¼Œè¦æ±‚å¦‚æœè¯¥ç­çº§ä¸‹å…³è”çš„æœ‰å­¦ç”Ÿï¼Œæ˜¯ä¸å…è®¸åˆ é™¤çš„ï¼Œå¹¶æç¤ºé”™è¯¯ä¿¡æ¯ï¼šâ€œå¯¹ä¸èµ·, è¯¥ç­çº§ä¸‹æœ‰å­¦ç”Ÿ, ä¸èƒ½ç›´æ¥åˆ é™¤â€ã€‚ (æç¤ºï¼šå¯ä»¥é€šè¿‡è‡ªå®šä¹‰å¼‚å¸¸ + å…¨å±€å¼‚å¸¸å¤„ç†å™¨å®ç°)</strong></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-437-1024x490.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-428-1024x549.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-429-1024x520.png" alt="img"></p><h3 id="6-2ä»£ç å®ç°">6.2ä»£ç å®ç°</h3><p>1ï¼‰åœ¨ <code>ClazzController</code> ä¸­</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®IDåˆ é™¤ç­çº§</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable">@DeleteMapping</span>(<span class="string">&quot;/&#123;id&#125;&quot;</span>)</span><br><span class="line">public Result <span class="built_in">delete</span>(<span class="variable">@PathVariable</span> Integer id)&#123;</span><br><span class="line">    <span class="selector-tag">clazzService</span><span class="selector-class">.deleteById</span>(id);</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">Result</span><span class="selector-class">.success</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2).<code>Clazz</code>Service &amp; <code>Clazz</code>ServiceImpl</p><p>åœ¨ <code>ClazzService</code> ä¸­</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * åˆ é™¤ç­çº§</span></span><br><span class="line"><span class="comment">    * @param id</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="type">void</span> <span class="title">deleteById</span><span class="params">(Integer id)</span></span>;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>Clazz</code>ServiceImpl ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">      <span class="comment">//1. æŸ¥è¯¢ç­çº§ä¸‹æ˜¯å¦æœ‰å­¦å‘˜</span></span><br><span class="line">      <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> studentMapper.countByClazzId(id);</span><br><span class="line">      <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;ç­çº§ä¸‹æœ‰å­¦å‘˜, ä¸èƒ½ç›´æ¥åˆ é™¤~&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//2. å¦‚æœæ²¡æœ‰, å†åˆ é™¤ç­çº§ä¿¡æ¯</span></span><br><span class="line">      clazzMapper.deleteById(id);</span><br></pre></td></tr></table></figure><p>3ï¼‰ClazzMapper ä¸­</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®IDåˆ é™¤ç­çº§</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable">@Delete</span>(<span class="string">&quot;delete from clazz where id = #&#123;id&#125;&quot;</span>)</span><br><span class="line">void <span class="built_in">deleteById</span>(Integer id);</span><br></pre></td></tr></table></figure><h1 id="â€“å­¦å‘˜ç®¡ç†">â€“å­¦å‘˜ç®¡ç†</h1><h2 id="1-æŸ¥è¯¢æ‰€æœ‰ç­çº§">1.æŸ¥è¯¢æ‰€æœ‰ç­çº§</h2><h3 id="1-1éœ€æ±‚-2">1.1éœ€æ±‚</h3><p>åœ¨æ–°å¢å­¦å‘˜çš„æ—¶å€™ï¼Œè¦å±•ç¤ºå‡ºæ‰€æœ‰çš„ç­çº§ä¿¡æ¯ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-430-1024x493.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-431-1024x850.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-432-1024x692.png" alt="img"></p><h3 id="1-2ä»£ç å®ç°-2">1.2ä»£ç å®ç°</h3><p>1ï¼‰åœ¨ <code>ClazzController</code> ä¸­</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æŸ¥è¯¢å…¨éƒ¨ç­çº§</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@GetMapping</span>(<span class="string">&quot;/list&quot;</span>)</span><br><span class="line">  <span class="keyword">public</span> <span class="function">Result <span class="title">findAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">      List&lt;Clazz&gt; clazzList = clazzService.findAll();</span><br><span class="line">      <span class="function"><span class="keyword">return</span> Result.<span class="title">success</span><span class="params">(clazzList)</span></span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>2).<code>Clazz</code>Service &amp; <code>Clazz</code>ServiceImpl</p><p>åœ¨ <code>ClazzService</code> ä¸­</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æŸ¥è¯¢å…¨éƒ¨ç­çº§</span></span><br><span class="line"><span class="comment">    * @return</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function">List&lt;Clazz&gt; <span class="title">findAll</span>()</span>;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>Clazz</code>ServiceImpl ä¸­</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> <span class="title class_">List</span>&lt;<span class="title class_">Clazz</span>&gt; <span class="title function_">findAll</span>(<span class="params"></span>) &#123;</span><br><span class="line">     <span class="keyword">return</span> clazzMapper.<span class="title function_">findAll</span>();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>3ï¼‰ClazzMapper ä¸­</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢å…¨éƒ¨ç­çº§</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable">@Select</span>(<span class="string">&quot;select * from clazz&quot;</span>)</span><br><span class="line">List&lt;Clazz&gt; <span class="built_in">findAll</span>();</span><br></pre></td></tr></table></figure><h2 id="2-æ¡ä»¶åˆ†é¡µæŸ¥è¯¢">2.æ¡ä»¶åˆ†é¡µæŸ¥è¯¢</h2><h3 id="2-1éœ€æ±‚-3">2.1éœ€æ±‚</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-433-1024x495.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-434-1024x744.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-435-1024x912.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-436-1024x854.png" alt="img"></p><h3 id="2-2ä»£ç å®ç°-2">2.2ä»£ç å®ç°</h3><p>1ï¼‰åœ¨ Student<code>Controller</code> ä¸­</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">Result</span> <span class="title function_">page</span>(<span class="params"><span class="title class_">String</span> name ,</span></span><br><span class="line"><span class="params">                   <span class="title class_">Integer</span> degree,</span></span><br><span class="line"><span class="params">                   <span class="title class_">Integer</span> clazzId,</span></span><br><span class="line"><span class="params">                   <span class="meta">@RequestParam</span>(defaultValue = <span class="string">&quot;1&quot;</span>) <span class="title class_">Integer</span> page ,</span></span><br><span class="line"><span class="params">                   <span class="meta">@RequestParam</span>(defaultValue = <span class="string">&quot;10&quot;</span>) <span class="title class_">Integer</span> pageSize</span>)&#123;</span><br><span class="line">    <span class="title class_">PageResult</span> pageResult = studentService.<span class="title function_">page</span>(name,degree,clazzId,page,pageSize);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Result</span>.<span class="title function_">success</span>(pageResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2).StudentService &amp; StudentServiceImpl</p><p>åœ¨ <code>StudentService</code> ä¸­</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¡ä»¶åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">PageResult page(<span class="built_in">String</span> name, <span class="built_in">Integer</span> degree, <span class="built_in">Integer</span> clazzId, <span class="built_in">Integer</span> page, <span class="built_in">Integer</span> pageSize);</span><br></pre></td></tr></table></figure><p>åœ¨StudentServiceImpl ä¸­</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line"><span class="built_in">public</span> PageResult page(String <span class="type">name</span>, <span class="type">Integer</span> degree, <span class="type">Integer</span> clazzId, <span class="type">Integer</span> page, <span class="type">Integer</span> pageSize) &#123;</span><br><span class="line">    PageHelper.startPage(page, pageSize);</span><br><span class="line"></span><br><span class="line">    List&lt;Student&gt; studentList = studentMapper.list(<span class="type">name</span>,degree,clazzId);</span><br><span class="line">    Page&lt;Student&gt; p = (Page&lt;Student&gt;) studentList;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">new</span> PageResult(p.getTotal(), p.getResult());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ï¼‰StudentMapper ä¸­</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * åŠ¨æ€æ¡ä»¶æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="built_in">List</span>&lt;Student&gt; <span class="built_in">list</span>(<span class="built_in">String</span> name, <span class="built_in">Integer</span> degree, <span class="built_in">Integer</span> clazzId);</span><br></pre></td></tr></table></figure><p>StudentMapper.xml ä¸­</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="comment">&lt;!-- åŠ¨æ€æ¡ä»¶æŸ¥è¯¢ --&gt;</span></span></span><br><span class="line"><span class="language-xml"> <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.Student&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     select s.*, c.name clazzName from student s left join clazz c on s.clazz_id = c.id</span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;<span class="name">where</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">         <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">             s.name like concat(&#x27;%&#x27;,#</span><span class="template-variable">&#123;name&#125;</span><span class="language-xml">,&#x27;%&#x27;)</span></span><br><span class="line"><span class="language-xml">         <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">         <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;degree != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">             and s.degree = #</span><span class="template-variable">&#123;degree&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">         <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">         <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;clazzId != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">             and s.clazz_id = #</span><span class="template-variable">&#123;clazzId&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">         <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     order by s.update_time desc</span></span><br><span class="line"><span class="language-xml"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="3-æ–°å¢å­¦ç”Ÿä¿¡æ¯">3.æ–°å¢å­¦ç”Ÿä¿¡æ¯</h2><h3 id="3-1éœ€æ±‚-2">3.1éœ€æ±‚</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-439-1024x496.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-440-1024x787.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-441-1024x873.png" alt="img"></p><h3 id="3-2ä»£ç å®ç°-2">3.2ä»£ç å®ç°</h3><p>1ï¼‰åœ¨ Student<code>Controller</code> ä¸­</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * æ·»åŠ å­¦ç”Ÿ</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="variable">@PostMapping</span></span><br><span class="line"> public Result <span class="built_in">save</span>(<span class="variable">@RequestBody</span> Student student)&#123;</span><br><span class="line">     <span class="selector-tag">studentService</span><span class="selector-class">.save</span>(student);</span><br><span class="line">     <span class="selector-tag">return</span> <span class="selector-tag">Result</span><span class="selector-class">.success</span>();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>2).StudentService &amp; StudentServiceImpl</p><p>åœ¨ <code>StudentService</code> ä¸­</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ·»åŠ å­¦ç”Ÿä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">save</span><span class="params">(Student student)</span></span>;</span><br></pre></td></tr></table></figure><p>åœ¨ StudentServiceImpl ä¸­</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line"><span class="built_in">public</span> <span class="type">void</span> save(Student student) &#123;</span><br><span class="line">    student.setCreateTime(LocalDateTime.now());</span><br><span class="line">    student.setUpdateTime(LocalDateTime.now());</span><br><span class="line">    studentMapper.<span class="keyword">insert</span>(student);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ï¼‰StudentMapper ä¸­</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ·»åŠ å­¦ç”Ÿ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">@Insert(<span class="string">&quot;insert into student(name, no, gender, phone,id_card, is_college, address, degree, graduation_date,clazz_id, create_time, update_time) VALUES &quot;</span> +</span><br><span class="line">        <span class="string">&quot;(<span class="subst">#&#123;name&#125;</span>,<span class="subst">#&#123;<span class="literal">no</span>&#125;</span>,<span class="subst">#&#123;gender&#125;</span>,<span class="subst">#&#123;phone&#125;</span>,<span class="subst">#&#123;idCard&#125;</span>,<span class="subst">#&#123;isCollege&#125;</span>,<span class="subst">#&#123;address&#125;</span>,<span class="subst">#&#123;degree&#125;</span>,<span class="subst">#&#123;graduationDate&#125;</span>,<span class="subst">#&#123;clazzId&#125;</span>,<span class="subst">#&#123;createTime&#125;</span>,<span class="subst">#&#123;updateTime&#125;</span>)&quot;</span>)</span><br><span class="line"><span class="literal">void</span> insert(Student student);</span><br></pre></td></tr></table></figure><h2 id="4-æ ¹æ®IDæŸ¥è¯¢å­¦ç”Ÿ">4.æ ¹æ®IDæŸ¥è¯¢å­¦ç”Ÿ</h2><h3 id="4-1éœ€æ±‚-2">4.1éœ€æ±‚</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-442-1024x496.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-443-1024x522.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-444-1024x884.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-445-1024x575.png" alt="img"></p><h3 id="4-2ä»£ç å®ç°-2">4.2ä»£ç å®ç°</h3><p>1ï¼‰åœ¨ StudentController ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®IDæŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">getInfo</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> studentService.getInfo(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success(student);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2).StudentService &amp; StudentServiceImpl</p><p>åœ¨ StudentService ä¸­</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®IDæŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Student <span class="built_in">getInfo</span>(Integer id);</span><br></pre></td></tr></table></figure><p>åœ¨ StudentServiceImpl ä¸­</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="function">Student <span class="title">getInfo</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">      <span class="function"><span class="keyword">return</span> studentMapper.<span class="title">getById</span><span class="params">(id)</span></span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>3ï¼‰StudentMapper ä¸­</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®IDæŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable">@Select</span>(<span class="string">&quot;select * from student where id = #&#123;id&#125;&quot;</span>)</span><br><span class="line">Student <span class="built_in">getById</span>(Integer id);</span><br></pre></td></tr></table></figure><h2 id="5-ä¿®æ”¹å­¦ç”Ÿä¿¡æ¯">5.ä¿®æ”¹å­¦ç”Ÿä¿¡æ¯</h2><h3 id="5-1éœ€æ±‚-3">5.1éœ€æ±‚</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-446-1024x491.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-447-1024x886.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-448-1024x448.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-449-1024x527.png" alt="img"></p><h3 id="5-2ä»£ç å®ç°-2">5.2ä»£ç å®ç°</h3><p>1ï¼‰åœ¨ StudentController ä¸­</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¿®æ”¹å­¦ç”Ÿä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable">@PutMapping</span></span><br><span class="line">public Result <span class="built_in">update</span>(<span class="variable">@RequestBody</span> Student student)&#123;</span><br><span class="line">    <span class="selector-tag">studentService</span><span class="selector-class">.update</span>(student);</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">Result</span><span class="selector-class">.success</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2).StudentService &amp; StudentServiceImpl</p><p>åœ¨ StudentService ä¸­</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * ä¿®æ”¹å­¦ç”Ÿä¿¡æ¯</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(Student student)</span></span>;</span><br></pre></td></tr></table></figure><p>åœ¨ StudentServiceImpl ä¸­</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line"> <span class="built_in">public</span> <span class="type">void</span> <span class="keyword">update</span>(Student student) &#123;</span><br><span class="line">     student.setUpdateTime(LocalDateTime.now());</span><br><span class="line">     studentMapper.<span class="keyword">update</span>(student);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>3ï¼‰StudentMapper ä¸­</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¿®æ”¹å­¦ç”Ÿä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(Student student)</span></span>;</span><br></pre></td></tr></table></figure><p>StudentMapper.xml ä¸­</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="comment">&lt;!-- ä¿®æ”¹å­¦ç”Ÿä¿¡æ¯ --&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       update student</span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;<span class="name">set</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">               name = #</span><span class="template-variable">&#123;name&#125;</span><span class="language-xml">,</span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;no != null and no != &#x27;&#x27;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">               no = #</span><span class="template-variable">&#123;no&#125;</span><span class="language-xml">,</span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">               gender = #</span><span class="template-variable">&#123;gender&#125;</span><span class="language-xml">,</span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;phone != null and phone != &#x27;&#x27;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">               phone = #</span><span class="template-variable">&#123;phone&#125;</span><span class="language-xml">,</span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;idCard != null and idCard != &#x27;&#x27;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">               id_card = #</span><span class="template-variable">&#123;idCard&#125;</span><span class="language-xml">,</span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;isCollege != null and isCollege != &#x27;&#x27;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">               is_college = #</span><span class="template-variable">&#123;isCollege&#125;</span><span class="language-xml">,</span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;address != null and address != &#x27;&#x27;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">               address = #</span><span class="template-variable">&#123;address&#125;</span><span class="language-xml">,</span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;graduationDate != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">               graduation_date = #</span><span class="template-variable">&#123;graduationDate&#125;</span><span class="language-xml">,</span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;degree != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">               degree = #</span><span class="template-variable">&#123;degree&#125;</span><span class="language-xml">,</span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;violationCount != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">               violation_count = #</span><span class="template-variable">&#123;violationCount&#125;</span><span class="language-xml">,</span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;violationScore != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">               violation_score = #</span><span class="template-variable">&#123;violationScore&#125;</span><span class="language-xml">,</span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;clazzId != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">               clazz_id = #</span><span class="template-variable">&#123;clazzId&#125;</span><span class="language-xml">,</span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateTime != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">               update_time = #</span><span class="template-variable">&#123;updateTime&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       where id = #</span><span class="template-variable">&#123;id&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="6-åˆ é™¤å­¦ç”Ÿä¿¡æ¯">6.åˆ é™¤å­¦ç”Ÿä¿¡æ¯</h2><h3 id="6-1éœ€æ±‚-2">6.1éœ€æ±‚</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-450-1024x494.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-451-1024x546.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-452-1024x506.png" alt="img"></p><h3 id="6-2ä»£ç å®ç°-2">6.2ä»£ç å®ç°</h3><p>1ï¼‰åœ¨ StudentController ä¸­</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ é™¤å­¦ç”Ÿä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable">@DeleteMapping</span>(<span class="string">&quot;/&#123;ids&#125;&quot;</span>)</span><br><span class="line">public Result <span class="built_in">delete</span>(<span class="variable">@PathVariable</span> List&lt;Integer&gt; ids)&#123;</span><br><span class="line">    <span class="selector-tag">studentService</span><span class="selector-class">.delete</span>(ids);</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">Result</span><span class="selector-class">.success</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2).StudentService &amp; StudentServiceImpl</p><p>åœ¨ StudentService ä¸­</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤å­¦ç”Ÿä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">void</span> <span class="keyword">delete</span>(List&lt;<span class="type">Integer</span>&gt; ids);</span><br></pre></td></tr></table></figure><p>åœ¨ StudentServiceImpl ä¸­</p><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="keyword">delete</span>(List&lt;Integer&gt; ids) &#123;</span><br><span class="line">    studentMapper.<span class="keyword">delete</span>(ids);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ï¼‰StudentMapper ä¸­</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‰¹é‡åˆ é™¤å­¦ç”Ÿä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="keyword">delete</span>(List&lt;<span class="type">Integer</span>&gt; ids);</span><br></pre></td></tr></table></figure><p>StudentMapper.xml ä¸­</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="comment">&lt;!--æ‰¹é‡åˆ é™¤å­¦ç”Ÿä¿¡æ¯--&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;delete&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       delete from student where id in</span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           #</span><span class="template-variable">&#123;id&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="7-è¿çºªå¤„ç†">7.<strong>è¿çºªå¤„ç†</strong></h2><h3 id="7-1éœ€æ±‚">7.1éœ€æ±‚</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-453-1024x495.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-454-1024x499.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-455-1024x502.png" alt="img"></p><h3 id="7-2ä»£ç å®ç°">7.2ä»£ç å®ç°</h3><p>1ï¼‰åœ¨ StudentController ä¸­</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿çºªå¤„ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable">@PutMapping</span>(<span class="string">&quot;/violation/&#123;id&#125;/&#123;score&#125;&quot;</span>)</span><br><span class="line">public Result <span class="built_in">violationHandle</span>(<span class="variable">@PathVariable</span> Integer id , <span class="variable">@PathVariable</span> Integer score)&#123;</span><br><span class="line">    <span class="selector-tag">studentService</span><span class="selector-class">.violationHandle</span>(id, score);</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">Result</span><span class="selector-class">.success</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2).StudentService &amp; StudentServiceImpl</p><p>åœ¨ StudentService ä¸­</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * è¿çºªå¤„ç†</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="literal">void</span> violationHandle(<span class="built_in">Integer</span> id, <span class="built_in">Integer</span> score);</span><br></pre></td></tr></table></figure><p>åœ¨ StudentServiceImpl ä¸­</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">violationHandle</span>(<span class="params"><span class="title class_">Integer</span> id, <span class="title class_">Integer</span> score</span>) &#123;</span><br><span class="line">    studentMapper.<span class="title function_">updateViolation</span>(id, score);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ï¼‰StudentMapper ä¸­</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿çºªå¤„ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">@Update(<span class="string">&quot;update student set violation_count = violation_count + 1 , violation_score = violation_score + <span class="subst">#&#123;score&#125;</span> , update_time = now() where id = <span class="subst">#&#123;id&#125;</span>&quot;</span>)</span><br><span class="line"><span class="literal">void</span> updateViolation(Integer id, Integer score);</span><br></pre></td></tr></table></figure><h2 id="8-å­¦å‘˜ä¿¡æ¯ç»Ÿè®¡">8.å­¦å‘˜ä¿¡æ¯ç»Ÿè®¡</h2><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-457-1024x482.png" alt="img"></p><h3 id="8-1ç­çº§äººæ•°ç»Ÿè®¡æ¥å£å¼€å‘">8.1ç­çº§äººæ•°ç»Ÿè®¡æ¥å£å¼€å‘</h3><h4 id="8-1-1éœ€æ±‚">8.1.1éœ€æ±‚</h4><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-458-1024x739.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-459-1024x291.png" alt="img"></p><h4 id="8-1-2ä»£ç å®ç°">8.1.2ä»£ç å®ç°</h4><p>1ï¼‰åœ¨ ReportController ä¸­</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç­çº§äººæ•°ç»Ÿè®¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">&quot;/studentCountData&quot;</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="function">Result <span class="title">getStudentCountData</span><span class="params">()</span></span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;ç­çº§äººæ•°ç»Ÿè®¡&quot;</span>);</span><br><span class="line">    ClazzCountOption clazzCountOption = reportService.getStudentCountData();</span><br><span class="line">    <span class="function"><span class="keyword">return</span> Result.<span class="title">success</span><span class="params">(clazzCountOption)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2). ReportService &amp; ReportServiceImpl</p><p>åœ¨ ReportService ä¸­</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * ç»Ÿè®¡ç­çº§äººæ•°</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="function">ClazzCountOption <span class="title">getStudentCountData</span>()</span>;</span><br></pre></td></tr></table></figure><p>åœ¨  ReportServiceImpl ä¸­</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">    public ClazzCountOption getStudentCountData() &#123;</span><br><span class="line">        List&lt;<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">Object</span>&gt;&gt; countList = studentMapper.getStudentCount();</span><br><span class="line">        <span class="keyword">if</span>(!CollectionUtils.isEmpty(countList))&#123;</span><br><span class="line">            List&lt;<span class="built_in">Object</span>&gt; clazzList = countList.stream().<span class="keyword">map</span>(<span class="keyword">map</span> -&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">map</span>.get(<span class="string">&quot;cname&quot;</span>);</span><br><span class="line">            &#125;).toList();</span><br><span class="line"></span><br><span class="line">            List&lt;<span class="built_in">Object</span>&gt; dataList = countList.stream().<span class="keyword">map</span>(<span class="keyword">map</span> -&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">map</span>.get(<span class="string">&quot;scount&quot;</span>);</span><br><span class="line">            &#125;).toList();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ClazzCountOption(clazzList, dataList);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åœ¨StudentMapperä¸­</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»Ÿè®¡ç­çº§äººæ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">@Select(<span class="string">&quot;select c.name cname , count(s.id) scount from clazz c  left join student s on s.clazz_id = c.id group by c.name order by count(s.id) desc &quot;</span>)</span><br><span class="line">List&lt;<span class="built_in">Map</span>&lt;<span class="built_in">String</span>,<span class="built_in">Object</span>&gt;&gt; getStudentCount();</span><br></pre></td></tr></table></figure><h3 id="8-2å­¦å‘˜å­¦å†ä¿¡æ¯ç»Ÿè®¡æ¥å£å¼€å‘">8.2å­¦å‘˜å­¦å†ä¿¡æ¯ç»Ÿè®¡æ¥å£å¼€å‘</h3><h4 id="8-2-1éœ€æ±‚-2">8.2.1éœ€æ±‚</h4><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-460-1024x768.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-461-1024x735.png" alt="img"></p><h4 id="8-2-2ä»£ç å®ç°-2">8.2.2ä»£ç å®ç°</h4><p>1ï¼‰åœ¨ ReportController ä¸­</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»Ÿè®¡å­¦å‘˜çš„å­¦å†ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">&quot;/studentDegreeData&quot;</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="title class_">Result</span> <span class="title function_">getStudentDegreeData</span>(<span class="params"></span>)&#123;</span><br><span class="line">    log.<span class="title function_">info</span>(<span class="string">&quot;ç»Ÿè®¡å­¦å‘˜çš„å­¦å†ä¿¡æ¯&quot;</span>);</span><br><span class="line">    <span class="title class_">List</span>&lt;<span class="title class_">Map</span>&gt; dataList = reportService.<span class="title function_">getStudentDegreeData</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Result</span>.<span class="title function_">success</span>(dataList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2). ReportService &amp; ReportServiceImpl</p><p>åœ¨ ReportService ä¸­</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ç»Ÿè®¡å­¦å†äººæ•°</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function">List&lt;Map&gt; <span class="title">getStudentDegreeData</span>()</span>;</span><br></pre></td></tr></table></figure><p>åœ¨  ReportServiceImpl ä¸­</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="title class_">List</span>&lt;<span class="title class_">Map</span>&gt; <span class="title function_">getStudentDegreeData</span>(<span class="params"></span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> studentMapper.<span class="title function_">countStudentDegreeData</span>();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>3ï¼‰StudentMapper ä¸­</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * ç»Ÿè®¡å­¦å‘˜å­¦å†</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="variable">@MapKey</span>(<span class="string">&quot;name&quot;</span>)</span><br><span class="line"> List&lt;Map&gt; <span class="built_in">countStudentDegreeData</span>();</span><br></pre></td></tr></table></figure><p>StudentMapper.xml ä¸­</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="comment">--å­¦å‘˜å­¦å†ç»Ÿè®¡--&gt;</span></span><br><span class="line">&lt;<span class="keyword">select</span> id=&quot;countStudentDegreeData&quot; resultType=&quot;java.util.Map&quot;&gt;</span><br><span class="line">    <span class="keyword">select</span></span><br><span class="line">        (<span class="keyword">case</span> degree</span><br><span class="line">            <span class="keyword">when</span> <span class="number">1</span> <span class="keyword">then</span> <span class="string">&#x27;åˆä¸­&#x27;</span></span><br><span class="line">            <span class="keyword">when</span> <span class="number">2</span> <span class="keyword">then</span> <span class="string">&#x27;é«˜ä¸­&#x27;</span></span><br><span class="line">            <span class="keyword">when</span> <span class="number">3</span> <span class="keyword">then</span> <span class="string">&#x27;å¤§ä¸“&#x27;</span></span><br><span class="line">            <span class="keyword">when</span> <span class="number">4</span> <span class="keyword">then</span> <span class="string">&#x27;æœ¬ç§‘&#x27;</span></span><br><span class="line">            <span class="keyword">when</span> <span class="number">5</span> <span class="keyword">then</span> <span class="string">&#x27;ç¡•å£«&#x27;</span></span><br><span class="line">            <span class="keyword">when</span> <span class="number">6</span> <span class="keyword">then</span> <span class="string">&#x27;åšå£«&#x27;</span></span><br><span class="line">            <span class="keyword">else</span> <span class="string">&#x27;å…¶ä»–&#x27;</span> <span class="keyword">end</span>)  <span class="type">name</span>,</span><br><span class="line">        count(*) <span class="keyword">value</span></span><br><span class="line">    <span class="keyword">from</span> student <span class="keyword">group</span> <span class="keyword">by</span> degree</span><br><span class="line">    <span class="keyword">order</span> <span class="keyword">by</span> degree</span><br><span class="line">&lt;/<span class="keyword">select</span>&gt;</span><br></pre></td></tr></table></figure><h2 id="9-åˆ é™¤éƒ¨é—¨å®Œå–„">9.<strong>åˆ é™¤éƒ¨é—¨å®Œå–„</strong></h2><h3 id="9-1éœ€æ±‚">9.1éœ€æ±‚</h3><p>å¦‚æœéƒ¨é—¨ä¸‹æœ‰å‘˜å·¥ï¼Œåˆ™ä¸å…è®¸åˆ é™¤è¯¥éƒ¨é—¨ï¼Œå¹¶ç»™å‰ç«¯æç¤ºé”™è¯¯ä¿¡æ¯ï¼šå¯¹ä¸èµ·ï¼Œå½“å‰éƒ¨é—¨ä¸‹æœ‰å‘˜å·¥ï¼Œä¸èƒ½ç›´æ¥åˆ é™¤ï¼</p><h3 id="9-2ä»£ç å®ç°">9.2ä»£ç å®ç°</h3><p>1ï¼‰åœ¨ DeptController ä¸­</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * åˆ é™¤éƒ¨é—¨ - çœç•¥@RequestParam (å‰ç«¯ä¼ é€’çš„è¯·æ±‚å‚æ•°åä¸æœåŠ¡ç«¯æ–¹æ³•å½¢å‚åä¸€è‡´) [æ¨è]</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> @DeleteMapping</span><br><span class="line"> <span class="built_in">public</span> Result <span class="keyword">delete</span>(<span class="type">Integer</span> id)&#123;</span><br><span class="line">     //<span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;æ ¹æ®IDåˆ é™¤éƒ¨é—¨: &quot; + id);</span><br><span class="line">     <span class="keyword">log</span>.<span class="keyword">info</span>(&quot;æ ¹æ®IDåˆ é™¤éƒ¨é—¨: &#123;&#125;&quot;, id);</span><br><span class="line">     deptService.deleteById(id);</span><br><span class="line">     <span class="keyword">return</span> Result.success();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>2). DeptService &amp; DeptServiceImpl</p><p>åœ¨  DeptService ä¸­</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®IDåˆ é™¤éƒ¨é—¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">deleteById</span><span class="params">(Integer id)</span></span>;</span><br></pre></td></tr></table></figure><p>åœ¨  DeptServiceImpl ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">    <span class="comment">//1. åˆ¤æ–­éƒ¨é—¨ä¸‹æ˜¯å¦æœ‰å‘˜å·¥ï¼Œ å¦‚æœæœ‰ï¼Œ éœ€è¦æç¤ºé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> empMapper.countByDeptId(id);</span><br><span class="line">    <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;éƒ¨é—¨ä¸‹æœ‰å‘˜å·¥ï¼Œ ä¸èƒ½åˆ é™¤&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. åˆ é™¤éƒ¨é—¨</span></span><br><span class="line">    deptMapper.deleteById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ï¼‰ DeptMapper ä¸­</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®IDåˆ é™¤éƒ¨é—¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable">@Delete</span>(<span class="string">&quot;delete from dept where id = #&#123;id&#125;&quot;</span>)</span><br><span class="line">void <span class="built_in">deleteById</span>(Integer id);</span><br></pre></td></tr></table></figure><h1 id="â€“ç™»å½•è®¤è¯">â€“ç™»å½•è®¤è¯</h1><h2 id="1-ç™»å½•åŠŸèƒ½">1.ç™»å½•åŠŸèƒ½</h2><h3 id="1-1éœ€æ±‚-3">1.1éœ€æ±‚</h3><p>åœ¨ç™»å½•ç•Œé¢ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¾“å…¥ç”¨æˆ·çš„ç”¨æˆ·åä»¥åŠå¯†ç ï¼Œç„¶åç‚¹å‡» â€œç™»å½•â€ æŒ‰é’®å°±è¦è¯·æ±‚æœåŠ¡å™¨ï¼ŒæœåŠ¡ç«¯åˆ¤æ–­ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åæˆ–è€…å¯†ç æ˜¯å¦æ­£ç¡®ã€‚å¦‚æœæ­£ç¡®ï¼Œåˆ™è¿”å›æˆåŠŸç»“æœï¼Œå‰ç«¯è·³è½¬è‡³ç³»ç»Ÿé¦–é¡µé¢ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-462-1024x648.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-463-1024x833.png" alt="img"></p><h3 id="1-2å®ç°æ€è·¯">1.2å®ç°æ€è·¯</h3><ul><li>æ€ä¹ˆæ ·æ‰ç®—ç™»å½•æˆåŠŸäº†å‘¢ï¼Ÿ<ul><li>ç”¨æˆ·åå’Œå¯†ç éƒ½è¾“å…¥æ­£ç¡®ï¼Œç™»å½•æˆåŠŸ</li><li>å¦åˆ™ï¼Œç™»å½•å¤±è´¥</li></ul></li><li>ç™»å½•åŠŸèƒ½çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ<ul><li>æŸ¥è¯¢</li><li>æ ¹æ®ç”¨æˆ·åå’Œå¯†ç æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯</li></ul></li></ul><h3 id="1-3ä»£ç å®ç°">1.3ä»£ç å®ç°</h3><p><strong>1). å‡†å¤‡å®ä½“ç±» <code>LoginInfo</code>ï¼Œ å°è£…ç™»å½•æˆåŠŸåï¼Œ è¿”å›ç»™å‰ç«¯çš„æ•°æ® ã€‚</strong></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç™»å½•æˆåŠŸç»“æœå°è£…ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable">@Data</span></span><br><span class="line"><span class="variable">@NoArgsConstructor</span></span><br><span class="line"><span class="variable">@AllArgsConstructor</span></span><br><span class="line">public class LoginInfo &#123;</span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">Integer</span> <span class="selector-tag">id</span>; <span class="comment">//å‘˜å·¥ID</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">String</span> <span class="selector-tag">username</span>; <span class="comment">//ç”¨æˆ·å</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">String</span> <span class="selector-tag">name</span>; <span class="comment">//å§“å</span></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">String</span> <span class="selector-tag">token</span>; <span class="comment">//ä»¤ç‰Œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2). å®šä¹‰<code>LoginController</code></strong></p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmpService empService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(<span class="string">&quot;/login&quot;</span>)</span></span><br><span class="line">    <span class="keyword">public</span> Result login(<span class="meta">@RequestBody</span> Emp emp)&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å‘˜å·¥æ¥ç™»å½•å•¦ , &#123;&#125;&quot;</span>, emp);</span><br><span class="line">        LoginInfo loginInfo = empService.login(emp);</span><br><span class="line">        <span class="keyword">if</span>(loginInfo != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.success(loginInfo);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>**3).****<code>EmpService</code>**<strong>æ¥å£ä¸­å¢åŠ  login ç™»å½•æ–¹æ³•</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç™»å½•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">LoginInfo <span class="built_in">login</span>(Emp emp);</span><br></pre></td></tr></table></figure><p><strong>4).</strong> <strong><code>EmpServiceImpl</code></strong> <strong>å®ç°loginæ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> LoginInfo <span class="title function_">login</span><span class="params">(Emp emp)</span> &#123;</span><br><span class="line">    <span class="type">Emp</span> <span class="variable">empLogin</span> <span class="operator">=</span> empMapper.getUsernameAndPassword(emp);</span><br><span class="line">    <span class="keyword">if</span>(empLogin != <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="type">LoginInfo</span> <span class="variable">loginInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LoginInfo</span>(empLogin.getId(), empLogin.getUsername(), empLogin.getName(), <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">return</span> loginInfo;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>5).</strong> **<code>EmpMapper</code>**<strong>å¢åŠ æ¥å£æ–¹æ³•</strong></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®ç”¨æˆ·åå’Œå¯†ç æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable">@Select</span>(<span class="string">&quot;select * from emp where username = #&#123;username&#125; and password = #&#123;password&#125;&quot;</span>)</span><br><span class="line">Emp <span class="built_in">getUsernameAndPassword</span>(Emp emp);</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å½“æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­æ–°çš„é¡µé¢ä¸Šè¾“å…¥åœ°å€ï¼š<code>http://localhost:90</code>ï¼Œå‘ç°æ²¡æœ‰ç™»å½•ä»ç„¶å¯ä»¥è¿›å…¥åˆ°åç«¯ç®¡ç†ç³»ç»Ÿé¡µé¢ã€‚</p><p>è€ŒçœŸæ­£çš„ç™»å½•åŠŸèƒ½åº”è¯¥æ˜¯ï¼šç™»é™†åæ‰èƒ½è®¿é—®åç«¯ç³»ç»Ÿé¡µé¢ï¼Œä¸ç™»é™†åˆ™è·³è½¬ç™»é™†é¡µé¢è¿›è¡Œç™»é™†ã€‚</p><p>ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Ÿå…¶å®åŸå› å¾ˆç®€å•ï¼Œå°±æ˜¯å› ä¸ºé’ˆå¯¹äºæˆ‘ä»¬å½“å‰æ‰€å¼€å‘çš„éƒ¨é—¨ç®¡ç†ã€å‘˜å·¥ç®¡ç†ä»¥åŠæ–‡ä»¶ä¸Šä¼ ç­‰ç›¸å…³æ¥å£æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨æœåŠ¡å™¨ç«¯å¹¶æ²¡æœ‰åšä»»ä½•çš„åˆ¤æ–­ï¼Œæ²¡æœ‰å»åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•äº†ã€‚æ‰€ä»¥æ— è®ºç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œéƒ½å¯ä»¥è®¿é—®éƒ¨é—¨ç®¡ç†ä»¥åŠå‘˜å·¥ç®¡ç†çš„ç›¸å…³æ•°æ®ã€‚æ‰€ä»¥æˆ‘ä»¬ç›®å‰æ‰€å¼€å‘çš„ç™»å½•åŠŸèƒ½ï¼Œå®ƒåªæ˜¯å¾’æœ‰å…¶è¡¨ã€‚è€Œæˆ‘ä»¬è¦æƒ³è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±éœ€è¦å®Œæˆä¸€æ­¥éå¸¸é‡è¦çš„æ“ä½œï¼šç™»å½•æ ¡éªŒã€‚</p><h2 id="2-ç™»å½•æ•ˆéªŒ">2.ç™»å½•æ•ˆéªŒ</h2><p>ä»€ä¹ˆæ˜¯ç™»å½•æ ¡éªŒï¼Ÿ</p><p>æ‰€è°“ç™»å½•æ ¡éªŒï¼ŒæŒ‡çš„æ˜¯æˆ‘ä»¬åœ¨æœåŠ¡å™¨ç«¯æ¥æ”¶åˆ°æµè§ˆå™¨å‘é€è¿‡æ¥çš„è¯·æ±‚ä¹‹åï¼Œé¦–å…ˆæˆ‘ä»¬è¦å¯¹è¯·æ±‚è¿›è¡Œæ ¡éªŒã€‚å…ˆè¦æ ¡éªŒä¸€ä¸‹ç”¨æˆ·ç™»å½•äº†æ²¡æœ‰ï¼Œå¦‚æœç”¨æˆ·å·²ç»ç™»å½•äº†ï¼Œå°±ç›´æ¥æ‰§è¡Œå¯¹åº”çš„ä¸šåŠ¡æ“ä½œå°±å¯ä»¥äº†ï¼›å¦‚æœç”¨æˆ·æ²¡æœ‰ç™»å½•ï¼Œæ­¤æ—¶å°±ä¸å…è®¸ä»–æ‰§è¡Œç›¸å…³çš„ä¸šåŠ¡æ“ä½œï¼Œç›´æ¥ç»™å‰ç«¯å“åº”ä¸€ä¸ªé”™è¯¯çš„ç»“æœï¼Œæœ€ç»ˆè·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œè¦æ±‚ä»–ç™»å½•æˆåŠŸä¹‹åï¼Œå†æ¥è®¿é—®å¯¹åº”çš„æ•°æ®ã€‚</p><p>è¯¥æ€ä¹ˆæ¥å®ç°ç™»å½•æ ¡éªŒçš„æ“ä½œå‘¢ï¼Ÿå…·ä½“çš„å®ç°æ€è·¯å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p><ol><li>åœ¨å‘˜å·¥ç™»å½•æˆåŠŸåï¼Œéœ€è¦å°†ç”¨æˆ·ç™»å½•æˆåŠŸçš„ä¿¡æ¯å­˜èµ·æ¥ï¼Œè®°å½•ç”¨æˆ·å·²ç»ç™»å½•æˆåŠŸçš„æ ‡è®°ã€‚</li><li>åœ¨æµè§ˆå™¨å‘èµ·è¯·æ±‚æ—¶ï¼Œéœ€è¦åœ¨æœåŠ¡ç«¯è¿›è¡Œç»Ÿä¸€æ‹¦æˆªï¼Œæ‹¦æˆªåè¿›è¡Œç™»å½•æ ¡éªŒã€‚</li></ol><p>æƒ³è¦åˆ¤æ–­å‘˜å·¥æ˜¯å¦å·²ç»ç™»å½•ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å‘˜å·¥ç™»å½•æˆåŠŸä¹‹åï¼Œå­˜å‚¨ä¸€ä¸ªç™»å½•æˆåŠŸçš„æ ‡è®°ï¼Œæ¥ä¸‹æ¥åœ¨æ¯ä¸€ä¸ªæ¥å£æ–¹æ³•æ‰§è¡Œä¹‹å‰ï¼Œå…ˆåšä¸€ä¸ªæ¡ä»¶åˆ¤æ–­ï¼Œåˆ¤æ–­ä¸€ä¸‹è¿™ä¸ªå‘˜å·¥åˆ°åº•ç™»å½•äº†æ²¡æœ‰ã€‚å¦‚æœæ˜¯ç™»å½•äº†ï¼Œå°±å¯ä»¥æ‰§è¡Œæ­£å¸¸çš„ä¸šåŠ¡æ“ä½œï¼Œå¦‚æœæ²¡æœ‰ç™»å½•ï¼Œä¼šç›´æ¥ç»™å‰ç«¯è¿”å›ä¸€ä¸ªé”™è¯¯çš„ä¿¡æ¯ï¼Œå‰ç«¯æ‹¿åˆ°è¿™ä¸ªé”™è¯¯ä¿¡æ¯ä¹‹åä¼šè‡ªåŠ¨çš„è·³è½¬åˆ°ç™»å½•é¡µé¢ã€‚</p><p>æˆ‘ä»¬ç¨‹åºä¸­æ‰€å¼€å‘çš„æŸ¥è¯¢åŠŸèƒ½ã€åˆ é™¤åŠŸèƒ½ã€æ·»åŠ åŠŸèƒ½ã€ä¿®æ”¹åŠŸèƒ½ï¼Œéƒ½éœ€è¦ä½¿ç”¨ä»¥ä¸Šå¥—è·¯è¿›è¡Œç™»å½•æ ¡éªŒã€‚ä¸ºäº†ç®€åŒ–è¿™å—æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ç§æŠ€æœ¯ï¼šç»Ÿä¸€æ‹¦æˆªæŠ€æœ¯ã€‚</p><p>é€šè¿‡ç»Ÿä¸€æ‹¦æˆªçš„æŠ€æœ¯ï¼Œæˆ‘ä»¬å¯ä»¥æ¥æ‹¦æˆªæµè§ˆå™¨å‘é€è¿‡æ¥çš„æ‰€æœ‰çš„è¯·æ±‚ï¼Œæ‹¦æˆªåˆ°è¿™ä¸ªè¯·æ±‚ä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡è¯·æ±‚æ¥è·å–ä¹‹å‰æ‰€å­˜å…¥çš„ç™»å½•æ ‡è®°ï¼Œåœ¨è·å–åˆ°ç™»å½•æ ‡è®°ä¸”æ ‡è®°ä¸ºç™»å½•æˆåŠŸï¼Œå°±è¯´æ˜å‘˜å·¥å·²ç»ç™»å½•äº†ã€‚å¦‚æœå·²ç»ç™»å½•ï¼Œæˆ‘ä»¬å°±ç›´æ¥æ”¾è¡Œ(æ„æ€å°±æ˜¯å¯ä»¥è®¿é—®æ­£å¸¸çš„ä¸šåŠ¡æ¥å£äº†)ã€‚</p><p>æˆ‘ä»¬è¦å®Œæˆä»¥ä¸Šæ“ä½œï¼Œä¼šæ¶‰åŠåˆ°webå¼€å‘ä¸­çš„ä¸¤ä¸ªæŠ€æœ¯ï¼š</p><ol><li>ä¼šè¯æŠ€æœ¯ï¼šç”¨æˆ·ç™»å½•æˆåŠŸä¹‹åï¼Œåœ¨åç»­çš„æ¯ä¸€æ¬¡è¯·æ±‚ä¸­ï¼Œéƒ½å¯ä»¥è·å–åˆ°è¯¥æ ‡è®°ã€‚</li><li>ç»Ÿä¸€æ‹¦æˆªæŠ€æœ¯ï¼šè¿‡æ»¤å™¨Filterã€æ‹¦æˆªå™¨Interceptor</li></ol><h3 id="2-1ä¼šè¯æŠ€æœ¯">2.1ä¼šè¯æŠ€æœ¯</h3><h4 id="2-1-1åŸºç¡€çŸ¥è¯†">2.1.1åŸºç¡€çŸ¥è¯†</h4><p><strong>ä»€ä¹ˆæ˜¯ä¼šè¯ï¼Ÿ</strong></p><p>åœ¨webå¼€å‘å½“ä¸­ï¼Œä¼šè¯æŒ‡çš„å°±æ˜¯æµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´çš„ä¸€æ¬¡è¿æ¥ï¼Œæˆ‘ä»¬å°±ç§°ä¸ºä¸€æ¬¡ä¼šè¯ã€‚</p><p>ä¸¾ä¾‹ï¼šåœ¨ç”¨æˆ·æ‰“å¼€æµè§ˆå™¨ç¬¬ä¸€æ¬¡è®¿é—®æœåŠ¡å™¨çš„æ—¶å€™ï¼Œè¿™ä¸ªä¼šè¯å°±å»ºç«‹äº†ï¼Œç›´åˆ°æœ‰ä»»ä½•ä¸€æ–¹æ–­å¼€è¿æ¥ï¼Œæ­¤æ—¶ä¼šè¯å°±ç»“æŸäº†ã€‚åœ¨ä¸€æ¬¡ä¼šè¯å½“ä¸­ï¼Œæ˜¯å¯ä»¥åŒ…å«å¤šæ¬¡è¯·æ±‚å’Œå“åº”çš„ã€‚</p><p>æ¯”å¦‚ï¼šæ‰“å¼€äº†æµè§ˆå™¨æ¥è®¿é—®webæœåŠ¡å™¨ä¸Šçš„èµ„æºï¼ˆæµè§ˆå™¨ä¸èƒ½å…³é—­ã€æœåŠ¡å™¨ä¸èƒ½æ–­å¼€ï¼‰</p><ul><li>ç¬¬1æ¬¡ï¼šè®¿é—®çš„æ˜¯ç™»å½•çš„æ¥å£ï¼Œå®Œæˆç™»å½•æ“ä½œ</li><li>ç¬¬2æ¬¡ï¼šè®¿é—®çš„æ˜¯éƒ¨é—¨ç®¡ç†æ¥å£ï¼ŒæŸ¥è¯¢æ‰€æœ‰éƒ¨é—¨æ•°æ®</li><li>ç¬¬3æ¬¡ï¼šè®¿é—®çš„æ˜¯å‘˜å·¥ç®¡ç†æ¥å£ï¼ŒæŸ¥è¯¢å‘˜å·¥æ•°æ®</li></ul><p>åªè¦æµè§ˆå™¨å’ŒæœåŠ¡å™¨éƒ½æ²¡æœ‰å…³é—­ï¼Œ<strong>ä»¥ä¸Š3æ¬¡è¯·æ±‚éƒ½å±äºä¸€æ¬¡ä¼šè¯</strong>å½“ä¸­å®Œæˆçš„ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šä¼šè¯æ˜¯å’Œæµè§ˆå™¨å…³è”çš„ï¼Œå½“æœ‰ä¸‰ä¸ªæµè§ˆå™¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å»ºç«‹äº†è¿æ¥æ—¶ï¼Œå°±ä¼šæœ‰ä¸‰ä¸ªä¼šè¯ã€‚åŒä¸€ä¸ªæµè§ˆå™¨åœ¨æœªå…³é—­ä¹‹å‰è¯·æ±‚äº†å¤šæ¬¡æœåŠ¡å™¨ï¼Œè¿™å¤šæ¬¡è¯·æ±‚æ˜¯å±äºåŒä¸€ä¸ªä¼šè¯ã€‚</p><p><strong>ä¼šè¯è·Ÿè¸ªï¼š<strong>ä¸€ç§ç»´æŠ¤æµè§ˆå™¨çŠ¶æ€çš„æ–¹æ³•ï¼ŒæœåŠ¡å™¨</strong>éœ€è¦è¯†åˆ«å¤šæ¬¡è¯·æ±‚æ˜¯å¦æ¥è‡ªäºåŒä¸€æµè§ˆå™¨</strong>ï¼Œä»¥ä¾¿åœ¨åŒä¸€æ¬¡ä¼šè¯çš„å¤šæ¬¡è¯·æ±‚é—´å…±äº«æ•°æ®ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨ä¼šè¯è·Ÿè¸ªæŠ€æœ¯å°±æ˜¯è¦å®Œæˆåœ¨åŒä¸€ä¸ªä¼šè¯ä¸­ï¼Œå¤šä¸ªè¯·æ±‚ä¹‹é—´è¿›è¡Œå…±äº«æ•°æ®ã€‚</p><p><strong>ä¸ºä»€ä¹ˆè¦å…±äº«æ•°æ®å‘¢ï¼Ÿ</strong></p><p>ç”±äº<strong>HTTPæ˜¯æ— çŠ¶æ€åè®®</strong>ï¼Œåœ¨åé¢è¯·æ±‚ä¸­æ€ä¹ˆæ‹¿åˆ°å‰ä¸€æ¬¡è¯·æ±‚ç”Ÿæˆçš„æ•°æ®å‘¢ï¼Ÿæ­¤æ—¶å°±éœ€è¦åœ¨ä¸€æ¬¡ä¼šè¯çš„å¤šæ¬¡è¯·æ±‚ä¹‹é—´è¿›è¡Œæ•°æ®å…±äº«</p><h4 id="2-1-2ä¸‰ç§ä¼šè¯è¿½è¸ªæ–¹æ¡ˆ">2.1.2ä¸‰ç§ä¼šè¯è¿½è¸ªæ–¹æ¡ˆ</h4><p>ä¼šè¯è·Ÿè¸ªæŠ€æœ¯æœ‰ä¸‰ç§ï¼š</p><ol><li>Cookieï¼ˆå®¢æˆ·ç«¯ä¼šè¯è·Ÿè¸ªæŠ€æœ¯ï¼‰ï¼šæ•°æ®å­˜å‚¨åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨å½“ä¸­</li><li>Sessionï¼ˆæœåŠ¡ç«¯ä¼šè¯è·Ÿè¸ªæŠ€æœ¯ï¼‰ï¼šæ•°æ®å­˜å‚¨åœ¨å‚¨åœ¨æœåŠ¡ç«¯</li><li>ä»¤ç‰ŒæŠ€æœ¯</li></ol><h4 id="2-1-3æ–¹æ¡ˆä¸€ï¼šCookie">2.1.3<strong>æ–¹æ¡ˆä¸€</strong>ï¼šCookie</h4><p>cookie æ˜¯å®¢æˆ·ç«¯ä¼šè¯è·Ÿè¸ªæŠ€æœ¯ï¼Œ<strong>å®ƒæ˜¯å­˜å‚¨åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨çš„</strong>ï¼Œæˆ‘ä»¬ä½¿ç”¨ cookie æ¥è·Ÿè¸ªä¼šè¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æµè§ˆå™¨ç¬¬ä¸€æ¬¡å‘èµ·è¯·æ±‚æ¥è¯·æ±‚æœåŠ¡å™¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨æœåŠ¡å™¨ç«¯æ¥è®¾ç½®ä¸€ä¸ªcookieã€‚</p><p>æ¯”å¦‚ç¬¬ä¸€æ¬¡è¯·æ±‚äº†ç™»å½•æ¥å£ï¼Œç™»å½•æ¥å£æ‰§è¡Œå®Œæˆä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¾ç½®ä¸€ä¸ªcookieï¼Œåœ¨ cookie å½“ä¸­æˆ‘ä»¬å°±å¯ä»¥æ¥å­˜å‚¨ç”¨æˆ·ç›¸å…³çš„ä¸€äº›æ•°æ®ä¿¡æ¯ã€‚æ¯”å¦‚æˆ‘å¯ä»¥åœ¨ cookie å½“ä¸­æ¥å­˜å‚¨å½“å‰ç™»å½•ç”¨æˆ·çš„ç”¨æˆ·åï¼Œç”¨æˆ·çš„IDã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-465-1024x255.png" alt="img"></p><ul><li>æœåŠ¡å™¨ä¼š <strong>è‡ªåŠ¨</strong> çš„å°† cookie å“åº”ç»™æµè§ˆå™¨ã€‚</li><li>æµè§ˆå™¨æ¥æ”¶åˆ°å“åº”å›æ¥çš„æ•°æ®ä¹‹åï¼Œä¼š <strong>è‡ªåŠ¨</strong> çš„å°† cookie å­˜å‚¨åœ¨æµè§ˆå™¨æœ¬åœ°ã€‚</li><li>åœ¨åç»­çš„è¯·æ±‚å½“ä¸­ï¼Œæµè§ˆå™¨ä¼š <strong>è‡ªåŠ¨</strong> çš„å°† cookie æºå¸¦åˆ°æœåŠ¡å™¨ç«¯ã€‚</li></ul><p><strong>ä¸ºä»€ä¹ˆè¿™ä¸€åˆ‡éƒ½æ˜¯è‡ªåŠ¨åŒ–è¿›è¡Œçš„ï¼Ÿ</strong></p><p>æ˜¯å› ä¸º cookie å®ƒæ˜¯ HTTP åè®®å½“ä¸­æ‰€æ”¯æŒçš„æŠ€æœ¯ï¼Œè€Œå„å¤§æµè§ˆå™¨å‚å•†éƒ½æ”¯æŒäº†è¿™ä¸€æ ‡å‡†ã€‚åœ¨ HTTP åè®®å®˜æ–¹ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå“åº”å¤´å’Œè¯·æ±‚å¤´ï¼š</p><ul><li>å“åº”å¤´ Set-Cookie ï¼šè®¾ç½®Cookieæ•°æ®çš„</li><li>è¯·æ±‚å¤´ Cookieï¼šæºå¸¦Cookieæ•°æ®çš„</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-475.png" alt="img"></p><p><strong>ä»£ç æµ‹è¯•ï¼š</strong></p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è®¾ç½®Cookie</span></span><br><span class="line">    <span class="meta">@GetMapping(<span class="string">&quot;/c1&quot;</span>)</span></span><br><span class="line">    <span class="keyword">public</span> Result cookie1(HttpServletResponse response)&#123;</span><br><span class="line">        response.addCookie(new Cookie(<span class="string">&quot;login_username&quot;</span>,<span class="string">&quot;itheima&quot;</span>)); <span class="comment">//è®¾ç½®Cookie/å“åº”Cookie</span></span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">//è·å–Cookie</span></span><br><span class="line">    <span class="meta">@GetMapping(<span class="string">&quot;/c2&quot;</span>)</span></span><br><span class="line">    <span class="keyword">public</span> Result cookie2(HttpServletRequest request)&#123;</span><br><span class="line">        Cookie[] cookies = request.getCookies();</span><br><span class="line">        <span class="keyword">for</span> (Cookie cookie : cookies) &#123;</span><br><span class="line">            <span class="keyword">if</span>(cookie.getName().equals(<span class="string">&quot;login_username&quot;</span>))&#123;</span><br><span class="line">                System.<span class="keyword">out</span>.println(<span class="string">&quot;login_username: &quot;</span>+cookie.getValue()); <span class="comment">//è¾“å‡ºnameä¸ºlogin_usernameçš„cookie</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure><p>A. è®¿é—®c1æ¥å£ï¼Œè®¾ç½®Cookieï¼Œ<code>http://localhost:8080/c1</code></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-476-1024x353.png" alt="img"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè®¾ç½®çš„cookieï¼Œé€šè¿‡<strong>å“åº”å¤´Set-Cookie</strong>å“åº”ç»™æµè§ˆå™¨ï¼Œå¹¶ä¸”æµè§ˆå™¨ä¼šå°†Cookieï¼Œå­˜å‚¨åœ¨æµè§ˆå™¨ç«¯ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-477-1024x302.png" alt="img"></p><p>B. è®¿é—®c2æ¥å£ <code>http://localhost:8080/c2</code>ï¼Œæ­¤æ—¶æµè§ˆå™¨ä¼šè‡ªåŠ¨çš„å°†Cookieæºå¸¦åˆ°æœåŠ¡ç«¯ï¼Œæ˜¯é€šè¿‡<strong>è¯·æ±‚å¤´Cookie</strong>ï¼Œæºå¸¦çš„ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-478-1024x302.png" alt="img"></p><p><strong>ä¼˜ç¼ºç‚¹ï¼š</strong></p><ul><li>ä¼˜ç‚¹ï¼šHTTPåè®®ä¸­æ”¯æŒçš„æŠ€æœ¯ï¼ˆåƒSet-Cookie å“åº”å¤´çš„è§£æä»¥åŠ Cookie è¯·æ±‚å¤´æ•°æ®çš„æºå¸¦ï¼Œéƒ½æ˜¯æµè§ˆå™¨è‡ªåŠ¨è¿›è¡Œçš„ï¼Œæ˜¯æ— éœ€æˆ‘ä»¬æ‰‹åŠ¨æ“ä½œçš„ï¼‰</li><li>ç¼ºç‚¹ï¼š<ul><li>ç§»åŠ¨ç«¯APP(Androidã€IOS)ä¸­æ— æ³•ä½¿ç”¨Cookie</li><li>ä¸å®‰å…¨ï¼Œç”¨æˆ·å¯ä»¥è‡ªå·±ç¦ç”¨Cookie</li><li>Cookieä¸èƒ½è·¨åŸŸ</li></ul></li></ul><h4 id="2-1-4å…³äºè·¨åŸŸ">2.1.4å…³äºè·¨åŸŸ</h4><blockquote><p><strong>è·¨åŸŸä»‹ç»ï¼š</strong></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-479.png" alt="img"></p><ul><li>ç°åœ¨çš„é¡¹ç›®ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯å‰åç«¯åˆ†ç¦»çš„ï¼Œå‰åç«¯æœ€ç»ˆä¹Ÿä¼šåˆ†å¼€éƒ¨ç½²ï¼Œå‰ç«¯éƒ¨ç½²åœ¨æœåŠ¡å™¨ 192.168.150.200 ä¸Šï¼Œç«¯å£ 80ï¼Œåç«¯éƒ¨ç½²åœ¨ 192.168.150.100ä¸Šï¼Œç«¯å£ 8080</li><li>æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨ç›´æ¥è®¿é—®å‰ç«¯å·¥ç¨‹ï¼Œè®¿é—®urlï¼š<a href="http://192.168.150.200/login.html">http://192.168.150.200/login.html</a></li><li>ç„¶ååœ¨è¯¥é¡µé¢å‘èµ·è¯·æ±‚åˆ°æœåŠ¡ç«¯ï¼Œè€ŒæœåŠ¡ç«¯æ‰€åœ¨åœ°å€ä¸å†æ˜¯localhostï¼Œè€Œæ˜¯æœåŠ¡å™¨çš„IPåœ°å€192.168.150.100ï¼Œå‡è®¾è®¿é—®æ¥å£åœ°å€ä¸ºï¼š<a href="http://192.168.150.100:8080/login">http://192.168.150.100:8080/login</a></li><li>é‚£æ­¤æ—¶å°±å­˜åœ¨è·¨åŸŸæ“ä½œäº†ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯åœ¨http://192.168.150.200/login.htmlè¿™ä¸ªé¡µé¢ä¸Šè®¿é—®äº†http://192.168.150.100:8080/loginæ¥å£</li><li>æ­¤æ—¶å¦‚æœæœåŠ¡å™¨è®¾ç½®äº†ä¸€ä¸ªCookieï¼Œè¿™ä¸ªCookieæ˜¯ä¸èƒ½ä½¿ç”¨çš„ï¼Œ<strong>å› ä¸ºCookieæ— æ³•è·¨åŸŸ</strong></li></ul><p>åŒºåˆ†è·¨åŸŸçš„ç»´åº¦ï¼ˆä¸‰ä¸ªç»´åº¦æœ‰ä»»ä½•ä¸€ä¸ªç»´åº¦ä¸åŒï¼Œé‚£å°±æ˜¯è·¨åŸŸæ“ä½œï¼‰ï¼š</p><ul><li>åè®®</li><li>IP/åè®®</li><li>ç«¯å£</li></ul><p>ä¸¾ä¾‹ï¼š</p><ul><li><a href="http://192.168.150.200/login.html">http://192.168.150.200/login.html</a> ----------&gt; <a href="https://192.168.150.200/login">https://192.168.150.200/login</a> [åè®®ä¸åŒï¼Œè·¨åŸŸ]</li><li><a href="http://192.168.150.200/login.html">http://192.168.150.200/login.html</a> ----------&gt; <a href="http://192.168.150.100/login">http://192.168.150.100/login</a> [IPä¸åŒï¼Œè·¨åŸŸ]</li><li><a href="http://192.168.150.200/login.html">http://192.168.150.200/login.html</a> ----------&gt; <a href="http://192.168.150.200:8080/login">http://192.168.150.200:8080/login</a> [ç«¯å£ä¸åŒï¼Œè·¨åŸŸ]</li><li><a href="http://192.168.150.200/login.html">http://192.168.150.200/login.html</a> ----------&gt; <a href="http://192.168.150.200/login">http://192.168.150.200/login</a> [ä¸è·¨åŸŸ]</li></ul></blockquote><h4 id="2-1-5æ–¹æ¡ˆäºŒSession">2.1.5æ–¹æ¡ˆäºŒSession</h4><p>å®ƒæ˜¯æœåŠ¡å™¨ç«¯ä¼šè¯è·Ÿè¸ªæŠ€æœ¯ï¼Œæ‰€ä»¥<strong>å®ƒæ˜¯å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯çš„</strong>ã€‚</p><ul><li><p><strong>æœåŠ¡å™¨ç«¯ä¼šè¯è·Ÿè¸ªæŠ€æœ¯</strong>ï¼šæ‰€æœ‰ä¼šè¯æ•°æ®éƒ½ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šï¼Œåªåœ¨å®¢æˆ·ç«¯ï¼æµè§ˆå™¨é‡Œå­˜ä¸€ä¸ªæ ‡è¯†ï¼ˆIDï¼‰ã€‚</p></li><li><p><strong>åŸºäº Cookie å®ç°</strong>ï¼šåº•å±‚é€šè¿‡åœ¨ HTTP å“åº”é‡Œä¸‹å‘ä¸€ä¸ªåä¸º <code>JSESSIONID</code> çš„ Cookieï¼ŒæŠŠ Session çš„ ID æŠŠç»™æµè§ˆå™¨ã€‚</p></li><li><p>åˆ›å»ºå¹¶ä¸‹å‘ Session</p></li></ul><p>ç¬¬ä¸€æ¬¡è¯·æ±‚</p><ul><li>æµè§ˆå™¨å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ã€‚</li><li>æœåŠ¡å™¨æ£€æŸ¥å½“å‰è¯·æ±‚æ˜¯å¦å¸¦æœ‰ Session IDï¼ˆCookieï¼‰ï¼Œå‘ç°æ²¡æœ‰ã€‚</li><li>æ­¤æ—¶æœåŠ¡å™¨è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°çš„ Session å¯¹è±¡ï¼ˆå¦‚å›¾ä¸­æ ‡æ³¨ä¸º Session(1)ï¼‰ï¼Œå¹¶ç»™å®ƒåˆ†é…ä¸€ä¸ªå”¯ä¸€ IDã€‚</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-480-1024x249.png" alt="img"></p><p>å“åº”ä¸­ä¸‹å‘ Cookie</p><ul><li>æœåŠ¡å™¨åœ¨ HTTP å“åº”å¤´ä¸­åŠ ä¸Šï¼š <code>Set-Cookie: JSESSIONID=&lt;session-id&gt;</code></li><li>æµè§ˆå™¨æ”¶åˆ°åï¼Œä¼šæŠŠè¿™ä¸ª <code>JSESSIONID</code> å­˜åˆ°æœ¬åœ°ã€‚</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-481-1024x248.png" alt="img"></p><ul><li>æŸ¥æ‰¾å¹¶å¤ç”¨ Session</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-482-1024x248.png" alt="img"></p><p><strong>æµè§ˆå™¨è‡ªåŠ¨å¸¦ä¸Š Cookie</strong></p><ul><li>ä¹‹åæ¯æ¬¡å‘è¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨éƒ½ä¼šåœ¨å¤´é‡ŒåŠ ä¸Šï¼š</li></ul><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">Cookie:</span> JSESSIONID<span class="operator">=</span><span class="symbol">&lt;session-id&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æœåŠ¡å™¨å–å› Session æ•°æ®</strong></p><ul><li>æœåŠ¡å™¨ä» Cookie é‡Œå–å‡º <code>JSESSIONID</code>ï¼Œæ ¹æ®è¿™ä¸ª ID ä»è‡ªèº«çš„ Session å­˜å‚¨ä¸­æ‰¾åˆ°å¯¹åº”çš„ä¼šè¯å¯¹è±¡ã€‚</li><li>å› æ­¤ï¼Œå¤šä¸ªè¯·æ±‚å°±èƒ½å…±äº«åŒä¸€ä¸ª Session å¯¹è±¡é‡Œçš„æ•°æ®ï¼ˆå¦‚ç”¨æˆ·ç™»å½•çŠ¶æ€ã€ä¸´æ—¶å˜é‡ç­‰ï¼‰ã€‚</li></ul><ol><li></li></ol><p><strong>ä»£ç æµ‹è¯•</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@Slf4j</span><br><span class="line">@RestController</span><br><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> SessionController &#123;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;/s1&quot;)</span><br><span class="line">    <span class="built_in">public</span> Result session1(HttpSession <span class="keyword">session</span>)&#123;</span><br><span class="line">        <span class="keyword">log</span>.<span class="keyword">info</span>(&quot;HttpSession-s1: &#123;&#125;&quot;, <span class="keyword">session</span>.hashCode());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">session</span>.setAttribute(&quot;loginUser&quot;, &quot;tom&quot;); //å¾€<span class="keyword">session</span>ä¸­å­˜å‚¨æ•°æ®</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;/s2&quot;)</span><br><span class="line">    <span class="built_in">public</span> Result session2(HttpServletRequest request)&#123;</span><br><span class="line">        HttpSession <span class="keyword">session</span> = request.getSession();</span><br><span class="line">        <span class="keyword">log</span>.<span class="keyword">info</span>(&quot;HttpSession-s2: &#123;&#125;&quot;, <span class="keyword">session</span>.hashCode());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">Object</span> loginUser = <span class="keyword">session</span>.getAttribute(&quot;loginUser&quot;); //ä»<span class="keyword">session</span>ä¸­è·å–æ•°æ®</span><br><span class="line">        <span class="keyword">log</span>.<span class="keyword">info</span>(&quot;loginUser: &#123;&#125;&quot;, loginUser);</span><br><span class="line">        <span class="keyword">return</span> Result.success(loginUser);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>A. è®¿é—® s1 æ¥å£ï¼Œ<code>http://localhost:8080/s1</code></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-483-1024x368.png" alt="img"></p><p>è¯·æ±‚å®Œæˆä¹‹åï¼Œåœ¨å“åº”å¤´ä¸­ï¼Œå°±ä¼šçœ‹åˆ°æœ‰ä¸€ä¸ªSet-Cookieçš„å“åº”å¤´ï¼Œé‡Œé¢å“åº”å›æ¥äº†ä¸€ä¸ªCookieï¼Œå°±æ˜¯JSESSIONIDï¼Œè¿™ä¸ªå°±æ˜¯æœåŠ¡ç«¯ä¼šè¯å¯¹è±¡ Session çš„IDã€‚</p><p>B. è®¿é—® s2 æ¥å£ï¼Œ<code>http://localhost:8080/s2</code></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-484-1024x292.png" alt="img"></p><p>æ¥ä¸‹æ¥ï¼Œåœ¨åç»­çš„æ¯æ¬¡è¯·æ±‚æ—¶ï¼Œéƒ½ä¼šå°†Cookieçš„å€¼ï¼Œæºå¸¦åˆ°æœåŠ¡ç«¯ï¼Œé‚£æœåŠ¡ç«¯å‘¢ï¼Œæ¥æ”¶åˆ°Cookieä¹‹åï¼Œä¼šè‡ªåŠ¨çš„æ ¹æ®JSESSIONIDçš„å€¼ï¼Œæ‰¾åˆ°å¯¹åº”çš„ä¼šè¯å¯¹è±¡Sessionã€‚</p><p>é‚£ç»è¿‡è¿™ä¸¤æ­¥æµ‹è¯•ï¼Œå¤§å®¶ä¹Ÿä¼šçœ‹åˆ°ï¼Œåœ¨æ§åˆ¶å°ä¸­è¾“å‡ºå¦‚ä¸‹æ—¥å¿—ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-485-1024x77.png" alt="img"></p><p>ä¸¤æ¬¡è¯·æ±‚ï¼Œè·å–åˆ°çš„Sessionä¼šè¯å¯¹è±¡çš„hashcodeæ˜¯ä¸€æ ·çš„ï¼Œå°±è¯´æ˜æ˜¯åŒä¸€ä¸ªä¼šè¯å¯¹è±¡ã€‚è€Œä¸”ï¼Œç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶ï¼Œå¾€Sessionä¼šè¯å¯¹è±¡ä¸­å­˜å‚¨çš„å€¼ï¼Œç¬¬äºŒæ¬¡è¯·æ±‚æ—¶ï¼Œä¹Ÿè·å–åˆ°äº†ã€‚ é‚£è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡Sessionä¼šè¯å¯¹è±¡ï¼Œåœ¨åŒä¸€ä¸ªä¼šè¯çš„å¤šæ¬¡è¯·æ±‚ä¹‹é—´æ¥è¿›è¡Œæ•°æ®å…±äº«äº†ã€‚</p><p><strong>ä¼˜ç¼ºç‚¹</strong></p><ul><li>ä¼˜ç‚¹ï¼šSessionæ˜¯å­˜å‚¨åœ¨æœåŠ¡ç«¯çš„ï¼Œå®‰å…¨</li><li>ç¼ºç‚¹ï¼š<ul><li>æœåŠ¡å™¨é›†ç¾¤ç¯å¢ƒä¸‹æ— æ³•ç›´æ¥ä½¿ç”¨Session</li><li>ç§»åŠ¨ç«¯APP(Androidã€IOS)ä¸­æ— æ³•ä½¿ç”¨Cookie</li><li>ç”¨æˆ·å¯ä»¥è‡ªå·±ç¦ç”¨Cookie</li><li>Cookieä¸èƒ½è·¨åŸŸ</li></ul></li></ul><p>PSï¼šSession åº•å±‚æ˜¯åŸºäºCookieå®ç°çš„ä¼šè¯è·Ÿè¸ªï¼Œå¦‚æœCookieä¸å¯ç”¨ï¼Œåˆ™è¯¥æ–¹æ¡ˆï¼Œä¹Ÿå°±å¤±æ•ˆäº†ã€‚</p><h4 id="2-1-6æœåŠ¡å™¨é›†ç¾¤ç¯å¢ƒä¸ºä½•æ— æ³•ä½¿ç”¨Sessionï¼Ÿ">2.1.6<strong>æœåŠ¡å™¨é›†ç¾¤ç¯å¢ƒä¸ºä½•æ— æ³•ä½¿ç”¨Sessionï¼Ÿ</strong></h4><p>åœ¨å¤šæœºéƒ¨ç½²ï¼ˆé›†ç¾¤ï¼‰ä¸‹ç›´æ¥ç”¨ Session ä¼šç¢°åˆ°è¿™æ ·çš„é—®é¢˜ï¼š</p><ol><li>é›†ç¾¤éƒ¨ç½²<ul><li>ä¸ºäº†é¿å…å•ç‚¹æ•…éšœï¼Œé¡¹ç›®é€šå¸¸éƒ¨ç½²å¤šä»½ï¼ˆä¾‹å¦‚ 3 å° Tomcatï¼‰ï¼Œå¹¶åœ¨å‰ç«¯åŠ ä¸€å°è´Ÿè½½å‡è¡¡æœåŠ¡å™¨æ¥åˆ†å‘è¯·æ±‚ã€‚</li><li></li></ul></li><li>Session æœ¬åœ°å­˜å‚¨<ul><li>æ¯å° Tomcat éƒ½ç»´æŠ¤è‡ªå·±çš„ä¸€ä»½ Session å­˜å‚¨ï¼ŒSession IDï¼ˆJSESSIONIDï¼‰å’Œä¼šè¯æ•°æ®åªä¿å­˜åœ¨äº§ç”Ÿå®ƒçš„é‚£å°æœºå™¨ä¸Šã€‚</li></ul></li><li>è¯·æ±‚ä¸ç¨³å®šè·¯ç”±<ul><li>æµè§ˆå™¨ç¬¬ä¸€æ¬¡ç™»å½•ï¼Œç»è´Ÿè½½å‡è¡¡åˆ°è¾¾ A æœåŠ¡å™¨ï¼ŒA æœåŠ¡å™¨åˆ›å»º Session(1)ï¼Œå¹¶ä¸‹å‘ JSESSIONID=1 ç»™æµè§ˆå™¨ã€‚</li><li>æµè§ˆå™¨ç¬¬äºŒæ¬¡è¯·æ±‚ï¼ˆå¸¦ JSESSIONID=1ï¼‰åˆè¢«è·¯ç”±åˆ° B æœåŠ¡å™¨ï¼ŒB æœåŠ¡å™¨åœ¨è‡ªå·±çš„å­˜å‚¨é‡Œæ‰¾ä¸åˆ° ID=1 çš„ Sessionï¼Œå°±æ— æ³•è¯†åˆ«ç”¨æˆ·çŠ¶æ€ã€‚</li></ul></li><li>ç»“æœ<ul><li>åŒä¸€ä¸ªæµè§ˆå™¨è¿ç»­è¯·æ±‚ï¼Œå´å› ä¸ºè¢«åˆ†åˆ°ä¸åŒèŠ‚ç‚¹ï¼Œæ‹¿ä¸åˆ°åŒä¸€ä¸ª Sessionï¼Œå¯¼è‡´ä¼šè¯è·Ÿè¸ªå¤±æ•ˆã€‚</li></ul></li></ol><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-468.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-469.png" alt="img"></p><ol><li></li></ol><p><strong>æ ¸å¿ƒç»“è®º</strong>ï¼š</p><ul><li>ä¼ ç»Ÿçš„æœåŠ¡å™¨å†…å­˜å‹ Session åªèƒ½åœ¨å•æœºä¸Šä½¿ç”¨ï¼›</li><li>åœ¨é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œå¿…é¡»å¼•å…¥â€œä¼šè¯å…±äº«â€æˆ–â€œç²˜æ€§ä¼šè¯â€ç­‰æœºåˆ¶ï¼Œæ‰èƒ½ä¿è¯æ¯æ¬¡è¯·æ±‚éƒ½èƒ½å–åˆ°åŒä¸€ä¸ª Session å¯¹è±¡ã€‚</li></ul><h4 id="2-1-7æ–¹æ¡ˆä¸‰ï¼šä»¤ç‰ŒæŠ€æœ¯">2.1.7æ–¹æ¡ˆä¸‰ï¼šä»¤ç‰ŒæŠ€æœ¯</h4><p>è¿™é‡Œæåˆ°çš„ä»¤ç‰Œï¼Œå…¶å®å®ƒå°±æ˜¯ä¸€ä¸ªç”¨æˆ·èº«ä»½çš„æ ‡è¯†ï¼Œæœ¬è´¨å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-470-1024x248.png" alt="img"></p><p>å¦‚æœé€šè¿‡ä»¤ç‰ŒæŠ€æœ¯æ¥è·Ÿè¸ªä¼šè¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æµè§ˆå™¨å‘èµ·è¯·æ±‚ã€‚åœ¨è¯·æ±‚ç™»å½•æ¥å£çš„æ—¶å€™ï¼Œå¦‚æœç™»å½•æˆåŠŸï¼Œæˆ‘å°±å¯ä»¥ç”Ÿæˆä¸€ä¸ªä»¤ç‰Œï¼Œä»¤ç‰Œå°±æ˜¯ç”¨æˆ·çš„åˆæ³•èº«ä»½å‡­è¯ã€‚æ¥ä¸‹æ¥æˆ‘åœ¨å“åº”æ•°æ®çš„æ—¶å€™ï¼Œæˆ‘å°±å¯ä»¥ç›´æ¥å°†ä»¤ç‰Œå“åº”ç»™å‰ç«¯ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨å‰ç«¯ç¨‹åºå½“ä¸­æ¥æ”¶åˆ°ä»¤ç‰Œä¹‹åï¼Œå°±éœ€è¦å°†è¿™ä¸ªä»¤ç‰Œå­˜å‚¨èµ·æ¥ã€‚è¿™ä¸ªå­˜å‚¨å¯ä»¥å­˜å‚¨åœ¨ cookie å½“ä¸­ï¼Œä¹Ÿå¯ä»¥å­˜å‚¨åœ¨å…¶ä»–çš„å­˜å‚¨ç©ºé—´(æ¯”å¦‚ï¼šlocalStorage)å½“ä¸­ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œåœ¨åç»­çš„æ¯ä¸€æ¬¡è¯·æ±‚å½“ä¸­ï¼Œéƒ½éœ€è¦å°†ä»¤ç‰Œæºå¸¦åˆ°æœåŠ¡ç«¯ã€‚æºå¸¦åˆ°æœåŠ¡ç«¯ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±éœ€è¦æ¥æ ¡éªŒä»¤ç‰Œçš„æœ‰æ•ˆæ€§ã€‚å¦‚æœä»¤ç‰Œæ˜¯æœ‰æ•ˆçš„ï¼Œå°±è¯´æ˜ç”¨æˆ·å·²ç»æ‰§è¡Œäº†ç™»å½•æ“ä½œï¼Œå¦‚æœä»¤ç‰Œæ˜¯æ— æ•ˆçš„ï¼Œå°±è¯´æ˜ç”¨æˆ·ä¹‹å‰å¹¶æœªæ‰§è¡Œç™»å½•æ“ä½œã€‚</p><p>æ­¤æ—¶ï¼Œå¦‚æœæ˜¯åœ¨åŒä¸€æ¬¡ä¼šè¯çš„å¤šæ¬¡è¯·æ±‚ä¹‹é—´ï¼Œæˆ‘ä»¬æƒ³å…±äº«æ•°æ®ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å…±äº«çš„æ•°æ®å­˜å‚¨åœ¨ä»¤ç‰Œå½“ä¸­å°±å¯ä»¥äº†ã€‚</p><p><strong>ä¼˜ç¼ºç‚¹</strong></p><ul><li>ä¼˜ç‚¹ï¼š<ul><li>æ”¯æŒPCç«¯ã€ç§»åŠ¨ç«¯</li><li>è§£å†³é›†ç¾¤ç¯å¢ƒä¸‹çš„è®¤è¯é—®é¢˜</li><li>å‡è½»æœåŠ¡å™¨çš„å­˜å‚¨å‹åŠ›ï¼ˆæ— éœ€åœ¨æœåŠ¡å™¨ç«¯å­˜å‚¨ï¼‰</li></ul></li><li>ç¼ºç‚¹ï¼šéœ€è¦è‡ªå·±å®ç°ï¼ˆåŒ…æ‹¬ä»¤ç‰Œçš„ç”Ÿæˆã€ä»¤ç‰Œçš„ä¼ é€’ã€ä»¤ç‰Œçš„æ ¡éªŒï¼‰</li></ul><h3 id="2-2JWTä»¤ç‰Œ">2.2JWTä»¤ç‰Œ</h3><h4 id="2-2-1ä»‹ç»">2.2.1ä»‹ç»</h4><ul><li>JWTå…¨ç§° JSON Web Token ï¼ˆå®˜ç½‘ï¼š<a href="https://jwt.io/%EF%BC%89%EF%BC%8C%E5%AE%9A%E4%B9%89%E4%BA%86%E4%B8%80%E7%A7%8D%E7%AE%80%E6%B4%81%E7%9A%84%E3%80%81%E8%87%AA%E5%8C%85%E5%90%AB%E7%9A%84%E6%A0%BC%E5%BC%8F%EF%BC%8C%E7%94%A8%E4%BA%8E%E5%9C%A8%E9%80%9A%E4%BF%A1%E5%8F%8C%E6%96%B9%E4%BB%A5json%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E5%AE%89%E5%85%A8%E7%9A%84%E4%BC%A0%E8%BE%93%E4%BF%A1%E6%81%AF%E3%80%82%E7%94%B1%E4%BA%8E%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%E7%9A%84%E5%AD%98%E5%9C%A8%EF%BC%8C%E8%BF%99%E4%BA%9B%E4%BF%A1%E6%81%AF%E6%98%AF%E5%8F%AF%E9%9D%A0%E7%9A%84%E3%80%82">https://jwt.io/ï¼‰ï¼Œå®šä¹‰äº†ä¸€ç§ç®€æ´çš„ã€è‡ªåŒ…å«çš„æ ¼å¼ï¼Œç”¨äºåœ¨é€šä¿¡åŒæ–¹ä»¥jsonæ•°æ®æ ¼å¼å®‰å…¨çš„ä¼ è¾“ä¿¡æ¯ã€‚ç”±äºæ•°å­—ç­¾åçš„å­˜åœ¨ï¼Œè¿™äº›ä¿¡æ¯æ˜¯å¯é çš„ã€‚</a><ul><li>ç®€æ´ï¼šæ˜¯æŒ‡jwtå°±æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²ã€‚å¯ä»¥åœ¨è¯·æ±‚å‚æ•°æˆ–è€…æ˜¯è¯·æ±‚å¤´å½“ä¸­ç›´æ¥ä¼ é€’ã€‚</li><li>è‡ªåŒ…å«ï¼šæŒ‡çš„æ˜¯jwtä»¤ç‰Œï¼Œçœ‹ä¼¼æ˜¯ä¸€ä¸ªéšæœºçš„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯æˆ‘ä»¬æ˜¯å¯ä»¥æ ¹æ®è‡ªèº«çš„éœ€æ±‚åœ¨jwtä»¤ç‰Œä¸­å­˜å‚¨è‡ªå®šä¹‰çš„æ•°æ®å†…å®¹ã€‚å¦‚ï¼šå¯ä»¥ç›´æ¥åœ¨jwtä»¤ç‰Œä¸­å­˜å‚¨ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯ã€‚</li><li><strong>ç®€å•æ¥è®²ï¼Œjwtå°±æ˜¯å°†åŸå§‹çš„jsonæ•°æ®æ ¼å¼è¿›è¡Œäº†å®‰å…¨çš„å°è£…ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥åŸºäºjwtåœ¨é€šä¿¡åŒæ–¹å®‰å…¨çš„è¿›è¡Œä¿¡æ¯ä¼ è¾“äº†ã€‚</strong></li></ul></li></ul><p>JWTçš„ç»„æˆï¼š ï¼ˆJWTä»¤ç‰Œç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼Œä¸‰ä¸ªéƒ¨åˆ†ä¹‹é—´ä½¿ç”¨è‹±æ–‡çš„ç‚¹æ¥åˆ†å‰²ï¼‰</p><ul><li>ç¬¬ä¸€éƒ¨åˆ†ï¼šHeader(å¤´ï¼‰ï¼Œ è®°å½•ä»¤ç‰Œç±»å‹ã€ç­¾åç®—æ³•ç­‰ã€‚ ä¾‹å¦‚ï¼š{â€œalgâ€:â€œHS256â€,â€œtypeâ€:â€œJWTâ€}</li><li>ç¬¬äºŒéƒ¨åˆ†ï¼šPayload(æœ‰æ•ˆè½½è·ï¼‰ï¼Œæºå¸¦ä¸€äº›è‡ªå®šä¹‰ä¿¡æ¯ã€é»˜è®¤ä¿¡æ¯ç­‰ã€‚ ä¾‹å¦‚ï¼š{â€œidâ€:â€œ1â€,â€œusernameâ€:â€œTomâ€}</li><li>ç¬¬ä¸‰éƒ¨åˆ†ï¼šSignature(ç­¾åï¼‰ï¼Œé˜²æ­¢Tokenè¢«ç¯¡æ”¹ã€ç¡®ä¿å®‰å…¨æ€§ã€‚å°†headerã€payloadï¼Œå¹¶åŠ å…¥æŒ‡å®šç§˜é’¥ï¼Œé€šè¿‡æŒ‡å®šç­¾åç®—æ³•è®¡ç®—è€Œæ¥ã€‚</li></ul><blockquote><p>ç­¾åçš„ç›®çš„å°±æ˜¯ä¸ºäº†é˜²jwtä»¤ç‰Œè¢«ç¯¡æ”¹ï¼Œè€Œæ­£æ˜¯å› ä¸ºjwtä»¤ç‰Œæœ€åä¸€ä¸ªéƒ¨åˆ†æ•°å­—ç­¾åçš„å­˜åœ¨ï¼Œæ‰€ä»¥æ•´ä¸ªjwt ä»¤ç‰Œæ˜¯éå¸¸å®‰å…¨å¯é çš„ã€‚ä¸€æ—¦jwtä»¤ç‰Œå½“ä¸­ä»»ä½•ä¸€ä¸ªéƒ¨åˆ†ã€ä»»ä½•ä¸€ä¸ªå­—ç¬¦è¢«ç¯¡æ”¹äº†ï¼Œæ•´ä¸ªä»¤ç‰Œåœ¨æ ¡éªŒçš„æ—¶å€™éƒ½ä¼šå¤±è´¥ï¼Œæ‰€ä»¥å®ƒæ˜¯éå¸¸å®‰å…¨å¯é çš„ã€‚</p></blockquote><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-486-1024x86.png" alt="img"></p><p>JWTæ˜¯å¦‚ä½•å°†åŸå§‹çš„JSONæ ¼å¼æ•°æ®ï¼Œè½¬å˜ä¸ºå­—ç¬¦ä¸²çš„å‘¢ï¼Ÿ</p><ul><li>å…¶å®åœ¨ç”ŸæˆJWTä»¤ç‰Œæ—¶ï¼Œä¼šå¯¹JSONæ ¼å¼çš„æ•°æ®è¿›è¡Œä¸€æ¬¡ç¼–ç ï¼šè¿›è¡Œbase64ç¼–ç </li><li>Base64ï¼šæ˜¯ä¸€ç§åŸºäº64ä¸ªå¯æ‰“å°çš„å­—ç¬¦æ¥è¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®çš„ç¼–ç æ–¹å¼ã€‚æ—¢ç„¶èƒ½ç¼–ç ï¼Œé‚£ä¹Ÿå°±æ„å‘³ç€ä¹Ÿèƒ½è§£ç ã€‚æ‰€ä½¿ç”¨çš„64ä¸ªå­—ç¬¦åˆ†åˆ«æ˜¯Aåˆ°Zã€aåˆ°zã€ 0- 9ï¼Œä¸€ä¸ªåŠ å·ï¼Œä¸€ä¸ªæ–œæ ï¼ŒåŠ èµ·æ¥å°±æ˜¯64ä¸ªå­—ç¬¦ã€‚ä»»ä½•æ•°æ®ç»è¿‡base64ç¼–ç ä¹‹åï¼Œæœ€ç»ˆå°±ä¼šé€šè¿‡è¿™64ä¸ªå­—ç¬¦æ¥è¡¨ç¤ºã€‚å½“ç„¶è¿˜æœ‰ä¸€ä¸ªç¬¦å·ï¼Œé‚£å°±æ˜¯ç­‰å·ã€‚ç­‰å·å®ƒæ˜¯ä¸€ä¸ªè¡¥ä½çš„ç¬¦å·</li><li>éœ€è¦æ³¨æ„çš„æ˜¯Base64æ˜¯ç¼–ç æ–¹å¼ï¼Œè€Œä¸æ˜¯åŠ å¯†æ–¹å¼ã€‚</li></ul><h4 id="2-2-2ç”Ÿæˆå’Œæ ¡éªŒ">2.2.2ç”Ÿæˆå’Œæ ¡éªŒ</h4><p>1). é¦–å…ˆæˆ‘ä»¬å…ˆæ¥å®ç°JWTä»¤ç‰Œçš„ç”Ÿæˆã€‚è¦æƒ³ä½¿ç”¨JWTä»¤ç‰Œï¼Œéœ€è¦å…ˆå¼•å…¥JWTçš„ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- JWTä¾èµ–--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨å¼•å…¥å®ŒJWTæ¥èµ–åï¼Œå°±å¯ä»¥è°ƒç”¨å·¥å…·åŒ…ä¸­æä¾›çš„APIæ¥å®ŒæˆJWTä»¤ç‰Œçš„ç”Ÿæˆå’Œæ ¡éªŒã€‚å·¥å…·ç±»ï¼šJwts</p><p>2). ç”ŸæˆJWTä»£ç å®ç°ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">testGenJwt</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Map</span>&lt;<span class="title class_">String</span>, <span class="title class_">Object</span>&gt; claims = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    claims.<span class="title function_">put</span>(<span class="string">&quot;id&quot;</span>, <span class="number">10</span>);</span><br><span class="line">    claims.<span class="title function_">put</span>(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;itheima&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title class_">String</span> jwt = <span class="title class_">Jwts</span>.<span class="title function_">builder</span>().<span class="title function_">signWith</span>(<span class="title class_">SignatureAlgorithm</span>.<span class="property">HS256</span>, <span class="string">&quot;aXRjYXN0&quot;</span>)</span><br><span class="line">        .<span class="title function_">addClaims</span>(claims)</span><br><span class="line">        .<span class="title function_">setExpiration</span>(<span class="keyword">new</span> <span class="title class_">Date</span>(<span class="title class_">System</span>.<span class="title function_">currentTimeMillis</span>() + <span class="number">12</span> * <span class="number">3600</span> * <span class="number">1000</span>))</span><br><span class="line">        .<span class="title function_">compact</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(jwt);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œæµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJIUzI1NiJ9<span class="selector-class">.eyJpZCI6MSwiZXhwIjoxNjcyNzI5NzMwfQ</span>.fHi0Ub8npbyt71UqLXDdLyipptLgxBUg_mSuGJtXtBk</span><br></pre></td></tr></table></figure><p>è¾“å‡ºçš„ç»“æœå°±æ˜¯ç”Ÿæˆçš„JWTä»¤ç‰Œ,ï¼Œé€šè¿‡è‹±æ–‡çš„ç‚¹åˆ†å‰²å¯¹ä¸‰ä¸ªéƒ¨åˆ†è¿›è¡Œåˆ†å‰²ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç”Ÿæˆçš„ä»¤ç‰Œå¤åˆ¶ä¸€ä¸‹ï¼Œç„¶åæ‰“å¼€JWTçš„å®˜ç½‘ï¼Œå°†ç”Ÿæˆçš„ä»¤ç‰Œç›´æ¥æ”¾åœ¨Encodedä½ç½®ï¼Œæ­¤æ—¶å°±ä¼šè‡ªåŠ¨çš„å°†ä»¤ç‰Œè§£æå‡ºæ¥ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-487-1024x595.png" alt="img"></p><p>ç¬¬ä¸€éƒ¨åˆ†è§£æå‡ºæ¥ï¼Œçœ‹åˆ°JSONæ ¼å¼çš„åŸå§‹æ•°æ®ï¼Œæ‰€ä½¿ç”¨çš„ç­¾åç®—æ³•ä¸ºHS256ã€‚</p><p>ç¬¬äºŒä¸ªéƒ¨åˆ†æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„æ•°æ®ï¼Œä¹‹å‰æˆ‘ä»¬è‡ªå®šä¹‰çš„æ•°æ®å°±æ˜¯idï¼Œè¿˜æœ‰ä¸€ä¸ªexpä»£è¡¨çš„æ˜¯æˆ‘ä»¬æ‰€è®¾ç½®çš„è¿‡æœŸæ—¶é—´ã€‚</p><p>ç”±äºå‰ä¸¤ä¸ªéƒ¨åˆ†æ˜¯base64ç¼–ç ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥ç›´æ¥è§£ç å‡ºæ¥ã€‚ä½†æœ€åä¸€ä¸ªéƒ¨åˆ†å¹¶ä¸æ˜¯base64ç¼–ç ï¼Œæ˜¯ç»è¿‡ç­¾åç®—æ³•è®¡ç®—å‡ºæ¥çš„ï¼Œæ‰€ä»¥æœ€åä¸€ä¸ªéƒ¨åˆ†æ˜¯ä¸ä¼šè§£æçš„ã€‚</p><p>3). å®ç°äº†JWTä»¤ç‰Œçš„ç”Ÿæˆï¼Œä¸‹é¢æˆ‘ä»¬æ¥ç€ä½¿ç”¨Javaä»£ç æ¥æ ¡éªŒJWTä»¤ç‰Œ(è§£æç”Ÿæˆçš„ä»¤ç‰Œ)ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testParseJwt</span>()</span> &#123;</span><br><span class="line">    Claims claims = Jwts.parser().setSigningKey(<span class="string">&quot;aXRjYXN0&quot;</span>)</span><br><span class="line">        .parseClaimsJws(<span class="string">&quot;eyJhbGciOiJIUzI1NiJ9.eyJpZCI6MTAsInVzZXJuYW1lIjoiaXRoZWltYSIsImV4cCI6MTcwMTkwOTAxNX0.N-MD6DmoeIIY5lB5z73UFLN9u7veppx1K5_N_jS9Yko&quot;</span>)</span><br><span class="line">        .getBody();</span><br><span class="line">    System.<span class="keyword">out</span>.println(claims);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œæµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attribute">id</span>=10, <span class="attribute">username</span>=itheima, <span class="attribute">exp</span>=1701909015&#125;</span><br></pre></td></tr></table></figure><p>ä»¤ç‰Œè§£æåï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°idå’Œè¿‡æœŸæ—¶é—´ï¼Œå¦‚æœåœ¨è§£æçš„è¿‡ç¨‹å½“ä¸­æ²¡æœ‰æŠ¥é”™ï¼Œå°±è¯´æ˜è§£ææˆåŠŸäº†ã€‚</p><p>é€šè¿‡ä»¥ä¸Šæµ‹è¯•ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨JWTä»¤ç‰Œæ—¶éœ€è¦æ³¨æ„ï¼š</p><ul><li>JWTæ ¡éªŒæ—¶ä½¿ç”¨çš„ç­¾åç§˜é’¥ï¼Œå¿…é¡»å’Œç”ŸæˆJWTä»¤ç‰Œæ—¶ä½¿ç”¨çš„ç§˜é’¥æ˜¯é…å¥—çš„ã€‚</li><li>å¦‚æœJWTä»¤ç‰Œè§£ææ ¡éªŒæ—¶æŠ¥é”™ï¼Œåˆ™è¯´æ˜ JWTä»¤ç‰Œè¢«ç¯¡æ”¹ æˆ– å¤±æ•ˆäº†ï¼Œä»¤ç‰Œéæ³•ã€‚</li></ul><h4 id="2-2-3ç™»å½•æ—¶ä¸‹å‘ä»¤ç‰Œ">2.2.3ç™»å½•æ—¶ä¸‹å‘ä»¤ç‰Œ</h4><ol><li>ç”Ÿæˆä»¤ç‰Œ<ul><li>åœ¨ç™»å½•æˆåŠŸä¹‹åæ¥ç”Ÿæˆä¸€ä¸ªJWTä»¤ç‰Œï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªä»¤ç‰Œç›´æ¥è¿”å›ç»™å‰ç«¯</li></ul></li><li>æ ¡éªŒä»¤ç‰Œ<ul><li>æ‹¦æˆªå‰ç«¯è¯·æ±‚ï¼Œä»è¯·æ±‚ä¸­è·å–åˆ°ä»¤ç‰Œï¼Œå¯¹ä»¤ç‰Œè¿›è¡Œè§£ææ ¡éªŒ</li></ul></li></ol><p><strong>å®ç°æ­¥éª¤ï¼š</strong></p><ol><li>å¼•å…¥JWTå·¥å…·ç±»ï¼šåœ¨é¡¹ç›®å·¥ç¨‹ä¸‹åˆ›å»º <code>com.itheima.util</code> åŒ…ï¼Œå¹¶æŠŠæä¾›JWTå·¥å…·ç±»å¤åˆ¶åˆ°è¯¥åŒ…ä¸‹</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">package com.<span class="property">itheima</span>.<span class="property">util</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.<span class="property">jsonwebtoken</span>.<span class="property">Claims</span>;</span><br><span class="line"><span class="keyword">import</span> io.<span class="property">jsonwebtoken</span>.<span class="property">Jwts</span>;</span><br><span class="line"><span class="keyword">import</span> io.<span class="property">jsonwebtoken</span>.<span class="property">SignatureAlgorithm</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">Date</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">Map</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="title class_">String</span> signKey = <span class="string">&quot;SVRIRUlNQQ==&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="title class_">Long</span> expire = 43200000L;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”ŸæˆJWTä»¤ç‰Œ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="title class_">String</span> <span class="title function_">generateJwt</span>(<span class="params"><span class="title class_">Map</span>&lt;<span class="title class_">String</span>,<span class="title class_">Object</span>&gt; claims</span>)&#123;</span><br><span class="line">        <span class="title class_">String</span> jwt = <span class="title class_">Jwts</span>.<span class="title function_">builder</span>()</span><br><span class="line">                .<span class="title function_">addClaims</span>(claims)</span><br><span class="line">                .<span class="title function_">signWith</span>(<span class="title class_">SignatureAlgorithm</span>.<span class="property">HS256</span>, signKey)</span><br><span class="line">                .<span class="title function_">setExpiration</span>(<span class="keyword">new</span> <span class="title class_">Date</span>(<span class="title class_">System</span>.<span class="title function_">currentTimeMillis</span>() + expire))</span><br><span class="line">                .<span class="title function_">compact</span>();</span><br><span class="line">        <span class="keyword">return</span> jwt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£æJWTä»¤ç‰Œ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jwt JWTä»¤ç‰Œ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> JWTç¬¬äºŒéƒ¨åˆ†è´Ÿè½½ payload ä¸­å­˜å‚¨çš„å†…å®¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="title class_">Claims</span> <span class="title function_">parseJWT</span>(<span class="params"><span class="title class_">String</span> jwt</span>)&#123;</span><br><span class="line">        <span class="title class_">Claims</span> claims = <span class="title class_">Jwts</span>.<span class="title function_">parser</span>()</span><br><span class="line">                .<span class="title function_">setSigningKey</span>(signKey)</span><br><span class="line">                .<span class="title function_">parseClaimsJws</span>(jwt)</span><br><span class="line">                .<span class="title function_">getBody</span>();</span><br><span class="line">        <span class="keyword">return</span> claims;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>å®Œå–„ <code>EmpServiceImpl</code>ä¸­çš„ <code>login</code> æ–¹æ³•é€»è¾‘ï¼Œ ç™»å½•æˆåŠŸï¼Œç”ŸæˆJWTä»¤ç‰Œå¹¶è¿”å›</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">LoginInfo</span> <span class="title function_">login</span>(<span class="params"><span class="title class_">Emp</span> emp</span>) &#123;</span><br><span class="line">    <span class="title class_">Emp</span> empLogin = empMapper.<span class="title function_">getUsernameAndPassword</span>(emp);</span><br><span class="line">    <span class="keyword">if</span>(empLogin != <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="comment">//1. ç”ŸæˆJWTä»¤ç‰Œ</span></span><br><span class="line">        <span class="title class_">Map</span>&lt;<span class="title class_">String</span>,<span class="title class_">Object</span>&gt; dataMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        dataMap.<span class="title function_">put</span>(<span class="string">&quot;id&quot;</span>, empLogin.<span class="title function_">getId</span>());</span><br><span class="line">        dataMap.<span class="title function_">put</span>(<span class="string">&quot;username&quot;</span>, empLogin.<span class="title function_">getUsername</span>());</span><br><span class="line">        </span><br><span class="line">        <span class="title class_">String</span> jwt = <span class="title class_">JwtUtils</span>.<span class="title function_">generateJwt</span>(dataMap);</span><br><span class="line">        <span class="title class_">LoginInfo</span> loginInfo = <span class="keyword">new</span> <span class="title class_">LoginInfo</span>(empLogin.<span class="title function_">getId</span>(), empLogin.<span class="title function_">getUsername</span>(), empLogin.<span class="title function_">getName</span>(), jwt);</span><br><span class="line">        <span class="keyword">return</span> loginInfo;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3è¿‡æ»¤å™¨Filter">2.3è¿‡æ»¤å™¨Filter</h3><p>åˆšæ‰é€šè¿‡æµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨åç»­çš„è¯·æ±‚å½“ä¸­ï¼Œéƒ½ä¼šåœ¨è¯·æ±‚å¤´ä¸­æºå¸¦JWTä»¤ç‰Œåˆ°æœåŠ¡ç«¯ï¼Œè€ŒæœåŠ¡ç«¯éœ€è¦ç»Ÿä¸€æ‹¦æˆªæ‰€æœ‰çš„è¯·æ±‚ï¼Œä»è€Œåˆ¤æ–­æ˜¯å¦æºå¸¦çš„æœ‰åˆæ³•çš„JWTä»¤ç‰Œã€‚</p><p>é‚£æ€ä¹ˆæ ·æ¥ç»Ÿä¸€æ‹¦æˆªåˆ°æ‰€æœ‰çš„è¯·æ±‚æ ¡éªŒä»¤ç‰Œçš„æœ‰æ•ˆæ€§å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬ä¼šå­¦ä¹ ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>Interceptoræ‹¦æˆªå™¨</li><li>Filterè¿‡æ»¤å™¨</li></ul><h4 id="2-3-1Filterå¿«é€Ÿå…¥é—¨">2.3.1Filterå¿«é€Ÿå…¥é—¨</h4><p><strong>ä»€ä¹ˆæ˜¯Filterï¼Ÿ</strong></p><ul><li>Filterè¡¨ç¤ºè¿‡æ»¤å™¨ï¼Œæ˜¯ JavaWebä¸‰å¤§ç»„ä»¶(Servletã€Filterã€Listener)ä¹‹ä¸€ã€‚</li><li>è¿‡æ»¤å™¨å¯ä»¥æŠŠå¯¹èµ„æºçš„è¯·æ±‚æ‹¦æˆªä¸‹æ¥ï¼Œä»è€Œå®ç°ä¸€äº›ç‰¹æ®Šçš„åŠŸèƒ½<ul><li>ä½¿ç”¨äº†è¿‡æ»¤å™¨ä¹‹åï¼Œè¦æƒ³è®¿é—®webæœåŠ¡å™¨ä¸Šçš„èµ„æºï¼Œå¿…é¡»å…ˆç»è¿‡æ»¤å™¨ï¼Œè¿‡æ»¤å™¨å¤„ç†å®Œæ¯•ä¹‹åï¼Œæ‰å¯ä»¥è®¿é—®å¯¹åº”çš„èµ„æºã€‚</li></ul></li><li>è¿‡æ»¤å™¨ä¸€èˆ¬å®Œæˆä¸€äº›é€šç”¨çš„æ“ä½œï¼Œæ¯”å¦‚ï¼šç™»å½•æ ¡éªŒã€ç»Ÿä¸€ç¼–ç å¤„ç†ã€æ•æ„Ÿå­—ç¬¦å¤„ç†ç­‰ã€‚</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-488.png" alt="img"></p><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡Filterå¿«é€Ÿå…¥é—¨ç¨‹åºæŒæ¡è¿‡æ»¤å™¨çš„åŸºæœ¬ä½¿ç”¨æ“ä½œï¼š</p><ul><li>ç¬¬1æ­¥ï¼Œå®šä¹‰è¿‡æ»¤å™¨ ï¼š1.å®šä¹‰ä¸€ä¸ªç±»ï¼Œå®ç° Filter æ¥å£ï¼Œå¹¶é‡å†™å…¶æ‰€æœ‰æ–¹æ³•ã€‚</li><li>ç¬¬2æ­¥ï¼Œé…ç½®è¿‡æ»¤å™¨ï¼šFilterç±»ä¸ŠåŠ  @WebFilter æ³¨è§£ï¼Œé…ç½®æ‹¦æˆªèµ„æºçš„è·¯å¾„ã€‚å¼•å¯¼ç±»ä¸ŠåŠ  @ServletComponentScan å¼€å¯Servletç»„ä»¶æ”¯æŒã€‚</li></ul><p><strong>1). å®šä¹‰è¿‡æ»¤å™¨</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DemoFilter</span> <span class="title">implements</span> <span class="title">Filter</span> &#123;</span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–æ–¹æ³•, webæœåŠ¡å™¨å¯åŠ¨, åˆ›å»ºFilterå®ä¾‹æ—¶è°ƒç”¨, åªè°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span>(<span class="params">FilterConfig filterConfig</span>) throws ServletException</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;init ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ‹¦æˆªåˆ°è¯·æ±‚æ—¶,è°ƒç”¨è¯¥æ–¹æ³•,å¯ä»¥è°ƒç”¨å¤šæ¬¡</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span>(<span class="params">ServletRequest servletRequest, ServletResponse servletResponse, FilterChain chain</span>) throws IOException, ServletException</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;æ‹¦æˆªåˆ°äº†è¯·æ±‚...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é”€æ¯æ–¹æ³•, webæœåŠ¡å™¨å…³é—­æ—¶è°ƒç”¨, åªè°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span>()</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;destroy ... &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>initæ–¹æ³•ï¼šè¿‡æ»¤å™¨çš„åˆå§‹åŒ–æ–¹æ³•ã€‚åœ¨webæœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™ä¼šè‡ªåŠ¨çš„åˆ›å»ºFilterè¿‡æ»¤å™¨å¯¹è±¡ï¼Œåœ¨åˆ›å»ºè¿‡æ»¤å™¨å¯¹è±¡çš„æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨initåˆå§‹åŒ–æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚</li><li>doFilteræ–¹æ³•ï¼šè¿™ä¸ªæ–¹æ³•æ˜¯åœ¨æ¯ä¸€æ¬¡æ‹¦æˆªåˆ°è¯·æ±‚ä¹‹åéƒ½ä¼šè¢«è°ƒç”¨ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•æ˜¯ä¼šè¢«è°ƒç”¨å¤šæ¬¡çš„ï¼Œæ¯æ‹¦æˆªåˆ°ä¸€æ¬¡è¯·æ±‚å°±ä¼šè°ƒç”¨ä¸€æ¬¡doFilter()æ–¹æ³•ã€‚</li><li>destroyæ–¹æ³•ï¼š æ˜¯é”€æ¯çš„æ–¹æ³•ã€‚å½“æˆ‘ä»¬å…³é—­æœåŠ¡å™¨çš„æ—¶å€™ï¼Œå®ƒä¼šè‡ªåŠ¨çš„è°ƒç”¨é”€æ¯æ–¹æ³•destroyï¼Œè€Œè¿™ä¸ªé”€æ¯æ–¹æ³•ä¹Ÿåªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚</li></ul><p><strong>2). é…ç½®è¿‡æ»¤å™¨</strong></p><p>åœ¨å®šä¹‰å®ŒFilterä¹‹åï¼ŒFilterå…¶å®å¹¶ä¸ä¼šç”Ÿæ•ˆï¼Œè¿˜éœ€è¦å®ŒæˆFilterçš„é…ç½®ï¼ŒFilterçš„é…ç½®éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨Filterç±»ä¸Šæ·»åŠ ä¸€ä¸ªæ³¨è§£ï¼š<code>@WebFilter</code>ï¼Œå¹¶æŒ‡å®šå±æ€§<code>urlPatterns</code>ï¼Œé€šè¿‡è¿™ä¸ªå±æ€§æŒ‡å®šè¿‡æ»¤å™¨è¦æ‹¦æˆªå“ªäº›è¯·æ±‚</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebFilter</span>(urlPatterns = <span class="string">&quot;/*&quot;</span>) <span class="comment">//é…ç½®è¿‡æ»¤å™¨è¦æ‹¦æˆªçš„è¯·æ±‚è·¯å¾„ï¼ˆ /* è¡¨ç¤ºæ‹¦æˆªæµè§ˆå™¨çš„æ‰€æœ‰è¯·æ±‚ ï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–æ–¹æ³•, webæœåŠ¡å™¨å¯åŠ¨, åˆ›å»ºFilterå®ä¾‹æ—¶è°ƒç”¨, åªè°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;init ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ‹¦æˆªåˆ°è¯·æ±‚æ—¶,è°ƒç”¨è¯¥æ–¹æ³•,å¯ä»¥è°ƒç”¨å¤šæ¬¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‹¦æˆªåˆ°äº†è¯·æ±‚...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é”€æ¯æ–¹æ³•, webæœåŠ¡å™¨å…³é—­æ—¶è°ƒç”¨, åªè°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;destroy ... &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬åœ¨Filterç±»ä¸Šé¢åŠ äº†@WebFilteræ³¨è§£ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¿˜éœ€è¦åœ¨å¯åŠ¨ç±»ä¸Šé¢åŠ ä¸Šä¸€ä¸ªæ³¨è§£<code>@ServletComponentScan</code>ï¼Œé€šè¿‡è¿™ä¸ª<code>@ServletComponentScan</code>æ³¨è§£æ¥å¼€å¯SpringBooté¡¹ç›®å¯¹äºServletç»„ä»¶çš„æ”¯æŒã€‚</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@ServletComponentScan</span> <span class="comment">//å¼€å¯å¯¹Servletç»„ä»¶çš„æ”¯æŒ</span></span><br><span class="line"><span class="variable">@SpringBootApplication</span></span><br><span class="line">public class TliasManagementApplication &#123;</span><br><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">static</span> <span class="selector-tag">void</span> <span class="selector-tag">main</span>(String[] args) &#123;</span><br><span class="line">        <span class="selector-tag">SpringApplication</span><span class="selector-class">.run</span>(TliasManagementApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡æ–°å¯åŠ¨æœåŠ¡ï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œæ‰§è¡Œéƒ¨é—¨ç®¡ç†çš„è¯·æ±‚ï¼Œå¯ä»¥çœ‹åˆ°æ§åˆ¶å°è¾“å‡ºäº†è¿‡æ»¤å™¨ä¸­çš„å†…å®¹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-489-1024x128.png" alt="img"></p><p>**æ³¨æ„äº‹é¡¹ï¼š**åœ¨è¿‡æ»¤å™¨Filterä¸­ï¼Œå¦‚æœä¸æ‰§è¡Œæ”¾è¡Œæ“ä½œï¼Œå°†æ— æ³•è®¿é—®åé¢çš„èµ„æºã€‚ æ”¾è¡Œæ“ä½œï¼š<code>chain.doFilter(request, response);</code></p><h4 id="2-3-2ç™»å½•æ ¡éªŒè¿‡æ»¤å™¨">2.3.2ç™»å½•æ ¡éªŒè¿‡æ»¤å™¨</h4><p>æˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸‹å‰é¢åˆ†æè¿‡çš„ç™»å½•æ ¡éªŒçš„åŸºæœ¬æµç¨‹ï¼š</p><ul><li>è¦è¿›å…¥åˆ°åå°ç®¡ç†ç³»ç»Ÿï¼Œæˆ‘ä»¬å¿…é¡»å…ˆå®Œæˆç™»å½•æ“ä½œï¼Œæ­¤æ—¶å°±éœ€è¦è®¿é—®ç™»å½•æ¥å£loginã€‚</li><li>ç™»å½•æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬ä¼šåœ¨æœåŠ¡ç«¯ç”Ÿæˆä¸€ä¸ªJWTä»¤ç‰Œï¼Œå¹¶ä¸”æŠŠJWTä»¤ç‰Œè¿”å›ç»™å‰ç«¯ï¼Œå‰ç«¯ä¼šå°†JWTä»¤ç‰Œå­˜å‚¨ä¸‹æ¥ã€‚</li><li>åœ¨åç»­çš„æ¯ä¸€æ¬¡è¯·æ±‚å½“ä¸­ï¼Œéƒ½ä¼šå°†JWTä»¤ç‰Œæºå¸¦åˆ°æœåŠ¡ç«¯ï¼Œè¯·æ±‚åˆ°è¾¾æœåŠ¡ç«¯ä¹‹åï¼Œè¦æƒ³å»è®¿é—®å¯¹åº”çš„ä¸šåŠ¡åŠŸèƒ½ï¼Œæ­¤æ—¶æˆ‘ä»¬å¿…é¡»å…ˆè¦æ ¡éªŒä»¤ç‰Œçš„æœ‰æ•ˆæ€§ã€‚</li><li>å¯¹äºæ ¡éªŒä»¤ç‰Œçš„è¿™ä¸€å—æ“ä½œï¼Œæˆ‘ä»¬ä½¿ç”¨ç™»å½•æ ¡éªŒçš„è¿‡æ»¤å™¨ï¼Œåœ¨è¿‡æ»¤å™¨å½“ä¸­æ¥æ ¡éªŒä»¤ç‰Œçš„æœ‰æ•ˆæ€§ã€‚å¦‚æœä»¤ç‰Œæ˜¯æ— æ•ˆçš„ï¼Œå°±å“åº”ä¸€ä¸ªé”™è¯¯çš„ä¿¡æ¯ï¼Œä¹Ÿä¸ä¼šå†å»æ”¾è¡Œè®¿é—®å¯¹åº”çš„èµ„æºäº†ã€‚å¦‚æœä»¤ç‰Œå­˜åœ¨ï¼Œå¹¶ä¸”å®ƒæ˜¯æœ‰æ•ˆçš„ï¼Œæ­¤æ—¶å°±ä¼šæ”¾è¡Œå»è®¿é—®å¯¹åº”çš„webèµ„æºï¼Œæ‰§è¡Œç›¸åº”çš„ä¸šåŠ¡æ“ä½œã€‚</li></ul><ol><li>æ‰€æœ‰çš„è¯·æ±‚ï¼Œæ‹¦æˆªåˆ°äº†ä¹‹åï¼Œéƒ½éœ€è¦æ ¡éªŒä»¤ç‰Œå— ï¼Ÿ<ul><li>ç­”æ¡ˆï¼š<strong>ç™»å½•è¯·æ±‚ä¾‹å¤–</strong></li></ul></li><li>æ‹¦æˆªåˆ°è¯·æ±‚åï¼Œä»€ä¹ˆæƒ…å†µä¸‹æ‰å¯ä»¥æ”¾è¡Œï¼Œæ‰§è¡Œä¸šåŠ¡æ“ä½œ ï¼Ÿ<ul><li>ç­”æ¡ˆï¼š<strong>æœ‰ä»¤ç‰Œï¼Œä¸”ä»¤ç‰Œæ ¡éªŒé€šè¿‡(åˆæ³•)ï¼›å¦åˆ™éƒ½è¿”å›æœªç™»å½•é”™è¯¯ç»“æœ</strong></li></ul></li></ol><p>å…·ä½“æµç¨‹</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-471.png" alt="img"></p><p>åŸºäºä¸Šé¢çš„ä¸šåŠ¡æµç¨‹ï¼Œæˆ‘ä»¬åˆ†æå‡ºå…·ä½“çš„æ“ä½œæ­¥éª¤ï¼š</p><ol><li>è·å–è¯·æ±‚url</li><li>åˆ¤æ–­è¯·æ±‚urlä¸­æ˜¯å¦åŒ…å«loginï¼Œå¦‚æœåŒ…å«ï¼Œè¯´æ˜æ˜¯ç™»å½•æ“ä½œï¼Œæ”¾è¡Œ</li><li>è·å–è¯·æ±‚å¤´ä¸­çš„ä»¤ç‰Œï¼ˆtokenï¼‰</li><li>åˆ¤æ–­ä»¤ç‰Œæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå“åº” 401</li><li>è§£ætokenï¼Œå¦‚æœè§£æå¤±è´¥ï¼Œå“åº” 401</li><li>æ”¾è¡Œ</li></ol><h4 id="2-3-3ä»£ç å®ç°">2.3.3ä»£ç å®ç°</h4><p>åœ¨ <code>com.itheima.filter</code> åŒ…ä¸‹åˆ›å»º<code>TokenFilter</code>ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.utils.JwtUtils;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.*;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** * ä»¤ç‰Œæ ¡éªŒè¿‡æ»¤å™¨ */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@WebFilter(urlPatterns = &quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TokenFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest req, ServletResponse resp, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) req;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> (HttpServletResponse) resp;</span><br><span class="line">        <span class="comment">//1. è·å–è¯·æ±‚urlã€‚</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> request.getRequestURL().toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. åˆ¤æ–­è¯·æ±‚urlä¸­æ˜¯å¦åŒ…å«loginï¼Œå¦‚æœåŒ…å«ï¼Œè¯´æ˜æ˜¯ç™»å½•æ“ä½œï¼Œæ”¾è¡Œã€‚</span></span><br><span class="line">        <span class="keyword">if</span>(url.contains(<span class="string">&quot;login&quot;</span>))&#123; <span class="comment">//ç™»å½•è¯·æ±‚</span></span><br><span class="line">            log.info(<span class="string">&quot;ç™»å½•è¯·æ±‚ , ç›´æ¥æ”¾è¡Œ&quot;</span>);</span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. è·å–è¯·æ±‚å¤´ä¸­çš„ä»¤ç‰Œï¼ˆtokenï¼‰ã€‚</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. åˆ¤æ–­ä»¤ç‰Œæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯ç»“æœï¼ˆæœªç™»å½•ï¼‰ã€‚</span></span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.hasLength(jwt))&#123; <span class="comment">//jwtä¸ºç©º</span></span><br><span class="line">            log.info(<span class="string">&quot;è·å–åˆ°jwtä»¤ç‰Œä¸ºç©º, è¿”å›é”™è¯¯ç»“æœ&quot;</span>);</span><br><span class="line">            response.setStatus(HttpStatus.SC_UNAUTHORIZED);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. è§£ætokenï¼Œå¦‚æœè§£æå¤±è´¥ï¼Œè¿”å›é”™è¯¯ç»“æœï¼ˆæœªç™»å½•ï¼‰ã€‚</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            JwtUtils.parseJWT(jwt);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            log.info(<span class="string">&quot;è§£æä»¤ç‰Œå¤±è´¥, è¿”å›é”™è¯¯ç»“æœ&quot;</span>);</span><br><span class="line">            response.setStatus(HttpStatus.SC_UNAUTHORIZED);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6. æ”¾è¡Œã€‚</span></span><br><span class="line">        log.info(<span class="string">&quot;ä»¤ç‰Œåˆæ³•, æ”¾è¡Œ&quot;</span>);</span><br><span class="line">        chain.doFilter(request , response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-3-4Filterè¯¦è§£">2.3.4Filterè¯¦è§£</h4><p>Filterè¿‡æ»¤å™¨çš„å¿«é€Ÿå…¥é—¨ç¨‹åºæˆ‘ä»¬å·²ç»å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦è¯¦ç»†çš„ä»‹ç»ä¸€ä¸‹è¿‡æ»¤å™¨Filteråœ¨ä½¿ç”¨ä¸­çš„ä¸€äº›ç»†èŠ‚ã€‚ä¸»è¦ä»‹ç»ä»¥ä¸‹3ä¸ªæ–¹é¢çš„ç»†èŠ‚ï¼š</p><ol><li>è¿‡æ»¤å™¨çš„æ‰§è¡Œæµç¨‹</li><li>è¿‡æ»¤å™¨çš„æ‹¦æˆªè·¯å¾„é…ç½®</li><li>è¿‡æ»¤å™¨é“¾</li></ol><ul><li>æ‰§è¡Œæµç¨‹</li></ul><p>é¦–å…ˆæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹è¿‡æ»¤å™¨çš„æ‰§è¡Œæµç¨‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-490.png" alt="img"></p><p>è¿‡æ»¤å™¨å½“ä¸­æˆ‘ä»¬æ‹¦æˆªåˆ°äº†è¯·æ±‚ä¹‹åï¼Œå¦‚æœå¸Œæœ›ç»§ç»­è®¿é—®åé¢çš„webèµ„æºï¼Œå°±è¦æ‰§è¡Œæ”¾è¡Œæ“ä½œï¼Œæ”¾è¡Œå°±æ˜¯è°ƒç”¨ FilterChainå¯¹è±¡å½“ä¸­çš„doFilter()æ–¹æ³•ï¼Œåœ¨è°ƒç”¨doFilter()è¿™ä¸ªæ–¹æ³•ä¹‹å‰æ‰€ç¼–å†™çš„ä»£ç å±äºæ”¾è¡Œä¹‹å‰çš„é€»è¾‘ã€‚</p><p>åœ¨æ”¾è¡Œåè®¿é—®å®Œ web èµ„æºä¹‹åè¿˜ä¼šå›åˆ°è¿‡æ»¤å™¨å½“ä¸­ï¼Œå›åˆ°è¿‡æ»¤å™¨ä¹‹åå¦‚æœ‰éœ€æ±‚è¿˜å¯ä»¥æ‰§è¡Œæ”¾è¡Œä¹‹åçš„é€»è¾‘ï¼Œæ”¾è¡Œä¹‹åçš„é€»è¾‘æˆ‘ä»¬å†™åœ¨doFilter()è¿™è¡Œä»£ç ä¹‹åã€‚</p><p>æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebFilter</span>(urlPatterns = <span class="string">&quot;/*&quot;</span>) </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">//åˆå§‹åŒ–æ–¹æ³•, åªè°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;init åˆå§‹åŒ–æ–¹æ³•æ‰§è¡Œäº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;DemoFilter   æ”¾è¡Œå‰é€»è¾‘.....&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ”¾è¡Œè¯·æ±‚</span></span><br><span class="line">        filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;DemoFilter   æ”¾è¡Œåé€»è¾‘.....&quot;</span>);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">//é”€æ¯æ–¹æ³•, åªè°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;destroy é”€æ¯æ–¹æ³•æ‰§è¡Œäº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ä¹‹åè¿è¡Œæµ‹è¯•ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-491.png" alt="img"></p><ul><li>æ‹¦æˆªè·¯å¾„</li></ul><p>æ‰§è¡Œæµç¨‹æˆ‘ä»¬ææ¸…æ¥šä¹‹åï¼Œæ¥ä¸‹æ¥å†æ¥ä»‹ç»ä¸€ä¸‹è¿‡æ»¤å™¨çš„æ‹¦æˆªè·¯å¾„ï¼ŒFilterå¯ä»¥æ ¹æ®éœ€æ±‚ï¼Œé…ç½®ä¸åŒçš„æ‹¦æˆªèµ„æºè·¯å¾„ï¼š</p><table><thead><tr><th>æ‹¦æˆªè·¯å¾„</th><th>urlPatternså€¼</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>æ‹¦æˆªå…·ä½“è·¯å¾„</td><td>/login</td><td>åªæœ‰è®¿é—® /login è·¯å¾„æ—¶ï¼Œæ‰ä¼šè¢«æ‹¦æˆª</td></tr><tr><td>ç›®å½•æ‹¦æˆª</td><td>/emps/*</td><td>è®¿é—®/empsä¸‹çš„æ‰€æœ‰èµ„æºï¼Œéƒ½ä¼šè¢«æ‹¦æˆª</td></tr><tr><td>æ‹¦æˆªæ‰€æœ‰</td><td>/*</td><td>è®¿é—®æ‰€æœ‰èµ„æºï¼Œéƒ½ä¼šè¢«æ‹¦æˆª</td></tr></tbody></table><p>ä¸‹é¢æˆ‘ä»¬æ¥æµ‹è¯•&quot;æ‹¦æˆªå…·ä½“è·¯å¾„&quot;ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebFilter</span>(urlPatterns = <span class="string">&quot;/login&quot;</span>)  <span class="comment">//æ‹¦æˆª/loginå…·ä½“è·¯å¾„</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;DemoFilter   æ”¾è¡Œå‰é€»è¾‘.....&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ”¾è¡Œè¯·æ±‚</span></span><br><span class="line">        filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;DemoFilter   æ”¾è¡Œåé€»è¾‘.....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        Filter.<span class="keyword">super</span>.init(filterConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Filter.<span class="keyword">super</span>.destroy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿‡æ»¤å™¨é“¾</li></ul><p>æœ€åæˆ‘ä»¬åœ¨æ¥ä»‹ç»ä¸‹è¿‡æ»¤å™¨é“¾ï¼Œä»€ä¹ˆæ˜¯è¿‡æ»¤å™¨é“¾å‘¢ï¼Ÿæ‰€è°“è¿‡æ»¤å™¨é“¾æŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªwebåº”ç”¨ç¨‹åºå½“ä¸­ï¼Œå¯ä»¥é…ç½®å¤šä¸ªè¿‡æ»¤å™¨ï¼Œå¤šä¸ªè¿‡æ»¤å™¨å°±å½¢æˆäº†ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-492.png" alt="img"></p><p>æ¯”å¦‚ï¼šåœ¨æˆ‘ä»¬webæœåŠ¡å™¨å½“ä¸­ï¼Œå®šä¹‰äº†ä¸¤ä¸ªè¿‡æ»¤å™¨ï¼Œè¿™ä¸¤ä¸ªè¿‡æ»¤å™¨å°±å½¢æˆäº†ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ã€‚</p><p>è€Œè¿™ä¸ªé“¾ä¸Šçš„è¿‡æ»¤å™¨åœ¨æ‰§è¡Œçš„æ—¶å€™ä¼šä¸€ä¸ªä¸€ä¸ªçš„æ‰§è¡Œï¼Œä¼šå…ˆæ‰§è¡Œç¬¬ä¸€ä¸ªFilterï¼Œæ”¾è¡Œä¹‹åå†æ¥æ‰§è¡Œç¬¬äºŒä¸ªFilterï¼Œå¦‚æœæ‰§è¡Œåˆ°äº†æœ€åä¸€ä¸ªè¿‡æ»¤å™¨æ”¾è¡Œä¹‹åï¼Œæ‰ä¼šè®¿é—®å¯¹åº”çš„webèµ„æºã€‚</p><p>è®¿é—®å®Œwebèµ„æºä¹‹åï¼ŒæŒ‰ç…§æˆ‘ä»¬åˆšæ‰æ‰€ä»‹ç»çš„è¿‡æ»¤å™¨çš„æ‰§è¡Œæµç¨‹ï¼Œè¿˜ä¼šå›åˆ°è¿‡æ»¤å™¨å½“ä¸­æ¥æ‰§è¡Œè¿‡æ»¤å™¨æ”¾è¡Œåçš„é€»è¾‘ï¼Œè€Œåœ¨æ‰§è¡Œæ”¾è¡Œåçš„é€»è¾‘çš„æ—¶å€™ï¼Œé¡ºåºæ˜¯åç€çš„ã€‚</p><p>å…ˆè¦æ‰§è¡Œè¿‡æ»¤å™¨2æ”¾è¡Œä¹‹åçš„é€»è¾‘ï¼Œå†æ¥æ‰§è¡Œè¿‡æ»¤å™¨1æ”¾è¡Œä¹‹åçš„é€»è¾‘ï¼Œæœ€ååœ¨ç»™æµè§ˆå™¨å“åº”æ•°æ®ã€‚</p><p>è¿‡æ»¤å™¨é“¾ä¸Šè¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåºï¼šæ³¨è§£é…ç½®çš„Filterï¼Œä¼˜å…ˆçº§æ˜¯æŒ‰ç…§è¿‡æ»¤å™¨ç±»åï¼ˆå­—ç¬¦ä¸²ï¼‰çš„è‡ªç„¶æ’åºã€‚ æ¯”å¦‚ï¼š</p><ul><li>AbcFilter</li><li>DemoFilter</li></ul><p>è¿™ä¸¤ä¸ªè¿‡æ»¤å™¨æ¥è¯´ï¼ŒAbcFilter ä¼šå…ˆæ‰§è¡Œï¼ŒDemoFilterä¼šåæ‰§è¡Œã€‚</p><h3 id="2-4æ‹¦æˆªå™¨Interceptor">2.4æ‹¦æˆªå™¨Interceptor</h3><h4 id="2-4-1å¿«é€Ÿå…¥é—¨">2.4.1å¿«é€Ÿå…¥é—¨</h4><p><strong>ä»€ä¹ˆæ˜¯æ‹¦æˆªå™¨ï¼Ÿ</strong></p><ul><li>æ˜¯ä¸€ç§åŠ¨æ€æ‹¦æˆªæ–¹æ³•è°ƒç”¨çš„æœºåˆ¶ï¼Œç±»ä¼¼äºè¿‡æ»¤å™¨ã€‚</li><li>æ‹¦æˆªå™¨æ˜¯Springæ¡†æ¶ä¸­æä¾›çš„ï¼Œç”¨æ¥åŠ¨æ€æ‹¦æˆªæ§åˆ¶å™¨æ–¹æ³•çš„æ‰§è¡Œã€‚</li><li>æ‹¦æˆªå™¨çš„ä½œç”¨ï¼šæ‹¦æˆªè¯·æ±‚ï¼Œåœ¨æŒ‡å®šæ–¹æ³•è°ƒç”¨å‰åï¼Œæ ¹æ®ä¸šåŠ¡éœ€è¦æ‰§è¡Œé¢„å…ˆè®¾å®šçš„ä»£ç ã€‚</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-493.png" alt="img"></p><p>åœ¨æ‹¦æˆªå™¨å½“ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¹Ÿæ˜¯åšä¸€äº›é€šç”¨æ€§çš„æ“ä½œï¼Œæ¯”å¦‚ï¼šæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‹¦æˆªå™¨æ¥æ‹¦æˆªå‰ç«¯å‘èµ·çš„è¯·æ±‚ï¼Œå°†ç™»å½•æ ¡éªŒçš„é€»è¾‘å…¨éƒ¨ç¼–å†™åœ¨æ‹¦æˆªå™¨å½“ä¸­ã€‚åœ¨æ ¡éªŒçš„è¿‡ç¨‹å½“ä¸­ï¼Œå¦‚å‘ç°ç”¨æˆ·ç™»å½•äº†(æºå¸¦JWTä»¤ç‰Œä¸”æ˜¯åˆæ³•ä»¤ç‰Œ)ï¼Œå°±å¯ä»¥ç›´æ¥æ”¾è¡Œï¼Œå»è®¿é—®springå½“ä¸­çš„èµ„æºã€‚å¦‚æœæ ¡éªŒæ—¶å‘ç°å¹¶æ²¡æœ‰ç™»å½•æˆ–æ˜¯éæ³•ä»¤ç‰Œï¼Œå°±å¯ä»¥ç›´æ¥ç»™å‰ç«¯å“åº”æœªç™»å½•çš„é”™è¯¯ä¿¡æ¯ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡å¿«é€Ÿå…¥é—¨ç¨‹åºï¼Œæ¥å­¦ä¹ ä¸‹æ‹¦æˆªå™¨çš„åŸºæœ¬ä½¿ç”¨ã€‚æ‹¦æˆªå™¨çš„ä½¿ç”¨æ­¥éª¤å’Œè¿‡æ»¤å™¨ç±»ä¼¼ï¼Œä¹Ÿåˆ†ä¸ºä¸¤æ­¥ï¼š</p><ol><li>å®šä¹‰æ‹¦æˆªå™¨</li><li>æ³¨å†Œé…ç½®æ‹¦æˆªå™¨</li></ol><p><strong>1). è‡ªå®šä¹‰æ‹¦æˆªå™¨</strong></p><p>å®ç°HandlerInterceptoræ¥å£ï¼Œå¹¶é‡å†™å…¶æ‰€æœ‰æ–¹æ³•</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è‡ªå®šä¹‰æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="comment">//ç›®æ ‡èµ„æºæ–¹æ³•æ‰§è¡Œå‰æ‰§è¡Œã€‚ è¿”å›trueï¼šæ”¾è¡Œ    è¿”å›falseï¼šä¸æ”¾è¡Œ</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object <span class="keyword">handler</span>)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;preHandle .... &quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>; <span class="comment">//trueè¡¨ç¤ºæ”¾è¡Œ</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç›®æ ‡èµ„æºæ–¹æ³•æ‰§è¡Œåæ‰§è¡Œ</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object <span class="keyword">handler</span>, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;postHandle ... &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è§†å›¾æ¸²æŸ“å®Œæ¯•åæ‰§è¡Œï¼Œæœ€åæ‰§è¡Œ</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object <span class="keyword">handler</span>, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterCompletion .... &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><ul><li>preHandleæ–¹æ³•ï¼šç›®æ ‡èµ„æºæ–¹æ³•æ‰§è¡Œå‰æ‰§è¡Œã€‚ è¿”å›trueï¼šæ”¾è¡Œ è¿”å›falseï¼šä¸æ”¾è¡Œ</li><li>postHandleæ–¹æ³•ï¼šç›®æ ‡èµ„æºæ–¹æ³•æ‰§è¡Œåæ‰§è¡Œ</li><li>afterCompletionæ–¹æ³•ï¼šè§†å›¾æ¸²æŸ“å®Œæ¯•åæ‰§è¡Œï¼Œæœ€åæ‰§è¡Œ</li></ul><p><strong>2). æ³¨å†Œé…ç½®æ‹¦æˆªå™¨</strong></p><p>åœ¨ <code>com.itheima</code>ä¸‹åˆ›å»ºä¸€ä¸ªåŒ…ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªé…ç½®ç±» <code>WebConfig</code>ï¼Œ å®ç° <code>WebMvcConfigurer</code> æ¥å£ï¼Œå¹¶é‡å†™ <code>addInterceptors</code> æ–¹æ³•</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨å¯¹è±¡</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">DemoInterceptor</span> demoInterceptor;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">addInterceptors</span>(<span class="params"><span class="title class_">InterceptorRegistry</span> registry</span>) &#123;</span><br><span class="line">       <span class="comment">//æ³¨å†Œè‡ªå®šä¹‰æ‹¦æˆªå™¨å¯¹è±¡</span></span><br><span class="line">        registry.<span class="title function_">addInterceptor</span>(demoInterceptor).<span class="title function_">addPathPatterns</span>(<span class="string">&quot;/**&quot;</span>);<span class="comment">//è®¾ç½®æ‹¦æˆªå™¨æ‹¦æˆªçš„è¯·æ±‚è·¯å¾„ï¼ˆ /** è¡¨ç¤ºæ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼‰</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡æ–°å¯åŠ¨SpringBootæœåŠ¡ï¼Œæ‰“å¼€Apifoxæµ‹è¯•ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-494.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°æ§åˆ¶å°è¾“å‡ºçš„æ—¥å¿—ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-495.png" alt="img"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥åšä¸€ä¸ªæµ‹è¯•ï¼šå°†æ‹¦æˆªå™¨ä¸­è¿”å›å€¼æ”¹ä¸ºfalse</p><p>ä½¿ç”¨Apifoxï¼Œå†æ¬¡ç‚¹å‡»sendå‘é€è¯·æ±‚åï¼Œæ²¡æœ‰å“åº”æ•°æ®ï¼Œè¯´æ˜è¯·æ±‚è¢«æ‹¦æˆªäº†æ²¡æœ‰æ”¾è¡Œ</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-496.png" alt="img"></p><h4 id="2-4-2ç‰Œæ ¡éªŒInterceptor">2.4.2ç‰Œæ ¡éªŒInterceptor</h4><p>é€šè¿‡æ‹¦æˆªå™¨æ¥å®Œæˆæ¡ˆä¾‹å½“ä¸­çš„ç™»å½•æ ¡éªŒåŠŸèƒ½ã€‚</p><p>ç™»å½•æ ¡éªŒçš„ä¸šåŠ¡é€»è¾‘ä»¥åŠæ“ä½œæ­¥éª¤æˆ‘ä»¬å‰é¢å·²ç»åˆ†æè¿‡äº†ï¼Œå’Œç™»å½•æ ¡éªŒFilterè¿‡æ»¤å™¨å½“ä¸­çš„é€»è¾‘æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚ç°åœ¨æˆ‘ä»¬åªéœ€è¦æŠŠè¿™ä¸ªæŠ€æœ¯æ–¹æ¡ˆç”±åŸæ¥çš„è¿‡æ»¤å™¨æ¢æˆæ‹¦æˆªå™¨interceptorå°±å¯ä»¥äº†ã€‚</p><p><strong>1). TokenInterceptor</strong></p><p>åœ¨ <code>com.itheima.interceptor</code> åŒ…ä¸‹åˆ›å»º <code>TokenInterceptor</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TokenInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1. è·å–è¯·æ±‚urlã€‚</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> request.getRequestURL().toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. åˆ¤æ–­è¯·æ±‚urlä¸­æ˜¯å¦åŒ…å«loginï¼Œå¦‚æœåŒ…å«ï¼Œè¯´æ˜æ˜¯ç™»å½•æ“ä½œï¼Œæ”¾è¡Œã€‚</span></span><br><span class="line">        <span class="keyword">if</span>(url.contains(<span class="string">&quot;login&quot;</span>))&#123; <span class="comment">//ç™»å½•è¯·æ±‚</span></span><br><span class="line">            log.info(<span class="string">&quot;ç™»å½•è¯·æ±‚ , ç›´æ¥æ”¾è¡Œ&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. è·å–è¯·æ±‚å¤´ä¸­çš„ä»¤ç‰Œï¼ˆtokenï¼‰ã€‚</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. åˆ¤æ–­ä»¤ç‰Œæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯ç»“æœï¼ˆæœªç™»å½•ï¼‰ã€‚</span></span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.hasLength(jwt))&#123; <span class="comment">//jwtä¸ºç©º</span></span><br><span class="line">            log.info(<span class="string">&quot;è·å–åˆ°jwtä»¤ç‰Œä¸ºç©º, è¿”å›é”™è¯¯ç»“æœ&quot;</span>);</span><br><span class="line">            response.setStatus(HttpStatus.SC_UNAUTHORIZED);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. è§£ætokenï¼Œå¦‚æœè§£æå¤±è´¥ï¼Œè¿”å›é”™è¯¯ç»“æœï¼ˆæœªç™»å½•ï¼‰ã€‚</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            JwtUtils.parseJWT(jwt);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            log.info(<span class="string">&quot;è§£æä»¤ç‰Œå¤±è´¥, è¿”å›é”™è¯¯ç»“æœ&quot;</span>);</span><br><span class="line">            response.setStatus(HttpStatus.SC_UNAUTHORIZED);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6. æ”¾è¡Œã€‚</span></span><br><span class="line">        log.info(<span class="string">&quot;ä»¤ç‰Œåˆæ³•, æ”¾è¡Œ&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2). é…ç½®æ‹¦æˆªå™¨</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="comment">//æ‹¦æˆªå™¨å¯¹è±¡</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">TokenInterceptor</span> tokenInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">addInterceptors</span>(<span class="params"><span class="title class_">InterceptorRegistry</span> registry</span>) &#123;</span><br><span class="line">       <span class="comment">//æ³¨å†Œè‡ªå®šä¹‰æ‹¦æˆªå™¨å¯¹è±¡</span></span><br><span class="line">        registry.<span class="title function_">addInterceptor</span>(tokenInterceptor).<span class="title function_">addPathPatterns</span>(<span class="string">&quot;/**&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç™»å½•æ ¡éªŒçš„æ‹¦æˆªå™¨ç¼–å†™å®Œæˆåï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥é‡æ–°å¯åŠ¨æœåŠ¡æ¥åšä¸€ä¸ªæµ‹è¯•ï¼š ï¼ˆ<strong>å…³é—­ç™»å½•æ ¡éªŒFilterè¿‡æ»¤å™¨</strong>ï¼‰</p><h4 id="2-4-3nterceptorè¯¦è§£">2.4.3nterceptorè¯¦è§£</h4><p>æ‹¦æˆªå™¨çš„ä½¿ç”¨ç»†èŠ‚æˆ‘ä»¬ä¸»è¦ä»‹ç»ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ol><li>æ‹¦æˆªå™¨çš„æ‹¦æˆªè·¯å¾„é…ç½®</li><li>æ‹¦æˆªå™¨çš„æ‰§è¡Œæµç¨‹</li></ol><ul><li>æ‹¦æˆªè·¯å¾„</li></ul><p>é¦–å…ˆæˆ‘ä»¬å…ˆæ¥çœ‹æ‹¦æˆªå™¨çš„æ‹¦æˆªè·¯å¾„çš„é…ç½®ï¼Œåœ¨æ³¨å†Œé…ç½®æ‹¦æˆªå™¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦æŒ‡å®šæ‹¦æˆªå™¨çš„æ‹¦æˆªè·¯å¾„ï¼Œé€šè¿‡<code>addPathPatterns(&quot;è¦æ‹¦æˆªè·¯å¾„&quot;)</code>æ–¹æ³•ï¼Œå°±å¯ä»¥æŒ‡å®šè¦æ‹¦æˆªå“ªäº›èµ„æºã€‚</p><p>åœ¨å…¥é—¨ç¨‹åºä¸­æˆ‘ä»¬é…ç½®çš„æ˜¯<code>/**</code>ï¼Œè¡¨ç¤ºæ‹¦æˆªæ‰€æœ‰èµ„æºï¼Œè€Œåœ¨é…ç½®æ‹¦æˆªå™¨æ—¶ï¼Œä¸ä»…å¯ä»¥æŒ‡å®šè¦æ‹¦æˆªå“ªäº›èµ„æºï¼Œè¿˜å¯ä»¥æŒ‡å®šä¸æ‹¦æˆªå“ªäº›èµ„æºï¼Œåªéœ€è¦è°ƒç”¨<code>excludePathPatterns(&quot;ä¸æ‹¦æˆªè·¯å¾„&quot;)</code>æ–¹æ³•ï¼ŒæŒ‡å®šå“ªäº›èµ„æºä¸éœ€è¦æ‹¦æˆªã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ‹¦æˆªå™¨å¯¹è±¡</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">DemoInterceptor</span> demoInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">addInterceptors</span>(<span class="params"><span class="title class_">InterceptorRegistry</span> registry</span>) &#123;</span><br><span class="line">        <span class="comment">//æ³¨å†Œè‡ªå®šä¹‰æ‹¦æˆªå™¨å¯¹è±¡</span></span><br><span class="line">        registry.<span class="title function_">addInterceptor</span>(demoInterceptor)</span><br><span class="line">                .<span class="title function_">addPathPatterns</span>(<span class="string">&quot;/**&quot;</span>)<span class="comment">//è®¾ç½®æ‹¦æˆªå™¨æ‹¦æˆªçš„è¯·æ±‚è·¯å¾„ï¼ˆ /** è¡¨ç¤ºæ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼‰</span></span><br><span class="line">                .<span class="title function_">excludePathPatterns</span>(<span class="string">&quot;/login&quot;</span>);<span class="comment">//è®¾ç½®ä¸æ‹¦æˆªçš„è¯·æ±‚è·¯å¾„</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ‹¦æˆªå™¨ä¸­é™¤äº†å¯ä»¥è®¾ç½®<code>/**</code>æ‹¦æˆªæ‰€æœ‰èµ„æºå¤–ï¼Œè¿˜æœ‰ä¸€äº›å¸¸è§æ‹¦æˆªè·¯å¾„è®¾ç½®ï¼š</p><table><thead><tr><th>æ‹¦æˆªè·¯å¾„</th><th>å«ä¹‰</th><th>ä¸¾ä¾‹</th></tr></thead><tbody><tr><td>/*</td><td>ä¸€çº§è·¯å¾„</td><td>èƒ½åŒ¹é…/deptsï¼Œ/empsï¼Œ/loginï¼Œä¸èƒ½åŒ¹é… /depts/1</td></tr><tr><td>/**</td><td>ä»»æ„çº§è·¯å¾„</td><td>èƒ½åŒ¹é…/deptsï¼Œ/depts/1ï¼Œ/depts/1/2</td></tr><tr><td>/depts/*</td><td>/deptsä¸‹çš„ä¸€çº§è·¯å¾„</td><td>èƒ½åŒ¹é…/depts/1ï¼Œä¸èƒ½åŒ¹é…/depts/1/2ï¼Œ/depts</td></tr><tr><td>/depts/**</td><td>/deptsä¸‹çš„ä»»æ„çº§è·¯å¾„</td><td>èƒ½åŒ¹é…/deptsï¼Œ/depts/1ï¼Œ/depts/1/2ï¼Œä¸èƒ½åŒ¹é…/emps/1</td></tr></tbody></table><ul><li>æ‰§è¡Œæµç¨‹</li></ul><p>ä»‹ç»å®Œæ‹¦æˆªè·¯å¾„çš„é…ç½®ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥ä»‹ç»æ‹¦æˆªå™¨çš„æ‰§è¡Œæµç¨‹ã€‚é€šè¿‡æ‰§è¡Œæµç¨‹ï¼Œå°±èƒ½å¤Ÿæ¸…æ™°çš„çŸ¥é“è¿‡æ»¤å™¨ä¸æ‹¦æˆªå™¨çš„æ‰§è¡Œæ—¶æœºã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-504-1024x348.png" alt="img"></p><ul><li>å½“æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨æ¥è®¿é—®éƒ¨ç½²åœ¨webæœåŠ¡å™¨å½“ä¸­çš„webåº”ç”¨æ—¶ï¼Œæ­¤æ—¶æˆ‘ä»¬æ‰€å®šä¹‰çš„è¿‡æ»¤å™¨ä¼šæ‹¦æˆªåˆ°è¿™æ¬¡è¯·æ±‚ã€‚æ‹¦æˆªåˆ°è¿™æ¬¡è¯·æ±‚ä¹‹åï¼Œå®ƒä¼šå…ˆæ‰§è¡Œæ”¾è¡Œå‰çš„é€»è¾‘ï¼Œç„¶åå†æ‰§è¡Œæ”¾è¡Œæ“ä½œã€‚è€Œç”±äºæˆ‘ä»¬å½“å‰æ˜¯åŸºäºspringbootå¼€å‘çš„ï¼Œæ‰€ä»¥æ”¾è¡Œä¹‹åæ˜¯è¿›å…¥åˆ°äº†springçš„ç¯å¢ƒå½“ä¸­ï¼Œä¹Ÿå°±æ˜¯è¦æ¥è®¿é—®æˆ‘ä»¬æ‰€å®šä¹‰çš„controllerå½“ä¸­çš„æ¥å£æ–¹æ³•ã€‚</li><li>Tomcatå¹¶ä¸è¯†åˆ«æ‰€ç¼–å†™çš„Controllerç¨‹åºï¼Œä½†æ˜¯å®ƒè¯†åˆ«Servletç¨‹åºï¼Œæ‰€ä»¥åœ¨Springçš„Webç¯å¢ƒä¸­æä¾›äº†ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„Servletï¼šDispatcherServletï¼ˆå‰ç«¯æ§åˆ¶å™¨ï¼‰ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼šå…ˆè¿›è¡Œåˆ°DispatcherServletï¼Œå†å°†è¯·æ±‚è½¬ç»™Controllerã€‚</li><li>å½“æˆ‘ä»¬å®šä¹‰äº†æ‹¦æˆªå™¨åï¼Œä¼šåœ¨æ‰§è¡ŒControllerçš„æ–¹æ³•ä¹‹å‰ï¼Œè¯·æ±‚è¢«æ‹¦æˆªå™¨æ‹¦æˆªä½ã€‚æ‰§è¡Œ<code>preHandle()</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ‰§è¡Œå®Œæˆåéœ€è¦è¿”å›ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„å€¼ï¼Œå¦‚æœè¿”å›trueï¼Œå°±è¡¨ç¤ºæ”¾è¡Œæœ¬æ¬¡æ“ä½œï¼Œæ‰ä¼šç»§ç»­è®¿é—®controllerä¸­çš„æ–¹æ³•ï¼›å¦‚æœè¿”å›falseï¼Œåˆ™ä¸ä¼šæ”¾è¡Œï¼ˆcontrollerä¸­çš„æ–¹æ³•ä¹Ÿä¸ä¼šæ‰§è¡Œï¼‰ã€‚</li><li>åœ¨controllerå½“ä¸­çš„æ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œå†å›è¿‡æ¥æ‰§è¡Œ<code>postHandle()</code>è¿™ä¸ªæ–¹æ³•ä»¥åŠ<code>afterCompletion()</code> æ–¹æ³•ï¼Œç„¶åå†è¿”å›ç»™DispatcherServletï¼Œæœ€ç»ˆå†æ¥æ‰§è¡Œè¿‡æ»¤å™¨å½“ä¸­æ”¾è¡Œåçš„è¿™ä¸€éƒ¨åˆ†é€»è¾‘çš„é€»è¾‘ã€‚æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œæœ€ç»ˆç»™æµè§ˆå™¨å“åº”æ•°æ®ã€‚</li></ul><p>ä»¥ä¸Šå°±æ˜¯æ‹¦æˆªå™¨çš„æ‰§è¡Œæµç¨‹ã€‚é€šè¿‡æ‰§è¡Œæµç¨‹åˆ†æï¼Œå¤§å®¶åº”è¯¥å·²ç»æ¸…æ¥šäº†è¿‡æ»¤å™¨å’Œæ‹¦æˆªå™¨ä¹‹é—´çš„åŒºåˆ«ï¼Œå…¶å®å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ä¸»è¦æ˜¯ä¸¤ç‚¹ï¼š</p><ul><li><strong>æ¥å£è§„èŒƒä¸åŒï¼šè¿‡æ»¤å™¨éœ€è¦å®ç°Filteræ¥å£ï¼Œè€Œæ‹¦æˆªå™¨éœ€è¦å®ç°HandlerInterceptoræ¥å£ã€‚</strong></li><li><strong>æ‹¦æˆªèŒƒå›´ä¸åŒï¼šè¿‡æ»¤å™¨Filterä¼šæ‹¦æˆªæ‰€æœ‰çš„èµ„æºï¼Œè€ŒInterceptoråªä¼šæ‹¦æˆªSpringç¯å¢ƒä¸­çš„èµ„æºã€‚</strong></li></ul><h1 id="5-AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰">5.AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰</h1><h2 id="1-AOPåŸºç¡€">1.AOPåŸºç¡€</h2><h3 id="1-1AOPå…¥é—¨">1.1AOPå…¥é—¨</h3><p><strong>ä»€ä¹ˆæ˜¯AOPï¼Ÿ</strong></p><p>AOPï¼šAspect Oriented Programmingï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ã€é¢å‘æ–¹é¢ç¼–ç¨‹ï¼‰ï¼Œå…¶å®è¯´ç™½äº†ï¼Œé¢å‘åˆ‡é¢ç¼–ç¨‹å°±æ˜¯é¢å‘ç‰¹å®šæ–¹æ³•ç¼–ç¨‹ã€‚</p><p>é‚£ä»€ä¹ˆåˆæ˜¯é¢å‘æ–¹æ³•ç¼–ç¨‹å‘¢ï¼Œä¸ºä»€ä¹ˆåˆéœ€è¦é¢å‘æ–¹æ³•ç¼–ç¨‹å‘¢ï¼Ÿ</p><p>æ¥ï¼Œæˆ‘ä»¬ä¸¾ä¸ªä¾‹å­åšä¸€ä¸ªè¯´æ˜ï¼š</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬è¿™é‡Œæœ‰ä¸€ä¸ªé¡¹ç›®ï¼Œé¡¹ç›®ä¸­å¼€å‘äº†å¾ˆå¤šçš„ä¸šåŠ¡åŠŸèƒ½ã€‚ç„¶è€Œæœ‰ä¸€äº›ä¸šåŠ¡åŠŸèƒ½æ‰§è¡Œæ•ˆç‡æ¯”è¾ƒä½ï¼Œæ‰§è¡Œè€—æ—¶è¾ƒé•¿ï¼Œæˆ‘ä»¬éœ€è¦é’ˆå¯¹äºè¿™äº›ä¸šåŠ¡æ–¹æ³•è¿›è¡Œä¼˜åŒ–ã€‚ é‚£é¦–å…ˆç¬¬ä¸€æ­¥å°±éœ€è¦å®šä½å‡ºæ‰§è¡Œè€—æ—¶æ¯”è¾ƒé•¿çš„ä¸šåŠ¡æ–¹æ³•ï¼Œå†é’ˆå¯¹äºä¸šåŠ¡æ–¹æ³•å†æ¥è¿›è¡Œä¼˜åŒ–ã€‚</p><p>æ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦ç»Ÿè®¡å½“å‰è¿™ä¸ªé¡¹ç›®å½“ä¸­æ¯ä¸€ä¸ªä¸šåŠ¡æ–¹æ³•çš„æ‰§è¡Œè€—æ—¶ã€‚é‚£ä¹ˆç»Ÿè®¡æ¯ä¸€ä¸ªä¸šåŠ¡æ–¹æ³•çš„æ‰§è¡Œè€—æ—¶è¯¥æ€ä¹ˆå®ç°ï¼Ÿ</p><p>å¯èƒ½å¤šæ•°äººé¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯åœ¨æ¯ä¸€ä¸ªä¸šåŠ¡æ–¹æ³•è¿è¡Œä¹‹å‰ï¼Œè®°å½•è¿™ä¸ªæ–¹æ³•è¿è¡Œçš„å¼€å§‹æ—¶é—´ã€‚åœ¨è¿™ä¸ªæ–¹æ³•è¿è¡Œå®Œæ¯•ä¹‹åï¼Œå†æ¥è®°å½•è¿™ä¸ªæ–¹æ³•è¿è¡Œçš„ç»“æŸæ—¶é—´ã€‚æ‹¿ç»“æŸæ—¶é—´å‡å»å¼€å§‹æ—¶é—´ï¼Œä¸å°±æ˜¯è¿™ä¸ªæ–¹æ³•çš„æ‰§è¡Œè€—æ—¶å—ã€‚</p><p>è€Œè¿™ä¸ªåŠŸèƒ½å¦‚æœé€šè¿‡AOPæ¥å®ç°ï¼Œæˆ‘ä»¬åªéœ€è¦å•ç‹¬å®šä¹‰ä¸‹é¢è¿™ä¸€å°æ®µä»£ç å³å¯ï¼Œä¸éœ€è¦ä¿®æ”¹åŸå§‹çš„ä»»ä½•ä¸šåŠ¡æ–¹æ³•å³å¯è®°å½•æ¯ä¸€ä¸ªä¸šåŠ¡æ–¹æ³•çš„æ‰§è¡Œè€—æ—¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">//å½“å‰ç±»ä¸ºåˆ‡é¢ç±»</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RecordTimeAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;execution(* com.itheima.service.impl.DeptServiceImpl.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">recordTime</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">//è®°å½•æ–¹æ³•æ‰§è¡Œå¼€å§‹æ—¶é—´</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ‰§è¡ŒåŸå§‹æ–¹æ³•</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®°å½•æ–¹æ³•æ‰§è¡Œç»“æŸæ—¶é—´</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¡ç®—æ–¹æ³•æ‰§è¡Œè€—æ—¶</span></span><br><span class="line">        log.info(<span class="string">&quot;æ–¹æ³•æ‰§è¡Œè€—æ—¶: &#123;&#125;æ¯«ç§’&quot;</span>,end-begin);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¸¸è§çš„åº”ç”¨åœºæ™¯å¦‚ä¸‹ï¼š</p><ul><li>è®°å½•ç³»ç»Ÿçš„æ“ä½œæ—¥å¿—</li><li>æƒé™æ§åˆ¶</li><li>äº‹åŠ¡ç®¡ç†ï¼šæˆ‘ä»¬å‰é¢æ‰€è®²è§£çš„Springäº‹åŠ¡ç®¡ç†ï¼Œåº•å±‚å…¶å®ä¹Ÿæ˜¯é€šè¿‡AOPæ¥å®ç°çš„ï¼Œåªè¦æ·»åŠ @Transactionalæ³¨è§£ä¹‹åï¼ŒAOPç¨‹åºè‡ªåŠ¨ä¼šåœ¨åŸå§‹æ–¹æ³•è¿è¡Œå‰å…ˆæ¥å¼€å¯äº‹åŠ¡ï¼Œåœ¨åŸå§‹æ–¹æ³•è¿è¡Œå®Œæ¯•ä¹‹åæäº¤æˆ–å›æ»šäº‹åŠ¡</li></ul><p>è¿™äº›éƒ½æ˜¯AOPåº”ç”¨çš„å…¸å‹åœºæ™¯ã€‚</p><p>æ‰€ä»¥ï¼ŒAOPçš„ä¼˜åŠ¿ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å››ä¸ªæ–¹é¢ï¼š</p><ul><li>å‡å°‘é‡å¤ä»£ç ï¼šä¸éœ€è¦åœ¨ä¸šåŠ¡æ–¹æ³•ä¸­å®šä¹‰å¤§é‡çš„é‡å¤æ€§çš„ä»£ç ï¼Œåªéœ€è¦å°†é‡å¤æ€§çš„ä»£ç æŠ½å–åˆ°AOPç¨‹åºä¸­å³å¯ã€‚</li><li>ä»£ç æ— ä¾µå…¥ï¼šåœ¨åŸºäºAOPå®ç°è¿™äº›ä¸šåŠ¡åŠŸèƒ½æ—¶ï¼Œå¯¹åŸæœ‰çš„ä¸šåŠ¡ä»£ç æ˜¯æ²¡æœ‰ä»»ä½•ä¾µå…¥çš„ï¼Œä¸éœ€è¦ä¿®æ”¹ä»»ä½•çš„ä¸šåŠ¡ä»£ç ã€‚</li><li>æé«˜å¼€å‘æ•ˆç‡</li><li>ç»´æŠ¤æ–¹ä¾¿</li></ul><h3 id="1-2AOPæ ¸å¿ƒæ¦‚å¿µ">1.2AOPæ ¸å¿ƒæ¦‚å¿µ</h3><ul><li><p>è¿æ¥ç‚¹ï¼šJoinPoint</p><p>ï¼Œå¯ä»¥è¢«AOPæ§åˆ¶çš„æ–¹æ³•ï¼ˆæš—å«æ–¹æ³•æ‰§è¡Œæ—¶çš„ç›¸å…³ä¿¡æ¯ï¼‰</p><ul><li>è¿æ¥ç‚¹æŒ‡çš„æ˜¯å¯ä»¥è¢«aopæ§åˆ¶çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼šå…¥é—¨ç¨‹åºå½“ä¸­æ‰€æœ‰çš„ä¸šåŠ¡æ–¹æ³•éƒ½æ˜¯å¯ä»¥è¢«aopæ§åˆ¶çš„æ–¹æ³•ã€‚</li><li>åœ¨SpringAOPæä¾›çš„JoinPointå½“ä¸­ï¼Œå°è£…äº†è¿æ¥ç‚¹æ–¹æ³•åœ¨æ‰§è¡Œæ—¶çš„ç›¸å…³ä¿¡æ¯ã€‚ï¼ˆåé¢ä¼šæœ‰å…·ä½“çš„è®²è§£ï¼‰</li></ul></li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-472.png" alt="img"></p><ul><li><p>é€šçŸ¥ï¼šAdvice</p><p>ï¼ŒæŒ‡å“ªäº›é‡å¤çš„é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯å…±æ€§åŠŸèƒ½ï¼ˆæœ€ç»ˆä½“ç°ä¸ºä¸€ä¸ªæ–¹æ³•ï¼‰</p><ul><li>åœ¨å…¥é—¨ç¨‹åºä¸­æ˜¯éœ€è¦ç»Ÿè®¡å„ä¸ªä¸šåŠ¡æ–¹æ³•çš„æ‰§è¡Œè€—æ—¶çš„ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦åœ¨è¿™äº›ä¸šåŠ¡æ–¹æ³•è¿è¡Œå¼€å§‹ä¹‹å‰ï¼Œå…ˆè®°å½•è¿™ä¸ªæ–¹æ³•è¿è¡Œçš„å¼€å§‹æ—¶é—´ï¼Œåœ¨æ¯ä¸€ä¸ªä¸šåŠ¡æ–¹æ³•è¿è¡Œç»“æŸçš„æ—¶å€™ï¼Œå†æ¥è®°å½•è¿™ä¸ªæ–¹æ³•è¿è¡Œçš„ç»“æŸæ—¶é—´ã€‚</li><li>æ˜¯åœ¨AOPé¢å‘åˆ‡é¢ç¼–ç¨‹å½“ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦å°†è¿™éƒ¨åˆ†é‡å¤çš„ä»£ç é€»è¾‘æŠ½å–å‡ºæ¥å•ç‹¬å®šä¹‰ã€‚æŠ½å–å‡ºæ¥çš„è¿™ä¸€éƒ¨åˆ†é‡å¤çš„é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯å…±æ€§çš„åŠŸèƒ½ã€‚</li></ul></li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-473.png" alt="img"></p><ul><li><p>åˆ‡å…¥ç‚¹ï¼šPointCut</p><p>ï¼ŒåŒ¹é…è¿æ¥ç‚¹çš„æ¡ä»¶ï¼Œé€šçŸ¥ä»…ä¼šåœ¨åˆ‡å…¥ç‚¹æ–¹æ³•æ‰§è¡Œæ—¶è¢«åº”ç”¨ã€‚</p><ul><li>åœ¨é€šçŸ¥å½“ä¸­ï¼Œæˆ‘ä»¬æ‰€å®šä¹‰çš„å…±æ€§åŠŸèƒ½åˆ°åº•è¦åº”ç”¨åœ¨å“ªäº›æ–¹æ³•ä¸Šï¼Ÿæ­¤æ—¶å°±æ¶‰åŠåˆ°äº†åˆ‡å…¥ç‚¹pointcutæ¦‚å¿µã€‚åˆ‡å…¥ç‚¹æŒ‡çš„æ˜¯åŒ¹é…è¿æ¥ç‚¹çš„æ¡ä»¶ã€‚é€šçŸ¥ä»…ä¼šåœ¨åˆ‡å…¥ç‚¹æ–¹æ³•è¿è¡Œæ—¶æ‰ä¼šè¢«åº”ç”¨ã€‚</li><li>åœ¨aopçš„å¼€å‘å½“ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šé€šè¿‡ä¸€ä¸ªåˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ¥æè¿°åˆ‡å…¥ç‚¹(åé¢ä¼šæœ‰è¯¦è§£)ã€‚</li><li>å‡å¦‚ï¼šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ”¹ä¸ºDeptServiceImpl.list()ï¼Œæ­¤æ—¶å°±ä»£è¡¨ä»…ä»…åªæœ‰listè¿™ä¸€ä¸ªæ–¹æ³•æ˜¯åˆ‡å…¥ç‚¹ã€‚åªæœ‰list()æ–¹æ³•åœ¨è¿è¡Œçš„æ—¶å€™æ‰ä¼šåº”ç”¨é€šçŸ¥ã€‚</li></ul></li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-474.png" alt="img"></p><ul><li><strong>åˆ‡é¢ï¼šAspect</strong>ï¼Œæè¿°é€šçŸ¥ä¸åˆ‡å…¥ç‚¹çš„å¯¹åº”å…³ç³»ï¼ˆé€šçŸ¥+åˆ‡å…¥ç‚¹ï¼‰</li></ul><p>å½“é€šçŸ¥å’Œåˆ‡å…¥ç‚¹ç»“åˆåœ¨ä¸€èµ·ï¼Œå°±å½¢æˆäº†ä¸€ä¸ªåˆ‡é¢ã€‚é€šè¿‡åˆ‡é¢å°±èƒ½å¤Ÿæè¿°å½“å‰aopç¨‹åºéœ€è¦é’ˆå¯¹äºå“ªä¸ªåŸå§‹æ–¹æ³•ï¼Œåœ¨ä»€ä¹ˆæ—¶å€™æ‰§è¡Œä»€ä¹ˆæ ·çš„æ“ä½œã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-505.png" alt="img"></p><p>è€Œåˆ‡é¢æ‰€åœ¨çš„ç±»ï¼Œç§°ä¹‹ä¸ºåˆ‡é¢ç±»ï¼ˆè¢«<code>@Aspect</code>æ³¨è§£æ ‡è¯†çš„ç±»ï¼‰ã€‚</p><ul><li><strong>ç›®æ ‡å¯¹è±¡ï¼šTarget</strong>ï¼Œé€šçŸ¥æ‰€åº”ç”¨çš„å¯¹è±¡</li></ul><p>ç›®æ ‡å¯¹è±¡æŒ‡çš„å°±æ˜¯é€šçŸ¥æ‰€åº”ç”¨çš„å¯¹è±¡ï¼Œæˆ‘ä»¬å°±ç§°ä¹‹ä¸ºç›®æ ‡å¯¹è±¡ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-506.png" alt="img"></p><p>AOPçš„æ ¸å¿ƒæ¦‚å¿µæˆ‘ä»¬ä»‹ç»å®Œæ¯•ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥åˆ†æä¸€ä¸‹æˆ‘ä»¬æ‰€å®šä¹‰çš„é€šçŸ¥æ˜¯å¦‚ä½•ä¸ç›®æ ‡å¯¹è±¡ç»“åˆåœ¨ä¸€èµ·ï¼Œå¯¹ç›®æ ‡å¯¹è±¡å½“ä¸­çš„æ–¹æ³•è¿›è¡ŒåŠŸèƒ½å¢å¼ºçš„ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-507-1024x468.png" alt="img"></p><p>Springçš„AOPåº•å±‚æ˜¯åŸºäºåŠ¨æ€ä»£ç†æŠ€æœ¯æ¥å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨çš„åŸºäºåŠ¨æ€ä»£ç†æŠ€æœ¯ä¸ºç›®æ ‡å¯¹è±¡ç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„ä»£ç†å¯¹è±¡ã€‚åœ¨ä»£ç†å¯¹è±¡å½“ä¸­å°±ä¼šå¯¹ç›®æ ‡å¯¹è±¡å½“ä¸­çš„åŸå§‹æ–¹æ³•è¿›è¡ŒåŠŸèƒ½çš„å¢å¼ºã€‚</p><p>SpringAOP æ—¨åœ¨ç®¡ç†beanå¯¹è±¡çš„è¿‡ç¨‹ä¸­ï¼Œä¸»è¦é€šè¿‡åº•å±‚çš„åŠ¨æ€ä»£ç†æœºåˆ¶ï¼Œå¯¹ç‰¹å®šçš„æ–¹æ³•è¿›è¡Œç¼–ç¨‹ ã€‚</p><h2 id="2-AOPè¿›é˜¶">2.AOPè¿›é˜¶</h2><h3 id="2-1é€šçŸ¥ç±»å‹">2.1é€šçŸ¥ç±»å‹</h3><p>åœ¨å…¥é—¨ç¨‹åºå½“ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨äº†ä¸€ç§åŠŸèƒ½æœ€ä¸ºå¼ºå¤§çš„é€šçŸ¥ç±»å‹ï¼šAroundç¯ç»•é€šçŸ¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">//å½“å‰ç±»ä¸ºåˆ‡é¢ç±»</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TimeAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;execution(* com.itheima.service.impl.DeptServiceImpl.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">recordTime</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">//è®°å½•æ–¹æ³•æ‰§è¡Œå¼€å§‹æ—¶é—´</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">//æ‰§è¡ŒåŸå§‹æ–¹æ³•</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line">        <span class="comment">//è®°å½•æ–¹æ³•æ‰§è¡Œç»“æŸæ—¶é—´</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">//è®¡ç®—æ–¹æ³•æ‰§è¡Œè€—æ—¶</span></span><br><span class="line">        log.info(<span class="string">&quot;æ–¹æ³•æ‰§è¡Œè€—æ—¶: &#123;&#125;æ¯«ç§’&quot;</span>,end-begin);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªè¦æˆ‘ä»¬åœ¨é€šçŸ¥æ–¹æ³•ä¸ŠåŠ ä¸Šäº†<code>@Around</code>æ³¨è§£ï¼Œå°±ä»£è¡¨å½“å‰é€šçŸ¥æ˜¯ä¸€ä¸ªç¯ç»•é€šçŸ¥ã€‚</p><table><thead><tr><th><strong>Spring AOP é€šçŸ¥ç±»å‹</strong></th><th></th></tr></thead><tbody><tr><td>@Around</td><td>ç¯ç»•é€šçŸ¥ï¼Œæ­¤æ³¨è§£æ ‡æ³¨çš„é€šçŸ¥æ–¹æ³•åœ¨ç›®æ ‡æ–¹æ³•å‰ã€åéƒ½è¢«æ‰§è¡Œ</td></tr><tr><td>@Before</td><td>å‰ç½®é€šçŸ¥ï¼Œæ­¤æ³¨è§£æ ‡æ³¨çš„é€šçŸ¥æ–¹æ³•åœ¨ç›®æ ‡æ–¹æ³•å‰è¢«æ‰§è¡Œ</td></tr><tr><td>@After</td><td>åç½®é€šçŸ¥ï¼Œæ­¤æ³¨è§£æ ‡æ³¨çš„é€šçŸ¥æ–¹æ³•åœ¨ç›®æ ‡æ–¹æ³•åè¢«æ‰§è¡Œï¼Œæ— è®ºæ˜¯å¦æœ‰å¼‚å¸¸éƒ½ä¼šæ‰§è¡Œ</td></tr><tr><td>@AfterReturning</td><td>è¿”å›åé€šçŸ¥ï¼Œæ­¤æ³¨è§£æ ‡æ³¨çš„é€šçŸ¥æ–¹æ³•åœ¨ç›®æ ‡æ–¹æ³•åè¢«æ‰§è¡Œï¼Œæœ‰å¼‚å¸¸ä¸ä¼šæ‰§è¡Œ</td></tr><tr><td>@AfterThrowing</td><td>å¼‚å¸¸åé€šçŸ¥ï¼Œæ­¤æ³¨è§£æ ‡æ³¨çš„é€šçŸ¥æ–¹æ³•å‘ç”Ÿå¼‚å¸¸åæ‰§è¡Œ</td></tr></tbody></table><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä»£ç æ¼”ç¤ºï¼Œæ¥åŠ æ·±å¯¹äºä¸åŒé€šçŸ¥ç±»å‹çš„ç†è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect1</span> &#123;</span><br><span class="line">    <span class="comment">//å‰ç½®é€šçŸ¥</span></span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.itheima.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;before ...&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç¯ç»•é€šçŸ¥</span></span><br><span class="line">    <span class="meta">@Around(&quot;execution(* com.itheima.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        log.info(<span class="string">&quot;around before ...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„åŸå§‹æ–¹æ³•æ‰§è¡Œ</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> proceedingJoinPoint.proceed();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//åŸå§‹æ–¹æ³•å¦‚æœæ‰§è¡Œæ—¶æœ‰å¼‚å¸¸ï¼Œç¯ç»•é€šçŸ¥ä¸­çš„åç½®ä»£ç ä¸ä¼šåœ¨æ‰§è¡Œäº†</span></span><br><span class="line">        </span><br><span class="line">        log.info(<span class="string">&quot;around after ...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åç½®é€šçŸ¥</span></span><br><span class="line">    <span class="meta">@After(&quot;execution(* com.itheima.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;after ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿”å›åé€šçŸ¥ï¼ˆç¨‹åºåœ¨æ­£å¸¸æ‰§è¡Œçš„æƒ…å†µä¸‹ï¼Œä¼šæ‰§è¡Œçš„åç½®é€šçŸ¥ï¼‰</span></span><br><span class="line">    <span class="meta">@AfterReturning(&quot;execution(* com.itheima.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;afterReturning ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¼‚å¸¸é€šçŸ¥ï¼ˆç¨‹åºåœ¨å‡ºç°å¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œçš„åç½®é€šçŸ¥ï¼‰</span></span><br><span class="line">    <span class="meta">@AfterThrowing(&quot;execution(* com.itheima.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;afterThrowing ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡æ–°å¯åŠ¨SpringBootæœåŠ¡ï¼Œè¿›è¡Œæµ‹è¯•ï¼š</p><p><strong>1). æ²¡æœ‰å¼‚å¸¸æƒ…å†µä¸‹ï¼š</strong></p><p>ä½¿ç”¨ Apifox æµ‹è¯•æŸ¥è¯¢æ‰€æœ‰éƒ¨é—¨æ•°æ®</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-508-1024x541.png" alt="img"></p><p>æŸ¥çœ‹ideaä¸­æ§åˆ¶å°æ—¥å¿—è¾“å‡ºï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-509-1024x194.png" alt="img"></p><blockquote><p>ç¨‹åºæ²¡æœ‰å‘ç”Ÿå¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œ@AfterThrowingæ ‡è¯†çš„é€šçŸ¥æ–¹æ³•ä¸ä¼šæ‰§è¡Œã€‚</p></blockquote><p><strong>2). å‡ºç°å¼‚å¸¸æƒ…å†µä¸‹ï¼š</strong></p><p>ä¿®æ”¹DeptServiceImplä¸šåŠ¡å®ç°ç±»ä¸­çš„ä»£ç ï¼š æ·»åŠ å¼‚å¸¸</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_"><span class="keyword">class</span> <span class="title">DeptServiceImpl</span> <span class="keyword"><span class="keyword">implements</span> <span class="type">DeptService</span></span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DeptMapper deptMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Dept&gt; list() &#123;</span><br><span class="line"></span><br><span class="line">        List&lt;Dept&gt; deptList = deptMapper.list();</span><br><span class="line">        <span class="comment">//æ¨¡æ‹Ÿå¼‚å¸¸</span></span><br><span class="line">        int num = <span class="number">10</span>/<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> deptList;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//çœç•¥å…¶ä»–ä»£ç ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡æ–°å¯åŠ¨SpringBootæœåŠ¡ï¼Œæµ‹è¯•å‘ç”Ÿå¼‚å¸¸æƒ…å†µä¸‹é€šçŸ¥çš„æ‰§è¡Œï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-510-1024x541.png" alt="img"></p><p>æŸ¥çœ‹ideaä¸­æ§åˆ¶å°æ—¥å¿—è¾“å‡º</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-511-1024x272.png" alt="img"></p><blockquote><p>ç¨‹åºå‘ç”Ÿå¼‚å¸¸çš„æƒ…å†µä¸‹ï¼š</p><ul><li>@AfterReturningæ ‡è¯†çš„é€šçŸ¥æ–¹æ³•ä¸ä¼šæ‰§è¡Œï¼Œ@AfterThrowingæ ‡è¯†çš„é€šçŸ¥æ–¹æ³•æ‰§è¡Œäº†</li><li>@Aroundç¯ç»•é€šçŸ¥ä¸­åŸå§‹æ–¹æ³•è°ƒç”¨æ—¶æœ‰å¼‚å¸¸ï¼Œé€šçŸ¥ä¸­çš„ç¯ç»•åçš„ä»£ç é€»è¾‘ä¹Ÿä¸ä¼šåœ¨æ‰§è¡Œäº† ï¼ˆå› ä¸ºåŸå§‹æ–¹æ³•è°ƒç”¨å·²ç»å‡ºå¼‚å¸¸äº†ï¼‰</li></ul></blockquote><p>åœ¨ä½¿ç”¨é€šçŸ¥æ—¶çš„æ³¨æ„äº‹é¡¹ï¼š</p><ul><li><strong>@Aroundç¯ç»•é€šçŸ¥éœ€è¦è‡ªå·±è°ƒç”¨ ProceedingJoinPoint.proceed() æ¥è®©åŸå§‹æ–¹æ³•æ‰§è¡Œ</strong>ï¼Œå…¶ä»–é€šçŸ¥ä¸éœ€è¦è€ƒè™‘ç›®æ ‡æ–¹æ³•æ‰§è¡Œ</li><li><strong>@Aroundç¯ç»•é€šçŸ¥æ–¹æ³•çš„è¿”å›å€¼ï¼Œå¿…é¡»æŒ‡å®šä¸ºObject</strong>ï¼Œæ¥æ¥æ”¶åŸå§‹æ–¹æ³•çš„è¿”å›å€¼ï¼Œå¦åˆ™åŸå§‹æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œæ˜¯è·å–ä¸åˆ°è¿”å›å€¼çš„ã€‚</li></ul><p>äº”ç§å¸¸è§çš„é€šçŸ¥ç±»å‹ï¼Œæˆ‘ä»¬å·²ç»æµ‹è¯•å®Œæ¯•äº†ï¼Œæ­¤æ—¶æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹åˆšæ‰æ‰€ç¼–å†™çš„ä»£ç ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‰ç½®é€šçŸ¥</span></span><br><span class="line"><span class="variable">@Before</span>(<span class="string">&quot;execution(* com.itheima.service.*.*(..))&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¯ç»•é€šçŸ¥</span></span><br><span class="line"><span class="variable">@Around</span>(<span class="string">&quot;execution(* com.itheima.service.*.*(..))&quot;</span>)</span><br><span class="line">  </span><br><span class="line"><span class="comment">//åç½®é€šçŸ¥</span></span><br><span class="line"><span class="variable">@After</span>(<span class="string">&quot;execution(* com.itheima.service.*.*(..))&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿”å›åé€šçŸ¥ï¼ˆç¨‹åºåœ¨æ­£å¸¸æ‰§è¡Œçš„æƒ…å†µä¸‹ï¼Œä¼šæ‰§è¡Œçš„åç½®é€šçŸ¥ï¼‰</span></span><br><span class="line"><span class="variable">@AfterReturning</span>(<span class="string">&quot;execution(* com.itheima.service.*.*(..))&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼‚å¸¸é€šçŸ¥ï¼ˆç¨‹åºåœ¨å‡ºç°å¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œçš„åç½®é€šçŸ¥ï¼‰</span></span><br><span class="line"><span class="variable">@AfterThrowing</span>(<span class="string">&quot;execution(* com.itheima.service.*.*(..))&quot;</span>)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘ç°å•Šï¼Œæ¯ä¸€ä¸ªæ³¨è§£é‡Œé¢éƒ½æŒ‡å®šäº†åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œè€Œä¸”è¿™äº›åˆ‡å…¥ç‚¹è¡¨è¾¾å¼éƒ½ä¸€æ¨¡ä¸€æ ·ã€‚æ­¤æ—¶æˆ‘ä»¬çš„ä»£ç å½“ä¸­å°±å­˜åœ¨äº†å¤§é‡çš„é‡å¤æ€§çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œå‡å¦‚æ­¤æ—¶åˆ‡å…¥ç‚¹è¡¨è¾¾å¼éœ€è¦å˜åŠ¨ï¼Œå°±éœ€è¦å°†æ‰€æœ‰çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ä¸€ä¸ªä¸€ä¸ªçš„æ¥æ”¹åŠ¨ï¼Œå°±å˜å¾—éå¸¸ç¹çäº†ã€‚</p><p>æ€ä¹ˆæ¥è§£å†³è¿™ä¸ªåˆ‡å…¥ç‚¹è¡¨è¾¾å¼é‡å¤çš„é—®é¢˜ï¼Ÿ ç­”æ¡ˆå°±æ˜¯ï¼š<strong>æŠ½å–</strong></p><p><strong>Springæä¾›äº†<code>@PointCut</code>æ³¨è§£ï¼Œè¯¥æ³¨è§£çš„ä½œç”¨æ˜¯å°†å…¬å…±çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼æŠ½å–å‡ºæ¥ï¼Œéœ€è¦ç”¨åˆ°æ—¶å¼•ç”¨è¯¥åˆ‡å…¥ç‚¹è¡¨è¾¾å¼å³å¯ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ‡å…¥ç‚¹æ–¹æ³•ï¼ˆå…¬å…±çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼‰</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.itheima.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‰ç½®é€šçŸ¥ï¼ˆå¼•ç”¨åˆ‡å…¥ç‚¹ï¼‰</span></span><br><span class="line">    <span class="meta">@Before(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;before ...&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç¯ç»•é€šçŸ¥</span></span><br><span class="line">    <span class="meta">@Around(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        log.info(<span class="string">&quot;around before ...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„åŸå§‹æ–¹æ³•æ‰§è¡Œ</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> proceedingJoinPoint.proceed();</span><br><span class="line">        <span class="comment">//åŸå§‹æ–¹æ³•åœ¨æ‰§è¡Œæ—¶ï¼šå‘ç”Ÿå¼‚å¸¸</span></span><br><span class="line">        <span class="comment">//åç»­ä»£ç ä¸åœ¨æ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;around after ...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åç½®é€šçŸ¥</span></span><br><span class="line">    <span class="meta">@After(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;after ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿”å›åé€šçŸ¥ï¼ˆç¨‹åºåœ¨æ­£å¸¸æ‰§è¡Œçš„æƒ…å†µä¸‹ï¼Œä¼šæ‰§è¡Œçš„åç½®é€šçŸ¥ï¼‰</span></span><br><span class="line">    <span class="meta">@AfterReturning(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;afterReturning ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¼‚å¸¸é€šçŸ¥ï¼ˆç¨‹åºåœ¨å‡ºç°å¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œçš„åç½®é€šçŸ¥ï¼‰</span></span><br><span class="line">    <span class="meta">@AfterThrowing(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;afterThrowing ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<strong>å½“åˆ‡å…¥ç‚¹æ–¹æ³•ä½¿ç”¨<code>private</code>ä¿®é¥°æ—¶ï¼Œä»…èƒ½åœ¨å½“å‰åˆ‡é¢ç±»ä¸­å¼•ç”¨è¯¥è¡¨è¾¾å¼ï¼Œ å½“å¤–éƒ¨å…¶ä»–åˆ‡é¢ç±»ä¸­ä¹Ÿè¦å¼•ç”¨å½“å‰ç±»ä¸­çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œå°±éœ€è¦æŠŠ<code>private</code>æ”¹ä¸º<code>public</code></strong>ï¼Œè€Œåœ¨å¼•ç”¨çš„æ—¶å€™ï¼Œå…·ä½“çš„è¯­æ³•ä¸ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Slf4j</span></span><br><span class="line"><span class="variable">@Component</span></span><br><span class="line"><span class="variable">@Aspect</span></span><br><span class="line">public class MyAspect2 &#123;</span><br><span class="line">    <span class="comment">//å¼•ç”¨MyAspect1åˆ‡é¢ç±»ä¸­çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</span></span><br><span class="line">    <span class="variable">@Before</span>(<span class="string">&quot;com.itheima.aspect.MyAspect1.pt()&quot;</span>)</span><br><span class="line">    public void <span class="built_in">before</span>()&#123;</span><br><span class="line">        <span class="selector-tag">log</span><span class="selector-class">.info</span>(<span class="string">&quot;MyAspect2 -&gt; before ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2é€šçŸ¥é¡ºåº">2.2é€šçŸ¥é¡ºåº</h3><p>å½“åœ¨é¡¹ç›®ä¸­ï¼Œå®šä¹‰äº†å¤šä¸ªåˆ‡é¢ç±»ï¼Œè€Œå¤šä¸ªåˆ‡é¢ç±»ä¸­å¤šä¸ªåˆ‡å…¥ç‚¹éƒ½åŒ¹é…åˆ°äº†åŒä¸€ä¸ªç›®æ ‡æ–¹æ³•ã€‚æ­¤æ—¶å½“ç›®æ ‡æ–¹æ³•åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œè¿™å¤šä¸ªåˆ‡é¢ç±»å½“ä¸­çš„è¿™äº›é€šçŸ¥æ–¹æ³•éƒ½ä¼šè¿è¡Œã€‚</p><p>è¿™å¤šä¸ªé€šçŸ¥æ–¹æ³•åˆ°åº•å“ªä¸ªå…ˆè¿è¡Œï¼Œå“ªä¸ªåè¿è¡Œï¼Ÿ ä¸‹é¢æˆ‘ä»¬é€šè¿‡ç¨‹åºæ¥éªŒè¯ï¼ˆè¿™é‡Œå‘¢ï¼Œæˆ‘ä»¬å°±å®šä¹‰ä¸¤ç§ç±»å‹çš„é€šçŸ¥è¿›è¡Œæµ‹è¯•ï¼Œä¸€ç§æ˜¯å‰ç½®é€šçŸ¥<code>@Before</code>ï¼Œä¸€ç§æ˜¯åç½®é€šçŸ¥<code>@After</code>ï¼‰</p><p>å®šä¹‰å¤šä¸ªåˆ‡é¢ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect2</span> &#123;</span><br><span class="line">    <span class="comment">//å‰ç½®é€šçŸ¥</span></span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.itheima.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;MyAspect2 -&gt; before ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åç½®é€šçŸ¥</span></span><br><span class="line">    <span class="meta">@After(&quot;execution(* com.itheima.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;MyAspect2 -&gt; after ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect3</span> &#123;</span><br><span class="line">    <span class="comment">//å‰ç½®é€šçŸ¥</span></span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.itheima.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;MyAspect3 -&gt; before ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åç½®é€šçŸ¥</span></span><br><span class="line">    <span class="meta">@After(&quot;execution(* com.itheima.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;MyAspect3 -&gt;  after ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect4</span> &#123;</span><br><span class="line">    <span class="comment">//å‰ç½®é€šçŸ¥</span></span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.itheima.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;MyAspect4 -&gt; before ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åç½®é€šçŸ¥</span></span><br><span class="line">    <span class="meta">@After(&quot;execution(* com.itheima.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;MyAspect4 -&gt; after ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡æ–°å¯åŠ¨SpringBootæœåŠ¡ï¼Œæµ‹è¯•é€šçŸ¥çš„æ‰§è¡Œé¡ºåºï¼š</p><blockquote><p>å¤‡æ³¨ï¼š</p><ol><li>æŠŠDeptServiceImplå®ç°ç±»ä¸­æ¨¡æ‹Ÿå¼‚å¸¸çš„ä»£ç åˆ é™¤æˆ–æ³¨é‡Šæ‰ã€‚</li><li>æ³¨é‡Šæ‰å…¶ä»–åˆ‡é¢ç±»(æŠŠ<code>@Aspect</code>æ³¨é‡Šå³å¯)ï¼Œä»…ä¿ç•™MyAspect2ã€MyAspect3ã€MyAspect4 ï¼Œè¿™æ ·å°±å¯ä»¥æ¸…æ™°çœ‹åˆ°æ‰§è¡Œçš„ç»“æœï¼Œè€Œä¸è¢«å…¶ä»–åˆ‡é¢ç±»å¹²æ‰°ã€‚</li></ol></blockquote><p>ä½¿ç”¨ Apifox æµ‹è¯•æŸ¥è¯¢æ‰€æœ‰éƒ¨é—¨æ•°æ®ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-512-1024x542.png" alt="img"></p><p>æŸ¥çœ‹ideaä¸­æ§åˆ¶å°æ—¥å¿—è¾“å‡º</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-513-1024x240.png" alt="img"></p><ul><li>é€šè¿‡ä»¥ä¸Šç¨‹åºè¿è¡Œå¯ä»¥çœ‹å‡ºåœ¨ä¸åŒåˆ‡é¢ç±»ä¸­ï¼Œé»˜è®¤æŒ‰ç…§åˆ‡é¢ç±»çš„ç±»åå­—æ¯æ’åºï¼š<ul><li>ç›®æ ‡æ–¹æ³•å‰çš„é€šçŸ¥æ–¹æ³•ï¼šå­—æ¯æ’åé å‰çš„å…ˆæ‰§è¡Œ</li><li>ç›®æ ‡æ–¹æ³•åçš„é€šçŸ¥æ–¹æ³•ï¼šå­—æ¯æ’åé å‰çš„åæ‰§è¡Œ</li></ul></li></ul><p>å¦‚æœæˆ‘ä»¬æƒ³æ§åˆ¶é€šçŸ¥çš„æ‰§è¡Œé¡ºåºæœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ol><li>ä¿®æ”¹åˆ‡é¢ç±»çš„ç±»åï¼ˆè¿™ç§æ–¹å¼éå¸¸ç¹çã€è€Œä¸”ä¸ä¾¿ç®¡ç†ï¼‰</li><li>ä½¿ç”¨Springæä¾›çš„<code>@Order</code>æ³¨è§£</li></ol><p>ä½¿ç”¨@Orderæ³¨è§£ï¼Œæ§åˆ¶é€šçŸ¥çš„æ‰§è¡Œé¡ºåºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Order(2)</span>  <span class="comment">//åˆ‡é¢ç±»çš„æ‰§è¡Œé¡ºåºï¼ˆå‰ç½®é€šçŸ¥ï¼šæ•°å­—è¶Šå°å…ˆæ‰§è¡Œ; åç½®é€šçŸ¥ï¼šæ•°å­—è¶Šå°è¶Šåæ‰§è¡Œï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect2</span> &#123;</span><br><span class="line">    <span class="comment">//å‰ç½®é€šçŸ¥</span></span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.itheima.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;MyAspect2 -&gt; before ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åç½®é€šçŸ¥ </span></span><br><span class="line">    <span class="meta">@After(&quot;execution(* com.itheima.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;MyAspect2 -&gt; after ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Order(3)</span>  <span class="comment">//åˆ‡é¢ç±»çš„æ‰§è¡Œé¡ºåºï¼ˆå‰ç½®é€šçŸ¥ï¼šæ•°å­—è¶Šå°å…ˆæ‰§è¡Œ; åç½®é€šçŸ¥ï¼šæ•°å­—è¶Šå°è¶Šåæ‰§è¡Œï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect3</span> &#123;</span><br><span class="line">    <span class="comment">//å‰ç½®é€šçŸ¥</span></span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.itheima.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;MyAspect3 -&gt; before ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åç½®é€šçŸ¥</span></span><br><span class="line">    <span class="meta">@After(&quot;execution(* com.itheima.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;MyAspect3 -&gt;  after ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Order(1)</span> <span class="comment">//åˆ‡é¢ç±»çš„æ‰§è¡Œé¡ºåºï¼ˆå‰ç½®é€šçŸ¥ï¼šæ•°å­—è¶Šå°å…ˆæ‰§è¡Œ; åç½®é€šçŸ¥ï¼šæ•°å­—è¶Šå°è¶Šåæ‰§è¡Œï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect4</span> &#123;</span><br><span class="line">    <span class="comment">//å‰ç½®é€šçŸ¥</span></span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.itheima.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;MyAspect4 -&gt; before ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åç½®é€šçŸ¥</span></span><br><span class="line">    <span class="meta">@After(&quot;execution(* com.itheima.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;MyAspect4 -&gt; after ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡æ–°å¯åŠ¨SpringBootæœåŠ¡ï¼Œæµ‹è¯•é€šçŸ¥æ‰§è¡Œé¡ºåºï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-514-1024x235.png" alt="img"></p><p><strong>é€šçŸ¥çš„æ‰§è¡Œé¡ºåºå¤§å®¶ä¸»è¦çŸ¥é“ä¸¤ç‚¹å³å¯ï¼š</strong></p><ol><li><strong>ä¸åŒçš„åˆ‡é¢ç±»å½“ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹é€šçŸ¥çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸åˆ‡é¢ç±»çš„ç±»åå­—æ¯æ’åºæ˜¯æœ‰å…³ç³»çš„</strong></li><li><strong>å¯ä»¥åœ¨åˆ‡é¢ç±»ä¸Šé¢åŠ ä¸Š@Orderæ³¨è§£ï¼Œæ¥æ§åˆ¶ä¸åŒçš„åˆ‡é¢ç±»é€šçŸ¥çš„æ‰§è¡Œé¡ºåº</strong></li></ol><h3 id="2-3åˆ‡ç‚¹è¡¨è¾¾å¼">2.3åˆ‡ç‚¹è¡¨è¾¾å¼</h3><p>åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼šæè¿°åˆ‡å…¥ç‚¹æ–¹æ³•çš„ä¸€ç§è¡¨è¾¾å¼</p><ul><li>ä½œç”¨ï¼šä¸»è¦ç”¨æ¥å†³å®šé¡¹ç›®ä¸­çš„å“ªäº›æ–¹æ³•éœ€è¦åŠ å…¥é€šçŸ¥</li><li>å¸¸è§å½¢å¼ï¼š<ul><li>execution(â€¦â€¦)ï¼šæ ¹æ®æ–¹æ³•çš„ç­¾åæ¥åŒ¹é…</li><li>@annotation(â€¦â€¦) ï¼šæ ¹æ®æ³¨è§£åŒ¹é…</li></ul></li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-497-1024x78.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-498-1024x74.png" alt="img"></p><h4 id="2-3-1execution">2.3.1execution</h4><p>executionä¸»è¦æ ¹æ®æ–¹æ³•çš„è¿”å›å€¼ã€åŒ…åã€ç±»åã€æ–¹æ³•åã€æ–¹æ³•å‚æ•°ç­‰ä¿¡æ¯æ¥åŒ¹é…ï¼Œè¯­æ³•ä¸ºï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">execution</span>(è®¿é—®ä¿®é¥°ç¬¦?  è¿”å›å€¼åŒ…å.ç±»å.?æ–¹æ³•å(æ–¹æ³•å‚æ•°) <span class="keyword">throws</span> å¼‚å¸¸?)</span><br></pre></td></tr></table></figure><p>å…¶ä¸­å¸¦<code>?</code>çš„è¡¨ç¤ºå¯ä»¥çœç•¥çš„éƒ¨åˆ†</p><ul><li>è®¿é—®ä¿®é¥°ç¬¦ï¼šå¯çœç•¥ï¼ˆæ¯”å¦‚: publicã€protectedï¼‰</li><li>åŒ…å.ç±»åï¼š å¯çœç•¥</li><li>throws å¼‚å¸¸ï¼šå¯çœç•¥ï¼ˆæ³¨æ„æ˜¯æ–¹æ³•ä¸Šå£°æ˜æŠ›å‡ºçš„å¼‚å¸¸ï¼Œä¸æ˜¯å®é™…æŠ›å‡ºçš„å¼‚å¸¸ï¼‰</li></ul><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before(&quot;execution(void com.itheima.service.impl.DeptServiceImpl.delete(java.lang.Integer))&quot;)</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨é€šé…ç¬¦æè¿°åˆ‡å…¥ç‚¹</p><ul><li><code>*</code> ï¼šå•ä¸ªç‹¬ç«‹çš„ä»»æ„ç¬¦å·ï¼Œå¯ä»¥é€šé…ä»»æ„è¿”å›å€¼ã€åŒ…åã€ç±»åã€æ–¹æ³•åã€ä»»æ„ç±»å‹çš„ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå¯ä»¥é€šé…åŒ…ã€ç±»ã€æ–¹æ³•åçš„ä¸€éƒ¨åˆ†</li><li><code>..</code> ï¼šå¤šä¸ªè¿ç»­çš„ä»»æ„ç¬¦å·ï¼Œå¯ä»¥é€šé…ä»»æ„å±‚çº§çš„åŒ…ï¼Œæˆ–ä»»æ„ç±»å‹ã€ä»»æ„ä¸ªæ•°çš„å‚æ•°</li></ul><p>åˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„è¯­æ³•è§„åˆ™ï¼š</p><ul><li>æ–¹æ³•çš„è®¿é—®ä¿®é¥°ç¬¦å¯ä»¥çœç•¥</li><li>è¿”å›å€¼å¯ä»¥ä½¿ç”¨<code>*</code>å·ä»£æ›¿ï¼ˆä»»æ„è¿”å›å€¼ç±»å‹ï¼‰</li><li>åŒ…åå¯ä»¥ä½¿ç”¨<code>*</code>å·ä»£æ›¿ï¼Œä»£è¡¨ä»»æ„åŒ…ï¼ˆä¸€å±‚åŒ…ä½¿ç”¨ä¸€ä¸ª<code>*</code>ï¼‰</li><li>ä½¿ç”¨<code>..</code>é…ç½®åŒ…åï¼Œæ ‡è¯†æ­¤åŒ…ä»¥åŠæ­¤åŒ…ä¸‹çš„æ‰€æœ‰å­åŒ…</li><li>ç±»åå¯ä»¥ä½¿ç”¨<code>*</code>å·ä»£æ›¿ï¼Œæ ‡è¯†ä»»æ„ç±»</li><li>æ–¹æ³•åå¯ä»¥ä½¿ç”¨<code>*</code>å·ä»£æ›¿ï¼Œè¡¨ç¤ºä»»æ„æ–¹æ³•</li><li>å¯ä»¥ä½¿ç”¨ <code>*</code> é…ç½®å‚æ•°ï¼Œä¸€ä¸ªä»»æ„ç±»å‹çš„å‚æ•°</li><li>å¯ä»¥ä½¿ç”¨<code>..</code> é…ç½®å‚æ•°ï¼Œä»»æ„ä¸ªä»»æ„ç±»å‹çš„å‚æ•°</li></ul><p><strong>åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ç¤ºä¾‹</strong></p><ul><li>çœç•¥æ–¹æ³•çš„ä¿®é¥°ç¬¦å·</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(<span class="type">void</span> com.itheima.service.impl.DeptServiceImpl.<span class="keyword">delete</span>(java.lang.Integer))</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨<code>*</code>ä»£æ›¿è¿”å›å€¼ç±»å‹</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">execution</span><span class="params">(* com.itheima.service.impl.DeptServiceImpl.delete(java.lang.Integer)</span></span>)</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨<code>*</code>ä»£æ›¿åŒ…åï¼ˆä¸€å±‚åŒ…ä½¿ç”¨ä¸€ä¸ª<code>*</code>ï¼‰</li></ul><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(<span class="name">*</span> com.itheima.*.*.DeptServiceImpl.delete(<span class="name">java</span>.lang.Integer))</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨<code>..</code>çœç•¥åŒ…å</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">execution</span><span class="params">(* com..DeptServiceImpl.delete(java.lang.Integer)</span></span>)  </span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨<code>*</code>ä»£æ›¿ç±»å</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">execution</span><span class="params">(* com..*.delete(java.lang.Integer)</span></span>)</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨<code>*</code>ä»£æ›¿æ–¹æ³•å</li></ul><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(<span class="name">*</span> com..*.*(<span class="name">java</span>.lang.Integer))</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ <code>*</code> ä»£æ›¿å‚æ•°</li></ul><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution<span class="comment">(* com.itheima.service.impl.DeptServiceImpl.delete(*)</span>)</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨<code>..</code>çœç•¥å‚æ•°</li></ul><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(<span class="name">*</span> com..*.*(..))</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p><ul><li>æ ¹æ®ä¸šåŠ¡éœ€è¦ï¼Œå¯ä»¥ä½¿ç”¨ ä¸”ï¼ˆ&amp;&amp;ï¼‰ã€æˆ–ï¼ˆ||ï¼‰ã€éï¼ˆ!ï¼‰ æ¥ç»„åˆæ¯”è¾ƒå¤æ‚çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ã€‚</li></ul><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(* <span class="keyword">com</span>.itheima.service.DeptService<span class="meta">.list</span>(..)) || execution(* <span class="keyword">com</span>.itheima.service.DeptService.delete(..))</span><br></pre></td></tr></table></figure><p>åˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„ä¹¦å†™å»ºè®®ï¼š</p><ul><li>æ‰€æœ‰ä¸šåŠ¡æ–¹æ³•ååœ¨å‘½åæ—¶å°½é‡è§„èŒƒï¼Œæ–¹ä¾¿åˆ‡å…¥ç‚¹è¡¨è¾¾å¼å¿«é€ŸåŒ¹é…ã€‚å¦‚ï¼šæŸ¥è¯¢ç±»æ–¹æ³•éƒ½æ˜¯ find å¼€å¤´ï¼Œæ›´æ–°ç±»æ–¹æ³•éƒ½æ˜¯updateå¼€å¤´</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸šåŠ¡ç±»</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">DeptService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">List</span>&lt;<span class="title class_">Dept</span>&gt; <span class="title function_">findAllDept</span>(<span class="params"></span>) &#123;</span><br><span class="line">       <span class="comment">//çœç•¥ä»£ç ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">Dept</span> <span class="title function_">findDeptById</span>(<span class="params"><span class="title class_">Integer</span> id</span>) &#123;</span><br><span class="line">       <span class="comment">//çœç•¥ä»£ç ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">updateDeptById</span>(<span class="params"><span class="title class_">Integer</span> id</span>) &#123;</span><br><span class="line">       <span class="comment">//çœç•¥ä»£ç ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">updateDeptByMoreCondition</span>(<span class="params"><span class="title class_">Dept</span> dept</span>) &#123;</span><br><span class="line">       <span class="comment">//çœç•¥ä»£ç ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å…¶ä»–ä»£ç ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>//åŒ¹é…DeptServiceImplç±»ä¸­ä»¥findå¼€å¤´çš„æ–¹æ³•</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">execution</span><span class="params">(* com.itheima.service.impl.DeptServiceImpl.find*(..)</span></span>)</span><br></pre></td></tr></table></figure><ul><li>æè¿°åˆ‡å…¥ç‚¹æ–¹æ³•é€šå¸¸åŸºäºæ¥å£æè¿°ï¼Œè€Œä¸æ˜¯ç›´æ¥æè¿°å®ç°ç±»ï¼Œå¢å¼ºæ‹“å±•æ€§</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">execution</span><span class="params">(* com.itheima.service.DeptService.*(..)</span></span>)</span><br></pre></td></tr></table></figure><ul><li>åœ¨æ»¡è¶³ä¸šåŠ¡éœ€è¦çš„å‰æä¸‹ï¼Œå°½é‡ç¼©å°åˆ‡å…¥ç‚¹çš„åŒ¹é…èŒƒå›´ã€‚å¦‚ï¼šåŒ…ååŒ¹é…å°½é‡ä¸ä½¿ç”¨ â€¦ï¼Œä½¿ç”¨ * åŒ¹é…å•ä¸ªåŒ…</li></ul><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(<span class="name">*</span> com.itheima.*.*.DeptServiceImpl.find*(..))</span><br></pre></td></tr></table></figure><blockquote><p><strong>åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ä¹¦å†™å»ºè®®ï¼š</strong></p><ul><li>æ‰€æœ‰ä¸šåŠ¡æ–¹æ³•ååœ¨å‘½åæ—¶å°½é‡è§„èŒƒï¼Œæ–¹ä¾¿åˆ‡å…¥ç‚¹è¡¨è¾¾å¼å¿«é€ŸåŒ¹é…ã€‚å¦‚ï¼šfindXxxï¼ŒupdateXxxã€‚</li><li>æè¿°åˆ‡å…¥ç‚¹æ–¹æ³•é€šå¸¸åŸºäºæ¥å£æè¿°ï¼Œè€Œä¸æ˜¯ç›´æ¥æè¿°å®ç°ç±»ï¼Œå¢å¼ºæ‹“å±•æ€§ã€‚</li><li>åœ¨æ»¡è¶³ä¸šåŠ¡éœ€è¦çš„å‰æä¸‹ï¼Œå°½é‡ç¼©å°åˆ‡å…¥ç‚¹çš„åŒ¹é…èŒƒå›´ã€‚å¦‚ï¼šåŒ…åå°½é‡ä¸ä½¿ç”¨â€¦ï¼Œä½¿ç”¨ <code>*</code> åŒ¹é…å•ä¸ªåŒ…ã€‚</li></ul></blockquote><h4 id="2-3-2-annotation">2.3.2@annotation</h4><ol><li></li></ol><p>å·²ç»å­¦ä¹ äº†executionåˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„è¯­æ³•ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬è¦åŒ¹é…å¤šä¸ªæ— è§„åˆ™çš„æ–¹æ³•ï¼Œæ¯”å¦‚ï¼šlist()å’Œ delete()è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬åŸºäºexecutionè¿™ç§åˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ¥æè¿°å°±ä¸æ˜¯å¾ˆæ–¹ä¾¿äº†ã€‚è€Œåœ¨ä¹‹å‰æˆ‘ä»¬æ˜¯å°†ä¸¤ä¸ªåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ç»„åˆåœ¨äº†ä¸€èµ·å®Œæˆçš„éœ€æ±‚ï¼Œè¿™ä¸ªæ˜¯æ¯”è¾ƒç¹ççš„ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å€ŸåŠ©äºå¦ä¸€ç§åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ <code>@annotation</code> æ¥æè¿°è¿™ä¸€ç±»çš„åˆ‡å…¥ç‚¹ï¼Œä»è€Œæ¥ç®€åŒ–åˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„ä¹¦å†™ã€‚</p><p>å®ç°æ­¥éª¤ï¼š</p><ol><li>ç¼–å†™è‡ªå®šä¹‰æ³¨è§£</li><li>åœ¨ä¸šåŠ¡ç±»è¦åšä¸ºè¿æ¥ç‚¹çš„æ–¹æ³•ä¸Šæ·»åŠ è‡ªå®šä¹‰æ³¨è§£</li></ol><p><strong>è‡ªå®šä¹‰æ³¨è§£</strong>ï¼š<code>LogOperation</code></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Target</span>(ElementType.METHOD)</span><br><span class="line"><span class="variable">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line">public <span class="variable">@interface</span> LogOperation&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¸šåŠ¡ç±»</strong>ï¼š<code>DeptServiceImpl</code></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">DeptService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">DeptMapper</span> deptMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@LogOperation</span> <span class="comment">//è‡ªå®šä¹‰æ³¨è§£ï¼ˆè¡¨ç¤ºï¼šå½“å‰æ–¹æ³•å±äºç›®æ ‡æ–¹æ³•ï¼‰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">List</span>&lt;<span class="title class_">Dept</span>&gt; <span class="title function_">list</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">Dept</span>&gt; deptList = deptMapper.<span class="title function_">list</span>();</span><br><span class="line">        <span class="comment">//æ¨¡æ‹Ÿå¼‚å¸¸</span></span><br><span class="line">        <span class="comment">//int num = 10/0;</span></span><br><span class="line">        <span class="keyword">return</span> deptList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@LogOperation</span> <span class="comment">//è‡ªå®šä¹‰æ³¨è§£ï¼ˆè¡¨ç¤ºï¼šå½“å‰æ–¹æ³•å±äºç›®æ ‡æ–¹æ³•ï¼‰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">delete</span>(<span class="params"><span class="title class_">Integer</span> id</span>) &#123;</span><br><span class="line">        <span class="comment">//1. åˆ é™¤éƒ¨é—¨</span></span><br><span class="line">        deptMapper.<span class="title function_">delete</span>(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">save</span>(<span class="params"><span class="title class_">Dept</span> dept</span>) &#123;</span><br><span class="line">        dept.<span class="title function_">setCreateTime</span>(<span class="title class_">LocalDateTime</span>.<span class="title function_">now</span>());</span><br><span class="line">        dept.<span class="title function_">setUpdateTime</span>(<span class="title class_">LocalDateTime</span>.<span class="title function_">now</span>());</span><br><span class="line">        deptMapper.<span class="title function_">save</span>(dept);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">Dept</span> <span class="title function_">getById</span>(<span class="params"><span class="title class_">Integer</span> id</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> deptMapper.<span class="title function_">getById</span>(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">update</span>(<span class="params"><span class="title class_">Dept</span> dept</span>) &#123;</span><br><span class="line">        dept.<span class="title function_">setUpdateTime</span>(<span class="title class_">LocalDateTime</span>.<span class="title function_">now</span>());</span><br><span class="line">        deptMapper.<span class="title function_">update</span>(dept);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åˆ‡é¢ç±»</strong></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Slf4j</span></span><br><span class="line"><span class="variable">@Component</span></span><br><span class="line"><span class="variable">@Aspect</span></span><br><span class="line">public class MyAspect6 &#123;</span><br><span class="line">    <span class="comment">//é’ˆå¯¹listæ–¹æ³•ã€deleteæ–¹æ³•è¿›è¡Œå‰ç½®é€šçŸ¥å’Œåç½®é€šçŸ¥</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‰ç½®é€šçŸ¥</span></span><br><span class="line">    <span class="variable">@Before</span>(<span class="string">&quot;@annotation(com.itheima.anno.LogOperation)&quot;</span>)</span><br><span class="line">    public void <span class="built_in">before</span>()&#123;</span><br><span class="line">        <span class="selector-tag">log</span><span class="selector-class">.info</span>(<span class="string">&quot;MyAspect6 -&gt; before ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//åç½®é€šçŸ¥</span></span><br><span class="line">    @<span class="selector-tag">After</span>(<span class="string">&quot;@annotation(com.itheima.anno.LogOperation)&quot;</span>)</span><br><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">void</span> <span class="selector-tag">after</span>()&#123;</span><br><span class="line">        <span class="selector-tag">log</span><span class="selector-class">.info</span>(<span class="string">&quot;MyAspect6 -&gt; after ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å¯SpringBootæœåŠ¡ï¼Œæµ‹è¯•æŸ¥è¯¢æ‰€æœ‰éƒ¨é—¨æ•°æ®ï¼ŒæŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-503.png" alt="img"></p><p>åˆ°æ­¤ä¸¤ç§å¸¸è§çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼å·²ç»ä»‹ç»å®Œäº†ã€‚</p><ul><li>executionåˆ‡å…¥ç‚¹è¡¨è¾¾å¼<ul><li>æ ¹æ®æˆ‘ä»¬æ‰€æŒ‡å®šçš„æ–¹æ³•çš„æè¿°ä¿¡æ¯æ¥åŒ¹é…åˆ‡å…¥ç‚¹æ–¹æ³•ï¼Œè¿™ç§æ–¹å¼ä¹Ÿæ˜¯æœ€ä¸ºå¸¸ç”¨çš„ä¸€ç§æ–¹å¼</li><li>å¦‚æœæˆ‘ä»¬è¦åŒ¹é…çš„åˆ‡å…¥ç‚¹æ–¹æ³•çš„æ–¹æ³•åä¸è§„åˆ™ï¼Œæˆ–è€…æœ‰ä¸€äº›æ¯”è¾ƒç‰¹æ®Šçš„éœ€æ±‚ï¼Œé€šè¿‡executionåˆ‡å…¥ç‚¹è¡¨è¾¾å¼æè¿°æ¯”è¾ƒç¹ç</li></ul></li><li>annotation åˆ‡å…¥ç‚¹è¡¨è¾¾å¼<ul><li>åŸºäºæ³¨è§£çš„æ–¹å¼æ¥åŒ¹é…åˆ‡å…¥ç‚¹æ–¹æ³•ã€‚è¿™ç§æ–¹å¼è™½ç„¶å¤šä¸€æ­¥æ“ä½œï¼Œæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼Œä½†æ˜¯ç›¸å¯¹æ¥æ¯”è¾ƒçµæ´»ã€‚æˆ‘ä»¬éœ€è¦åŒ¹é…å“ªä¸ªæ–¹æ³•ï¼Œå°±åœ¨æ–¹æ³•ä¸ŠåŠ ä¸Šå¯¹åº”çš„æ³¨è§£å°±å¯ä»¥äº†</li></ul></li></ul><p>æ ¹æ®ä¸šåŠ¡éœ€è¦ï¼Œå¯ä»¥ä½¿ç”¨ &amp;&amp; ï¼Œ||ï¼Œï¼ æ¥ç»„åˆæ¯”è¾ƒå¤æ‚çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ã€‚</p><h2 id="3-AOPæ¡ˆä¾‹">3.AOPæ¡ˆä¾‹</h2><h3 id="3-1éœ€æ±‚-3">3.1éœ€æ±‚</h3><p>éœ€æ±‚ï¼šå°†æ¡ˆä¾‹ï¼ˆTliasæ™ºèƒ½å­¦ä¹ è¾…åŠ©ç³»ç»Ÿï¼‰ä¸­å¢ã€åˆ ã€æ”¹ç›¸å…³æ¥å£çš„æ“ä½œæ—¥å¿—è®°å½•åˆ°æ•°æ®åº“è¡¨ä¸­</p><ul><li>å°±æ˜¯å½“è®¿é—®éƒ¨é—¨ç®¡ç†å’Œå‘˜å·¥ç®¡ç†å½“ä¸­çš„å¢ã€åˆ ã€æ”¹ç›¸å…³åŠŸèƒ½æ¥å£æ—¶ï¼Œéœ€è¦è¯¦ç»†çš„æ“ä½œæ—¥å¿—ï¼Œå¹¶ä¿å­˜åœ¨æ•°æ®è¡¨ä¸­ï¼Œä¾¿äºåæœŸæ•°æ®è¿½è¸ªã€‚</li></ul><p>æ“ä½œæ—¥å¿—ä¿¡æ¯åŒ…å«ï¼š</p><ul><li>æ“ä½œäººã€æ“ä½œæ—¶é—´ã€æ‰§è¡Œæ–¹æ³•çš„å…¨ç±»åã€æ‰§è¡Œæ–¹æ³•åã€æ–¹æ³•è¿è¡Œæ—¶å‚æ•°ã€è¿”å›å€¼ã€æ–¹æ³•æ‰§è¡Œæ—¶é•¿</li></ul><blockquote><p>æ‰€è®°å½•çš„æ—¥å¿—ä¿¡æ¯åŒ…æ‹¬å½“å‰æ¥å£çš„æ“ä½œäººæ˜¯è°æ“ä½œçš„ï¼Œä»€ä¹ˆæ—¶é—´ç‚¹æ“ä½œçš„ï¼Œä»¥åŠè®¿é—®çš„æ˜¯å“ªä¸ªç±»å½“ä¸­çš„å“ªä¸ªæ–¹æ³•ï¼Œåœ¨è®¿é—®è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ä¼ å…¥è¿›æ¥çš„å‚æ•°æ˜¯ä»€ä¹ˆï¼Œè®¿é—®è¿™ä¸ªæ–¹æ³•æœ€ç»ˆæ‹¿åˆ°çš„è¿”å›å€¼æ˜¯ä»€ä¹ˆï¼Œä»¥åŠæ•´ä¸ªæ¥å£æ–¹æ³•çš„è¿è¡Œæ—¶é•¿æ˜¯å¤šé•¿æ—¶é—´ã€‚</p></blockquote><h3 id="3-2åˆ†æ">3.2åˆ†æ</h3><ul><li>é—®é¢˜1ï¼šé¡¹ç›®å½“ä¸­å¢åˆ æ”¹ç›¸å…³çš„æ–¹æ³•æ˜¯ä¸æ˜¯æœ‰å¾ˆå¤šï¼Ÿ<ul><li>å¾ˆå¤š</li></ul></li><li>é—®é¢˜2ï¼šæˆ‘ä»¬éœ€è¦é’ˆå¯¹æ¯ä¸€ä¸ªåŠŸèƒ½æ¥å£æ–¹æ³•è¿›è¡Œä¿®æ”¹ï¼Œåœ¨æ¯ä¸€ä¸ªåŠŸèƒ½æ¥å£å½“ä¸­éƒ½æ¥è®°å½•è¿™äº›æ“ä½œæ—¥å¿—å—ï¼Ÿ<ul><li>è¿™ç§åšæ³•æ¯”è¾ƒç¹ç</li></ul></li></ul><p>ä»¥ä¸Šä¸¤ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼šå¯ä»¥ä½¿ç”¨AOPè§£å†³(æ¯ä¸€ä¸ªå¢åˆ æ”¹åŠŸèƒ½æ¥å£ä¸­è¦å®ç°çš„è®°å½•æ“ä½œæ—¥å¿—çš„é€»è¾‘ä»£ç æ˜¯ç›¸åŒ)ã€‚</p><p>å¯ä»¥æŠŠè¿™éƒ¨åˆ†è®°å½•æ“ä½œæ—¥å¿—çš„é€šç”¨çš„ã€é‡å¤æ€§çš„é€»è¾‘ä»£ç æŠ½å–å‡ºæ¥å®šä¹‰åœ¨ä¸€ä¸ªé€šçŸ¥æ–¹æ³•å½“ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡AOPé¢å‘åˆ‡é¢ç¼–ç¨‹çš„æ–¹å¼ï¼Œåœ¨ä¸æ”¹åŠ¨åŸå§‹åŠŸèƒ½çš„åŸºç¡€ä¸Šæ¥å¯¹åŸå§‹çš„åŠŸèƒ½è¿›è¡Œå¢å¼ºã€‚ç›®å‰æˆ‘ä»¬æ‰€å¢å¼ºçš„åŠŸèƒ½å°±æ˜¯æ¥è®°å½•æ“ä½œæ—¥å¿—ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ä½¿ç”¨AOPçš„æŠ€æœ¯æ¥å®ç°ã€‚ä½¿ç”¨AOPçš„æŠ€æœ¯æ¥å®ç°ä¹Ÿæ˜¯æœ€ä¸ºç®€å•ï¼Œæœ€ä¸ºæ–¹ä¾¿çš„ã€‚</p><ul><li>é—®é¢˜3ï¼šæ—¢ç„¶è¦åŸºäºAOPé¢å‘åˆ‡é¢ç¼–ç¨‹çš„æ–¹å¼æ¥å®Œæˆçš„åŠŸèƒ½ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦ä½¿ç”¨ AOPäº”ç§é€šçŸ¥ç±»å‹å½“ä¸­çš„å“ªç§é€šçŸ¥ç±»å‹ï¼Ÿ<ul><li>ç­”æ¡ˆï¼š@Aroundã€å› ä¸ºåœ¨è·å–æ–¹æ³•æ‰§è¡Œæ—¶é•¿æ—¶ï¼Œéœ€è¦åœ¨ç›®æ ‡æ–¹æ³•çš„å‰åéƒ½è¿è¡Œã€‘</li></ul></li><li>é—®é¢˜4ï¼šæœ€åä¸€ä¸ªé—®é¢˜ï¼Œåˆ‡å…¥ç‚¹è¡¨è¾¾å¼æˆ‘ä»¬è¯¥æ€ä¹ˆå†™ï¼Ÿ<ul><li>ç­”æ¡ˆï¼š@annotationã€å› ä¸ºControllerå±‚å¢ã€åˆ ã€æ”¹æ‰§è¡Œæ–¹æ³•çš„åç§°æ²¡æœ‰å›ºå®šå‰ç¼€/åç¼€ï¼Œç›´æ¥ç”¨æ–¹æ³•åçš„è¯æ¯”è¾ƒéº»çƒ¦ã€‘</li></ul></li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-515.png" alt="img"></p><h3 id="3-3æ­¥éª¤">3.3æ­¥éª¤</h3><p>ç®€å•åˆ†æäº†ä¸€ä¸‹å¤§æ¦‚çš„å®ç°æ€è·¯åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦æ¥å®Œæˆæ¡ˆä¾‹äº†ã€‚æ¡ˆä¾‹çš„å®ç°æ­¥éª¤å…¶å®å°±ä¸¤æ­¥ï¼š</p><p>å®šä¹‰åˆ‡é¢ç±»ï¼Œå®Œæˆè®°å½•æ“ä½œæ—¥å¿—çš„é€»è¾‘</p><ul><li>å‡†å¤‡å·¥ä½œ<ul><li>å¼•å…¥AOPçš„èµ·æ­¥ä¾èµ–</li><li>å¯¼å…¥èµ„æ–™ä¸­å‡†å¤‡å¥½çš„æ•°æ®åº“è¡¨ç»“æ„ï¼Œå¹¶å¼•å…¥å¯¹åº”çš„å®ä½“ç±»</li></ul></li><li>ç¼–ç å®ç°(åŸºäºAIå®ç°)<ul><li>è‡ªå®šä¹‰æ³¨è§£<code>@LogOperation</code></li><li>å®šä¹‰åˆ‡é¢ç±»ï¼Œå®Œæˆè®°å½•æ“ä½œæ—¥å¿—çš„é€»è¾‘</li></ul></li></ul><h3 id="3-4ä»£ç å®ç°">3.4ä»£ç å®ç°</h3><p><strong>1). å‡†å¤‡å·¥ä½œ</strong></p><ul><li>åœ¨ pom.xml ä¸­å¼•å…¥AOPçš„ä¾èµ–</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºæ•°æ®åº“è¡¨ç»“æ„</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ“ä½œæ—¥å¿—è¡¨</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> operate_log(</span><br><span class="line">    id <span class="type">int</span> unsigned <span class="keyword">primary key</span> auto_increment <span class="keyword">comment</span> <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">    operate_emp_id <span class="type">int</span> unsigned <span class="keyword">comment</span> <span class="string">&#x27;æ“ä½œäººID&#x27;</span>,</span><br><span class="line">    operate_time datetime <span class="keyword">comment</span> <span class="string">&#x27;æ“ä½œæ—¶é—´&#x27;</span>,</span><br><span class="line">    class_name <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">comment</span> <span class="string">&#x27;æ“ä½œçš„ç±»å&#x27;</span>,</span><br><span class="line">    method_name <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">comment</span> <span class="string">&#x27;æ“ä½œçš„æ–¹æ³•å&#x27;</span>,</span><br><span class="line">    method_params <span class="type">varchar</span>(<span class="number">1000</span>) <span class="keyword">comment</span> <span class="string">&#x27;æ–¹æ³•å‚æ•°&#x27;</span>,</span><br><span class="line">    return_value <span class="type">varchar</span>(<span class="number">2000</span>) <span class="keyword">comment</span> <span class="string">&#x27;è¿”å›å€¼, å­˜å‚¨jsonæ ¼å¼&#x27;</span>,</span><br><span class="line">    cost_time <span class="type">int</span> <span class="keyword">comment</span> <span class="string">&#x27;æ–¹æ³•æ‰§è¡Œè€—æ—¶, å•ä½:ms&#x27;</span></span><br><span class="line">) <span class="keyword">comment</span> <span class="string">&#x27;æ“ä½œæ—¥å¿—è¡¨&#x27;</span>;</span><br></pre></td></tr></table></figure><ul><li>å¼•å…¥èµ„æ–™ä¸­å‡†å¤‡çš„å®ä½“ç±»</li></ul><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_"><span class="keyword">class</span> <span class="title">OperateLog</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id; <span class="comment">//ID</span></span><br><span class="line">    <span class="keyword">private</span> Integer operateEmpId; <span class="comment">//æ“ä½œäººID</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime operateTime; <span class="comment">//æ“ä½œæ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> className; <span class="comment">//æ“ä½œç±»å</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> methodName; <span class="comment">//æ“ä½œæ–¹æ³•å</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> methodParams; <span class="comment">//æ“ä½œæ–¹æ³•å‚æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> returnValue; <span class="comment">//æ“ä½œæ–¹æ³•è¿”å›å€¼</span></span><br><span class="line">    <span class="keyword">private</span> Long costTime; <span class="comment">//æ“ä½œè€—æ—¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¼•å…¥èµ„æ–™ä¸­å‡†å¤‡çš„æ—¥å¿—æ“ä½œMapperæ¥å£ <code>OperateLogMapper</code></li></ul><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.OperateLog;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Insert;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line">@Mapper</span><br><span class="line">public interface OperateLogMapper &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="regexp">//</span>æ’å…¥æ—¥å¿—æ•°æ®</span><br><span class="line">    @Insert(<span class="string">&quot;insert into operate_log (operate_emp_id, operate_time, class_name, method_name, method_params, return_value, cost_time) &quot;</span> +</span><br><span class="line">            <span class="string">&quot;values (<span class="subst">#&#123;operateEmpId&#125;</span>, <span class="subst">#&#123;operateTime&#125;</span>, <span class="subst">#&#123;className&#125;</span>, <span class="subst">#&#123;methodName&#125;</span>, <span class="subst">#&#123;methodParams&#125;</span>, <span class="subst">#&#123;returnValue&#125;</span>, <span class="subst">#&#123;costTime&#125;</span>);&quot;</span>)</span><br><span class="line">    public <span class="keyword">void</span> insert(OperateLog log);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>1). è‡ªå®šä¹‰æ³¨è§£</strong> <strong><code>@LogOperation</code></strong></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  è‡ªå®šä¹‰æ³¨è§£ï¼Œç”¨äºæ ‡è¯†å“ªäº›æ–¹æ³•éœ€è¦è®°å½•æ—¥å¿—</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable">@Target</span>(ElementType.METHOD)</span><br><span class="line"><span class="variable">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line">public <span class="variable">@interface</span> LogOperation &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2). å®šä¹‰AOPè®°å½•æ—¥å¿—çš„åˆ‡é¢ç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.itheima.anno.LogOperation;</span><br><span class="line"><span class="keyword">import</span> com.itheima.mapper.OperateLogMapper;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.OperateLog;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OperationLogAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OperateLogMapper operateLogMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¯ç»•é€šçŸ¥</span></span><br><span class="line">    <span class="meta">@Around(&quot;@annotation(log)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint joinPoint, LogOperation log)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// è®°å½•å¼€å§‹æ—¶é—´</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// æ‰§è¡Œæ–¹æ³•</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> joinPoint.proceed();</span><br><span class="line">        <span class="comment">// å½“å‰æ—¶é—´</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// è€—æ—¶</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">costTime</span> <span class="operator">=</span> endTime - startTime;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ„å»ºæ—¥å¿—å¯¹è±¡</span></span><br><span class="line">        <span class="type">OperateLog</span> <span class="variable">operateLog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OperateLog</span>();</span><br><span class="line">        operateLog.setOperateEmpId(getCurrentUserId()); <span class="comment">// éœ€è¦å®ç° getCurrentUserId æ–¹æ³•</span></span><br><span class="line">        operateLog.setOperateTime(LocalDateTime.now());</span><br><span class="line">        operateLog.setClassName(joinPoint.getTarget().getClass().getName());</span><br><span class="line">        operateLog.setMethodName(joinPoint.getSignature().getName());</span><br><span class="line">        operateLog.setMethodParams(Arrays.toString(joinPoint.getArgs()));</span><br><span class="line">        operateLog.setReturnValue(result.toString());</span><br><span class="line">        operateLog.setCostTime(costTime);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ’å…¥æ—¥å¿—</span></span><br><span class="line">        operateLogMapper.insert(operateLog);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¤ºä¾‹æ–¹æ³•ï¼Œè·å–å½“å‰ç”¨æˆ·ID</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getCurrentUserId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œåº”è¯¥æ ¹æ®å®é™…æƒ…å†µä»è®¤è¯ä¿¡æ¯ä¸­è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„ID</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">// ç¤ºä¾‹è¿”å›å€¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3). åœ¨éœ€è¦è®°å½•çš„æ—¥å¿—çš„<strong><strong>Controllerå±‚</strong></strong>çš„æ–¹æ³•ä¸Šï¼ŒåŠ ä¸Šæ³¨è§£</strong> <strong><code>@LogOperation</code></strong></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@RestController</span></span><br><span class="line"><span class="variable">@RequestMapping</span>(<span class="string">&quot;/clazzs&quot;</span>)</span><br><span class="line">public class ClazzController &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@Autowired</span></span><br><span class="line">    private ClazzService clazzService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**     * æ–°å¢ç­çº§     */</span><span class="variable">@LogOperation</span></span><br><span class="line">    <span class="variable">@PostMapping</span></span><br><span class="line">    public Result <span class="built_in">save</span>(<span class="variable">@RequestBody</span> Clazz clazz)&#123;</span><br><span class="line">        <span class="selector-tag">clazzService</span><span class="selector-class">.save</span>(clazz);</span><br><span class="line">        <span class="selector-tag">return</span> <span class="selector-tag">Result</span><span class="selector-class">.success</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure><p>é‡å¯SpringBootæœåŠ¡ï¼Œæµ‹è¯•æ“ä½œæ—¥å¿—è®°å½•åŠŸèƒ½ï¼š</p><p>æ‰“å¼€æµè§ˆå™¨ï¼Œé’ˆå¯¹äºå‘˜å·¥çš„æ•°æ®ã€éƒ¨é—¨çš„æ•°æ®è¿›è¡Œå¢åˆ æ”¹ä¹‹åã€‚æˆ‘ä»¬æ‰“å¼€æ•°æ®åº“è¡¨ç»“æ„å¯ä»¥æ¥çœ‹ä¸€ä¸‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-499-1024x333.png" alt="img"></p><p>æˆ‘ä»¬ä¼šçœ‹åˆ°ï¼Œåœ¨æ•°æ®åº“è¡¨ä¸­ï¼Œå°±æ¸…æ™°çš„è®°å½•äº†è°ã€ä»€ä¹ˆæ—¶é—´ç‚¹ã€è°ƒç”¨äº†å“ªä¸ªç±»çš„å“ªä¸ªæ–¹æ³•ã€ä¼ å…¥äº†ä»€ä¹ˆå‚æ•°ã€è¿”å›äº†ä»€ä¹ˆæ•°æ®ï¼Œéƒ½æ¸…æ™°çš„è®°å½•åœ¨æ•°æ®åº“ä¸­äº†ã€‚</p><h3 id="3-5è¿æ¥ç‚¹">3.5è¿æ¥ç‚¹</h3><p>è¿æ¥ç‚¹å¯ä»¥ç®€å•ç†è§£ä¸ºå¯ä»¥è¢«AOPæ§åˆ¶çš„æ–¹æ³•ã€‚</p><p>æˆ‘ä»¬ç›®æ ‡å¯¹è±¡å½“ä¸­æ‰€æœ‰çš„æ–¹æ³•æ˜¯ä¸æ˜¯éƒ½æ˜¯å¯ä»¥è¢«AOPæ§åˆ¶çš„æ–¹æ³•ã€‚è€Œåœ¨SpringAOPå½“ä¸­ï¼Œè¿æ¥ç‚¹åˆç‰¹æŒ‡æ–¹æ³•çš„æ‰§è¡Œã€‚</p><p>åœ¨Springä¸­ç”¨JoinPointæŠ½è±¡äº†è¿æ¥ç‚¹ï¼Œç”¨å®ƒå¯ä»¥è·å¾—æ–¹æ³•æ‰§è¡Œæ—¶çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚ç›®æ ‡ç±»åã€æ–¹æ³•åã€æ–¹æ³•å‚æ•°ç­‰ã€‚</p><ul><li>å¯¹äº<code>@Around</code>é€šçŸ¥ï¼Œè·å–è¿æ¥ç‚¹ä¿¡æ¯åªèƒ½ä½¿ç”¨<code>ProceedingJoinPoint</code>ç±»å‹</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-500-1024x467.png" alt="img"></p><ul><li>å¯¹äºå…¶ä»–å››ç§é€šçŸ¥ï¼Œè·å–è¿æ¥ç‚¹ä¿¡æ¯åªèƒ½ä½¿ç”¨<code>JoinPoint</code>ï¼Œå®ƒæ˜¯<code>ProceedingJoinPoint</code>çš„çˆ¶ç±»å‹</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-501-1024x395.png" alt="img"></p><h3 id="3-6è·å–å½“å‰ç™»å½•å‘˜å·¥">3.6è·å–å½“å‰ç™»å½•å‘˜å·¥</h3><ol><li></li></ol><ul><li>å‘˜å·¥ç™»å½•æˆåŠŸåï¼Œå“ªé‡Œå­˜å‚¨çš„æœ‰å½“å‰ç™»å½•å‘˜å·¥çš„ä¿¡æ¯ï¼Ÿ ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ä¸‹å‘çš„jwtä»¤ç‰Œä¸­</li><li>å¦‚ä½•ä»JWTä»¤ç‰Œä¸­è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯å‘¢ï¼Ÿ è·å–è¯·æ±‚å¤´ä¸­ä¼ é€’çš„jwtä»¤ç‰Œï¼Œå¹¶è§£æ</li><li>TokenFilter ä¸­å·²ç»è§£æäº†ä»¤ç‰Œçš„ä¿¡æ¯ï¼Œå¦‚ä½•ä¼ é€’ç»™AOPç¨‹åºã€Controllerã€Serviceå‘¢ï¼ŸThreadLocal</li></ul><h4 id="3-6-1ThreadLocal">3.6.1ThreadLocal</h4><ul><li>ThreadLocalå¹¶ä¸æ˜¯ä¸€ä¸ªThreadï¼Œè€Œæ˜¯Threadçš„å±€éƒ¨å˜é‡ã€‚</li><li>ThreadLocalä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›ä¸€ä»½å•ç‹¬çš„å­˜å‚¨ç©ºé—´ï¼Œå…·æœ‰çº¿ç¨‹éš”ç¦»çš„æ•ˆæœï¼Œä¸åŒçš„çº¿ç¨‹ä¹‹é—´ä¸ä¼šç›¸äº’å¹²æ‰°ã€‚</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-516-1024x199.png" alt="img"></p><ul><li>å¸¸è§æ–¹æ³•ï¼š<ul><li><code>public void set(T value)</code> è®¾ç½®å½“å‰çº¿ç¨‹çš„çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼</li><li><code>public T get()</code> è¿”å›å½“å‰çº¿ç¨‹æ‰€å¯¹åº”çš„çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼</li><li><code>public void remove()</code> ç§»é™¤å½“å‰çº¿ç¨‹çš„çº¿ç¨‹å±€éƒ¨å˜é‡</li></ul></li></ul><h4 id="3-6-2è®°å½•å½“å‰ç™»å½•å‘˜å·¥">3.6.2è®°å½•å½“å‰ç™»å½•å‘˜å·¥</h4><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-517-1024x327.png" alt="img"></p><p>å…·ä½“æ“ä½œæ­¥éª¤ï¼š</p><ol><li>å®šä¹‰ThreadLocalæ“ä½œçš„å·¥å…·ç±»ï¼Œç”¨äºæ“ä½œå½“å‰ç™»å½•å‘˜å·¥IDã€‚</li></ol><p>åœ¨ <code>com.itheima.utils</code> å¼•å…¥å·¥å…·ç±» <code>CurrentHolder</code></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package com.itheima.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CurrentHolder</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> final ThreadLocal&lt;Integer&gt; CURRENT_LOCAL = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setCurrentId</span>(<span class="params">Integer employeeId</span>)</span> &#123;</span><br><span class="line">        CURRENT_LOCAL.<span class="keyword">set</span>(employeeId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title">getCurrentId</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> CURRENT_LOCAL.<span class="keyword">get</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">remove</span>()</span> &#123;</span><br><span class="line">        CURRENT_LOCAL.<span class="keyword">remove</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>åœ¨<code>TokenFilter</code>ä¸­ï¼Œè§£æå®Œå½“å‰ç™»å½•å‘˜å·¥IDï¼Œå°†å…¶å­˜å…¥ThreadLocalï¼ˆç”¨å®Œä¹‹åéœ€å°†å…¶åˆ é™¤ï¼‰ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.utils.CurrentHolder;</span><br><span class="line"><span class="keyword">import</span> com.itheima.utils.JwtUtils;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Claims;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.*;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@WebFilter(urlPatterns = &quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TokenFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> (HttpServletResponse) servletResponse;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. è·å–è¯·æ±‚çš„urlåœ°å€</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">uri</span> <span class="operator">=</span> request.getRequestURI(); <span class="comment">// /employee/login</span></span><br><span class="line">        <span class="comment">//String url = request.getRequestURL().toString(); // http://localhost:8080/employee/login</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. åˆ¤æ–­æ˜¯å¦æ˜¯ç™»å½•è¯·æ±‚, å¦‚æœurlåœ°å€ä¸­åŒ…å« login, åˆ™è¯´æ˜æ˜¯ç™»å½•è¯·æ±‚, æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span> (uri.contains(<span class="string">&quot;login&quot;</span>)) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;ç™»å½•è¯·æ±‚, æ”¾è¡Œ&quot;</span>);</span><br><span class="line">            filterChain.doFilter(request, response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. è·å–è¯·æ±‚ä¸­çš„token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. åˆ¤æ–­tokenæ˜¯å¦ä¸ºç©º, å¦‚æœä¸ºç©º, å“åº”401çŠ¶æ€ç </span></span><br><span class="line">        <span class="keyword">if</span> (token == <span class="literal">null</span> || token.isEmpty()) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;tokenä¸ºç©º, å“åº”401çŠ¶æ€ç &quot;</span>);</span><br><span class="line">            response.setStatus(<span class="number">401</span>); <span class="comment">// å“åº”401çŠ¶æ€ç </span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. å¦‚æœtokenä¸ä¸ºç©º, è°ƒç”¨JWtUtilså·¥å…·ç±»çš„æ–¹æ³•è§£ætoken, å¦‚æœè§£æå¤±è´¥, å“åº”401çŠ¶æ€ç </span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> JwtUtils.parseJWT(token);</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">empId</span> <span class="operator">=</span> Integer.valueOf(claims.get(<span class="string">&quot;id&quot;</span>).toString());</span><br><span class="line">            CurrentHolder.setCurrentId(empId);log.info(<span class="string">&quot;tokenè§£ææˆåŠŸ, æ”¾è¡Œ&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;tokenè§£æå¤±è´¥, å“åº”401çŠ¶æ€ç &quot;</span>);</span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6. æ”¾è¡Œ</span></span><br><span class="line">        filterChain.doFilter(request, response);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//7. æ¸…ç©ºå½“å‰çº¿ç¨‹ç»‘å®šçš„id</span></span><br><span class="line">        CurrentHolder.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>åœ¨AOPç¨‹åºä¸­ï¼Œä»ThreadLocalä¸­è·å–å½“å‰ç™»å½•å‘˜å·¥çš„IDã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.anno.LogOperation;</span><br><span class="line"><span class="keyword">import</span> com.itheima.mapper.OperateLogMapper;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.OperateLog;</span><br><span class="line"><span class="keyword">import</span> com.itheima.utils.CurrentHolder;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OperationLogAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OperateLogMapper operateLogMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¯ç»•é€šçŸ¥</span></span><br><span class="line">    <span class="meta">@Around(&quot;@annotation(log)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint joinPoint, LogOperation log)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// è®°å½•å¼€å§‹æ—¶é—´</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// æ‰§è¡Œæ–¹æ³•</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> joinPoint.proceed();</span><br><span class="line">        <span class="comment">// å½“å‰æ—¶é—´</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// è€—æ—¶</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">costTime</span> <span class="operator">=</span> endTime - startTime;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ„å»ºæ—¥å¿—å¯¹è±¡</span></span><br><span class="line">        <span class="type">OperateLog</span> <span class="variable">operateLog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OperateLog</span>();</span><br><span class="line">        operateLog.setOperateEmpId(getCurrentUserId()); <span class="comment">// éœ€è¦å®ç° getCurrentUserId æ–¹æ³•</span></span><br><span class="line">        operateLog.setOperateTime(LocalDateTime.now());</span><br><span class="line">        operateLog.setClassName(joinPoint.getTarget().getClass().getName());</span><br><span class="line">        operateLog.setMethodName(joinPoint.getSignature().getName());</span><br><span class="line">        operateLog.setMethodParams(Arrays.toString(joinPoint.getArgs()));</span><br><span class="line">        operateLog.setReturnValue(result.toString());</span><br><span class="line">        operateLog.setCostTime(costTime);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ’å…¥æ—¥å¿—</span></span><br><span class="line">        operateLogMapper.insert(operateLog);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¤ºä¾‹æ–¹æ³•ï¼Œè·å–å½“å‰ç”¨æˆ·ID</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getCurrentUserId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> CurrentHolder.getCurrentId();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç ä¼˜åŒ–å®Œæ¯•ä¹‹åï¼Œæˆ‘ä»¬é‡æ–°å¯åŠ¨æœåŠ¡æµ‹è¯•ã€‚å°±å¯ä»¥çœ‹åˆ°ï¼Œå¯ä»¥è·å–åˆ°ä¸åŒçš„ç™»å½•ç”¨æˆ·ä¿¡æ¯äº†ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-502-1024x448.png" alt="img"></p><p>åœ¨åŒä¸€ä¸ªçº¿ç¨‹/åŒä¸€ä¸ªè¯·æ±‚ä¸­ï¼Œè¿›è¡Œæ•°æ®å…±äº«å°±å¯ä»¥ä½¿ç”¨ ThreadLocalã€‚</p><h1 id="å®Œç»“">å®Œç»“</h1>]]></content>
    
    
    <summary type="html">é»‘é©¬ç¨‹åºå‘˜JavaWeb+AI-å®æˆ˜ç¯‡ï¼ˆtliasæ•™åŠ¡ç³»ç»Ÿï¼‰</summary>
    
    
    
    <category term="SSM" scheme="https://itgeqian.github.io/categories/SSM/"/>
    
    
    <category term="JavaWeb" scheme="https://itgeqian.github.io/tags/JavaWeb/"/>
    
  </entry>
  
  <entry>
    <title>JavaWeb+AIï¼ˆåŸºç¡€ç¯‡ï¼‰</title>
    <link href="https://itgeqian.github.io/posts/10.html"/>
    <id>https://itgeqian.github.io/posts/10.html</id>
    <published>2025-06-19T01:19:03.000Z</published>
    <updated>2025-06-22T09:12:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-Mavenï¼ˆåŸºç¡€ï¼‰">1.Mavenï¼ˆåŸºç¡€ï¼‰</h1><h2 id="1-1ä»‹ç»">1.1ä»‹ç»</h2><p>Maven æ˜¯ä¸€æ¬¾ç”¨äºç®¡ç†å’Œæ„å»ºJavaé¡¹ç›®çš„å·¥å…·ï¼Œæ˜¯Apacheæ——ä¸‹çš„ä¸€ä¸ªå¼€æºé¡¹ç›® ã€‚</p><h2 id="1-2-Mavençš„ä½œç”¨">1.2 Mavençš„ä½œç”¨</h2><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-218-1024x459.png" alt="img"></p><h3 id="1-2-1ä¾èµ–ç®¡ç†">1.2.1ä¾èµ–ç®¡ç†</h3><p>æ–¹ä¾¿å¿«æ·çš„ç®¡ç†é¡¹ç›®ä¾èµ–çš„èµ„æº(jaråŒ…)ï¼Œé¿å…ç‰ˆæœ¬å†²çªé—®é¢˜ã€‚</p><h3 id="1-2-2é¡¹ç›®æ„å»º">1.2.2é¡¹ç›®æ„å»º</h3><p>Mavenè¿˜æä¾›äº†æ ‡å‡†åŒ–çš„è·¨å¹³å°çš„è‡ªåŠ¨åŒ–æ„å»ºæ–¹å¼ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-219-1024x160.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-220-1024x328.png" alt="img"></p><ul><li>é€šè¿‡Mavenä¸­çš„å‘½ä»¤ï¼Œå°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„å®Œæˆé¡¹ç›®çš„ç¼–è¯‘(compile)ã€æµ‹è¯•(test)ã€æ‰“åŒ…(package)ã€å‘å¸ƒ(deploy) ç­‰æ“ä½œã€‚</li><li>è€Œä¸”è¿™äº›æ“ä½œéƒ½æ˜¯è·¨å¹³å°çš„ï¼Œæ— è®ºä»€ä¹ˆç³»ç»Ÿï¼Œè¿™äº›å‘½ä»¤éƒ½æ˜¯æ”¯æŒçš„ã€‚</li></ul><h3 id="1-2-3ç»Ÿä¸€é¡¹ç›®ç»“æ„">1.2.3ç»Ÿä¸€é¡¹ç›®ç»“æ„</h3><p>Maven è¿˜æä¾›äº†æ ‡å‡†ã€ç»Ÿä¸€çš„é¡¹ç›®ç»“æ„ ã€‚</p><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨äº†Mavenè¿™ä¸€æ¬¾é¡¹ç›®æ„å»ºå·¥å…·ï¼Œå®ƒç»™æˆ‘ä»¬æä¾›äº†ä¸€å¥—æ ‡å‡†çš„javaé¡¹ç›®ç›®å½•ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-221.png" alt="img"></p><p>ä¹Ÿå°±æ„å‘³ç€ï¼Œæ— è®ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆå¼€å‘å·¥å…·ï¼Œåªè¦æ˜¯åŸºäºmavenæ„å»ºçš„javaé¡¹ç›®ï¼Œæœ€ç»ˆçš„ç›®å½•ç»“æ„éƒ½æ˜¯ç›¸åŒçš„ã€‚</p><p>æœ€åå‘¢ï¼Œä¸€å¥è¯æ€»ç»“ä¸€ä¸‹ä»€ä¹ˆæ˜¯Mavenã€‚ <strong>Mavenå°±æ˜¯ä¸€æ¬¾ç®¡ç†å’Œæ„å»ºjavaé¡¹ç›®çš„å·¥å…·ã€‚</strong></p><h2 id="2-Mavenæ¦‚è¿°">2.Mavenæ¦‚è¿°</h2><h3 id="2-1Mavenä»‹ç»">2.1Mavenä»‹ç»</h3><p>Apache Mavenæ˜¯ä¸€ä¸ªé¡¹ç›®ç®¡ç†å’Œæ„å»ºå·¥å…·ï¼Œå®ƒåŸºäºé¡¹ç›®å¯¹è±¡æ¨¡å‹(Project Object Model , ç®€ç§°: POM)çš„æ¦‚å¿µï¼Œé€šè¿‡ä¸€å°æ®µæè¿°ä¿¡æ¯æ¥ç®¡ç†é¡¹ç›®çš„æ„å»ºã€æŠ¥å‘Šå’Œæ–‡æ¡£ã€‚</p><p>å®˜ç½‘ï¼š<a href="https://maven.apache.org/">https://maven.apache.org/</a></p><p>Mavençš„ä½œç”¨ï¼š</p><ol><li>æ–¹ä¾¿çš„ä¾èµ–ç®¡ç†</li><li>ç»Ÿä¸€çš„é¡¹ç›®ç»“æ„</li><li>æ ‡å‡†çš„é¡¹ç›®æ„å»ºæµç¨‹</li></ol><h3 id="2-2Mavenæ¨¡å‹">2.2Mavenæ¨¡å‹</h3><ul><li>é¡¹ç›®å¯¹è±¡æ¨¡å‹ (Project Object Model)</li><li>ä¾èµ–ç®¡ç†æ¨¡å‹(Dependency)</li><li>æ„å»ºç”Ÿå‘½å‘¨æœŸ/é˜¶æ®µ(Build lifecycle &amp; phases)</li></ul><p>1). æ„å»ºç”Ÿå‘½å‘¨æœŸ/é˜¶æ®µ(Build lifecycle &amp; phases)</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-222-1024x429.png" alt="img"></p><p>ä»¥ä¸Šå›¾ä¸­ç´«è‰²æ¡†èµ·æ¥çš„éƒ¨åˆ†ï¼Œå°±æ˜¯ç”¨æ¥å®Œæˆæ ‡å‡†åŒ–æ„å»ºæµç¨‹ ã€‚å½“æˆ‘ä»¬éœ€è¦ç¼–è¯‘ï¼ŒMavenæä¾›äº†ä¸€ä¸ªç¼–è¯‘æ’ä»¶ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼›å½“æˆ‘ä»¬éœ€è¦æ‰“åŒ…ï¼ŒMavenå°±æä¾›äº†ä¸€ä¸ªæ‰“åŒ…æ’ä»¶ä¾›æˆ‘ä»¬ä½¿ç”¨ç­‰ã€‚</p><p>2). é¡¹ç›®å¯¹è±¡æ¨¡å‹ (Project Object Model)</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-223-1024x431.png" alt="img"></p><p>ä»¥ä¸Šå›¾ä¸­ç´«è‰²æ¡†èµ·æ¥çš„éƒ¨åˆ†å±äºé¡¹ç›®å¯¹è±¡æ¨¡å‹ï¼Œå°±æ˜¯å°†æˆ‘ä»¬è‡ªå·±çš„é¡¹ç›®æŠ½è±¡æˆä¸€ä¸ªå¯¹è±¡æ¨¡å‹ï¼Œæœ‰è‡ªå·±ä¸“å±çš„åæ ‡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºæ˜¯ä¸€ä¸ªMavené¡¹ç›®ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-224-1024x498.png" alt="img"></p><p>åæ ‡ï¼Œå°±æ˜¯èµ„æº(jaråŒ…)çš„å”¯ä¸€æ ‡è¯†ï¼Œé€šè¿‡åæ ‡å¯ä»¥å®šä½åˆ°æ‰€éœ€èµ„æº(jaråŒ…)ä½ç½®ã€‚</p><p>åæ ‡çš„ç»„æˆéƒ¨åˆ†ï¼š</p><ul><li>groupId: ç»„ç»‡å</li><li>arfitactId: æ¨¡å—å</li><li>Version: ç‰ˆæœ¬å·</li></ul><p>3). ä¾èµ–ç®¡ç†æ¨¡å‹(Dependency)</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-225-1024x430.png" alt="img"></p><p>ä»¥ä¸Šå›¾ä¸­ç´«è‰²æ¡†èµ·æ¥çš„éƒ¨åˆ†å±äºä¾èµ–ç®¡ç†æ¨¡å‹ï¼Œæ˜¯ä½¿ç”¨åæ ‡æ¥æè¿°å½“å‰é¡¹ç›®ä¾èµ–å“ªäº›ç¬¬ä¸‰æ–¹jaråŒ…ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-226-1024x407.png" alt="img"></p><p>ä¹‹å‰æˆ‘ä»¬é¡¹ç›®ä¸­éœ€è¦jaråŒ…æ—¶ï¼Œç›´æ¥å°±æŠŠjaråŒ…å¤åˆ¶åˆ°é¡¹ç›®ä¸‹çš„libç›®å½•ï¼Œè€Œç°åœ¨æˆ‘ä»¬åªéœ€è¦åœ¨pom.xmlä¸­é…ç½®ä¾èµ–çš„é…ç½®æ–‡ä»¶å³å¯ã€‚ è€Œè¿™ä¸ªä¾èµ–å¯¹åº”çš„jaråŒ…å…¶å®å°±åœ¨æˆ‘ä»¬æœ¬åœ°ç”µè„‘ä¸Šçš„mavenä»“åº“ä¸­ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-273-1024x452.png" alt="img"></p><h3 id="2-3Mavenä»“åº“">2.3Mavenä»“åº“</h3><p>ä»“åº“ï¼šç”¨äºå­˜å‚¨èµ„æºï¼Œç®¡ç†å„ç§jaråŒ…</p><p><strong>ä»“åº“çš„æœ¬è´¨</strong>å°±æ˜¯ä¸€ä¸ªç›®å½•(æ–‡ä»¶å¤¹)ï¼Œè¿™ä¸ªç›®å½•è¢«ç”¨æ¥å­˜å‚¨å¼€å‘ä¸­æ‰€æœ‰ä¾èµ–(å°±æ˜¯jaråŒ…)å’Œæ’ä»¶</p><p>Mavenä»“åº“åˆ†ä¸ºï¼š</p><ul><li>æœ¬åœ°ä»“åº“ï¼šè‡ªå·±è®¡ç®—æœºä¸Šçš„ä¸€ä¸ªç›®å½•(ç”¨æ¥å­˜å‚¨jaråŒ…)</li><li>ä¸­å¤®ä»“åº“ï¼šç”±Mavenå›¢é˜Ÿç»´æŠ¤çš„å…¨çƒå”¯ä¸€çš„ã€‚ä»“åº“åœ°å€ï¼š<a href="https://repo1.maven.org/maven2/">https://repo1.maven.org/maven2/</a></li><li>è¿œç¨‹ä»“åº“(ç§æœ)ï¼šä¸€èˆ¬ç”±å…¬å¸å›¢é˜Ÿæ­å»ºçš„ç§æœ‰ä»“åº“</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-227-1024x343.png" alt="img"></p><p>å½“é¡¹ç›®ä¸­ä½¿ç”¨åæ ‡å¼•å…¥å¯¹åº”ä¾èµ–jaråŒ…åï¼Œ</p><ul><li>é¦–å…ˆä¼šæŸ¥æ‰¾æœ¬åœ°ä»“åº“ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„jaråŒ…<ul><li>å¦‚æœæœ‰ï¼Œåˆ™åœ¨é¡¹ç›®ç›´æ¥å¼•ç”¨</li><li>å¦‚æœæ²¡æœ‰ï¼Œåˆ™å»ä¸­å¤®ä»“åº“ä¸­ä¸‹è½½å¯¹åº”çš„jaråŒ…åˆ°æœ¬åœ°ä»“åº“</li></ul></li><li>å¦‚æœè¿˜å¯ä»¥æ­å»ºè¿œç¨‹ä»“åº“(ç§æœ)ï¼Œå°†æ¥jaråŒ…çš„æŸ¥æ‰¾é¡ºåºåˆ™å˜ä¸ºï¼š æœ¬åœ°ä»“åº“ --&gt; è¿œç¨‹ä»“åº“â€“&gt; ä¸­å¤®ä»“åº“</li></ul><h3 id="2-4Mavenå®‰è£…æ­¥éª¤">2.4Mavenå®‰è£…æ­¥éª¤</h3><ol><li>è§£å‹å®‰è£…</li><li>é…ç½®ä»“åº“</li><li>é…ç½®é˜¿é‡Œäº‘ç§æœ</li><li>é…ç½®Mavenç¯å¢ƒå˜é‡</li></ol><h3 id="2-5Mavençš„é…ç½®">2.5Mavençš„é…ç½®</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-228-1024x619.png" alt="img"></p><h3 id="2-6åˆ›å»ºé¡¹ç›®">2.6åˆ›å»ºé¡¹ç›®</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-229.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-230-1024x535.png" alt="img"></p><h3 id="2-7pomæ–‡ä»¶è¯¦è§£">2.7pomæ–‡ä»¶è¯¦è§£</h3><p>POM (Project Object Model) ï¼šæŒ‡çš„æ˜¯é¡¹ç›®å¯¹è±¡æ¨¡å‹ï¼Œç”¨æ¥æè¿°å½“å‰çš„mavené¡¹ç›®ã€‚</p><p><strong>pomæ–‡ä»¶è¯¦è§£ï¼š</strong></p><ul><li><p><code>&lt;project&gt;</code>ï¼špomæ–‡ä»¶çš„æ ¹æ ‡ç­¾ï¼Œè¡¨ç¤ºå½“å‰mavené¡¹ç›®</p></li><li><pre><code>&lt;modelVersion&gt;<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  ï¼šå£°æ˜é¡¹ç›®æè¿°éµå¾ªå“ªä¸€ä¸ªPOMæ¨¡å‹ç‰ˆæœ¬</span><br><span class="line"></span><br><span class="line"><span class="bullet">  -</span> è™½ç„¶æ¨¡å‹æœ¬èº«çš„ç‰ˆæœ¬å¾ˆå°‘æ”¹å˜ï¼Œä½†å®ƒä»ç„¶æ˜¯å¿…ä¸å¯å°‘çš„ã€‚ç›®å‰POMæ¨¡å‹ç‰ˆæœ¬æ˜¯4.0.0</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> åæ ‡ ï¼š</span><br><span class="line"></span><br><span class="line"><span class="bullet">  -</span> <span class="code">`&lt;groupId&gt;`</span> <span class="code">`&lt;artifactId&gt;`</span> <span class="code">`&lt;version&gt;`</span></span><br><span class="line"><span class="bullet">  -</span> å®šä½é¡¹ç›®åœ¨æœ¬åœ°ä»“åº“ä¸­çš„ä½ç½®ï¼Œç”±ä»¥ä¸Šä¸‰ä¸ªæ ‡ç­¾ç»„æˆä¸€ä¸ªåæ ‡</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="code">`&lt;maven.compiler.source&gt;`</span> ï¼šç¼–è¯‘JDKçš„ç‰ˆæœ¬</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="code">`&lt;maven.compiler.target&gt;`</span> ï¼šè¿è¡ŒJDKçš„ç‰ˆæœ¬</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="code">`&lt;project.build.sourceEncoding&gt;`</span> : è®¾ç½®é¡¹ç›®çš„å­—ç¬¦é›†</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-231-1024x766.png</span>)</span><br><span class="line"></span><br><span class="line"><span class="section">### 2.8Mavenåæ ‡</span></span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯åæ ‡ï¼Ÿ</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> Mavenä¸­çš„åæ ‡æ˜¯<span class="strong">**èµ„æº**</span><span class="strong">**çš„å”¯ä¸€æ ‡è¯†**</span> , é€šè¿‡è¯¥åæ ‡å¯ä»¥å”¯ä¸€å®šä½èµ„æºä½ç½®</span><br><span class="line"><span class="bullet">-</span> ä½¿ç”¨åæ ‡æ¥å®šä¹‰é¡¹ç›®æˆ–å¼•å…¥é¡¹ç›®ä¸­éœ€è¦çš„ä¾èµ–</span><br><span class="line"></span><br><span class="line">Mavenåæ ‡ä¸»è¦ç»„æˆï¼š</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> groupIdï¼šå®šä¹‰å½“å‰Mavené¡¹ç›®éš¶å±ç»„ç»‡åç§°ï¼ˆé€šå¸¸æ˜¯åŸŸååå†™ï¼Œä¾‹å¦‚ï¼šcom.itheimaï¼‰</span><br><span class="line"><span class="bullet">-</span> artifactIdï¼šå®šä¹‰å½“å‰Mavené¡¹ç›®åç§°ï¼ˆé€šå¸¸æ˜¯æ¨¡å—åç§°ï¼Œä¾‹å¦‚ order-serviceã€goods-serviceï¼‰</span><br><span class="line"><span class="bullet">-</span> versionï¼šå®šä¹‰å½“å‰é¡¹ç›®ç‰ˆæœ¬å·</span><br><span class="line"><span class="bullet">  -</span> SNAPSHOT: åŠŸèƒ½ä¸ç¨³å®šã€å°šå¤„äºå¼€å‘ä¸­çš„ç‰ˆæœ¬ï¼Œå³å¿«ç…§ç‰ˆæœ¬</span><br><span class="line"><span class="bullet">  -</span> RELEASE: åŠŸèƒ½è¶‹äºç¨³å®šã€å½“å‰æ›´æ–°åœæ­¢ï¼Œå¯ä»¥ç”¨äºå‘è¡Œçš„ç‰ˆæœ¬</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-232.png</span>)</span><br><span class="line"></span><br><span class="line"><span class="strong">**æ³¨æ„ï¼š**</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> ä¸Šé¢æ‰€è¯´çš„èµ„æºå¯ä»¥æ˜¯æ’ä»¶ã€ä¾èµ–ã€å½“å‰é¡¹ç›®ã€‚</span><br><span class="line"><span class="bullet">-</span> æˆ‘ä»¬çš„é¡¹ç›®å¦‚æœè¢«å…¶ä»–çš„é¡¹ç›®ä¾èµ–æ—¶ï¼Œä¹Ÿæ˜¯éœ€è¦åæ ‡æ¥å¼•å…¥çš„ã€‚</span><br><span class="line"></span><br><span class="line"><span class="section">## 3.ä¾èµ–ç®¡ç†</span></span><br><span class="line"></span><br><span class="line"><span class="section">### 3.1ä¾èµ–é…ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="section">#### 3.1.1åŸºæœ¬é…ç½®</span></span><br><span class="line"></span><br><span class="line">ä¾èµ–ï¼šæŒ‡å½“å‰é¡¹ç›®è¿è¡Œæ‰€éœ€è¦çš„jaråŒ…ã€‚ä¸€ä¸ªé¡¹ç›®ä¸­å¯ä»¥å¼•å…¥å¤šä¸ªä¾èµ–ï¼š</span><br><span class="line"></span><br><span class="line">ä¾‹å¦‚ï¼šå¼•å…¥logbackæ—¥å¿—çš„ä¾èµ–ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> åœ¨pom.xmlä¸­ç¼–å†™<span class="code">`&lt;dependencies&gt;`</span>æ ‡ç­¾</span><br><span class="line"><span class="bullet">2.</span> åœ¨<span class="code">`&lt;dependencies&gt;`</span>æ ‡ç­¾ä¸­ä½¿ç”¨<span class="code">`&lt;dependency&gt;`</span>å¼•å…¥åæ ‡</span><br><span class="line"><span class="bullet">3.</span> å®šä¹‰åæ ‡çš„ <span class="code">`groupId`</span>ã€<span class="code">`artifactId`</span>ã€<span class="code">`version`</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></code></pre></li></ul><dependencies>    <!-- ä¾èµ– : spring-context -->    <dependency>        <groupId>org.springframework</groupId>        <artifactId>spring-context</artifactId>        <version>6.1.4</version>    </dependency></dependencies><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">4</span>.ç‚¹å‡»åˆ·æ–°æŒ‰é’®ï¼Œå¼•å…¥æœ€æ–°åŠ å…¥çš„åæ ‡</span><br><span class="line"></span><br><span class="line">#### <span class="number">3.1</span><span class="selector-class">.2</span>æŸ¥æ‰¾ä¾èµ–</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>.åˆ©ç”¨ä¸­å¤®ä»“åº“æœç´¢çš„ä¾èµ–åæ ‡</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>.åˆ©ç”¨<span class="selector-tag">IDEA</span>å·¥å…·æœç´¢ä¾èµ–</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>.æ’ä»¶(maven search)</span><br><span class="line"></span><br><span class="line">#### <span class="number">3.1</span><span class="selector-class">.3</span>ä¾èµ–ä¼ é€’</span><br><span class="line"></span><br><span class="line">æˆ‘ä»¬ä¸Šé¢åœ¨<span class="selector-tag">pom</span><span class="selector-class">.xml</span>ä¸­é…ç½®äº†ä¸€é¡¹ä¾èµ–ï¼Œå°±æ˜¯<span class="selector-tag">spring-context</span>ï¼Œä½†æ˜¯æˆ‘ä»¬é€šè¿‡å³ä¾§çš„<span class="selector-tag">maven</span>é¢æ¿å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®å¼•å…¥è¿›æ¥çš„ä¾èµ–ï¼Œå¹¶ä¸æ˜¯è¿™ä¸€é¡¹ï¼Œæœ‰éå¸¸å¤šçš„ä¾èµ–ã€‚</span><br><span class="line"></span><br><span class="line">ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™æ ·çš„ç°è±¡å‘¢? é‚£è¿™é‡Œå‘¢ï¼Œå°±æ¶‰åŠåˆ°<span class="selector-tag">maven</span>ä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªç‰¹æ€§ï¼Œé‚£å°±æ˜¯<span class="selector-tag">Maven</span>ä¸­çš„**ä¾èµ–ä¼ é€’**ã€‚</span><br><span class="line"></span><br><span class="line">æ‰€è°“<span class="selector-tag">maven</span>çš„ä¾èµ–ä¼ é€’ï¼ŒæŒ‡çš„å°±æ˜¯å¦‚æœåœ¨<span class="selector-tag">maven</span>é¡¹ç›®ä¸­ï¼Œ<span class="selector-tag">A</span> ä¾èµ–äº†<span class="selector-tag">B</span>ï¼Œ<span class="selector-tag">B</span>ä¾èµ–äº†<span class="selector-tag">C</span>ï¼Œ<span class="selector-tag">C</span>ä¾èµ–äº†<span class="selector-tag">D</span>ï¼Œé‚£ä¹ˆåœ¨<span class="selector-tag">A</span>é¡¹ç›®ä¸­ï¼Œä¹Ÿä¼šæœ‰<span class="selector-tag">C</span>ã€<span class="selector-tag">D</span>ä¾èµ–ï¼Œå› ä¸ºä¾èµ–ä¼šä¼ é€’ã€‚</span><br><span class="line"></span><br><span class="line">é‚£å¦‚æœï¼Œä¼ é€’ä¸‹æ¥çš„ä¾èµ–ï¼Œåœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç¡®å®ä¸éœ€è¦ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<span class="selector-tag">Maven</span>ä¸­çš„æ’é™¤ä¾èµ–åŠŸèƒ½ï¼Œæ¥å°†è¿™ä¸ªä¾èµ–æ’é™¤æ‰ã€‚</span><br><span class="line"></span><br><span class="line">#### <span class="number">3.1</span><span class="selector-class">.4</span>æ’é™¤ä¾èµ–</span><br><span class="line"></span><br><span class="line">æ’é™¤ä¾èµ–ï¼šæŒ‡ä¸»åŠ¨æ–­å¼€ä¾èµ–çš„èµ„æºï¼Œè¢«æ’é™¤çš„èµ„æºæ— éœ€æŒ‡å®šç‰ˆæœ¬ã€‚</span><br><span class="line"></span><br><span class="line">!<span class="selector-attr">[img]</span>(<span class="attribute">https</span>:<span class="comment">//www.legendkiller.xyz/wp-content/uploads/2025/06/image-233.png)</span></span><br><span class="line"></span><br><span class="line">### <span class="number">3.2</span>ç”Ÿå‘½å‘¨æœŸ</span><br><span class="line"></span><br><span class="line">Mavençš„ç”Ÿå‘½å‘¨æœŸå°±æ˜¯ä¸ºäº†å¯¹æ‰€æœ‰çš„æ„å»ºè¿‡ç¨‹è¿›è¡ŒæŠ½è±¡å’Œç»Ÿä¸€ã€‚ æè¿°äº†ä¸€æ¬¡é¡¹ç›®æ„å»ºï¼Œç»å†å“ªäº›é˜¶æ®µã€‚</span><br><span class="line"></span><br><span class="line">Mavenä»å¤§é‡é¡¹ç›®å’Œæ„å»ºå·¥å…·ä¸­å­¦ä¹ å’Œåæ€ï¼Œç„¶åæ€»ç»“äº†ä¸€å¥—é«˜åº¦å®Œç¾çš„ï¼Œæ˜“æ‰©å±•çš„é¡¹ç›®æ„å»ºç”Ÿå‘½å‘¨æœŸã€‚è¿™ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…å«äº†é¡¹ç›®çš„æ¸…ç†ï¼Œåˆå§‹åŒ–ï¼Œç¼–è¯‘ï¼Œæµ‹è¯•ï¼Œæ‰“åŒ…ï¼Œé›†æˆæµ‹è¯•ï¼ŒéªŒè¯ï¼Œéƒ¨ç½²å’Œç«™ç‚¹ç”Ÿæˆç­‰å‡ ä¹æ‰€æœ‰æ„å»ºæ­¥éª¤ã€‚</span><br><span class="line"></span><br><span class="line">Mavenå¯¹é¡¹ç›®æ„å»ºçš„ç”Ÿå‘½å‘¨æœŸåˆ’åˆ†ä¸º<span class="number">3</span>å¥—ï¼ˆç›¸äº’ç‹¬ç«‹ï¼‰ï¼š</span><br><span class="line"></span><br><span class="line">![img](<span class="attribute">https</span>:<span class="comment">//www.legendkiller.xyz/wp-content/uploads/2025/06/image-274-1024x171.png)</span></span><br><span class="line"></span><br><span class="line">- cleanï¼šæ¸…ç†å·¥ä½œã€‚</span><br><span class="line">- defaultï¼šæ ¸å¿ƒå·¥ä½œã€‚å¦‚ï¼šç¼–è¯‘ã€æµ‹è¯•ã€æ‰“åŒ…ã€å®‰è£…ã€éƒ¨ç½²ç­‰ã€‚</span><br><span class="line">- siteï¼šç”ŸæˆæŠ¥å‘Šã€å‘å¸ƒç«™ç‚¹ç­‰ã€‚</span><br><span class="line"></span><br><span class="line">![img](<span class="attribute">https</span>:<span class="comment">//www.legendkiller.xyz/wp-content/uploads/2025/06/image-234-1024x482.png)</span></span><br><span class="line"></span><br><span class="line">ä¸»è¦å…³æ³¨ä»¥ä¸‹å‡ ä¸ªï¼š</span><br><span class="line"></span><br><span class="line">- cleanï¼šç§»é™¤ä¸Šä¸€æ¬¡æ„å»ºç”Ÿæˆçš„æ–‡ä»¶</span><br><span class="line">- compileï¼šç¼–è¯‘é¡¹ç›®æºä»£ç </span><br><span class="line">- testï¼šä½¿ç”¨åˆé€‚çš„å•å…ƒæµ‹è¯•æ¡†æ¶è¿è¡Œæµ‹è¯•(junit)</span><br><span class="line">- packageï¼šå°†ç¼–è¯‘åçš„æ–‡ä»¶æ‰“åŒ…ï¼Œå¦‚ï¼šjarã€warç­‰</span><br><span class="line">- installï¼šå®‰è£…é¡¹ç›®åˆ°æœ¬åœ°ä»“åº“</span><br><span class="line"></span><br><span class="line">- ç”Ÿå‘½å‘¨æœŸçš„é¡ºåºæ˜¯ï¼š<span class="built_in">`clean`</span> --&gt; <span class="built_in">`validate`</span> --&gt; <span class="built_in">`compile`</span> --&gt; <span class="built_in">`test`</span> --&gt; <span class="built_in">`package`</span> --&gt; <span class="built_in">`verify`</span> --&gt; <span class="built_in">`install`</span> --&gt; <span class="built_in">`site`</span> --&gt; <span class="built_in">`deploy`</span></span><br><span class="line">- æˆ‘ä»¬éœ€è¦å…³æ³¨çš„å°±æ˜¯ï¼š<span class="built_in">`clean`</span> --&gt; <span class="built_in">`compile`</span> --&gt; <span class="built_in">`test`</span> --&gt; <span class="built_in">`package`</span> --&gt; <span class="built_in">`install`</span></span><br><span class="line"></span><br><span class="line">æ‰§è¡Œæ–¹å¼ï¼š</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>.**åœ¨ideaä¸­æ‰§è¡Œç”Ÿå‘½å‘¨æœŸ**</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>.**åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œç”Ÿå‘½å‘¨æœŸ**</span><br><span class="line"></span><br><span class="line">- mvn compile</span><br><span class="line">- mvn test</span><br><span class="line">- mvn package</span><br><span class="line">- mvn install</span><br><span class="line"></span><br><span class="line">## <span class="number">4</span>.å•å…ƒæµ‹è¯•</span><br><span class="line"></span><br><span class="line">### <span class="number">4.1</span>ä»‹ç»</span><br><span class="line"></span><br><span class="line">**æµ‹è¯•ï¼š**æ˜¯ä¸€ç§ç”¨æ¥ä¿ƒè¿›é‰´å®šè½¯ä»¶çš„æ­£ç¡®æ€§ã€å®Œæ•´æ€§ã€å®‰å…¨æ€§å’Œè´¨é‡çš„è¿‡ç¨‹ã€‚</span><br><span class="line"></span><br><span class="line">**é˜¶æ®µåˆ’åˆ†ï¼š**å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€ç³»ç»Ÿæµ‹è¯•ã€éªŒæ”¶æµ‹è¯•ã€‚</span><br><span class="line"></span><br><span class="line">![img](<span class="attribute">https</span>:<span class="comment">//www.legendkiller.xyz/wp-content/uploads/2025/06/image-235-1024x246.png)</span></span><br><span class="line"></span><br><span class="line">**æµ‹è¯•æ–¹æ³•ï¼š**ç™½ç›’æµ‹è¯•ã€é»‘ç›’æµ‹è¯• åŠ ç°ç›’æµ‹è¯•</span><br><span class="line"></span><br><span class="line">![img](<span class="attribute">https</span>:<span class="comment">//www.legendkiller.xyz/wp-content/uploads/2025/06/image-236-1024x226.png)</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span>). ç™½ç›’æµ‹è¯•</span><br><span class="line"></span><br><span class="line">æ¸…æ¥šè½¯ä»¶å†…éƒ¨ç»“æ„ã€ä»£ç é€»è¾‘ã€‚ç”¨äºéªŒè¯ä»£ç ã€é€»è¾‘æ­£ç¡®æ€§ã€‚</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>). é»‘ç›’æµ‹è¯•</span><br><span class="line"></span><br><span class="line">ä¸æ¸…æ¥šè½¯ä»¶å†…éƒ¨ç»“æ„ã€ä»£ç é€»è¾‘ã€‚ç”¨äºéªŒè¯è½¯ä»¶çš„åŠŸèƒ½ã€å…¼å®¹æ€§ã€éªŒæ”¶æµ‹è¯•ç­‰æ–¹é¢ã€‚</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>). ç°ç›’æµ‹è¯•</span><br><span class="line"></span><br><span class="line">ç»“åˆäº†ç™½ç›’æµ‹è¯•å’Œé»‘ç›’æµ‹è¯•çš„ç‰¹ç‚¹ï¼Œæ—¢å…³æ³¨è½¯ä»¶çš„å†…éƒ¨ç»“æ„åˆè€ƒè™‘å¤–éƒ¨è¡¨ç°ï¼ˆåŠŸèƒ½ï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">### <span class="number">4.2</span>Junitå…¥é—¨</span><br><span class="line"></span><br><span class="line">- å•å…ƒæµ‹è¯•ï¼šå°±æ˜¯é’ˆå¯¹æœ€å°çš„åŠŸèƒ½å•å…ƒ(æ–¹æ³•)ï¼Œç¼–å†™æµ‹è¯•ä»£ç å¯¹å…¶æ­£ç¡®æ€§è¿›è¡Œæµ‹è¯•ã€‚</span><br><span class="line">- JUnitï¼šæœ€æµè¡Œçš„Javaæµ‹è¯•æ¡†æ¶ä¹‹ä¸€ï¼Œæä¾›äº†ä¸€äº›åŠŸèƒ½ï¼Œæ–¹ä¾¿ç¨‹åºè¿›è¡Œå•å…ƒæµ‹è¯•ï¼ˆç¬¬ä¸‰æ–¹å…¬å¸æä¾›ï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">#### <span class="number">4.2</span>.<span class="number">1</span>ä¸ºä»€ä¹ˆä½¿ç”¨Junitï¼Ÿ</span><br><span class="line"></span><br><span class="line">é€šè¿‡**mainæ–¹æ³•**æ˜¯å¯ä»¥è¿›è¡Œæµ‹è¯•çš„ï¼Œå¯ä»¥æµ‹è¯•ç¨‹åºæ˜¯å¦æ­£å¸¸è¿è¡Œã€‚ä½†æ˜¯mainæ–¹æ³•è¿›è¡Œæµ‹è¯•æ—¶ï¼Œä¼šå­˜åœ¨å¦‚ä¸‹é—®é¢˜ï¼š</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. æµ‹è¯•ä»£ç ä¸æºä»£ç æœªåˆ†å¼€ï¼Œéš¾ç»´æŠ¤ã€‚</span><br><span class="line"><span class="number">2</span>. ä¸€ä¸ªæ–¹æ³•æµ‹è¯•å¤±è´¥ï¼Œå½±å“åé¢æ–¹æ³•ã€‚</span><br><span class="line"><span class="number">3</span>. æ— æ³•è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå¾—åˆ°æµ‹è¯•æŠ¥å‘Šã€‚</span><br><span class="line"></span><br><span class="line">è€Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨äº†**JUnitå•å…ƒæµ‹è¯•**æ¡†æ¶è¿›è¡Œæµ‹è¯•ï¼Œå°†ä¼šæœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. æµ‹è¯•ä»£ç ä¸æºä»£ç åˆ†å¼€ï¼Œä¾¿äºç»´æŠ¤ã€‚</span><br><span class="line"><span class="number">2</span>. å¯æ ¹æ®éœ€è¦è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚</span><br><span class="line"><span class="number">3</span>. å¯è‡ªåŠ¨åˆ†ææµ‹è¯•ç»“æœï¼Œäº§å‡ºæµ‹è¯•æŠ¥å‘Šã€‚</span><br><span class="line"></span><br><span class="line">#### <span class="number">4.2</span>.<span class="number">2</span>æ–­è¨€</span><br><span class="line"></span><br><span class="line">JUnitæä¾›äº†ä¸€äº›è¾…åŠ©æ–¹æ³•ï¼Œç”¨æ¥å¸®æˆ‘ä»¬ç¡®å®šè¢«æµ‹è¯•çš„æ–¹æ³•æ˜¯å¦æŒ‰ç…§é¢„æœŸçš„æ•ˆæœæ­£å¸¸å·¥ä½œï¼Œè¿™ç§æ–¹å¼ç§°ä¸º**æ–­è¨€**ã€‚</span><br><span class="line"></span><br><span class="line">| æ–­è¨€æ–¹æ³•                                              | æè¿°                                       |</span><br><span class="line">| ----------------------------------------------------- | ------------------------------------------ |</span><br><span class="line">| <span class="built_in">assertEquals</span>(Object exp, Object act, String msg)      | æ£€æŸ¥ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼Œä¸ç›¸ç­‰å°±æŠ¥é”™ã€‚         |</span><br><span class="line">| <span class="built_in">assertNotEquals</span>(Object unexp, Object act, String msg) | æ£€æŸ¥ä¸¤ä¸ªå€¼æ˜¯å¦ä¸ç›¸ç­‰ï¼Œç›¸ç­‰å°±æŠ¥é”™ã€‚         |</span><br><span class="line">| <span class="built_in">assertNull</span>(Object act, String msg)                    | æ£€æŸ¥å¯¹è±¡æ˜¯å¦ä¸ºnullï¼Œä¸ä¸ºnullï¼Œå°±æŠ¥é”™ã€‚     |</span><br><span class="line">| <span class="built_in">assertNotNull</span>(Object act, String msg)                 | æ£€æŸ¥å¯¹è±¡æ˜¯å¦ä¸ä¸ºnullï¼Œä¸ºnullï¼Œå°±æŠ¥é”™ã€‚     |</span><br><span class="line">| <span class="built_in">assertTrue</span>(boolean condition, String msg)             | æ£€æŸ¥æ¡ä»¶æ˜¯å¦ä¸ºtrueï¼Œä¸ä¸ºtrueï¼Œå°±æŠ¥é”™ã€‚     |</span><br><span class="line">| <span class="built_in">assertFalse</span>(boolean condition, String msg)            | æ£€æŸ¥æ¡ä»¶æ˜¯å¦ä¸ºfalseï¼Œä¸ä¸ºfalseï¼Œå°±æŠ¥é”™ã€‚   |</span><br><span class="line">| <span class="built_in">assertSame</span>(Object exp, Object act, String msg)        | æ£€æŸ¥ä¸¤ä¸ªå¯¹è±¡å¼•ç”¨æ˜¯å¦ç›¸ç­‰ï¼Œä¸ç›¸ç­‰ï¼Œå°±æŠ¥é”™ã€‚ |</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨æ–­è¨€çš„åŸå› ï¼š</span><br><span class="line"></span><br><span class="line">- <span class="number">1</span>ã€å•å…ƒæµ‹è¯•æ–¹æ³•è¿è¡Œä¸æŠ¥é”™ï¼Œä¸ä»£è¡¨ä¸šåŠ¡æ–¹æ³•æ²¡é—®é¢˜ï¼›</span><br><span class="line">- <span class="number">2</span>ã€é€šè¿‡æ–­è¨€çœ‹å¯ä»¥æ£€æµ‹æ–¹æ³•è¿è¡Œç»“æœæ˜¯å¦å’Œé¢„æœŸä¸€è‡´ï¼Œä»è€Œåˆ¤æ–­ä¸šåŠ¡æ–¹æ³•é€»è¾‘çš„æ­£ç¡®æ€§ï¼›</span><br><span class="line"></span><br><span class="line">#### <span class="number">4.2</span>.<span class="number">3</span>å¸¸è§æ³¨è§£</span><br><span class="line"></span><br><span class="line">åœ¨JUnitä¸­è¿˜æä¾›äº†ä¸€äº›æ³¨è§£ï¼Œè¿˜å¢å¼ºå…¶åŠŸèƒ½ï¼Œå¸¸è§çš„æ³¨è§£æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</span><br><span class="line"></span><br><span class="line">| æ³¨è§£               | è¯´æ˜                                                         | å¤‡æ³¨                            |</span><br><span class="line">| ------------------ | ------------------------------------------------------------ | ------------------------------- |</span><br><span class="line">| <span class="variable">@Test</span>              | æµ‹è¯•ç±»ä¸­çš„æ–¹æ³•ç”¨å®ƒä¿®é¥°æ‰èƒ½æˆä¸ºæµ‹è¯•æ–¹æ³•ï¼Œæ‰èƒ½å¯åŠ¨æ‰§è¡Œ         | å•å…ƒæµ‹è¯•                        |</span><br><span class="line">| <span class="variable">@BeforeEach</span>        | ç”¨æ¥ä¿®é¥°ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ¯ä¸€ä¸ªæµ‹è¯•æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œä¸€æ¬¡ã€‚ | åˆå§‹åŒ–èµ„æº(å‡†å¤‡å·¥ä½œ)            |</span><br><span class="line">| <span class="variable">@AfterEach</span>         | ç”¨æ¥ä¿®é¥°ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ¯ä¸€ä¸ªæµ‹è¯•æ–¹æ³•æ‰§è¡Œä¹‹åæ‰§è¡Œä¸€æ¬¡ã€‚ | é‡Šæ”¾èµ„æº(æ¸…ç†å·¥ä½œ)              |</span><br><span class="line">| <span class="variable">@BeforeAll</span>         | ç”¨æ¥ä¿®é¥°ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ‰€æœ‰æµ‹è¯•æ–¹æ³•ä¹‹å‰åªæ‰§è¡Œä¸€æ¬¡ã€‚ | åˆå§‹åŒ–èµ„æº(å‡†å¤‡å·¥ä½œ)            |</span><br><span class="line">| <span class="variable">@AfterAll</span>          | ç”¨æ¥ä¿®é¥°ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ‰€æœ‰æµ‹è¯•æ–¹æ³•ä¹‹ååªæ‰§è¡Œä¸€æ¬¡ã€‚ | é‡Šæ”¾èµ„æº(æ¸…ç†å·¥ä½œ)              |</span><br><span class="line">| <span class="variable">@ParameterizedTest</span> | å‚æ•°åŒ–æµ‹è¯•çš„æ³¨è§£ (å¯ä»¥è®©å•ä¸ªæµ‹è¯•è¿è¡Œå¤šæ¬¡ï¼Œæ¯æ¬¡è¿è¡Œæ—¶ä»…å‚æ•°ä¸åŒ) | ç”¨äº†è¯¥æ³¨è§£ï¼Œå°±ä¸éœ€è¦<span class="variable">@Test</span>æ³¨è§£äº† |</span><br><span class="line">| <span class="variable">@ValueSource</span>       | å‚æ•°åŒ–æµ‹è¯•çš„å‚æ•°æ¥æºï¼Œèµ‹äºˆæµ‹è¯•æ–¹æ³•å‚æ•°                       | ä¸å‚æ•°åŒ–æµ‹è¯•æ³¨è§£é…åˆä½¿ç”¨        |</span><br><span class="line">| <span class="variable">@DisplayName</span>       | æŒ‡å®šæµ‹è¯•ç±»ã€æµ‹è¯•æ–¹æ³•æ˜¾ç¤ºçš„åç§° ï¼ˆé»˜è®¤ä¸ºç±»åã€æ–¹æ³•åï¼‰        |                                 |</span><br><span class="line"></span><br><span class="line">æ¼”ç¤º <span class="built_in">`@BeforeEach`</span>ï¼Œ<span class="built_in">`@AfterEach`</span>ï¼Œ<span class="built_in">`@BeforeAll`</span>ï¼Œ<span class="built_in">`@AfterAll`</span> æ³¨è§£ï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure>public class UserServiceTest {<pre><code>@BeforeEachpublic void testBefore()&#123;    System.out.println(&quot;before...&quot;);&#125;@AfterEachpublic void testAfter()&#123;    System.out.println(&quot;after...&quot;);&#125;@BeforeAll //è¯¥æ–¹æ³•å¿…é¡»è¢«staticä¿®é¥°public static void testBeforeAll()&#123;     System.out.println(&quot;before all ...&quot;);&#125;@AfterAll //è¯¥æ–¹æ³•å¿…é¡»è¢«staticä¿®é¥°public static void testAfterAll()&#123;    System.out.println(&quot;after all...&quot;);&#125;@Testpublic void testGetAge()&#123;    Integer age = new UserService().getAge(&quot;110002200505091218&quot;);    System.out.println(age);&#125;@Testpublic void testGetGender()&#123;    String gender = new UserService().getGender(&quot;612429198904201611&quot;);    System.out.println(gender);&#125;</code></pre><p>}</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-237-1024x284.png</span>)</span><br><span class="line"></span><br><span class="line"><span class="strong">**åœ¨mavené¡¹ç›®ä¸­ï¼Œtestç›®å½•å­˜æ”¾å•å…ƒæµ‹è¯•çš„ä»£ç ï¼Œæ˜¯å¦å¯ä»¥åœ¨mainç›®å½•ä¸­ç¼–å†™å•å…ƒæµ‹è¯•å‘¢ ï¼Ÿ**</span> </span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-238.png</span>)</span><br><span class="line"></span><br><span class="line">å¯ä»¥ï¼Œä½†æ˜¯ä¸è§„èŒƒ</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">#### 4.2.4ä¾èµ–èŒƒå›´</span></span><br><span class="line"></span><br><span class="line">ä¾èµ–çš„jaråŒ…ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼Œåœ¨mainç›®å½•ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ï¼›åœ¨testç›®å½•ä¸‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚</span><br><span class="line"></span><br><span class="line">åœ¨mavenä¸­ï¼Œå¦‚æœå¸Œæœ›é™åˆ¶ä¾èµ–çš„ä½¿ç”¨èŒƒå›´ï¼Œå¯ä»¥é€šè¿‡ <span class="code">`&lt;scope&gt;â€¦&lt;/scope&gt;`</span> è®¾ç½®å…¶ä½œç”¨èŒƒå›´ã€‚</span><br><span class="line"></span><br><span class="line"><span class="strong">**ä½œç”¨èŒƒå›´ï¼š**</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> ä¸»ç¨‹åºèŒƒå›´æœ‰æ•ˆã€‚ï¼ˆmainæ–‡ä»¶å¤¹èŒƒå›´å†…ï¼‰</span><br><span class="line"><span class="bullet">-</span> æµ‹è¯•ç¨‹åºèŒƒå›´æœ‰æ•ˆã€‚ï¼ˆtestæ–‡ä»¶å¤¹èŒƒå›´å†…ï¼‰</span><br><span class="line"><span class="bullet">-</span> æ˜¯å¦å‚ä¸æ‰“åŒ…è¿è¡Œã€‚ï¼ˆpackageæŒ‡ä»¤èŒƒå›´å†…ï¼‰</span><br><span class="line"></span><br><span class="line">scopeçš„å–å€¼å¸¸è§çš„å¦‚ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line">| scopeå€¼         | ä¸»ç¨‹åº | æµ‹è¯•ç¨‹åº | æ‰“åŒ…ï¼ˆè¿è¡Œï¼‰ | èŒƒä¾‹        |</span><br><span class="line">| --------------- | ------ | -------- | ------------ | ----------- |</span><br><span class="line">| compileï¼ˆé»˜è®¤ï¼‰ | Y      | Y        | Y            | log4j       |</span><br><span class="line">| test            | -      | Y        | -            | junit       |</span><br><span class="line">| provided        | Y      | Y        | -            | servlet-api |</span><br><span class="line">| runtime         | -      | Y        | Y            | jdbcé©±åŠ¨    |</span><br><span class="line"></span><br><span class="line"><span class="section"># 2.Webåç«¯åŸºç¡€</span></span><br><span class="line"></span><br><span class="line"><span class="section">## 1åŸºç¡€çŸ¥è¯†</span></span><br><span class="line"></span><br><span class="line"><span class="section">### 1.1é™æ€èµ„æºå’ŒåŠ¨æ€èµ„æº</span></span><br><span class="line"></span><br><span class="line">åƒHTMLã€CSSã€JS ä»¥åŠå›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰è¿™äº›èµ„æºï¼Œæˆ‘ä»¬éƒ½ç§°ä¸º<span class="strong">**é™æ€èµ„æº**</span>ã€‚ æ‰€è°“é™æ€èµ„æºï¼Œå°±æ˜¯æŒ‡åœ¨æœåŠ¡å™¨ä¸Šå­˜å‚¨çš„ä¸ä¼šæ”¹å˜çš„æ•°æ®ï¼Œé€šå¸¸ä¸ä¼šæ ¹æ®ç”¨æˆ·çš„è¯·æ±‚è€Œå˜åŒ–ã€‚</span><br><span class="line"></span><br><span class="line">é‚£ä¸é™æ€èµ„æºå¯¹åº”çš„è¿˜æœ‰ä¸€ç±»èµ„æºï¼Œå°±æ˜¯åŠ¨æ€èµ„æºã€‚é‚£æ‰€è°“<span class="strong">**åŠ¨æ€èµ„æº**</span>ï¼Œå°±æ˜¯æŒ‡åœ¨æœåŠ¡å™¨ç«¯ä¸Šå­˜å‚¨çš„ï¼Œä¼šæ ¹æ®ç”¨æˆ·è¯·æ±‚å’Œå…¶ä»–æ•°æ®åŠ¨æ€ç”Ÿæˆçš„ï¼Œå†…å®¹å¯èƒ½ä¼šåœ¨æ¯æ¬¡è¯·æ±‚æ—¶éƒ½å‘ç”Ÿå˜åŒ–ã€‚æ¯”å¦‚ï¼šServletã€JSPç­‰(è´Ÿè´£é€»è¾‘å¤„ç†)ã€‚è€ŒServletã€JSPè¿™äº›æŠ€æœ¯ç°åœ¨æ—©éƒ½è¢«ä¼ä¸šæ·˜æ±°äº†ï¼Œç°åœ¨åœ¨ä¼ä¸šé¡¹ç›®å¼€å‘ä¸­ï¼Œéƒ½æ˜¯ç›´æ¥åŸºäºSpringæ¡†æ¶æ¥æ„å»ºåŠ¨æ€èµ„æºã€‚</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-250-1024x307.png</span>)</span><br><span class="line"></span><br><span class="line">è€Œå¯¹äºæˆ‘ä»¬javaç¨‹åºå¼€å‘çš„åŠ¨æ€èµ„æºæ¥è¯´ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå°†è¿™äº›åŠ¨æ€èµ„æºéƒ¨ç½²åœ¨<span class="strong">**Tomcat**</span>ï¼Œè¿™æ ·çš„WebæœåŠ¡å™¨ä¸­è¿è¡Œã€‚ è€Œæµè§ˆå™¨ä¸æœåŠ¡å™¨åœ¨é€šä¿¡çš„æ—¶å€™ï¼ŒåŸºæœ¬éƒ½æ˜¯åŸºäºHTTPåè®®çš„ã€‚</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-251-1024x302.png</span>)</span><br><span class="line"></span><br><span class="line">é‚£ä¸Šè¿°æ‰€æè¿°çš„è¿™ç§æµè§ˆå™¨/æœåŠ¡å™¨çš„æ¶æ„æ¨¡å¼å‘¢ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºï¼š<span class="strong">**BSæ¶æ„**</span>ã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> BSæ¶æ„ï¼šBrowser/Serverï¼Œæµè§ˆå™¨/æœåŠ¡å™¨æ¶æ„æ¨¡å¼ã€‚å®¢æˆ·ç«¯åªéœ€è¦æµè§ˆå™¨ï¼Œåº”ç”¨ç¨‹åºçš„é€»è¾‘å’Œæ•°æ®éƒ½å­˜å‚¨åœ¨æœåŠ¡ç«¯ã€‚</span><br><span class="line"><span class="bullet">  -</span> ä¼˜ç‚¹ï¼šç»´æŠ¤æ–¹ä¾¿</span><br><span class="line"><span class="bullet">  -</span> ç¼ºç‚¹ï¼šä½“éªŒä¸€èˆ¬</span><br><span class="line"><span class="bullet">-</span> CSæ¶æ„ï¼šClient/Serverï¼Œå®¢æˆ·ç«¯/æœåŠ¡å™¨æ¶æ„æ¨¡å¼ã€‚éœ€è¦å•ç‹¬å¼€å‘ç»´æŠ¤å®¢æˆ·ç«¯ã€‚</span><br><span class="line"><span class="bullet">  -</span> ä¼˜ç‚¹ï¼šä½“éªŒä¸é”™</span><br><span class="line"><span class="bullet">  -</span> ç¼ºç‚¹ï¼šå¼€å‘ç»´æŠ¤éº»çƒ¦</span><br><span class="line"></span><br><span class="line"><span class="section">### 1.2 Springæ¡†æ¶</span></span><br><span class="line"></span><br><span class="line"><span class="section">#### 1.2.1 ä»€ä¹ˆæ˜¯Spring</span></span><br><span class="line"></span><br><span class="line">æˆ‘ä»¬å¯ä»¥æ‰“å¼€Springçš„å®˜ç½‘(https://spring.io)ï¼Œå»çœ‹ä¸€ä¸‹Springçš„ç®€ä»‹ï¼šSpring makes Java simpleã€‚</span><br><span class="line"></span><br><span class="line">Springçš„å®˜æ–¹æä¾›å¾ˆå¤šå¼€æºçš„é¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥ç‚¹å‡»ä¸Šé¢çš„projectsï¼Œçœ‹åˆ°springå®¶æ—æ——ä¸‹çš„é¡¹ç›®ï¼ŒæŒ‰ç…§æµè¡Œç¨‹åº¦æ’åºä¸ºï¼š</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-239-1024x605.png</span>)</span><br><span class="line"></span><br><span class="line">è€ŒSpringå®¶æ—æ——ä¸‹è¿™ä¹ˆå¤šçš„æŠ€æœ¯ï¼Œæœ€åŸºç¡€ã€æœ€æ ¸å¿ƒçš„æ˜¯ SpringFrameworkã€‚å…¶ä»–çš„springå®¶æ—çš„æŠ€æœ¯ï¼Œéƒ½æ˜¯åŸºäºSpringFrameworkçš„ï¼ŒSpringFrameworkä¸­æä¾›å¾ˆå¤šå®ç”¨åŠŸèƒ½ï¼Œå¦‚ï¼šä¾èµ–æ³¨å…¥ã€äº‹åŠ¡ç®¡ç†ã€webå¼€å‘æ”¯æŒã€æ•°æ®è®¿é—®ã€æ¶ˆæ¯æœåŠ¡ç­‰ç­‰ã€‚</span><br><span class="line"></span><br><span class="line">è€Œå¦‚æœæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ï¼Œç›´æ¥åŸºäº<span class="strong">**SpringFramework**</span>è¿›è¡Œå¼€å‘ï¼Œå­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> é…ç½®ç¹ç</span><br><span class="line"><span class="bullet">-</span> å…¥é—¨éš¾åº¦å¤§</span><br><span class="line"></span><br><span class="line">æ‰€ä»¥åŸºäºæ­¤ï¼Œspringå®˜æ–¹æ¨èæˆ‘ä»¬ä»å¦å¤–ä¸€ä¸ªé¡¹ç›®å¼€å§‹å­¦ä¹ ï¼Œé‚£å°±æ˜¯SpringBootã€‚ é€šè¿‡springbootå°±å¯ä»¥å¿«é€Ÿçš„å¸®æˆ‘ä»¬æ„å»ºåº”ç”¨ç¨‹åºï¼Œæ‰€ä»¥<span class="strong">**springboot**</span>å‘¢ï¼Œæœ€å¤§çš„ç‰¹ç‚¹æœ‰ä¸¤ä¸ª ï¼š</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> ç®€åŒ–é…ç½®</span><br><span class="line"><span class="bullet">-</span> å¿«é€Ÿå¼€å‘</span><br><span class="line"></span><br><span class="line"><span class="strong">**Spring Boot å¯ä»¥å¸®åŠ©æˆ‘ä»¬éå¸¸å¿«é€Ÿçš„æ„å»ºåº”ç”¨ç¨‹åºã€ç®€åŒ–å¼€å‘ã€æé«˜æ•ˆç‡ ã€‚**</span></span><br><span class="line"></span><br><span class="line">1.2.2 å¸¸è§é—®é¢˜</span><br><span class="line"></span><br><span class="line">è”ç½‘åŸºäºspringçš„è„šæ‰‹æ¶åˆ›å»ºSpringBooté¡¹ç›®ï¼Œå¶å°”å¯èƒ½ä¼šå› ä¸ºç½‘å†…ç½‘ç»œçš„åŸå› ï¼Œé“¾æ¥ä¸ä¸ŠSpringBootçš„è„šæ‰‹æ¶ç½‘ç«™ï¼Œæ­¤æ—¶ä¼šå‡ºç°å¦‚ä¸‹ç°è±¡ï¼š</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-240.png</span>)</span><br><span class="line"></span><br><span class="line">æ­¤æ—¶å¯ä»¥ä½¿ç”¨é˜¿é‡Œäº‘æä¾›çš„è„šæ‰‹æ¶ï¼Œç½‘å€ä¸ºï¼šhttps://start.aliyun.com</span><br><span class="line"></span><br><span class="line"><span class="section">#### 1.2.3 SpringBootWebå…¥é—¨è§£æ</span></span><br><span class="line"></span><br><span class="line"><span class="strong">**1). ä¸ºä»€ä¹ˆä¸€ä¸ªmainæ–¹æ³•å°±å¯ä»¥å°†Webåº”ç”¨å¯åŠ¨äº†ï¼Ÿ**</span></span><br><span class="line"></span><br><span class="line">ç­”ï¼šå› ä¸ºæˆ‘ä»¬åœ¨åˆ›å»ºspringbooté¡¹ç›®çš„æ—¶å€™ï¼Œé€‰æ‹©äº†webå¼€å‘çš„<span class="strong">**èµ·æ­¥ä¾èµ–**</span> <span class="code">`spring-boot-starter-web`</span>ã€‚<span class="strong">**è€Œ`spring-boot-starter-web`ä¾èµ–ï¼Œåˆä¾èµ–äº†`spring-boot-starter-tomcat`**</span>ï¼Œç”±äºmavençš„ä¾èµ–ä¼ é€’ç‰¹æ€§ï¼Œé‚£ä¹ˆåœ¨æˆ‘ä»¬åˆ›å»ºçš„springbooté¡¹ç›®ä¸­ä¹Ÿå°±å·²ç»æœ‰äº†tomcatçš„ä¾èµ–ï¼Œè¿™ä¸ªå…¶å®å°±æ˜¯springbootä¸­å†…åµŒçš„tomcatã€‚</span><br><span class="line"></span><br><span class="line">è€Œæˆ‘ä»¬è¿è¡Œå¼•å¯¼ç±»ä¸­çš„mainæ–¹æ³•ï¼Œå…¶å®å¯åŠ¨çš„å°±æ˜¯springbootä¸­å†…åµŒçš„TomcatæœåŠ¡å™¨ã€‚ è€Œæˆ‘ä»¬æ‰€å¼€å‘çš„é¡¹ç›®ï¼Œä¹Ÿä¼šè‡ªåŠ¨çš„éƒ¨ç½²åœ¨è¯¥tomcatæœåŠ¡å™¨ä¸­ï¼Œå¹¶å ç”¨8080ç«¯å£å· ã€‚</span><br><span class="line"></span><br><span class="line">å…³äºèµ·æ­¥ä¾èµ–ï¼š</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-241.png</span>)</span><br><span class="line"></span><br><span class="line"><span class="section">### 1.3HTTPåè®®</span></span><br><span class="line"></span><br><span class="line"><span class="section">#### 1.3.1ä»‹ç»</span></span><br><span class="line"></span><br><span class="line"><span class="strong">**HTTP**</span>ï¼šHyper Text Transfer Protocol(è¶…æ–‡æœ¬ä¼ è¾“åè®®)ï¼Œè§„å®šäº†æµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´æ•°æ®ä¼ è¾“çš„è§„åˆ™ã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> httpæ˜¯äº’è”ç½‘ä¸Šåº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç§ç½‘ç»œåè®®</span><br><span class="line"><span class="bullet">-</span> httpåè®®è¦æ±‚ï¼šæµè§ˆå™¨åœ¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ•°æ®æ—¶ï¼Œæˆ–æ˜¯æœåŠ¡å™¨åœ¨å‘æµè§ˆå™¨å‘é€å“åº”æ•°æ®æ—¶ï¼Œ<span class="strong">**éƒ½å¿…é¡»æŒ‰ç…§å›ºå®šçš„æ ¼å¼è¿›è¡Œæ•°æ®ä¼ è¾“**</span></span><br><span class="line"></span><br><span class="line"><span class="section">#### 1.3.2HTTPåè®®çš„ç‰¹ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**åŸºäºTCPåè®®:**</span> é¢å‘è¿æ¥ï¼Œå®‰å…¨</span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; TCPæ˜¯ä¸€ç§é¢å‘è¿æ¥çš„(å»ºç«‹è¿æ¥ä¹‹å‰æ˜¯éœ€è¦ç»è¿‡ä¸‰æ¬¡æ¡æ‰‹)ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„ä¼ è¾“å±‚é€šä¿¡åè®®ï¼Œåœ¨æ•°æ®ä¼ è¾“æ–¹é¢æ›´å®‰å…¨</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**åŸºäºè¯·æ±‚-å“åº”æ¨¡å‹:**</span> ä¸€æ¬¡è¯·æ±‚å¯¹åº”ä¸€æ¬¡å“åº”ï¼ˆå…ˆè¯·æ±‚åå“åº”ï¼‰</span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; è¯·æ±‚å’Œå“åº”æ˜¯ä¸€ä¸€å¯¹åº”å…³ç³»ï¼Œæ²¡æœ‰è¯·æ±‚ï¼Œå°±æ²¡æœ‰å“åº”</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**HTTPåè®®æ˜¯æ— çŠ¶æ€åè®®:**</span> å¯¹äºæ•°æ®æ²¡æœ‰è®°å¿†èƒ½åŠ›ã€‚æ¯æ¬¡è¯·æ±‚-å“åº”éƒ½æ˜¯ç‹¬ç«‹çš„</span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; æ— çŠ¶æ€æŒ‡çš„æ˜¯å®¢æˆ·ç«¯å‘é€HTTPè¯·æ±‚ç»™æœåŠ¡ç«¯ä¹‹åï¼ŒæœåŠ¡ç«¯æ ¹æ®è¯·æ±‚å“åº”æ•°æ®ï¼Œå“åº”å®Œåï¼Œä¸ä¼šè®°å½•ä»»ä½•ä¿¡æ¯ã€‚</span></span><br><span class="line"><span class="quote">&gt;</span></span><br><span class="line"><span class="quote">&gt; - ç¼ºç‚¹: å¤šæ¬¡è¯·æ±‚é—´ä¸èƒ½å…±äº«æ•°æ®</span></span><br><span class="line"><span class="quote">&gt; - ä¼˜ç‚¹: é€Ÿåº¦å¿«</span></span><br><span class="line"><span class="quote">&gt;</span></span><br><span class="line"><span class="quote">&gt; - è¯·æ±‚ä¹‹é—´æ— æ³•å…±äº«æ•°æ®ä¼šå¼•å‘çš„é—®é¢˜ï¼š</span></span><br><span class="line"><span class="quote">&gt;   - å¦‚ï¼šäº¬ä¸œè´­ç‰©ã€‚åŠ å…¥è´­ç‰©è½¦å’Œå»è´­ç‰©è½¦ç»“ç®—æ˜¯ä¸¤æ¬¡è¯·æ±‚</span></span><br><span class="line"><span class="quote">&gt;   - ç”±äºHTTPåè®®çš„æ— çŠ¶æ€ç‰¹æ€§ï¼ŒåŠ å…¥è´­ç‰©è½¦è¯·æ±‚å“åº”ç»“æŸåï¼Œå¹¶æœªè®°å½•åŠ å…¥è´­ç‰©è½¦æ˜¯ä½•å•†å“</span></span><br><span class="line"><span class="quote">&gt;   - å‘èµ·å»è´­ç‰©è½¦ç»“ç®—çš„è¯·æ±‚åï¼Œå› ä¸ºæ— æ³•è·å–å“ªäº›å•†å“åŠ å…¥äº†è´­ç‰©è½¦ï¼Œä¼šå¯¼è‡´æ­¤æ¬¡è¯·æ±‚æ— æ³•æ­£ç¡®å±•ç¤ºæ•°æ®</span></span><br><span class="line"><span class="quote">&gt;</span></span><br><span class="line"><span class="quote">&gt; - å…·ä½“ä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å‘ç°äº¬ä¸œæ˜¯å¯ä»¥æ­£å¸¸å±•ç¤ºæ•°æ®çš„ï¼ŒåŸå› æ˜¯Javaæ—©å·²è€ƒè™‘åˆ°è¿™ä¸ªé—®é¢˜ï¼Œå¹¶æå‡ºäº†ä½¿ç”¨ä¼šè¯æŠ€æœ¯(Cookieã€Session)æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å…·ä½“å¦‚ä½•æ¥åšï¼Œåé¢ä¼šè®²åˆ°ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="strong">**HTTPåè®®åˆåˆ†ä¸ºï¼šè¯·æ±‚åè®®å’Œå“åº”åè®®**</span></span><br><span class="line"></span><br><span class="line"><span class="section">### 1.4HTTPè¯·æ±‚åè®®</span></span><br><span class="line"></span><br><span class="line"><span class="section">#### 1.4.1ä»‹ç»</span></span><br><span class="line"></span><br><span class="line"><span class="strong">**è¯·æ±‚åè®®ï¼š**</span>æµè§ˆå™¨å°†æ•°æ®ä»¥è¯·æ±‚æ ¼å¼å‘é€åˆ°æœåŠ¡å™¨ã€‚åŒ…æ‹¬ï¼š<span class="strong">**è¯·æ±‚è¡Œã€è¯·æ±‚å¤´ ã€è¯·æ±‚ä½“**</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**GETæ–¹å¼çš„è¯·æ±‚åè®®ï¼š**</span></span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-249-1024x174.png</span>)</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> è¯·æ±‚è¡Œ</span><br><span class="line"></span><br><span class="line">  (ä»¥ä¸Šå›¾ä¸­çº¢è‰²éƒ¨åˆ†) ï¼šHTTPè¯·æ±‚ä¸­çš„ç¬¬ä¸€è¡Œæ•°æ®ã€‚ç”±ï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¯·æ±‚æ–¹å¼</p>  <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ã€</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>èµ„æºè·¯å¾„</p>  <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ã€</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åè®®/ç‰ˆæœ¬</p>  <figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  ç»„æˆï¼ˆä¹‹é—´ä½¿ç”¨ç©ºæ ¼åˆ†éš”ï¼‰</span><br><span class="line"></span><br><span class="line">  - è¯·æ±‚æ–¹å¼ï¼šGET</span><br><span class="line">  - èµ„æºè·¯å¾„ï¼š/brand/findAll?name=OPPO&amp;status=1</span><br><span class="line">    - è¯·æ±‚è·¯å¾„ï¼š/brand/findAll</span><br><span class="line">    - è¯·æ±‚å‚æ•°ï¼šname=OPPO&amp;status=1</span><br><span class="line">      - è¯·æ±‚å‚æ•°æ˜¯ä»¥key=valueå½¢å¼å‡ºç°</span><br><span class="line">      - å¤šä¸ªè¯·æ±‚å‚æ•°ä¹‹é—´ä½¿ç”¨`&amp;`è¿æ¥</span><br><span class="line">    - è¯·æ±‚è·¯å¾„å’Œè¯·æ±‚å‚æ•°ä¹‹é—´ä½¿ç”¨`?`è¿æ¥</span><br><span class="line">  - åè®®/ç‰ˆæœ¬ï¼šHTTP/1.1</span><br><span class="line"></span><br><span class="line">- è¯·æ±‚å¤´</span><br><span class="line"></span><br><span class="line">  (ä»¥ä¸Šå›¾ä¸­é»„è‰²éƒ¨åˆ†) ï¼šç¬¬äºŒè¡Œå¼€å§‹ï¼Œä¸Šå›¾é»„è‰²éƒ¨åˆ†å†…å®¹å°±æ˜¯è¯·æ±‚å¤´ã€‚æ ¼å¼ä¸ºkey: valueå½¢å¼</span><br><span class="line"></span><br><span class="line">  - httpæ˜¯ä¸ªæ— çŠ¶æ€çš„åè®®ï¼Œæ‰€ä»¥åœ¨è¯·æ±‚å¤´è®¾ç½®æµè§ˆå™¨çš„ä¸€äº›è‡ªèº«ä¿¡æ¯å’Œæƒ³è¦å“åº”çš„å½¢å¼ã€‚è¿™æ ·æœåŠ¡å™¨åœ¨æ”¶åˆ°ä¿¡æ¯åï¼Œå°±å¯ä»¥çŸ¥é“æ˜¯è°ï¼Œæƒ³å¹²ä»€ä¹ˆäº†</span><br><span class="line">  - å¸¸è§çš„HTTPè¯·æ±‚å¤´æœ‰:</span><br><span class="line"></span><br><span class="line">|<span class="string"> è¯·æ±‚å¤´          </span>|<span class="string"> å«ä¹‰                                                         </span>|</span><br><span class="line">|<span class="string"> --------------- </span>|<span class="string"> ------------------------------------------------------------ </span>|</span><br><span class="line">|<span class="string"> Host            </span>|<span class="string"> è¡¨ç¤ºè¯·æ±‚çš„ä¸»æœºå                                             </span>|</span><br><span class="line">|<span class="string"> User-Agent      </span>|<span class="string"> æµè§ˆå™¨ç‰ˆæœ¬ã€‚ ä¾‹å¦‚ï¼šChromeæµè§ˆå™¨çš„æ ‡è¯†ç±»ä¼¼Mozilla/5.0 ...Chrome/79 ï¼ŒIEæµè§ˆå™¨çš„æ ‡è¯†ç±»ä¼¼Mozilla/5.0 (Windows NT ...)like Gecko </span>|</span><br><span class="line">|<span class="string"> Accept          </span>|<span class="string"> è¡¨ç¤ºæµè§ˆå™¨èƒ½æ¥æ”¶çš„èµ„æºç±»å‹ï¼Œå¦‚text/*ï¼Œimage/*æˆ–è€…*/*è¡¨ç¤ºæ‰€æœ‰ï¼› </span>|</span><br><span class="line">|<span class="string"> Accept-Language </span>|<span class="string"> è¡¨ç¤ºæµè§ˆå™¨åå¥½çš„è¯­è¨€ï¼ŒæœåŠ¡å™¨å¯ä»¥æ®æ­¤è¿”å›ä¸åŒè¯­è¨€çš„ç½‘é¡µï¼›     </span>|</span><br><span class="line">|<span class="string"> Accept-Encoding </span>|<span class="string"> è¡¨ç¤ºæµè§ˆå™¨å¯ä»¥æ”¯æŒçš„å‹ç¼©ç±»å‹ï¼Œä¾‹å¦‚gzip, deflateç­‰ã€‚          </span>|</span><br><span class="line">|<span class="string"> Content-Type    </span>|<span class="string"> è¯·æ±‚ä¸»ä½“çš„æ•°æ®ç±»å‹                                           </span>|</span><br><span class="line">|<span class="string"> Content-Length  </span>|<span class="string"> æ•°æ®ä¸»ä½“çš„å¤§å°ï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰                                 </span>|</span><br><span class="line"></span><br><span class="line">æœåŠ¡ç«¯å¯ä»¥æ ¹æ®è¯·æ±‚å¤´ä¸­çš„å†…å®¹æ¥è·å–å®¢æˆ·ç«¯çš„ç›¸å…³ä¿¡æ¯ï¼Œæœ‰äº†è¿™äº›ä¿¡æ¯æœåŠ¡ç«¯å°±å¯ä»¥å¤„ç†ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚ã€‚</span><br><span class="line"></span><br><span class="line">- è¯·æ±‚ä½“ ï¼šå­˜å‚¨è¯·æ±‚å‚æ•°</span><br><span class="line">  - GETè¯·æ±‚çš„è¯·æ±‚å‚æ•°åœ¨è¯·æ±‚è¡Œä¸­ï¼Œæ•…ä¸éœ€è¦è®¾ç½®è¯·æ±‚ä½“</span><br><span class="line"></span><br><span class="line">- <span class="symbol">*</span><span class="symbol">*</span>POSTæ–¹å¼çš„è¯·æ±‚åè®®ï¼š<span class="symbol">*</span><span class="symbol">*</span></span><br><span class="line"></span><br><span class="line">![img](https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-242-1024x247.png)</span><br><span class="line"></span><br><span class="line">- è¯·æ±‚è¡Œ</span><br><span class="line"></span><br><span class="line">  (ä»¥ä¸Šå›¾ä¸­çº¢è‰²éƒ¨åˆ†)ï¼šåŒ…å«è¯·æ±‚æ–¹å¼ã€èµ„æºè·¯å¾„ã€åè®®/ç‰ˆæœ¬</span><br><span class="line"></span><br><span class="line">  - è¯·æ±‚æ–¹å¼ï¼šPOST</span><br><span class="line">  - èµ„æºè·¯å¾„ï¼š/brand</span><br><span class="line">  - åè®®/ç‰ˆæœ¬ï¼šHTTP/1.1</span><br><span class="line"></span><br><span class="line">- <span class="symbol">*</span><span class="symbol">*</span>è¯·æ±‚å¤´<span class="symbol">*</span><span class="symbol">*</span>(ä»¥ä¸Šå›¾ä¸­é»„è‰²éƒ¨åˆ†)</span><br><span class="line"></span><br><span class="line">- è¯·æ±‚ä½“</span><br><span class="line"></span><br><span class="line">  (ä»¥ä¸Šå›¾ä¸­ç»¿è‰²éƒ¨åˆ†) ï¼šå­˜å‚¨è¯·æ±‚å‚æ•°</span><br><span class="line"></span><br><span class="line">  - è¯·æ±‚ä½“å’Œè¯·æ±‚å¤´ä¹‹é—´æ˜¯æœ‰ä¸€ä¸ªç©ºè¡Œéš”å¼€ï¼ˆä½œç”¨ï¼šç”¨äºæ ‡è®°è¯·æ±‚å¤´ç»“æŸï¼‰</span><br><span class="line"></span><br><span class="line">GETè¯·æ±‚å’ŒPOSTè¯·æ±‚çš„åŒºåˆ«ï¼š</span><br><span class="line"></span><br><span class="line">|<span class="string"> **åŒºåˆ«æ–¹å¼** </span>|<span class="string"> **GETè¯·æ±‚**                                                  </span>|<span class="string"> **POSTè¯·æ±‚**         </span>|</span><br><span class="line">|<span class="string"> ------------ </span>|<span class="string"> ------------------------------------------------------------ </span>|<span class="string"> -------------------- </span>|</span><br><span class="line">|<span class="string"> è¯·æ±‚å‚æ•°     </span>|<span class="string"> è¯·æ±‚å‚æ•°åœ¨è¯·æ±‚è¡Œä¸­ã€‚&lt;br/&gt;ä¾‹ï¼š/brand/findAll?name=OPPO&amp;status=1 </span>|<span class="string"> è¯·æ±‚å‚æ•°åœ¨è¯·æ±‚ä½“ä¸­   </span>|</span><br><span class="line">|<span class="string"> è¯·æ±‚å‚æ•°é•¿åº¦ </span>|<span class="string"> è¯·æ±‚å‚æ•°é•¿åº¦æœ‰é™åˆ¶(æµè§ˆå™¨ä¸åŒé™åˆ¶ä¹Ÿä¸åŒ)                     </span>|<span class="string"> è¯·æ±‚å‚æ•°é•¿åº¦æ²¡æœ‰é™åˆ¶ </span>|</span><br><span class="line">|<span class="string"> å®‰å…¨æ€§       </span>|<span class="string"> å®‰å…¨æ€§ä½ã€‚åŸå› ï¼šè¯·æ±‚å‚æ•°æš´éœ²åœ¨æµè§ˆå™¨åœ°å€æ ä¸­ã€‚               </span>|<span class="string"> å®‰å…¨æ€§ç›¸å¯¹é«˜         </span>|</span><br><span class="line"></span><br><span class="line"><span class="comment">#### 1.4.2è·å–è¯·æ±‚æ•°æ®</span></span><br><span class="line"></span><br><span class="line">WebæœåŠ¡å™¨ï¼ˆTomcatï¼‰å¯¹HTTPåè®®çš„è¯·æ±‚æ•°æ®è¿›è¡Œè§£æï¼Œå¹¶è¿›è¡Œäº†å°è£…(HttpServletRequest)ï¼Œå¹¶åœ¨è°ƒç”¨Controlleræ–¹æ³•çš„æ—¶å€™ä¼ é€’ç»™äº†è¯¥æ–¹æ³•ã€‚è¿™æ ·ï¼Œå°±ä½¿å¾—ç¨‹åºå‘˜ä¸å¿…ç›´æ¥å¯¹åè®®è¿›è¡Œæ“ä½œï¼Œè®©Webå¼€å‘æ›´åŠ ä¾¿æ·ã€‚</span><br><span class="line"></span><br><span class="line">![img](https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-243-1024x310.png)</span><br><span class="line"></span><br><span class="line"><span class="comment">### 1.5HTTPå“åº”åè®®</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#### 1.5.1æ ¼å¼ä»‹ç»</span></span><br><span class="line"></span><br><span class="line">- å“åº”åè®®ï¼šæœåŠ¡å™¨å°†æ•°æ®ä»¥å“åº”æ ¼å¼è¿”å›ç»™æµè§ˆå™¨ã€‚åŒ…æ‹¬ï¼š<span class="symbol">*</span><span class="symbol">*</span>å“åº”è¡Œ ã€å“åº”å¤´ ã€å“åº”ä½“<span class="symbol">*</span><span class="symbol">*</span></span><br><span class="line"></span><br><span class="line">![img](https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-252-1024x188.png)</span><br><span class="line"></span><br><span class="line">- å“åº”è¡Œ(ä»¥ä¸Šå›¾ä¸­çº¢è‰²éƒ¨åˆ†)ï¼šå“åº”æ•°æ®çš„ç¬¬ä¸€è¡Œã€‚å“åº”è¡Œç”±</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åè®®åŠç‰ˆæœ¬</p>  <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ã€</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å“åº”çŠ¶æ€ç </p>  <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ã€</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>çŠ¶æ€ç æè¿°</p>  <figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  ç»„æˆ</span><br><span class="line"></span><br><span class="line"><span class="bullet">  -</span> åè®®/ç‰ˆæœ¬ï¼šHTTP/1.1</span><br><span class="line"><span class="bullet">  -</span> å“åº”çŠ¶æ€ç ï¼š200</span><br><span class="line"><span class="bullet">  -</span> çŠ¶æ€ç æè¿°ï¼šOK</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> å“åº”å¤´(ä»¥ä¸Šå›¾ä¸­é»„è‰²éƒ¨åˆ†)ï¼šå“åº”æ•°æ®çš„ç¬¬äºŒè¡Œå¼€å§‹ã€‚æ ¼å¼ä¸ºkeyï¼švalueå½¢å¼</span><br><span class="line"></span><br><span class="line"><span class="bullet">  -</span> httpæ˜¯ä¸ªæ— çŠ¶æ€çš„åè®®ï¼Œæ‰€ä»¥å¯ä»¥åœ¨è¯·æ±‚å¤´å’Œå“åº”å¤´ä¸­è®¾ç½®ä¸€äº›ä¿¡æ¯å’Œæƒ³è¦æ‰§è¡Œçš„åŠ¨ä½œï¼Œè¿™æ ·ï¼Œå¯¹æ–¹åœ¨æ”¶åˆ°ä¿¡æ¯åï¼Œå°±å¯ä»¥çŸ¥é“ä½ æ˜¯è°ï¼Œä½ æƒ³å¹²ä»€ä¹ˆ</span><br><span class="line"><span class="bullet">  -</span> å¸¸è§çš„HTTPå“åº”å¤´æœ‰:</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> å¸¸è§çš„HTTPå“åº”å¤´æœ‰:</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Content-Typeï¼šè¡¨ç¤ºè¯¥å“åº”å†…å®¹çš„ç±»å‹ï¼Œä¾‹å¦‚text/htmlï¼Œimage/jpeg ï¼›</p><p>Content-Lengthï¼šè¡¨ç¤ºè¯¥å“åº”å†…å®¹çš„é•¿åº¦ï¼ˆå­—èŠ‚æ•°ï¼‰ï¼›</p><p>Content-Encodingï¼šè¡¨ç¤ºè¯¥å“åº”å‹ç¼©ç®—æ³•ï¼Œä¾‹å¦‚gzip ï¼›</p><p>Cache-Controlï¼šæŒ‡ç¤ºå®¢æˆ·ç«¯åº”å¦‚ä½•ç¼“å­˜ï¼Œä¾‹å¦‚max-age=300è¡¨ç¤ºå¯ä»¥æœ€å¤šç¼“å­˜300ç§’ ;</p><p>Set-Cookie: å‘Šè¯‰æµè§ˆå™¨ä¸ºå½“å‰é¡µé¢æ‰€åœ¨çš„åŸŸè®¾ç½®cookie ;</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- å“åº”ä½“(ä»¥ä¸Šå›¾ä¸­ç»¿è‰²éƒ¨åˆ†)ï¼š å“åº”æ•°æ®çš„æœ€åä¸€éƒ¨åˆ†ã€‚å­˜å‚¨å“åº”çš„æ•°æ®</span><br><span class="line">  - å“åº”ä½“å’Œå“åº”å¤´ä¹‹é—´æœ‰ä¸€ä¸ªç©ºè¡Œéš”å¼€ï¼ˆä½œç”¨ï¼šç”¨äºæ ‡è®°å“åº”å¤´ç»“æŸï¼‰</span><br><span class="line"></span><br><span class="line"><span class="comment">#### 1.5.2å“åº”çŠ¶æ€ç </span></span><br><span class="line"></span><br><span class="line">|<span class="string"> çŠ¶æ€ç åˆ†ç±» </span>|<span class="string"> è¯´æ˜                                                         </span>|</span><br><span class="line">|<span class="string"> ---------- </span>|<span class="string"> ------------------------------------------------------------ </span>|</span><br><span class="line">|<span class="string"> 1xx        </span>|<span class="string"> å“åº”ä¸­ --- ä¸´æ—¶çŠ¶æ€ç ã€‚è¡¨ç¤ºè¯·æ±‚å·²ç»æ¥å—ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯åº”è¯¥ç»§ç»­è¯·æ±‚æˆ–è€…å¦‚æœå·²ç»å®Œæˆåˆ™å¿½ç•¥ </span>|</span><br><span class="line">|<span class="string"> 2xx        </span>|<span class="string"> æˆåŠŸ --- è¡¨ç¤ºè¯·æ±‚å·²ç»è¢«æˆåŠŸæ¥æ”¶ï¼Œå¤„ç†å·²å®Œæˆ                  </span>|</span><br><span class="line">|<span class="string"> 3xx        </span>|<span class="string"> é‡å®šå‘ --- é‡å®šå‘åˆ°å…¶å®ƒåœ°æ–¹ï¼Œè®©å®¢æˆ·ç«¯å†å‘èµ·ä¸€ä¸ªè¯·æ±‚ä»¥å®Œæˆæ•´ä¸ªå¤„ç† </span>|</span><br><span class="line">|<span class="string"> 4xx        </span>|<span class="string"> å®¢æˆ·ç«¯é”™è¯¯ --- å¤„ç†å‘ç”Ÿé”™è¯¯ï¼Œè´£ä»»åœ¨å®¢æˆ·ç«¯ï¼Œå¦‚ï¼šå®¢æˆ·ç«¯çš„è¯·æ±‚ä¸€ä¸ªä¸å­˜åœ¨çš„èµ„æºï¼Œå®¢æˆ·ç«¯æœªè¢«æˆæƒï¼Œç¦æ­¢è®¿é—®ç­‰ </span>|</span><br><span class="line">|<span class="string"> 5xx        </span>|<span class="string"> æœåŠ¡å™¨ç«¯é”™è¯¯ --- å¤„ç†å‘ç”Ÿé”™è¯¯ï¼Œè´£ä»»åœ¨æœåŠ¡ç«¯ï¼Œå¦‚ï¼šæœåŠ¡ç«¯æŠ›å‡ºå¼‚å¸¸ï¼Œè·¯ç”±å‡ºé”™ï¼ŒHTTPç‰ˆæœ¬ä¸æ”¯æŒç­‰ </span>|</span><br><span class="line"></span><br><span class="line">- `200 ok` å®¢æˆ·ç«¯è¯·æ±‚æˆåŠŸ</span><br><span class="line">- 401 Unauthorized ç”¨æˆ·æ— æƒé™è®¿é—®é¡µé¢</span><br><span class="line">- `404 Not Found` è¯·æ±‚èµ„æºä¸å­˜åœ¨</span><br><span class="line">- `500 Internal Server Error` æœåŠ¡ç«¯å‘ç”Ÿä¸å¯é¢„æœŸçš„é”™è¯¯</span><br><span class="line"></span><br><span class="line"><span class="comment">#### 1.5.3è®¾ç½®å“åº”æ•°æ®</span></span><br><span class="line"></span><br><span class="line">WebæœåŠ¡å™¨å¯¹HTTPåè®®çš„å“åº”æ•°æ®è¿›è¡Œäº†å°è£…(HttpServletResponse)ï¼Œå¹¶åœ¨è°ƒç”¨Controlleræ–¹æ³•çš„æ—¶å€™ä¼ é€’ç»™äº†è¯¥æ–¹æ³•ã€‚è¿™æ ·ï¼Œå°±ä½¿å¾—ç¨‹åºå‘˜ä¸å¿…ç›´æ¥å¯¹åè®®è¿›è¡Œæ“ä½œï¼Œè®©Webå¼€å‘æ›´åŠ ä¾¿æ·ã€‚</span><br><span class="line"></span><br><span class="line">![img](https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-244-1024x306.png)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>package com.itheima;</p><p>import jakarta.servlet.http.HttpServletResponse;<br>import org.springframework.http.ResponseEntity;<br>import org.springframework.web.bind.annotation.RequestMapping;<br>import org.springframework.web.bind.annotation.RestController;</p><p>import java.io.IOException;</p><p>@RestController<br>public class ResponseController {</p><pre><code>@RequestMapping(&quot;/response&quot;)public void response(HttpServletResponse response) throws IOException &#123;    //1.è®¾ç½®å“åº”çŠ¶æ€ç     response.setStatus(401);    //2.è®¾ç½®å“åº”å¤´    response.setHeader(&quot;name&quot;,&quot;itcast&quot;);    //3.è®¾ç½®å“åº”ä½“    response.setContentType(&quot;text/html;charset=utf-8&quot;);    response.setCharacterEncoding(&quot;utf-8&quot;);    response.getWriter().write(&quot;&lt;h1&gt;hello response&lt;/h1&gt;&quot;);&#125;@RequestMapping(&quot;/response2&quot;)public ResponseEntity&lt;String&gt; response2(HttpServletResponse response) throws IOException &#123;    return ResponseEntity            .status(401)            .header(&quot;name&quot;,&quot;itcast&quot;)            .body(&quot;&lt;h1&gt;hello response&lt;/h1&gt;&quot;);&#125;</code></pre><p>}</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">å“åº”çŠ¶æ€ç  å’Œ å“åº”å¤´å¦‚æœæ²¡æœ‰ç‰¹æ®Šè¦æ±‚çš„è¯ï¼Œé€šå¸¸ä¸æ‰‹åŠ¨è®¾å®šã€‚æœåŠ¡å™¨ä¼šæ ¹æ®è¯·æ±‚å¤„ç†çš„é€»è¾‘ï¼Œè‡ªåŠ¨è®¾ç½®å“åº”çŠ¶æ€ç å’Œå“åº”å¤´ã€‚</span><br><span class="line"></span><br><span class="line">## <span class="number">2.</span>SpringBootWebæ¡ˆä¾‹</span><br><span class="line"></span><br><span class="line">### <span class="number">2.1</span>éœ€æ±‚è¯´æ˜</span><br><span class="line"></span><br><span class="line">éœ€æ±‚ï¼šåŸºäºSpringBootå¼€å‘webç¨‹åºï¼Œå®Œæˆç”¨æˆ·åˆ—è¡¨çš„æ¸²æŸ“å±•ç¤º</span><br><span class="line"></span><br><span class="line">![img](https:<span class="comment">//www.legendkiller.xyz/wp-content/uploads/2025/06/image-253-1024x309.png)</span></span><br><span class="line"></span><br><span class="line">å½“åœ¨æµè§ˆå™¨åœ°å€æ ï¼Œè®¿é—®å‰ç«¯é™æ€é¡µé¢ï¼ˆhttp:<span class="comment">//localhost:8080/usre.htmlï¼‰åï¼Œåœ¨å‰ç«¯é¡µé¢ä¸Šï¼Œä¼šå‘é€ajaxè¯·æ±‚ï¼Œè¯·æ±‚æœåŠ¡ç«¯ï¼ˆhttp://localhost:8080/listï¼‰ï¼ŒæœåŠ¡ç«¯ç¨‹åºåŠ è½½ user.txt æ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œè¯»å–å‡ºæ¥åæœ€ç»ˆç»™å‰ç«¯é¡µé¢å“åº”jsonæ ¼å¼çš„æ•°æ®ï¼Œå‰ç«¯é¡µé¢å†å°†æ•°æ®æ¸²æŸ“å±•ç¤ºåœ¨è¡¨æ ¼ä¸­ã€‚</span></span><br><span class="line"></span><br><span class="line">### <span class="number">2.2</span>ä»£ç å®ç°</span><br><span class="line"></span><br><span class="line">**<span class="number">1</span>). å‡†å¤‡å·¥ä½œï¼šå†åˆ›å»ºä¸€ä¸ªSpringBootå·¥ç¨‹ï¼Œå¹¶å‹¾é€‰webä¾èµ–ã€lombokä¾èµ–ã€‚**</span><br><span class="line"></span><br><span class="line">**<span class="number">2</span>). å‡†å¤‡å·¥ä½œï¼šå¼•å…¥èµ„æ–™ä¸­å‡†å¤‡å¥½çš„æ•°æ®æ–‡ä»¶user.txtï¼Œä»¥åŠstaticä¸‹çš„å‰ç«¯é™æ€é¡µé¢**</span><br><span class="line"></span><br><span class="line">**<span class="number">3</span>). å‡†å¤‡å·¥ä½œï¼šå®šä¹‰å°è£…ç”¨æˆ·ä¿¡æ¯çš„å®ä½“ç±»ã€‚**</span><br><span class="line"></span><br><span class="line">åœ¨ `com.itheima` ä¸‹å†å®šä¹‰ä¸€ä¸ªåŒ… `pojo`ï¼Œä¸“é—¨ç”¨æ¥å­˜æ”¾å®ä½“ç±»ã€‚ åœ¨è¯¥åŒ…ä¸‹å®šä¹‰ä¸€ä¸ªå®ä½“ç±»Userï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>package com.itheima.pojo;</p><p>import lombok.AllArgsConstructor;<br>import lombok.Data;<br>import lombok.NoArgsConstructor;<br>import java.time.LocalDateTime;</p><p>/**</p><ul><li>å°è£…ç”¨æˆ·ä¿¡æ¯<br>*/<br>@Data<br>@NoArgsConstructor<br>@AllArgsConstructor<br>public class User {<br>private Integer id;<br>private String username;<br>private String password;<br>private String name;<br>private Integer age;<br>private LocalDateTime updateTime;<br>}</li></ul><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**<span class="number">3</span>). å¼€å‘æœåŠ¡ç«¯ç¨‹åºï¼Œæ¥æ”¶è¯·æ±‚ï¼Œè¯»å–æ–‡æœ¬æ•°æ®å¹¶å“åº”**</span><br><span class="line"></span><br><span class="line">ç”±äºåœ¨æ¡ˆä¾‹ä¸­ï¼Œéœ€è¦è¯»å–æ–‡æœ¬ä¸­çš„æ•°æ®ï¼Œå¹¶ä¸”è¿˜éœ€è¦å°†å¯¹è±¡è½¬ä¸ºjsonæ ¼å¼ï¼Œæ‰€ä»¥è¿™é‡Œå‘¢ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å†å¼•å…¥ä¸€ä¸ªéå¸¸å¸¸ç”¨çš„å·¥å…·åŒ…hutoolã€‚ ç„¶åè°ƒç”¨é‡Œé¢çš„å·¥å…·ç±»ï¼Œå°±å¯ä»¥éå¸¸æ–¹ä¾¿å¿«æ·çš„å®Œæˆä¸šåŠ¡æ“ä½œã€‚</span><br><span class="line"></span><br><span class="line">`pom.xml`ä¸­å¼•å…¥ä¾èµ–</span><br><span class="line"></span><br></pre></td></tr></table></figure><dependency>    <groupId>cn.hutool</groupId>    <artifactId>hutool-all</artifactId>    <version>5.8.27</version></dependency><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">åœ¨`com.itheima`åŒ…ä¸‹æ–°å»ºä¸€ä¸ªå­åŒ…`controller`ï¼Œåœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ª`UserController`</span><br><span class="line"></span><br></pre></td></tr></table></figure>import cn.hutool.core.io.IoUtil;import cn.hutool.json.JSONConfig;import cn.hutool.json.JSONUtil;import com.itheima.pojo.User;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;import java.io.InputStream;import java.nio.charset.StandardCharsets;import java.time.LocalDateTime;import java.time.format.DateTimeFormatter;import java.util.ArrayList;import java.util.List;import java.util.stream.Collectors;<p>@RestController<br>public class UserController {</p><pre><code>@RequestMapping(&quot;/list&quot;)public String list()&#123;    //1.åŠ è½½å¹¶è¯»å–æ–‡ä»¶    InputStream in = this.getClass().getClassLoader().getResourceAsStream(&quot;user.txt&quot;);    ArrayList&lt;String&gt; lines = IoUtil.readLines(in, StandardCharsets.UTF_8, new ArrayList&lt;&gt;());        //2.è§£ææ•°æ®ï¼Œå°è£…æˆå¯¹è±¡ --&gt; é›†åˆ    List&lt;User&gt; userList = lines.stream().map(line -&gt; &#123;        String[] parts = line.split(&quot;,&quot;);        Integer id = Integer.parseInt(parts[0]);        String username = parts[1];        String password = parts[2];        String name = parts[3];        Integer age = Integer.parseInt(parts[4]);        LocalDateTime updateTime = LocalDateTime.parse(parts[5], DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;));        return new User(id, username, password, name, age, updateTime);    &#125;).collect(Collectors.toList());        //3.å“åº”æ•°æ®    //return JSONUtil.toJsonStr(userList, JSONConfig.create().setDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;));    return userList;&#125;</code></pre><p>}</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="strong">**4). å¯åŠ¨æœåŠ¡æµ‹è¯•ï¼Œè®¿é—®ï¼š**</span>http://localhost:8080/user.html</span><br><span class="line"></span><br><span class="line"><span class="section">### 2.3@ResponseBody</span></span><br><span class="line"></span><br><span class="line">controlleræ–¹æ³•ä¸­çš„returnçš„ç»“æœï¼Œæ€ä¹ˆå°±å¯ä»¥å“åº”ç»™æµè§ˆå™¨å‘¢ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆï¼šä½¿ç”¨@ResponseBodyæ³¨è§£</span><br><span class="line"></span><br><span class="line"><span class="strong">**@ResponseBodyæ³¨è§£ï¼š**</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> ç±»å‹ï¼šæ–¹æ³•æ³¨è§£ã€ç±»æ³¨è§£</span><br><span class="line"><span class="bullet">-</span> ä½ç½®ï¼šä¹¦å†™åœ¨Controlleræ–¹æ³•ä¸Šæˆ–ç±»ä¸Š</span><br><span class="line"><span class="bullet">-</span> ä½œç”¨ï¼šå°†æ–¹æ³•è¿”å›å€¼ç›´æ¥å“åº”ç»™æµè§ˆå™¨ï¼Œå¦‚æœè¿”å›å€¼ç±»å‹æ˜¯å®ä½“å¯¹è±¡/é›†åˆï¼Œå°†ä¼šè½¬æ¢ä¸ºJSONæ ¼å¼ååœ¨å“åº”ç»™æµè§ˆå™¨</span><br><span class="line"></span><br><span class="line">ä½†æ˜¯åœ¨æˆ‘ä»¬æ‰€ä¹¦å†™çš„Controllerä¸­ï¼Œåªåœ¨ç±»ä¸Šæ·»åŠ äº†@RestControlleræ³¨è§£ã€æ–¹æ³•æ·»åŠ äº†@RequestMappingæ³¨è§£ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨@ResponseBodyæ³¨è§£ï¼Œæ€ä¹ˆç»™æµè§ˆå™¨å“åº”å‘¢ï¼Ÿ</span><br><span class="line"></span><br><span class="line">è¿™æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬åœ¨ç±»ä¸ŠåŠ äº†<span class="strong">**@RestControlleræ³¨è§£ï¼Œè€Œè¿™ä¸ªæ³¨è§£æ˜¯ç”±ä¸¤ä¸ªæ³¨è§£ç»„åˆèµ·æ¥çš„ï¼Œåˆ†åˆ«æ˜¯ï¼š@Controller ã€@ResponseBodyã€‚**</span> é‚£ä¹Ÿå°±æ„å‘³ç€ï¼Œæˆ‘ä»¬åœ¨ç±»ä¸Šå·²ç»æ·»åŠ äº†@ResponseBodyæ³¨è§£äº†ï¼Œè€Œä¸€æ—¦åœ¨ç±»ä¸ŠåŠ äº†@ResponseBodyæ³¨è§£ï¼Œå°±ç›¸å½“äºè¯¥ç±»æ‰€æœ‰çš„æ–¹æ³•ä¸­éƒ½å·²ç»æ·»åŠ äº†@ResponseBodyæ³¨è§£ã€‚</span><br><span class="line"></span><br><span class="line">æç¤ºï¼šå‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ä¸­ï¼Œä¸€èˆ¬ç›´æ¥åœ¨è¯·æ±‚å¤„ç†ç±»ä¸ŠåŠ @RestControlleræ³¨è§£ï¼Œå°±æ— éœ€åœ¨æ–¹æ³•ä¸ŠåŠ @ResponseBodyæ³¨è§£äº†ã€‚</span><br><span class="line"></span><br><span class="line"><span class="section">## 3.åˆ†å±‚è§£è€¦</span></span><br><span class="line"></span><br><span class="line"><span class="section">### 3.1ä¸‰å±‚æ¶æ„</span></span><br><span class="line"></span><br><span class="line">åœ¨æˆ‘ä»¬é¡¹ç›®å¼€å‘ä¸­å‘¢ï¼Œå¯ä»¥å°†ä»£ç åˆ†ä¸ºä¸‰å±‚ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-245-1024x380.png</span>)</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> Controllerï¼šæ§åˆ¶å±‚ã€‚æ¥æ”¶å‰ç«¯å‘é€çš„è¯·æ±‚ï¼Œå¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œå¹¶å“åº”æ•°æ®ã€‚</span><br><span class="line"><span class="bullet">-</span> Serviceï¼šä¸šåŠ¡é€»è¾‘å±‚ã€‚å¤„ç†å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ã€‚</span><br><span class="line"><span class="bullet">-</span> Daoï¼šæ•°æ®è®¿é—®å±‚(Data Access Object)ï¼Œä¹Ÿç§°ä¸ºæŒä¹…å±‚ã€‚è´Ÿè´£æ•°æ®è®¿é—®æ“ä½œï¼ŒåŒ…æ‹¬æ•°æ®çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥ã€‚</span><br><span class="line"></span><br><span class="line">åŸºäºä¸‰å±‚æ¶æ„çš„ç¨‹åºæ‰§è¡Œæµç¨‹ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-275-1024x299.png</span>)</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> å‰ç«¯å‘èµ·çš„è¯·æ±‚ï¼Œç”±Controllerå±‚æ¥æ”¶ï¼ˆControllerå“åº”æ•°æ®ç»™å‰ç«¯ï¼‰</span><br><span class="line"><span class="bullet">-</span> Controllerå±‚è°ƒç”¨Serviceå±‚æ¥è¿›è¡Œé€»è¾‘å¤„ç†ï¼ˆServiceå±‚å¤„ç†å®Œåï¼ŒæŠŠå¤„ç†ç»“æœè¿”å›ç»™Controllerå±‚ï¼‰</span><br><span class="line"><span class="bullet">-</span> Serivceå±‚è°ƒç”¨Daoå±‚ï¼ˆé€»è¾‘å¤„ç†è¿‡ç¨‹ä¸­éœ€è¦ç”¨åˆ°çš„ä¸€äº›æ•°æ®è¦ä»Daoå±‚è·å–ï¼‰</span><br><span class="line"><span class="bullet">-</span> Daoå±‚æ“ä½œæ–‡ä»¶ä¸­çš„æ•°æ®ï¼ˆDaoæ‹¿åˆ°çš„æ•°æ®ä¼šè¿”å›ç»™Serviceå±‚ï¼‰</span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; æ€è€ƒï¼šæŒ‰ç…§ä¸‰å±‚æ¶æ„çš„æ€æƒ³ï¼Œå¦‚æœè¦å¯¹ä¸šåŠ¡é€»è¾‘(Serviceå±‚)è¿›è¡Œå˜æ›´ï¼Œä¼šå½±å“åˆ°Controllerå±‚å’ŒDaoå±‚å—ï¼Ÿ</span></span><br><span class="line"><span class="quote">&gt;</span></span><br><span class="line"><span class="quote">&gt; ç­”æ¡ˆï¼šä¸ä¼šå½±å“ã€‚ ï¼ˆç¨‹åºçš„æ‰©å±•æ€§ã€ç»´æŠ¤æ€§å˜å¾—æ›´å¥½äº†ï¼‰</span></span><br><span class="line"></span><br><span class="line">å¯¹ä¹‹å‰çš„ä»£ç è¿›è¡Œä¸‰å±‚åˆ’åˆ†ï¼š</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-246-1024x528.png</span>)</span><br><span class="line"></span><br><span class="line">ä¸‰å±‚æ¶æ„çš„å¥½å¤„ï¼š</span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> å¤ç”¨æ€§å¼º</span><br><span class="line"><span class="bullet">2.</span> ä¾¿äºç»´æŠ¤</span><br><span class="line"><span class="bullet">3.</span> åˆ©ç”¨æ‰©å±•</span><br><span class="line"></span><br><span class="line"><span class="section">### 3.2åˆ†å±‚è§£è€¦</span></span><br><span class="line"></span><br><span class="line"><span class="section">#### 3.2.1é—®é¢˜åˆ†æ</span></span><br><span class="line"></span><br><span class="line">ç”±äºæˆ‘ä»¬ç°åœ¨åœ¨ç¨‹åºä¸­ï¼Œéœ€è¦ä»€ä¹ˆå¯¹è±¡ï¼Œç›´æ¥newä¸€ä¸ªå¯¹è±¡ <span class="code">`new UserServiceImpl()`</span> ã€‚</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-254.png</span>)</span><br><span class="line"></span><br><span class="line">å¦‚æœè¯´æˆ‘ä»¬éœ€è¦æ›´æ¢å®ç°ç±»ï¼Œæ¯”å¦‚ç”±äºä¸šåŠ¡çš„å˜æ›´ï¼ŒUserServiceImpl ä¸èƒ½æ»¡è¶³ç°æœ‰çš„ä¸šåŠ¡éœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦åˆ‡æ¢ä¸º UserServiceImpl2 è¿™å¥—å®ç°ï¼Œå°±éœ€è¦ä¿®æ”¹Contorllerçš„ä»£ç ï¼Œéœ€è¦åˆ›å»º UserServiceImpl2 çš„å®ç°<span class="code">`new UserServiceImpl2()`</span> ã€‚</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-255.png</span>)</span><br><span class="line"></span><br><span class="line">Serviceä¸­è°ƒç”¨Daoï¼Œä¹Ÿæ˜¯ç±»ä¼¼çš„é—®é¢˜ã€‚è¿™ç§å‘¢ï¼Œæˆ‘ä»¬å°±ç§°ä¹‹ä¸ºå±‚ä¸å±‚ä¹‹é—´ <span class="strong">**è€¦åˆ**</span> äº†ã€‚ é‚£ä»€ä¹ˆæ˜¯è€¦åˆå‘¢ ï¼Ÿ</span><br><span class="line"></span><br><span class="line">é¦–å…ˆéœ€è¦äº†è§£è½¯ä»¶å¼€å‘æ¶‰åŠåˆ°çš„ä¸¤ä¸ªæ¦‚å¿µï¼šå†…èšå’Œè€¦åˆã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**å†…èšï¼š**</span>è½¯ä»¶ä¸­å„ä¸ªåŠŸèƒ½æ¨¡å—å†…éƒ¨çš„åŠŸèƒ½è”ç³»ã€‚(æ¨¡å—ä¸­å…ƒç´ ä¹‹é—´)</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**è€¦åˆï¼š**</span>è¡¡é‡è½¯ä»¶ä¸­å„ä¸ªå±‚/æ¨¡å—ä¹‹é—´çš„ä¾èµ–ã€å…³è”çš„ç¨‹åº¦ã€‚ï¼ˆæ¨¡å—/å±‚ä¸æ¨¡å—/å±‚ä¹‹é—´ï¼‰</span><br><span class="line"></span><br><span class="line"><span class="strong">**è½¯ä»¶è®¾è®¡åŸåˆ™ï¼šé«˜å†…èšä½è€¦åˆã€‚**</span></span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; <span class="strong">**é«˜å†…èšï¼š**</span>æŒ‡çš„æ˜¯ä¸€ä¸ªæ¨¡å—ä¸­å„ä¸ªå…ƒç´ ä¹‹é—´çš„è”ç³»çš„ç´§å¯†ç¨‹åº¦ï¼Œå¦‚æœå„ä¸ªå…ƒç´ (è¯­å¥ã€ç¨‹åºæ®µ)ä¹‹é—´çš„è”ç³»ç¨‹åº¦è¶Šé«˜ï¼Œåˆ™å†…èšæ€§è¶Šé«˜ï¼Œå³ &quot;é«˜å†…èš&quot;ã€‚</span></span><br><span class="line"><span class="quote">&gt;</span></span><br><span class="line"><span class="quote">&gt; <span class="strong">**ä½è€¦åˆï¼š**</span>æŒ‡çš„æ˜¯è½¯ä»¶ä¸­å„ä¸ªå±‚ã€æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³è”ç¨‹åºè¶Šä½è¶Šå¥½ã€‚</span></span><br><span class="line"></span><br><span class="line">ç›®å‰å±‚ä¸å±‚ä¹‹é—´æ˜¯å­˜åœ¨è€¦åˆçš„ï¼ŒControllerè€¦åˆäº†Serviceã€Serviceè€¦åˆäº†Daoã€‚è€Œ é«˜å†…èšã€ä½è€¦åˆçš„ç›®çš„æ˜¯ä½¿ç¨‹åºæ¨¡å—çš„å¯é‡ç”¨æ€§ã€ç§»æ¤æ€§å¤§å¤§å¢å¼ºã€‚</span><br><span class="line"></span><br><span class="line">é‚£æœ€ç»ˆæˆ‘ä»¬çš„ç›®æ ‡å‘¢ï¼Œå°±æ˜¯åšåˆ°å±‚ä¸å±‚ä¹‹é—´ï¼Œå°½å¯èƒ½çš„é™ä½è€¦åˆï¼Œç”šè‡³è§£é™¤è€¦åˆã€‚</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-256-1024x479.png</span>)</span><br><span class="line"></span><br><span class="line"><span class="section">#### 3.2.2è§£è€¦æ€è·¯</span></span><br><span class="line"></span><br><span class="line"><span class="strong">**1). é¦–å…ˆä¸èƒ½åœ¨EmpControllerä¸­ä½¿ç”¨newå¯¹è±¡ã€‚**</span></span><br><span class="line"></span><br><span class="line"><span class="strong">**2). å°†è¦ç”¨åˆ°çš„å¯¹è±¡äº¤ç»™ä¸€ä¸ªå®¹å™¨ç®¡ç†ã€‚**</span></span><br><span class="line"></span><br><span class="line"><span class="strong">**3). åº”ç”¨ç¨‹åºä¸­ç”¨åˆ°è¿™ä¸ªå¯¹è±¡ï¼Œå°±ç›´æ¥ä»å®¹å™¨ä¸­è·å–**</span></span><br><span class="line"></span><br><span class="line">æˆ‘ä»¬æƒ³è¦å®ç°ä¸Šè¿°è§£è€¦æ“ä½œï¼Œå°±æ¶‰åŠåˆ°Springä¸­çš„ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> æ§åˆ¶åè½¬ï¼š</span><br><span class="line"></span><br><span class="line">   Inversion Of Controlï¼Œç®€ç§°</span><br><span class="line"></span><br><span class="line">  IOC</span><br><span class="line"></span><br><span class="line">  ã€‚å¯¹è±¡çš„åˆ›å»ºæ§åˆ¶æƒç”±ç¨‹åºè‡ªèº«è½¬ç§»åˆ°å¤–éƒ¨ï¼ˆå®¹å™¨ï¼‰ï¼Œè¿™ç§æ€æƒ³ç§°ä¸ºæ§åˆ¶åè½¬ã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">  -</span> å¯¹è±¡çš„åˆ›å»ºæƒç”±ç¨‹åºå‘˜ä¸»åŠ¨åˆ›å»ºè½¬ç§»åˆ°å®¹å™¨(ç”±å®¹å™¨åˆ›å»ºã€ç®¡ç†å¯¹è±¡)ã€‚è¿™ä¸ªå®¹å™¨ç§°ä¸ºï¼šIOCå®¹å™¨æˆ–Springå®¹å™¨ã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> ä¾èµ–æ³¨å…¥ï¼š</span><br><span class="line"></span><br><span class="line">   Dependency Injectionï¼Œç®€ç§°</span><br><span class="line"></span><br><span class="line">  DI</span><br><span class="line"></span><br><span class="line">  ã€‚å®¹å™¨ä¸ºåº”ç”¨ç¨‹åºæä¾›è¿è¡Œæ—¶ï¼Œæ‰€ä¾èµ–çš„èµ„æºï¼Œç§°ä¹‹ä¸ºä¾èµ–æ³¨å…¥ã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">  -</span> ç¨‹åºè¿è¡Œæ—¶éœ€è¦æŸä¸ªèµ„æºï¼Œæ­¤æ—¶å®¹å™¨å°±ä¸ºå…¶æä¾›è¿™ä¸ªèµ„æºã€‚</span><br><span class="line"><span class="bullet">  -</span> ä¾‹ï¼šEmpControllerç¨‹åºè¿è¡Œæ—¶éœ€è¦EmpServiceå¯¹è±¡ï¼ŒSpringå®¹å™¨å°±ä¸ºå…¶æä¾›å¹¶æ³¨å…¥EmpServiceå¯¹è±¡ã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**beanå¯¹è±¡ï¼š**</span>IOCå®¹å™¨ä¸­åˆ›å»ºã€ç®¡ç†çš„å¯¹è±¡ï¼Œç§°ä¹‹ä¸ºï¼šbeanå¯¹è±¡ã€‚</span><br><span class="line"></span><br><span class="line"><span class="section">#### 3.2.3IOC&amp;DIå…¥é—¨</span></span><br><span class="line"></span><br><span class="line"><span class="strong">**1). å°†ServiceåŠDaoå±‚çš„å®ç°ç±»ï¼Œäº¤ç»™IOCå®¹å™¨ç®¡ç†**</span></span><br><span class="line"></span><br><span class="line">åœ¨å®ç°ç±»åŠ ä¸Š <span class="code">`@Component`</span> æ³¨è§£ï¼Œå°±ä»£è¡¨æŠŠå½“å‰ç±»äº§ç”Ÿçš„å¯¹è±¡äº¤ç»™IOCå®¹å™¨ç®¡ç†ã€‚</span><br><span class="line"></span><br><span class="line"><span class="strong">**A. UserDaoImpl**</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>@Component<br>public class UserDaoImpl implements UserDao {<br>@Override<br>public List<String> findAll() {<br>InputStream in = this.getClass().getClassLoader().getResourceAsStream(â€œuser.txtâ€);<br>ArrayList<String> lines = IoUtil.readLines(in, StandardCharsets.UTF_8, new ArrayList&lt;&gt;());<br>return lines;<br>}<br>}</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="strong">**B. UserServiceImpl**</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>@Component<br>public class UserServiceImpl implements UserService {</p><pre><code>private UserDao userDao;@Overridepublic List&lt;User&gt; findAll() &#123;    List&lt;String&gt; lines = userDao.findAll();    List&lt;User&gt; userList = lines.stream().map(line -&gt; &#123;        String[] parts = line.split(&quot;,&quot;);        Integer id = Integer.parseInt(parts[0]);        String username = parts[1];        String password = parts[2];        String name = parts[3];        Integer age = Integer.parseInt(parts[4]);        LocalDateTime updateTime = LocalDateTime.parse(parts[5], DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;));        return new User(id, username, password, name, age, updateTime);    &#125;).collect(Collectors.toList());    return userList;&#125;</code></pre><p>}</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="strong">**2). ä¸ºController åŠ Serviceæ³¨å…¥è¿è¡Œæ—¶æ‰€ä¾èµ–çš„å¯¹è±¡**</span></span><br><span class="line"></span><br><span class="line"><span class="strong">**A. UserServiceImpl**</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>@Component<br>public class UserServiceImpl implements UserService {</p><pre><code>@Autowiredprivate UserDao userDao;@Overridepublic List&lt;User&gt; findAll() &#123;    List&lt;String&gt; lines = userDao.findAll();    List&lt;User&gt; userList = lines.stream().map(line -&gt; &#123;        String[] parts = line.split(&quot;,&quot;);        Integer id = Integer.parseInt(parts[0]);        String username = parts[1];        String password = parts[2];        String name = parts[3];        Integer age = Integer.parseInt(parts[4]);        LocalDateTime updateTime = LocalDateTime.parse(parts[5], DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;));        return new User(id, username, password, name, age, updateTime);    &#125;).collect(Collectors.toList());    return userList;&#125;</code></pre><p>}</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="strong">**B. UserController**</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>@RestController<br>public class UserController {</p><pre><code>@Autowiredprivate UserService userService;@RequestMapping(&quot;/list&quot;)public List&lt;User&gt; list()&#123;    //1.è°ƒç”¨Service    List&lt;User&gt; userList = userService.findAll();    //2.å“åº”æ•°æ®    return userList;&#125;</code></pre><p>}</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">## 4.IOCè¯¦è§£</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 4.1Beançš„å£°æ˜</span></span><br><span class="line"></span><br><span class="line">å‰é¢æˆ‘ä»¬æåˆ°IOCæ§åˆ¶åè½¬ï¼Œå°±æ˜¯å°†å¯¹è±¡çš„æ§åˆ¶æƒäº¤ç»™Springçš„IOCå®¹å™¨ï¼Œç”±IOCå®¹å™¨åˆ›å»ºåŠç®¡ç†å¯¹è±¡ã€‚IOCå®¹å™¨åˆ›å»ºçš„å¯¹è±¡ç§°ä¸ºbeanå¯¹è±¡ã€‚</span><br><span class="line"></span><br><span class="line">åœ¨ä¹‹å‰çš„å…¥é—¨æ¡ˆä¾‹ä¸­ï¼Œè¦æŠŠæŸä¸ªå¯¹è±¡äº¤ç»™IOCå®¹å™¨ç®¡ç†ï¼Œéœ€è¦åœ¨ç±»ä¸Šæ·»åŠ ä¸€ä¸ªæ³¨è§£ï¼š<span class="symbol">*</span><span class="symbol">*</span>`<span class="meta">@Component`**</span></span><br><span class="line"></span><br><span class="line">è€ŒSpringæ¡†æ¶ä¸ºäº†æ›´å¥½çš„æ ‡è¯†webåº”ç”¨ç¨‹åºå¼€å‘å½“ä¸­ï¼Œbeanå¯¹è±¡åˆ°åº•å½’å±äºå“ªä¸€å±‚ï¼Œåˆæä¾›äº†<span class="meta">@Componentçš„è¡ç”Ÿæ³¨è§£ï¼š</span></span><br><span class="line"></span><br><span class="line">|<span class="string"> æ³¨è§£        </span>|<span class="string"> è¯´æ˜                 </span>|<span class="string"> ä½ç½®                                              </span>|</span><br><span class="line">|<span class="string"> ----------- </span>|<span class="string"> -------------------- </span>|<span class="string"> ------------------------------------------------- </span>|</span><br><span class="line">|<span class="string"> @Component  </span>|<span class="string"> å£°æ˜beançš„åŸºç¡€æ³¨è§£   </span>|<span class="string"> ä¸å±äºä»¥ä¸‹ä¸‰ç±»æ—¶ï¼Œç”¨æ­¤æ³¨è§£                        </span>|</span><br><span class="line">|<span class="string"> @Controller </span>|<span class="string"> @Componentçš„è¡ç”Ÿæ³¨è§£ </span>|<span class="string"> æ ‡æ³¨åœ¨æ§åˆ¶å±‚ç±»ä¸Š                                  </span>|</span><br><span class="line">|<span class="string"> @Service    </span>|<span class="string"> @Componentçš„è¡ç”Ÿæ³¨è§£ </span>|<span class="string"> æ ‡æ³¨åœ¨ä¸šåŠ¡å±‚ç±»ä¸Š                                  </span>|</span><br><span class="line">|<span class="string"> @Repository </span>|<span class="string"> @Componentçš„è¡ç”Ÿæ³¨è§£ </span>|<span class="string"> æ ‡æ³¨åœ¨æ•°æ®è®¿é—®å±‚ç±»ä¸Šï¼ˆç”±äºä¸mybatisæ•´åˆï¼Œç”¨çš„å°‘ï¼‰ </span>|</span><br><span class="line"></span><br><span class="line">é‚£ä¹ˆæ­¤æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ `<span class="meta">@Service`</span> æ³¨è§£å£°æ˜Serviceå±‚çš„beanã€‚ ä½¿ç”¨ `<span class="meta">@Repository`</span> æ³¨è§£å£°æ˜Daoå±‚çš„beanã€‚ ä»£ç å®ç°å¦‚ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line">Serviceå±‚:</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>@Service<br>public class UserServiceImpl implements UserService {</p><pre><code>private UserDao userDao;@Overridepublic List&lt;User&gt; findAll() &#123;    List&lt;String&gt; lines = userDao.findAll();    List&lt;User&gt; userList = lines.stream().map(line -&gt; &#123;        String[] parts = line.split(&quot;,&quot;);        Integer id = Integer.parseInt(parts[0]);        String username = parts[1];        String password = parts[2];        String name = parts[3];        Integer age = Integer.parseInt(parts[4]);        LocalDateTime updateTime = LocalDateTime.parse(parts[5], DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;));        return new User(id, username, password, name, age, updateTime);    &#125;).collect(Collectors.toList());    return userList;&#125;</code></pre><p>}</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="section">Daoå±‚:</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>@Repository<br>public class UserDaoImpl implements UserDao {<br>@Override<br>public List<String> findAll() {<br>InputStream in = this.getClass().getClassLoader().getResourceAsStream(â€œuser.txtâ€);<br>ArrayList<String> lines = IoUtil.readLines(in, StandardCharsets.UTF_8, new ArrayList&lt;&gt;());<br>return lines;<br>}<br>}</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**æ³¨æ„<span class="number">1</span>**ï¼šå£°æ˜<span class="selector-tag">bean</span>çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡æ³¨è§£çš„<span class="selector-tag">value</span>å±æ€§æŒ‡å®š<span class="selector-tag">bean</span>çš„åå­—ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸ºç±»åé¦–å­—æ¯å°å†™ã€‚</span><br><span class="line"></span><br><span class="line">**æ³¨æ„<span class="number">2</span>**ï¼šä½¿ç”¨ä»¥ä¸Šå››ä¸ªæ³¨è§£éƒ½å¯ä»¥å£°æ˜<span class="selector-tag">bean</span>ï¼Œä½†æ˜¯åœ¨<span class="selector-tag">springboot</span>é›†æˆ<span class="selector-tag">web</span>å¼€å‘ä¸­ï¼Œå£°æ˜æ§åˆ¶å™¨<span class="selector-tag">bean</span>åªèƒ½ç”¨@<span class="selector-tag">Controller</span>ã€‚</span><br><span class="line"></span><br><span class="line">### <span class="number">4.2</span>ç»„ä»¶æ‰«æ</span><br><span class="line"></span><br><span class="line">é—®é¢˜ï¼šä½¿ç”¨å‰é¢å­¦ä¹ çš„å››ä¸ªæ³¨è§£å£°æ˜çš„<span class="selector-tag">bean</span>ï¼Œä¸€å®šä¼šç”Ÿæ•ˆå—ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆï¼šä¸ä¸€å®šã€‚ï¼ˆåŸå› ï¼š<span class="selector-tag">bean</span>æƒ³è¦ç”Ÿæ•ˆï¼Œè¿˜éœ€è¦è¢«ç»„ä»¶æ‰«æï¼‰</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">-</span> å‰é¢å£°æ˜<span class="selector-tag">bean</span>çš„å››å¤§æ³¨è§£ï¼Œè¦æƒ³ç”Ÿæ•ˆï¼Œè¿˜éœ€è¦è¢«ç»„ä»¶æ‰«ææ³¨è§£ **`@<span class="selector-tag">ComponentScan</span>`** æ‰«æã€‚</span><br><span class="line"><span class="selector-tag">-</span> è¯¥æ³¨è§£è™½ç„¶æ²¡æœ‰æ˜¾å¼é…ç½®ï¼Œ**ä½†æ˜¯å®é™…ä¸Šå·²ç»åŒ…å«åœ¨äº†å¯åŠ¨ç±»å£°æ˜æ³¨è§£ `@<span class="selector-tag">SpringBootApplication</span>` ä¸­**ï¼Œé»˜è®¤æ‰«æçš„èŒƒå›´æ˜¯å¯åŠ¨ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…ã€‚</span><br><span class="line"></span><br><span class="line">!<span class="selector-attr">[img]</span>(<span class="attribute">https</span>:<span class="comment">//www.legendkiller.xyz/wp-content/uploads/2025/06/image-257-1024x360.png)</span></span><br><span class="line"></span><br><span class="line">æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œåªéœ€è¦æŒ‰ç…§å¦‚ä¸Šé¡¹ç›®ç»“æ„ï¼Œå°†é¡¹ç›®ä¸­çš„æ‰€æœ‰çš„ä¸šåŠ¡ç±»ï¼Œéƒ½æ”¾åœ¨å¯åŠ¨ç±»æ‰€åœ¨åŒ…çš„å­åŒ…ä¸­ï¼Œå°±æ— éœ€è€ƒè™‘ç»„ä»¶æ‰«æé—®é¢˜ã€‚</span><br><span class="line"></span><br><span class="line">## <span class="number">5</span>.DIè¯¦è§£</span><br><span class="line"></span><br><span class="line">ä¾èµ–æ³¨å…¥ï¼Œæ˜¯æŒ‡IOCå®¹å™¨è¦ä¸ºåº”ç”¨ç¨‹åºå»æä¾›è¿è¡Œæ—¶æ‰€ä¾èµ–çš„èµ„æºï¼Œè€Œèµ„æºæŒ‡çš„å°±æ˜¯å¯¹è±¡ã€‚</span><br><span class="line"></span><br><span class="line">åœ¨å…¥é—¨ç¨‹åºæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†<span class="variable">@Autowired</span>è¿™ä¸ªæ³¨è§£ï¼Œå®Œæˆäº†ä¾èµ–æ³¨å…¥çš„æ“ä½œï¼Œè€Œè¿™ä¸ªAutowiredç¿»è¯‘è¿‡æ¥å«ï¼šè‡ªåŠ¨è£…é…ã€‚</span><br><span class="line"></span><br><span class="line"><span class="built_in">`@Autowired`</span>æ³¨è§£ï¼Œé»˜è®¤æ˜¯æŒ‰ç…§**ç±»å‹**è¿›è¡Œè‡ªåŠ¨è£…é…çš„ï¼ˆå»IOCå®¹å™¨ä¸­æ‰¾æŸä¸ªç±»å‹çš„å¯¹è±¡ï¼Œç„¶åå®Œæˆæ³¨å…¥æ“ä½œï¼‰</span><br><span class="line"></span><br><span class="line">&gt; å…¥é—¨ç¨‹åºä¸¾ä¾‹ï¼šåœ¨EmpControllerè¿è¡Œçš„æ—¶å€™ï¼Œå°±è¦åˆ°IOCå®¹å™¨å½“ä¸­å»æŸ¥æ‰¾EmpServiceè¿™ä¸ªç±»å‹çš„å¯¹è±¡ï¼Œè€Œæˆ‘ä»¬çš„IOCå®¹å™¨ä¸­åˆšå¥½æœ‰ä¸€ä¸ªEmpServiceè¿™ä¸ªç±»å‹çš„å¯¹è±¡ï¼Œæ‰€ä»¥å°±æ‰¾åˆ°äº†è¿™ä¸ªç±»å‹çš„å¯¹è±¡å®Œæˆæ³¨å…¥æ“ä½œã€‚</span><br><span class="line"></span><br><span class="line">### <span class="number">5.1</span><span class="variable">@Autowired</span>ç”¨æ³•</span><br><span class="line"></span><br><span class="line"><span class="variable">@Autowired</span> è¿›è¡Œä¾èµ–æ³¨å…¥ï¼Œå¸¸è§çš„æ–¹å¼ï¼Œæœ‰å¦‚ä¸‹ä¸‰ç§ï¼š</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>). å±æ€§æ³¨å…¥</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>@RestController<br>public class UserController {</p><pre><code>//æ–¹å¼ä¸€: å±æ€§æ³¨å…¥@Autowiredprivate UserService userService;</code></pre><p>}</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">- </span>ä¼˜ç‚¹ï¼šä»£ç ç®€æ´ã€æ–¹ä¾¿å¿«é€Ÿå¼€å‘ã€‚</span><br><span class="line"><span class="bullet">- </span>ç¼ºç‚¹ï¼šéšè—äº†ç±»ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€å¯èƒ½ä¼šç ´åç±»çš„å°è£…æ€§ã€‚</span><br><span class="line"></span><br><span class="line">2). æ„é€ å‡½æ•°æ³¨å…¥</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>@RestController<br>public class UserController {</p><pre><code>//æ–¹å¼äºŒ: æ„é€ å™¨æ³¨å…¥private final UserService userService;@Autowired //å¦‚æœå½“å‰ç±»ä¸­åªå­˜åœ¨ä¸€ä¸ªæ„é€ å‡½æ•°, @Autowiredå¯ä»¥çœç•¥public UserController(UserService userService) &#123;    this.userService = userService;&#125;</code></pre><p>}</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">- </span>ä¼˜ç‚¹ï¼šèƒ½æ¸…æ™°åœ°çœ‹åˆ°ç±»çš„ä¾èµ–å…³ç³»ã€æé«˜äº†ä»£ç çš„å®‰å…¨æ€§ã€‚</span><br><span class="line"><span class="bullet">- </span>ç¼ºç‚¹ï¼šä»£ç ç¹çã€å¦‚æœæ„é€ å‚æ•°è¿‡å¤šï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„é€ å‡½æ•°è‡ƒè‚¿ã€‚</span><br><span class="line"><span class="bullet">- </span><span class="strong">**æ³¨æ„ï¼šå¦‚æœåªæœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œ@Autowiredæ³¨è§£å¯ä»¥çœç•¥ã€‚ï¼ˆé€šå¸¸æ¥è¯´ï¼Œä¹Ÿåªæœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼‰**</span></span><br><span class="line"></span><br><span class="line">3). setteræ³¨å…¥</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>/** * ç”¨æˆ·ä¿¡æ¯Controller */<br>@RestController<br>public class UserController {</p><pre><code>//æ–¹å¼ä¸‰: setteræ³¨å…¥private UserService userService;@Autowiredpublic void setUserService(UserService userService) &#123;    this.userService = userService;&#125;</code></pre><p>}</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="selector-tag">-</span> ä¼˜ç‚¹ï¼šä¿æŒäº†ç±»çš„å°è£…æ€§ï¼Œä¾èµ–å…³ç³»æ›´æ¸…æ™°ã€‚</span><br><span class="line"><span class="selector-tag">-</span> ç¼ºç‚¹ï¼šéœ€è¦é¢å¤–ç¼–å†™<span class="selector-tag">setter</span>æ–¹æ³•ï¼Œå¢åŠ äº†ä»£ç é‡ã€‚</span><br><span class="line"></span><br><span class="line">åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼ŒåŸºäº@<span class="selector-tag">Autowired</span>è¿›è¡Œä¾èµ–æ³¨å…¥æ—¶ï¼ŒåŸºæœ¬éƒ½æ˜¯ç¬¬ä¸€ç§å’Œç¬¬äºŒç§æ–¹å¼ã€‚ï¼ˆå®˜æ–¹æ¨èç¬¬äºŒç§æ–¹å¼ï¼Œå› ä¸ºä¼šæ›´åŠ è§„èŒƒï¼‰ä½†æ˜¯åœ¨ä¼ä¸šé¡¹ç›®å¼€å‘ä¸­ï¼Œå¾ˆå¤šçš„é¡¹ç›®ä¸­ï¼Œä¹Ÿä¼šé€‰æ‹©ç¬¬ä¸€ç§æ–¹å¼å› ä¸ºæ›´åŠ ç®€æ´ã€é«˜æ•ˆï¼ˆåœ¨è§„èŒƒæ€§æ–¹é¢è¿›è¡Œäº†å¦¥åï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">### <span class="number">5.2</span>æ³¨æ„äº‹é¡¹</span><br><span class="line"></span><br><span class="line">é‚£å¦‚æœåœ¨<span class="selector-tag">IOC</span>å®¹å™¨ä¸­ï¼Œå­˜åœ¨å¤šä¸ªç›¸åŒç±»å‹çš„<span class="selector-tag">bean</span>å¯¹è±¡ï¼Œä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ</span><br><span class="line"></span><br><span class="line">åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å‡†å¤‡äº†ä¸¤ä¸ª<span class="selector-tag">UserService</span>çš„å®ç°ç±»ï¼Œå¹¶ä¸”éƒ½äº¤ç»™äº†<span class="selector-tag">IOC</span>å®¹å™¨ç®¡ç†ã€‚ ä»£ç å¦‚ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line">!<span class="selector-attr">[img]</span>(<span class="attribute">https</span>:<span class="comment">//www.legendkiller.xyz/wp-content/uploads/2025/06/image-266-1024x685.png)</span></span><br><span class="line"></span><br><span class="line">æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯åŠ¨é¡¹ç›®ä¼šå‘ç°ï¼Œæ§åˆ¶å°æŠ¥é”™äº†ï¼š</span><br><span class="line"></span><br><span class="line">![img](<span class="attribute">https</span>:<span class="comment">//www.legendkiller.xyz/wp-content/uploads/2025/06/image-267-1024x480.png)</span></span><br><span class="line"></span><br><span class="line">å‡ºç°é”™è¯¯çš„åŸå› å‘¢ï¼Œæ˜¯å› ä¸ºåœ¨Springçš„å®¹å™¨ä¸­ï¼ŒUserServiceè¿™ä¸ªç±»å‹çš„beanå­˜åœ¨ä¸¤ä¸ªï¼Œæ¡†æ¶ä¸çŸ¥é“å…·ä½“è¦æ³¨å…¥å“ªä¸ªbeanä½¿ç”¨ï¼Œæ‰€ä»¥å°±æŠ¥é”™äº†ã€‚</span><br><span class="line"></span><br><span class="line">å¦‚ä½•è§£å†³ä¸Šè¿°é—®é¢˜å‘¢ï¼ŸSpringæä¾›äº†ä»¥ä¸‹å‡ ç§è§£å†³æ–¹æ¡ˆï¼š</span><br><span class="line"></span><br><span class="line">- <span class="variable">@Primary</span></span><br><span class="line">- <span class="variable">@Qualifier</span></span><br><span class="line">- <span class="variable">@Resource</span></span><br><span class="line"></span><br><span class="line">**æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨<span class="variable">@Primary</span>æ³¨è§£**</span><br><span class="line"></span><br><span class="line">å½“å­˜åœ¨å¤šä¸ªç›¸åŒç±»å‹çš„Beanæ³¨å…¥æ—¶ï¼ŒåŠ ä¸Š<span class="variable">@Primary</span>æ³¨è§£ï¼Œæ¥ç¡®å®š**é»˜è®¤çš„å®ç°**ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>@Primary<br>@Service<br>public class UserServiceImpl implements UserService {<br>}</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**æ–¹æ¡ˆäºŒï¼šä½¿ç”¨<span class="variable">@Qualifier</span>æ³¨è§£**</span><br><span class="line"></span><br><span class="line">æŒ‡å®šå½“å‰è¦æ³¨å…¥çš„beanå¯¹è±¡ã€‚ åœ¨<span class="variable">@Qualifier</span>çš„valueå±æ€§ä¸­ï¼Œ**æŒ‡å®šæ³¨å…¥**çš„beançš„åç§°ã€‚ <span class="variable">@Qualifier</span>æ³¨è§£ä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œå¿…é¡»é…åˆ<span class="variable">@Autowired</span>ä½¿ç”¨ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>@RestController<br>public class UserController {</p><pre><code>@Qualifier(&quot;userServiceImpl&quot;)@Autowiredprivate UserService userService;</code></pre><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="strong">**æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨@Resourceæ³¨è§£**</span></span><br><span class="line"></span><br><span class="line">æ˜¯æŒ‰ç…§beançš„åç§°è¿›è¡Œæ³¨å…¥ã€‚<span class="strong">**é€šè¿‡nameå±æ€§æŒ‡å®š**</span>è¦æ³¨å…¥çš„beançš„åç§°ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>@RestController<br>public class UserController {</p><pre><code>@Resource(name = &quot;userServiceImpl&quot;)private UserService userService;</code></pre><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="symbol">*</span><span class="symbol">*</span>é¢è¯•é¢˜ï¼š<span class="meta">@Autowird</span> ä¸ <span class="meta">@Resourceçš„åŒºåˆ«**</span></span><br><span class="line"></span><br><span class="line">- <span class="meta">@Autowired</span> æ˜¯springæ¡†æ¶æä¾›çš„æ³¨è§£ï¼Œè€Œ<span class="meta">@Resourceæ˜¯JDKæä¾›çš„æ³¨è§£</span></span><br><span class="line">- <span class="meta">@Autowired</span> é»˜è®¤æ˜¯æŒ‰ç…§ç±»å‹æ³¨å…¥ï¼Œè€Œ<span class="meta">@Resourceæ˜¯æŒ‰ç…§åç§°æ³¨å…¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 6.å¸¸è§çŠ¶æ€ç </span></span><br><span class="line"></span><br><span class="line">|<span class="string"> çŠ¶æ€ç  </span>|<span class="string"> è‹±æ–‡æè¿°                        </span>|<span class="string"> è§£é‡Š                                                         </span>|</span><br><span class="line">|<span class="string"> ------ </span>|<span class="string"> ------------------------------- </span>|<span class="string"> ------------------------------------------------------------ </span>|</span><br><span class="line">|<span class="string"> 200    </span>|<span class="string"> OK                              </span>|<span class="string"> å®¢æˆ·ç«¯è¯·æ±‚æˆåŠŸï¼Œå³å¤„ç†æˆåŠŸï¼Œè¿™æ˜¯æˆ‘ä»¬æœ€æƒ³çœ‹åˆ°çš„çŠ¶æ€ç          </span>|</span><br><span class="line">|<span class="string"> 302    </span>|<span class="string"> Found                           </span>|<span class="string"> æŒ‡ç¤ºæ‰€è¯·æ±‚çš„èµ„æºå·²ç§»åŠ¨åˆ°ç”±Locationå“åº”å¤´ç»™å®šçš„ URLï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨é‡æ–°è®¿é—®åˆ°è¿™ä¸ªé¡µé¢ </span>|</span><br><span class="line">|<span class="string"> 304    </span>|<span class="string"> Not Modified                    </span>|<span class="string"> å‘Šè¯‰å®¢æˆ·ç«¯ï¼Œä½ è¯·æ±‚çš„èµ„æºè‡³ä¸Šæ¬¡å–å¾—åï¼ŒæœåŠ¡ç«¯å¹¶æœªæ›´æ”¹ï¼Œä½ ç›´æ¥ç”¨ä½ æœ¬åœ°ç¼“å­˜å§ã€‚éšå¼é‡å®šå‘ </span>|</span><br><span class="line">|<span class="string"> 400    </span>|<span class="string"> Bad Request                     </span>|<span class="string"> å®¢æˆ·ç«¯è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯ï¼Œä¸èƒ½è¢«æœåŠ¡å™¨æ‰€ç†è§£                     </span>|</span><br><span class="line">|<span class="string"> 403    </span>|<span class="string"> Forbidden                       </span>|<span class="string"> æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œä½†æ˜¯æ‹’ç»æä¾›æœåŠ¡ï¼Œæ¯”å¦‚ï¼šæ²¡æœ‰æƒé™è®¿é—®ç›¸å…³èµ„æº </span>|</span><br><span class="line">|<span class="string"> 404    </span>|<span class="string"> Not Found                       </span>|<span class="string"> è¯·æ±‚èµ„æºä¸å­˜åœ¨ï¼Œä¸€èˆ¬æ˜¯URLè¾“å…¥æœ‰è¯¯ï¼Œæˆ–è€…ç½‘ç«™èµ„æºè¢«åˆ é™¤äº†      </span>|</span><br><span class="line">|<span class="string"> 405    </span>|<span class="string"> Method Not Allowed              </span>|<span class="string"> è¯·æ±‚æ–¹å¼æœ‰è¯¯ï¼Œæ¯”å¦‚åº”è¯¥ç”¨GETè¯·æ±‚æ–¹å¼çš„èµ„æºï¼Œç”¨äº†POST          </span>|</span><br><span class="line">|<span class="string"> 428    </span>|<span class="string"> Precondition Required           </span>|<span class="string"> æœåŠ¡å™¨è¦æ±‚æœ‰æ¡ä»¶çš„è¯·æ±‚ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯è¦æƒ³è®¿é—®è¯¥èµ„æºï¼Œå¿…é¡»æºå¸¦ç‰¹å®šçš„è¯·æ±‚å¤´ </span>|</span><br><span class="line">|<span class="string"> 429    </span>|<span class="string"> Too Many Requests               </span>|<span class="string"> æŒ‡ç¤ºç”¨æˆ·åœ¨ç»™å®šæ—¶é—´å†…å‘é€äº†å¤ªå¤šè¯·æ±‚ï¼ˆâ€œé™é€Ÿâ€ï¼‰ï¼Œé…åˆ Retry-After(å¤šé•¿æ—¶é—´åå¯ä»¥è¯·æ±‚)å“åº”å¤´ä¸€èµ·ä½¿ç”¨ </span>|</span><br><span class="line">|<span class="string"> 431    </span>|<span class="string"> Request Header Fields Too Large </span>|<span class="string"> è¯·æ±‚å¤´å¤ªå¤§ï¼ŒæœåŠ¡å™¨ä¸æ„¿æ„å¤„ç†è¯·æ±‚ï¼Œå› ä¸ºå®ƒçš„å¤´éƒ¨å­—æ®µå¤ªå¤§ã€‚è¯·æ±‚å¯ä»¥åœ¨å‡å°‘è¯·æ±‚å¤´åŸŸçš„å¤§å°åé‡æ–°æäº¤ã€‚ </span>|</span><br><span class="line">|<span class="string"> 500    </span>|<span class="string"> Internal Server Error           </span>|<span class="string"> æœåŠ¡å™¨å‘ç”Ÿä¸å¯é¢„æœŸçš„é”™è¯¯ã€‚æœåŠ¡å™¨å‡ºå¼‚å¸¸äº†ï¼Œèµ¶ç´§çœ‹æ—¥å¿—å»å§     </span>|</span><br><span class="line">|<span class="string"> 503    </span>|<span class="string"> Service Unavailable             </span>|<span class="string"> æœåŠ¡å™¨å°šæœªå‡†å¤‡å¥½å¤„ç†è¯·æ±‚ï¼ŒæœåŠ¡å™¨åˆšåˆšå¯åŠ¨ï¼Œè¿˜æœªåˆå§‹åŒ–å¥½       </span>|</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.javaæ“ä½œæ•°æ®åº“ï¼ˆMyBatisç¯‡ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 1.ä»‹ç»</span></span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯MyBatis?</span><br><span class="line"></span><br><span class="line">- MyBatisæ˜¯ä¸€æ¬¾ä¼˜ç§€çš„ <span class="symbol">*</span><span class="symbol">*</span>æŒä¹…å±‚<span class="symbol">*</span><span class="symbol">*</span><span class="symbol">*</span><span class="symbol">*</span>æ¡†æ¶<span class="symbol">*</span><span class="symbol">*</span>ï¼Œç”¨äºç®€åŒ–JDBCçš„å¼€å‘ã€‚</span><br><span class="line">- MyBatisæœ¬æ˜¯ Apacheçš„ä¸€ä¸ªå¼€æºé¡¹ç›®iBatisï¼Œ2010å¹´è¿™ä¸ªé¡¹ç›®ç”±apacheè¿ç§»åˆ°äº†google codeï¼Œå¹¶ä¸”æ”¹åä¸ºMyBatis ã€‚2013å¹´11æœˆè¿ç§»åˆ°Githubã€‚</span><br><span class="line">- å®˜ç½‘ï¼šhttps://mybatis.org/mybatis-3/zh/index.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- æŒä¹…å±‚ï¼šæŒ‡çš„æ˜¯å°±æ˜¯æ•°æ®è®¿é—®å±‚(dao)ï¼Œæ˜¯ç”¨æ¥æ“ä½œæ•°æ®åº“çš„ã€‚</span><br><span class="line"></span><br><span class="line">![img](https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-339.png)</span><br><span class="line"></span><br><span class="line">- æ¡†æ¶ï¼šæ˜¯ä¸€ä¸ªåŠæˆå“è½¯ä»¶ï¼Œæ˜¯ä¸€å¥—å¯é‡ç”¨çš„ã€é€šç”¨çš„ã€è½¯ä»¶åŸºç¡€ä»£ç æ¨¡å‹ã€‚åœ¨æ¡†æ¶çš„åŸºç¡€ä¸Šè¿›è¡Œè½¯ä»¶å¼€å‘æ›´åŠ é«˜æ•ˆã€è§„èŒƒã€é€šç”¨ã€å¯æ‹“å±•ã€‚</span><br><span class="line"></span><br><span class="line">mybatisçš„ä½œç”¨ï¼šé€šè¿‡Mybatiså°±å¯ä»¥å¤§å¤§<span class="symbol">*</span><span class="symbol">*</span>ç®€åŒ–åŸç”Ÿçš„JDBCç¨‹åºçš„ä»£ç ç¼–å†™<span class="symbol">*</span><span class="symbol">*</span>ï¼Œæ¯”å¦‚ é€šè¿‡ `select <span class="symbol">*</span> from user` æŸ¥è¯¢æ‰€æœ‰çš„ç”¨æˆ·æ•°æ®ï¼Œé€šè¿‡JDBCç¨‹åºæ“ä½œå‘¢ï¼Œéœ€è¦å¤§é‡çš„ä»£ç å®ç°ï¼Œè€Œå¦‚æœé€šè¿‡Mybatiså®ç°ç›¸åŒçš„åŠŸèƒ½ï¼Œåªéœ€è¦ç®€å•çš„ä¸‰å››è¡Œå°±å¯ä»¥æå®šã€‚</span><br><span class="line"></span><br><span class="line">![img](https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-258-1024x528.png)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 2.å…¥é—¨Mybatis</span></span><br><span class="line"></span><br><span class="line">éœ€æ±‚ï¼šä½¿ç”¨MybatisæŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·æ•°æ® ã€‚</span><br><span class="line"></span><br><span class="line"><span class="symbol">*</span><span class="symbol">*</span>1). åˆ›å»ºspringbootå·¥ç¨‹ï¼Œå¹¶å¯¼å…¥ mybatisçš„èµ·æ­¥ä¾èµ–ã€mysqlçš„é©±åŠ¨åŒ…ã€lombokã€‚<span class="symbol">*</span><span class="symbol">*</span></span><br><span class="line"></span><br><span class="line">é¡¹ç›®å·¥ç¨‹åˆ›å»ºå®Œæˆåï¼Œè‡ªåŠ¨åœ¨pom.xmlæ–‡ä»¶ä¸­ï¼Œå¯¼å…¥Mybatisä¾èµ–å’ŒMySQLé©±åŠ¨ä¾èµ–ã€‚å¦‚ä¸‹æ‰€ç¤º</span><br><span class="line"></span><br><span class="line">![img](https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-259-1024x592.png)</span><br><span class="line"></span><br><span class="line"><span class="symbol">*</span><span class="symbol">*</span>2). æ•°æ®å‡†å¤‡ï¼šåˆ›å»ºç”¨æˆ·è¡¨userï¼Œå¹¶åˆ›å»ºå¯¹åº”çš„å®ä½“ç±»Userã€‚<span class="symbol">*</span><span class="symbol">*</span></span><br><span class="line"></span><br><span class="line">ç”¨æˆ·è¡¨</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>create table user(<br>id int unsigned primary key auto_increment comment â€˜ID,ä¸»é”®â€™,<br>username varchar(20) comment â€˜ç”¨æˆ·åâ€™,<br>password varchar(32) comment â€˜å¯†ç â€™,<br>name varchar(10) comment â€˜å§“åâ€™,<br>age tinyint unsigned comment â€˜å¹´é¾„â€™<br>) comment â€˜ç”¨æˆ·è¡¨â€™;</p><p>insert into user(id, username, password, name, age) values (1, â€˜daqiaoâ€™, â€˜123456â€™, â€˜å¤§ä¹”â€™, 22),<br>(2, â€˜xiaoqiaoâ€™, â€˜123456â€™, â€˜å°ä¹”â€™, 18),<br>(3, â€˜diaochanâ€™, â€˜123456â€™, â€˜è²‚è‰â€™, 24),<br>(4, â€˜lvbuâ€™, â€˜123456â€™, â€˜å•å¸ƒâ€™, 28),<br>(5, â€˜zhaoyunâ€™, â€˜12345678â€™, â€˜èµµäº‘â€™, 27);</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">å®ä½“ç±»æ”¾åœ¨ `com.itheima.pojo` åŒ…ä¸‹</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>@Data<br>@NoArgsConstructor<br>@AllArgsConstructor<br>public class User {<br>private Integer id; //ID<br>private String username; //ç”¨æˆ·å<br>private String password; //å¯†ç <br>private String name; //å§“å<br>private Integer age; //å¹´é¾„<br>}</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**<span class="number">3</span>). é…ç½®Mybatis**</span><br><span class="line"></span><br><span class="line">åœ¨ `application.properties` ä¸­é…ç½®æ•°æ®åº“çš„è¿æ¥ä¿¡æ¯ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>#æ•°æ®åº“è®¿é—®çš„urlåœ°å€<br>spring.datasource.url=jdbc:mysql://localhost:3306/web<br>#æ•°æ®åº“é©±åŠ¨ç±»ç±»å<br>spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver<br>#è®¿é—®æ•°æ®åº“-ç”¨æˆ·å<br>spring.datasource.username=root<br>#è®¿é—®æ•°æ®åº“-å¯†ç <br>spring.datasource.password=123456</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**<span class="number">4</span>). ç¼–å†™Mybatisç¨‹åºï¼šç¼–å†™Mybatisçš„æŒä¹…å±‚æ¥å£ï¼Œå®šä¹‰SQLè¯­å¥ï¼ˆæ³¨è§£ï¼‰**</span><br><span class="line"></span><br><span class="line">åœ¨åˆ›å»ºå‡ºæ¥çš„springbootå·¥ç¨‹ä¸­ï¼Œåœ¨å¼•å¯¼ç±»æ‰€åœ¨åŒ…ä¸‹ï¼Œåœ¨åˆ›å»ºä¸€ä¸ªåŒ… `mapper` ã€‚åœ¨ `mapper` åŒ…ä¸‹åˆ›å»ºä¸€ä¸ªæ¥å£ `UserMapper` ï¼Œè¿™æ˜¯ä¸€ä¸ªæŒä¹…å±‚æ¥å£ï¼ˆMybatisçš„æŒä¹…å±‚æ¥å£è§„èŒƒä¸€èˆ¬éƒ½å« XxxMapperï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">UserMapperæ¥å£çš„å†…å®¹å¦‚ä¸‹ï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>import com.itheima.pojo.User;<br>import org.apache.ibatis.annotations.Mapper;<br>import org.apache.ibatis.annotations.Select;<br>import java.util.List;</p><p>@Mapper<br>public interface UserMapper {<br>/**<br>* æŸ¥è¯¢å…¨éƒ¨<br>*/<br>@Select(â€œselect * from userâ€)<br>public List<User> findAll();<br>}</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">-</span> @Mapperæ³¨è§£ï¼šè¡¨ç¤ºæ˜¯mybatisä¸­çš„Mapperæ¥å£ï¼Œç¨‹åºè¿è¡Œæ—¶ï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨ç”Ÿæˆæ¥å£çš„å®ç°ç±»å¯¹è±¡(ä»£ç†å¯¹è±¡)ï¼Œå¹¶äº¤ç»™Springçš„IOCå®¹å™¨ç®¡ç†</span><br><span class="line"><span class="bullet">-</span> @Selectæ³¨è§£ï¼šä»£è¡¨çš„å°±æ˜¯selectæŸ¥è¯¢ï¼Œç”¨äºä¹¦å†™selectæŸ¥è¯¢è¯­å¥</span><br><span class="line"></span><br><span class="line"><span class="strong">**5). å•å…ƒæµ‹è¯•**</span></span><br><span class="line"></span><br><span class="line">åœ¨åˆ›å»ºå‡ºæ¥çš„SpringBootå·¥ç¨‹ä¸­ï¼Œåœ¨srcä¸‹çš„testç›®å½•ä¸‹ï¼Œå·²ç»è‡ªåŠ¨å¸®æˆ‘ä»¬åˆ›å»ºå¥½äº†æµ‹è¯•ç±» ï¼Œå¹¶ä¸”åœ¨æµ‹è¯•ç±»ä¸Šå·²ç»æ·»åŠ äº†æ³¨è§£ <span class="code">`@SpringBootTest`</span>ï¼Œä»£è¡¨è¯¥æµ‹è¯•ç±»å·²ç»ä¸SpringBootæ•´åˆã€‚</span><br><span class="line"></span><br><span class="line">è¯¥æµ‹è¯•ç±»åœ¨è¿è¡Œæ—¶ï¼Œä¼šè‡ªåŠ¨é€šè¿‡å¼•å¯¼ç±»åŠ è½½Springçš„ç¯å¢ƒï¼ˆIOCå®¹å™¨ï¼‰ã€‚æˆ‘ä»¬è¦æµ‹è¯•é‚£ä¸ªbeanå¯¹è±¡ï¼Œå°±å¯ä»¥ç›´æ¥é€šè¿‡<span class="code">`@Autowired`</span>æ³¨è§£ç›´æ¥å°†å…¶æ³¨å…¥è¿›è¡Œï¼Œç„¶åå°±å¯ä»¥æµ‹è¯•äº†ã€‚</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-260-1024x554.png</span>)</span><br><span class="line"></span><br><span class="line"><span class="section">#### <span class="strong">**Mybatisä¸JDBCçš„å¯¹æ¯”**</span></span></span><br><span class="line"></span><br><span class="line">JDBCç¨‹åºçš„<span class="strong">**ç¼ºç‚¹**</span>ï¼š</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> urlã€usernameã€password ç­‰ç›¸å…³å‚æ•°å…¨éƒ¨ç¡¬ç¼–ç åœ¨javaä»£ç ä¸­ã€‚</span><br><span class="line"><span class="bullet">-</span> æŸ¥è¯¢ç»“æœçš„è§£æã€å°è£…æ¯”è¾ƒç¹çã€‚</span><br><span class="line"><span class="bullet">-</span> æ¯ä¸€æ¬¡æ“ä½œæ•°æ®åº“ä¹‹å‰ï¼Œå…ˆè·å–è¿æ¥ï¼Œæ“ä½œå®Œæ¯•ä¹‹åï¼Œå…³é—­è¿æ¥ã€‚ é¢‘ç¹çš„è·å–è¿æ¥ã€é‡Šæ”¾è¿æ¥é€ æˆèµ„æºæµªè´¹ã€‚</span><br><span class="line"></span><br><span class="line">åˆ†æäº†JDBCçš„ç¼ºç‚¹ä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹åœ¨mybatisä¸­ï¼Œæ˜¯å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜çš„ï¼š</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> æ•°æ®åº“è¿æ¥å››è¦ç´ (é©±åŠ¨ã€é“¾æ¥ã€ç”¨æˆ·åã€å¯†ç )ï¼Œéƒ½é…ç½®åœ¨springbooté»˜è®¤çš„é…ç½®æ–‡ä»¶ application.propertiesä¸­</span><br><span class="line"><span class="bullet">-</span> æŸ¥è¯¢ç»“æœçš„è§£æåŠå°è£…ï¼Œç”±mybatisè‡ªåŠ¨å®Œæˆæ˜ å°„å°è£…ï¼Œæˆ‘ä»¬æ— éœ€å…³æ³¨</span><br><span class="line"><span class="bullet">-</span> åœ¨mybatisä¸­ä½¿ç”¨äº†æ•°æ®åº“è¿æ¥æ± æŠ€æœ¯ï¼Œä»è€Œé¿å…äº†é¢‘ç¹çš„åˆ›å»ºè¿æ¥ã€é”€æ¯è¿æ¥è€Œå¸¦æ¥çš„èµ„æºæµªè´¹ã€‚</span><br><span class="line"></span><br><span class="line"><span class="section">## 3.æ•°æ®åº“è¿æ¥æ± </span></span><br><span class="line"></span><br><span class="line">åœ¨å‰é¢æˆ‘ä»¬æ‰€è®²è§£çš„mybatisä¸­ï¼Œä½¿ç”¨äº†æ•°æ®åº“è¿æ¥æ± æŠ€æœ¯ï¼Œé¿å…é¢‘ç¹çš„åˆ›å»ºè¿æ¥ã€é”€æ¯è¿æ¥è€Œå¸¦æ¥çš„èµ„æºæµªè´¹ã€‚</span><br><span class="line"></span><br><span class="line">ä¸‹é¢æˆ‘ä»¬å°±å…·ä½“çš„äº†è§£ä¸‹æ•°æ®åº“è¿æ¥æ± ã€‚</span><br><span class="line"></span><br><span class="line"><span class="section">### 3.1 ä»‹ç»</span></span><br><span class="line"></span><br><span class="line">1). æ²¡æœ‰æ•°æ®åº“è¿æ¥æ± çš„æƒ…å†µ</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-340.png</span>)</span><br><span class="line"></span><br><span class="line">å®¢æˆ·ç«¯æ‰§è¡ŒSQLè¯­å¥ï¼šè¦å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥å¯¹è±¡ï¼Œç„¶åæ‰§è¡ŒSQLè¯­å¥ï¼ŒSQLè¯­å¥æ‰§è¡Œååˆéœ€è¦å…³é—­è¿æ¥å¯¹è±¡ä»è€Œé‡Šæ”¾èµ„æºï¼Œæ¯æ¬¡æ‰§è¡ŒSQLæ—¶éƒ½éœ€è¦<span class="strong">**åˆ›å»ºè¿æ¥ã€é”€æ¯é“¾æ¥**</span>ï¼Œè¿™ç§é¢‘ç¹çš„é‡å¤åˆ›å»ºé”€æ¯çš„è¿‡ç¨‹æ˜¯æ¯”è¾ƒè€—è´¹è®¡ç®—æœºçš„æ€§èƒ½ã€‚</span><br><span class="line"></span><br><span class="line">2). æœ‰æ•°æ®åº“è¿æ¥æ± çš„æƒ…å†µ</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-341.png</span>)</span><br><span class="line"></span><br><span class="line">æ•°æ®åº“è¿æ¥æ± æ˜¯ä¸ªå®¹å™¨ï¼Œè´Ÿè´£åˆ†é…ã€ç®¡ç†æ•°æ®åº“è¿æ¥(Connection)</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> ç¨‹åºåœ¨å¯åŠ¨æ—¶ï¼Œä¼šåœ¨æ•°æ®åº“è¿æ¥æ± (å®¹å™¨)ä¸­ï¼Œåˆ›å»ºä¸€å®šæ•°é‡çš„Connectionå¯¹è±¡</span><br><span class="line"></span><br><span class="line">å…è®¸åº”ç”¨ç¨‹åºé‡å¤ä½¿ç”¨ä¸€ä¸ªç°æœ‰çš„æ•°æ®åº“è¿æ¥ï¼Œè€Œä¸æ˜¯å†é‡æ–°å»ºç«‹ä¸€ä¸ª</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> å®¢æˆ·ç«¯åœ¨æ‰§è¡ŒSQLæ—¶ï¼Œå…ˆä»è¿æ¥æ± ä¸­è·å–ä¸€ä¸ªConnectionå¯¹è±¡ï¼Œç„¶ååœ¨æ‰§è¡ŒSQLè¯­å¥ï¼ŒSQLè¯­å¥æ‰§è¡Œå®Œä¹‹åï¼Œé‡Šæ”¾Connectionæ—¶å°±ä¼šæŠŠConnectionå¯¹è±¡å½’è¿˜ç»™è¿æ¥æ± ï¼ˆConnectionå¯¹è±¡å¯ä»¥å¤ç”¨ï¼‰</span><br><span class="line"></span><br><span class="line">é‡Šæ”¾ç©ºé—²æ—¶é—´è¶…è¿‡æœ€å¤§ç©ºé—²æ—¶é—´çš„è¿æ¥ï¼Œæ¥é¿å…å› ä¸ºæ²¡æœ‰é‡Šæ”¾è¿æ¥è€Œå¼•èµ·çš„æ•°æ®åº“è¿æ¥é—æ¼</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> å®¢æˆ·ç«¯è·å–åˆ°Connectionå¯¹è±¡äº†ï¼Œä½†æ˜¯Connectionå¯¹è±¡å¹¶æ²¡æœ‰å»è®¿é—®æ•°æ®åº“(å¤„äºç©ºé—²)ï¼Œæ•°æ®åº“è¿æ¥æ± å‘ç°Connectionå¯¹è±¡çš„ç©ºé—²æ—¶é—´ &gt; è¿æ¥æ± ä¸­é¢„è®¾çš„æœ€å¤§ç©ºé—²æ—¶é—´ï¼Œæ­¤æ—¶æ•°æ®åº“è¿æ¥æ± å°±ä¼šè‡ªåŠ¨é‡Šæ”¾æ‰è¿™ä¸ªè¿æ¥å¯¹è±¡</span><br><span class="line"></span><br><span class="line">æ•°æ®åº“è¿æ¥æ± çš„å¥½å¤„ï¼š</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> èµ„æºé‡ç”¨</span><br><span class="line"><span class="bullet">-</span> æå‡ç³»ç»Ÿå“åº”é€Ÿåº¦</span><br><span class="line"><span class="bullet">-</span> é¿å…æ•°æ®åº“è¿æ¥é—æ¼</span><br><span class="line"></span><br><span class="line"><span class="section">### 3.2å¸‚é¢ä¸Šä¸åŒçš„è¿æ¥æ± </span></span><br><span class="line"></span><br><span class="line">å¸¸è§çš„æ•°æ®åº“è¿æ¥æ± ï¼š<span class="strong">**C3P0 ã€DBCP ã€Druid ã€Hikari (springbooté»˜è®¤)**</span></span><br><span class="line"></span><br><span class="line">ç°åœ¨ä½¿ç”¨æ›´å¤šçš„æ˜¯ï¼š<span class="strong">**Hikariã€Druid ï¼ˆæ€§èƒ½æ›´ä¼˜è¶Šï¼‰**</span></span><br><span class="line"></span><br><span class="line"><span class="strong">**). Hikariï¼ˆè¿½å…‰è€…ï¼‰ [é»˜è®¤çš„è¿æ¥æ± ]**</span></span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-342-1024x391.png</span>)</span><br><span class="line"></span><br><span class="line">ä»æ§åˆ¶å°è¾“å‡ºçš„æ—¥å¿—ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œspringbootåº•å±‚é»˜è®¤ä½¿ç”¨çš„æ•°æ®åº“è¿æ¥æ± å°±æ˜¯ Hikariã€‚</span><br><span class="line"></span><br><span class="line"><span class="strong">**2). Druidï¼ˆå¾·é²ä¼Šï¼‰**</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> Druidè¿æ¥æ± æ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„æ•°æ®åº“è¿æ¥æ± é¡¹ç›®</span><br><span class="line"><span class="bullet">-</span> åŠŸèƒ½å¼ºå¤§ï¼Œæ€§èƒ½ä¼˜ç§€ï¼Œæ˜¯Javaè¯­è¨€æœ€å¥½çš„æ•°æ®åº“è¿æ¥æ± ä¹‹ä¸€</span><br><span class="line"></span><br><span class="line">å¦‚æœæˆ‘ä»¬æƒ³æŠŠé»˜è®¤çš„æ•°æ®åº“è¿æ¥æ± åˆ‡æ¢ä¸ºDruidæ•°æ®åº“è¿æ¥æ± ï¼Œåªéœ€è¦å®Œæˆä»¥ä¸‹ä¸¤æ­¥æ“ä½œå³å¯ï¼š</span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; å‚è€ƒå®˜æ–¹åœ°å€ï¼šhttps://github.com/alibaba/druid/tree/master/druid-spring-boot-starter</span></span><br><span class="line"><span class="quote">&gt;</span></span><br><span class="line"><span class="quote">&gt; â‘ . åœ¨`pom.xml`æ–‡ä»¶ä¸­å¼•å…¥ä¾èµ–</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><blockquote><dependency>    <!-- Druidè¿æ¥æ± ä¾èµ– -->    <groupId>com.alibaba</groupId>    <artifactId>druid-spring-boot-starter</artifactId>    <version>1.2.19</version></dependency><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">â‘¡.åœ¨`application.properties`ä¸­å¼•å…¥æ•°æ®åº“è¿æ¥é…ç½®</span><br><span class="line"></span><br></pre></td></tr></table></figure>spring.datasource.type=com.alibaba.druid.pool.DruidDataSourcespring.datasource.url=jdbc:mysql://localhost:3306/webspring.datasource.driver-class-name=com.mysql.cj.jdbc.Driverspring.datasource.username=rootspring.datasource.password=1233<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## <span class="number">4.</span>Mybatisçš„å¢åˆ æ”¹æŸ¥</span><br><span class="line"></span><br><span class="line">### <span class="number">4.1</span>åˆ é™¤</span><br><span class="line"></span><br><span class="line">- éœ€æ±‚ï¼šæ ¹æ®IDåˆ é™¤ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">- SQLï¼šdelete <span class="keyword">from</span> user <span class="keyword">where</span> id = <span class="number">5</span>;</span><br><span class="line">- Mapperæ¥å£æ–¹æ³•ï¼š</span><br><span class="line"> - æ–¹å¼ä¸€ï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure></blockquote><p>/**</p><ul><li>æ ¹æ®idåˆ é™¤<br>*/<br>@Delete(â€œdelete from user where id = 5â€)<br>public void deleteById();</li></ul><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">è¿™ç§æ–¹å¼æ‰§è¡Œåˆ é™¤æ“ä½œï¼Œè°ƒç”¨deleteByIdæ–¹æ³•åªèƒ½åˆ é™¤<span class="built_in">id</span>ä¸º<span class="number">5</span>çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå› ä¸ºå°†<span class="built_in">id</span>ç›´æ¥å†™æ­»åœ¨ä»£ç ä¸­äº†ï¼Œä¸å¯å–ã€‚</span><br><span class="line"></span><br><span class="line">- æ–¹å¼äºŒï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>/** * æ ¹æ®idåˆ é™¤ */<br>@Delete(â€œdelete from user where id = #{id}â€)<br>public void deleteById(Integer id);</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">åœ¨Mybatisä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<span class="strong">**å‚æ•°å ä½ç¬¦å·**</span> <span class="code">`#&#123;...&#125;`</span> æ¥å ä½ï¼Œåœ¨è°ƒç”¨<span class="code">`deleteById`</span>æ–¹æ³•æ—¶ï¼Œä¼ é€’çš„å‚æ•°å€¼ï¼Œæœ€ç»ˆä¼šæ›¿æ¢å ä½ç¬¦ã€‚</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-261-1024x473.png</span>)</span><br><span class="line"></span><br><span class="line">è¿è¡Œä¹‹åï¼Œæˆ‘ä»¬å‘ç°ï¼Œ<span class="code">`#&#123;...&#125;`</span> å ä½ç¬¦ï¼Œå…¶å®æœ€ç»ˆè¢«æ›¿æ¢æˆäº† ï¼Ÿå ä½ç¬¦ï¼Œç”Ÿæˆçš„æ˜¯é¢„ç¼–è¯‘çš„SQLè¯­å¥ã€‚ã€æ¨èã€‘</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> DMLè¯­å¥æ‰§è¡Œå®Œæ¯•ï¼Œæ˜¯æœ‰è¿”å›å€¼çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºMapperæ¥å£æ–¹æ³•å®šä¹‰è¿”å›å€¼æ¥æ¥æ”¶ï¼Œå¦‚ä¸‹ï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>/**</p><ul><li>æ ¹æ®idåˆ é™¤<br>*/<br>@Delete(â€œdelete from user where id = #{id}â€)<br>public Integer deleteById(Integer id);</li></ul><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Integerç±»å‹çš„è¿”å›å€¼ï¼Œè¡¨ç¤ºDMLè¯­å¥æ‰§è¡Œå®Œæ¯•å½±å“çš„è®°å½•æ•°ã€‚</span><br><span class="line"></span><br><span class="line">- Mybatisçš„æä¾›çš„ç¬¦å·ï¼Œæœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ `<span class="comment">#&#123;...&#125;`ï¼Œå¦ä¸€ä¸ªæ˜¯ `$&#123;...&#125;`ï¼ŒåŒºåˆ«å¦‚ä¸‹ï¼š</span></span><br><span class="line"></span><br><span class="line">|<span class="string"> ç¬¦å· </span>|<span class="string"> è¯´æ˜                                                   </span>|<span class="string"> åœºæ™¯                       </span>|<span class="string"> ä¼˜ç¼ºç‚¹                </span>|</span><br><span class="line">|<span class="string"> ---- </span>|<span class="string"> ------------------------------------------------------ </span>|<span class="string"> -------------------------- </span>|<span class="string"> --------------------- </span>|</span><br><span class="line">|<span class="string"> #&#123;â€¦&#125; </span>|<span class="string"> å ä½ç¬¦ã€‚æ‰§è¡Œæ—¶ï¼Œä¼šå°†#&#123;â€¦&#125;æ›¿æ¢ä¸º?ï¼Œç”Ÿæˆé¢„ç¼–è¯‘SQL         </span>|<span class="string"> å‚æ•°å€¼ä¼ é€’                 </span>|<span class="string"> å®‰å…¨ã€æ€§èƒ½é«˜ ï¼ˆæ¨èï¼‰ </span>|</span><br><span class="line">|<span class="string"> $&#123;â€¦&#125; </span>|<span class="string"> æ‹¼æ¥ç¬¦ã€‚ç›´æ¥å°†å‚æ•°æ‹¼æ¥åœ¨SQLè¯­å¥ä¸­ï¼Œ**å­˜åœ¨SQLæ³¨å…¥é—®é¢˜** </span>|<span class="string"> è¡¨åã€å­—æ®µååŠ¨æ€è®¾ç½®æ—¶ä½¿ç”¨ </span>|<span class="string"> ä¸å®‰å…¨ã€æ€§èƒ½ä½        </span>|</span><br><span class="line"></span><br><span class="line"><span class="comment">### 4.2æ–°å¢</span></span><br><span class="line"></span><br><span class="line">- éœ€æ±‚ï¼šæ·»åŠ ä¸€ä¸ªç”¨æˆ·</span><br><span class="line">- SQLï¼šinsert into user(username,password,name,age) values(&#x27;zhouyu&#x27;,&#x27;123456&#x27;,&#x27;å‘¨ç‘œ&#x27;,20);</span><br><span class="line">- Mapperæ¥å£ï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>/**</p><ul><li>æ·»åŠ ç”¨æˆ·<br>*/<br>@Insert(â€œinsert into user(username,password,name,age) values(#{username},#{password},#{name},#{age})â€)<br>public void insert(User user);</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">å¦‚æœåœ¨<span class="keyword">SQL</span>è¯­å¥ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¼ é€’å¤šä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå¤šä¸ªå‚æ•°å°è£…åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ã€‚ç„¶ååœ¨<span class="keyword">SQL</span>è¯­å¥ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡`#&#123;å¯¹è±¡å±æ€§å&#125;`çš„æ–¹å¼ï¼Œè·å–åˆ°å¯¹è±¡ä¸­å°è£…çš„å±æ€§å€¼ã€‚</span><br><span class="line"></span><br><span class="line">### <span class="number">4.3</span>ä¿®æ”¹</span><br><span class="line"></span><br><span class="line">- éœ€æ±‚ï¼šæ ¹æ®IDæ›´æ–°ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">- <span class="keyword">SQL</span>ï¼š<span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> username = <span class="string">&#x27;zhouyu&#x27;</span>, <span class="keyword">password</span> = <span class="string">&#x27;123456&#x27;</span>, <span class="type">name</span> = <span class="string">&#x27;å‘¨ç‘œ&#x27;</span>, age = <span class="number">20</span> <span class="keyword">where</span> id = <span class="number">1</span>ï¼›</span><br><span class="line">- Mapperæ¥å£æ–¹æ³•ï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>/**</p><ul><li>æ ¹æ®idæ›´æ–°ç”¨æˆ·ä¿¡æ¯<br>*/<br>@Update(â€œupdate user set username = #{username},password = #{password},name = #{name},age = #{age} where id = #{id}â€)<br>public void update(User user);</li></ul><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### <span class="number">4.4</span>æŸ¥è¯¢</span><br><span class="line"></span><br><span class="line">- éœ€æ±‚ï¼šæ ¹æ®ç”¨æˆ·åå’Œå¯†ç æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">- SQLï¼šselect*fromuser whereusername = <span class="string">&#x27;zhouyu&#x27;</span> and password = <span class="string">&#x27;123456&#x27;</span></span><br><span class="line">- Mapperæ¥å£æ–¹æ³•ï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>/**</p><ul><li>æ ¹æ®ç”¨æˆ·åå’Œå¯†ç æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯<br>*/<br>@Select(â€œselect * from user where username = #{username} and password = #{password}â€)<br>public User findByUsernameAndPassword(@Param(â€œusernameâ€) String username, @Param(â€œpasswordâ€) String password);</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="strong">**è¯´æ˜ï¼š**</span>åŸºäºå®˜æ–¹éª¨æ¶åˆ›å»ºçš„springbooté¡¹ç›®ä¸­ï¼Œæ¥å£ç¼–è¯‘æ—¶ä¼šä¿ç•™æ–¹æ³•å½¢å‚åï¼Œ@Paramæ³¨è§£å¯ä»¥çœç•¥ (#&#123;å½¢å‚å&#125;)ã€‚</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-263-1024x124.png</span>)</span><br><span class="line"></span><br><span class="line"><span class="section">## 5.XMLæ˜ å°„é…ç½®</span></span><br><span class="line"></span><br><span class="line">Mybatisçš„å¼€å‘æœ‰ä¸¤ç§æ–¹å¼ï¼š</span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> æ³¨è§£</span><br><span class="line"><span class="bullet">2.</span> XML</span><br><span class="line"></span><br><span class="line"><span class="section">### 5.1XMLé…ç½®æ–‡ä»¶è§„èŒƒ</span></span><br><span class="line"></span><br><span class="line">ä½¿ç”¨Mybatisçš„æ³¨è§£æ–¹å¼ï¼Œä¸»è¦æ˜¯æ¥å®Œæˆä¸€äº›ç®€å•çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½ã€‚å¦‚æœéœ€è¦å®ç°å¤æ‚çš„SQLåŠŸèƒ½ï¼Œå»ºè®®ä½¿ç”¨XMLæ¥é…ç½®æ˜ å°„è¯­å¥ï¼Œä¹Ÿå°±æ˜¯å°†SQLè¯­å¥å†™åœ¨XMLé…ç½®æ–‡ä»¶ä¸­ã€‚</span><br><span class="line"></span><br><span class="line"><span class="strong">**åœ¨Mybatisä¸­ä½¿ç”¨XMLæ˜ å°„æ–‡ä»¶æ–¹å¼å¼€å‘ï¼Œéœ€è¦ç¬¦åˆä¸€å®šçš„è§„èŒƒï¼š**</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> XMLæ˜ å°„æ–‡ä»¶çš„åç§°ä¸Mapperæ¥å£åç§°ä¸€è‡´ï¼Œå¹¶ä¸”å°†XMLæ˜ å°„æ–‡ä»¶å’ŒMapperæ¥å£æ”¾ç½®åœ¨ç›¸åŒåŒ…ä¸‹ï¼ˆåŒåŒ…åŒåï¼‰</span><br><span class="line"><span class="bullet">2.</span> XMLæ˜ å°„æ–‡ä»¶çš„namespaceå±æ€§ä¸ºMapperæ¥å£å…¨é™å®šåä¸€è‡´</span><br><span class="line"><span class="bullet">3.</span> XMLæ˜ å°„æ–‡ä»¶ä¸­sqlè¯­å¥çš„idä¸Mapperæ¥å£ä¸­çš„æ–¹æ³•åä¸€è‡´ï¼Œå¹¶ä¿æŒè¿”å›ç±»å‹ä¸€è‡´ã€‚</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-264-1024x327.png</span>)</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">select</span>&gt;</span></span>æ ‡ç­¾ï¼šå°±æ˜¯ç”¨äºç¼–å†™selectæŸ¥è¯¢è¯­å¥çš„ã€‚</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> resultTypeå±æ€§ï¼ŒæŒ‡çš„æ˜¯æŸ¥è¯¢è¿”å›çš„å•æ¡è®°å½•æ‰€å°è£…çš„ç±»å‹ã€‚</span><br><span class="line"></span><br><span class="line"><span class="section">### 5.2XMLé…ç½®æ–‡ä»¶å®ç°</span></span><br><span class="line"></span><br><span class="line"><span class="strong">**ç¬¬1æ­¥ï¼š åˆ›å»ºXMLæ˜ å°„æ–‡ä»¶**</span></span><br><span class="line"></span><br><span class="line"><span class="strong">**ç¬¬2æ­¥ï¼šç¼–å†™XMLæ˜ å°„æ–‡ä»¶**</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><?xml version="1.0" encoding="UTF-8" ?><!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "https://mybatis.org/dtd/mybatis-3-mapper.dtd"><mapper namespace=""></mapper><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**ç¬¬<span class="number">3</span>æ­¥ï¼šé…ç½®**</span><br><span class="line"></span><br><span class="line">**a. XMLæ˜ å°„æ–‡ä»¶çš„<span class="keyword">namespace</span>å±æ€§ä¸º<span class="symbol">Mapper</span>æ¥å£å…¨é™å®šå**</span><br><span class="line"></span><br></pre></td></tr></table></figure><?xml version="1.0" encoding="UTF-8" ?><!DOCTYPE mapper        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"        "https://mybatis.org/dtd/mybatis-3-mapper.dtd"><mapper namespace="com.itheima.mapper.UserMapper"></mapper><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**b. <span class="type">XML</span>æ˜ å°„æ–‡ä»¶ä¸­<span class="keyword">sql</span>è¯­å¥çš„idä¸Mapperæ¥å£ä¸­çš„æ–¹æ³•åä¸€è‡´ï¼Œå¹¶ä¿æŒè¿”å›ç±»å‹ä¸€è‡´**</span><br><span class="line"></span><br></pre></td></tr></table></figure><?xml version="1.0" encoding="UTF-8" ?><!DOCTYPE mapper        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"        "https://mybatis.org/dtd/mybatis-3-mapper.dtd"><mapper namespace="com.itheima.mapper.EmpMapper"><pre><code>&lt;!--æŸ¥è¯¢æ“ä½œ--&gt;&lt;select id=&quot;findAll&quot; resultType=&quot;com.itheima.pojo.User&quot;&gt;    select * from user&lt;/select&gt;</code></pre></mapper><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">resultType å±æ€§çš„å€¼ï¼Œä¸æŸ¥è¯¢è¿”å›çš„å•æ¡è®°å½•å°è£…çš„ç±»å‹ä¸€è‡´ã€‚</span><br><span class="line"></span><br><span class="line">è¿è¡Œæµ‹è¯•ç±»ï¼Œæ‰§è¡Œç»“æœã€‚</span><br><span class="line"></span><br><span class="line"><span class="section">### 5.3MybatisXä»‹ç»</span></span><br><span class="line"></span><br><span class="line">å¯ä»¥é€šè¿‡MybatisXå¿«é€Ÿå®šä½ï¼š</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-265.png</span>)</span><br><span class="line"></span><br><span class="line">å­¦ä¹ äº†Mybatisä¸­XMLé…ç½®æ–‡ä»¶çš„å¼€å‘æ–¹å¼äº†ï¼Œå¯èƒ½ä¼šå­˜åœ¨ä¸€ä¸ªç–‘é—®ï¼šåˆ°åº•æ˜¯ä½¿ç”¨æ³¨è§£æ–¹å¼å¼€å‘è¿˜æ˜¯ä½¿ç”¨XMLæ–¹å¼å¼€å‘ï¼Ÿ</span><br><span class="line"></span><br><span class="line"><span class="strong">**ç»“è®ºï¼š**</span>ä½¿ç”¨Mybatisçš„æ³¨è§£ï¼Œä¸»è¦æ˜¯æ¥å®Œæˆä¸€äº›ç®€å•çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½ã€‚å¦‚æœéœ€è¦å®ç°å¤æ‚çš„SQLåŠŸèƒ½ï¼Œå»ºè®®ä½¿ç”¨XMLæ¥é…ç½®æ˜ å°„è¯­å¥ã€‚</span><br><span class="line"></span><br><span class="line"><span class="section">## 6.SpringBooté…ç½®æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="section">### 6.1ä»‹ç»</span></span><br><span class="line"></span><br><span class="line">å‰é¢æˆ‘ä»¬ä¸€ç›´ä½¿ç”¨springbooté¡¹ç›®åˆ›å»ºå®Œæ¯•åè‡ªå¸¦çš„<span class="code">`application.properties`</span>è¿›è¡Œå±æ€§çš„é…ç½®ï¼Œè€Œå¦‚æœåœ¨é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®å¤§é‡çš„å±æ€§ï¼Œé‡‡ç”¨propertiesé…ç½®æ–‡ä»¶è¿™ç§ <span class="code">`key=value`</span> çš„é…ç½®å½¢å¼ï¼Œå°±ä¼šæ˜¾å¾—é…ç½®æ–‡ä»¶çš„å±‚çº§ç»“æ„ä¸æ¸…æ™°ï¼Œä¹Ÿæ¯”è¾ƒè‡ƒè‚¿ã€‚</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-343-1024x494.png</span>)</span><br><span class="line"></span><br><span class="line">æ¥ä¸‹æ¥è¦è®²è§£çš„ymlæ ¼å¼çš„é…ç½®æ–‡ä»¶ã€‚ymlæ ¼å¼é…ç½®æ–‡ä»¶åå­—ä¸ºï¼š<span class="code">`application.yaml`</span> , <span class="code">`application.yml`</span> è¿™ä¸¤ä¸ªé…ç½®æ–‡ä»¶çš„åç¼€åè™½ç„¶ä¸ä¸€æ ·ï¼Œä½†æ˜¯é‡Œé¢é…ç½®çš„å†…å®¹å½¢å¼éƒ½æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚</span><br><span class="line"></span><br><span class="line">æˆ‘ä»¬å¯ä»¥æ¥å¯¹æ¯”ä¸€ä¸‹ï¼Œé‡‡ç”¨ <span class="code">`application.properties`</span> å’Œ <span class="code">`application.yml`</span> æ¥é…ç½®åŒä¸€æ®µä¿¡æ¯(æ•°æ®åº“è¿æ¥ä¿¡æ¯)ï¼Œä¸¤è€…ä¹‹é—´çš„é…ç½®å¯¹æ¯”ï¼š</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-268-1024x203.png</span>)</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-269-1024x265.png</span>)</span><br><span class="line"></span><br><span class="line">åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æ¨èä½¿ç”¨application.ymlé…ç½®æ–‡ä»¶æ¥é…ç½®ä¿¡æ¯ï¼Œç®€æ´ã€æ˜äº†ã€ä»¥æ•°æ®ä¸ºä¸­å¿ƒ</span><br><span class="line"></span><br><span class="line"><span class="section">### 6.2ymlé…ç½®æ–‡ä»¶çš„åŸºæœ¬è¯­æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> å¤§å°å†™æ•æ„Ÿ</span><br><span class="line"><span class="bullet">-</span> æ•°å€¼å‰è¾¹å¿…é¡»æœ‰ç©ºæ ¼ï¼Œä½œä¸ºåˆ†éš”ç¬¦</span><br><span class="line"><span class="bullet">-</span> ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»ï¼Œç¼©è¿›æ—¶ï¼Œä¸å…è®¸ä½¿ç”¨Tabé”®ï¼Œåªèƒ½ç”¨ç©ºæ ¼ï¼ˆideaä¸­ä¼šè‡ªåŠ¨å°†Tabè½¬æ¢ä¸ºç©ºæ ¼ï¼‰</span><br><span class="line"><span class="bullet">-</span> ç¼©è¿›çš„ç©ºæ ¼æ•°ç›®ä¸é‡è¦ï¼Œåªè¦ç›¸åŒå±‚çº§çš„å…ƒç´ å·¦ä¾§å¯¹é½å³å¯</span><br><span class="line"><span class="bullet">-</span> <span class="code">`#`</span>è¡¨ç¤ºæ³¨é‡Šï¼Œä»è¿™ä¸ªå­—ç¬¦ä¸€ç›´åˆ°è¡Œå°¾ï¼Œéƒ½ä¼šè¢«è§£æå™¨å¿½ç•¥</span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-270.png</span>)</span><br><span class="line"></span><br><span class="line">å†æ¥çœ‹ä¸‹ymlæ–‡ä»¶ä¸­å¸¸è§çš„æ•°æ®æ ¼å¼ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬ä¸»è¦ä»‹ç»æœ€ä¸ºå¸¸è§çš„ä¸¤ç±»ï¼š</span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> å®šä¹‰å¯¹è±¡æˆ–Mapé›†åˆ</span><br><span class="line"><span class="bullet">2.</span> å®šä¹‰æ•°ç»„ã€listæˆ–seté›†åˆ</span><br><span class="line"></span><br><span class="line">å¯¹è±¡/Mapé›†åˆ</span><br><span class="line"></span><br></pre></td></tr></table></figure>user:  name: zhangsan  age: 18  password: 123456<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">æ•°ç»„<span class="operator">/</span><span class="built_in">List</span><span class="operator">/</span><span class="built_in">Set</span>é›†åˆ</span><br><span class="line"></span><br></pre></td></tr></table></figure>hobby:   - java  - game  - sport```<p>åœ¨ymlæ ¼å¼çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œå¦‚æœé…ç½®é¡¹çš„å€¼æ˜¯ä»¥ 0 å¼€å¤´çš„ï¼Œå€¼éœ€è¦ä½¿ç”¨ â€˜â€™ å¼•èµ·æ¥ï¼Œå› ä¸ºä»¥0å¼€å¤´åœ¨ymlä¸­è¡¨ç¤º8è¿›åˆ¶çš„æ•°æ®ã€‚</p><p>ç»™å‡ºä¸€ä¸ªæ¡ˆä¾‹ï¼Œçœ‹çœ‹åŸæœ‰çš„ <code>application.properties</code> é…ç½®æ–‡ä»¶ä¸æ–°å»ºçš„ <code>application.</code>yml é…ç½®æ–‡ä»¶çš„åŒºåˆ«</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-271-1024x437.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-272.png" alt="img"></p><h4 id="é—®é¢˜">é—®é¢˜</h4><p>properties,yml,yamlçš„ä¼˜å…ˆçº§ï¼Ÿ</p><p>å½“ä¸‰ç§æ–‡ä»¶ä½äºåŒä¸€ç›®å½•æ—¶ï¼Œä¼˜å…ˆçº§é¡ºåºä¸ºï¼š</p><p><strong>properties &gt; yml &gt; yaml</strong></p>]]></content>
    
    
    <summary type="html">é»‘é©¬ç¨‹åºå‘˜JavaWeb+AI-åŸºç¡€ç¯‡ï¼ˆMaven+åç«¯åŸºç¡€+MyBatisï¼‰</summary>
    
    
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://itgeqian.github.io/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    <category term="SSM" scheme="https://itgeqian.github.io/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/SSM/"/>
    
    
    <category term="JavaWeb" scheme="https://itgeqian.github.io/tags/JavaWeb/"/>
    
  </entry>
  
  <entry>
    <title>JVMåŸºç¡€ç¯‡</title>
    <link href="https://itgeqian.github.io/posts/8.html"/>
    <id>https://itgeqian.github.io/posts/8.html</id>
    <published>2025-06-15T01:19:03.000Z</published>
    <updated>2025-06-18T09:12:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åŸºç¡€ç¯‡">åŸºç¡€ç¯‡</h1><h2 id="1ã€åˆå§‹JVM">1ã€åˆå§‹JVM</h2><h3 id="1-1-ä»€ä¹ˆæ˜¯JVM">1.1 ä»€ä¹ˆæ˜¯JVM</h3><p>JVM å…¨ç§°æ˜¯ Java Virtual Machineï¼Œä¸­æ–‡è¯‘å Javaè™šæ‹Ÿæœºã€‚JVM æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªè¿è¡Œåœ¨è®¡ç®—æœºä¸Šçš„ç¨‹åºï¼Œä»–çš„èŒè´£æ˜¯è¿è¡ŒJavaå­—èŠ‚ç æ–‡ä»¶ã€‚</p><p>Javaæºä»£ç æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-5-1024x282.png" alt="img"></p><p>åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š</p><ul><li>1ã€ç¼–å†™Javaæºä»£ç æ–‡ä»¶ã€‚</li><li>2ã€ä½¿ç”¨Javaç¼–è¯‘å™¨ï¼ˆjavacå‘½ä»¤ï¼‰å°†æºä»£ç ç¼–è¯‘æˆJavaå­—èŠ‚ç æ–‡ä»¶ã€‚</li><li>3ã€ä½¿ç”¨Javaè™šæ‹ŸæœºåŠ è½½å¹¶è¿è¡ŒJavaå­—èŠ‚ç æ–‡ä»¶ï¼Œæ­¤æ—¶ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„è¿›ç¨‹ã€‚</li></ul><h3 id="1-2-JVMçš„åŠŸèƒ½">1.2 JVMçš„åŠŸèƒ½</h3><ul><li>1 - è§£é‡Šå’Œè¿è¡Œ</li><li>2 - å†…å­˜ç®¡ç†</li><li>3 - å³æ—¶ç¼–è¯‘</li></ul><h4 id="1-2-1-è§£é‡Šå’Œè¿è¡Œ">1.2.1 è§£é‡Šå’Œè¿è¡Œ</h4><p>å¯¹å­—èŠ‚ç æ–‡ä»¶ä¸­çš„æŒ‡ä»¤ï¼Œå®æ—¶çš„è§£é‡Šæˆæœºå™¨ç ï¼Œè®©è®¡ç®—æœºæ‰§è¡Œã€‚</p><p>å­—èŠ‚ç æ–‡ä»¶ä¸­åŒ…å«äº†å­—èŠ‚ç æŒ‡ä»¤ï¼Œè®¡ç®—å™¨æ— æ³•ç›´æ¥æ‰§è¡Œï¼ŒJavaè™šæ‹Ÿæœºä¼šå°†å­—èŠ‚ç æ–‡ä»¶ä¸­çš„å­—èŠ‚ç æŒ‡ä»¤å®æ—¶åœ°è§£é‡Šæˆæœºå™¨ç ï¼Œæœºå™¨ç æ˜¯è®¡ç®—æœºå¯ä»¥è¿è¡Œçš„æŒ‡ä»¤ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-6-1024x388.png" alt="img"></p><h4 id="1-2-2-å†…å­˜ç®¡ç†">1.2.2 å†…å­˜ç®¡ç†</h4><ul><li>è‡ªåŠ¨ä¸ºå¯¹è±¡ã€æ–¹æ³•ç­‰åˆ†é…å†…å­˜</li><li>è‡ªåŠ¨çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡</li></ul><p>Javaè™šæ‹Ÿæœºä¼šå¸®åŠ©ç¨‹åºå‘˜ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ï¼ŒåŒæ—¶å°†ä¸ç”¨çš„å¯¹è±¡ä½¿ç”¨åƒåœ¾å›æ”¶å™¨å›æ”¶æ‰ï¼Œè¿™æ˜¯å¯¹æ¯”Cå’ŒC++è¿™äº›è¯­è¨€çš„ä¸€ä¸ªä¼˜åŠ¿ã€‚åœ¨C/C++è¯­è¨€ä¸­ï¼Œå¯¹è±¡çš„å›æ”¶éœ€è¦ç¨‹åºå‘˜æ‰‹åŠ¨å»ç¼–å†™ä»£ç å®Œæˆï¼Œå¦‚æœé—æ¼äº†è¿™æ®µåˆ é™¤å¯¹è±¡çš„ä»£ç ï¼Œè¿™ä¸ªå¯¹è±¡å°±ä¼šæ°¸è¿œå ç”¨å†…å­˜ç©ºé—´ï¼Œä¸ä¼šå†å›æ”¶ã€‚æ‰€ä»¥JVMçš„è¿™ä¸ªåŠŸèƒ½é™ä½äº†ç¨‹åºå‘˜ç¼–å†™ä»£ç çš„éš¾åº¦ã€‚</p><h4 id="1-2-3-å³æ—¶ç¼–è¯‘">1.2.3 å³æ—¶ç¼–è¯‘</h4><p>å¯¹çƒ­ç‚¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œæå‡æ‰§è¡Œæ•ˆç‡ã€‚å³æ—¶ç¼–è¯‘å¯ä»¥è¯´æ˜¯æå‡Javaç¨‹åºæ€§èƒ½æœ€æ ¸å¿ƒçš„æ‰‹æ®µã€‚</p><p><strong>Javaæ€§èƒ½ä½çš„ä¸»è¦åŸå› å’Œè·¨å¹³å°ç‰¹æ€§</strong></p><p>Javaè¯­è¨€å¦‚æœä¸åšä»»ä½•çš„ä¼˜åŒ–ï¼Œæ€§èƒ½å…¶å®æ˜¯ä¸å¦‚Cå’ŒC++è¯­è¨€çš„ã€‚ä¸»è¦åŸå› æ˜¯ï¼š</p><p>åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒJavaè™šæ‹Ÿæœºéœ€è¦å°†å­—èŠ‚ç æŒ‡ä»¤å®æ—¶åœ°è§£é‡Šæˆè®¡ç®—æœºèƒ½è¯†åˆ«çš„æœºå™¨ç ï¼Œè¿™ä¸ªè¿‡ç¨‹åœ¨è¿è¡Œæ—¶å¯èƒ½ä¼šåå¤åœ°æ‰§è¡Œï¼Œæ‰€ä»¥æ•ˆç‡è¾ƒä½ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-7-1024x235.png" alt="img"></p><p>Cå’ŒC++è¯­è¨€åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œåªéœ€è¦å°†æºä»£ç ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå°±åŒ…å«äº†è®¡ç®—æœºèƒ½è¯†åˆ«çš„æœºå™¨ç ï¼Œæ— éœ€åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å†å®æ—¶åœ°è§£é‡Šï¼Œæ‰€ä»¥æ€§èƒ½è¾ƒé«˜ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-8-1024x292.png" alt="img"></p><p>Javaä¸ºä»€ä¹ˆè¦é€‰æ‹©ä¸€æ¡æ‰§è¡Œæ•ˆç‡æ¯”è¾ƒä½çš„æ–¹å¼å‘¢ï¼Ÿä¸»è¦æ˜¯ä¸ºäº†å®ç°è·¨å¹³å°çš„ç‰¹æ€§ã€‚Javaçš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œå¦‚æœå¸Œæœ›åœ¨ä¸åŒå¹³å°ï¼ˆæ“ä½œç³»ç»Ÿ+ç¡¬ä»¶æ¶æ„ï¼‰ï¼Œæ¯”å¦‚åœ¨windowsæˆ–è€…linuxä¸Šè¿è¡Œã€‚å¯ä»¥ä½¿ç”¨åŒä¸€ä»½å­—èŠ‚ç æŒ‡ä»¤ï¼Œäº¤ç»™windowså’Œlinuxä¸Šçš„Javaè™šæ‹Ÿæœºè¿›è¡Œè§£é‡Šï¼Œè¿™æ ·å°±å¯ä»¥è·å¾—ä¸åŒå¹³å°ä¸Šçš„æœºå™¨ç äº†ã€‚è¿™æ ·å°±å®ç°äº†Write Onceï¼ŒRun Anywhere ç¼–å†™ä¸€æ¬¡ï¼Œåˆ°å¤„è¿è¡Œ çš„ç›®æ ‡ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-9-1024x386.png" alt="img"></p><p>ä½†æ˜¯C/C++è¯­è¨€ï¼Œå¦‚æœè¦è®©ç¨‹åºåœ¨ä¸åŒå¹³å°ä¸Šè¿è¡Œï¼Œå°±éœ€è¦å°†ä¸€ä»½æºä»£ç åœ¨ä¸åŒå¹³å°ä¸Šåˆ†åˆ«è¿›è¡Œç¼–è¯‘ï¼Œç›¸å¯¹æ¥è¯´æ¯”è¾ƒéº»çƒ¦ã€‚</p><h3 id="1-3å¸¸è§çš„JVM"><strong>1.3å¸¸è§çš„JVM</strong></h3><p>å¹³æ—¶æˆ‘ä»¬æœ€å¸¸ç”¨çš„ï¼Œå°±æ˜¯Hotspotè™šæ‹Ÿæœºã€‚</p><table><thead><tr><th>åç§°</th><th>ä½œè€…</th><th>æ”¯æŒç‰ˆæœ¬</th><th>ç¤¾åŒºæ´»è·ƒåº¦ï¼ˆgithub starï¼‰</th><th>ç‰¹æ€§</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>HotSpot (Oracle JDKç‰ˆ)</td><td>Oracle</td><td>æ‰€æœ‰ç‰ˆæœ¬</td><td>é«˜(é—­æº)</td><td>ä½¿ç”¨æœ€å¹¿æ³›ï¼Œç¨³å®šå¯é ï¼Œç¤¾åŒºæ´»è·ƒJITæ”¯æŒOracle JDKé»˜è®¤è™šæ‹Ÿæœº</td><td>é»˜è®¤</td></tr><tr><td>HotSpot (Open JDKç‰ˆ)</td><td>Oracle</td><td>æ‰€æœ‰ç‰ˆæœ¬</td><td>ä¸­(16.1k)</td><td>åŒä¸Šå¼€æºï¼ŒOpen JDKé»˜è®¤è™šæ‹Ÿæœº</td><td>é»˜è®¤å¯¹JDKæœ‰äºŒæ¬¡å¼€å‘éœ€æ±‚</td></tr><tr><td>GraalVM</td><td>Oracle</td><td>11, 17,19ä¼ä¸šç‰ˆæ”¯æŒ8</td><td>é«˜ï¼ˆ18.7kï¼‰</td><td>å¤šè¯­è¨€æ”¯æŒé«˜æ€§èƒ½ã€JITã€AOTæ”¯æŒ</td><td>å¾®æœåŠ¡ã€äº‘åŸç”Ÿæ¶æ„éœ€è¦å¤šè¯­è¨€æ··åˆç¼–ç¨‹</td></tr><tr><td>Dragonwell JDKé¾™äº•</td><td>Alibaba</td><td>æ ‡å‡†ç‰ˆ 8,11,17æ‰©å±•ç‰ˆ11,17</td><td>ä½(3.9k)</td><td>åŸºäºOpenJDKçš„å¢å¼ºé«˜æ€§èƒ½ã€bugä¿®å¤ã€å®‰å…¨æ€§æå‡JWarmupã€ElasticHeapã€Wispç‰¹æ€§æ”¯æŒ</td><td>ç”µå•†ã€ç‰©æµã€é‡‘èé¢†åŸŸå¯¹æ€§èƒ½è¦æ±‚æ¯”è¾ƒé«˜</td></tr><tr><td>Eclipse OpenJ9 (åŸ IBM J9)</td><td>IBM</td><td>8,11,17,19,20</td><td>ä½(3.1k)</td><td>é«˜æ€§èƒ½ã€å¯æ‰©å±•JITã€AOTç‰¹æ€§æ”¯æŒ</td><td>å¾®æœåŠ¡ã€äº‘åŸç”Ÿæ¶æ„</td></tr></tbody></table><h2 id="2-å­—èŠ‚ç æ–‡ä»¶è¯¦è§£">2.å­—èŠ‚ç æ–‡ä»¶è¯¦è§£</h2><h3 id="2-1-Javaè™šæ‹Ÿæœºçš„ç»„æˆ">2.1 Javaè™šæ‹Ÿæœºçš„ç»„æˆ</h3><p>Javaè™šæ‹Ÿæœºä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªç»„æˆéƒ¨åˆ†ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-31-1024x498.png" alt="img"></p><ul><li>ç±»åŠ è½½å­ç³»ç»Ÿï¼šæ ¸å¿ƒç»„ä»¶ç±»åŠ è½½å™¨ï¼Œè´Ÿè´£å°†å­—èŠ‚ç æ–‡ä»¶ä¸­çš„å†…å®¹åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</li><li>è¿è¡Œæ—¶æ•°æ®åŒºï¼šJVMç®¡ç†çš„å†…å­˜ï¼Œåˆ›å»ºå‡ºæ¥çš„å¯¹è±¡ã€ç±»çš„ä¿¡æ¯ç­‰ç­‰å†…å®¹éƒ½ä¼šæ”¾åœ¨è¿™å—åŒºåŸŸä¸­ã€‚</li><li>æ‰§è¡Œå¼•æ“ï¼šåŒ…å«äº†å³æ—¶ç¼–è¯‘å™¨ã€è§£é‡Šå™¨ã€åƒåœ¾å›æ”¶å™¨ï¼Œæ‰§è¡Œå¼•æ“ä½¿ç”¨è§£é‡Šå™¨å°†å­—èŠ‚ç æŒ‡ä»¤è§£é‡Šæˆæœºå™¨ç ï¼Œä½¿ç”¨å³æ—¶ç¼–è¯‘å™¨ä¼˜åŒ–æ€§èƒ½ï¼Œä½¿ç”¨åƒåœ¾å›æ”¶å™¨å›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ã€‚</li><li>æœ¬åœ°æ¥å£ï¼šè°ƒç”¨æœ¬åœ°ä½¿ç”¨C/C++ç¼–è¯‘å¥½çš„æ–¹æ³•ï¼Œæœ¬åœ°æ–¹æ³•åœ¨Javaä¸­å£°æ˜æ—¶ï¼Œéƒ½ä¼šå¸¦ä¸Šnativeå…³é”®å­—ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-32.png" alt="img"></p><h3 id="2-2å­—èŠ‚ç æ–‡ä»¶çš„ç»„æˆ">2.2å­—èŠ‚ç æ–‡ä»¶çš„ç»„æˆ</h3><h4 id="ä»¥æ­£ç¡®çš„å§¿åŠ¿æ‰“å¼€æ–‡ä»¶">ä»¥æ­£ç¡®çš„å§¿åŠ¿æ‰“å¼€æ–‡ä»¶</h4><p>å­—èŠ‚ç æ–‡ä»¶ä¸­ä¿å­˜äº†æºä»£ç ç¼–è¯‘ä¹‹åçš„å†…å®¹ï¼Œä»¥äºŒè¿›åˆ¶æ–¹å¼å­˜å‚¨ï¼Œæ— æ³•ç”¨è®°äº‹æœ¬ç›´æ¥æ‰“å¼€é˜…è¯»ã€‚</p><p>å¯ä»¥é€šè¿‡NotePad++ä½¿ç”¨åå…­è¿›åˆ¶æ’ä»¶æŸ¥çœ‹classæ–‡ä»¶ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-33.png" alt="img"></p><p>æ— æ³•è§£è¯»å‡ºæ–‡ä»¶é‡ŒåŒ…å«çš„å†…å®¹ï¼Œæ¨èä½¿ç”¨ jclasslibå·¥å…·æŸ¥çœ‹å­—èŠ‚ç æ–‡ä»¶ã€‚ Githubåœ°å€ï¼š <a href="https://github.com/ingokegel/jclasslib">https://github.com/ingokegel/jclasslib</a></p><p>å­—èŠ‚ç æ–‡ä»¶æ€»å…±å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><strong>åŸºç¡€ä¿¡æ¯</strong>ï¼šé­”æ•°ã€å­—èŠ‚ç æ–‡ä»¶å¯¹åº”çš„Javaç‰ˆæœ¬å·ã€è®¿é—®æ ‡è¯†(public finalç­‰ç­‰)ã€çˆ¶ç±»å’Œæ¥å£ä¿¡æ¯</li><li><strong>å¸¸é‡æ± </strong>**ï¼š** ä¿å­˜äº†å­—ç¬¦ä¸²å¸¸é‡ã€ç±»æˆ–æ¥å£åã€å­—æ®µåï¼Œä¸»è¦åœ¨å­—èŠ‚ç æŒ‡ä»¤ä¸­ä½¿ç”¨</li><li><strong>å­—æ®µï¼š</strong> å½“å‰ç±»æˆ–æ¥å£å£°æ˜çš„å­—æ®µä¿¡æ¯</li><li><strong>æ–¹æ³•ï¼š</strong> å½“å‰ç±»æˆ–æ¥å£å£°æ˜çš„æ–¹æ³•ä¿¡æ¯ï¼Œæ ¸å¿ƒå†…å®¹ä¸ºæ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤</li><li><strong>å±æ€§ï¼š</strong> ç±»çš„å±æ€§ï¼Œæ¯”å¦‚æºç çš„æ–‡ä»¶åã€å†…éƒ¨ç±»çš„åˆ—è¡¨ç­‰</li></ul><h4 id="1-åŸºæœ¬ä¿¡æ¯">1.åŸºæœ¬ä¿¡æ¯</h4><p>åŸºæœ¬ä¿¡æ¯åŒ…å«äº†jclasslibä¸­èƒ½çœ‹åˆ°çš„ä¸¤å—å†…å®¹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-34.png" alt="img"></p><h5 id="Magicé­”æ•°">Magicé­”æ•°</h5><p>æ¯ä¸ªJavaå­—èŠ‚ç æ–‡ä»¶çš„å‰å››ä¸ªå­—èŠ‚æ˜¯å›ºå®šçš„ï¼Œç”¨16è¿›åˆ¶è¡¨ç¤ºå°±æ˜¯0xcafebabeã€‚æ–‡ä»¶æ˜¯æ— æ³•é€šè¿‡æ–‡ä»¶æ‰©å±•åæ¥ç¡®å®šæ–‡ä»¶ç±»å‹çš„ï¼Œæ–‡ä»¶æ‰©å±•åå¯ä»¥éšæ„ä¿®æ”¹ä¸å½±å“æ–‡ä»¶çš„å†…å®¹ã€‚è½¯ä»¶ä¼šä½¿ç”¨æ–‡ä»¶çš„å¤´å‡ ä¸ªå­—èŠ‚ï¼ˆæ–‡ä»¶å¤´ï¼‰å»æ ¡éªŒæ–‡ä»¶çš„ç±»å‹ï¼Œå¦‚æœè½¯ä»¶ä¸æ”¯æŒè¯¥ç§ç±»å‹å°±ä¼šå‡ºé”™ã€‚</p><p>æ¯”å¦‚å¸¸è§çš„æ–‡ä»¶æ ¼å¼æ ¡éªŒæ–¹å¼å¦‚ä¸‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-35.png" alt="img"></p><p>Javaå­—èŠ‚ç æ–‡ä»¶ä¸­ï¼Œå°†æ–‡ä»¶å¤´ç§°ä¸ºmagicé­”æ•°ã€‚Javaè™šæ‹Ÿæœºä¼šæ ¡éªŒå­—èŠ‚ç æ–‡ä»¶çš„å‰å››ä¸ªå­—èŠ‚æ˜¯ä¸æ˜¯0xcafebabeï¼Œå¦‚æœä¸æ˜¯ï¼Œè¯¥å­—èŠ‚ç æ–‡ä»¶å°±æ— æ³•æ­£å¸¸ä½¿ç”¨ï¼ŒJavaè™šæ‹Ÿæœºä¼šæŠ›å‡ºå¯¹åº”çš„é”™è¯¯ã€‚</p><h5 id="ä¸»å‰¯ç‰ˆæœ¬å·">ä¸»å‰¯ç‰ˆæœ¬å·</h5><p>ä¸»å‰¯ç‰ˆæœ¬å·æŒ‡çš„æ˜¯ç¼–è¯‘å­—èŠ‚ç æ–‡ä»¶æ—¶ä½¿ç”¨çš„JDKç‰ˆæœ¬å·ï¼Œä¸»ç‰ˆæœ¬å·ç”¨æ¥æ ‡è¯†å¤§ç‰ˆæœ¬å·ï¼ŒJDK1.0-1.1ä½¿ç”¨äº†45.0-45.3ï¼ŒJDK1.2æ˜¯46ä¹‹åæ¯å‡çº§ä¸€ä¸ªå¤§ç‰ˆæœ¬å°±åŠ 1ï¼›å‰¯ç‰ˆæœ¬å·æ˜¯å½“ä¸»ç‰ˆæœ¬å·ç›¸åŒæ—¶ä½œä¸ºåŒºåˆ†ä¸åŒç‰ˆæœ¬çš„æ ‡è¯†ï¼Œä¸€èˆ¬åªéœ€è¦å…³å¿ƒä¸»ç‰ˆæœ¬å·ã€‚</p><p>1.2ä¹‹åå¤§ç‰ˆæœ¬å·è®¡ç®—æ–¹æ³•å°±æ˜¯ : ä¸»ç‰ˆæœ¬å· â€“ 44ï¼Œæ¯”å¦‚ä¸»ç‰ˆæœ¬å·52å°±æ˜¯JDK8ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-36.png" alt="img"></p><p>ç‰ˆæœ¬å·çš„ä½œç”¨ä¸»è¦æ˜¯åˆ¤æ–­å½“å‰å­—èŠ‚ç çš„ç‰ˆæœ¬å’Œè¿è¡Œæ—¶çš„JDKæ˜¯å¦å…¼å®¹ã€‚</p><p>æŠ¥ä¸‹é¢é”™è¯¯æ˜¯å…¼å®¹æ€§å‡ºç°é—®é¢˜ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-37.png" alt="img"></p><p>æ–¹æ³•1ï¼šå‡çº§IDEAç¼–è¯‘çš„Jdkç‰ˆæœ¬ã€‚ï¼ˆå®¹æ˜“å¼•å‘å…¶å®ƒçš„å…¼å®¹æ€§é—®é¢˜ï¼‰</p><p>æ–¹æ³•2ï¼šæ”¹å˜ä¾èµ–çš„ç‰ˆæœ¬ï¼Œæ›¿æ¢åŒ…åï¼Œé™ä½ç‰ˆæœ¬ã€‚ï¼ˆå·¥ä½œä¸­æ¨èé€‰ç”¨è¯¥æ–¹æ³•ï¼‰</p><h4 id="å…¶ä»–åŸºç¡€ä¿¡æ¯">å…¶ä»–åŸºç¡€ä¿¡æ¯</h4><p>å…¶ä»–åŸºç¡€ä¿¡æ¯åŒ…æ‹¬è®¿é—®æ ‡è¯†ã€ç±»å’Œæ¥å£ç´¢å¼•ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-38-1024x488.png" alt="img"></p><h4 id="2-å¸¸é‡æ± ï¼š-ä¿å­˜äº†å­—ç¬¦ä¸²å¸¸é‡ï¼Œç±»æˆ–æ¥å£åï¼Œå­—æ®µåä¸»è¦åœ¨å­—èŠ‚ç æŒ‡ä»¤ä¸­ä½¿ç”¨ã€‚">2.**å¸¸é‡æ± ï¼š**ä¿å­˜äº†å­—ç¬¦ä¸²å¸¸é‡ï¼Œç±»æˆ–æ¥å£åï¼Œå­—æ®µåä¸»è¦åœ¨å­—èŠ‚ç æŒ‡ä»¤ä¸­ä½¿ç”¨ã€‚</h4><p>å¸¸é‡æ± ä¸­çš„æ•°æ®éƒ½æœ‰ä¸€ä¸ªç¼–å·ï¼Œç¼–å·ä»1å¼€å§‹ã€‚æ¯”å¦‚â€œæˆ‘çˆ±åŒ—äº¬å¤©å®‰é—¨â€è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œåœ¨å¸¸é‡æ± ä¸­çš„ç¼–å·å°±æ˜¯7ã€‚åœ¨å­—æ®µæˆ–è€…å­—èŠ‚ç æŒ‡ä»¤ä¸­é€šè¿‡ç¼–å·7å¯ä»¥å¿«é€Ÿçš„æ‰¾åˆ°è¿™ä¸ªå­—ç¬¦ä¸²ã€‚</p><p>å­—èŠ‚ç æŒ‡ä»¤ä¸­é€šè¿‡ç¼–å·å¼•ç”¨åˆ°å¸¸é‡æ± çš„è¿‡ç¨‹ç§°ä¹‹ä¸ºç¬¦å·å¼•ç”¨ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-39.png" alt="img"></p><h4 id="3-å­—æ®µï¼š-å½“å‰ç±»æˆ–æ¥å£å£°æ˜çš„å­—æ®µä¿¡æ¯ã€‚">3.**å­—æ®µï¼š**å½“å‰ç±»æˆ–æ¥å£å£°æ˜çš„å­—æ®µä¿¡æ¯ã€‚</h4><p>å¦‚ä¸‹å›¾ä¸­ï¼Œå®šä¹‰äº†ä¸¤ä¸ªå­—æ®µa1å’Œa2ï¼Œè¿™ä¸¤ä¸ªå­—æ®µå°±ä¼šå‡ºç°åœ¨å­—æ®µè¿™éƒ¨åˆ†å†…å®¹ä¸­ã€‚åŒæ—¶è¿˜åŒ…å«å­—æ®µçš„åå­—ã€æè¿°ç¬¦ï¼ˆå­—æ®µçš„ç±»å‹ï¼‰ã€è®¿é—®æ ‡è¯†ï¼ˆpublic/private static finalç­‰ï¼‰ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-40.png" alt="img"></p><h4 id="4-æ–¹æ³•ï¼š-å½“å‰ç±»æˆ–æ¥å£å£°æ˜çš„æ–¹æ³•ä¿¡æ¯å­—èŠ‚ç æŒ‡ä»¤ã€‚">4.**æ–¹æ³•ï¼š**å½“å‰ç±»æˆ–æ¥å£å£°æ˜çš„æ–¹æ³•ä¿¡æ¯å­—èŠ‚ç æŒ‡ä»¤ã€‚</h4><p>å­—èŠ‚ç ä¸­çš„æ–¹æ³•åŒºåŸŸæ˜¯å­˜æ”¾<strong>å­—èŠ‚ç æŒ‡ä»¤</strong>çš„æ ¸å¿ƒä½ç½®ï¼Œå­—èŠ‚ç æŒ‡ä»¤çš„å†…å®¹å­˜æ”¾åœ¨æ–¹æ³•çš„Codeå±æ€§ä¸­ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-41-1024x375.png" alt="img"></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">int i</span> = 0;</span><br><span class="line"><span class="attribute">int j</span> = i + 1;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ç¼–è¯‘æˆå­—èŠ‚ç æŒ‡ä»¤ä¹‹åæ˜¯å¦‚ä¸‹å†…å®¹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-42.png" alt="img"></p><p>æˆ‘ä»¬éœ€è¦å…ˆç†è§£ä¸¤å—å†…å­˜åŒºåŸŸï¼šæ“ä½œæ•°æ ˆå’Œå±€éƒ¨å˜é‡è¡¨ã€‚</p><p><strong>æ“ä½œæ•°æ ˆ</strong>æ˜¯ç”¨æ¥å­˜æ”¾ä¸´æ—¶æ•°æ®çš„å†…å®¹ï¼Œæ˜¯ä¸€ä¸ªæ ˆå¼çš„ç»“æ„ï¼Œå…ˆè¿›åå‡ºã€‚</p><p><strong>å±€éƒ¨å˜é‡****è¡¨</strong>æ˜¯å­˜æ”¾æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡ï¼ŒåŒ…å«æ–¹æ³•çš„å‚æ•°ã€æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡ï¼Œåœ¨ç¼–è¯‘æœŸå°±å·²ç»å¯ä»¥ç¡®å®šæ–¹æ³•æœ‰å¤šå°‘ä¸ªå±€éƒ¨å˜é‡ã€‚</p><p>1ã€iconst_0ï¼Œå°†å¸¸é‡0æ”¾å…¥æ“ä½œæ•°æ ˆã€‚æ­¤æ—¶æ ˆä¸Šåªæœ‰0</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-43-1024x420.png" alt="img"></p><p>2ã€istore_1ä¼šä»æ“ä½œæ•°æ ˆä¸­ï¼Œå°†æ ˆé¡¶çš„å…ƒç´ å¼¹å‡ºæ¥ï¼Œæ­¤æ—¶0ä¼šè¢«å¼¹å‡ºï¼Œæ”¾å…¥å±€éƒ¨å˜é‡è¡¨çš„1å·ä½ç½®ã€‚å±€éƒ¨å˜é‡è¡¨ä¸­çš„1å·ä½ç½®ï¼Œåœ¨ç¼–è¯‘æ—¶å°±å·²ç»ç¡®å®šæ˜¯å±€éƒ¨å˜é‡iä½¿ç”¨çš„ä½ç½®ã€‚å®Œæˆäº†å¯¹å±€éƒ¨å˜é‡içš„èµ‹å€¼æ“ä½œã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-44-1024x440.png" alt="img"></p><p>3ã€iload_1å°†å±€éƒ¨å˜é‡è¡¨1å·ä½ç½®çš„æ•°æ®æ”¾å…¥æ“ä½œæ•°æ ˆä¸­ï¼Œæ­¤æ—¶æ ˆä¸­ä¼šæ”¾å…¥0ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-45-1024x430.png" alt="img"></p><p>4ã€iconst_1ä¼šå°†å¸¸é‡1æ”¾å…¥æ“ä½œæ•°æ ˆä¸­ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-46-1024x431.png" alt="img"></p><p>5ã€iaddä¼šå°†æ“ä½œæ•°æ ˆé¡¶éƒ¨çš„ä¸¤ä¸ªæ•°æ®ç›¸åŠ ï¼Œç°åœ¨æ“ä½œæ•°æ ˆä¸Šæœ‰ä¸¤ä¸ªæ•°0å’Œ1ï¼Œç›¸åŠ ä¹‹åç»“æœä¸º1æ”¾å…¥æ“ä½œæ•°æ ˆä¸­ï¼Œæ­¤æ—¶æ ˆä¸Šåªæœ‰ä¸€ä¸ªæ•°ä¹Ÿå°±æ˜¯ç›¸åŠ çš„ç»“æœ1ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-47-1024x428.png" alt="img"></p><p>6ã€istore_2ä»æ“ä½œæ•°æ ˆä¸­å°†1å¼¹å‡ºï¼Œå¹¶æ”¾å…¥å±€éƒ¨å˜é‡è¡¨çš„2å·ä½ç½®ï¼Œ2å·ä½ç½®æ˜¯jåœ¨ä½¿ç”¨ã€‚å®Œæˆäº†å¯¹å±€éƒ¨å˜é‡jçš„èµ‹å€¼æ“ä½œã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-48-1024x419.png" alt="img"></p><p>7.returnè¯­å¥æ‰§è¡Œï¼Œæ–¹æ³•ç»“æŸå¹¶è¿”å›ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-49-1024x421.png" alt="img"></p><h4 id="i-ä¸-i">i++ä¸++i</h4><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-50.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-51.png" alt="img"></p><p>é—®ï¼šint i = 0; i = i++; æœ€ç»ˆiçš„å€¼æ˜¯å¤šå°‘ï¼Ÿ</p><p>ç­”ï¼šç­”æ¡ˆæ˜¯0ï¼Œæˆ‘é€šè¿‡åˆ†æå­—èŠ‚ç æŒ‡ä»¤å‘ç°ï¼Œi++å…ˆæŠŠ0å–å‡ºæ¥æ”¾å…¥ä¸´æ—¶çš„æ“ä½œæ•°æ ˆä¸­ï¼Œ</p><p>æ¥ä¸‹æ¥å¯¹iè¿›è¡ŒåŠ 1ï¼Œiå˜æˆäº†1ï¼Œæœ€åå†å°†ä¹‹å‰ä¿å­˜çš„ä¸´æ—¶å€¼0æ”¾å…¥iï¼Œæœ€åiå°±å˜æˆäº†0ã€‚</p><h4 id="5-å±æ€§ï¼š-ç±»çš„å±æ€§ï¼Œæ¯”å¦‚æºç çš„æ–‡ä»¶åå†…éƒ¨ç±»çš„åˆ—è¡¨ç­‰ã€‚">5.**å±æ€§ï¼š**ç±»çš„å±æ€§ï¼Œæ¯”å¦‚æºç çš„æ–‡ä»¶åå†…éƒ¨ç±»çš„åˆ—è¡¨ç­‰ã€‚</h4><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-52.png" alt="img"></p><h4 id="å­—èŠ‚ç æ–‡ä»¶å¸¸è§å·¥å…·ä½¿ç”¨">å­—èŠ‚ç æ–‡ä»¶å¸¸è§å·¥å…·ä½¿ç”¨</h4><p>1.javap</p><p>javapæ˜¯JDKè‡ªå¸¦çš„åç¼–è¯‘å·¥å…·ï¼Œå¯ä»¥é€šè¿‡æ§åˆ¶å°æŸ¥çœ‹å­—èŠ‚ç æ–‡ä»¶çš„å†…å®¹ã€‚é€‚åˆåœ¨æœåŠ¡å™¨ä¸ŠæŸ¥çœ‹å­—èŠ‚ç æ–‡ä»¶å†…å®¹ã€‚</p><p>ç›´æ¥è¾“å…¥javapæŸ¥çœ‹æ‰€æœ‰å‚æ•°ã€‚è¾“å…¥<code>javap -v</code> å­—èŠ‚ç æ–‡ä»¶åç§° æŸ¥çœ‹å…·ä½“çš„å­—èŠ‚ç ä¿¡æ¯ã€‚å¦‚æœjaråŒ…éœ€è¦å…ˆä½¿ç”¨ <code>jar â€“xvf</code> å‘½ä»¤è§£å‹ã€‚</p><p>2jclasslibæ’ä»¶</p><p>3.Arthas</p><p>Arthasæ˜¯ä¸€æ¬¾çº¿ä¸Šç›‘æ§è¯Šæ–­äº§å“ï¼Œé€šè¿‡å…¨å±€è§†è§’å®æ—¶æŸ¥çœ‹åº”ç”¨çš„loadã€å†…å­˜ã€gcã€çº¿ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¹¶èƒ½åœ¨ä¸ä¿®æ”¹åº”ç”¨ä»£ç çš„æƒ…å†µä¸‹ï¼Œå¯¹ä¸šåŠ¡é—®é¢˜è¿›è¡Œè¯Šæ–­ï¼Œå¤§å¤§æå‡çº¿ä¸Šé—®é¢˜æ’æŸ¥çš„æ•ˆç‡ã€‚</p><p>ä½¿ç”¨ï¼š</p><p>ä½¿ç”¨<code>java -jar arthas-boot.jar</code> å¯åŠ¨ç¨‹åºã€‚</p><p>è¾“å…¥éœ€è¦Arthasç›‘æ§çš„è¿›ç¨‹idã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-53-1024x534.png" alt="img"></p><p>è¾“å…¥å‘½ä»¤å³å¯ä½¿ç”¨ã€‚</p><p>dashboard -i 2000 -n 3 ï¼šéš”2ç§’ï¼Œæ‰§è¡Œ3æ¬¡ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-54.png" alt="img"></p><h3 id="2-3ç±»çš„ç”Ÿå‘½å‘¨æœŸåŠ è½½é˜¶æ®µ">2.3ç±»çš„ç”Ÿå‘½å‘¨æœŸåŠ è½½é˜¶æ®µ</h3><p>ç±»çš„ç”Ÿå‘½å‘¨æœŸæè¿°äº†ä¸€ä¸ªç±»åŠ è½½ã€ä½¿ç”¨ã€å¸è½½çš„æ•´ä¸ªè¿‡ç¨‹ã€‚æ•´ä½“å¯ä»¥åˆ†ä¸ºï¼š</p><ul><li>åŠ è½½</li><li>è¿æ¥ï¼Œå…¶ä¸­åˆåˆ†ä¸ºéªŒè¯ã€å‡†å¤‡ã€è§£æä¸‰ä¸ªå­é˜¶æ®µ</li><li>åˆå§‹åŒ–</li><li>ä½¿ç”¨</li><li>å¸è½½</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-55-1024x408.png" alt="img"></p><h4 id="2-3-1åŠ è½½é˜¶æ®µ">2.3.1åŠ è½½é˜¶æ®µ</h4><p>1.åŠ è½½(Loading)é˜¶æ®µç¬¬ä¸€æ­¥æ˜¯ç±»åŠ è½½å™¨æ ¹æ®ç±»çš„å…¨é™å®šåé€šè¿‡ä¸åŒçš„æ¸ é“(ï¼ˆæœ¬åœ°æ–‡ä»¶ï¼Œé€šè¿‡ç½‘ç»œä¼ è¾“çš„ç±»ï¼ŒåŠ¨æ€ä»£ç†ç”Ÿæˆï¼‰)ä»¥äºŒè¿›åˆ¶æµçš„æ–¹å¼è·å–å­—èŠ‚ç ä¿¡æ¯ï¼Œç¨‹åºå‘˜å¯ä»¥ä½¿ç”¨Javaä»£ç æ‹“å±•çš„ä¸åŒçš„æ¸ é“ã€‚</p><p>2.ç±»åŠ è½½å™¨åœ¨åŠ è½½å®Œç±»ä¹‹åï¼ŒJavaè™šæ‹Ÿæœºä¼šå°†å­—èŠ‚ç ä¸­çš„ä¿¡æ¯ä¿å­˜åˆ°æ–¹æ³•åŒºä¸­ã€‚</p><p>3.ç”Ÿæˆä¸€ä¸ªInstanceKlasså¯¹è±¡ï¼Œä¿å­˜ç±»çš„æ‰€æœ‰ä¿¡æ¯ï¼Œé‡Œé¢è¿˜åŒ…å«å®ç°ç‰¹å®šåŠŸèƒ½æ¯”å¦‚å¤šæ€çš„ä¿¡æ¯ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-57.png" alt="img"></p><p>4.Javaè™šæ‹Ÿæœºè¿˜ä¼šåœ¨å †ä¸­ç”Ÿæˆä¸€ä»½ä¸æ–¹æ³•åŒºä¸­æ•°æ®ç±»ä¼¼çš„java.lang.Classå¯¹è±¡ã€‚ä½œç”¨æ˜¯åœ¨Javaä»£ç ä¸­è·å–ç±»çš„ä¿¡æ¯ä»¥åŠå­˜å‚¨é™æ€å­—æ®µçš„æ•°æ®ã€‚ï¼ˆJDK8åŠä¹‹åï¼‰</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-58.png" alt="img"></p><h4 id="2-3-2-è¿æ¥é˜¶æ®µ">2.3.2 è¿æ¥é˜¶æ®µ</h4><p>è¿æ¥é˜¶æ®µåˆ†ä¸ºä¸‰ä¸ªå­é˜¶æ®µ:</p><ul><li>éªŒè¯ï¼ŒéªŒè¯å†…å®¹æ˜¯å¦æ»¡è¶³ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ã€‚</li><li>å‡†å¤‡ï¼Œç»™é™æ€å˜é‡èµ‹åˆå€¼ã€‚</li><li>è§£æï¼Œå°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢æˆæŒ‡å‘å†…å­˜çš„ç›´æ¥å¼•ç”¨ã€‚</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-59-1024x451.png" alt="img"></p><p><strong>1.éªŒè¯</strong>ï¼šéªŒè¯å†…å®¹æ˜¯å¦æ»¡è¶³Javaè™šæ‹Ÿæœºè§„èŒƒã€‚</p><p>1.æ–‡ä»¶æ ¼å¼éªŒè¯ï¼Œæ¯”å¦‚æ–‡ä»¶æ˜¯å¦ä»¥0xCAFEBABEå¼€å¤´ï¼Œä¸»æ¬¡ç‰ˆæœ¬å·æ˜¯å¦æ»¡è¶³å½“å‰Javaè™šæ‹Ÿæœºç‰ˆæœ¬è¦æ±‚ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-63-1024x289.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-62.png" alt="img"></p><p>majoræ˜¯ä¸»ç‰ˆæœ¬å·ï¼Œ&gt;=å¸¸é‡ä¸€èˆ¬æ˜¯45ï¼Œå¯¹jdk1.8æ¥è¯´æœ€é«˜ç‰ˆæœ¬å·æ˜¯52ï¼Œå¯¹jdk8åªèƒ½æ”¯æŒ45-52ä¹‹é—´çš„ä¸»ç‰ˆæœ¬å·ã€‚å‰¯ç‰ˆæœ¬å·ä¸èƒ½å¤§äº0</p><p>2ã€å…ƒä¿¡æ¯éªŒè¯ï¼Œä¾‹å¦‚ç±»å¿…é¡»æœ‰çˆ¶ç±»ï¼ˆsuperä¸èƒ½ä¸ºç©ºï¼‰ã€‚</p><p>3ã€éªŒè¯ç¨‹åºæ‰§è¡ŒæŒ‡ä»¤çš„è¯­ä¹‰ï¼Œæ¯”å¦‚æ–¹æ³•å†…çš„æŒ‡ä»¤æ‰§è¡Œä¸­è·³è½¬åˆ°ä¸æ­£ç¡®çš„ä½ç½®ã€‚</p><p>4ã€ç¬¦å·å¼•ç”¨éªŒè¯ï¼Œä¾‹å¦‚æ˜¯å¦è®¿é—®äº†å…¶ä»–ç±»ä¸­privateçš„æ–¹æ³•ç­‰ã€‚</p><p><strong>2</strong>.<strong>å‡†å¤‡</strong>ï¼šå‡†å¤‡é˜¶æ®µä¸ºé™æ€å˜é‡ï¼ˆstaticï¼‰åˆ†é…å†…å­˜å¹¶è®¾ç½®åˆå€¼ï¼Œæ¯ä¸€ç§åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹éƒ½æœ‰å…¶åˆå€¼ã€‚</p><table><thead><tr><th><strong>æ•°æ®ç±»å‹</strong></th><th><strong>åˆå§‹å€¼</strong></th></tr></thead><tbody><tr><td><strong>int</strong></td><td><strong>0</strong></td></tr><tr><td><strong>long</strong></td><td><strong>0L</strong></td></tr><tr><td><strong>short</strong></td><td><strong>0</strong></td></tr><tr><td><strong>char</strong></td><td><strong>â€˜\u0000â€™</strong></td></tr><tr><td><strong>byte</strong></td><td><strong>0</strong></td></tr><tr><td><strong>boolean</strong></td><td><strong>false</strong></td></tr><tr><td><strong>double</strong></td><td><strong>0.0</strong></td></tr><tr><td><strong>å¼•ç”¨****æ•°æ®ç±»å‹</strong></td><td><strong>null</strong></td></tr></tbody></table><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-64-1024x337.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-65-1024x512.png" alt="img"></p><p><strong>3.è§£æ</strong>ï¼šå°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢æˆæŒ‡å‘å†…å­˜çš„ç›´æ¥å¼•ç”¨ã€‚ç›´æ¥å¼•ç”¨ä¸å†ä½¿ç”¨ç¼–å·ï¼Œè€Œæ˜¯ä½¿ç”¨å†…å­˜ä¸­çš„åœ°å€è¿›è¡Œè®¿é—®å…·ä½“çš„æ•°æ®ã€‚</p><h4 id="2-3-3åˆå§‹åŒ–é˜¶æ®µ">2.3.3åˆå§‹åŒ–é˜¶æ®µ</h4><p>åˆå§‹åŒ–é˜¶æ®µä¼šæ‰§è¡Œå­—èŠ‚ç æ–‡ä»¶ä¸­clinitï¼ˆclass init ç±»çš„åˆå§‹åŒ–ï¼‰æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤ï¼ŒåŒ…å«äº†é™æ€ä»£ç å—ä¸­çš„ä»£ç ï¼Œå¹¶ä¸ºé™æ€å˜é‡èµ‹å€¼ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-66.png" alt="img"></p><ul><li>initæ–¹æ³•ï¼Œä¼šåœ¨<strong>å¯¹è±¡</strong>åˆå§‹åŒ–æ—¶æ‰§è¡Œ</li><li>mainæ–¹æ³•ï¼Œä¸»æ–¹æ³•</li><li>clinitæ–¹æ³•ï¼Œ<strong>ç±»</strong>çš„åˆå§‹åŒ–é˜¶æ®µæ‰§è¡Œ</li></ul><hr><p>å…³äºinitå’Œclintçš„åŒºåˆ«ï¼š</p><table><thead><tr><th>åç§°</th><th>å…¨å</th><th>ç±»å‹</th><th>ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>&lt;init&gt;</code></td><td>å®ä¾‹æ„é€ æ–¹æ³•</td><td>å¯¹è±¡æ–¹æ³•</td><td><code>new</code> ä¸€ä¸ªå¯¹è±¡æ—¶ï¼ˆæ„é€ å™¨æ‰§è¡Œï¼‰</td><td>åˆå§‹åŒ–â€œå¯¹è±¡â€</td></tr><tr><td><code>&lt;clinit&gt;</code></td><td>ç±»åˆå§‹åŒ–æ–¹æ³•</td><td>é™æ€æ–¹æ³•</td><td>ç¬¬ä¸€æ¬¡ä½¿ç”¨ç±»æ—¶è‡ªåŠ¨æ‰§è¡Œï¼ˆä»…ä¸€æ¬¡ï¼‰</td><td>åˆå§‹åŒ–â€œç±»çº§åˆ«çš„é™æ€å†…å®¹â€</td></tr></tbody></table><p><code>&lt;init&gt;</code> æ˜¯å®ä¾‹æ„é€ å™¨æ–¹æ³•ï¼Œæ¯æ¬¡åˆ›å»ºå¯¹è±¡éƒ½ä¼šæ‰§è¡Œï¼›è€Œ <code>&lt;clinit&gt;</code> æ˜¯ç±»åˆå§‹åŒ–æ–¹æ³•ï¼Œåªåœ¨ç±»è¢«ç¬¬ä¸€æ¬¡åŠ è½½æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œç”¨æ¥å¤„ç†é™æ€å˜é‡åˆå§‹åŒ–å’Œé™æ€ä»£ç å—ã€‚</p><p>1ï¸âƒ£ <code>&lt;init&gt;</code>ï¼šæ„é€ æ–¹æ³•ï¼ˆéé™æ€ï¼‰</p><ul><li>å¯¹åº” Java ä¸­çš„æ„é€ å‡½æ•°ï¼ˆ<code>public Demo2() &#123;&#125;</code>ï¼‰</li><li>æ¯æ¬¡åˆ›å»ºå¯¹è±¡ï¼ˆ<code>new Demo2()</code>ï¼‰æ—¶æ‰§è¡Œä¸€æ¬¡</li><li>æ˜¯ <strong>å¯¹è±¡çº§åˆ«</strong> çš„åˆå§‹åŒ–æ–¹æ³•</li></ul><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Demo</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Demo</span>()</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;æ„é€ å™¨æ‰§è¡Œ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘åä¼šç”Ÿæˆ <code>&lt;init&gt;</code> æ–¹æ³•ã€‚</p><p>2ï¸âƒ£ <code>&lt;clinit&gt;</code>ï¼šç±»åˆå§‹åŒ–æ–¹æ³•ï¼ˆé™æ€ï¼‰</p><ul><li><strong>ä¸æ˜¯ä½ å†™çš„ä»£ç ä¸­æ˜¾å¼çš„æ–¹æ³•</strong>ï¼Œè€Œæ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„</li><li>å½“ç±»ä¸­åŒ…å«ï¼š<ul><li>é™æ€å˜é‡èµ‹å€¼ï¼ˆå¦‚ï¼š<code>public static int i = 10;</code>ï¼‰</li><li>æˆ–é™æ€ä»£ç å—ï¼ˆå¦‚ï¼š<code>static &#123; System.out.println(&quot;xxx&quot;); &#125;</code>ï¼‰</li><li>ç¼–è¯‘å™¨ä¼šæŠŠè¿™äº›æ”¾è¿›ä¸€ä¸ªå« <code>&lt;clinit&gt;</code> çš„æ–¹æ³•ä¸­</li></ul></li><li><strong>è¿™ä¸ªæ–¹æ³•åœ¨ç±»åŠ è½½æ—¶åªæ‰§è¡Œä¸€æ¬¡</strong></li></ul><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> i = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é™æ€ä»£ç å—&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘åï¼Œä¼šç”Ÿæˆä¸€ä¸ª <code>&lt;clinit&gt;</code> æ–¹æ³•ï¼Œé‡Œé¢åŒ…å«ä¸Šé¢ä¸¤ä¸ªé™æ€åˆå§‹åŒ–è¯­å¥ã€‚</p><hr><p>ç»§ç»­æ¥çœ‹clinitæ–¹æ³•ä¸­çš„å­—èŠ‚ç æŒ‡ä»¤ï¼š</p><p>1ã€iconst_1ï¼Œå°†å¸¸é‡1æ”¾å…¥æ“ä½œæ•°æ ˆã€‚æ­¤æ—¶æ ˆä¸­åªæœ‰1è¿™ä¸ªæ•°ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1136-1024x350.png" alt="img"></p><p>2ã€putstaticæŒ‡ä»¤ä¼šå°†æ“ä½œæ•°æ ˆä¸Šçš„æ•°å¼¹å‡ºæ¥ï¼Œå¹¶æ”¾å…¥å †ä¸­é™æ€å˜é‡çš„ä½ç½®ï¼Œå­—èŠ‚ç æŒ‡ä»¤ä¸­#2æŒ‡å‘äº†å¸¸é‡æ± ä¸­çš„é™æ€å˜é‡valueï¼Œåœ¨è§£æé˜¶æ®µä¼šè¢«æ›¿æ¢æˆå˜é‡çš„åœ°å€ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1137-1024x345.png" alt="img"></p><p>3ã€åä¸¤æ­¥æ“ä½œç±»ä¼¼ï¼Œæ‰§è¡Œvalue=2ï¼Œå°†å †ä¸Šçš„valueèµ‹å€¼ä¸º2ã€‚</p><p>å¦‚æœå°†ä»£ç çš„ä½ç½®äº’æ¢ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1</span> &#123;</span><br><span class="line">    <span class="type">static</span> &#123;</span><br><span class="line">        value = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">public</span> <span class="type">static</span> <span class="type">int</span> value = <span class="number">1</span>;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">static</span> <span class="type">void</span> <span class="title">main</span><span class="params">(<span class="type">String</span>[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1138.png" alt="img"></p><p>è¿™æ ·åˆå§‹åŒ–ç»“æŸä¹‹åï¼Œæœ€ç»ˆvalueçš„å€¼å°±å˜æˆäº†1è€Œä¸æ˜¯2ã€‚</p><p>ä»¥ä¸‹å‡ ç§æ–¹å¼ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ–ï¼š</p><ul><li>1.è®¿é—®ä¸€ä¸ªç±»çš„é™æ€å˜é‡æˆ–è€…é™æ€æ–¹æ³•ï¼ˆå¦‚æœå˜é‡æ—¶finalä¿®é¥°çš„å¹¶ä¸”ç­‰å·å³è¾¹æ˜¯å¸¸é‡ä¸ä¼šè§¦å‘åˆå§‹åŒ–ï¼Œå› ä¸ºåœ¨è¿æ¥é˜¶æ®µä¼šç›´æ¥èµ‹å¸¸é‡å€¼ï¼‰</li><li>2.è°ƒç”¨Class.forName(String className)</li><li>3.newä¸€ä¸ªè¯¥ç±»çš„å¯¹è±¡æ—¶ã€‚</li><li>4.æ‰§è¡ŒMainæ–¹æ³•çš„å½“å‰ç±»ã€‚</li></ul><p>æ·»åŠ -XX:+TraceClassLoading å‚æ•°å¯ä»¥æ‰“å°å‡ºåŠ è½½å¹¶åˆå§‹åŒ–çš„ç±»</p><p><strong>é¢è¯•é¢˜1ï¼š</strong></p><p>å¦‚ä¸‹ä»£ç çš„è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">publicclassTest1 &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] <span class="keyword">args</span></span>)</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">        newTest1();</span><br><span class="line">        newTest1();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    publicTest1()&#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;C&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;D&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ†ææ­¥éª¤ï¼š</p><p><strong>Java ä¸­çš„æ‰§è¡Œé¡ºåºæ˜¯ï¼š</strong></p><ol><li><strong>é™æ€ä»£ç å—</strong>ï¼ˆ<code>static&#123;&#125;</code>ï¼‰â€”â€”ç±»åŠ è½½æ—¶åªæ‰§è¡Œä¸€æ¬¡</li><li>æ‰§è¡Œ <code>main()</code> æ–¹æ³•</li><li>åˆ›å»ºå¯¹è±¡æ—¶ï¼š<ul><li>å…ˆæ‰§è¡Œ <strong>æ„é€ ä»£ç å—</strong>ï¼ˆ<code>&#123;&#125;</code>ï¼‰</li><li>å†æ‰§è¡Œ <strong>æ„é€ æ–¹æ³•</strong>ï¼ˆ<code>Test1()</code>ï¼‰</li></ul></li></ol><p>ldc #9æ˜¯ä»å¸¸é‡æ± ä¸­å°†å­—ç¬¦ä¸²DåŠ è½½åˆ°æ“ä½œæ•°æ ˆä¸­ã€‚</p><p>invokevirtualæ˜¯è°ƒç”¨Printlnæ–¹æ³•æ‰“å°æ“ä½œæ•°æ ˆä¸Šçš„å†…å®¹ã€‚</p><p>1ã€æ‰§è¡Œmainæ–¹æ³•ä¹‹å‰ï¼Œå…ˆæ‰§è¡ŒclinitæŒ‡ä»¤ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1139-1024x132.png" alt="img"></p><p>æŒ‡ä»¤ä¼šè¾“å‡ºD</p><p>2ã€æ‰§è¡Œmainæ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1140.png" alt="img"></p><p>æŒ‡ä»¤ä¼šè¾“å‡ºA</p><p>3ã€åˆ›å»ºä¸¤ä¸ªå¯¹è±¡ï¼Œä¼šæ‰§è¡Œä¸¤æ¬¡å¯¹è±¡åˆå§‹åŒ–çš„æŒ‡ä»¤ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1141.png" alt="img"></p><p>è¿™é‡Œä¼šè¾“å‡ºCBï¼Œæºä»£ç ä¸­è¾“å‡ºCè¿™è¡Œï¼Œè¢«æ”¾åˆ°äº†å¯¹è±¡åˆå§‹åŒ–çš„ä¸€å¼€å§‹æ¥æ‰§è¡Œã€‚</p><p>æ‰€ä»¥æœ€åçš„ç»“æœåº”è¯¥æ˜¯DACBCB</p><p>å°ç»“ï¼šç±»åŠ è½½æ—¶å…ˆæ‰§è¡Œä¸€æ¬¡é™æ€ä»£ç å—ï¼Œç„¶åæ¯æ¬¡åˆ›å»ºå¯¹è±¡æ—¶éƒ½ä¼šå…ˆæ‰§è¡Œæ„é€ ä»£ç å— <code>&#123;&#125;</code>ï¼Œå†æ‰§è¡Œæ„é€ å‡½æ•°ã€‚è¿™ç§é¡ºåºæ˜¯é¢è¯•ä¸­å¸¸è€ƒçš„åŸºç¡€çŸ¥è¯†ç‚¹ã€‚</p><p>æ³¨æ„ï¼šæ„é€ ä»£ç å—ä¼˜äºæ„é€ æ–¹æ³•æ‰§è¡Œï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆCåœ¨Bå‰é¢æ‰§è¡Œäº†</p><h4 id="clinitä¸ä¼šæ‰§è¡Œçš„å‡ ç§æƒ…å†µ">clinitä¸ä¼šæ‰§è¡Œçš„å‡ ç§æƒ…å†µ</h4><p>å¦‚ä¸‹å‡ ç§æƒ…å†µæ˜¯ä¸ä¼šè¿›è¡Œåˆå§‹åŒ–æŒ‡ä»¤æ‰§è¡Œçš„ï¼š</p><p>1.æ— é™æ€ä»£ç å—ä¸”æ— é™æ€å˜é‡èµ‹å€¼è¯­å¥ã€‚</p><p>2.æœ‰é™æ€å˜é‡çš„å£°æ˜ï¼Œä½†æ˜¯<strong>æ²¡æœ‰èµ‹å€¼è¯­å¥</strong>ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1142.png" alt="img"></p><p>3.<strong>é™æ€å˜é‡</strong>çš„å®šä¹‰<strong>ä½¿ç”¨finalå…³é”®å­—</strong>ï¼Œè¿™ç±»å˜é‡ä¼šåœ¨å‡†å¤‡é˜¶æ®µç›´æ¥è¿›è¡Œåˆå§‹åŒ–ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1144.png" alt="img"></p><p>æ³¨æ„ï¼š</p><p>1.ç›´æ¥è®¿é—®çˆ¶ç±»çš„é™æ€å˜é‡ï¼Œä¸ä¼šè§¦å‘å­ç±»çš„åˆå§‹åŒ–</p><p>2.å­ç±»çš„åˆå§‹åŒ–clinitè°ƒç”¨ä¹‹å‰ï¼Œä¼šå…ˆè°ƒç”¨çˆ¶ç±»çš„clinitåˆå§‹åŒ–æ–¹æ³•ã€‚</p><p><strong>é¢è¯•é¢˜2ï¼š</strong></p><p>å¦‚ä¸‹ä»£ç çš„è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> </span>&#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        new B02();</span><br><span class="line">        System.out.println(B02.a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A02</span></span>&#123;</span><br><span class="line">    static <span class="keyword">int</span> a= <span class="number">0</span>;</span><br><span class="line">    static&#123;</span><br><span class="line">        a = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B02</span> <span class="title">extends</span> <span class="title">A02</span></span>&#123;</span><br><span class="line">    static&#123;</span><br><span class="line">        a = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ†ææ­¥éª¤ï¼š</p><ul><li>1ã€è°ƒç”¨newåˆ›å»ºå¯¹è±¡ï¼Œéœ€è¦åˆå§‹åŒ–B02ï¼Œä¼˜å…ˆåˆå§‹åŒ–çˆ¶ç±»ã€‚</li><li>2ã€æ‰§è¡ŒA02çš„åˆå§‹åŒ–ä»£ç ï¼Œå°†aèµ‹å€¼ä¸º1ã€‚</li><li>3ã€B02åˆå§‹åŒ–ï¼Œå°†aèµ‹å€¼ä¸º2ã€‚</li></ul><p>æœ€ç»ˆç­”æ¡ˆä¸º2</p><p>å˜åŒ–</p><p>å°†<code>new B02();</code>æ³¨é‡Šæ‰ä¼šæ€ä¹ˆæ ·ï¼Ÿ</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1145.png" alt="img"></p><p>åˆ†ææ­¥éª¤ï¼š</p><ul><li>1ã€è®¿é—®çˆ¶ç±»çš„é™æ€å˜é‡ï¼Œåªåˆå§‹åŒ–çˆ¶ç±»ã€‚</li><li>2ã€æ‰§è¡ŒA02çš„åˆå§‹åŒ–ä»£ç ï¼Œå°†aèµ‹å€¼ä¸º1ã€‚</li></ul><p><strong>è®¿é—®çˆ¶ç±»çš„é™æ€å˜é‡ï¼Œåªåˆå§‹åŒ–çˆ¶ç±»ï¼Œaæ˜¯A02çš„å˜é‡ï¼Œå±äºçˆ¶ç±»çš„å˜é‡ï¼Œæ‰€ä»¥åªåˆå§‹åŒ–äº†ç±»A02</strong></p><p>ç­”æ¡ˆä¸º1</p><p><strong>éªŒè¯é¢˜ï¼Œæˆ‘ä»¬éªŒè¯åå‘ç°å¦‚ä¸‹ä¸¤ä¸ªç»“è®ºï¼š</strong></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1146-1024x541.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1147-1024x450.png" alt="img"></p><h4 id="2-3-4ç±»çš„å£°æ˜å‘¨æœŸæ€»ç»“">2.3.4ç±»çš„å£°æ˜å‘¨æœŸæ€»ç»“</h4><p>1.åŠ è½½é˜¶æ®µ</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1148-1024x569.png" alt="img"></p><p>2ï¼Œ3,4è¿æ¥é˜¶æ®µ</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1149-1024x431.png" alt="img"></p><p>5åˆå§‹åŒ–é˜¶æ®µ</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1150-1024x557.png" alt="img"></p><p>6.ä½¿ç”¨é˜¶æ®µ</p><p>7.å¸è½½é˜¶æ®µ</p><h3 id="2-4ç±»åŠ è½½å™¨çš„åˆ†ç±»">2.4ç±»åŠ è½½å™¨çš„åˆ†ç±»</h3><h4 id="2-4-1ä»€ä¹ˆæ˜¯ç±»åŠ è½½å™¨">2.4.1ä»€ä¹ˆæ˜¯ç±»åŠ è½½å™¨</h4><p>ç±»åŠ è½½å™¨ClassLoaderï¼šæ˜¯Javaè™šæ‹Ÿæœºæä¾›ç»™åº”ç”¨ç¨‹åºå»å®ç°è·å–ç±»å’Œæ¥å£å­—èŠ‚ç æ•°æ®çš„æŠ€æœ¯ï¼Œç±»åŠ è½½å™¨åªå‚ä¸åŠ è½½è¿‡ç¨‹ä¸­çš„å­—èŠ‚ç è·å–å¹¶åŠ è½½åˆ°å†…å­˜è¿™ä¸€éƒ¨åˆ†ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1151-1024x398.png" alt="img"></p><p><strong>ç±»åŠ è½½å™¨çš„ä½œç”¨ï¼Ÿ</strong></p><p>ç±»åŠ è½½å™¨è´Ÿè´£åœ¨ç±»åŠ è½½è¿‡ç¨‹ä¸­çš„å­—èŠ‚ç è·å–å¹¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚é€šè¿‡åŠ è½½å­—èŠ‚ç æ•°æ®æ”¾å…¥å†…å­˜è½¬æ¢æˆbyte[]ï¼Œæ¥ä¸‹æ¥è°ƒç”¨è™šæ‹Ÿæœºåº•å±‚æ–¹æ³•å°†byte[]è½¬æ¢æˆæ–¹æ³•åŒºå’Œå †ä¸­çš„æ•°æ®ã€‚</p><h4 id="2-4-2ç±»åŠ è½½å™¨çš„åˆ†ç±»">2.4.2ç±»åŠ è½½å™¨çš„åˆ†ç±»</h4><p>ç±»åŠ è½½å™¨åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯Javaä»£ç ä¸­å®ç°çš„ï¼Œä¸€ç±»æ˜¯Javaè™šæ‹Ÿæœºåº•å±‚æºç å®ç°çš„ã€‚</p><ul><li>è™šæ‹Ÿæœºåº•å±‚å®ç°ï¼šæºä»£ç ä½äºJavaè™šæ‹Ÿæœºçš„æºç ä¸­ï¼Œå®ç°è¯­è¨€ä¸è™šæ‹Ÿæœºåº•å±‚è¯­è¨€ä¸€è‡´ï¼Œæ¯”å¦‚Hotspotä½¿ç”¨C++ã€‚ä¸»è¦ç›®çš„æ˜¯ä¿è¯Javaç¨‹åºè¿è¡Œä¸­åŸºç¡€ç±»è¢«æ­£ç¡®åœ°åŠ è½½ï¼Œæ¯”å¦‚java.lang.Stringï¼ŒJavaè™šæ‹Ÿæœºéœ€è¦ç¡®ä¿å…¶å¯é æ€§ã€‚</li><li>JDKä¸­é»˜è®¤æä¾›æˆ–è€…è‡ªå®šä¹‰ï¼šJDKä¸­é»˜è®¤æä¾›äº†å¤šç§å¤„ç†ä¸åŒæ¸ é“çš„ç±»åŠ è½½å™¨ï¼Œç¨‹åºå‘˜ä¹Ÿå¯ä»¥è‡ªå·±æ ¹æ®éœ€æ±‚å®šåˆ¶ï¼Œä½¿ç”¨Javaè¯­è¨€ã€‚æ‰€æœ‰Javaä¸­å®ç°çš„ç±»åŠ è½½å™¨éƒ½éœ€è¦ç»§æ‰¿<strong>ClassLoader</strong>è¿™ä¸ªæŠ½è±¡ç±»ã€‚</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1152.png" alt="img"></p><p>JDK9ä¹‹åå‡ºç°æ¨¡å—åŒ–ï¼Œæ‰€ä»¥JDK9æ˜¯åˆ†æ°´å²­ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1154-1024x546.png" alt="img"></p><p>ç±»åŠ è½½å™¨çš„è¯¦ç»†ä¿¡æ¯å¯ä»¥é€šè¿‡Arthasçš„classloaderå‘½ä»¤æŸ¥çœ‹ï¼š</p><p><code>classloader</code> - æŸ¥çœ‹ classloader çš„ç»§æ‰¿æ ‘ï¼Œurlsï¼Œç±»åŠ è½½ä¿¡æ¯ï¼Œä½¿ç”¨ classloader å» getResource</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1155-1024x398.png" alt="img"></p><ul><li>BootstrapClassLoaderæ˜¯å¯åŠ¨ç±»åŠ è½½å™¨ï¼ŒnumberOfInstancesæ˜¯ç±»åŠ è½½å™¨çš„æ•°é‡åªæœ‰1ä¸ªï¼ŒloadedCountTotalæ˜¯åŠ è½½ç±»çš„æ•°é‡1861ä¸ªã€‚</li><li>ExtClassLoaderæ˜¯æ‰©å±•ç±»åŠ è½½å™¨</li><li>AppClassLoaderæ˜¯åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1156.png" alt="img"></p><h4 id="2-4-3å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap-ClassLoaderï¼‰">2.4.3å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰</h4><ul><li>å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰æ˜¯ç”±Hotspotè™šæ‹Ÿæœºæä¾›çš„ã€ä½¿ç”¨<strong>C++ç¼–å†™</strong>çš„ç±»åŠ è½½å™¨ã€‚</li><li>é»˜è®¤åŠ è½½Javaå®‰è£…ç›®å½•/jre/libä¸‹çš„ç±»æ–‡ä»¶ï¼Œæ¯”å¦‚rt.jarï¼Œtools.jarï¼Œresources.jarç­‰ã€‚ï¼ˆrt.jaræ˜¯æœ€æ ¸å¿ƒçš„jaråŒ…ã€‚stringï¼Œintegerï¼Œlongï¼Œæ—¥æœŸç±»ã€‚ï¼‰</li></ul><p>è¿è¡Œå¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** * å¯åŠ¨ç¨‹åºç±»åŠ è½½å™¨æ¡ˆä¾‹ */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BootstrapClassLoaderDemo</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">static</span> <span class="type">void</span> <span class="title">main</span><span class="params">(<span class="type">String</span>[] args)</span> throwsIOException </span>&#123;</span><br><span class="line">        ClassLoader classLoader = <span class="type">String</span>.<span class="keyword">class</span>.<span class="built_in">getClassLoader</span>();</span><br><span class="line">        System.out.<span class="built_in">println</span>(classLoader);</span><br><span class="line"></span><br><span class="line">        System.in.<span class="built_in">read</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç é€šè¿‡Stringç±»è·å–åˆ°å®ƒçš„ç±»åŠ è½½å™¨å¹¶ä¸”æ‰“å°ï¼Œç»“æœæ˜¯<code>null</code>ã€‚è¿™æ˜¯å› ä¸ºå¯åŠ¨ç±»åŠ è½½å™¨<strong>åœ¨JDK8ä¸­æ˜¯ç”±C++è¯­è¨€æ¥ç¼–å†™çš„</strong>ï¼Œåœ¨Javaä»£ç ä¸­å»è·å–æ—¢ä¸é€‚åˆä¹Ÿä¸å®‰å…¨ï¼Œæ‰€ä»¥æ‰è¿”å›<code>null</code></p><p>åœ¨Arthasä¸­å¯ä»¥é€šè¿‡<code>sc -d ç±»å</code>çš„æ–¹å¼æŸ¥çœ‹åŠ è½½è¿™ä¸ªç±»çš„ç±»åŠ è½½å™¨è¯¦ç»†çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1157.png" alt="img"></p><p>é€šè¿‡ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œjava.lang.Stringç±»çš„ç±»åŠ è½½å™¨æ˜¯ç©ºçš„ï¼ŒHashå€¼ä¹Ÿæ˜¯nullã€‚</p><p><strong>å¦‚ä½•è®©å¯åŠ¨ç±»åŠ è½½å™¨å»åŠ è½½ç”¨æˆ·jaråŒ…ï¼š</strong></p><ul><li>1.æŠŠè¦æ‰©å±•çš„ç±»æ‰“æˆjaråŒ…ï¼Œæ”¾å…¥jre/libä¸‹è¿›è¡Œæ‰©å±•ï¼ˆä¸æ¨èï¼Œä¼šè¦æ±‚åç§°ç¬¦åˆè§„èŒƒï¼‰ã€‚</li><li>2.ä½¿ç”¨å‚æ•°è¿›è¡Œæ‰©å±•ã€‚æ¨èï¼Œä½¿ç”¨-Xbootclasspath/a:jaråŒ…ç›®å½•/jaråŒ…åè¿›è¡Œæ‰©å±•ã€‚</li></ul><p>å¦‚ä¸‹å›¾ï¼Œåœ¨IDEAé…ç½®ä¸­æ·»åŠ è™šæ‹Ÿæœºå‚æ•°ï¼Œå°±å¯ä»¥åŠ è½½<code>D:/jvm/jar/classloader-test.jar</code>è¿™ä¸ªjaråŒ…äº†ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1158.png" alt="img"></p><h4 id="2-4-4æ‰©å±•ç±»åŠ è½½å™¨å’Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆExtension-ClassLoader-å’Œ-Application-ClassLoaderï¼‰">2.4.4æ‰©å±•ç±»åŠ è½½å™¨å’Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆExtension ClassLoader å’Œ Application ClassLoaderï¼‰</h4><ul><li>æ‰©å±•ç±»åŠ è½½å™¨å’Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨éƒ½æ˜¯JDKæä¾›çš„ï¼Œä½¿ç”¨Javaç¼–å†™çš„ç±»åŠ è½½å™¨ã€‚</li><li>å®ƒä»¬çš„æºç éƒ½ä½äºsun.misc.Launcherä¸­ï¼Œæ˜¯ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ã€‚ç»§æ‰¿è‡ªURLClassLoaderã€‚å…·å¤‡é€šè¿‡ç›®å½•æˆ–è€…æŒ‡å®šjaråŒ…å°†å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</li></ul><p>ç»§æ‰¿å…³ç³»å›¾ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1160-1024x292.png" alt="img"></p><ul><li>ClassLoaderç±»å®šä¹‰äº†å…·ä½“çš„è¡Œä¸ºæ¨¡å¼ï¼Œç®€å•æ¥è¯´å°±æ˜¯å…ˆä»æœ¬åœ°æˆ–è€…ç½‘ç»œ<strong>è·å¾—å­—èŠ‚ç ä¿¡æ¯</strong>ï¼Œç„¶åè°ƒç”¨è™šæ‹Ÿæœºåº•å±‚çš„æ–¹æ³•<strong>åˆ›å»ºæ–¹æ³•åŒºå’Œå †ä¸Šçš„å¯¹è±¡</strong>ã€‚è¿™æ ·çš„å¥½å¤„å°±æ˜¯è®©å­ç±»åªéœ€è¦å»å®ç°å¦‚ä½•è·å–å­—èŠ‚ç ä¿¡æ¯è¿™éƒ¨åˆ†ä»£ç ã€‚</li><li>SecureClassLoaderæä¾›äº†è¯ä¹¦æœºåˆ¶ï¼Œæå‡äº†å®‰å…¨æ€§ã€‚</li><li>URLClassLoaderæä¾›äº†æ ¹æ®URLè·å–ç›®å½•ä¸‹æˆ–è€…æŒ‡å®šjaråŒ…è¿›è¡ŒåŠ è½½ï¼Œè·å–å­—èŠ‚ç çš„æ•°æ®ã€‚</li><li>æ‰©å±•ç±»åŠ è½½å™¨å’Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ç»§æ‰¿è‡ªURLClassLoaderï¼Œè·å¾—äº†ä¸Šè¿°çš„ä¸‰ç§èƒ½åŠ›ã€‚</li></ul><p><strong>æ‰©å±•ç±»åŠ è½½å™¨</strong></p><p>æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension Class Loaderï¼‰æ˜¯JDKä¸­æä¾›çš„ã€ä½¿ç”¨Javaç¼–å†™çš„ç±»åŠ è½½å™¨ã€‚é»˜è®¤åŠ è½½Javaå®‰è£…ç›®å½•/jre/lib/extä¸‹çš„ç±»æ–‡ä»¶ã€‚</p><p>é€šè¿‡æ‰©å±•ç±»åŠ è½½å™¨å»åŠ è½½ç”¨æˆ·jaråŒ…ï¼š</p><ul><li><strong>æ”¾å…¥/jre/lib/extä¸‹è¿›è¡Œæ‰©å±•</strong>ã€‚ä¸æ¨èï¼Œå°½å¯èƒ½ä¸è¦å»æ›´æ”¹JDKå®‰è£…ç›®å½•ä¸­çš„å†…å®¹ã€‚</li><li><strong>ä½¿ç”¨å‚æ•°è¿›è¡Œæ‰©å±•ä½¿ç”¨å‚æ•°è¿›è¡Œæ‰©å±•</strong>ã€‚æ¨èï¼Œä½¿ç”¨-Djava.ext.dirs=jaråŒ…ç›®å½• è¿›è¡Œæ‰©å±•,è¿™ç§æ–¹å¼ä¼šè¦†ç›–æ‰åŸå§‹ç›®å½•ï¼Œå¯ä»¥ç”¨;(windows):(macos/linux)è¿½åŠ ä¸ŠåŸå§‹ç›®å½•</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1161.png" alt="img"></p><p>ä½¿ç”¨<code>å¼•å·</code>å°†æ•´ä¸ªåœ°å€åŒ…è£¹èµ·æ¥ï¼Œè¿™æ ·è·¯å¾„ä¸­å³ä¾¿æ˜¯æœ‰ç©ºæ ¼ä¹Ÿä¸éœ€è¦é¢å¤–å¤„ç†ã€‚è·¯å¾„ä¸­è¦åŒ…å«åŸæ¥extæ–‡ä»¶å¤¹ï¼ŒåŒæ—¶åœ¨æœ€ååŠ ä¸Šæ‰©å±•çš„è·¯å¾„ã€‚</p><p><strong>åº”ç”¨ç¨‹åºåŠ è½½å™¨</strong></p><p>åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ä¼šåŠ è½½classpathä¸‹çš„ç±»æ–‡ä»¶ï¼Œé»˜è®¤åŠ è½½çš„æ˜¯é¡¹ç›®ä¸­çš„ç±»ä»¥åŠé€šè¿‡mavenå¼•å…¥çš„ç¬¬ä¸‰æ–¹jaråŒ…ä¸­çš„ç±»ã€‚</p><p>å¦‚ä¸‹æ¡ˆä¾‹ä¸­ï¼Œæ‰“å°å‡º<code>Student</code>å’Œ<code>FileUtils</code>çš„ç±»åŠ è½½å™¨ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** * åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨æ¡ˆä¾‹ */</span>publicclassAppClassLoaderDemo &#123;</span><br><span class="line">    publicstaticvoidmain(String[] args) throwsIOException, InterruptedException &#123;</span><br><span class="line">        //å½“å‰é¡¹ç›®ä¸­åˆ›å»ºçš„Studentç±»Student student = newStudent();</span><br><span class="line">        ClassLoader classLoader = Student.<span class="keyword">class</span>.getClassLoader();</span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(classLoader);</span><br><span class="line"></span><br><span class="line">        //mavenä¾èµ–ä¸­åŒ…å«çš„ç±»ClassLoader classLoader1 = FileUtils.<span class="keyword">class</span>.getClassLoader();</span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">out</span>.println(classLoader1);</span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">System</span>.<span class="keyword">in</span>.<span class="keyword">read</span>();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1162.png" alt="img"></p><p>ç±»åŠ è½½å™¨çš„åŠ è½½è·¯å¾„å¯ä»¥é€šè¿‡classloader â€“c hashå€¼ æŸ¥çœ‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1163-1024x399.png" alt="img"></p><h3 id="2-5ã€åŒäº²å§”æ´¾æœºåˆ¶">2.5ã€åŒäº²å§”æ´¾æœºåˆ¶</h3><p>åŒäº²å§”æ´¾æœºåˆ¶æŒ‡çš„æ˜¯ï¼š<strong>å½“ä¸€ä¸ªç±»åŠ è½½å™¨æ¥æ”¶åˆ°åŠ è½½ç±»çš„ä»»åŠ¡æ—¶ï¼Œä¼šè‡ªåº•å‘ä¸ŠæŸ¥æ‰¾æ˜¯å¦åŠ è½½</strong></p><p><strong>å†ç”±é¡¶å‘ä¸‹è¿›è¡ŒåŠ è½½</strong>ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1164.png" alt="img"></p><p>è¯¦ç»†æµç¨‹ï¼š</p><p>æ¯ä¸ªç±»åŠ è½½å™¨éƒ½æœ‰ä¸€ä¸ªçˆ¶ç±»åŠ è½½å™¨ï¼ˆJavaå®ç°çš„ç±»åŠ è½½å™¨ï¼Œ<strong>å†…éƒ¨éƒ½ä¿å­˜äº†ä¸€ä¸ªparentçš„æˆå‘˜å˜é‡</strong>ï¼Œå®ƒè¡¨ç¤ºæˆ‘çš„çˆ¶ç±»åŠ è½½å™¨æ˜¯è°ï¼‰ã€‚çˆ¶ç±»åŠ è½½å™¨çš„å…³ç³»å¦‚ä¸‹ï¼Œå¯åŠ¨ç±»åŠ è½½å™¨æ²¡æœ‰çˆ¶ç±»åŠ è½½å™¨ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1165.png" alt="img"></p><p><strong>åœ¨ç±»åŠ è½½çš„è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªç±»åŠ è½½å™¨éƒ½ä¼šå…ˆæ£€æŸ¥æ˜¯å¦å·²ç»åŠ è½½äº†è¯¥ç±»ï¼Œå¦‚æœå·²ç»åŠ è½½åˆ™ç›´æ¥è¿”å›ï¼Œå¦åˆ™ä¼šå°†åŠ è½½è¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨ã€‚</strong></p><p>è‡ªå·±æ²¡å¹²çš„å°±è®©çˆ¶ç±»å¹²ï¼›è‡ªå·±å¹²äº†çš„å°±ç›´æ¥ç»™ä½ </p><h4 id="2-5-1æ¡ˆä¾‹1ï¼š">2.5.1æ¡ˆä¾‹1ï¼š</h4><p>æ¯”å¦‚com.itheima.my.Aå‡è®¾åœ¨å¯åŠ¨ç±»åŠ è½½å™¨çš„åŠ è½½ç›®å½•ä¸­ï¼Œè€Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨æ¥åˆ°äº†åŠ è½½ç±»çš„ä»»åŠ¡ã€‚</p><p>1ã€åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨é¦–å…ˆåˆ¤æ–­è‡ªå·±åŠ è½½è¿‡æ²¡æœ‰ï¼Œæ²¡æœ‰åŠ è½½è¿‡å°±äº¤ç»™çˆ¶ç±»åŠ è½½å™¨ - æ‰©å±•ç±»åŠ è½½å™¨ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1166.png" alt="img"></p><p>2ã€æ‰©å±•ç±»åŠ è½½å™¨ä¹Ÿæ²¡åŠ è½½è¿‡ï¼Œäº¤ç»™ä»–çš„çˆ¶ç±»åŠ è½½å™¨ - å¯åŠ¨ç±»åŠ è½½å™¨ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1167-1024x462.png" alt="img"></p><p>3ã€å¯åŠ¨ç±»åŠ è½½å™¨å‘ç°å·²ç»åŠ è½½è¿‡ï¼Œç›´æ¥è¿”å›ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1168-1024x448.png" alt="img"></p><h4 id="2-5-2æ¡ˆä¾‹2ï¼š">2.5.2æ¡ˆä¾‹2ï¼š</h4><p>Bç±»åœ¨æ‰©å±•ç±»åŠ è½½å™¨åŠ è½½è·¯å¾„ä¸­ï¼ŒåŒæ ·åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨æ¥åˆ°äº†åŠ è½½ä»»åŠ¡ï¼ŒæŒ‰ç…§æ¡ˆä¾‹1ä¸­çš„æ–¹å¼ä¸€å±‚ä¸€å±‚å‘ä¸ŠæŸ¥æ‰¾ï¼Œ<strong>å‘ç°éƒ½æ²¡æœ‰åŠ è½½è¿‡</strong>ã€‚é‚£ä¹ˆå¯åŠ¨ç±»åŠ è½½å™¨ä¼šé¦–å…ˆå°è¯•åŠ è½½ã€‚å®ƒå‘ç°è¿™ç±»ä¸åœ¨å®ƒçš„åŠ è½½ç›®å½•ä¸­ï¼Œå‘ä¸‹ä¼ é€’ç»™æ‰©å±•ç±»åŠ è½½å™¨ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1169-1024x438.png" alt="img"></p><p>æ‰©å±•ç±»åŠ è½½å™¨å‘ç°è¿™ä¸ªç±»åœ¨å®ƒåŠ è½½è·¯å¾„ä¸­ï¼ŒåŠ è½½æˆåŠŸå¹¶è¿”å›ã€‚ï¼ˆæ³¨ï¼š<strong>å¦‚æœæ‰€æœ‰ç±»åŠ è½½å™¨éƒ½æ— æ³•åŠ è½½è¿™ä¸ªç±»ï¼Œæœ€ç»ˆæŠ›å‡º ClassNotFoundException</strong>ï¼‰</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1170-1024x436.png" alt="img"></p><p>å¦‚æœç¬¬äºŒæ¬¡å†æ¥æ”¶åˆ°åŠ è½½ä»»åŠ¡ï¼ŒåŒæ ·åœ°å‘ä¸ŠæŸ¥æ‰¾ã€‚æ‰©å±•ç±»åŠ è½½å™¨å‘ç°å·²ç»åŠ è½½è¿‡ï¼Œå°±å¯ä»¥è¿”å›äº†ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1171-1024x440.png" alt="img"></p><h4 id="2-5-3åŒäº²å§”æ´¾æœºåˆ¶çš„ä½œç”¨">2.5.3åŒäº²å§”æ´¾æœºåˆ¶çš„ä½œç”¨</h4><ul><li>1.ä¿è¯ç±»åŠ è½½çš„å®‰å…¨æ€§ã€‚é€šè¿‡åŒäº²å§”æ´¾æœºåˆ¶é¿å…æ¶æ„ä»£ç æ›¿æ¢JDKä¸­çš„æ ¸å¿ƒç±»åº“ï¼Œæ¯”å¦‚java.lang.Stringï¼Œç¡®ä¿æ ¸å¿ƒç±»åº“çš„å®Œæ•´æ€§å’Œå®‰å…¨æ€§ã€‚</li><li>2.é¿å…é‡å¤åŠ è½½ã€‚åŒäº²å§”æ´¾æœºåˆ¶å¯ä»¥é¿å…åŒä¸€ä¸ªç±»è¢«å¤šæ¬¡åŠ è½½ã€‚</li></ul><h4 id="2-5-4å¦‚ä½•æŒ‡å®šåŠ è½½ç±»çš„ç±»åŠ è½½å™¨ï¼Ÿ">2.5.4å¦‚ä½•æŒ‡å®šåŠ è½½ç±»çš„ç±»åŠ è½½å™¨ï¼Ÿ</h4><p>åœ¨Javaä¸­å¦‚ä½•ä½¿ç”¨ä»£ç çš„æ–¹å¼å»ä¸»åŠ¨åŠ è½½ä¸€ä¸ªç±»å‘¢ï¼Ÿ</p><p>æ–¹å¼1ï¼šä½¿ç”¨Class.forNameæ–¹æ³•ï¼Œä½¿ç”¨å½“å‰ç±»çš„ç±»åŠ è½½å™¨å»åŠ è½½æŒ‡å®šçš„ç±»ã€‚</p><p>æ–¹å¼2ï¼šè·å–åˆ°ç±»åŠ è½½å™¨ï¼Œé€šè¿‡ç±»åŠ è½½å™¨çš„loadClassæ–¹æ³•æŒ‡å®šæŸä¸ªç±»åŠ è½½å™¨åŠ è½½ã€‚</p><p>ä¾‹å¦‚ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1172.png" alt="img"></p><h4 id="2-5-5ä¸‰ä¸ªé¢è¯•é¢˜">2.5.5ä¸‰ä¸ªé¢è¯•é¢˜</h4><p>1ã€å¦‚æœä¸€ä¸ªç±»é‡å¤å‡ºç°åœ¨ä¸‰ä¸ªç±»åŠ è½½å™¨çš„åŠ è½½ä½ç½®ï¼Œåº”è¯¥ç”±è°æ¥åŠ è½½ï¼Ÿ</p><p>å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ï¼Œæ ¹æ®åŒäº²å§”æ´¾æœºåˆ¶ï¼Œå®ƒçš„ä¼˜å…ˆçº§æ˜¯æœ€é«˜çš„</p><p>2ã€Stringç±»èƒ½è¦†ç›–å—ï¼Œåœ¨è‡ªå·±çš„é¡¹ç›®ä¸­å»åˆ›å»ºä¸€ä¸ªjava.lang.Stringç±»ï¼Œä¼šè¢«åŠ è½½å—ï¼Ÿ</p><p>ä¸èƒ½ï¼Œä¼šè¿”å›å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½åœ¨rt.jaråŒ…ä¸­çš„Stringç±»ã€‚</p><p>3ã€<strong>ç±»çš„åŒäº²å§”æ´¾æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ</strong>ï¼ˆï¼ï¼‰</p><ul><li><p>1.å…ˆæè¿°åŒäº²å§”æ´¾æœºåˆ¶çš„æµç¨‹ã€‚</p></li><li><p>2.ç„¶åæè¿°ç±»åŠ è½½å™¨ä¹‹é—´çš„å…³ç³»ã€‚</p></li><li><p>3.åŒäº²å§”æ´¾æœºåˆ¶çš„å¥½å¤„</p></li><li><p>å½“ä¸€ä¸ªç±»åŠ è½½å™¨å»åŠ è½½æŸä¸ªç±»çš„æ—¶å€™ï¼Œä¼šè‡ªåº•å‘ä¸ŠæŸ¥æ‰¾æ˜¯å¦åŠ è½½è¿‡ï¼Œå¦‚æœåŠ è½½è¿‡å°±ç›´æ¥è¿”å›ï¼Œå¦‚æœä¸€ç›´åˆ°æœ€é¡¶å±‚çš„ç±»åŠ è½½å™¨éƒ½æ²¡æœ‰åŠ è½½ï¼Œå†ç”±é¡¶å‘ä¸‹è¿›è¡ŒåŠ è½½ã€‚</p></li><li><p>åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨æ˜¯æ‰©å±•ç±»åŠ è½½å™¨ï¼Œæ‰©å±•ç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨æ˜¯å¯åŠ¨ç±»åŠ è½½å™¨ã€‚</p></li><li><p>åŒäº²å§”æ´¾æœºåˆ¶çš„å¥½å¤„æœ‰ä¸¤ç‚¹ï¼šç¬¬ä¸€æ˜¯é¿å…æ¶æ„ä»£ç æ›¿æ¢JDKä¸­çš„æ ¸å¿ƒç±»åº“ï¼Œæ¯”å¦‚java.lang.Stringï¼Œç¡®ä¿æ ¸å¿ƒç±»åº“çš„å®Œæ•´æ€§å’Œå®‰å…¨æ€§ã€‚ç¬¬äºŒæ˜¯é¿å…ä¸€ä¸ªç±»é‡å¤åœ°è¢«åŠ è½½ã€‚</p></li></ul><h3 id="2-6æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶">2.6æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶</h3><p>æœ‰ä¸‰ç§æ–¹å¼ï¼Œä½†æœ¬è´¨ä¸Šåªæœ‰ç¬¬ä¸€ç§ç®—æ˜¯çœŸæ­£çš„æ‰“ç ´äº†åŒäº²å§”æ´¾æœºåˆ¶ï¼š</p><ul><li>è‡ªå®šä¹‰ç±»åŠ è½½å™¨å¹¶ä¸”é‡å†™loadClassæ–¹æ³•ã€‚Tomcaté€šè¿‡è¿™ç§æ–¹å¼å®ç°åº”ç”¨ä¹‹é—´ç±»éš”ç¦»ï¼Œã€Šé¢è¯•ç¯‡ã€‹ä¸­åˆ†äº«å®ƒçš„åšæ³•ã€‚</li><li>çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚åˆ©ç”¨ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨åŠ è½½ç±»ï¼Œæ¯”å¦‚JDBCå’ŒJNDIç­‰ã€‚</li><li>Osgiæ¡†æ¶çš„ç±»åŠ è½½å™¨ã€‚å†å²ä¸ŠOsgiæ¡†æ¶å®ç°äº†ä¸€å¥—æ–°çš„ç±»åŠ è½½å™¨æœºåˆ¶ï¼Œå…è®¸åŒçº§ä¹‹é—´å§”æ‰˜è¿›è¡Œç±»çš„åŠ è½½ï¼Œç›®å‰å¾ˆå°‘ä½¿ç”¨ã€‚</li></ul><h4 id="2-6-1æ‰“ç ´ç±»çš„åŒäº²å§”æ´¾æœºåˆ¶-è‡ªå®šä¹‰ç±»åŠ è½½å™¨">2.6.1æ‰“ç ´ç±»çš„åŒäº²å§”æ´¾æœºåˆ¶ è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h4><p>ä¸€ä¸ªTomcatç¨‹åºä¸­æ˜¯å¯ä»¥è¿è¡Œå¤šä¸ªWebåº”ç”¨çš„ï¼Œå¦‚æœè¿™ä¸¤ä¸ªåº”ç”¨ä¸­å‡ºç°äº†ç›¸åŒé™å®šåçš„ç±»ï¼Œæ¯”å¦‚Servletç±»ï¼ŒTomcatè¦ä¿è¯è¿™ä¸¤ä¸ªç±»éƒ½èƒ½åŠ è½½å¹¶ä¸”å®ƒä»¬åº”è¯¥æ˜¯ä¸åŒçš„ç±»ã€‚å¦‚æœä¸æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ï¼Œå½“åº”ç”¨ç±»åŠ è½½å™¨åŠ è½½Webåº”ç”¨1ä¸­çš„MyServletä¹‹åï¼ŒWebåº”ç”¨2ä¸­ç›¸åŒé™å®šåçš„MyServletç±»å°±æ— æ³•è¢«åŠ è½½äº†ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1173.png" alt="img"></p><p>Tomcatä½¿ç”¨äº†è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ¥å®ç°åº”ç”¨ä¹‹é—´ç±»çš„éš”ç¦»ã€‚ æ¯ä¸€ä¸ªåº”ç”¨ä¼šæœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç±»åŠ è½½å™¨åŠ è½½å¯¹åº”çš„ç±»ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1174.png" alt="img"></p><p>é‚£ä¹ˆè‡ªå®šä¹‰åŠ è½½å™¨æ˜¯å¦‚ä½•èƒ½åšåˆ°çš„å‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶çš„ä»£ç åˆ°åº•åœ¨å“ªé‡Œï¼Œæ¥ä¸‹æ¥åªéœ€è¦æŠŠè¿™æ®µä»£ç æ¶ˆé™¤å³å¯ã€‚</p><p>ClassLoaderä¸­åŒ…å«äº†4ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶çš„æ ¸å¿ƒä»£ç å°±ä½äºloadClassæ–¹æ³•ä¸­ã€‚</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">Class</span>&lt;?&gt; loadClass(String <span class="keyword">name</span>)</span><br><span class="line">ç±»åŠ è½½çš„å…¥å£ï¼Œæä¾›äº†åŒäº²å§”æ´¾æœºåˆ¶ã€‚å†…éƒ¨ä¼šè°ƒç”¨findClass   é‡è¦</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">Class</span>&lt;?&gt; findClass(String <span class="keyword">name</span>)</span><br><span class="line">ç”±ç±»åŠ è½½å™¨å­ç±»å®ç°,è·å–äºŒè¿›åˆ¶æ•°æ®è°ƒç”¨defineClass ï¼Œæ¯”å¦‚URLClassLoaderä¼šæ ¹æ®æ–‡ä»¶è·¯å¾„å»è·å–ç±»æ–‡ä»¶ä¸­çš„äºŒè¿›åˆ¶æ•°æ®ã€‚    é‡è¦</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">Class</span>&lt;?&gt; defineClass(String <span class="keyword">name</span>, byte[] b, <span class="built_in">int</span> off, <span class="built_in">int</span> len)</span><br><span class="line">åšä¸€äº›ç±»åçš„æ ¡éªŒï¼Œç„¶åè°ƒç”¨è™šæ‹Ÿæœºåº•å±‚çš„æ–¹æ³•å°†å­—èŠ‚ç ä¿¡æ¯åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> void resolveClass(<span class="keyword">Class</span>&lt;?&gt; c)</span><br><span class="line">æ‰§è¡Œç±»ç”Ÿå‘½å‘¨æœŸä¸­çš„è¿æ¥é˜¶æ®µ</span><br></pre></td></tr></table></figure><p>æ³¨ï¼š</p><ul><li><ol><li>è‡ªå®šä¹‰ç±»åŠ è½½å™¨å¯ä»¥é‡å†™findClassæ–¹æ³•æ¥<strong>è‡ªå®šä¹‰è·å–å­—èŠ‚ç ä¿¡æ¯çš„é€”å¾„</strong>ã€‚</li></ol></li><li><ol start="2"><li>å¦‚æœæƒ³é€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ¥æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶åˆ™éœ€è¦é‡å†™loadClassæ–¹æ³•ï¼Œä¸å†å®ç°åŒäº²å§”æ´¾æœºåˆ¶ã€‚</li></ol></li></ul><p>å…³äºfindClassï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1175-1024x403.png" alt="img"></p><p>æˆ‘ä»¬æ¥ç€ç»§ç»­çœ‹ClassLoaderä¸­4ä¸ªæ ¸å¿ƒæ–¹æ³•</p><p>1ã€å…¥å£æ–¹æ³•ï¼šï¼ˆé‡‡ç”¨ç±»åŠ è½½å™¨.loadclassæ–¹æ³•é»˜è®¤ä¸ä¼šæ‰§è¡Œè¿æ¥å’Œåˆå§‹åŒ–ã€‚è€Œä½¿ç”¨Class.forNmaeï¼ˆï¼‰ä¼šæ‰§è¡Œè¿æ¥å’Œåˆå§‹åŒ–ã€‚ï¼‰</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1176.png" alt="img"></p><p>2ã€å†è¿›å…¥çœ‹ä¸‹ï¼šï¼ˆsynchronizedä¿è¯å¤šçº¿ç¨‹æ¡ä»¶ä¸‹åŒä¸€ä¸ªç±»ä¸ä¼šè¢«å¤šæ¬¡åŠ è½½ï¼‰</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1177.png" alt="img"></p><p>å¦‚æœæŸ¥æ‰¾éƒ½å¤±è´¥ï¼Œè¿›å…¥åŠ è½½é˜¶æ®µï¼Œé¦–å…ˆä¼šç”±å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ï¼Œè¿™æ®µä»£ç åœ¨<code>findBootstrapClassOrNull</code>ä¸­ã€‚å¦‚æœå¤±è´¥ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ¥ä¸‹æ¥æ‰§è¡Œä¸‹é¢è¿™æ®µä»£ç ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1178.png" alt="img"></p><p>çˆ¶ç±»åŠ è½½å™¨åŠ è½½å¤±è´¥å°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå›åˆ°å­ç±»åŠ è½½å™¨çš„è¿™æ®µä»£ç ï¼Œè¿™æ ·å°±å®ç°äº†åŠ è½½å¹¶å‘ä¸‹ä¼ é€’ã€‚</p><p>3ã€æœ€åæ ¹æ®ä¼ å…¥çš„å‚æ•°åˆ¤æ–­æ˜¯å¦è¿›å…¥è¿æ¥é˜¶æ®µï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1179.png" alt="img"></p><p>ä»¥ä¸‹ä»£ç ï¼š<strong>é€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ¥æ‰“ç ´ Java çš„åŒäº²å§”æ´¾æœºåˆ¶</strong>ï¼Œå®ç°å¯¹åŒä¸€ä¸ªç±»æ–‡ä»¶çš„â€œé‡å¤åŠ è½½â€ï¼Œä»è€Œå¾—åˆ°ä¸¤ä¸ª<strong>äº’ç›¸ä¸ç­‰çš„ç±»å¯¹è±¡</strong>ï¼ˆç±»å¯¹è±¡å±‚é¢ä¸åŒï¼‰ã€‚</p><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">packageclassloader</span>.<span class="property">broken</span>;<span class="comment">//package com.itheima.jvm.chapter02.classloader.broken;importorg.apache.commons.io.IOUtils;</span></span><br><span class="line"></span><br><span class="line">importjava.<span class="property">io</span>.<span class="property">File</span>;</span><br><span class="line">importjava.<span class="property">io</span>.<span class="property">FileInputStream</span>;</span><br><span class="line">importjava.<span class="property">io</span>.<span class="property">IOException</span>;</span><br><span class="line">importjava.<span class="property">io</span>.<span class="property">InputStream</span>;</span><br><span class="line">importjava.<span class="property">nio</span>.<span class="property">charset</span>.<span class="property">StandardCharsets</span>;</span><br><span class="line">importjava.<span class="property">security</span>.<span class="property">ProtectionDomain</span>;</span><br><span class="line">importjava.<span class="property">util</span>.<span class="property">regex</span>.<span class="property">Matcher</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** * æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ - è‡ªå®šä¹‰ç±»åŠ è½½å™¨ */</span><span class="variable">publicclassBreakClassLoader1</span> <span class="title function_">extendsClassLoader</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">private</span> <span class="title class_">String</span> <span class="variable">basePath</span>;</span><br><span class="line">    <span class="variable">private</span> <span class="variable">final</span> <span class="keyword">static</span> <span class="title class_">String</span> <span class="variable">FILE_EXT</span><span class="operator">=</span> <span class="string">&quot;.class&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è®¾ç½®åŠ è½½ç›®å½•</span></span><br><span class="line">    <span class="variable">public</span> <span class="variable">void</span> <span class="title function_">setBasePath</span>(<span class="params">String</span> <span class="params">basePath</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">basePath</span> <span class="operator">=</span> <span class="variable">basePath</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä½¿ç”¨commons io ä»æŒ‡å®šç›®å½•ä¸‹åŠ è½½æ–‡ä»¶</span></span><br><span class="line">    <span class="variable">private</span> <span class="variable">byte</span>[] <span class="title function_">loadClassData</span>(<span class="params">String</span> <span class="params">name</span>)  &#123;</span><br><span class="line">        <span class="title function_">try</span>&#123;</span><br><span class="line">            <span class="title class_">String</span> <span class="variable">tempName</span> <span class="operator">=</span> <span class="variable">name</span>.<span class="property">replaceAll</span>(<span class="string">&quot;<span class="char escape_">\\</span>.&quot;</span>, <span class="title class_">Matcher</span>.<span class="property">quoteReplacement</span>(<span class="title class_">File</span>.<span class="property">separator</span>));</span><br><span class="line">            <span class="title class_">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="title function_">newFileInputStream</span>(<span class="variable">basePath</span> <span class="operator">+</span> <span class="variable">tempName</span> <span class="operator">+</span> <span class="variable">FILE_EXT</span>);</span><br><span class="line">            <span class="title function_">try</span>&#123;</span><br><span class="line">                returnIOUtils.<span class="property">toByteArray</span>(<span class="variable">fis</span>);</span><br><span class="line">            &#125; <span class="title function_">finally</span>&#123;</span><br><span class="line">                <span class="title class_">IOUtils</span>.<span class="property">closeQuietly</span>(<span class="variable">fis</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="title function_">catch</span>(<span class="params">Exception</span> <span class="params">e</span>) &#123;</span><br><span class="line">            <span class="title class_">System</span>.<span class="property">out</span>.<span class="property">println</span>(<span class="string">&quot;è‡ªå®šä¹‰ç±»åŠ è½½å™¨åŠ è½½å¤±è´¥ï¼Œé”™è¯¯åŸå› ï¼š&quot;</span><span class="operator">+</span> <span class="variable">e</span>.<span class="property">getMessage</span>());</span><br><span class="line">            returnnull;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é‡å†™loadClassæ–¹æ³•</span></span><br><span class="line">    @<span class="title class_">Override</span></span><br><span class="line">    <span class="variable">public</span> <span class="title class_">Class</span><span class="operator">&lt;</span>?<span class="operator">&gt;</span> <span class="title function_">loadClass</span>(<span class="title class_">String</span> <span class="variable">name</span>) <span class="title function_">throwsClassNotFoundException</span> &#123;</span><br><span class="line">        <span class="comment">//å¦‚æœæ˜¯javaåŒ…ä¸‹ï¼Œè¿˜æ˜¯èµ°åŒäº²å§”æ´¾æœºåˆ¶</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">name</span>.<span class="property">startsWith</span>(<span class="string">&quot;java.&quot;</span>))&#123;</span><br><span class="line">            returnsuper.<span class="property">loadClass</span>(<span class="variable">name</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ä»ç£ç›˜ä¸­æŒ‡å®šç›®å½•ä¸‹åŠ è½½</span></span><br><span class="line">        <span class="variable">byte</span>[] <span class="variable">data</span> <span class="operator">=</span> <span class="title function_">loadClassData</span>(<span class="variable">name</span>);</span><br><span class="line">        <span class="comment">//è°ƒç”¨è™šæ‹Ÿæœºåº•å±‚æ–¹æ³•ï¼Œæ–¹æ³•åŒºå’Œå †åŒºåˆ›å»ºå¯¹è±¡</span></span><br><span class="line">        <span class="title function_">returndefineClass</span>(<span class="variable">name</span>, <span class="variable">data</span>, <span class="number">0</span>, <span class="variable">data</span>.<span class="property">length</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">public</span> <span class="keyword">static</span> <span class="variable">void</span> <span class="title function_">main</span>(<span class="title class_">String</span>[] <span class="variable">args</span>) <span class="variable">throwsClassNotFoundException</span>, <span class="title class_">InstantiationException</span>, <span class="title class_">IllegalAccessException</span>, <span class="title class_">IOException</span> &#123;</span><br><span class="line">        <span class="comment">//ç¬¬ä¸€ä¸ªè‡ªå®šä¹‰ç±»åŠ è½½å™¨å¯¹è±¡</span></span><br><span class="line">        <span class="title class_">BreakClassLoader</span>1 classLoader1 <span class="operator">=</span> <span class="title function_">newBreakClassLoader1</span>();</span><br><span class="line">        classLoader1.<span class="property">setBasePath</span>(<span class="string">&quot;D:<span class="char escape_">\\</span>lib<span class="char escape_">\\</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Class</span><span class="operator">&lt;</span>?<span class="operator">&gt;</span> <span class="variable">clazz1</span> <span class="operator">=</span> classLoader1.<span class="property">loadClass</span>(<span class="string">&quot;com.itheima.my.A&quot;</span>);</span><br><span class="line">         <span class="comment">//ç¬¬äºŒä¸ªè‡ªå®šä¹‰ç±»åŠ è½½å™¨å¯¹è±¡</span></span><br><span class="line">        <span class="title class_">BreakClassLoader</span>1 classLoader2 <span class="operator">=</span> <span class="title function_">newBreakClassLoader1</span>();</span><br><span class="line">        classLoader2.<span class="property">setBasePath</span>(<span class="string">&quot;D:<span class="char escape_">\\</span>lib<span class="char escape_">\\</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Class</span><span class="operator">&lt;</span>?<span class="operator">&gt;</span> <span class="variable">clazz2</span> <span class="operator">=</span> classLoader2.<span class="property">loadClass</span>(<span class="string">&quot;com.itheima.my.A&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="property">println</span>(<span class="variable">clazz1</span> <span class="operator">==</span> <span class="variable">clazz2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Thread</span>.<span class="property">currentThread</span>().<span class="property">setContextClassLoader</span>(classLoader1);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="property">println</span>(<span class="title class_">Thread</span>.<span class="property">currentThread</span>().<span class="property">getContextClassLoader</span>());</span><br><span class="line"></span><br><span class="line">        <span class="title class_">System</span>.<span class="property">in</span>.<span class="property">read</span>();</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Java ä¸­â€œç±»ç›¸ç­‰â€çš„åˆ¤æ–­ä¸ä»…çœ‹ç±»åæ˜¯å¦ç›¸åŒï¼Œè¿˜è¦çœ‹æ˜¯ç”±â€œå“ªä¸ªç±»åŠ è½½å™¨â€åŠ è½½çš„ã€‚åŒåç±»å¦‚æœç”±ä¸åŒåŠ è½½å™¨åŠ è½½ï¼ŒJVM ä¼šè®¤ä¸ºå®ƒä»¬æ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»ã€‚</strong></p><h5 id="è‡ªå®šä¹‰ç±»åŠ è½½å™¨çˆ¶ç±»æ€ä¹ˆæ˜¯AppClassLoaderå‘¢ï¼Ÿ"><strong>è‡ªå®šä¹‰ç±»åŠ è½½å™¨çˆ¶ç±»æ€ä¹ˆæ˜¯AppClassLoaderå‘¢ï¼Ÿ</strong></h5><p>åœ¨ä¸æ‰‹åŠ¨æŒ‡å®šçˆ¶åŠ è½½å™¨çš„æƒ…å†µä¸‹ï¼Œè‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„çˆ¶åŠ è½½å™¨é»˜è®¤æ˜¯ <strong>åº”ç”¨ç±»åŠ è½½å™¨ï¼ˆAppClassLoaderï¼‰</strong>ï¼Œä¹Ÿå°±æ˜¯åŠ è½½æˆ‘ä»¬é¡¹ç›®ä»£ç çš„é‚£ä¸ªåŠ è½½å™¨ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1180.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1183-1024x524.png" alt="img"></p><p>ä»¥Jdk8ä¸ºä¾‹ï¼ŒClassLoaderç±»ä¸­æä¾›äº†æ„é€ æ–¹æ³•è®¾ç½®parentçš„å†…å®¹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1181.png" alt="img"></p><p>è¿™ä¸ªæ„é€ æ–¹æ³•ç”±å¦å¤–ä¸€ä¸ªæ„é€ æ–¹æ³•è°ƒç”¨ï¼Œå…¶ä¸­çˆ¶ç±»åŠ è½½å™¨ç”±getSystemClassLoaderæ–¹æ³•è®¾ç½®ï¼Œè¯¥æ–¹æ³•è¿”å›çš„æ˜¯AppClassLoaderã€‚ï¼ˆ<code>ClassLoader</code> æ„é€ å™¨ä¸­æ˜¯å¦‚ä½•è®¾ç½® parent çš„ï¼Ÿï¼‰</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1182.png" alt="img"></p><ul><li><code>getSystemClassLoader()</code> ä¼šè¿”å›å½“å‰ JVM çš„ç³»ç»Ÿç±»åŠ è½½å™¨ï¼ˆä¹Ÿå°±æ˜¯ AppClassLoaderï¼‰ï¼›</li><li>æ‰€ä»¥ï¼Œå¦‚æœä½ ä¸æ˜¾å¼å†™ <code>super(xxx)</code>ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¸®ä½ ä¼ å…¥ <code>AppClassLoader</code> ä½œä¸ºçˆ¶åŠ è½½å™¨ã€‚</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1184-1024x372.png" alt="img"></p><p><strong>æƒ³æ”¹å˜é»˜è®¤çˆ¶åŠ è½½å™¨æ€ä¹ˆåŠï¼Ÿ</strong></p><p>å¯ä»¥ç”¨å¦‚ä¸‹æ–¹å¼æŒ‡å®šï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ClassLoader</span> <span class="variable">myLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyClassLoader</span>(ClassLoader.getSystemClassLoader().getParent()); <span class="comment">// æŠŠ parent æŒ‡å®šä¸º ExtClassLoader</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…å¯ä»¥é‡å†™å­ç±»çš„æ„é€ æ–¹æ³•ï¼Œä½¿ç”¨ <code>super(è‡ªå®šä¹‰parent)</code> æŒ‡å®šæƒ³è¦çš„çˆ¶åŠ è½½å™¨ã€‚</p><h5 id="ä¸¤ä¸ªè‡ªå®šä¹‰ç±»åŠ è½½å™¨åŠ è½½ç›¸åŒé™å®šåçš„ç±»ï¼Œä¸ä¼šå†²çªå—ï¼Ÿ"><strong>ä¸¤ä¸ªè‡ªå®šä¹‰ç±»åŠ è½½å™¨åŠ è½½ç›¸åŒé™å®šåçš„ç±»ï¼Œä¸ä¼šå†²çªå—ï¼Ÿ</strong></h5><p><strong>ä¸ä¼šå†²çª</strong>ï¼Œåœ¨åŒä¸€ä¸ªJavaè™šæ‹Ÿæœºä¸­ï¼Œåªæœ‰<strong>ç›¸åŒç±»åŠ è½½å™¨+ç›¸åŒçš„ç±»é™å®šåæ‰ä¼šè¢«è®¤ä¸ºæ˜¯åŒä¸€ä¸ªç±»</strong>ã€‚</p><p>åœ¨Arthasä¸­ä½¿ç”¨sc â€“d ç±»åçš„æ–¹å¼æŸ¥çœ‹å…·ä½“çš„æƒ…å†µã€‚</p><p>å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">public</span> <span class="keyword">static</span> <span class="variable">void</span> <span class="title function_">main</span>(<span class="title class_">String</span>[] <span class="variable">args</span>) <span class="variable">throwsClassNotFoundException</span>, <span class="title class_">InstantiationException</span>, <span class="title class_">IllegalAccessException</span>, <span class="title class_">IOException</span> &#123;</span><br><span class="line">        <span class="comment">//ç¬¬ä¸€ä¸ªè‡ªå®šä¹‰ç±»åŠ è½½å™¨å¯¹è±¡</span></span><br><span class="line">        <span class="title class_">BreakClassLoader</span>1 classLoader1 <span class="operator">=</span> <span class="title function_">newBreakClassLoader1</span>();</span><br><span class="line">        classLoader1.<span class="property">setBasePath</span>(<span class="string">&quot;D:<span class="char escape_">\\</span>lib<span class="char escape_">\\</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Class</span><span class="operator">&lt;</span>?<span class="operator">&gt;</span> <span class="variable">clazz1</span> <span class="operator">=</span> classLoader1.<span class="property">loadClass</span>(<span class="string">&quot;com.itheima.my.A&quot;</span>);</span><br><span class="line">         <span class="comment">//ç¬¬äºŒä¸ªè‡ªå®šä¹‰ç±»åŠ è½½å™¨å¯¹è±¡</span></span><br><span class="line">        <span class="title class_">BreakClassLoader</span>1 classLoader2 <span class="operator">=</span> <span class="title function_">newBreakClassLoader1</span>();</span><br><span class="line">        classLoader2.<span class="property">setBasePath</span>(<span class="string">&quot;D:<span class="char escape_">\\</span>lib<span class="char escape_">\\</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Class</span><span class="operator">&lt;</span>?<span class="operator">&gt;</span> <span class="variable">clazz2</span> <span class="operator">=</span> classLoader2.<span class="property">loadClass</span>(<span class="string">&quot;com.itheima.my.A&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="property">println</span>(<span class="variable">clazz1</span> <span class="operator">==</span> <span class="variable">clazz2</span>);</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure><p>æ‰“å°çš„åº”è¯¥æ˜¯falseï¼Œå› ä¸ºä¸¤ä¸ªç±»åŠ è½½å™¨ä¸åŒï¼Œå°½ç®¡åŠ è½½çš„æ˜¯åŒä¸€ä¸ªç±»åï¼Œæœ€ç»ˆClasså¯¹è±¡ä¹Ÿä¸æ˜¯ç›¸åŒçš„ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1185.png" alt="img"></p><p>é€šè¿‡Arthasçœ‹ä¹Ÿä¼šå‡ºç°ä¸¤ä¸ªä¸åŒçš„Aç±»ã€‚</p><h4 id="è¡¥å……ï¼šå…³äºloadClasså’ŒfindClass">è¡¥å……ï¼šå…³äºloadClasså’ŒfindClass</h4><p>å¦‚æœè¦æ‰©å±•ä¸€ä¸ªç±»çš„åŠ è½½çš„æ¸ é“ï¼Œåº”è¯¥æ˜¯é‡å†™findClassæ–¹æ³•ï¼Œè€Œä¸æ˜¯loadClasså»æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1186-1024x463.png" alt="img"></p><p><code>loadClass()</code> æ–¹æ³•æ˜¯æ•´ä¸ªç±»åŠ è½½æµç¨‹çš„â€œå…¥å£â€ï¼Œ<strong>åŒ…å«äº†åŒäº²å§”æ´¾çš„é€»è¾‘</strong>ï¼›<br>å¦‚æœä½ æƒ³è‡ªå·±å®šä¹‰æ€ä¹ˆåŠ è½½ä¸€ä¸ªç±»ï¼Œ<strong>åº”è¯¥é‡å†™ <code>findClass()</code>ï¼Œè€Œä¸æ˜¯ç¯¡æ”¹ <code>loadClass()</code> çš„æµç¨‹</strong>ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1187-1024x768.png" alt="img"></p><p><strong><code>findClass(String name)</code>ï¼ˆå­ç±»å®ç°ï¼‰</strong></p><p>ä½ åªè¦é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œå°±å¯ä»¥å®šä¹‰è‡ªå·±çš„â€œåŠ è½½ç­–ç•¥â€ï¼šæ¯”å¦‚ä»æœ¬åœ°æ–‡ä»¶ã€ç½‘ç»œã€æ•°æ®åº“è¯»å–å­—èŠ‚ç ï¼Œç„¶åç”¨ <code>defineClass()</code> è½¬æ¢ä¸º JVM ç±»å¯¹è±¡ã€‚</p><p>æ€»ç»“ï¼šå¦‚æœä½ è¦â€œæ‰©å±•åŠ è½½é€»è¾‘â€ä½† <strong>ä¸æƒ³ç ´ååŒäº²å§”æ´¾æœºåˆ¶</strong>ï¼ˆæ¯”å¦‚åŠ ä¸€ä¸ªæ–°çš„åŠ è½½è·¯å¾„ã€ä»åŠ å¯† JAR åŠ è½½ï¼‰ï¼Œåº”è¯¥ <strong>åªé‡å†™ <code>findClass()</code></strong>ï¼›<br>å¦‚æœä½ è¦â€œæ‰“ç ´å§”æ´¾æœºåˆ¶â€å®ç°â€œç±»éš”ç¦»ã€æ’ä»¶æ²™ç®±â€ï¼Œå¯ä»¥ <strong>é‡å†™ <code>loadClass()</code> ä½†è¦æ¸…æ¥šé£é™©</strong>ã€‚</p><h4 id="2-6-2æ‰“ç ´ç±»çš„åŒäº²å§”æ´¾æœºåˆ¶-çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨">2.6.2æ‰“ç ´ç±»çš„åŒäº²å§”æ´¾æœºåˆ¶ çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨</h4><p>åˆ©ç”¨ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨åŠ è½½ç±»ï¼Œæ¯”å¦‚JDBCå’ŒJNDIç­‰ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹JDBCçš„æ¡ˆä¾‹ï¼š</p><p>1ã€JDBCä¸­ä½¿ç”¨äº†DriverManageræ¥ç®¡ç†é¡¹ç›®ä¸­å¼•å…¥çš„ä¸åŒæ•°æ®åº“çš„é©±åŠ¨ï¼Œæ¯”å¦‚mysqlé©±åŠ¨ã€oracleé©±åŠ¨ã€‚</p><p>2.DriverManagerå±äºrt.jaræ˜¯å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1188.png" alt="img"></p><p>3ã€ä¾èµ–ä¸­çš„mysqlé©±åŠ¨å¯¹åº”çš„ç±»ï¼Œç”±åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨æ¥åŠ è½½ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1190.png" alt="img"></p><p>åœ¨ç±»ä¸­æœ‰åˆå§‹åŒ–ä»£ç ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1191.png" alt="img"></p><p>DriverManagerå±äºrt.jaræ˜¯å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ã€‚è€Œç”¨æˆ·jaråŒ…ä¸­çš„é©±åŠ¨éœ€è¦ç”±åº”ç”¨ç±»åŠ è½½å™¨åŠ è½½ï¼Œ<em>è¿™å°±è¿åäº†åŒäº²å§”æ´¾æœºåˆ¶</em>ã€‚ï¼ˆè¿™ç‚¹å­˜ç–‘ï¼Œä¸€ä¼šå„¿å†è®¨è®ºï¼‰</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼ŒDriverManageræ€ä¹ˆçŸ¥é“jaråŒ…ä¸­è¦åŠ è½½çš„é©±åŠ¨åœ¨å“ªå„¿ï¼Ÿ</p><p>æ­¥éª¤ 1ï¼šDriver ç±»ä¸­çš„ static å—ä¼šæ³¨å†Œé©±åŠ¨</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    DriverManager.registerDriver(<span class="keyword">new</span> Driver());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ mysql é©±åŠ¨ç±»åŠ è½½æ—¶ï¼Œå®ƒè‡ªå·±ä¼šæ³¨å†Œåˆ° DriverManager ä¸­</p><p>2ã€DriverManager å¯åŠ¨æ—¶ä¼šè°ƒç”¨ <code>loadInitialDrivers()</code></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1192.png" alt="img"></p><p>è¿™ä¸ª<code>loadInitialDrivers()</code>é‡Œç”¨åˆ°äº† <strong>JDK æä¾›çš„ SPI æœºåˆ¶</strong>ï¼Œè‡ªåŠ¨æ‰«æ classpath ä¸‹æ‰€æœ‰å®ç°äº† <code>java.sql.Driver</code> æ¥å£çš„ç±»ã€‚</p><p>3ã€è¿™é‡Œä½¿ç”¨äº†SPIæœºåˆ¶ï¼Œå»åŠ è½½æ‰€æœ‰jaråŒ…ä¸­å®ç°äº†Driveræ¥å£çš„å®ç°ç±»ã€‚ï¼ˆspiå…¨ç§°ä¸ºï¼ˆService Provider Interfaceï¼‰ï¼Œæ˜¯JDKå†…ç½®çš„ä¸€ç§æœåŠ¡æä¾›å‘ç°æœºåˆ¶ã€‚ï¼‰</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1193-1024x767.png" alt="img"></p><p>SPI æœºåˆ¶ä»å“ªé‡Œæ‰¾è¿™äº›â€œå®ç°ç±»â€ï¼Ÿ</p><p>å®ƒå»æ‰¾æ¯ä¸ª jar åŒ…é‡Œçš„ï¼š</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">META</span>-<span class="keyword">INF</span>/services/java.sql.Driver</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶ä¸­å†™çš„å°±æ˜¯å®ç°ç±»åï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">com<span class="selector-class">.mysql</span><span class="selector-class">.cj</span><span class="selector-class">.jdbc</span>.Drive</span><br></pre></td></tr></table></figure><p>4ã€SPI æœºåˆ¶ä»å“ªé‡Œæ‰¾è¿™äº›â€œå®ç°ç±»â€ï¼Ÿ</p><p>å®ƒå»æ‰¾æ¯ä¸ª jar åŒ…é‡Œçš„ï¼š</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">META</span>-<span class="keyword">INF</span>/services/java.sql.Driver</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶ä¸­å†™çš„å°±æ˜¯å®ç°ç±»åï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">com<span class="selector-class">.mysql</span><span class="selector-class">.cj</span><span class="selector-class">.jdbc</span>.Drive</span><br></pre></td></tr></table></figure><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1195.png" alt="img"></p><p>5ã€SPI æ˜¯ç”¨å“ªä¸ªç±»åŠ è½½å™¨åŠ è½½è¿™äº›ç±»çš„ï¼Ÿ</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ClassLoader cl <span class="operator">=</span> Thread.currentThread().getContextClassLoader()<span class="comment">;</span></span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨å½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨</strong>ï¼Œå³ AppClassLoaderï¼Œæ¥åŠ è½½é©±åŠ¨ç±»ï¼</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1196-1024x190.png" alt="img"></p><h5 id="æ€»ç»“ï¼š">æ€»ç»“ï¼š</h5><p><strong>èƒŒæ™¯ï¼šJDBC é©±åŠ¨æ€ä¹ˆåŠ è½½çš„ï¼Ÿ</strong></p><p>æˆ‘ä»¬åœ¨å†™ JDBC è¿æ¥æ•°æ®åº“æ—¶ï¼Œé€šå¸¸ä¸éœ€è¦æ˜¾å¼åŠ è½½é©±åŠ¨ç±»ï¼ˆ<code>Class.forName(&quot;com.mysql.cj.jdbc.Driver&quot;)</code>ï¼‰ï¼ŒJVM ä¼šè‡ªåŠ¨å®ŒæˆåŠ è½½ã€‚é‚£ä¹ˆ JVM æ˜¯æ€ä¹ˆçŸ¥é“ mysql é©±åŠ¨åœ¨å“ªçš„å‘¢ï¼Ÿ</p><p>å…³é”®è§’è‰²ï¼šDriverManager + SPIæœºåˆ¶ + çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨</p><ol><li>DriverManager æ˜¯è°åŠ è½½çš„ï¼Ÿ</li></ol><ul><li><p><code>DriverManager</code> ç±»åœ¨ <code>rt.jar</code> ä¸­ï¼Œå±äº JDK è‡ªå¸¦ç±»ã€‚</p></li><li><p>æ‰€ä»¥å®ƒæ˜¯ç”± <strong>å¯åŠ¨ç±»åŠ è½½å™¨ BootstrapClassLoader</strong> åŠ è½½çš„ã€‚</p></li><li><p>mysql é©±åŠ¨ç±»æ˜¯è°åŠ è½½çš„ï¼Ÿ</p></li><li><p>æ¯”å¦‚ <code>com.mysql.cj.jdbc.Driver</code> é©±åŠ¨ç±»ï¼Œæ˜¯æˆ‘ä»¬è‡ªå·±å¼•å…¥çš„ jar åŒ…ä¸­çš„ç±»ï¼›</p></li><li><p>å®ƒç”± <strong>åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆAppClassLoaderï¼‰</strong> åŠ è½½ã€‚</p></li></ul><p>é‚£ä¹ˆï¼ŒDriverManagerï¼ˆJDKå†…éƒ¨ï¼‰æ˜¯æ€ä¹ˆæ‰¾åˆ°ç”¨æˆ·å¼•å…¥çš„ mysql é©±åŠ¨ç±»çš„ï¼Ÿ</p><p>è¿™å°±æ¶‰åŠåˆ°ï¼š</p><p><strong>â­ SPI æœºåˆ¶ï¼ˆService Provider Interfaceï¼‰+ ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨</strong></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1197.png" alt="img"></p><h5 id="JDBCæ¡ˆä¾‹ä¸­çœŸçš„æ‰“ç ´äº†åŒäº²å§”æ´¾æœºåˆ¶å—ï¼Ÿ">JDBCæ¡ˆä¾‹ä¸­çœŸçš„æ‰“ç ´äº†åŒäº²å§”æ´¾æœºåˆ¶å—ï¼Ÿ</h5><p>æœ€æ—©è¿™ä¸ªè®ºç‚¹æå‡ºæ˜¯åœ¨å‘¨å¿—æ˜ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ä¸­ï¼Œä»–è®¤ä¸ºæ‰“ç ´äº†åŒäº²å§”æ´¾æœºåˆ¶ï¼Œè¿™ç§ç”±å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»ï¼Œå§”æ´¾åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨å»åŠ è½½ç±»çš„æ–¹å¼ï¼Œæ‰€ä»¥æ‰“ç ´äº†åŒäº²å§”æ´¾æœºåˆ¶ã€‚</p><p><strong>ä½†æ˜¯å¦‚æœæˆ‘ä»¬åˆ†åˆ«ä»DriverManagerä»¥åŠé©±åŠ¨ç±»çš„åŠ è½½æµç¨‹ä¸Šåˆ†æï¼ŒJDBCåªæ˜¯åœ¨DriverManageråŠ è½½å®Œä¹‹åï¼Œé€šè¿‡åˆå§‹åŒ–é˜¶æ®µè§¦å‘äº†é©±åŠ¨ç±»çš„åŠ è½½ï¼Œç±»çš„åŠ è½½ä¾ç„¶éµå¾ªåŒäº²å§”æ´¾æœºåˆ¶ã€‚</strong></p><p><strong>æ‰€ä»¥æˆ‘è®¤ä¸ºè¿™é‡Œæ²¡æœ‰æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ï¼Œåªæ˜¯ç”¨ä¸€ç§å·§å¦™çš„æ–¹æ³•è®©å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»ï¼Œå»å¼•å‘çš„å…¶ä»–ç±»çš„åŠ è½½ã€‚</strong></p><p>æ­£ç¡®ç†è§£ï¼š</p><p><strong>å¹¶ä¸æ˜¯ DriverManager è‡ªå·±å»åŠ è½½ mysql é©±åŠ¨</strong>ï¼Œè€Œæ˜¯ï¼šå®ƒå€ŸåŠ©äº†çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½ï¼ˆAppClassLoaderï¼‰<strong>å»åŠ è½½</strong>ç”¨æˆ· jar åŒ…ä¸­çš„é©±åŠ¨ç±»ã€‚</p><p>è¿™æ˜¯ä¸€ç§ <strong>â€œç±»åŠ è½½å™¨åä½œâ€è€Œä¸æ˜¯â€œå§”æ´¾ç ´åâ€</strong>ã€‚</p><p>ç»¼ä¸Šæ‰€è¿°ï¼šJDBC åŠ è½½é©±åŠ¨çš„è¿‡ç¨‹ï¼Œå…¶å®æ˜¯ DriverManager å¯åŠ¨åï¼Œé€šè¿‡ SPI + ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨è®©åº”ç”¨ç±»åŠ è½½å™¨å»åŠ è½½é©±åŠ¨ç±»ï¼Œä»è€Œå®ç°äº†æ’ä»¶å¼çš„æ‰©å±•ï¼Œ<strong>å¹¶æ²¡æœ‰çœŸæ­£ç ´ååŒäº²å§”æ´¾æœºåˆ¶</strong>ï¼Œè€Œæ˜¯ä¸€ç§å·§å¦™çš„â€œç»•å¼€ä½†ä¸è¿èƒŒâ€çš„åšæ³•ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1209-1024x386.png" alt="img"></p><p>æˆ‘ä»¬å¯ä»¥ç”¨ç”Ÿæ´»é‡Œçš„ä¾‹å­æ¥ç±»åˆ«è¿™ç§å…³ç³»ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1210.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1211.png" alt="img"></p><h4 id="2-6-3æ‰“ç ´ç±»çš„åŒäº²å§”æ´¾æœºåˆ¶-osgiå’Œç±»çš„çƒ­éƒ¨ç½²">2.6.3æ‰“ç ´ç±»çš„åŒäº²å§”æ´¾æœºåˆ¶ osgiå’Œç±»çš„çƒ­éƒ¨ç½²</h4><p><strong>Osgiæ¡†æ¶çš„ç±»åŠ è½½å™¨</strong></p><p>å†å²ä¸Šï¼ŒOSGiæ¨¡å—åŒ–æ¡†æ¶ã€‚å®ƒå­˜åœ¨åŒçº§ä¹‹é—´çš„ç±»åŠ è½½å™¨çš„å§”æ‰˜åŠ è½½ã€‚OSGiè¿˜ä½¿ç”¨ç±»åŠ è½½å™¨å®ç°äº†çƒ­éƒ¨ç½²çš„åŠŸèƒ½ã€‚çƒ­éƒ¨ç½²æŒ‡çš„æ˜¯åœ¨æœåŠ¡ä¸åœæ­¢çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€åœ°æ›´æ–°å­—èŠ‚ç æ–‡ä»¶åˆ°å†…å­˜ä¸­ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1198.png" alt="img"></p><p>ç”±äºè¿™ç§æœºåˆ¶ä½¿ç”¨å·²ç»ä¸å¤šï¼Œæ‰€ä»¥ä¸å†è¿‡å¤šè®¨è®ºOSGiï¼Œç€é‡æ¥çœ‹ä¸‹çƒ­éƒ¨ç½²åœ¨å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨ã€‚</p><h5 id="æ¡ˆä¾‹ï¼šä½¿ç”¨é˜¿é‡Œarthasä¸åœæœºè§£å†³çº¿ä¸Šé—®é¢˜">æ¡ˆä¾‹ï¼šä½¿ç”¨é˜¿é‡Œarthasä¸åœæœºè§£å†³çº¿ä¸Šé—®é¢˜</h5><p><strong>èƒŒæ™¯ï¼š</strong></p><p>å°æçš„å›¢é˜Ÿå°†ä»£ç ä¸Šçº¿ä¹‹åï¼Œå‘ç°å­˜åœ¨ä¸€ä¸ªå°bugï¼Œä½†æ˜¯ç”¨æˆ·æ€¥ç€ä½¿ç”¨ï¼Œå¦‚æœé‡æ–°æ‰“åŒ…å†å‘å¸ƒéœ€è¦ä¸€ä¸ªå¤šå°æ—¶çš„æ—¶é—´ï¼Œæ‰€ä»¥å¸Œæœ›èƒ½ä½¿ç”¨arthaså°½å¿«çš„å°†è¿™ä¸ªé—®é¢˜ä¿®å¤ã€‚</p><p><strong>æ€è·¯ï¼š</strong></p><ol><li>åœ¨å‡ºé—®é¢˜çš„æœåŠ¡å™¨ä¸Šéƒ¨ç½²ä¸€ä¸ª arthasï¼Œå¹¶å¯åŠ¨ã€‚</li><li>jad --source-only ç±»å…¨é™å®šå &gt; ç›®å½•/æ–‡ä»¶å.java jad å‘½ä»¤åç¼–è¯‘ï¼Œç„¶åå¯ä»¥ç”¨å…¶å®ƒç¼–è¯‘å™¨ï¼Œæ¯”å¦‚ vim æ¥ä¿®æ”¹æºç </li><li>mc â€“c ç±»åŠ è½½å™¨çš„hashcode ç›®å½•/æ–‡ä»¶å.java -d è¾“å‡ºç›®å½•</li></ol><p>mc å‘½ä»¤ç”¨æ¥ç¼–è¯‘ä¿®æ”¹è¿‡çš„ä»£ç </p><ol><li>retransform classæ–‡ä»¶æ‰€åœ¨ç›®å½•/xxx.class</li></ol><p>ç”¨ retransform å‘½ä»¤åŠ è½½æ–°çš„å­—èŠ‚ç </p><p><strong>è¯¦ç»†æµç¨‹ï¼š</strong></p><p>1ã€è¿™æ®µä»£ç ç¼–å†™æœ‰è¯¯ï¼Œåœ¨æšä¸¾ä¸­çš„ç±»å‹åˆ¤æ–­ä¸Šä½¿ç”¨äº†<code>==</code> è€Œä¸æ˜¯<code>equals</code>ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1199.png" alt="img"></p><p>2ã€æšä¸¾ä¸­æ˜¯è¿™æ ·å®šä¹‰çš„ï¼Œ1001æ˜¯æ™®é€šç”¨æˆ·ï¼Œ1002æ˜¯VIPç”¨æˆ·ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1200.png" alt="img"></p><p>3ã€ç”±äºä»£ç æœ‰è¯¯ï¼Œå¯¼è‡´ä¼ é€’1001å‚æ•°æ—¶ï¼Œè¿”å›çš„æ˜¯æ”¶è´¹ç”¨æˆ·çš„å†…å®¹ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1201.png" alt="img"></p><p>4ã€<code>jad --source-only ç±»å…¨é™å®šå &gt; ç›®å½•/æ–‡ä»¶å.java</code> ä½¿ç”¨ jad å‘½ä»¤åç¼–è¯‘ï¼Œç„¶åå¯ä»¥ç”¨å…¶å®ƒç¼–è¯‘å™¨ï¼Œæ¯”å¦‚ vim æ¥ä¿®æ”¹æºç </p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1202-1024x78.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1203.png" alt="img"></p><p>5ã€<code>mc â€“c ç±»åŠ è½½å™¨çš„hashcode ç›®å½•/æ–‡ä»¶å.java -d è¾“å‡ºç›®å½•</code> ä½¿ç”¨mc å‘½ä»¤ç”¨æ¥ç¼–è¯‘ä¿®æ”¹è¿‡çš„ä»£ç </p><p>è¿™é‡Œçš„hashcodeè¦å…ˆä½¿ç”¨ä½¿ç”¨scæ¥æŸ¥çœ‹</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1206-1024x148.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1207-1024x52.png" alt="img"></p><p>6ã€<code>retransform classæ–‡ä»¶æ‰€åœ¨ç›®å½•/xxx.class</code> ç”¨ retransform å‘½ä»¤åŠ è½½æ–°çš„å­—èŠ‚ç </p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1205.png" alt="img"></p><p>7ã€æµ‹è¯•ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1208-1024x62.png" alt="img"></p><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p><ul><li>1ã€ç¨‹åºé‡å¯ä¹‹åï¼Œå­—èŠ‚ç æ–‡ä»¶ä¼šæ¢å¤ï¼Œé™¤éå°†classæ–‡ä»¶æ”¾å…¥jaråŒ…ä¸­è¿›è¡Œæ›´æ–°ã€‚</li><li>2ã€ä½¿ç”¨retransformä¸èƒ½æ·»åŠ æ–¹æ³•æˆ–è€…å­—æ®µï¼Œä¹Ÿä¸èƒ½æ›´æ–°æ­£åœ¨æ‰§è¡Œä¸­çš„æ–¹æ³•ã€‚</li></ul><h3 id="2-7ã€JDK9ä¹‹åçš„ç±»åŠ è½½å™¨">2.7ã€JDK9ä¹‹åçš„ç±»åŠ è½½å™¨</h3><p>JDK8åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œæ‰©å±•ç±»åŠ è½½å™¨å’Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨çš„æºç ä½äºrt.jaråŒ…ä¸­çš„sun.misc.Launcher.javaã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1212.png" alt="img"></p><p>ç”±äºJDK9å¼•å…¥äº†moduleçš„æ¦‚å¿µï¼Œç±»åŠ è½½å™¨åœ¨è®¾è®¡ä¸Šå‘ç”Ÿäº†å¾ˆå¤šå˜åŒ–ã€‚</p><ul><li>1.å¯åŠ¨ç±»åŠ è½½å™¨ä½¿ç”¨Javaç¼–å†™ï¼Œä½äºjdk.internal.loader.ClassLoadersç±»ä¸­ã€‚Javaä¸­çš„BootClassLoaderç»§æ‰¿è‡ªBuiltinClassLoaderå®ç°ä»æ¨¡å—ä¸­æ‰¾åˆ°è¦åŠ è½½çš„å­—èŠ‚ç èµ„æºæ–‡ä»¶ã€‚å¯åŠ¨ç±»åŠ è½½å™¨ä¾ç„¶æ— æ³•é€šè¿‡javaä»£ç è·å–åˆ°ï¼Œè¿”å›çš„ä»ç„¶æ˜¯nullï¼Œä¿æŒäº†ç»Ÿä¸€ã€‚</li><li>2ã€æ‰©å±•ç±»åŠ è½½å™¨è¢«æ›¿æ¢æˆäº†å¹³å°ç±»åŠ è½½å™¨ï¼ˆPlatform Class Loaderï¼‰ã€‚å¹³å°ç±»åŠ è½½å™¨éµå¾ªæ¨¡å—åŒ–æ–¹å¼åŠ è½½å­—èŠ‚ç æ–‡ä»¶ï¼Œæ‰€ä»¥ç»§æ‰¿å…³ç³»ä»URLClassLoaderå˜æˆäº†BuiltinClassLoaderï¼ŒBuiltinClassLoaderå®ç°äº†ä»æ¨¡å—ä¸­åŠ è½½å­—èŠ‚ç æ–‡ä»¶ã€‚å¹³å°ç±»åŠ è½½å™¨çš„å­˜åœ¨æ›´å¤šçš„æ˜¯ä¸ºäº†ä¸è€ç‰ˆæœ¬çš„è®¾è®¡æ–¹æ¡ˆå…¼å®¹ï¼Œè‡ªèº«æ²¡æœ‰ç‰¹æ®Šçš„é€»è¾‘ã€‚</li></ul><table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>JDK 8 åŠä»¥å‰</th><th>JDK 9 åŠä»¥åï¼ˆæ¨¡å—åŒ–ç³»ç»Ÿï¼‰</th></tr></thead><tbody><tr><td>ğŸŒŸ ä½“ç³»ç»“æ„</td><td>å¯åŠ¨ç±»åŠ è½½å™¨ â†’ æ‰©å±•ç±»åŠ è½½å™¨ â†’ åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨</td><td>å¯åŠ¨ç±»åŠ è½½å™¨ â†’ å¹³å°ç±»åŠ è½½å™¨ â†’ åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨</td></tr><tr><td>ğŸ”¹ æ‰©å±•ç±»åŠ è½½å™¨</td><td><code>ExtensionClassLoader</code>ï¼ˆåŠ è½½ jre/lib/extï¼‰</td><td>âœ… è¢«ç§»é™¤ï¼Œâ›³æ›¿ä»£ä¸º Platform ClassLoader</td></tr><tr><td>ğŸ”¹ å¹³å°ç±»åŠ è½½å™¨</td><td>âŒ ä¸å­˜åœ¨</td><td>âœ… æ–°å¢ï¼š<code>PlatformClassLoader</code>ï¼ŒåŠ è½½æ ‡å‡†æ¨¡å—å’Œå¹³å°åº“</td></tr><tr><td>ğŸ”¹ å¯åŠ¨ç±»åŠ è½½å™¨</td><td>C++ å®ç°ï¼ŒåŠ è½½ <code>rt.jar</code>ï¼ˆJVM å†…éƒ¨ï¼‰</td><td>Java å®ç°ï¼Œæºç ä½äº <code>jdk.internal.loader.ClassLoaders</code> ç±»ä¸­</td></tr><tr><td>ğŸ”¹ åº”ç”¨ç±»åŠ è½½å™¨</td><td><code>AppClassLoader</code>ï¼ˆåŠ è½½ classpath ä¸‹ç”¨æˆ·ç±»ï¼‰</td><td>âœ… ä¿ç•™ï¼Œä½œç”¨ä¸å˜</td></tr><tr><td>ğŸ”¹ åŠ è½½è·¯å¾„æ¥æº</td><td>é€šè¿‡ <code>Launcher.java</code> ä¸­ç¡¬ç¼–ç çš„è·¯å¾„</td><td>ç»Ÿä¸€æ”¹ç”± <code>module</code> ç³»ç»Ÿç®¡ç†ï¼ŒBoot/Platform/App å„è‡ªå¤„ç†æ¨¡å—</td></tr><tr><td>ğŸ”¹ æ¨¡å—åŒ–æ”¯æŒ</td><td>âŒ æ— æ¨¡å—åŒ–æ¦‚å¿µï¼Œçº¯åŸºäºç±»è·¯å¾„ classpath</td><td>âœ… å¼ºåˆ¶å¯ç”¨ Java Platform Module System (JPMS)</td></tr><tr><td>ğŸ”¹ ç±»åŠ è½½ç²’åº¦</td><td>åŸºäº <code>.class</code> æ–‡ä»¶æˆ– jar</td><td>æ”¯æŒåŸºäºæ¨¡å—æè¿°ç¬¦ï¼ˆmodule-info.javaï¼‰çš„æ¨¡å—åŒ–åŠ è½½</td></tr><tr><td>ğŸ”¹ å¯åŠ¨ç±»åŠ è½½å™¨æ˜¯å¦å¯è·å–èµ„æº</td><td>å¯ä»¥åŠ è½½èµ„æºä½†ä¸å¯ç›´æ¥ç”¨ Java è·å–ç±»</td><td>å¯åŠ¨ç±»åŠ è½½å™¨ä»è¿”å› <code>null</code>ï¼Œå¯¹ç”¨æˆ·éšè—å®ç°ï¼ˆä¿æŒä¸€è‡´æ€§ï¼‰</td></tr><tr><td>ğŸ”¹ åŠ è½½é€»è¾‘ç»Ÿä¸€æ€§</td><td>åŠ è½½æœºåˆ¶è¾ƒåˆ†æ•£</td><td>Boot / Platform / App åŠ è½½é€»è¾‘æ›´åŠ ç»Ÿä¸€ã€æ¨¡å—åŒ–</td></tr><tr><td>ğŸ”¹ ç±»åŠ è½½å™¨æ˜¯å¦ç»§æ‰¿è‡ª URLClassLoader</td><td>Extension å’Œ AppClassLoader éƒ½ç»§æ‰¿äº† URLClassLoader</td><td>JDK9 ä¸­ PlatformClassLoader ä¸å†ç»§æ‰¿ URLClassLoader</td></tr></tbody></table><ul><li><strong>JDK 9 åæœ€å…³é”®çš„å˜åŒ–æ˜¯æ¨¡å—åŒ–ç³»ç»Ÿ JPMS å¼•å…¥</strong>ï¼Œç±»åŠ è½½å™¨è®¾è®¡å›´ç»•æ¨¡å—ç³»ç»Ÿé‡æ–°æ¶æ„ã€‚</li><li><strong>æ‰©å±•ç±»åŠ è½½å™¨è¢«ç§»é™¤</strong>ï¼Œç”± PlatformClassLoader ç»Ÿä¸€ç®¡ç†å¹³å°æ¨¡å—ã€‚</li><li><strong>å¯åŠ¨ç±»åŠ è½½å™¨ä» C++ è½¬å‘ Java å®ç°</strong>ï¼Œä½†å¯¹å¤–æ¥å£ä¿æŒä¸€è‡´ã€‚</li><li><strong>ç±»åŠ è½½å™¨èŒè´£æ›´æ¸…æ™°ï¼ŒåŠ è½½ç²’åº¦ä» class çº§åˆ«æå‡åˆ° module çº§åˆ«</strong>ã€‚</li></ul><h2 id="3ã€è¿è¡Œæ—¶æ•°æ®åŒº">3ã€è¿è¡Œæ—¶æ•°æ®åŒº</h2><p>Javaè™šæ‹Ÿæœºåœ¨è¿è¡ŒJavaç¨‹åºè¿‡ç¨‹ä¸­ç®¡ç†çš„å†…å­˜åŒºåŸŸï¼Œç§°ä¹‹ä¸º<strong>è¿è¡Œæ—¶æ•°æ®åŒº</strong>ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1214-1024x383.png" alt="img"></p><p>çº¿ç¨‹ä¸å…±äº«ï¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¯ä¸ªçº¿ç¨‹é‡Œéƒ½æœ‰ä¸€ä»½ç¨‹åºè®¡æ•°å™¨ã€Javaè™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆå¯¹åº”çš„æ•°æ®ï¼Œè‡ªå·±çš„æ•°æ®ç”±è‡ªå·±ç»´æŠ¤ï¼Œå…¶å®ƒçº¿ç¨‹ä¸èƒ½è®¿é—®å¯¹æ–¹çº¿ç¨‹ä¸­çš„æ•°æ®ã€‚</p><p>çº¿ç¨‹å…±äº«ï¼šæ”¾å…¥ä»»ä½•æ•°æ®ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½èƒ½è®¿é—®æ•°æ®ï¼Œå…±äº«ã€‚</p><ul><li><p>åº”ç”¨åœºæ™¯ï¼šJavaçš„å†…å­˜åˆ†æˆå“ªå‡ éƒ¨åˆ†ï¼Ÿè¯¦ç»†ä»‹ç»ä¸€ä¸‹ã€‚</p></li><li><p>Javaå†…å­˜ä¸­å“ªäº›éƒ¨åˆ†ä¼šå†…å­˜æº¢å‡ºï¼Ÿ</p></li><li><p>JDK7å’Œ8åœ¨å†…å­˜ç»“æ„ä¸Šçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p></li><li><p>å·¥ä½œä¸­çš„å®é™…é—®é¢˜ï¼šå†…å­˜æº¢å‡ºã€‚</p></li><li><p>å†…å­˜è°ƒä¼˜çš„å­¦ä¹ è·¯çº¿ï¼š</p></li><li><p>1.äº†è§£è¿è¡Œæ—¶å†…å­˜ç»“æ„ï¼Œäº†è§£JVMè¿è¡Œè¿‡ç¨‹ä¸­æ¯ä¸€éƒ¨åˆ†çš„å†…å­˜ç»“æ„ä»¥åŠå“ªäº›éƒ¨åˆ†å®¹æ˜“å‡ºç°å†…å­˜æº¢å‡ºã€‚</p></li><li><p>2.æŒæ¡å†…å­˜é—®é¢˜çš„äº§ç”ŸåŸå› ï¼Œå­¦ä¹ ä»£ç ä¸­å¸¸è§çš„å‡ ç§å†…å­˜æ³„éœ²ï¼Œæ€§èƒ½é—®é¢˜çš„å¸¸è§åŸå› ã€‚</p></li><li><p>3.æŒæ¡å†…å­˜è°ƒä¼˜çš„åŸºæœ¬æ–¹æ³•ï¼Œå­¦ä¹ å†…å­˜æ³„éœ²ï¼Œæ€§èƒ½é—®é¢˜ç­‰å¸¸è§JVMé—®é¢˜çš„å¸¸è§„è§£å†³æ–¹æ³•ã€‚</p></li></ul><h3 id="3-1-ç¨‹åºè®¡æ•°å™¨">3.1 ç¨‹åºè®¡æ•°å™¨</h3><p>ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰ä¹Ÿå«PCå¯„å­˜å™¨ï¼Œæ¯ä¸ªçº¿ç¨‹ä¼šé€šè¿‡ç¨‹åºè®¡æ•°å™¨è®°å½•å½“å‰è¦æ‰§è¡Œçš„çš„å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1215-1024x434.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1218.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1219.png" alt="img"></p><p>ifne 9 ï¼Œæ„æ€æ˜¯å°†æ“ä½œæ•°æ ˆä¸­çš„æ•°ä¸0è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰æ‰§è¡Œ6ï¼Œå¦‚æœä¸ç›¸ç­‰æ‰§è¡Œ9ã€‚</p><p>åœ¨<strong>åŠ è½½é˜¶æ®µ</strong>ï¼Œè™šæ‹Ÿæœºå°†å­—èŠ‚ç æ–‡ä»¶ä¸­çš„æŒ‡ä»¤è¯»å–åˆ°å†…å­˜ä¹‹åï¼Œä¼šå°†åŸæ–‡ä»¶ä¸­çš„åç§»é‡è½¬æ¢æˆå†…å­˜åœ°å€ã€‚æ¯ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤éƒ½ä¼šæ‹¥æœ‰ä¸€ä¸ªå†…å­˜åœ°å€ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1216-1024x490.png" alt="img"></p><p>åœ¨ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç¨‹åºè®¡æ•°å™¨ä¼šè®°å½•ä¸‹ä¸€è¡Œå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ã€‚æ‰§è¡Œå®Œå½“å‰æŒ‡ä»¤ä¹‹åï¼Œè™šæ‹Ÿæœºçš„æ‰§è¡Œå¼•æ“æ ¹æ®ç¨‹åºè®¡æ•°å™¨æ‰§è¡Œä¸‹ä¸€è¡ŒæŒ‡ä»¤ã€‚è¿™é‡Œä¸ºäº†ç®€å•èµ·è§ï¼Œä½¿ç”¨åç§»é‡ä»£æ›¿ï¼ŒçœŸå®å†…å­˜ä¸­æ‰§è¡Œæ—¶ä¿å­˜çš„åº”è¯¥æ˜¯åœ°å€ã€‚</p><p>æ¯”å¦‚å½“å‰æ‰§è¡Œçš„æ˜¯åç§»é‡ä¸º0çš„æŒ‡ä»¤ï¼Œé‚£ä¹ˆç¨‹åºè®¡æ•°å™¨ä¸­ä¿å­˜çš„å°±æ˜¯ä¸‹ä¸€æ¡çš„åœ°å€ï¼ˆåç§»é‡1ï¼‰ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1268.png" alt="img"></p><p>ä¸€è·¯å‘ä¸‹æ‰§è¡Œ</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1221-1024x441.png" alt="img"></p><p>ä¸€ç›´æ‰§è¡Œåˆ°æ–¹æ³•çš„æœ€åä¸€è¡ŒæŒ‡ä»¤ï¼Œæ­¤æ—¶æ–¹æ³•æ‰§è¡Œreturnè¯­å¥ï¼Œå½“å‰æ–¹æ³•æ‰§è¡Œç»“æŸï¼Œç¨‹åºè®¡æ•°å™¨ä¸­ä¼šæ”¾å…¥æ–¹æ³•å‡ºå£çš„åœ°å€ï¼ˆæ ˆä¸­è®²è§£ï¼Œç®€å•æ¥è¯´å°±æ˜¯è¿™ä¸ªBæ–¹æ³•ç»“æŸäº†ï¼ŒAè°ƒç”¨äº†Bï¼Œé‚£ä¹ˆè¦å›åˆ°Aæ–¹æ³•ï¼‰</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1222-1024x442.png" alt="img"></p><p>æ‰€ä»¥ï¼Œç¨‹åºè®¡æ•°å™¨å¯ä»¥æ§åˆ¶ç¨‹åºæŒ‡ä»¤çš„è¿›è¡Œï¼Œå®ç°åˆ†æ”¯ã€è·³è½¬ã€å¼‚å¸¸ç­‰é€»è¾‘ã€‚ä¸ç®¡æ˜¯åˆ†æ”¯ã€è·³è½¬ã€å¼‚å¸¸ï¼Œåªéœ€è¦åœ¨ç¨‹åºè®¡æ•°å™¨ä¸­æ”¾å…¥ä¸‹ä¸€è¡Œè¦æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€å³å¯ã€‚</p><p>åœ¨å¤šçº¿ç¨‹æ‰§è¡Œæƒ…å†µä¸‹ï¼ŒJavaè™šæ‹Ÿæœºéœ€è¦é€šè¿‡ç¨‹åºè®¡æ•°å™¨è®°å½•CPUåˆ‡æ¢å‰è§£é‡Šæ‰§è¡Œåˆ°é‚£ä¸€å¥æŒ‡ä»¤å¹¶ç»§ç»­è§£é‡Šè¿è¡Œã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1269.png" alt="img"></p><h4 id="ç¨‹åºè®¡æ•°å™¨ä¼šå‡ºç°å†…å­˜æº¢å‡ºå—ï¼Ÿ">ç¨‹åºè®¡æ•°å™¨ä¼šå‡ºç°å†…å­˜æº¢å‡ºå—ï¼Ÿ</h4><p>å†…å­˜æº¢å‡ºæŒ‡çš„æ˜¯<strong>ç¨‹åºåœ¨ä½¿ç”¨æŸä¸€å—å†…å­˜åŒºåŸŸæ—¶ï¼Œå­˜æ”¾çš„æ•°æ®éœ€è¦å ç”¨çš„å†…å­˜å¤§å°è¶…è¿‡äº†è™šæ‹Ÿæœºèƒ½æä¾›çš„å†…å­˜ä¸Šé™</strong>ã€‚ç”±äºæ¯ä¸ªçº¿ç¨‹åªå­˜å‚¨ä¸€ä¸ªå›ºå®šé•¿åº¦çš„å†…å­˜åœ°å€ï¼Œç¨‹åºè®¡æ•°å™¨æ˜¯ä¸ä¼šå‘ç”Ÿå†…å­˜æº¢å‡ºçš„ã€‚ç¨‹åºå‘˜æ— éœ€å¯¹ç¨‹åºè®¡æ•°å™¨åšä»»ä½•å¤„ç†ã€‚</p><h3 id="3-2Javaè™šæ‹Ÿæœºæ ˆ">3.2Javaè™šæ‹Ÿæœºæ ˆ</h3><p>Javaè™šæ‹Ÿæœºæ ˆï¼ˆJava Virtual Machine Stackï¼‰é‡‡ç”¨æ ˆçš„æ•°æ®ç»“æ„æ¥ç®¡ç†æ–¹æ³•è°ƒç”¨ä¸­çš„åŸºæœ¬æ•°æ®ï¼Œå…ˆè¿›åå‡ºï¼ˆFirst In Last Outï¼‰,æ¯ä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨ä½¿ç”¨ä¸€ä¸ªæ ˆå¸§ï¼ˆStack Frameï¼‰æ¥ä¿å­˜ã€‚</p><p>mainæ–¹æ³•æ‰§è¡Œæ—¶ï¼Œä¼šåˆ›å»ºmainæ–¹æ³•çš„æ ˆå¸§ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1223-1024x564.png" alt="img"></p><p>æ¥ä¸‹æ¥æ‰§è¡Œstudyæ–¹æ³•ï¼Œä¼šåˆ›å»ºstudyæ–¹æ³•çš„æ ˆå¸§</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1224-1024x567.png" alt="img"></p><p>è¿›å…¥eatæ–¹æ³•ï¼Œåˆ›å»ºeatæ–¹æ³•çš„æ ˆå¸§</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1225-1024x573.png" alt="img"></p><p>eatæ–¹æ³•æ‰§è¡Œå®Œä¹‹åï¼Œä¼šå¼¹å‡ºå®ƒçš„æ ˆå¸§ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1226-1024x573.png" alt="img"></p><p>ç„¶åè°ƒç”¨sleepæ–¹æ³•ï¼Œåˆ›å»ºsleepæ–¹æ³•æ ˆå¸§</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1267.png" alt="img"></p><p>æœ€åstudyæ–¹æ³•ç»“æŸä¹‹åå¼¹å‡ºæ ˆå¸§ï¼Œmainæ–¹æ³•ç»“æŸä¹‹åå¼¹å‡ºmainçš„æ ˆå¸§ã€‚</p><p>Javaè™šæ‹Ÿæœºæ ˆéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œè€Œå›æ”¶åˆ™ä¼šåœ¨çº¿ç¨‹çš„é”€æ¯æ—¶è¿›è¡Œã€‚ç”±äºæ–¹æ³•å¯èƒ½ä¼šåœ¨ä¸åŒçº¿ç¨‹ä¸­æ‰§è¡Œï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šåŒ…å«ä¸€ä¸ªè‡ªå·±çš„è™šæ‹Ÿæœºæ ˆã€‚å¦‚ä¸‹å°±æœ‰ä¸¤ä¸ªçº¿ç¨‹çš„è™šæ‹Ÿæœºæ ˆï¼Œmainçº¿ç¨‹å’Œçº¿ç¨‹Aã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1227.png" alt="img"></p><p>Javaè™šæ‹Ÿæœºæ ˆçš„æ ˆå¸§ä¸­ä¸»è¦åŒ…å«ä¸‰æ–¹é¢çš„å†…å®¹ï¼š</p><ul><li>å±€éƒ¨å˜é‡è¡¨ï¼šä½œç”¨æ˜¯åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å­˜æ”¾æ‰€æœ‰çš„å±€éƒ¨å˜é‡ã€‚</li><li>æ“ä½œæ•°æ ˆï¼šæ˜¯æ ˆå¸§ä¸­è™šæ‹Ÿæœºåœ¨æ‰§è¡ŒæŒ‡ä»¤è¿‡ç¨‹ä¸­ç”¨æ¥å­˜æ”¾ä¸´æ—¶æ•°æ®çš„ä¸€å—åŒºåŸŸã€‚</li><li>å¸§æ•°æ®ï¼šåŒ…å«åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ã€å¼‚å¸¸è¡¨çš„å¼•ç”¨ã€‚</li></ul><h4 id="3-2-1å±€éƒ¨å˜é‡è¡¨">3.2.1å±€éƒ¨å˜é‡è¡¨</h4><p>å±€éƒ¨å˜é‡è¡¨çš„ä½œç”¨æ˜¯åœ¨æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­å­˜æ”¾æ‰€æœ‰çš„å±€éƒ¨å˜é‡ã€‚å±€éƒ¨å˜é‡è¡¨åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯å­—èŠ‚ç æ–‡ä»¶ä¸­çš„ï¼Œå¦å¤–ä¸€ç§æ˜¯æ ˆå¸§ä¸­çš„ä¹Ÿå°±æ˜¯ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚æ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡è¡¨æ˜¯æ ¹æ®å­—èŠ‚ç æ–‡ä»¶ä¸­çš„å†…å®¹ç”Ÿæˆçš„ã€‚</p><p>1.æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹<strong>å­—èŠ‚ç æ–‡ä»¶ä¸­çš„å±€éƒ¨å˜é‡è¡¨</strong>ï¼šç¼–è¯‘æˆå­—èŠ‚ç æ–‡ä»¶æ—¶å°±å¯ä»¥ç¡®å®šå±€éƒ¨å˜é‡è¡¨çš„å†…å®¹ã€‚</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public static voidtest1()&#123;</span><br><span class="line">    inti <span class="operator">=</span> <span class="number">0</span><span class="comment">;</span></span><br><span class="line">    longj <span class="operator">=</span> <span class="number">1</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>test1æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨å¦‚ä¸‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1228.png" alt="img"></p><p>Nrè¡¨ç¤ºçš„æ˜¯å˜é‡çš„ç¼–å·ï¼ŒæŒ‰ç…§ç”Ÿå‘½çš„é¡ºåºï¼Œèµ·å§‹PCä¿å­˜äº†ä»å“ªä¸€è¡Œå­—èŠ‚ç æŒ‡ä»¤å¼€å§‹å¯ä»¥è®¿é—®è¿™ä¸ªå±€éƒ¨å˜é‡ï¼Œé•¿åº¦ä»¥ç”Ÿæ•ˆé‚£è¡Œåˆ°é”€æ¯é‚£è¡Œè®¡ç®—ã€‚</p><p>å±€éƒ¨å˜é‡è¡¨ä¸­ä¿å­˜äº†å­—èŠ‚ç æŒ‡ä»¤ç”Ÿæ•ˆçš„åç§»é‡ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1229-1024x331.png" alt="img"></p><p>iåœ¨1ä¸­å°±èµ‹å€¼æˆåŠŸäº†ï¼Œå®ƒå¯ä»¥è®¿é—®2,3,4 èµ·å§‹PC2ï¼Œé•¿åº¦3ã€‚jåœ¨3ä¸­èµ‹å€¼æˆåŠŸï¼Œèµ·å§‹PC3ï¼Œé•¿åº¦1</p><p>æ¯”å¦‚<code>i</code>è¿™ä¸ªå˜é‡ï¼Œå®ƒçš„èµ·å§‹PCæ˜¯2ï¼Œä»£è¡¨ä»<code>lconst_1</code>è¿™å¥æŒ‡ä»¤å¼€å§‹æ‰èƒ½ä½¿ç”¨<code>i</code>ï¼Œé•¿åº¦ä¸º3ï¼Œä¹Ÿå°±æ˜¯2-4è¿™ä¸‰å¥æŒ‡ä»¤éƒ½å¯ä»¥ä½¿ç”¨<code>i</code>ã€‚ä¸ºä»€ä¹ˆä»2æ‰èƒ½ä½¿ç”¨ï¼Œå› ä¸º0å’Œ1è¿™ä¸¤å¥å­—èŠ‚ç æŒ‡ä»¤è¿˜åœ¨å¤„ç†<code>int i = 0</code>è¿™å¥èµ‹å€¼è¯­å¥ã€‚<code>j</code>è¿™ä¸ªå˜é‡åªæœ‰ç­‰3æŒ‡ä»¤æ‰§è¡Œå®Œä¹‹åä¹Ÿå°±æ˜¯<code>long j = 1</code>ä»£ç æ‰§è¡Œå®Œä¹‹åæ‰èƒ½ä½¿ç”¨ï¼Œæ‰€ä»¥èµ·å§‹PCä¸º4ï¼Œåªèƒ½åœ¨4è¿™è¡Œå­—èŠ‚ç æŒ‡ä»¤ä¸­ä½¿ç”¨ã€‚</p><p>2.æ¥ä¸‹æ¥çœ‹ä¸‹<strong>æ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡è¡¨</strong>ï¼Œæ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡è¡¨æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­æ¯ä¸€ä¸ªä½ç½®ç§°ä¹‹ä¸ºæ§½(slot) ï¼Œlongå’Œdoubleç±»å‹å ç”¨ä¸¤ä¸ªæ§½ï¼Œå…¶ä»–ç±»å‹å ç”¨ä¸€ä¸ªæ§½ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1230-1024x326.png" alt="img"></p><p><code>i</code>å ç”¨æ•°ç»„ä¸‹æ ‡ä¸º0çš„ä½ç½®ï¼Œ<code>j</code>å ç”¨æ•°ç»„ä¸‹æ ‡1-2çš„ä½ç½®ã€‚</p><p>åˆšæ‰çœ‹åˆ°çš„æ˜¯é™æ€æ–¹æ³•ï¼Œå®ä¾‹æ–¹æ³•ä¸­çš„åºå·ä¸º0çš„ä½ç½®å­˜æ”¾çš„æ˜¯thisï¼ŒæŒ‡çš„æ˜¯å½“å‰è°ƒç”¨æ–¹æ³•çš„å¯¹è±¡ï¼Œè¿è¡Œæ—¶ä¼šåœ¨å†…å­˜ä¸­å­˜æ”¾å®ä¾‹å¯¹è±¡çš„åœ°å€ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1231-1024x309.png" alt="img"></p><p>æ–¹æ³•å‚æ•°ä¹Ÿä¼šä¿å­˜åœ¨å±€éƒ¨å˜é‡è¡¨ä¸­ï¼Œå…¶é¡ºåºä¸æ–¹æ³•ä¸­å‚æ•°å®šä¹‰çš„é¡ºåºä¸€è‡´ã€‚å±€éƒ¨å˜é‡è¡¨ä¿å­˜çš„å†…å®¹æœ‰ï¼šå®ä¾‹æ–¹æ³•çš„thiså¯¹è±¡ï¼Œæ–¹æ³•çš„å‚æ•°ï¼Œæ–¹æ³•ä½“ä¸­å£°æ˜çš„å±€éƒ¨å˜é‡ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1297-1024x331.png" alt="img"></p><p>test3æ–¹æ³•ä¸­åŒ…å«ä¸¤ä¸ªå‚æ•°<code>k</code>,<code>m</code>ï¼Œè¿™ä¸¤ä¸ªå‚æ•°ä¹Ÿä¼šè¢«åŠ å…¥åˆ°å±€éƒ¨å˜é‡è¡¨ä¸­ã€‚</p><p><strong>ä»¥ä¸‹ä»£ç çš„å±€éƒ¨å˜é‡è¡¨ä¸­ä¼šå ç”¨å‡ ä¸ªæ§½ï¼Ÿ</strong></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">publicvoidtest4(<span class="built_in">int</span>k,<span class="built_in">int</span>m)&#123;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span>a = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">int</span>b = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span>c = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">int</span>i = <span class="number">0</span>;</span><br><span class="line">    longj = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†èŠ‚çœç©ºé—´ï¼Œå±€éƒ¨å˜é‡è¡¨ä¸­çš„æ§½æ˜¯å¯ä»¥å¤ç”¨çš„ï¼Œä¸€æ—¦æŸä¸ªå±€éƒ¨å˜é‡ä¸å†ç”Ÿæ•ˆï¼Œå½“å‰æ§½å°±å¯ä»¥å†æ¬¡è¢«ä½¿ç”¨ã€‚</p><p>1ã€æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œå®ä¾‹å¯¹è±¡<code>this</code>ã€<code>k</code>ã€<code>m</code> ä¼šè¢«æ”¾å…¥å±€éƒ¨å˜é‡è¡¨ä¸­ï¼Œå ç”¨3ä¸ªæ§½</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1232-1024x365.png" alt="img"></p><p>2ã€å°†1çš„å€¼æ”¾å…¥å±€éƒ¨å˜é‡è¡¨ä¸‹æ ‡ä¸º3çš„ä½ç½®ä¸Šï¼Œç›¸å½“äºç»™aè¿›è¡Œèµ‹å€¼ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1298-1024x373.png" alt="img"></p><p>3ã€å°†2æ”¾å…¥å±€éƒ¨å˜é‡è¡¨ä¸‹æ ‡ä¸º4çš„ä½ç½®ï¼Œç»™bèµ‹å€¼ä¸º2ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1233-1024x363.png" alt="img"></p><p>4ã€abå·²ç»è„±ç¦»äº†ç”Ÿæ•ˆèŒƒå›´ï¼Œæ‰€ä»¥ä¸‹æ ‡ä¸º3å’Œ4çš„è¿™ä¸¤ä¸ªä½ç½®å¯ä»¥å¤ç”¨ã€‚æ­¤æ—¶cçš„å€¼1å°±å¯ä»¥æ”¾å…¥ä¸‹æ ‡ä¸º3çš„ä½ç½®ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1234-1024x350.png" alt="img"></p><p>4ã€è„±ç¦»cçš„ç”Ÿæ•ˆèŒƒå›´ä¹‹åï¼Œç»™ièµ‹å€¼å°±å¯ä»¥å¤ç”¨cçš„ä½ç½®ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1235-1024x355.png" alt="img"></p><p>5ã€æœ€åæ”¾å…¥jï¼Œjæ˜¯ä¸€ä¸ªlongç±»å‹ï¼Œå ç”¨ä¸¤ä¸ªæ§½ã€‚ä½†æ˜¯å¯ä»¥å¤ç”¨bæ‰€åœ¨çš„ä½ç½®ï¼Œæ‰€ä»¥å ç”¨4å’Œ5è¿™ä¸¤ä¸ªä½ç½®</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1236-1024x358.png" alt="img"></p><p>æ‰€ä»¥ï¼Œå±€éƒ¨å˜é‡è¡¨æ•°å€¼çš„é•¿åº¦ä¸º6</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1237.png" alt="img"></p><h4 id="3-2-2æ“ä½œæ•°æ ˆ">3.2.2æ“ä½œæ•°æ ˆ</h4><p>æ“ä½œæ•°æ ˆæ˜¯æ ˆå¸§ä¸­è™šæ‹Ÿæœºåœ¨æ‰§è¡ŒæŒ‡ä»¤è¿‡ç¨‹ä¸­ç”¨æ¥å­˜æ”¾ä¸­é—´æ•°æ®çš„ä¸€å—åŒºåŸŸã€‚ä»–æ˜¯ä¸€ç§æ ˆå¼çš„æ•°æ®ç»“æ„ï¼Œå¦‚æœä¸€æ¡æŒ‡ä»¤å°†ä¸€ä¸ªå€¼å‹å…¥æ“ä½œæ•°æ ˆï¼Œåˆ™åé¢çš„æŒ‡ä»¤å¯ä»¥å¼¹å‡ºå¹¶ä½¿ç”¨è¯¥å€¼ã€‚</p><p>åœ¨ç¼–è¯‘æœŸå°±å¯ä»¥ç¡®å®šæ“ä½œæ•°æ ˆçš„æœ€å¤§æ·±åº¦ï¼Œä»è€Œåœ¨æ‰§è¡Œæ—¶æ­£ç¡®çš„åˆ†é…å†…å­˜å¤§å°ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1238-1024x318.png" alt="img"></p><p>ä¸ºä»€ä¹ˆæ˜¯2ï¼Ÿ æ“ä½œæ•°æ ˆä¸­æœ€å¤šä¼šå‡ºç°ä¸¤ä¸ªæ•°å­—0,1,å› æ­¤æœ€å¤§æ·±åº¦ä¸º2</p><h4 id="3-2-3å¸§æ•°æ®">3.2.3<strong>å¸§æ•°æ®</strong></h4><p>å¸§æ•°æ®ä¸»è¦åŒ…å«åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ã€å¼‚å¸¸è¡¨çš„å¼•ç”¨ã€‚</p><p><strong>åŠ¨æ€é“¾æ¥</strong></p><p>å½“å‰ç±»çš„å­—èŠ‚ç æŒ‡ä»¤å¼•ç”¨äº†å…¶ä»–ç±»çš„å±æ€§æˆ–è€…æ–¹æ³•æ—¶ï¼Œéœ€è¦å°†ç¬¦å·å¼•ç”¨ï¼ˆç¼–å·ï¼‰è½¬æ¢æˆå¯¹åº”çš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­çš„å†…å­˜åœ°å€ã€‚åŠ¨æ€é“¾æ¥å°±ä¿å­˜äº†ç¼–å·åˆ°è¿è¡Œæ—¶å¸¸é‡æ± çš„å†…å­˜åœ°å€çš„æ˜ å°„å…³ç³»ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1239-1024x340.png" alt="img"></p><p><strong>æ–¹æ³•å‡ºå£</strong></p><p>æ–¹æ³•å‡ºå£æŒ‡çš„æ˜¯æ–¹æ³•åœ¨æ­£ç¡®æˆ–è€…å¼‚å¸¸ç»“æŸæ—¶ï¼Œå½“å‰æ ˆå¸§ä¼šè¢«å¼¹å‡ºï¼ŒåŒæ—¶ç¨‹åºè®¡æ•°å™¨åº”è¯¥æŒ‡å‘ä¸Šä¸€ä¸ªæ ˆå¸§ä¸­çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚æ‰€ä»¥åœ¨å½“å‰æ ˆå¸§ä¸­ï¼Œéœ€è¦å­˜å‚¨æ­¤æ–¹æ³•å‡ºå£çš„åœ°å€ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1240.png" alt="img"></p><p><strong>å¼‚å¸¸è¡¨</strong></p><p>å¼‚å¸¸è¡¨å­˜æ”¾çš„æ˜¯ä»£ç ä¸­å¼‚å¸¸çš„å¤„ç†ä¿¡æ¯ï¼ŒåŒ…å«äº†å¼‚å¸¸æ•è·çš„ç”Ÿæ•ˆèŒƒå›´ä»¥åŠå¼‚å¸¸å‘ç”Ÿåè·³è½¬åˆ°çš„å­—èŠ‚ç æŒ‡ä»¤ä½ç½®ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1241-1024x344.png" alt="img"></p><p><code>å¦‚ä¸‹æ¡ˆä¾‹ï¼ši=1</code>è¿™è¡Œæºä»£ç ç¼–è¯‘æˆå­—èŠ‚ç æŒ‡ä»¤ä¹‹åï¼Œä¼šåŒ…å«åç§»é‡2-4è¿™ä¸‰è¡ŒæŒ‡ä»¤ã€‚å…¶ä¸­2-3æ˜¯å¯¹iè¿›è¡Œèµ‹å€¼1çš„æ“ä½œï¼Œ4çš„æ²¡æœ‰å¼‚å¸¸å°±è·³è½¬åˆ°10æ–¹æ³•ç»“æŸã€‚å¦‚æœå‡ºç°å¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œç»§ç»­æ‰§è¡Œåˆ°7è¿™è¡ŒæŒ‡ä»¤ï¼Œ7ä¼šå°†å¼‚å¸¸å¯¹è±¡æ”¾å…¥æ“ä½œæ•°æ ˆä¸­ï¼Œè¿™æ ·åœ¨catchä»£ç å—ä¸­å°±å¯ä»¥ä½¿ç”¨å¼‚å¸¸å¯¹è±¡äº†ã€‚æ¥ä¸‹æ¥æ‰§è¡Œ8-9ï¼Œå¯¹iè¿›è¡Œèµ‹å€¼ä¸º2çš„æ“ä½œã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1242-1024x391.png" alt="img"></p><p>æ‰€ä»¥å¼‚å¸¸è¡¨ä¸­ï¼Œå¼‚å¸¸æ•è·çš„èµ·å§‹åç§»é‡å°±æ˜¯2ï¼Œç»“æŸåç§»é‡æ˜¯4ï¼Œåœ¨2-4æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºäº†<code>java.lang.Exception</code>å¯¹è±¡æˆ–è€…å­ç±»å¯¹è±¡ï¼Œå°±ä¼šå°†å…¶æ•è·ï¼Œç„¶åè·³è½¬åˆ°åç§»é‡ä¸º7çš„æŒ‡ä»¤ã€‚</p><h4 id="3-2-4æ ˆå†…å­˜æº¢å‡º">3.2.4æ ˆå†…å­˜æº¢å‡º</h4><p>Javaè™šæ‹Ÿæœºæ ˆå¦‚æœæ ˆå¸§è¿‡å¤šï¼Œå ç”¨å†…å­˜è¶…è¿‡æ ˆå†…å­˜å¯ä»¥åˆ†é…çš„æœ€å¤§å¤§å°å°±<strong>ä¼šå‡ºç°å†…å­˜æº¢å‡º</strong>ã€‚Javaè™šæ‹Ÿæœºæ ˆå†…å­˜æº¢å‡ºæ—¶ä¼šå‡ºç°StackOverflowErrorçš„é”™è¯¯ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1243.png" alt="img"></p><p>å¦‚æœæˆ‘ä»¬ä¸æŒ‡å®šæ ˆçš„å¤§å°ï¼ŒJVM å°†åˆ›å»ºä¸€ä¸ªå…·æœ‰é»˜è®¤å¤§å°çš„æ ˆã€‚å¤§å°å–å†³äºæ“ä½œç³»ç»Ÿå’Œè®¡ç®—æœºçš„ä½“ç³»ç»“æ„ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1244-1024x151.png" alt="img"></p><p>æˆ‘ä»¬æ¥æ¨¡æ‹Ÿä¸‹æ ˆå†…å­˜çš„æº¢å‡ºæƒ…å†µ:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> count = <span class="number">0</span>;</span><br><span class="line">     <span class="comment">//é€’å½’æ–¹æ³•è°ƒç”¨è‡ªå·±</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">recursion</span>()</span>&#123;</span><br><span class="line">         System.<span class="keyword">out</span>.println(++count);</span><br><span class="line">         recursion();</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨é€’å½’è®©æ–¹æ³•è°ƒç”¨è‡ªèº«ï¼Œä½†æ˜¯ä¸è®¾ç½®é€€å‡ºæ¡ä»¶ã€‚å®šä¹‰è°ƒç”¨æ¬¡æ•°çš„å˜é‡ï¼Œæ¯ä¸€æ¬¡è°ƒç”¨è®©å˜é‡åŠ 1ã€‚æŸ¥çœ‹é”™è¯¯å‘ç”Ÿæ—¶æ€»è°ƒç”¨çš„æ¬¡æ•°ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1245.png" alt="img"></p><p><strong>è§£å†³æ–¹æ¡ˆ-è®¾ç½®æ ˆçš„å¤§å°</strong></p><p>è¦ä¿®æ”¹Javaè™šæ‹Ÿæœºæ ˆçš„å¤§å°ï¼Œå¯ä»¥ä½¿ç”¨è™šæ‹Ÿæœºå‚æ•° -Xss ã€‚</p><ul><li>è¯­æ³•ï¼š-Xssæ ˆå¤§å°</li><li>å•ä½ï¼šå­—èŠ‚ï¼ˆé»˜è®¤ï¼Œå¿…é¡»æ˜¯ 1024 çš„å€æ•°ï¼‰ã€kæˆ–è€…K(KB)ã€mæˆ–è€…M(MB)ã€gæˆ–è€…G(GB)</li></ul><p>ä¾‹å¦‚ï¼š</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">-Xss1048576 </span></span><br><span class="line"><span class="deletion">-Xss1024K      </span></span><br><span class="line"><span class="deletion">-Xss1m</span></span><br><span class="line"><span class="deletion">-Xss1g</span></span><br></pre></td></tr></table></figure><p>æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼Œä¸åŒIDEAç‰ˆæœ¬çš„è®¾ç½®æ–¹å¼ä¼šç•¥æœ‰ä¸åŒï¼š</p><p>1ã€ç‚¹å‡»ä¿®æ”¹é…ç½®Modify options</p><p>2ã€ç‚¹å‡»Add VM options</p><p>3ã€æ·»åŠ å‚æ•°</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1247.png" alt="img"></p><p>è°ƒæˆ512kä¹‹åï¼Œæ˜æ˜¾å‘ç°æœ€å¤§æ ˆå¸§æ•°é‡å‡å°‘äº†ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1246.png" alt="img"></p><p>å¯¹windowsæ¥è¯´ï¼ŒJDK8æµ‹è¯•æœ€å°å€¼ä¸º180Kï¼Œæœ€å¤§å€¼ä¸º1024Mã€‚</p><p>å¦‚æœå±€éƒ¨å˜é‡è¿‡å¤šï¼Œæ“ä½œæ•°æ ˆçš„æ·±åº¦è¿‡å¤§ä¹Ÿä¼šå½±å“æ ˆå†…å­˜çš„å¤§å°ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1248.png" alt="img"></p><p>Javaè™šæ‹Ÿæœºæ ˆå­˜å‚¨äº†Javaæ–¹æ³•è°ƒç”¨æ—¶çš„æ ˆå¸§ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆå­˜å‚¨çš„æ˜¯nativeæœ¬åœ°æ–¹æ³•çš„æ ˆå¸§ã€‚</p><h3 id="3-3æœ¬åœ°æ–¹æ³•æ ˆ">3.3æœ¬åœ°æ–¹æ³•æ ˆ</h3><p>Javaè™šæ‹Ÿæœºæ ˆå­˜å‚¨äº†Javaæ–¹æ³•è°ƒç”¨æ—¶çš„æ ˆå¸§ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆå­˜å‚¨çš„æ˜¯nativeæœ¬åœ°æ–¹æ³•çš„æ ˆå¸§ã€‚ï¼ˆC++ï¼‰</p><p>åœ¨Hotspotè™šæ‹Ÿæœºä¸­ï¼Œ<strong>Javaè™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆå®ç°ä¸Šä½¿ç”¨äº†åŒä¸€ä¸ªæ ˆç©ºé—´</strong>ã€‚æœ¬åœ°æ–¹æ³•æ ˆä¼šåœ¨æ ˆå†…å­˜ä¸Šç”Ÿæˆä¸€ä¸ªæ ˆå¸§ï¼Œä¸´æ—¶ä¿å­˜æ–¹æ³•çš„å‚æ•°åŒæ—¶æ–¹ä¾¿å‡ºç°å¼‚å¸¸æ—¶ä¹ŸæŠŠæœ¬åœ°æ–¹æ³•çš„æ ˆä¿¡æ¯æ‰“å°å‡ºæ¥ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1249.png" alt="img"></p><p>æ¯”å¦‚æµ‹è¯•ä¸‹è¿™æ®µä»£ç ï¼š</p><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** * æœ¬åœ°æ–¹æ³•æ ˆ */</span><span class="title function_">publicclassNativeDemo1</span> &#123;</span><br><span class="line">    <span class="title function_">publicstaticvoidmain</span>(<span class="params">String</span>[] <span class="params">args</span>) &#123;</span><br><span class="line">        <span class="title function_">try</span>&#123;</span><br><span class="line">            <span class="title class_">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="title function_">newFileOutputStream</span>(<span class="string">&quot;E:<span class="char escape_">\\</span>123.txt&quot;</span>);</span><br><span class="line">            <span class="variable">fileOutputStream</span>.<span class="property">write</span>(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="title function_">catch</span>(<span class="params">FileNotFoundException</span> <span class="params">e</span>) &#123;</span><br><span class="line">            <span class="variable">e</span>.<span class="property">printStackTrace</span>();</span><br><span class="line">        &#125; <span class="title function_">catch</span>(<span class="params">IOException</span> <span class="params">e</span>) &#123;</span><br><span class="line">            <span class="variable">e</span>.<span class="property">printStackTrace</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¹‹åå‘ç”Ÿå¼‚å¸¸ï¼Œä¼šæ‰“å°å‡ºæ‰€æœ‰æ ˆå¸§çš„åå­—ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1250.png" alt="img"></p><p><code>open0</code>æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œæ‰€ä»¥åˆ›å»ºäº†æœ¬åœ°æ–¹æ³•çš„æ ˆå¸§ã€‚æœ¬åœ°æ–¹æ³•å’ŒJavaè™šæ‹Ÿæœºæ–¹æ³•</p><h3 id="3-4-å †å†…å­˜">3.4 å †å†…å­˜</h3><p>ä¸€èˆ¬Javaç¨‹åºä¸­å †å†…å­˜æ˜¯ç©ºé—´æœ€å¤§çš„ä¸€å—å†…å­˜åŒºåŸŸã€‚</p><p>åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡éƒ½å­˜åœ¨äºå †ä¸Šã€‚æ ˆä¸Šçš„å±€éƒ¨å˜é‡è¡¨ä¸­ï¼Œå¯ä»¥å­˜æ”¾å †ä¸Šå¯¹è±¡çš„å¼•ç”¨ã€‚é™æ€å˜é‡ä¹Ÿå¯ä»¥å­˜æ”¾å †å¯¹è±¡çš„å¼•ç”¨ï¼Œé€šè¿‡é™æ€å˜é‡å°±å¯ä»¥å®ç°å¯¹è±¡åœ¨çº¿ç¨‹ä¹‹é—´å…±äº«ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1251-1024x282.png" alt="img"></p><p>è¿™æ®µä»£ç ä¸­é€šè¿‡<code>new</code>å…³é”®å­—åˆ›å»ºäº†ä¸¤ä¸ª<code>Student</code>ç±»çš„å¯¹è±¡ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡ä¼šè¢«å­˜æ”¾åœ¨å †ä¸Šã€‚åœ¨æ ˆä¸Šé€šè¿‡<code>s1</code>å’Œ<code>s2</code>ä¸¤ä¸ªå±€éƒ¨å˜é‡ä¿å­˜å †ä¸Šä¸¤ä¸ªå¯¹è±¡çš„åœ°å€ï¼Œä»è€Œå®ç°äº†å¼•ç”¨å…³ç³»çš„å»ºç«‹ã€‚</p><h4 id="3-4-1å †å†…å­˜çš„æº¢å‡º">3.4.1å †å†…å­˜çš„æº¢å‡º</h4><p>é€šè¿‡newå…³é”®å­—ä¸åœåˆ›å»ºå¯¹è±¡ï¼Œæ”¾å…¥é›†åˆä¸­ï¼Œæ¨¡æ‹Ÿå †å†…å­˜çš„æº¢å‡ºï¼Œè§‚å¯Ÿå †æº¢å‡ºä¹‹åçš„å¼‚å¸¸ä¿¡æ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter03.heap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å †å†…å­˜çš„ä½¿ç”¨å’Œå›æ”¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        ArrayList&lt;Object&gt; objects = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Object&gt;();</span><br><span class="line">        System.in.read();</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            objects.add(<span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span> * <span class="number">1024</span> * <span class="number">100</span>]);</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å †å†…å­˜å¤§å°æ˜¯æœ‰ä¸Šé™çš„ï¼Œå½“å¯¹è±¡ä¸€ç›´å‘å †ä¸­æ”¾å…¥å¯¹è±¡è¾¾åˆ°ä¸Šé™ä¹‹åï¼Œå°±ä¼šæŠ›å‡ºOutOfMemoryé”™è¯¯ã€‚åœ¨è¿™æ®µä»£ç ä¸­ï¼Œä¸åœåˆ›å»º100Må¤§å°çš„å­—èŠ‚æ•°ç»„å¹¶æ”¾å…¥ArrayListé›†åˆä¸­ï¼Œæœ€ç»ˆè¶…è¿‡äº†å †å†…å­˜çš„ä¸Šé™ã€‚æŠ›å‡ºå¦‚ä¸‹é”™è¯¯ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1252-1024x76.png" alt="img"></p><h4 id="3-4-2ä¸‰ä¸ªé‡è¦çš„å€¼">3.4.2ä¸‰ä¸ªé‡è¦çš„å€¼</h4><p>å †ç©ºé—´æœ‰ä¸‰ä¸ªéœ€è¦å…³æ³¨çš„å€¼ï¼Œusedã€totalã€maxã€‚usedæŒ‡çš„æ˜¯å½“å‰å·²ä½¿ç”¨çš„å †å†…å­˜ï¼Œtotalæ˜¯javaè™šæ‹Ÿæœºå·²ç»åˆ†é…çš„å¯ç”¨å †å†…å­˜ï¼Œmaxæ˜¯javaè™šæ‹Ÿæœºå¯ä»¥åˆ†é…çš„æœ€å¤§å †å†…å­˜ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1253.png" alt="img"></p><p>å¯ä»¥é€šè¿‡ï¼šdashboard è¿›è¡Œè®¿é—®ï¼Œå¦‚æœåªèƒ½çœ‹å†…å­˜åªéœ€è¦è¾“å…¥ï¼šmemory</p><blockquote><p>æ‰‹åŠ¨æŒ‡å®šåˆ·æ–°é¢‘ç‡ï¼ˆä¸æŒ‡å®šé»˜è®¤5ç§’ä¸€æ¬¡ï¼‰ï¼š<code>dashboard â€“i åˆ·æ–°é¢‘ç‡(æ¯«ç§’)</code></p></blockquote><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1254-1024x261.png" alt="img"></p><p>éšç€å †ä¸­çš„å¯¹è±¡å¢å¤šï¼Œå½“totalå¯ä»¥ä½¿ç”¨çš„å†…å­˜å³å°†ä¸è¶³æ—¶ï¼Œjavaè™šæ‹Ÿæœºä¼šç»§ç»­åˆ†é…å†…å­˜ç»™å †ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1255.png" alt="img"></p><p>æ­¤æ—¶usedè¾¾åˆ°äº†totalçš„å¤§å°ï¼ŒJavaè™šæ‹Ÿæœºä¼šå‘æ“ä½œç³»ç»Ÿç”³è¯·æ›´å¤§çš„å†…å­˜ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1256.png" alt="img"></p><p>ä½†æ˜¯è¿™ä¸ªç”³è¯·è¿‡ç¨‹ä¸æ˜¯æ— é™çš„ï¼Œtotalæœ€å¤šåªèƒ½ä¸maxç›¸ç­‰ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1257.png" alt="img"></p><p>é‚£ä¹ˆæ˜¯ä¸æ˜¯å½“used = max = totalçš„æ—¶å€™ï¼Œå †å†…å­˜å°±æº¢å‡ºäº†å‘¢ï¼Ÿ</p><p>ä¸æ˜¯ï¼Œå †å†…å­˜æº¢å‡ºçš„åˆ¤æ–­æ¡ä»¶æ¯”è¾ƒå¤æ‚ï¼Œåœ¨ä¸‹ä¸€ç« ã€Šåƒåœ¾å›æ”¶å™¨ã€‹ä¸­ä¼šè¯¦ç»†ä»‹ç»ã€‚</p><p>å¦‚æœä¸è®¾ç½®ä»»ä½•çš„è™šæ‹Ÿæœºå‚æ•°ï¼Œmaxé»˜è®¤æ˜¯ç³»ç»Ÿå†…å­˜çš„1/4ï¼Œtotalé»˜è®¤æ˜¯ç³»ç»Ÿå†…å­˜çš„1/64ã€‚åœ¨å®é™…åº”ç”¨ä¸­ä¸€èˆ¬éƒ½éœ€è¦è®¾ç½®totalå’Œmaxçš„å€¼ã€‚</p><h4 id="3-4-3è®¾ç½®å †çš„å¤§å°">3.4.3è®¾ç½®å †çš„å¤§å°</h4><p>è¦ä¿®æ”¹å †çš„å¤§å°ï¼Œå¯ä»¥ä½¿ç”¨è™šæ‹Ÿæœºå‚æ•° â€“Xmxï¼ˆmaxæœ€å¤§å€¼ï¼‰å’Œ-Xms (åˆå§‹çš„total)ã€‚</p><p>è¯­æ³•ï¼š<code>-Xmxå€¼ -Xmså€¼</code></p><p>å•ä½ï¼šå­—èŠ‚ï¼ˆé»˜è®¤ï¼Œå¿…é¡»æ˜¯ 1024 çš„å€æ•°ï¼‰ã€kæˆ–è€…K(KB)ã€mæˆ–è€…M(MB)ã€gæˆ–è€…G(GB)</p><p>é™åˆ¶ï¼šXmxå¿…é¡»å¤§äº 2 MBï¼ŒXmså¿…é¡»å¤§äº1MB</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">-Xms6291456</span></span><br><span class="line"><span class="deletion">-Xms6144k</span></span><br><span class="line"><span class="deletion">-Xms6m</span></span><br><span class="line"><span class="deletion">-Xmx83886080</span></span><br><span class="line"><span class="deletion">-Xmx81920k</span></span><br><span class="line"><span class="deletion">-Xmx80m</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å¯ä»¥å°†maxå’Œåˆå§‹çš„totaléƒ½è®¾ç½®ä¸º4gï¼Œåœ¨å¯åŠ¨åå°±å·²ç»è·å¾—äº†æœ€å¤§çš„å †å†…å­˜å¤§å°ã€‚è¿è¡Œè¿‡ç¨‹ä¸­ä¸éœ€è¦å‘æ“ä½œç³»ç»Ÿç”³è¯·ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1258.png" alt="img"></p><p>ä½¿ç”¨<code>arthas</code>çš„<code>memory</code>å‘½ä»¤åŒæ ·å¯ä»¥çœ‹åˆ°ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1259-1024x182.png" alt="img"></p><p>ä¸ºä»€ä¹ˆarthasä¸­æ˜¾ç¤ºçš„heapå †å¤§å°ä¸è®¾ç½®çš„å€¼ä¸ä¸€æ ·å‘¢ï¼Ÿ</p><p>arthasä¸­çš„heapå †å†…å­˜ä½¿ç”¨äº†JMXæŠ€æœ¯ä¸­å†…å­˜è·å–æ–¹å¼ï¼Œè¿™ç§æ–¹å¼ä¸åƒåœ¾å›æ”¶å™¨æœ‰å…³ï¼Œè®¡ç®—çš„æ˜¯å¯ä»¥åˆ†é…å¯¹è±¡çš„å†…å­˜ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå†…å­˜ã€‚</p><p><strong>å»ºè®®ï¼š</strong></p><p>JavaæœåŠ¡ç«¯ç¨‹åºå¼€å‘æ—¶ï¼Œå»ºè®®å°†-Xmxå’Œ-Xmsè®¾ç½®ä¸ºç›¸åŒçš„å€¼ï¼Œè¿™æ ·åœ¨ç¨‹åºå¯åŠ¨ä¹‹åå¯ä½¿ç”¨çš„æ€»å†…å­˜å°±æ˜¯æœ€å¤§å†…å­˜ï¼Œè€Œæ— éœ€å‘javaè™šæ‹Ÿæœºå†æ¬¡ç”³è¯·ï¼Œå‡å°‘äº†ç”³è¯·å¹¶åˆ†é…å†…å­˜æ—¶é—´ä¸Šçš„å¼€é”€ï¼ŒåŒæ—¶ä¹Ÿä¸ä¼šå‡ºç°å†…å­˜è¿‡å‰©ä¹‹åå †æ”¶ç¼©çš„æƒ…å†µã€‚-Xmxå…·ä½“è®¾ç½®çš„å€¼ä¸å®é™…çš„åº”ç”¨ç¨‹åºè¿è¡Œç¯å¢ƒæœ‰å…³ï¼Œåœ¨ã€Šå®æˆ˜ç¯‡ã€‹ä¸­ä¼šç»™å‡ºè®¾ç½®æ–¹æ¡ˆã€‚</p><h3 id="3-5-æ–¹æ³•åŒº">3.5 æ–¹æ³•åŒº</h3><p>æ–¹æ³•åŒºæ˜¯å­˜æ”¾åŸºç¡€ä¿¡æ¯çš„ä½ç½®ï¼Œçº¿ç¨‹å…±äº«ï¼Œä¸»è¦åŒ…å«ä¸‰éƒ¨åˆ†å†…å®¹ï¼š</p><ul><li>ç±»çš„å…ƒä¿¡æ¯ï¼Œä¿å­˜äº†æ‰€æœ‰ç±»çš„åŸºæœ¬ä¿¡æ¯</li><li>è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œä¿å­˜äº†å­—èŠ‚ç æ–‡ä»¶ä¸­çš„å¸¸é‡æ± å†…å®¹</li><li>å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œä¿å­˜äº†å­—ç¬¦ä¸²å¸¸é‡</li></ul><h4 id="3-5-1ç±»çš„å…ƒä¿¡æ¯">3.5.1ç±»çš„å…ƒä¿¡æ¯</h4><p>æ–¹æ³•åŒºæ˜¯ç”¨æ¥å­˜å‚¨æ¯ä¸ªç±»çš„åŸºæœ¬ä¿¡æ¯ï¼ˆå…ƒä¿¡æ¯ï¼‰ï¼Œä¸€èˆ¬ç§°ä¹‹ä¸ºInstanceKlasså¯¹è±¡ã€‚åœ¨ç±»çš„åŠ è½½é˜¶æ®µå®Œæˆã€‚å…¶ä¸­å°±åŒ…å«äº†ç±»çš„å­—æ®µã€æ–¹æ³•ç­‰å­—èŠ‚ç æ–‡ä»¶ä¸­çš„å†…å®¹ï¼ŒåŒæ—¶è¿˜ä¿å­˜äº†è¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦ä½¿ç”¨çš„è™šæ–¹æ³•è¡¨ï¼ˆå®ç°å¤šæ€çš„åŸºç¡€ï¼‰ç­‰ä¿¡æ¯ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1261-1024x455.png" alt="img"></p><h4 id="3-5-2è¿è¡Œæ—¶å¸¸é‡æ± ">3.5.2è¿è¡Œæ—¶å¸¸é‡æ± </h4><p>æ–¹æ³•åŒºé™¤äº†å­˜å‚¨ç±»çš„å…ƒä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜å­˜æ”¾äº†è¿è¡Œæ—¶å¸¸é‡æ± ã€‚å¸¸é‡æ± ä¸­å­˜æ”¾çš„æ˜¯å­—èŠ‚ç ä¸­çš„å¸¸é‡æ± å†…å®¹ã€‚</p><p>å­—èŠ‚ç æ–‡ä»¶ä¸­é€šè¿‡ç¼–å·æŸ¥è¡¨çš„æ–¹å¼æ‰¾åˆ°å¸¸é‡ï¼Œè¿™ç§å¸¸é‡æ± ç§°ä¸ºé™æ€å¸¸é‡æ± ã€‚å½“å¸¸é‡æ± åŠ è½½åˆ°å†…å­˜ä¸­ä¹‹åï¼Œå¯ä»¥é€šè¿‡å†…å­˜åœ°å€å¿«é€Ÿçš„å®šä½åˆ°å¸¸é‡æ± ä¸­çš„å†…å®¹ï¼Œè¿™ç§å¸¸é‡æ± ç§°ä¸ºè¿è¡Œæ—¶å¸¸é‡æ± ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1262-1024x318.png" alt="img"></p><h4 id="3-5-3æ–¹æ³•åŒºçš„å®ç°">3.5.3æ–¹æ³•åŒºçš„å®ç°</h4><p>æ–¹æ³•åŒºæ˜¯ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­è®¾è®¡çš„è™šæ‹Ÿæ¦‚å¿µï¼Œæ¯æ¬¾Javaè™šæ‹Ÿæœºåœ¨å®ç°ä¸Šéƒ½å„ä¸ç›¸åŒã€‚Hotspotè®¾è®¡å¦‚ä¸‹ï¼š</p><p>JDK7åŠä¹‹å‰çš„ç‰ˆæœ¬å°†æ–¹æ³•åŒºå­˜æ”¾åœ¨å †åŒºåŸŸä¸­çš„<strong>æ°¸ä¹…ä»£ç©ºé—´</strong>ï¼Œå †çš„å¤§å°ç”±è™šæ‹Ÿæœºå‚æ•°æ¥æ§åˆ¶ã€‚</p><p>JDK8åŠä¹‹åçš„ç‰ˆæœ¬å°†æ–¹æ³•åŒºå­˜æ”¾åœ¨<strong>å…ƒç©ºé—´</strong>ä¸­ï¼Œå…ƒç©ºé—´ä½äºæ“ä½œç³»ç»Ÿç»´æŠ¤çš„ç›´æ¥å†…å­˜ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹åªè¦ä¸è¶…è¿‡æ“ä½œç³»ç»Ÿæ‰¿å—çš„ä¸Šé™ï¼Œå¯ä»¥ä¸€ç›´åˆ†é…ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1263-1024x258.png" alt="img"></p><p>å¯ä»¥é€šè¿‡arthasçš„<code>memory</code>å‘½ä»¤çœ‹åˆ°æ–¹æ³•åŒºçš„åç§°ä»¥åŠå¤§å°ï¼š</p><ul><li>JDK7åŠä¹‹å‰çš„ç‰ˆæœ¬æŸ¥çœ‹ps_perm_genå±æ€§ã€‚</li><li>JDK8åŠä¹‹åçš„ç‰ˆæœ¬æŸ¥çœ‹metaspaceå±æ€§ã€‚</li></ul><h4 id="3-5-4æ–¹æ³•åŒºçš„æº¢å‡º">3.5.4æ–¹æ³•åŒºçš„æº¢å‡º</h4><p>é€šè¿‡ByteBuddyæ¡†æ¶ï¼ŒåŠ¨æ€åˆ›å»ºç±»å¹¶å°†å­—èŠ‚ç æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚é€šè¿‡æ­»å¾ªç¯ä¸åœåœ°åŠ è½½åˆ°æ–¹æ³•åŒºï¼Œè§‚å¯Ÿæ–¹æ³•åŒºæ˜¯å¦ä¼šå‡ºç°å†…å­˜æº¢å‡ºçš„æƒ…å†µã€‚åˆ†åˆ«åœ¨JDK7å’ŒJDK8ä¸Šè¿è¡Œä¸Šè¿°ä»£ç ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1264.png" alt="img"></p><p>å®éªŒå‘ç°ï¼ŒJDK7ä¸Šè¿è¡Œå¤§æ¦‚åå‡ ä¸‡æ¬¡ï¼Œå°±å‡ºç°äº†é”™è¯¯ã€‚</p><p>åœ¨JDK8ä¸Šè¿è¡Œç™¾ä¸‡æ¬¡ï¼Œç¨‹åºéƒ½æ²¡æœ‰å‡ºç°ä»»ä½•é”™è¯¯ï¼Œä½†æ˜¯å†…å­˜ä¼šç›´çº¿å‡é«˜ã€‚è¿™è¯´æ˜JDK7å’ŒJDK8åœ¨æ–¹æ³•åŒºçš„å­˜æ”¾ä¸Šï¼Œé‡‡ç”¨äº†ä¸åŒçš„è®¾è®¡ã€‚</p><ul><li>JDK7å°†æ–¹æ³•åŒºå­˜æ”¾åœ¨å †åŒºåŸŸä¸­çš„æ°¸ä¹…ä»£ç©ºé—´ï¼Œå †çš„å¤§å°ç”±è™šæ‹Ÿæœºå‚æ•°-XX:MaxPermSize=å€¼æ¥æ§åˆ¶ã€‚</li><li>JDK8å°†æ–¹æ³•åŒºå­˜æ”¾åœ¨å…ƒç©ºé—´ä¸­ï¼Œå…ƒç©ºé—´ä½äºæ“ä½œç³»ç»Ÿç»´æŠ¤çš„ç›´æ¥å†…å­˜ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹åªè¦ä¸è¶…è¿‡æ“ä½œç³»ç»Ÿæ‰¿å—çš„ä¸Šé™ï¼Œå¯ä»¥ä¸€ç›´åˆ†é…ã€‚å¯ä»¥ä½¿ç”¨-XX:MaxMetaspaceSize=å€¼å°†å…ƒç©ºé—´æœ€å¤§å¤§å°è¿›è¡Œé™åˆ¶ã€‚</li></ul><p>åœ¨JDK8ä¸­å°†æœ€å¤§å…ƒç©ºé—´å†…å­˜è®¾ç½®ä¸º256mï¼Œå†æ¬¡æµ‹è¯•</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1265.png" alt="img"></p><p>è¿™æ¬¡å°±å‡ºç°äº†MetaSpaceæº¢å‡ºçš„é”™è¯¯ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1266.png" alt="img"></p><h4 id="3-5-5å­—ç¬¦ä¸²å¸¸é‡æ± ">3.5.5å­—ç¬¦ä¸²å¸¸é‡æ± </h4><p>æ–¹æ³•åŒºä¸­é™¤äº†ç±»çš„å…ƒä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€å—åŒºåŸŸå«å­—ç¬¦ä¸²å¸¸é‡æ± (StringTable)ã€‚</p><p>å­—ç¬¦ä¸²å¸¸é‡æ± å­˜å‚¨åœ¨ä»£ç ä¸­å®šä¹‰çš„å¸¸é‡å­—ç¬¦ä¸²å†…å®¹ã€‚æ¯”å¦‚â€œ123â€ è¿™ä¸ª123å°±ä¼šè¢«æ”¾å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ã€‚</p><p>å¦‚ä¸‹ä»£ç æ‰§è¡Œæ—¶ï¼Œä»£ç ä¸­åŒ…å«<code>abc</code>å­—ç¬¦ä¸²ï¼Œå°±ä¼šè¢«ç›´æ¥æ”¾å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ã€‚åœ¨å †ä¸Šåˆ›å»ºStringå¯¹è±¡ï¼Œå¹¶é€šè¿‡å±€éƒ¨å˜é‡s1å¼•ç”¨å †ä¸Šçš„å¯¹è±¡ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1270-1024x396.png" alt="img"></p><p>æ¥ä¸‹æ¥é€šè¿‡s2å±€éƒ¨å˜é‡å¼•ç”¨å­—ç¬¦ä¸²å¸¸é‡æ± çš„<code>abc</code>ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1271-1024x394.png" alt="img"></p><p>æ‰€ä»¥s1å’Œs2æŒ‡å‘çš„ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ‰“å°å‡º<code>false</code>ã€‚</p><p>æ‰€ä»¥s1å’Œs2æŒ‡å‘çš„ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ‰“å°å‡º<code>false</code>ã€‚</p><h5 id="å­—ç¬¦ä¸²å¸¸é‡æ± å’Œè¿è¡Œæ—¶å¸¸é‡æ± æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ">å­—ç¬¦ä¸²å¸¸é‡æ± å’Œè¿è¡Œæ—¶å¸¸é‡æ± æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</h5><p>æ—©æœŸè®¾è®¡æ—¶ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± æ˜¯å±äºè¿è¡Œæ—¶å¸¸é‡æ± çš„ä¸€éƒ¨åˆ†ï¼Œä»–ä»¬å­˜å‚¨çš„ä½ç½®ä¹Ÿæ˜¯ä¸€è‡´çš„ã€‚åç»­åšå‡ºäº†è°ƒæ•´ï¼Œå°†å­—ç¬¦ä¸²å¸¸é‡æ± å’Œè¿è¡Œæ—¶å¸¸é‡æ± åšäº†æ‹†åˆ†ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1272-1024x357.png" alt="img"></p><p>åœ¨ JDK 7 åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œé™æ€å˜é‡æ˜¯å­˜å‚¨åœ¨æ–¹æ³•åŒºï¼ˆæ°¸ä¹…ä»£ï¼‰çš„ï¼Œè€Œä» JDK 8 å¼€å§‹ï¼Œéšç€æ°¸ä¹…ä»£çš„ç§»é™¤ï¼Œé™æ€å˜é‡è¢«å­˜å‚¨åœ¨äº†å †åŒºï¼Œå¹¶ä¸”ä½äº Class å¯¹è±¡å†…éƒ¨ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1273.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1274.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1275.png" alt="img"></p><h5 id="StringTableçš„ç»ƒä¹ é¢˜1ï¼š">StringTableçš„ç»ƒä¹ é¢˜1ï¼š</h5><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1276.png" alt="img"></p><p>1ã€é¦–å…ˆå°†<code>1</code>æ”¾å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œé€šè¿‡å±€éƒ¨å˜é‡aå¼•ç”¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„<code>1</code>å­—ç¬¦ä¸²ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1277-1024x513.png" alt="img"></p><p>2ã€åŒç†å¤„ç†bå’Œcï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1278-1024x506.png" alt="img"></p><p>3ã€å°†aå’ŒbæŒ‡å‘çš„å­—ç¬¦ä¸²è¿›è¡Œè¿æ¥ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä½¿ç”¨StringBuilderè¿›è¡Œè¿æ¥ï¼Œæœ€ååˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²æ”¾å…¥å †ä¸­ã€‚ç„¶åå°†å±€éƒ¨å˜é‡dæŒ‡å‘å †ä¸Šçš„å¯¹è±¡ã€‚</p><p>å› ä¸ºa+bé€šè¿‡stingbuildçš„appendæ–¹æ³•ï¼Œæœ€ånew stringï¼ˆï¼‰ï¼Œ<strong>newå¯¹è±¡æ˜¯æ”¾åœ¨å †ä¸­çš„</strong></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1279-1024x502.png" alt="img"></p><p>4ã€æ‰€ä»¥cå’ŒdæŒ‡å‘çš„ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ‰“å°å‡ºçš„ç»“æœå°±æ˜¯falseã€‚</p><p>å³cæŒ‡å‘äº†å­—ç¬¦ä¸²å¸¸é‡æ± é‡Œçš„&quot;12&quot;ï¼ŒdæŒ‡å‘äº†å †å†…å­˜ä¸­çš„&quot;12&quot;</p><h5 id="StringTableçš„ç»ƒä¹ é¢˜2ï¼š">StringTableçš„ç»ƒä¹ é¢˜2ï¼š</h5><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1280.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1281-1024x453.png" alt="img"></p><p>è¯´æ˜åœ¨ç¼–è¯‘é˜¶æ®µï¼Œå·²ç»å°†1å’Œ2è¿›è¡Œè¿æ¥ï¼Œæœ€ç»ˆç”Ÿæˆ12çš„å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„ç»“æœã€‚æ‰€ä»¥è¿”å›ç»“æœå°±æ˜¯trueï¼Œcå’Œdéƒ½æŒ‡å‘å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å¯¹è±¡ã€‚</p><p>æ€»ç»“ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1282-1024x311.png" alt="img"></p><h5 id="internæ–¹æ³•">internæ–¹æ³•</h5><p>String.intern()æ–¹æ³•æ˜¯å¯ä»¥æ‰‹åŠ¨å°†å­—ç¬¦ä¸²æ”¾å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1283-1024x468.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1284.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1285.png" alt="img"></p><p>ç»“è®ºï¼šJDK7ä»¥åŠä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬åœ¨å †ä¸Šåˆ›å»ºçš„å­—ç¬¦ä¸²ï¼Œå¦‚æœè°ƒç”¨äº†internï¼ˆï¼‰æ–¹æ³•ï¼Œå®ƒåªæ˜¯åœ¨å¸¸é‡æ± ä¸­å­˜æ”¾äº†è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œè€Œä¸å†ä¼šæŠŠå­—ç¬¦ä¸²æ¬è¿åˆ°å¸¸é‡æ± ä¸­</p><h4 id="3-5-6é¢è¯•é¢˜ï¼šé™æ€å˜é‡å­˜å‚¨åœ¨å“ªé‡Œå‘¢ï¼Ÿ">3.5.6é¢è¯•é¢˜ï¼šé™æ€å˜é‡å­˜å‚¨åœ¨å“ªé‡Œå‘¢ï¼Ÿ</h4><ul><li>JDK6åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œé™æ€å˜é‡æ˜¯å­˜æ”¾åœ¨æ–¹æ³•åŒºä¸­çš„ï¼Œä¹Ÿå°±æ˜¯æ°¸ä¹…ä»£ã€‚</li><li>JDK7åŠä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œé™æ€å˜é‡æ˜¯å­˜æ”¾åœ¨å †ä¸­çš„Classå¯¹è±¡ä¸­ï¼Œè„±ç¦»äº†æ°¸ä¹…ä»£ã€‚å…·ä½“æºç å¯å‚è€ƒè™šæ‹Ÿæœºæºç ï¼šBytecodeInterpreteré’ˆå¯¹putstaticæŒ‡ä»¤çš„å¤„ç†ã€‚</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1286-1024x522.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1287-1024x613.png" alt="img"></p><h3 id="3-6-ç›´æ¥å†…å­˜">3.6 ç›´æ¥å†…å­˜</h3><p>ç›´æ¥å†…å­˜ï¼ˆDirect Memoryï¼‰å¹¶ä¸åœ¨ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­å­˜åœ¨ï¼Œæ‰€ä»¥å¹¶ä¸å±äºJavaè¿è¡Œæ—¶çš„å†…å­˜åŒºåŸŸã€‚</p><p>åœ¨ JDK 1.4 ä¸­å¼•å…¥äº† NIO æœºåˆ¶ï¼Œä½¿ç”¨äº†ç›´æ¥å†…å­˜ï¼Œä¸»è¦ä¸ºäº†è§£å†³ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜:</p><ul><li>1ã€Javaå †ä¸­çš„å¯¹è±¡å¦‚æœä¸å†ä½¿ç”¨è¦å›æ”¶ï¼Œå›æ”¶æ—¶ä¼šå½±å“å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨ã€‚</li><li>2ã€IOæ“ä½œæ¯”å¦‚è¯»æ–‡ä»¶ï¼Œéœ€è¦å…ˆæŠŠæ–‡ä»¶è¯»å…¥ç›´æ¥å†…å­˜ï¼ˆç¼“å†²åŒºï¼‰å†æŠŠæ•°æ®å¤åˆ¶åˆ°Javaå †ä¸­ã€‚</li></ul><p>ç°åœ¨ç›´æ¥æ”¾å…¥ç›´æ¥å†…å­˜å³å¯ï¼ŒåŒæ—¶Javaå †ä¸Šç»´æŠ¤ç›´æ¥å†…å­˜çš„å¼•ç”¨ï¼Œå‡å°‘äº†æ•°æ®å¤åˆ¶çš„å¼€é”€ã€‚å†™æ–‡ä»¶ä¹Ÿæ˜¯ç±»ä¼¼çš„æ€è·¯ã€‚</p><p>ä½¿ç”¨å †åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1288-1024x263.png" alt="img"></p><p>å¦‚æœä½¿ç”¨ç›´æ¥å†…å­˜åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ï¼Œå°±ä¸éœ€è¦è¿›è¡Œå¤åˆ¶å¯¹è±¡ï¼Œæ•°æ®ç›´æ¥å­˜æ”¾åœ¨ç›´æ¥å†…å­˜ä¸­ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1289-1024x221.png" alt="img"></p><h4 id="3-6-1ä½¿ç”¨æ–¹æ³•">3.6.1ä½¿ç”¨æ–¹æ³•</h4><p>è¦åˆ›å»ºç›´æ¥å†…å­˜ä¸Šçš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨<code>ByteBuffer</code>ã€‚</p><p>è¯­æ³•ï¼š <code>ByteBuffer directBuffer = ByteBuffer.allocateDirect(size);</code></p><p>æ³¨æ„äº‹é¡¹ï¼š arthasçš„memoryå‘½ä»¤å¯ä»¥æŸ¥çœ‹ç›´æ¥å†…å­˜å¤§å°ï¼Œå±æ€§ådirectã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1290-1024x265.png" alt="img"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chapter03.direct;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç›´æ¥å†…å­˜çš„ä½¿ç”¨å’Œå›æ”¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">100</span>; <span class="comment">//100mb</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;ByteBuffer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;ByteBuffer&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        System.in.read();</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="comment">//1.åˆ›å»ºDirectByteBufferå¯¹è±¡å¹¶è¿”å›</span></span><br><span class="line">            <span class="comment">//2.åœ¨DirectByteBufferæ„é€ æ–¹æ³•ä¸­ï¼Œå‘æ“ä½œç³»ç»Ÿç”³è¯·ç›´æ¥å†…å­˜ç©ºé—´</span></span><br><span class="line">            <span class="type">ByteBuffer</span> <span class="variable">directBuffer</span> <span class="operator">=</span> ByteBuffer.allocateDirect(size);</span><br><span class="line">            <span class="comment">//directBuffer = null;</span></span><br><span class="line"></span><br><span class="line">            list.add(directBuffer);</span><br><span class="line">            System.out.println(++count);</span><br><span class="line">            Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¹‹åï¼Œç”¨arthasç›‘æ§å‘ç°ï¼Œæ¯éš”5ç§’ç›´æ¥å†…å­˜ä¼šå¢é•¿100Mï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1291.png" alt="img"></p><p>å¦‚æœå°†<code>Thread.</code><em><code>sleep</code></em><code>(5000);</code>æ³¨é‡Šæ‰ï¼Œè®©ç›´æ¥å†…å­˜å¿«é€Ÿå¤§é‡åˆ†é…ã€‚æ“ä½œç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶å°±ä¼šæŠ¥é”™ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1292.png" alt="img"></p><h4 id="3-6-2è®¾ç½®ç›´æ¥å†…å­˜">3.6.2è®¾ç½®ç›´æ¥å†…å­˜</h4><p>ä¸ºäº†é¿å…å°†å†…å­˜è€—å°½ï¼Œéœ€è¦è®¾ç½®ç›´æ¥å†…å­˜çš„æœ€å¤§å€¼ã€‚å¦‚æœéœ€è¦æ‰‹åŠ¨è°ƒæ•´ç›´æ¥å†…å­˜çš„å¤§å°ï¼Œå¯ä»¥ä½¿ç”¨<code>XX:MaxDirectMemorySize=å¤§å°</code></p><p>å•ä½kæˆ–Kè¡¨ç¤ºåƒå­—èŠ‚ï¼Œmæˆ–Mè¡¨ç¤ºå…†å­—èŠ‚ï¼Œgæˆ–Gè¡¨ç¤ºåƒå…†å­—èŠ‚ã€‚é»˜è®¤ä¸è®¾ç½®è¯¥å‚æ•°æƒ…å†µä¸‹ï¼ŒJVM è‡ªåŠ¨é€‰æ‹© æœ€å¤§åˆ†é…çš„å¤§å°ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹ä»¥ä¸åŒçš„å•ä½è¯´æ˜å¦‚ä½•å°† ç›´æ¥å†…å­˜å¤§å°è®¾ç½®ä¸º 1024 KBï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-XX:<span class="attribute">MaxDirectMemorySize</span>=1m</span><br><span class="line">-XX:<span class="attribute">MaxDirectMemorySize</span>=1024k</span><br><span class="line">-XX:<span class="attribute">MaxDirectMemorySize</span>=1048576</span><br></pre></td></tr></table></figure><p>åœ¨Ideaä¸­è®¾ç½®ç›´æ¥å†…å­˜æœ€å¤§å€¼ä¸º1gï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1293.png" alt="img"></p><h2 id="4ã€åƒåœ¾å›æ”¶">4ã€åƒåœ¾å›æ”¶</h2><p>åœ¨C/C++è¿™ç±»æ²¡æœ‰è‡ªåŠ¨åƒåœ¾å›æ”¶æœºåˆ¶çš„è¯­è¨€ä¸­ï¼Œä¸€ä¸ªå¯¹è±¡å¦‚æœä¸å†ä½¿ç”¨ï¼Œéœ€è¦æ‰‹åŠ¨é‡Šæ”¾ï¼Œå¦åˆ™å°±ä¼šå‡ºç°å†…å­˜æ³„æ¼ã€‚</p><p>å†…å­˜æ³„æ¼æŒ‡çš„æ˜¯ä¸å†ä½¿ç”¨çš„å¯¹è±¡åœ¨ç³»ç»Ÿä¸­æœªè¢«å›æ”¶ï¼Œå†…å­˜æ³„æ¼çš„ç§¯ç´¯å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚</p><p>æˆ‘ä»¬ç§°è¿™ç§<strong>é‡Šæ”¾å¯¹è±¡çš„è¿‡ç¨‹ä¸ºåƒåœ¾å›æ”¶</strong>ï¼Œè€Œéœ€è¦<strong>ç¨‹åºå‘˜ç¼–å†™ä»£ç è¿›è¡Œå›æ”¶çš„æ–¹å¼ä¸ºæ‰‹åŠ¨å›æ”¶</strong>ã€‚æ‰‹åŠ¨å›æ”¶çš„æ–¹å¼ç›¸å¯¹æ¥è¯´å›æ”¶æ¯”è¾ƒåŠæ—¶ï¼Œåˆ é™¤ä»£ç æ‰§è¡Œä¹‹åå¯¹è±¡å°±è¢«å›æ”¶äº†ï¼Œå¯ä»¥å¿«é€Ÿé‡Šæ”¾å†…å­˜ã€‚ç¼ºç‚¹æ˜¯å¯¹ç¨‹åºå‘˜è¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¾ˆå®¹æ˜“å‡ºç°åˆ›å»ºå®Œå¯¹è±¡ä¹‹åï¼Œç¨‹åºå‘˜å¿˜è®°é‡Šæ”¾å¯¹è±¡ã€‚</p><p>Javaä¸­ä¸ºäº†ç®€åŒ–å¯¹è±¡çš„é‡Šæ”¾ï¼Œå¼•å…¥äº†<strong>è‡ªåŠ¨çš„åƒåœ¾å›æ”¶ï¼ˆGarbage Collectionç®€ç§°GC</strong>ï¼‰æœºåˆ¶ã€‚é€šè¿‡åƒåœ¾å›æ”¶å™¨æ¥å¯¹ä¸å†ä½¿ç”¨çš„å¯¹è±¡å®Œæˆè‡ªåŠ¨çš„å›æ”¶ï¼Œåƒåœ¾å›æ”¶å™¨ä¸»è¦è´Ÿè´£å¯¹å †ä¸Šçš„å†…å­˜è¿›è¡Œå›æ”¶ã€‚å…¶ä»–å¾ˆå¤šç°ä»£è¯­è¨€æ¯”å¦‚C#ã€Pythonã€Goéƒ½æ‹¥æœ‰è‡ªå·±çš„åƒåœ¾å›æ”¶å™¨ã€‚</p><p>åƒåœ¾å›æ”¶å™¨å¦‚æœå‘ç°æŸä¸ªå¯¹è±¡ä¸å†ä½¿ç”¨ï¼Œå°±å¯ä»¥å›æ”¶è¯¥å¯¹è±¡ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1294-1024x351.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1295-1024x362.png" alt="img"></p><ul><li>è‡ªåŠ¨åƒåœ¾å›æ”¶ï¼Œè‡ªåŠ¨æ ¹æ®å¯¹è±¡æ˜¯å¦ä½¿ç”¨ç”±è™šæ‹Ÿæœºæ¥å›æ”¶å¯¹è±¡<ul><li>ä¼˜ç‚¹ï¼šé™ä½ç¨‹åºå‘˜å®ç°éš¾åº¦ã€é™ä½å¯¹è±¡å›æ”¶bugçš„å¯èƒ½æ€§</li><li>ç¼ºç‚¹ï¼šç¨‹åºå‘˜æ— æ³•æ§åˆ¶å†…å­˜å›æ”¶çš„åŠæ—¶æ€§</li></ul></li><li>æ‰‹åŠ¨åƒåœ¾å›æ”¶ï¼Œç”±ç¨‹åºå‘˜ç¼–ç¨‹å®ç°å¯¹è±¡çš„åˆ é™¤<ul><li>ä¼˜ç‚¹ï¼šå›æ”¶åŠæ—¶æ€§é«˜ï¼Œç”±ç¨‹åºå‘˜æŠŠæ§å›æ”¶çš„æ—¶æœº</li><li>ç¼ºç‚¹ï¼šç¼–å†™ä¸å½“å®¹æ˜“å‡ºç°æ‚¬ç©ºæŒ‡é’ˆã€é‡å¤é‡Šæ”¾ã€å†…å­˜æ³„æ¼ç­‰é—®é¢˜</li></ul></li></ul><p><strong>é‚£ä¹ˆåƒåœ¾å›æ”¶å™¨éœ€è¦è´Ÿè´£å¯¹å“ªäº›éƒ¨åˆ†çš„å†…å­˜è¿›è¡Œå›æ”¶å‘¢ï¼Ÿ</strong></p><p>é¦–å…ˆæ˜¯<strong>çº¿ç¨‹ä¸å…±äº«çš„éƒ¨åˆ†</strong>ï¼Œéƒ½æ˜¯ä¼´éšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œçº¿ç¨‹çš„é”€æ¯è€Œé”€æ¯ã€‚è€Œæ–¹æ³•çš„æ ˆå¸§åœ¨æ‰§è¡Œå®Œæ–¹æ³•ä¹‹åå°±ä¼šè‡ªåŠ¨å¼¹å‡ºæ ˆå¹¶é‡Šæ”¾æ‰å¯¹åº”çš„å†…å­˜ã€‚æ‰€ä»¥è¿™ä¸€éƒ¨åˆ†ä¸éœ€è¦åƒåœ¾å›æ”¶å™¨è´Ÿè´£å›æ”¶ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1296.png" alt="img"></p><h3 id="4-1-æ–¹æ³•åŒºçš„å›æ”¶">4.1 æ–¹æ³•åŒºçš„å›æ”¶</h3><p>æ–¹æ³•åŒºä¸­èƒ½å›æ”¶çš„å†…å®¹ä¸»è¦å°±æ˜¯ä¸å†ä½¿ç”¨çš„ç±»ã€‚</p><ul><li>äº†è§£å³å¯ï¼Œå› ä¸ºåœ¨å®é™…å¼€å‘ä¸­ï¼Œå¾ˆéš¾åŒæ—¶æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ã€‚</li><li>å› ä¸ºï¼Œè‡ªå·±ç¼–å†™çš„ç±»æ˜¯ç”±åº”ç”¨ç¨‹åºåŠ è½½å™¨åŠ è½½ï¼Œè€Œè¿™ä¸ªåŠ è½½å™¨åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ˜¯ä¸ä¼šè¢«å›æ”¶çš„,æ‰€ä»¥è‡ªå·±ç¼–å†™çš„ç±»ï¼Œåªè¦è¢«åŠ è½½ï¼Œå°±ä¸ä¼šè¢«å›æ”¶</li></ul><p>åˆ¤å®šä¸€ä¸ªç±»å¯ä»¥è¢«å¸è½½ã€‚éœ€è¦<strong>åŒæ—¶æ»¡è¶³ä¸‹é¢ä¸‰ä¸ªæ¡ä»¶</strong>ï¼š</p><p>1ã€æ­¤ç±»æ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½å·²ç»è¢«å›æ”¶ï¼Œåœ¨å †ä¸­ä¸å­˜åœ¨ä»»ä½•è¯¥ç±»çš„å®ä¾‹å¯¹è±¡ä»¥åŠå­ç±»å¯¹è±¡ã€‚</p><p>è¿™æ®µä»£ç ä¸­å°±å°†å±€éƒ¨å˜é‡å¯¹å †ä¸Šå®ä¾‹å¯¹è±¡çš„å¼•ç”¨å»é™¤äº†ï¼Œæ‰€ä»¥å¯¹è±¡å°±å¯ä»¥è¢«å›æ”¶ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1299.png" alt="img"></p><p>2ã€åŠ è½½è¯¥ç±»çš„ç±»åŠ è½½å™¨å·²ç»è¢«å›æ”¶ã€‚</p><p>è¿™æ®µä»£ç è®©å±€éƒ¨å˜é‡å¯¹ç±»åŠ è½½å™¨çš„å¼•ç”¨å»é™¤ï¼Œç±»åŠ è½½å™¨å°±å¯ä»¥å›æ”¶ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1300-1024x190.png" alt="img"></p><p>3ã€è¯¥ç±»å¯¹åº”çš„ java.lang.Class å¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1301.png" alt="img"></p><p><strong>å¦‚æœéœ€è¦æ‰‹åŠ¨è§¦å‘åƒåœ¾å›æ”¶ï¼Œå¯ä»¥è°ƒç”¨System.gc()æ–¹æ³•ã€‚</strong></p><p>è°ƒç”¨System.gc()æ–¹æ³•å¹¶ä¸ä¸€å®šä¼šç«‹å³å›æ”¶åƒåœ¾ï¼Œä»…ä»…å‘JAVAè™šæ‹Ÿæœºå‘é€ä¸€ä¸ªåƒåœ¾å›æ”¶çš„è¯·æ±‚ï¼Œå…·ä½“æ˜¯å¦éœ€è¦æ‰§è¡Œåƒåœ¾å›æ”¶Javaè™šæ‹Ÿæœºä¼šè‡ªè¡Œåˆ¤æ–­ã€‚</p><p><strong>é‚£ä¹ˆç±»å¸è½½ä¸»è¦ç”¨åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹å‘¢ï¼Ÿ</strong></p><p>å¼€å‘ä¸­æ­¤ç±»åœºæ™¯ä¸€èˆ¬å¾ˆå°‘å‡ºç°ï¼Œä¸»è¦åœ¨å¦‚ OSGiã€JSP çš„çƒ­éƒ¨ç½²ç­‰åº”ç”¨åœºæ™¯ä¸­ã€‚</p><p>æ¯ä¸ªjspæ–‡ä»¶å¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„ç±»åŠ è½½å™¨ï¼Œå½“ä¸€ä¸ªjspæ–‡ä»¶ä¿®æ”¹äº†ï¼Œå°±ç›´æ¥å¸è½½è¿™ä¸ªjspç±»åŠ è½½å™¨ã€‚é‡æ–°åˆ›å»ºç±»åŠ è½½å™¨ï¼Œé‡æ–°åŠ è½½jspæ–‡ä»¶ã€‚</p><h3 id="4-2-å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶">4.2 å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶</h3><p>Javaä¸­çš„å¯¹è±¡æ˜¯å¦èƒ½è¢«å›æ”¶ï¼Œæ˜¯æ ¹æ®å¯¹è±¡æ˜¯å¦è¢«å¼•ç”¨æ¥å†³å®šçš„ã€‚å¦‚æœå¯¹è±¡è¢«å¼•ç”¨äº†ï¼Œè¯´æ˜è¯¥å¯¹è±¡è¿˜åœ¨ä½¿ç”¨ï¼Œä¸å…è®¸è¢«å›æ”¶ã€‚</p><p>æ¯”å¦‚ä¸‹é¢ä»£ç çš„å†…å­˜ç»“æ„å›¾ï¼š</p><p>ç¬¬ä¸€è¡Œä»£ç æ‰§è¡Œä¹‹åï¼Œå †ä¸Šåˆ›å»ºäº†Demoç±»çš„å®ä¾‹å¯¹è±¡ï¼ŒåŒæ—¶æ ˆä¸Šä¿å­˜å±€éƒ¨å˜é‡å¼•ç”¨å †ä¸Šçš„å¯¹è±¡ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1303-1024x326.png" alt="img"></p><p>ç¬¬äºŒè¡Œä»£ç æ‰§è¡Œä¹‹åï¼Œå±€éƒ¨å˜é‡å¯¹å †ä¸Šçš„å¯¹è±¡å¼•ç”¨å»æ‰ï¼Œé‚£ä¹ˆå †ä¸Šçš„å¯¹è±¡å°±å¯ä»¥è¢«å›æ”¶äº†ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1304-1024x327.png" alt="img"></p><p>ä¸€ä¸ªæ›´å¤æ‚çš„æ¡ˆä¾‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1305-1024x357.png" alt="img"></p><p>è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œå¦‚æœè¦è®©å¯¹è±¡aå’Œbå›æ”¶ï¼Œå¿…é¡»å°†å±€éƒ¨å˜é‡åˆ°å †ä¸Šçš„å¼•ç”¨å»é™¤ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1306-1024x366.png" alt="img"></p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼ŒAå’ŒBäº’ç›¸ä¹‹é—´çš„å¼•ç”¨éœ€è¦å»é™¤å—ï¼Ÿç­”æ¡ˆæ˜¯ä¸éœ€è¦ï¼Œå› ä¸ºå±€éƒ¨å˜é‡éƒ½æ²¡å¼•ç”¨è¿™ä¸¤ä¸ªå¯¹è±¡äº†ï¼Œåœ¨ä»£ç ä¸­å·²ç»æ— æ³•è®¿é—®è¿™ä¸¤ä¸ªå¯¹è±¡ï¼Œå³ä¾¿ä»–ä»¬ä¹‹é—´äº’ç›¸æœ‰å¼•ç”¨å…³ç³»ï¼Œä¹Ÿä¸å½±å“å¯¹è±¡çš„å›æ”¶ã€‚</p><p>åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯ä»¥å›æ”¶ï¼Œä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼šå¼•ç”¨è®¡æ•°æ³•å’Œå¯è¾¾æ€§åˆ†ææ³•ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1307-1024x468.png" alt="img"></p><h4 id="4-2-1å¼•ç”¨è®¡æ•°æ³•">4.2.1å¼•ç”¨è®¡æ•°æ³•</h4><p>å¼•ç”¨è®¡æ•°æ³•ä¼šä¸ºæ¯ä¸ªå¯¹è±¡ç»´æŠ¤ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œå½“å¯¹è±¡è¢«å¼•ç”¨æ—¶åŠ 1ï¼Œå–æ¶ˆå¼•ç”¨æ—¶å‡1ã€‚</p><p>å¯¹è±¡Açš„è®¡æ•°å™¨åˆå§‹ä¸º0ï¼Œå±€éƒ¨å˜é‡a1å¯¹å®ƒå¼•ç”¨ä¹‹åï¼Œè®¡æ•°å™¨åŠ 1å°±å˜æˆäº†1ã€‚åŒæ ·Aå¯¹Bäº§ç”Ÿäº†å¼•ç”¨ï¼ŒBçš„è®¡æ•°å™¨ä¹Ÿæ˜¯1ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1308-1024x409.png" alt="img"></p><p>ä¼˜è¶Šç‚¹ï¼š</p><p>å¼•ç”¨è®¡æ•°æ³•çš„<strong>ä¼˜ç‚¹æ˜¯å®ç°ç®€å•</strong>ï¼ŒC++ä¸­çš„æ™ºèƒ½æŒ‡é’ˆå°±é‡‡ç”¨äº†å¼•ç”¨è®¡æ•°æ³•ï¼Œä½†æ˜¯å®ƒä¹Ÿå­˜åœ¨ç¼ºç‚¹ï¼Œä¸»è¦æœ‰ä¸¤ç‚¹ï¼š</p><ul><li>1.æ¯æ¬¡å¼•ç”¨å’Œå–æ¶ˆå¼•ç”¨éƒ½éœ€è¦ç»´æŠ¤è®¡æ•°å™¨ï¼Œå¯¹ç³»ç»Ÿæ€§èƒ½ä¼šæœ‰ä¸€å®šçš„å½±å“</li><li>2.å­˜åœ¨å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œæ‰€è°“å¾ªç¯å¼•ç”¨å°±æ˜¯å½“Aå¼•ç”¨Bï¼ŒBåŒæ—¶å¼•ç”¨Aæ—¶ä¼šå‡ºç°å¯¹è±¡æ— æ³•å›æ”¶çš„é—®é¢˜ã€‚</li></ul><p>å¦‚ä¸‹å›¾ç”±äºAå’ŒBä¹‹é—´å­˜åœ¨äº’ç›¸å¼•ç”¨ï¼Œæ‰€ä»¥è®¡æ•°å™¨éƒ½ä¸º1ï¼Œä¸¤ä¸ªå¯¹è±¡éƒ½ä¸èƒ½è¢«å›æ”¶ã€‚ä½†æ˜¯ç”±äºæ²¡æœ‰å±€éƒ¨å˜é‡å¯¹è¿™ä¸¤ä¸ªä»£ç äº§ç”Ÿå¼•ç”¨ï¼Œä»£ç ä¸­å·²ç»æ— æ³•è®¿é—®åˆ°è¿™ä¸¤ä¸ªå¯¹è±¡ï¼Œç†åº”å¯ä»¥è¢«å›æ”¶ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1309-1024x372.png" alt="img"></p><p>æŸ¥çœ‹åƒåœ¾å›æ”¶æ—¥å¿—</p><p>å¦‚æœæƒ³è¦æŸ¥çœ‹åƒåœ¾å›æ”¶çš„ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨<code>-verbose:gc</code>å‚æ•°ã€‚</p><p>è¯­æ³•ï¼š <code>-verbose:gc</code></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1310-1024x258.png" alt="img"></p><p>åŠ ä¸Šè¿™ä¸ªå‚æ•°ä¹‹åæ‰§è¡Œä»£ç ï¼Œå‘ç°å¯¹è±¡ç¡®å®è¢«å›æ”¶äº†ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1313-1024x763.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1311.png" alt="img"></p><p>é€šè¿‡ä¸åŒçš„æ­»å¾ªç¯åˆ›å»ºå¯¹è±¡ï¼Œå†…å­˜å¹¶æ²¡æœ‰ä¸Šå‡ï¼Œä¸€ç›´ç»´æŒåœ¨1000K,è¯´æ˜æ¯è½®å¾ªç¯åˆ›å»ºçš„ä¸¤ä¸ªå¯¹è±¡åœ¨åƒåœ¾å›æ”¶ä¹‹åéƒ½è¢«å›æ”¶äº†ã€‚å³æ²¡æœ‰å‘ç”Ÿå†…å­˜æ³„æ¼</p><h4 id="4-2-2å¯è¾¾æ€§åˆ†ææ³•">4.2.2å¯è¾¾æ€§åˆ†ææ³•</h4><p>Javaä½¿ç”¨çš„æ˜¯å¯è¾¾æ€§åˆ†æç®—æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯ä»¥è¢«å›æ”¶ã€‚å¯è¾¾æ€§åˆ†æå°†å¯¹è±¡åˆ†ä¸ºä¸¤ç±»ï¼šåƒåœ¾å›æ”¶çš„<strong>æ ¹å¯¹è±¡ï¼ˆGC Rootï¼‰<strong>å’Œ</strong>æ™®é€šå¯¹è±¡</strong>ï¼Œå¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´å­˜åœ¨<strong>å¼•ç”¨å…³ç³»</strong>ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1314-1024x351.png" alt="img"></p><h5 id="å“ªäº›å¯¹è±¡è¢«ç§°ä¹‹ä¸ºGC-Rootå¯¹è±¡å‘¢ï¼Ÿ">å“ªäº›å¯¹è±¡è¢«ç§°ä¹‹ä¸ºGC Rootå¯¹è±¡å‘¢ï¼Ÿ</h5><p>1.çº¿ç¨‹Threadå¯¹è±¡ï¼ˆåˆ›å»ºçº¿ç¨‹ä¹‹åï¼Œæ•´ä¸ªçº¿ç¨‹å¯¹è±¡ï¼‰ï¼Œå¼•ç”¨çº¿ç¨‹æ ˆå¸§ä¸­çš„æ–¹æ³•å‚æ•°ã€å±€éƒ¨å˜é‡ç­‰ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1315.png" alt="img"></p><p>2.ç³»ç»Ÿç±»åŠ è½½å™¨åŠ è½½çš„java.lang.Classå¯¹è±¡ï¼Œå¼•ç”¨ç±»ä¸­çš„é™æ€å˜é‡ã€‚</p><p>è§£é‡Šä¸€ä¸‹2ï¼šç³»ç»Ÿç±»åŠ è½½å™¨ä¹Ÿå°±æ˜¯åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼Œå‰é¢è¯´åˆ°è¿‡ï¼Œä»–æ˜¯ä¸å¯å›æ”¶çš„ï¼Œè¿™ä¸ªç±»åŠ è½½å™¨ä¸ä¼šè¢«å›æ”¶ï¼Œæ‰€ä»¥è¿™ä¸ªç±»ä¹Ÿå°±ä¸ä¼šè¢«å›æ”¶ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»é‡Œé¢çš„é™æ€å˜é‡ä¹Ÿå°±ä¸ä¼šè¢«å›æ”¶ï¼Œæ‰€ä»¥å°±å¯ä»¥æ˜¯GC rootå¯¹è±¡</p><p>LauncheråŒ…å«åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨å’ŒGC Rootå¯¹è±¡ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1316.png" alt="img"></p><p>3.ç›‘è§†å™¨å¯¹è±¡ï¼Œç”¨æ¥ä¿å­˜åŒæ­¥é”synchronizedå…³é”®å­—æŒæœ‰çš„å¯¹è±¡ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1317-1024x289.png" alt="img"></p><p>4.æœ¬åœ°æ–¹æ³•è°ƒç”¨æ—¶ä½¿ç”¨çš„å…¨å±€å¯¹è±¡ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1318.png" alt="img"></p><h5 id="æŸ¥çœ‹GC-Root">æŸ¥çœ‹GC Root</h5><p>é€šè¿‡arthaså’Œeclipse Memory Analyzerå·¥å…·å¯ä»¥æŸ¥çœ‹GC Rootï¼ŒMATå·¥å…·æ˜¯eclipseæ¨å‡ºçš„Javaå †å†…å­˜æ£€æµ‹å·¥å…·ã€‚</p><p>1.ä½¿ç”¨arthasçš„heapdumpå‘½ä»¤å¯å°†å†…å­˜å¿«ç…§ä¿å­˜åˆ°æœ¬åœ°ç£ç›˜ä¸­ã€‚</p><p>2.ä½¿ç”¨MATå·¥å…·æ‰“å¼€å †å†…å­˜å¿«ç…§æ–‡ä»¶ã€‚</p><p>3.é€‰æ‹©GC RootsåŠŸèƒ½æŸ¥çœ‹æ‰€æœ‰çš„GC Rootã€‚</p><h3 id="4-3-å¸¸è§çš„å¼•ç”¨å¯¹è±¡">4.3 å¸¸è§çš„å¼•ç”¨å¯¹è±¡</h3><p>å¯è¾¾æ€§ç®—æ³•ä¸­æè¿°çš„å¯¹è±¡å¼•ç”¨ï¼Œä¸€èˆ¬æŒ‡çš„æ˜¯<strong>å¼ºå¼•ç”¨</strong>ï¼Œå³æ˜¯GCRootå¯¹è±¡å¯¹æ™®é€šå¯¹è±¡æœ‰å¼•ç”¨å…³ç³»ï¼Œåªè¦è¿™å±‚å…³ç³»å­˜åœ¨ï¼Œæ™®é€šå¯¹è±¡å°±ä¸ä¼šè¢«å›æ”¶ã€‚é™¤äº†å¼ºå¼•ç”¨ä¹‹å¤–ï¼ŒJavaä¸­è¿˜è®¾è®¡äº†å‡ ç§å…¶ä»–å¼•ç”¨æ–¹å¼ï¼š</p><ul><li><strong>è½¯å¼•ç”¨</strong></li><li><strong>å¼±å¼•ç”¨</strong></li><li><strong>è™šå¼•ç”¨</strong></li><li><strong>ç»ˆç»“å™¨å¼•ç”¨</strong></li></ul><h4 id="4-3-1è½¯å¼•ç”¨">4.3.1è½¯å¼•ç”¨</h4><p>å¦‚æœä¸€ä¸ªå¯¹è±¡åªæœ‰è½¯å¼•ç”¨å…³è”åˆ°å®ƒï¼Œ<strong>å½“ç¨‹åºå†…å­˜ä¸è¶³æ—¶</strong>ï¼Œå°±ä¼šå°†è½¯å¼•ç”¨ä¸­çš„æ•°æ®è¿›è¡Œå›æ”¶ã€‚åœ¨JDK 1.2ç‰ˆä¹‹åæä¾›äº†SoftReferenceç±»æ¥å®ç°è½¯å¼•ç”¨ï¼Œè½¯å¼•ç”¨å¸¸ç”¨äº<strong>ç¼“å­˜</strong>ä¸­ã€‚</p><p>è½¯å¼•å…¥çš„å¥½å¤„ï¼Ÿ</p><p>å¦‚æœå¯¹è±¡Aæ˜¯ä¸€ä¸ªç¼“å­˜ï¼Œå¹³æ—¶ä¼šä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå¦‚æœæƒ³è®¿é—®æ•°æ®å¯ä»¥å¿«é€Ÿè®¿é—®ã€‚ä½†æ˜¯å¦‚æœå†…å­˜ä¸å¤Ÿç”¨äº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†è¿™éƒ¨åˆ†ç¼“å­˜æ¸…ç†æ‰é‡Šæ”¾å†…å­˜ã€‚å³ä¾¿ç¼“å­˜æ²¡äº†ï¼Œä¹Ÿå¯ä»¥ä»æ•°æ®åº“ç­‰åœ°æ–¹è·å–æ•°æ®ï¼Œä¸ä¼šå½±å“åˆ°ä¸šåŠ¡æ­£å¸¸è¿è¡Œï¼Œè¿™æ ·å¯ä»¥å‡å°‘å†…å­˜æº¢å‡ºäº§ç”Ÿçš„å¯èƒ½æ€§ã€‚</p><p><strong>ç‰¹åˆ«æ³¨æ„ï¼š</strong></p><p><strong>è½¯å¼•ç”¨å¯¹è±¡æœ¬èº«ï¼Œä¹Ÿéœ€è¦è¢«å¼ºå¼•ç”¨ï¼Œå¦åˆ™è½¯å¼•ç”¨å¯¹è±¡ä¹Ÿä¼šè¢«å›æ”¶æ‰</strong>ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1323-1024x464.png" alt="img"></p><h5 id="è½¯å¼•ç”¨çš„ä½¿ç”¨æ–¹æ³•">è½¯å¼•ç”¨çš„ä½¿ç”¨æ–¹æ³•</h5><p>è½¯å¼•ç”¨çš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p>1.å°†å¯¹è±¡ä½¿ç”¨è½¯å¼•ç”¨åŒ…è£…èµ·æ¥ï¼Œnew SoftReference&lt;å¯¹è±¡ç±»å‹&gt;(å¯¹è±¡)ã€‚</p><p>2.å†…å­˜ä¸è¶³æ—¶ï¼Œè™šæ‹Ÿæœºå°è¯•è¿›è¡Œåƒåœ¾å›æ”¶ã€‚</p><p>3.å¦‚æœåƒåœ¾å›æ”¶ä»ä¸èƒ½è§£å†³å†…å­˜ä¸è¶³çš„é—®é¢˜ï¼Œå›æ”¶è½¯å¼•ç”¨ä¸­çš„å¯¹è±¡ã€‚</p><p>4.å¦‚æœä¾ç„¶å†…å­˜ä¸è¶³ï¼ŒæŠ›å‡ºOutOfMemoryå¼‚å¸¸ã€‚</p><p>æŠŠæœ€å¤§å †å†…å­˜è®¾ç½®ä¸º200Mï¼Œæ— æ³•å®¹çº³2ä¸ª100Mçš„ç”Ÿæˆï¼Œæ‰€ä»¥å½“ç¬¬2ä¸ª100Mç”Ÿæˆæ—¶å†…å­˜ç©ºé—´ä¸è¶³ï¼Œä¼šæŠŠè½¯å¼•ç”¨é‡Šæ”¾æ‰ï¼Œæ‰€ä»¥ç¬¬2æ¬¡è¾“å‡ºè½¯å¼•ç”¨çš„å†…å®¹æ˜¯nullã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1325.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1324.png" alt="img"></p><p>è½¯å¼•ç”¨ä¸­çš„å¯¹è±¡å¦‚æœåœ¨å†…å­˜ä¸è¶³æ—¶å›æ”¶ï¼ŒSoftRefereceå¯¹è±¡æœ¬èº«ä¹Ÿéœ€è¦è¢«å›æ”¶ã€‚å¦‚ä½•çŸ¥é“å“ªäº›SoftReferenceå¯¹è±¡éœ€è¦å›æ”¶å‘¢ï¼Ÿï¼ˆ<strong>è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰å¯¹è±¡æ˜¯å¦‚ä½•è¢« GC å›æ”¶çš„ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨å¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰ç›‘æ§å’Œæ¸…ç†çš„å®Œæ•´è¿‡ç¨‹</strong>ï¼‰</p><p>SoftReferenceæä¾›äº†ä¸€å¥—é˜Ÿåˆ—æœºåˆ¶ï¼š<br>1.è½¯å¼•ç”¨åˆ›å»ºæ—¶ï¼Œé€šè¿‡æ„é€ å™¨ä¼ å…¥å¼•ç”¨é˜Ÿåˆ—ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1326-1024x356.png" alt="img"></p><p>2.åœ¨è½¯å¼•ç”¨ä¸­åŒ…å«çš„å¯¹è±¡è¢«å›æ”¶æ—¶ï¼Œè¯¥è½¯å¼•ç”¨å¯¹è±¡ä¼šè¢«æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1327-1024x325.png" alt="img"></p><p>3.é€šè¿‡ä»£ç éå†å¼•ç”¨é˜Ÿåˆ—ï¼Œå°†SoftReferenceçš„å¼ºå¼•ç”¨åˆ é™¤ã€‚</p><p>è¿™ä¸ªé˜Ÿåˆ—è®°å½•äº†å†…å®¹ä¸ºç©ºçš„SoftReferenceï¼Œå¯ä»¥ä¾¿åˆ©é˜Ÿåˆ—æ¥é‡Šæ”¾ç©ºçš„SoftReference</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** * è½¯å¼•ç”¨æ¡ˆä¾‹3 - å¼•ç”¨é˜Ÿåˆ—ä½¿ç”¨ */</span>publicclassSoftReferenceDemo3 &#123;</span><br><span class="line"></span><br><span class="line">    publicstaticvoidmain(String[] <span class="keyword">args</span>) throwsIOException &#123;</span><br><span class="line"></span><br><span class="line">        ArrayList&lt;SoftReference&gt; softReferences = newArrayList&lt;&gt;();</span><br><span class="line">        ReferenceQueue&lt;<span class="built_in">byte</span>[]&gt; queues = newReferenceQueue&lt;<span class="built_in">byte</span>[]&gt;();</span><br><span class="line">        <span class="keyword">for</span>(inti = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="built_in">byte</span>[] bytes = newbyte[<span class="number">1024</span> * <span class="number">1024</span> * <span class="number">100</span>];</span><br><span class="line">            SoftReference studentRef = newSoftReference&lt;<span class="built_in">byte</span>[]&gt;(bytes,queues);</span><br><span class="line">            softReferences.<span class="keyword">add</span>(studentRef);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        SoftReference&lt;<span class="built_in">byte</span>[]&gt; <span class="keyword">ref</span> = <span class="literal">null</span>;</span><br><span class="line">        intcount = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>((<span class="keyword">ref</span> = (SoftReference&lt;<span class="built_in">byte</span>[]&gt;) queues.poll()) != <span class="literal">null</span>) &#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        System.<span class="keyword">out</span>.println(count);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºè½¯å¼•ç”¨å¹¶ç»‘å®šå¼•ç”¨é˜Ÿåˆ—</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SoftReference&lt;<span class="built_in">byte</span>[]&gt; <span class="keyword">ref</span> = <span class="keyword">new</span> SoftReference&lt;&gt;(bytes, queues);</span><br></pre></td></tr></table></figure><ul><li>ä½ æŠŠ <code>byte[]</code> æ•°æ®åŒ…è£…æˆäº†ä¸€ä¸ªè½¯å¼•ç”¨ï¼›</li><li>åŒæ—¶ç»‘å®šäº†ä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ— <code>queues</code>ï¼Œè¡¨ç¤ºä¸€æ—¦è¿™ä¸ªæ•°æ®è¢«å›æ”¶äº†ï¼Œä½ å°±èƒ½é€šè¿‡é˜Ÿåˆ—çŸ¥é“ã€‚</li></ul><p>ç¬¬äºŒæ­¥ï¼šGC å›æ”¶è½¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡</p><p>ç”±äºä½ åœ¨ <code>for</code> å¾ªç¯ä¸­åˆ†é…äº†å¾ˆå¤šå¤§å†…å­˜ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">byte</span>[] bytes = new byte[<span class="number">1024</span> * <span class="number">1024</span> * <span class="number">100</span>]; // <span class="number">100</span>MB Ã— <span class="number">10</span>æ¬¡</span><br></pre></td></tr></table></figure><p>å½“ JVM å†…å­˜ä¸å¤Ÿæ—¶ï¼ŒGC å°±ä¼šè§¦å‘ï¼Œå¼€å§‹å°è¯•å›æ”¶è¿™äº› <code>byte[]</code> å¯¹è±¡â€”â€”å› ä¸ºå®ƒä»¬åªæ˜¯<strong>è½¯å¼•ç”¨</strong>ï¼ŒGC æ˜¯å¯ä»¥å›æ”¶å®ƒä»¬çš„ã€‚</p><p>ä¸€æ—¦ GC å›æ”¶äº†è¿™äº› byte[] å¯¹è±¡ï¼Œå¯¹åº”çš„ <code>SoftReference</code> å°±ä¼šè¢«åŠ å…¥ <code>queues</code> é˜Ÿåˆ—ï¼</p><p>ç¬¬ä¸‰æ­¥ï¼šç¨‹åºä»å¼•ç”¨é˜Ÿåˆ—ä¸­è½®è¯¢å‡ºå·²å¤±æ•ˆå¼•ç”¨</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> ((ref = (SoftReference&lt;<span class="keyword">byte</span>[]&gt;) queues.poll()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">count</span>++;</span><br><span class="line">&#125;</span><br><span class="line">System.out.<span class="keyword">println</span>(<span class="keyword">count</span>); <span class="comment">// æ‰“å°ï¼š9</span></span><br></pre></td></tr></table></figure><ul><li>éå†é˜Ÿåˆ—ï¼ŒæŠŠè¢«å›æ”¶é€šçŸ¥äº†çš„è½¯å¼•ç”¨æ‹¿å‡ºæ¥ï¼›</li><li>ä½ å¯ä»¥æ‰‹åŠ¨æŠŠå®ƒä»¬ä» <code>ArrayList</code> ä¸­åˆ æ‰ï¼Œé‡Šæ”¾ SoftReference æœ¬èº«ï¼ˆå¦åˆ™è½¯å¼•ç”¨å¯¹è±¡è¿˜ä¼šå å†…å­˜ï¼‰ï¼›</li><li>æœ€ç»ˆæ‰“å°å‡ºæœ‰å‡ ä¸ªå¯¹è±¡å·²ç»è¢« GC å›æ”¶å¹¶æ”¾å…¥é˜Ÿåˆ—ã€‚</li></ul><p>æœ€ç»ˆè¾“å‡ºæ˜¯ï¼š<code>9</code></p><p>è¡¨ç¤ºä½ åˆ›å»ºçš„ 10 ä¸ªè½¯å¼•ç”¨ä¸­ï¼Œæœ‰ 9 ä¸ªå…³è”çš„ <code>byte[]</code> è¢« GC å›æ”¶ï¼Œé€šçŸ¥å·²ç»è¿›å…¥é˜Ÿåˆ—ã€‚</p><p>æœ€ç»ˆå±•ç¤ºçš„ç»“æœæ˜¯ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1328.png" alt="img"></p><p>è¿™9ä¸ªè½¯å¼•ç”¨å¯¹è±¡ä¸­åŒ…å«çš„æ•°æ®å·²ç»è¢«å›æ”¶æ‰ï¼Œæ‰€ä»¥å¯ä»¥æ‰‹åŠ¨ä»ArrayListä¸­å»æ‰ï¼Œè¿™æ ·å°±å¯ä»¥é‡Šæ”¾è¿™9ä¸ªå¯¹è±¡ã€‚</p><p>ä¸€å¥è¯æ€»ç»“ï¼šè½¯å¼•ç”¨çš„å¯¹è±¡è¢« GC å›æ”¶åï¼ŒJVM ä¼šè‡ªåŠ¨æŠŠå¯¹åº”çš„ SoftReference æ”¾å…¥ä½ æä¾›çš„ ReferenceQueue ä¸­ï¼Œç¨‹åºå°±å¯ä»¥ä»è¿™ä¸ªé˜Ÿåˆ—ä¸­æ„ŸçŸ¥åˆ°è¯¥è½¯å¼•ç”¨å¤±æ•ˆï¼Œä»è€Œä¸»åŠ¨æ¸…é™¤å¼•ç”¨æœ¬èº«ï¼Œé‡Šæ”¾å†…å­˜ã€‚</p><h5 id="è½¯å¼•ç”¨çš„ç¼“å­˜æ¡ˆä¾‹">è½¯å¼•ç”¨çš„ç¼“å­˜æ¡ˆä¾‹</h5><p>ä½¿ç”¨è½¯å¼•ç”¨å®ç°å­¦ç”Ÿä¿¡æ¯çš„ç¼“å­˜ï¼Œèƒ½æ”¯æŒå†…å­˜ä¸è¶³æ—¶æ¸…ç†ç¼“å­˜ã€‚</p><p>è®¾è®¡ä¸€ä¸ª <code>StudentCache</code> ç¼“å­˜ç±»ï¼Œç”¨è½¯å¼•ç”¨ä¿å­˜å¤§é‡ <code>Student</code> å¯¹è±¡çš„ç¼“å­˜ã€‚å½“å†…å­˜ä¸è¶³æ—¶ï¼ŒJVM å¯ä»¥è‡ªåŠ¨é‡Šæ”¾ç¼“å­˜ä¸­ä¸ç”¨çš„å¯¹è±¡ï¼Œé¿å…å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1330.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1329-1024x435.png" alt="img"></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">packagechapter04.soft;</span><br><span class="line"></span><br><span class="line">importjava.lang.<span class="keyword">ref</span>.ReferenceQueue;</span><br><span class="line">importjava.lang.<span class="keyword">ref</span>.SoftReference;</span><br><span class="line">importjava.util.HashMap;</span><br><span class="line">importjava.util.Map;</span><br><span class="line"><span class="comment">/** * è½¯å¼•ç”¨æ¡ˆä¾‹4 - å­¦ç”Ÿä¿¡æ¯çš„ç¼“å­˜ */</span><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">StudentCache</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> StudentCache cache= <span class="keyword">new</span> StudentCache();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] <span class="keyword">args</span></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">0</span>; ; i++) &#123;</span><br><span class="line">            StudentCache.getInstance().cacheStudent(<span class="keyword">new</span> Student(i, String.valueOf(i)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;Integer, StudentRef&gt; StudentRefs;<span class="comment">// ç”¨äºCacheå†…å®¹çš„å­˜å‚¨</span></span><br><span class="line">   <span class="keyword">private</span> ReferenceQueue&lt;Student&gt; q;<span class="comment">// åƒåœ¾Referenceçš„é˜Ÿåˆ—</span></span><br><span class="line">   <span class="comment">// ç»§æ‰¿SoftReferenceï¼Œä½¿å¾—æ¯ä¸€ä¸ªå®ä¾‹éƒ½å…·æœ‰å¯è¯†åˆ«çš„æ ‡è¯†ã€‚</span></span><br><span class="line">  <span class="comment">// å¹¶ä¸”è¯¥æ ‡è¯†ä¸å…¶åœ¨HashMapå†…çš„keyç›¸åŒã€‚</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title">StudentRef</span> <span class="title">extends</span> <span class="title">SoftReference</span>&lt;<span class="title">Student</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">private</span> Integer _key= <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">StudentRef</span>(<span class="params">Student em, ReferenceQueue&lt;Student&gt; q</span>)</span> &#123;</span><br><span class="line">            super(em, q);</span><br><span class="line">            _key = em.getId();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„å»ºä¸€ä¸ªç¼“å­˜å™¨å®ä¾‹</span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">StudentCache</span>()</span> &#123;</span><br><span class="line">        StudentRefs = newHashMap&lt;Integer, StudentRef&gt;();</span><br><span class="line">        q = newReferenceQueue&lt;Student&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å–å¾—ç¼“å­˜å™¨å®ä¾‹</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> StudentCache <span class="title">getInstance</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cache;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»¥è½¯å¼•ç”¨çš„æ–¹å¼å¯¹ä¸€ä¸ªStudentå¯¹è±¡çš„å®ä¾‹è¿›è¡Œå¼•ç”¨å¹¶ä¿å­˜è¯¥å¼•ç”¨  </span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">cacheStudent</span>(<span class="params">Student em</span>)</span> &#123;</span><br><span class="line">        cleanCache();<span class="comment">// æ¸…é™¤åƒåœ¾å¼•ç”¨</span></span><br><span class="line">       StudentRef <span class="keyword">ref</span> = <span class="keyword">new</span> StudentRef(em, q);</span><br><span class="line">        StudentRefs.put(em.getId(), <span class="keyword">ref</span>);</span><br><span class="line">        System.<span class="keyword">out</span>.println(StudentRefs.size());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¾æ®æ‰€æŒ‡å®šçš„IDå·ï¼Œé‡æ–°è·å–ç›¸åº”Studentå¯¹è±¡çš„å®ä¾‹</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> Student <span class="title">getStudent</span>(<span class="params">Integer id</span>)</span> &#123;</span><br><span class="line">        Student em = <span class="literal">null</span>;</span><br><span class="line"><span class="comment">// ç¼“å­˜ä¸­æ˜¯å¦æœ‰è¯¥Studentå®ä¾‹çš„è½¯å¼•ç”¨ï¼Œå¦‚æœæœ‰ï¼Œä»è½¯å¼•ç”¨ä¸­å–å¾—ã€‚if(StudentRefs.containsKey(id)) &#123;</span></span><br><span class="line">            StudentRef <span class="keyword">ref</span> = StudentRefs.<span class="keyword">get</span>(id);</span><br><span class="line">            em = <span class="keyword">ref</span>.<span class="keyword">get</span>();</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">// å¦‚æœæ²¡æœ‰è½¯å¼•ç”¨ï¼Œæˆ–è€…ä»è½¯å¼•ç”¨ä¸­å¾—åˆ°çš„å®ä¾‹æ˜¯nullï¼Œé‡æ–°æ„å»ºä¸€ä¸ªå®ä¾‹ï¼Œ</span></span><br><span class="line"><span class="comment">// å¹¶ä¿å­˜å¯¹è¿™ä¸ªæ–°å»ºå®ä¾‹çš„è½¯å¼•ç”¨</span></span><br><span class="line">           <span class="keyword">if</span>(em == <span class="literal">null</span>) &#123;</span><br><span class="line">            em = newStudent(id, String.valueOf(id));</span><br><span class="line">            System.<span class="keyword">out</span>.println(<span class="string">&quot;Retrieve From StudentInfoCenter. ID=&quot;</span>+ id);</span><br><span class="line">            <span class="keyword">this</span>.cacheStudent(em);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> em;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¸…é™¤é‚£äº›æ‰€è½¯å¼•ç”¨çš„Studentå¯¹è±¡å·²ç»è¢«å›æ”¶çš„StudentRefå¯¹è±¡</span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">cleanCache</span>()</span> &#123;</span><br><span class="line">        StudentRef <span class="keyword">ref</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">while</span>((<span class="keyword">ref</span> = (StudentRef) q.poll()) != <span class="literal">null</span>) &#123;</span><br><span class="line">            StudentRefs.<span class="keyword">remove</span>(<span class="keyword">ref</span>._key);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    // æ¸…é™¤Cacheå†…çš„å…¨éƒ¨å†…å®¹</span></span><br><span class="line"><span class="comment">//    public void clearCache() &#123;</span></span><br><span class="line"><span class="comment">//        cleanCache();</span></span><br><span class="line"><span class="comment">//        StudentRefs.clear();</span></span><br><span class="line"><span class="comment">//        //System.gc();</span></span><br><span class="line"><span class="comment">//        //System.runFinalization();</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Student</span> &#123;</span><br><span class="line">    <span class="built_in">int</span> id;</span><br><span class="line">    String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span>(<span class="params"><span class="built_in">int</span> id, String name</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">getId</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">publicvoid <span class="title">setId</span>(<span class="params">intid</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span>(<span class="params">String name</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1331.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1332.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1333.png" alt="img"></p><p>ä¸€å¥è¯æ€»ç»“æ ¸å¿ƒæœºåˆ¶ï¼š</p><blockquote><p>åˆ©ç”¨ <code>SoftReference</code> + <code>ReferenceQueue</code> + <code>HashMap</code> ç»„åˆï¼Œå®ç°äº†ä¸€ä¸ªè‡ªåŠ¨å¯å›æ”¶çš„ç¼“å­˜ç³»ç»Ÿï¼Œæ”¯æŒåœ¨å†…å­˜ç´§å¼ æ—¶é‡Šæ”¾ä¸å¸¸ç”¨å¯¹è±¡ï¼Œä¸”å¯æ„ŸçŸ¥å¯¹è±¡è¢«å›æ”¶å¹¶åšæ¸…ç†ã€‚</p></blockquote><h4 id="4-3-2å¼±å¼•ç”¨ï¼ˆäº†è§£ï¼‰">4.3.2å¼±å¼•ç”¨ï¼ˆäº†è§£ï¼‰</h4><p>å¼±å¼•ç”¨çš„æ•´ä½“æœºåˆ¶å’Œè½¯å¼•ç”¨åŸºæœ¬ä¸€è‡´ï¼Œ<strong>åŒºåˆ«åœ¨äºå¼±å¼•ç”¨åŒ…å«çš„å¯¹è±¡åœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œä¸ç®¡å†…å­˜å¤Ÿä¸å¤Ÿéƒ½ä¼šç›´æ¥è¢«å›æ”¶</strong>ã€‚åœ¨JDK 1.2ç‰ˆä¹‹åæä¾›äº†WeakReferenceç±»æ¥å®ç°å¼±å¼•ç”¨ï¼Œ<strong>å¼±å¼•ç”¨ä¸»è¦åœ¨ThreadLocalä¸­ä½¿ç”¨</strong>ã€‚</p><p>å¼±å¼•ç”¨å¯¹è±¡æœ¬èº«ä¹Ÿå¯ä»¥ä½¿ç”¨å¼•ç”¨é˜Ÿåˆ—è¿›è¡Œå›æ”¶ã€‚</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">packagechapter04.weak;</span><br><span class="line"></span><br><span class="line">importjava.io.IOException;</span><br><span class="line">importjava.lang.<span class="keyword">ref</span>.WeakReference;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** * å¼±å¼•ç”¨æ¡ˆä¾‹ - åŸºæœ¬ä½¿ç”¨ */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">WeakReferenceDemo2</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] <span class="keyword">args</span></span>) throwsIOException</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">byte</span>[] bytes = newbyte[<span class="number">1024</span> * <span class="number">1024</span> * <span class="number">100</span>];</span><br><span class="line">        WeakReference&lt;<span class="built_in">byte</span>[]&gt; weakReference = newWeakReference&lt;<span class="built_in">byte</span>[]&gt;(bytes);</span><br><span class="line">        bytes = <span class="literal">null</span>;</span><br><span class="line">        System.<span class="keyword">out</span>.println(weakReference.<span class="keyword">get</span>());</span><br><span class="line"></span><br><span class="line">        System.gc();</span><br><span class="line"></span><br><span class="line">        System.<span class="keyword">out</span>.println(weakReference.<span class="keyword">get</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¹‹åå‘ç°gcæ‰§è¡Œä¹‹åï¼Œå¯¹è±¡å·²ç»è¢«å›æ”¶äº†ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1334.png" alt="img"></p><h4 id="4-3-3è™šå¼•ç”¨å’Œç»ˆç»“å™¨å¼•ç”¨ï¼ˆäº†è§£ï¼‰">4.3.3è™šå¼•ç”¨å’Œç»ˆç»“å™¨å¼•ç”¨ï¼ˆäº†è§£ï¼‰</h4><p>è¿™ä¸¤ç§å¼•ç”¨åœ¨å¸¸è§„å¼€å‘ä¸­<strong>æ˜¯ä¸ä¼šä½¿ç”¨çš„ã€‚</strong></p><ul><li><p>è™šå¼•ç”¨ä¹Ÿå«å¹½çµå¼•ç”¨/å¹»å½±å¼•ç”¨ï¼Œä¸èƒ½é€šè¿‡è™šå¼•ç”¨å¯¹è±¡è·å–åˆ°åŒ…å«çš„å¯¹è±¡ã€‚<strong>è™šå¼•ç”¨å”¯ä¸€çš„ç”¨é€”æ˜¯å½“å¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶æ—¶å¯ä»¥æ¥æ”¶åˆ°å¯¹åº”çš„é€šçŸ¥</strong>ã€‚Javaä¸­ä½¿ç”¨PhantomReferenceå®ç°äº†è™šå¼•ç”¨ï¼Œç›´æ¥å†…å­˜ä¸­ä¸ºäº†åŠæ—¶çŸ¥é“ç›´æ¥å†…å­˜å¯¹è±¡ä¸å†ä½¿ç”¨ï¼Œä»è€Œå›æ”¶å†…å­˜ï¼Œä½¿ç”¨äº†è™šå¼•ç”¨æ¥å®ç°ã€‚</p></li><li><p>ç»ˆç»“å™¨å¼•ç”¨æŒ‡çš„æ˜¯åœ¨å¯¹è±¡éœ€è¦è¢«å›æ”¶æ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨ä¼šå…³è”å¯¹è±¡å¹¶æ”¾ç½®åœ¨Finalizerç±»ä¸­çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œåœ¨ç¨åç”±ä¸€æ¡ç”±FinalizerThreadçº¿ç¨‹ä»é˜Ÿåˆ—ä¸­è·å–å¯¹è±¡ï¼Œç„¶åæ‰§è¡Œå¯¹è±¡çš„finalizeæ–¹æ³•ï¼Œ<strong>åœ¨å¯¹è±¡ç¬¬äºŒæ¬¡è¢«å›æ”¶æ—¶ï¼Œè¯¥å¯¹è±¡æ‰çœŸæ­£çš„è¢«å›æ”¶</strong>ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¯ä»¥åœ¨finalizeæ–¹æ³•ä¸­å†å°†è‡ªèº«å¯¹è±¡ä½¿ç”¨å¼ºå¼•ç”¨å…³è”ä¸Šï¼Œä½†æ˜¯ä¸å»ºè®®è¿™æ ·åšã€‚</p></li></ul><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">packagechapter04.finalreference;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** * ç»ˆç»“å™¨å¼•ç”¨æ¡ˆä¾‹ */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FinalizeReferenceDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> FinalizeReferenceDemo reference = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">alive</span>()</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;å½“å‰å¯¹è±¡è¿˜å­˜æ´»&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">finalize</span>() throws Throwable</span> &#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            System.<span class="keyword">out</span>.println(<span class="string">&quot;finalize()æ‰§è¡Œäº†...&quot;</span>);</span><br><span class="line">            <span class="comment">//è®¾ç½®å¼ºå¼•ç”¨è‡ªæ•‘reference = this;</span></span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            super.finalize();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    publicstaticvoidmain(String[] <span class="keyword">args</span>) throws Throwable &#123;</span><br><span class="line">        reference = <span class="keyword">new</span> FinalizeReferenceDemo();</span><br><span class="line">       test();</span><br><span class="line">       test();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    privatestaticvoidtest() throws InterruptedException &#123;</span><br><span class="line">        reference = <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//å›æ”¶å¯¹è±¡System.gc();</span></span><br><span class="line">        <span class="comment">//æ‰§è¡Œfinalizeæ–¹æ³•çš„ä¼˜å…ˆçº§æ¯”è¾ƒä½ï¼Œä¼‘çœ 500msç­‰å¾…ä¸€ä¸‹Thread.sleep(500);</span></span><br><span class="line">        <span class="keyword">if</span>(reference != <span class="literal">null</span>) &#123;</span><br><span class="line">            reference.alive();</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            System.<span class="keyword">out</span>.println(<span class="string">&quot;å¯¹è±¡å·²è¢«å›æ”¶&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1335.png" alt="img"></p><h3 id="4-4-åƒåœ¾å›æ”¶ç®—æ³•">4.4 åƒåœ¾å›æ”¶ç®—æ³•</h3><p>Javaæ˜¯å¦‚ä½•å®ç°åƒåœ¾å›æ”¶çš„å‘¢ï¼Ÿç®€å•æ¥è¯´ï¼Œåƒåœ¾å›æ”¶è¦åšçš„æœ‰ä¸¤ä»¶äº‹ï¼š</p><ul><li>1ã€æ‰¾åˆ°å†…å­˜ä¸­å­˜æ´»çš„å¯¹è±¡</li><li>2ã€é‡Šæ”¾ä¸å†å­˜æ´»å¯¹è±¡çš„å†…å­˜ï¼Œä½¿å¾—ç¨‹åºèƒ½å†æ¬¡åˆ©ç”¨è¿™éƒ¨åˆ†ç©ºé—´</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1353-1024x235.png" alt="img"></p><h4 id="4-4-1åƒåœ¾å›æ”¶ç®—æ³•çš„è¯„ä»·æ ‡å‡†">4.4.1åƒåœ¾å›æ”¶ç®—æ³•çš„è¯„ä»·æ ‡å‡†</h4><p>Javaåƒåœ¾å›æ”¶è¿‡ç¨‹ä¼šé€šè¿‡å•ç‹¬çš„GCçº¿ç¨‹æ¥å®Œæˆï¼Œä½†æ˜¯ä¸ç®¡ä½¿ç”¨å“ªä¸€ç§GCç®—æ³•ï¼Œéƒ½ä¼šæœ‰éƒ¨åˆ†é˜¶æ®µéœ€è¦åœæ­¢æ‰€æœ‰çš„ç”¨æˆ·çº¿ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¹‹ä¸ºStop The Worldç®€ç§°STWï¼Œå¦‚æœSTWæ—¶é—´è¿‡é•¿åˆ™ä¼šå½±å“ç”¨æˆ·çš„ä½¿ç”¨ã€‚</p><p>å¦‚ä¸‹å›¾ï¼Œç”¨æˆ·ä»£ç æ‰§è¡Œå’Œåƒåœ¾å›æ”¶æ‰§è¡Œè®©ç”¨æˆ·çº¿ç¨‹åœæ­¢æ‰§è¡Œï¼ˆSTWï¼‰æ˜¯äº¤æ›¿æ‰§è¡Œçš„ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1336-1024x182.png" alt="img"></p><p>æ‰€ä»¥åˆ¤æ–­GCç®—æ³•æ˜¯å¦ä¼˜ç§€ï¼Œå¯ä»¥ä»ä¸‰ä¸ªæ–¹é¢æ¥è€ƒè™‘ï¼š</p><p>1.ååé‡</p><p>ååé‡æŒ‡çš„æ˜¯ CPU ç”¨äºæ‰§è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ä¸ CPU æ€»æ‰§è¡Œæ—¶é—´çš„æ¯”å€¼ï¼Œå³ååé‡ = æ‰§è¡Œç”¨æˆ·ä»£ç æ—¶é—´ /ï¼ˆæ‰§è¡Œç”¨æˆ·ä»£ç æ—¶é—´ + GCæ—¶é—´ï¼‰ã€‚ååé‡æ•°å€¼è¶Šé«˜ï¼Œåƒåœ¾å›æ”¶çš„æ•ˆç‡å°±è¶Šé«˜ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1337-1024x237.png" alt="img"></p><p>2.æœ€å¤§æš‚åœæ—¶é—´</p><p>æœ€å¤§æš‚åœæ—¶é—´æŒ‡çš„æ˜¯æ‰€æœ‰åœ¨åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­çš„STWæ—¶é—´æœ€å¤§å€¼ã€‚æ¯”å¦‚å¦‚ä¸‹çš„å›¾ä¸­ï¼Œé»„è‰²éƒ¨åˆ†çš„STWå°±æ˜¯æœ€å¤§æš‚åœæ—¶é—´ï¼Œæ˜¾è€Œæ˜“è§ä¸Šé¢çš„å›¾æ¯”ä¸‹é¢çš„å›¾æ‹¥æœ‰æ›´å°‘çš„æœ€å¤§æš‚åœæ—¶é—´ã€‚æœ€å¤§æš‚åœæ—¶é—´è¶ŠçŸ­ï¼Œç”¨æˆ·ä½¿ç”¨ç³»ç»Ÿæ—¶å—åˆ°çš„å½±å“å°±è¶ŠçŸ­ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1338-1024x311.png" alt="img"></p><p>3.å †ä½¿ç”¨æ•ˆç‡</p><p>ä¸åŒåƒåœ¾å›æ”¶ç®—æ³•ï¼Œå¯¹å †å†…å­˜çš„ä½¿ç”¨æ–¹å¼æ˜¯ä¸åŒçš„ã€‚æ¯”å¦‚æ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œå¯ä»¥ä½¿ç”¨å®Œæ•´çš„å †å†…å­˜ã€‚è€Œå¤åˆ¶ç®—æ³•ä¼šå°†å †å†…å­˜ä¸€åˆ†ä¸ºäºŒï¼Œæ¯æ¬¡åªèƒ½ä½¿ç”¨ä¸€åŠå†…å­˜ã€‚ä»å †ä½¿ç”¨æ•ˆç‡ä¸Šæ¥è¯´ï¼Œæ ‡è®°æ¸…é™¤ç®—æ³•è¦ä¼˜äºå¤åˆ¶ç®—æ³•ã€‚</p><p>ä¸Šè¿°ä¸‰ç§è¯„ä»·æ ‡å‡†ï¼šå †ä½¿ç”¨æ•ˆç‡ã€ååé‡ï¼Œä»¥åŠæœ€å¤§æš‚åœæ—¶é—´ä¸å¯å…¼å¾—ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œå †å†…å­˜è¶Šå¤§ï¼Œæœ€å¤§æš‚åœæ—¶é—´å°±è¶Šé•¿ã€‚æƒ³è¦å‡å°‘æœ€å¤§æš‚åœæ—¶é—´ï¼Œå°±ä¼šé™ä½ååé‡ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1339.png" alt="img"></p><p>æ²¡æœ‰ä¸€ä¸ªåƒåœ¾å›æ”¶ç®—æ³•èƒ½å…¼é¡¾ä¸Šè¿°ä¸‰ç‚¹è¯„ä»·æ ‡å‡†ï¼Œæ‰€ä»¥ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³•å®ƒçš„ä¾§é‡ç‚¹æ˜¯ä¸åŒçš„ï¼Œé€‚ç”¨äºä¸åŒçš„åº”ç”¨åœºæ™¯ã€‚</p><h4 id="4-4-2æ ‡è®°æ¸…é™¤ç®—æ³•">4.4.2æ ‡è®°æ¸…é™¤ç®—æ³•</h4><p>æ ‡è®°æ¸…é™¤ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p><p>1.æ ‡è®°é˜¶æ®µï¼Œå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡è¿›è¡Œæ ‡è®°ã€‚Javaä¸­ä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•ï¼Œä»GC Rootå¼€å§‹é€šè¿‡å¼•ç”¨é“¾éå†å‡ºæ‰€æœ‰å­˜æ´»å¯¹è±¡ã€‚</p><p>2.æ¸…é™¤é˜¶æ®µï¼Œä»å†…å­˜ä¸­åˆ é™¤æ²¡æœ‰è¢«æ ‡è®°ä¹Ÿå°±æ˜¯éå­˜æ´»å¯¹è±¡ã€‚</p><p>ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œä»GC Rootå¯¹è±¡å¼€å§‹æ‰«æï¼Œå°†å¯¹è±¡Aã€Bã€Cåœ¨å¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡æ ‡è®°å‡ºæ¥ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1340-1024x375.png" alt="img"></p><p>ç¬¬äºŒä¸ªé˜¶æ®µï¼Œå°†æ²¡æœ‰æ ‡è®°çš„å¯¹è±¡æ¸…ç†æ‰ï¼Œæ‰€ä»¥å¯¹è±¡Då°±è¢«æ¸…ç†æ‰äº†ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1341-1024x372.png" alt="img"></p><p>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œåªéœ€è¦åœ¨ç¬¬ä¸€é˜¶æ®µç»™æ¯ä¸ªå¯¹è±¡ç»´æŠ¤æ ‡å¿—ä½ï¼Œç¬¬äºŒé˜¶æ®µåˆ é™¤å¯¹è±¡å³å¯ã€‚</p><p>ç¼ºç‚¹ï¼š1.ç¢ç‰‡åŒ–é—®é¢˜</p><p>ç”±äºå†…å­˜æ˜¯è¿ç»­çš„ï¼Œæ‰€ä»¥åœ¨å¯¹è±¡è¢«åˆ é™¤ä¹‹åï¼Œå†…å­˜ä¸­ä¼šå‡ºç°å¾ˆå¤šç»†å°çš„å¯ç”¨å†…å­˜å•å…ƒã€‚å¦‚æœæˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§çš„ç©ºé—´ï¼Œå¾ˆæœ‰å¯èƒ½è¿™äº›å†…å­˜å•å…ƒçš„å¤§å°è¿‡å°æ— æ³•è¿›è¡Œåˆ†é…ã€‚</p><p>å¦‚ä¸‹å›¾ï¼Œçº¢è‰²éƒ¨åˆ†å·²ç»è¢«æ¸…ç†æ‰äº†ï¼Œæ€»å…±å›æ”¶äº†9ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯æ¯ä¸ªéƒ½æ˜¯ä¸€ä¸ªå°ç¢ç‰‡ï¼Œæ— æ³•ä¸º5ä¸ªå­—èŠ‚çš„å¯¹è±¡åˆ†é…ç©ºé—´ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1342-1024x351.png" alt="img"></p><p>ç¼ºç‚¹2.åˆ†é…é€Ÿåº¦æ…¢ã€‚ç”±äºå†…å­˜ç¢ç‰‡çš„å­˜åœ¨ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²é“¾è¡¨ï¼Œææœ‰å¯èƒ½å‘ç”Ÿæ¯æ¬¡éœ€è¦éå†åˆ°é“¾è¡¨çš„æœ€åæ‰èƒ½è·å¾—åˆé€‚çš„å†…å­˜ç©ºé—´ã€‚ æˆ‘ä»¬éœ€è¦ç”¨ä¸€ä¸ªé“¾è¡¨æ¥ç»´æŠ¤ï¼Œå“ªäº›ç©ºé—´å¯ä»¥åˆ†é…å¯¹è±¡ï¼Œå¾ˆæœ‰å¯èƒ½éœ€è¦éå†è¿™ä¸ªé“¾è¡¨åˆ°æœ€åï¼Œæ‰èƒ½å‘ç°è¿™å—ç©ºé—´è¶³å¤Ÿæˆ‘ä»¬å»åˆ›å»ºä¸€ä¸ªå¯¹è±¡ã€‚å¦‚ä¸‹å›¾ï¼Œéå†åˆ°æœ€åæ‰å‘ç°æœ‰è¶³å¤Ÿçš„ç©ºé—´åˆ†é…3ä¸ªå­—èŠ‚çš„å¯¹è±¡äº†ã€‚å¦‚æœé“¾è¡¨å¾ˆé•¿ï¼Œéå†ä¹Ÿä¼šèŠ±è´¹è¾ƒé•¿çš„æ—¶é—´ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1343-1024x290.png" alt="img"></p><h4 id="4-4-3å¤åˆ¶ç®—æ³•">4.4.3å¤åˆ¶ç®—æ³•</h4><p>å¤åˆ¶ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š</p><p>1.å‡†å¤‡ä¸¤å—ç©ºé—´Fromç©ºé—´å’ŒToç©ºé—´ï¼Œæ¯æ¬¡åœ¨å¯¹è±¡åˆ†é…é˜¶æ®µï¼Œåªèƒ½ä½¿ç”¨å…¶ä¸­ä¸€å—ç©ºé—´ï¼ˆFromç©ºé—´ï¼‰ã€‚</p><p>å¯¹è±¡Aé¦–å…ˆåˆ†é…åœ¨Fromç©ºé—´ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1344-1024x300.png" alt="img"></p><p>2.åœ¨åƒåœ¾å›æ”¶GCé˜¶æ®µï¼Œå°†Fromä¸­å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°Toç©ºé—´ã€‚</p><p>åœ¨åƒåœ¾å›æ”¶é˜¶æ®µï¼Œå¦‚æœå¯¹è±¡Aå­˜æ´»ï¼Œå°±å°†å…¶å¤åˆ¶åˆ°Toç©ºé—´ã€‚ç„¶åå°†Fromç©ºé—´ç›´æ¥æ¸…ç©ºã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1345-1024x312.png" alt="img"></p><p>3.å°†ä¸¤å—ç©ºé—´çš„Fromå’ŒToåå­—äº’æ¢ã€‚</p><p>æ¥ä¸‹æ¥å°†ä¸¤å—ç©ºé—´çš„åç§°äº’æ¢ï¼Œä¸‹æ¬¡ä¾ç„¶åœ¨Fromç©ºé—´ä¸Šåˆ›å»ºå¯¹è±¡ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1346-1024x306.png" alt="img"></p><p>å®Œæ•´çš„å¤åˆ¶ç®—æ³•çš„ä¾‹å­ï¼š</p><p>1.å°†å †å†…å­˜åˆ†å‰²æˆä¸¤å—Fromç©ºé—´ Toç©ºé—´ï¼Œå¯¹è±¡åˆ†é…é˜¶æ®µï¼Œåˆ›å»ºå¯¹è±¡ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1347-1024x296.png" alt="img"></p><p>2.GCé˜¶æ®µå¼€å§‹ï¼Œå°†GC Rootæ¬è¿åˆ°Toç©ºé—´</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1348-1024x304.png" alt="img"></p><p>3.å°†GC Rootå…³è”çš„å¯¹è±¡ï¼Œæ¬è¿åˆ°Toç©ºé—´</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1349-1024x307.png" alt="img"></p><p>4.æ¸…ç†Fromç©ºé—´ï¼Œå¹¶æŠŠåç§°äº’æ¢</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1350-1024x296.png" alt="img"></p><p>ä¼˜ç‚¹ï¼š</p><ul><li>ååé‡é«˜ï¼Œå¤åˆ¶ç®—æ³•åªéœ€è¦éå†ä¸€æ¬¡å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°Toç©ºé—´å³å¯ï¼Œæ¯”æ ‡è®°-æ•´ç†ç®—æ³•å°‘äº†ä¸€æ¬¡éå†çš„è¿‡ç¨‹ï¼Œå› è€Œæ€§èƒ½è¾ƒå¥½ï¼Œä½†æ˜¯ä¸å¦‚æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œå› ä¸ºæ ‡è®°æ¸…é™¤ç®—æ³•ä¸éœ€è¦è¿›è¡Œå¯¹è±¡çš„ç§»åŠ¨</li><li>ä¸ä¼šå‘ç”Ÿç¢ç‰‡åŒ–ï¼Œå¤åˆ¶ç®—æ³•åœ¨å¤åˆ¶ä¹‹åå°±ä¼šå°†å¯¹è±¡æŒ‰é¡ºåºæ”¾å…¥Toç©ºé—´ä¸­ï¼Œæ‰€ä»¥å¯¹è±¡ä»¥å¤–çš„åŒºåŸŸéƒ½æ˜¯å¯ç”¨ç©ºé—´ï¼Œä¸å­˜åœ¨ç¢ç‰‡åŒ–å†…å­˜ç©ºé—´ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><p>å†…å­˜ä½¿ç”¨æ•ˆç‡ä½ï¼Œæ¯æ¬¡åªèƒ½è®©ä¸€åŠçš„å†…å­˜ç©ºé—´æ¥ä¸ºåˆ›å»ºå¯¹è±¡ä½¿ç”¨ã€‚</p><h4 id="4-4-4æ ‡è®°æ•´ç†ç®—æ³•">4.4.4æ ‡è®°æ•´ç†ç®—æ³•</h4><p>æ ‡è®°æ•´ç†ç®—æ³•ä¹Ÿå«æ ‡è®°å‹ç¼©ç®—æ³•ï¼Œæ˜¯å¯¹æ ‡è®°æ¸…ç†ç®—æ³•ä¸­å®¹æ˜“äº§ç”Ÿå†…å­˜ç¢ç‰‡é—®é¢˜çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚</p><p>æ ¸å¿ƒæ€æƒ³åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p><p>1.æ ‡è®°é˜¶æ®µï¼Œå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡è¿›è¡Œæ ‡è®°ã€‚Javaä¸­ä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•ï¼Œä»GC Rootå¼€å§‹é€šè¿‡å¼•ç”¨é“¾éå†å‡ºæ‰€æœ‰å­˜æ´»å¯¹è±¡ã€‚</p><p>2.æ•´ç†é˜¶æ®µï¼Œå°†å­˜æ´»å¯¹è±¡ç§»åŠ¨åˆ°å †çš„ä¸€ç«¯ã€‚æ˜¯æ¸…ç†éå­˜æ´»å¯¹è±¡çš„å†…å­˜ç©ºé—´</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1351-1024x238.png" alt="img"></p><p>ä¼˜ç‚¹ï¼š</p><ul><li>å†…å­˜ä½¿ç”¨æ•ˆç‡é«˜ï¼Œæ•´ä¸ªå †å†…å­˜éƒ½å¯ä»¥ä½¿ç”¨ï¼Œä¸ä¼šåƒå¤åˆ¶ç®—æ³•åªèƒ½ä½¿ç”¨åŠä¸ªå †å†…å­˜</li><li>ä¸ä¼šå‘ç”Ÿç¢ç‰‡åŒ–ï¼Œåœ¨æ•´ç†é˜¶æ®µå¯ä»¥å°†å¯¹è±¡å¾€å†…å­˜çš„ä¸€ä¾§è¿›è¡Œç§»åŠ¨ï¼Œå‰©ä¸‹çš„ç©ºé—´éƒ½æ˜¯å¯ä»¥åˆ†é…å¯¹è±¡çš„æœ‰æ•ˆç©ºé—´</li></ul><p>ç¼ºç‚¹ï¼š</p><p>æ•´ç†é˜¶æ®µçš„æ•ˆç‡ä¸é«˜ï¼Œæ•´ç†ç®—æ³•æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚Lisp2æ•´ç†ç®—æ³•éœ€è¦å¯¹æ•´ä¸ªå †ä¸­çš„å¯¹è±¡æœç´¢3æ¬¡ï¼Œæ•´ä½“æ€§èƒ½ä¸ä½³ã€‚å¯ä»¥é€šè¿‡Two-Fingerã€è¡¨æ ¼ç®—æ³•ã€ImmixGCç­‰é«˜æ•ˆçš„æ•´ç†ç®—æ³•ä¼˜åŒ–æ­¤é˜¶æ®µçš„æ€§èƒ½ã€‚</p><h4 id="4-4-5åˆ†ä»£åƒåœ¾å›æ”¶ç®—æ³•">4.4.5åˆ†ä»£åƒåœ¾å›æ”¶ç®—æ³•</h4><p>åˆ†ä»£åƒåœ¾å›æ”¶ç®—æ³•æ˜¯ç°ä»£ä¼˜ç§€çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œä¼šå°†ä¸Šè¿°æè¿°çš„åƒåœ¾å›æ”¶ç®—æ³•ç»„åˆè¿›è¡Œä½¿ç”¨ï¼Œå…¶ä¸­åº”ç”¨æœ€å¹¿çš„å°±æ˜¯åˆ†ä»£åƒåœ¾å›æ”¶ç®—æ³•ï¼ˆGenerational GCï¼‰ã€‚</p><p>åˆ†ä»£åƒåœ¾å›æ”¶å°†æ•´ä¸ªå†…å­˜åŒºåŸŸåˆ’åˆ†ä¸ºå¹´è½»ä»£å’Œè€å¹´ä»£ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1352-1024x366.png" alt="img"></p><p>åœ¨JDK8ä¸­ï¼Œæ·»åŠ -XX:+UseSerialGCå‚æ•°ä½¿ç”¨åˆ†ä»£å›æ”¶çš„åƒåœ¾å›æ”¶å™¨ï¼Œè¿è¡Œç¨‹åºã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1355-1024x638.png" alt="img"></p><p>å¯ä»¥é€šè¿‡memoryå‘½ä»¤æ¥æŸ¥çœ‹å†…å­˜</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1354-1024x228.png" alt="img"></p><p>Eden + survivor è¿™ä¸¤å—åŒºåŸŸç»„æˆäº†å¹´è½»ä»£ã€‚</p><p>tenured_genæŒ‡çš„æ˜¯æ™‹å‡åŒºåŸŸï¼Œå…¶å®å°±æ˜¯è€å¹´ä»£ã€‚</p><p>1ã€åˆ†ä»£å›æ”¶æ—¶ï¼Œåˆ›å»ºå‡ºæ¥çš„å¯¹è±¡ï¼Œé¦–å…ˆä¼šè¢«æ”¾å…¥Edenä¼Šç”¸å›­åŒºã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1356-1024x332.png" alt="img"></p><p>2ã€éšç€å¯¹è±¡åœ¨EdenåŒºè¶Šæ¥è¶Šå¤šï¼Œå¦‚æœEdenåŒºæ»¡ï¼Œæ–°åˆ›å»ºçš„å¯¹è±¡å·²ç»æ— æ³•æ”¾å…¥ï¼Œå°±ä¼šè§¦å‘<strong>å¹´è½»ä»£çš„GC</strong>ï¼Œç§°ä¸ºMinor GCæˆ–è€…Young GCã€‚</p><p><strong>Minor GCä¼šæŠŠéœ€è¦edenä¸­å’ŒFroméœ€è¦å›æ”¶çš„å¯¹è±¡å›æ”¶ï¼ŒæŠŠæ²¡æœ‰å›æ”¶çš„å¯¹è±¡æ”¾å…¥ToåŒºã€‚</strong></p><p>eden[é¦–æ¬¡]æ»¡æ—¶ï¼Œä¼šè§¦å‘åƒåœ¾å›æ”¶ï¼Œæ ¹æ®å¯è¾¾æ€§åˆ¤æ–­å­˜æ´»çš„å¯¹è±¡ï¼Œå°†å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°æŸä¸ªå¹¸å­˜åŒºï¼ˆå‡è®¾ä¸ºFromåŒºï¼‰ï¼ŒåŒæ—¶EdenåŒºæ¸…ç©ºã€‚å½“åç»­edenå†æ»¡æ—¶ï¼Œå°±ä¼šå°†edenå’ŒFromåŒºçš„å¯¹è±¡è¿›è¡Œå›æ”¶ç„¶åå°†å¹¸å­˜çš„å¯¹è±¡å¤åˆ¶åˆ°ToåŒºã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1357-1024x359.png" alt="img"></p><p>3ã€æ¥ä¸‹æ¥ï¼ŒS0ä¼šå˜æˆToåŒºï¼ŒS1å˜æˆFromåŒºã€‚å½“edenåŒºæ»¡æ—¶å†å¾€é‡Œæ”¾å…¥å¯¹è±¡ï¼Œä¾ç„¶ä¼šå‘ç”ŸMinor GCã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1358-1024x366.png" alt="img"></p><p>æ­¤æ—¶ä¼šå›æ”¶<strong>edenåŒºå’ŒS1(from)ä¸­çš„å¯¹è±¡</strong>ï¼Œå¹¶æŠŠedenå’ŒfromåŒºä¸­å‰©ä½™çš„å¯¹è±¡æ”¾å…¥S0ã€‚</p><p>æ³¨æ„ï¼šæ¯æ¬¡Minor GCä¸­éƒ½ä¼šä¸ºå¯¹è±¡è®°å½•ä»–çš„å¹´é¾„ï¼Œåˆå§‹å€¼ä¸º0ï¼Œæ¯æ¬¡GCå®ŒåŠ 1ã€‚</p><p>4ã€å¦‚æœMinor GCåå¯¹è±¡çš„å¹´é¾„è¾¾åˆ°é˜ˆå€¼ï¼ˆæœ€å¤§15ï¼Œé»˜è®¤å€¼å’Œåƒåœ¾å›æ”¶å™¨æœ‰å…³ï¼‰ï¼Œå¯¹è±¡å°±ä¼šè¢«æ™‹å‡è‡³è€å¹´ä»£ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1359-1024x360.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1360-1024x350.png" alt="img"></p><p>å½“æ•´ä¸ªæ–°ç”Ÿä»£çš„ç©ºé—´éƒ½è¢«ä½¿ç”¨æ—¶ï¼Œæ— æ³•æ”¾å…¥æ–°çš„å¯¹è±¡æ—¶ï¼Œå…ˆå°è¯•Minor GCï¼ŒæŠŠæœªè¾¾åˆ°å¹´é¾„é˜ˆå€¼ä½†æ˜¯æœ€è€çš„å¯¹è±¡æ”¾å…¥è€å¹´ä»£ï¼Œå¦‚æœè€å¹´ä»£ç©ºé—´ä¹Ÿè¢«å æ»¡äº†ï¼Œä¼šè§¦å‘Full GCï¼ˆå›æ”¶æ•´ä¸ªå †çš„æ‰€æœ‰å¯¹è±¡ï¼‰</p><p>ä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„åº”ç”¨å¯èƒ½ç§¯ç´¯äº†è®¸å¤šé•¿ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ï¼Œå¯¼è‡´è€å¹´ä»£é€æ¸å¡«æ»¡ï¼Œå³ä½¿æ–°ç”Ÿä»£å¹¶æœªå®Œå…¨å¡«æ»¡ï¼ŒJVMä¹Ÿå¯èƒ½è§¦å‘Full GCæ¥æ¸…ç†è€å¹´ä»£</p><p>å¦‚æœFull GCä¾ç„¶æ— æ³•å›æ”¶æ‰è€å¹´ä»£çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå½“å¯¹è±¡ç»§ç»­æ”¾å…¥è€å¹´ä»£æ—¶ï¼Œå°±ä¼šæŠ›å‡ºOut Of Memoryå¼‚å¸¸ã€‚</p><p>è‡³äºä¸ºä»€ä¹ˆä¸ä¼šè¢«å›æ”¶ï¼šå› ä¸ºè¿™é‡Œçš„å›æ”¶æ¡ä»¶ä¾ç„¶è¦æ»¡è¶³å¯è¾¾æ€§åˆ†æï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œæ˜¯ä¸èƒ½è¢«å›æ”¶çš„</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1361-1024x362.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1362-1024x294.png" alt="img"></p><h3 id="4-5-åƒåœ¾å›æ”¶å™¨">4.5 åƒåœ¾å›æ”¶å™¨</h3><h4 id="4-5-1ä¸ºä»€ä¹ˆåˆ†ä»£GCç®—æ³•è¦æŠŠå †åˆ†æˆå¹´è½»ä»£å’Œè€å¹´ä»£ï¼Ÿ">4.5.1ä¸ºä»€ä¹ˆåˆ†ä»£GCç®—æ³•è¦æŠŠå †åˆ†æˆå¹´è½»ä»£å’Œè€å¹´ä»£ï¼Ÿ</h4><p>é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“å †å†…å­˜ä¸­å¯¹è±¡çš„ç‰¹æ€§ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1363-1024x532.png" alt="img"></p><ul><li>ç³»ç»Ÿä¸­çš„å¤§éƒ¨åˆ†å¯¹è±¡ï¼Œéƒ½æ˜¯åˆ›å»ºå‡ºæ¥ä¹‹åå¾ˆå¿«å°±ä¸å†ä½¿ç”¨å¯ä»¥è¢«å›æ”¶ï¼Œæ¯”å¦‚ç”¨æˆ·è·å–è®¢å•æ•°æ®ï¼Œè®¢å•æ•°æ®è¿”å›ç»™ç”¨æˆ·ä¹‹åå°±å¯ä»¥é‡Šæ”¾äº†ã€‚</li><li>è€å¹´ä»£ä¸­ä¼šå­˜æ”¾é•¿æœŸå­˜æ´»çš„å¯¹è±¡ï¼Œæ¯”å¦‚Springçš„å¤§éƒ¨åˆ†beanå¯¹è±¡ï¼Œåœ¨ç¨‹åºå¯åŠ¨ä¹‹åå°±ä¸ä¼šè¢«å›æ”¶äº†ã€‚</li><li>åœ¨è™šæ‹Ÿæœºçš„é»˜è®¤è®¾ç½®ä¸­ï¼Œæ–°ç”Ÿä»£å¤§å°è¦è¿œå°äºè€å¹´ä»£çš„å¤§å°ã€‚</li></ul><p>åˆ†ä»£GCç®—æ³•å°†å †åˆ†æˆå¹´è½»ä»£å’Œè€å¹´ä»£ä¸»è¦åŸå› æœ‰ï¼š</p><ul><li>1ã€å¯ä»¥é€šè¿‡è°ƒæ•´å¹´è½»ä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹æ¥é€‚åº”ä¸åŒç±»å‹çš„åº”ç”¨ç¨‹åºï¼Œæé«˜å†…å­˜çš„åˆ©ç”¨ç‡å’Œæ€§èƒ½ã€‚</li><li>2ã€æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä½¿ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£ä¸€èˆ¬é€‰æ‹©å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£å¯ä»¥é€‰æ‹©æ ‡è®°-æ¸…é™¤å’Œæ ‡è®°-æ•´ç†ç®—æ³•ï¼Œç”±ç¨‹åºå‘˜æ¥é€‰æ‹©çµæ´»åº¦è¾ƒé«˜ã€‚</li><li>3ã€åˆ†ä»£çš„è®¾è®¡ä¸­å…è®¸åªå›æ”¶æ–°ç”Ÿä»£ï¼ˆminor gcï¼‰ï¼Œå¦‚æœèƒ½æ»¡è¶³å¯¹è±¡åˆ†é…çš„è¦æ±‚å°±ä¸éœ€è¦å¯¹æ•´ä¸ªå †è¿›è¡Œå›æ”¶(full gc),STWæ—¶é—´å°±ä¼šå‡å°‘ã€‚</li></ul><p>-----------------------------------------------------------------------------------------------------------</p><p>åƒåœ¾å›æ”¶å™¨æ˜¯åƒåœ¾å›æ”¶ç®—æ³•çš„å…·ä½“å®ç°ã€‚</p><h4 id="4-5-2åƒåœ¾å›æ”¶å™¨ç»„åˆå…³ç³»">4.5.2åƒåœ¾å›æ”¶å™¨ç»„åˆå…³ç³»</h4><p>ç”±äºåƒåœ¾å›æ”¶å™¨åˆ†ä¸ºå¹´è½»ä»£å’Œè€å¹´ä»£ï¼Œ<strong>é™¤äº†G1ä¹‹å¤–å…¶ä»–åƒåœ¾å›æ”¶å™¨å¿…é¡»æˆå¯¹ç»„åˆè¿›è¡Œä½¿ç”¨ã€‚</strong></p><p>å…·ä½“çš„å…³ç³»å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1364-1024x367.png" alt="img"></p><h4 id="4-5-3Serialå’ŒSerial-Oldçš„ç»„åˆ">4.5.3Serialå’ŒSerial Oldçš„ç»„åˆ</h4><h5 id="å¹´è½»ä»£-Serialåƒåœ¾å›æ”¶å™¨">å¹´è½»ä»£-Serialåƒåœ¾å›æ”¶å™¨</h5><p>Serialæ˜¯ä¸€ç§<strong>å•çº¿ç¨‹ä¸²è¡Œå›æ”¶</strong>å¹´è½»ä»£çš„åƒåœ¾å›æ”¶å™¨ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1365.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1366-1024x131.png" alt="img"></p><h5 id="è€å¹´ä»£-SerialOldåƒåœ¾å›æ”¶å™¨">è€å¹´ä»£-SerialOldåƒåœ¾å›æ”¶å™¨</h5><p>SerialOldæ˜¯Serialåƒåœ¾å›æ”¶å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œé‡‡ç”¨<strong>å•çº¿ç¨‹ä¸²è¡Œå›æ”¶</strong></p><p>-XX:+UseSerialGC æ–°ç”Ÿä»£ã€è€å¹´ä»£éƒ½ä½¿ç”¨ä¸²è¡Œå›æ”¶å™¨ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1368.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1367-1024x151.png" alt="img"></p><h4 id="4-5-4ParNewå’ŒCMSçš„ç»„åˆ">4.5.4ParNewå’ŒCMSçš„ç»„åˆ</h4><h5 id="å¹´è½»ä»£-ParNewåƒåœ¾å›æ”¶å™¨">å¹´è½»ä»£-ParNewåƒåœ¾å›æ”¶å™¨</h5><p>ParNewåƒåœ¾å›æ”¶å™¨æœ¬è´¨ä¸Šæ˜¯å¯¹Serialåœ¨å¤šCPUä¸‹çš„ä¼˜åŒ–ï¼Œä½¿ç”¨<strong>å¤šçº¿ç¨‹</strong>è¿›è¡Œåƒåœ¾å›æ”¶</p><p>-XX:+UseParNewGC æ–°ç”Ÿä»£ä½¿ç”¨ParNewå›æ”¶å™¨ï¼Œ è€å¹´ä»£ä½¿ç”¨ä¸²è¡Œå›æ”¶å™¨</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1369.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1370-1024x134.png" alt="img"></p><h5 id="è€å¹´ä»£-CMS-Concurrent-Mark-Sweep-åƒåœ¾å›æ”¶å™¨-JDK14åºŸå¼ƒ">è€å¹´ä»£- CMS(Concurrent Mark Sweep)åƒåœ¾å›æ”¶å™¨(JDK14åºŸå¼ƒ)</h5><p>CMSåƒåœ¾å›æ”¶å™¨å…³æ³¨çš„æ˜¯ç³»ç»Ÿçš„<strong>æš‚åœæ—¶é—´</strong>ï¼Œå…è®¸ç”¨æˆ·çº¿ç¨‹å’Œåƒåœ¾å›æ”¶çº¿ç¨‹åœ¨æŸäº›æ­¥éª¤ä¸­åŒæ—¶æ‰§è¡Œï¼Œå‡å°‘äº†ç”¨æˆ·çº¿ç¨‹çš„ç­‰å¾…æ—¶é—´ã€‚</p><p>å‚æ•°ï¼šXX:+UseConcMarkSweepGC</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1372.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1373-1024x164.png" alt="img"></p><p>CMSæ‰§è¡Œæ­¥éª¤ï¼š</p><p>1.åˆå§‹æ ‡è®°ï¼Œç”¨æçŸ­çš„æ—¶é—´æ ‡è®°å‡ºGC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1374.png" alt="img"></p><p>2.å¹¶å‘æ ‡è®°, æ ‡è®°æ‰€æœ‰çš„å¯¹è±¡ï¼Œç”¨æˆ·çº¿ç¨‹ä¸éœ€è¦æš‚åœã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1375.png" alt="img"></p><p>3.é‡æ–°æ ‡è®°ï¼Œç”±äºå¹¶å‘æ ‡è®°é˜¶æ®µæœ‰äº›å¯¹è±¡ä¼šå‘ç”Ÿäº†å˜åŒ–ï¼Œå­˜åœ¨é”™æ ‡ã€æ¼æ ‡ç­‰æƒ…å†µï¼Œéœ€è¦é‡æ–°æ ‡è®°ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1376.png" alt="img"></p><p>4.å¹¶å‘æ¸…ç†ï¼Œæ¸…ç†æ­»äº¡çš„å¯¹è±¡ï¼Œç”¨æˆ·çº¿ç¨‹ä¸éœ€è¦æš‚åœã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1377-1024x277.png" alt="img"></p><p>ä¹Ÿå°±æ˜¯è¯´åªæœ‰ä¸¤ä¸ªé˜¶æ®µä¼šäº§ç”ŸSTWï¼Œä¸€ä¸ªæ˜¯åˆå§‹æ ‡è®°é˜¶æ®µä¸€ä¸ªæ˜¯é‡æ–°æ ‡è®°é˜¶æ®µï¼Œä½†è¿™ä¸¤ä¸ªåœé¡¿æ—¶é—´ä¼šçŸ­ä¸€äº›(å¹¶å‘æ ‡è®°æ—¶é—´æ¯”è¾ƒé•¿ é‡æ–°æ ‡è®°åªæ˜¯æ‰¾é”™æ¼æƒ…å†µ ä¼šæ¯”è¾ƒçŸ­)</p><p><strong>ç¼ºç‚¹ï¼š</strong></p><p>1ã€CMSä½¿ç”¨äº†æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œåœ¨åƒåœ¾æ”¶é›†ç»“æŸä¹‹åä¼šå‡ºç°å¤§é‡çš„å†…å­˜ç¢ç‰‡ï¼ŒCMSä¼šåœ¨Full GCæ—¶è¿›è¡Œç¢ç‰‡çš„æ•´ç†ã€‚è¿™æ ·ä¼šå¯¼è‡´ç”¨æˆ·çº¿ç¨‹æš‚åœï¼Œå¯ä»¥ä½¿ç”¨-XX:CMSFullGCsBeforeCompaction=N å‚æ•°ï¼ˆé»˜è®¤0ï¼‰è°ƒæ•´Næ¬¡Full GCä¹‹åå†æ•´ç†ã€‚</p><p>2.ã€æ— æ³•å¤„ç†åœ¨å¹¶å‘æ¸…ç†è¿‡ç¨‹ä¸­äº§ç”Ÿçš„â€œæµ®åŠ¨åƒåœ¾â€ï¼Œä¸èƒ½åšåˆ°å®Œå…¨çš„åƒåœ¾å›æ”¶ã€‚(æµ®åŠ¨åƒåœ¾ï¼ˆFloating Garbageï¼‰ æ˜¯æŒ‡ï¼šåœ¨ CMS çš„å¹¶å‘æ ‡è®°é˜¶æ®µï¼Œåº”ç”¨çº¿ç¨‹ç»§ç»­è¿è¡ŒæœŸé—´æ–°äº§ç”Ÿçš„ã€åæ¥å˜æˆä¸å¯è¾¾çš„å¯¹è±¡ï¼Œä½† CMS æ²¡æœ‰æ ‡è®°åˆ°å®ƒä»¬ã€‚è¿™äº›å¯¹è±¡åœ¨è¿™ä¸€è½® GC ä¸­è¢«â€œé—æ¼â€äº†ï¼Œå› æ­¤ä¸ä¼šè¢«å›æ”¶ï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡GCæ‰æœ‰æœºä¼šè¢«æ¸…ç†</p><p>3ã€å¦‚æœè€å¹´ä»£å†…å­˜ä¸è¶³æ— æ³•åˆ†é…å¯¹è±¡ï¼ŒCMSå°±ä¼šé€€åŒ–æˆSerial Oldå•çº¿ç¨‹å›æ”¶è€å¹´ä»£ã€‚</p><h4 id="4-5-5Parallel-Scavenge-å’ŒParallel-Oldçš„ç»„åˆï¼ˆJDK8é»˜è®¤ç»„åˆï¼‰">4.5.5Parallel Scavenge å’ŒParallel Oldçš„ç»„åˆï¼ˆJDK8é»˜è®¤ç»„åˆï¼‰</h4><h5 id="å¹´è½»ä»£-Parallel-Scavengeåƒåœ¾å›æ”¶å™¨">å¹´è½»ä»£-Parallel Scavengeåƒåœ¾å›æ”¶å™¨</h5><p>Parallel Scavengeæ˜¯<strong>JDK8é»˜è®¤çš„å¹´è½»ä»£åƒåœ¾å›æ”¶å™¨</strong>ï¼Œå¤šçº¿ç¨‹å¹¶è¡Œå›æ”¶ï¼Œå…³æ³¨çš„æ˜¯ç³»ç»Ÿçš„ååé‡ã€‚å…·å¤‡<strong>è‡ªåŠ¨è°ƒæ•´å †å†…å­˜å¤§å°</strong>çš„ç‰¹ç‚¹ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1378.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1379-1024x163.png" alt="img"></p><p><strong>å¸¸ç”¨å‚æ•°ï¼š</strong></p><p>Parallel Scavengeå…è®¸æ‰‹åŠ¨è®¾ç½®æœ€å¤§æš‚åœæ—¶é—´å’Œååé‡ã€‚Oracleå®˜æ–¹å»ºè®®åœ¨ä½¿ç”¨è¿™ä¸ªç»„åˆæ—¶ï¼Œä¸è¦è®¾ç½®å †å†…å­˜çš„æœ€å¤§å€¼ï¼Œåƒåœ¾å›æ”¶å™¨ä¼šæ ¹æ®æœ€å¤§æš‚åœæ—¶é—´å’Œååé‡è‡ªåŠ¨è°ƒæ•´å†…å­˜å¤§å°ã€‚</p><ul><li>æœ€å¤§æš‚åœæ—¶é—´ï¼Œ<code>-XX:MaxGCPauseMillis=n</code> è®¾ç½®æ¯æ¬¡åƒåœ¾å›æ”¶æ—¶çš„æœ€å¤§åœé¡¿æ¯«ç§’æ•°</li><li>ååé‡ï¼Œ<code>-XX:GCTimeRatio=n</code> è®¾ç½®ååé‡ä¸ºnï¼ˆç”¨æˆ·çº¿ç¨‹æ‰§è¡Œæ—¶é—´ = n/n + 1ï¼‰</li><li><strong>è‡ªåŠ¨è°ƒæ•´å†…å­˜å¤§å°</strong>, <code>-XX:+UseAdaptiveSizePolicy</code>è®¾ç½®å¯ä»¥è®©åƒåœ¾å›æ”¶å™¨æ ¹æ®ååé‡å’Œæœ€å¤§åœé¡¿çš„æ¯«ç§’æ•°è‡ªåŠ¨è°ƒæ•´å†…å­˜å¤§å°</li></ul><p>ååé‡çš„å€¼é»˜è®¤99ï¼ˆç”¨æˆ·çº¿ç¨‹æ‰§è¡Œ99%æ—¶é—´ï¼Œåƒåœ¾å›æ”¶çº¿ç¨‹1%ï¼‰</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1390-1024x58.png" alt="img"></p><p>æœ€å¤§æš‚åœæ—¶é—´é»˜è®¤å€¼(éå¸¸å¤§ï¼ŒåŸºæœ¬ä»»ä½•æ—¶é—´éƒ½æ»¡è¶³ï¼Œç›¸å¯¹äºæ²¡æœ‰é™åˆ¶æœ€å¤§æš‚åœæ—¶é—´)</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1391-1024x61.png" alt="img"></p><h5 id="è€å¹´ä»£-Parallel-Oldåƒåœ¾å›æ”¶å™¨">è€å¹´ä»£-Parallel Oldåƒåœ¾å›æ”¶å™¨</h5><p>Parallel Oldæ˜¯ä¸ºParallel Scavengeæ”¶é›†å™¨è®¾è®¡çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œåˆ©ç”¨å¤šçº¿ç¨‹å¹¶è¡Œæ”¶é›†ã€‚</p><p>å‚æ•°ï¼š -XX:+UseParallelGC æˆ–</p><p>-XX:+UseParallelOldGCå¯ä»¥ä½¿ç”¨Parallel Scavenge + Parallel Oldè¿™ç§ç»„åˆã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1380.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1382-1024x141.png" alt="img"></p><h4 id="G1åƒåœ¾å›æ”¶å™¨ï¼ˆJDK9ä¹‹åé»˜è®¤çš„åƒåœ¾å›æ”¶å™¨ï¼‰">G1åƒåœ¾å›æ”¶å™¨ï¼ˆJDK9ä¹‹åé»˜è®¤çš„åƒåœ¾å›æ”¶å™¨ï¼‰</h4><p>JDK9ä¹‹åé»˜è®¤çš„åƒåœ¾å›æ”¶å™¨æ˜¯G1ï¼ˆGarbage Firstï¼‰åƒåœ¾å›æ”¶å™¨ã€‚Parallel Scavengeå…³æ³¨ååé‡ï¼Œå…è®¸ç”¨æˆ·è®¾ç½®æœ€å¤§æš‚åœæ—¶é—´ ï¼Œä½†æ˜¯ä¼šå‡å°‘å¹´è½»ä»£å¯ç”¨ç©ºé—´çš„å¤§å°ã€‚CMSå…³æ³¨æš‚åœæ—¶é—´ï¼Œä½†æ˜¯ååé‡æ–¹é¢ä¼šä¸‹é™ã€‚</p><p>è€ŒG1è®¾è®¡ç›®æ ‡å°±æ˜¯å°†ä¸Šè¿°ä¸¤ç§åƒåœ¾å›æ”¶å™¨çš„ä¼˜ç‚¹èåˆï¼š</p><ul><li>1.æ”¯æŒå·¨å¤§çš„å †ç©ºé—´å›æ”¶ï¼Œå¹¶æœ‰è¾ƒé«˜çš„ååé‡ã€‚</li><li>2.æ”¯æŒå¤šCPUå¹¶è¡Œåƒåœ¾å›æ”¶ã€‚</li><li>3.å…è®¸ç”¨æˆ·è®¾ç½®æœ€å¤§æš‚åœæ—¶é—´ã€‚</li></ul><p>JDK9ä¹‹åå¼ºçƒˆå»ºè®®ä½¿ç”¨G1åƒåœ¾å›æ”¶å™¨ã€‚</p><p>G1å‡ºç°ä¹‹å‰çš„åƒåœ¾å›æ”¶å™¨ï¼Œå¹´è½»ä»£å’Œè€å¹´ä»£ä¸€èˆ¬æ˜¯è¿ç»­çš„ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1383-1024x332.png" alt="img"></p><p>G1çš„æ•´ä¸ªå †ä¼šè¢«åˆ’åˆ†æˆå¤šä¸ªå¤§å°ç›¸ç­‰çš„åŒºåŸŸï¼Œç§°ä¹‹ä¸ºåŒºRegionï¼ŒåŒºåŸŸ<strong>ä¸è¦æ±‚æ˜¯è¿ç»­çš„</strong>ã€‚åˆ†ä¸ºEdenã€Survivorã€OldåŒºã€‚Regionçš„å¤§å°é€šè¿‡å †ç©ºé—´å¤§å°/2048è®¡ç®—å¾—åˆ°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å‚æ•°-XX:G1HeapRegionSize=32mæŒ‡å®š(å…¶ä¸­32mæŒ‡å®šregionå¤§å°ä¸º32M)ï¼ŒRegion sizeå¿…é¡»æ˜¯2çš„æŒ‡æ•°å¹‚ï¼Œå–å€¼èŒƒå›´ä»1Måˆ°32Mã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1384.png" alt="img"></p><p>G1åƒåœ¾å›æ”¶æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><p>1ã€å¹´è½»ä»£å›æ”¶ï¼ˆYoung GCï¼‰</p><p>2ã€æ··åˆå›æ”¶ï¼ˆMixed GCï¼‰</p><h5 id="å¹´è½»ä»£å›æ”¶">å¹´è½»ä»£å›æ”¶</h5><p>å¹´è½»ä»£å›æ”¶ï¼ˆYoung GCï¼‰ï¼Œå›æ”¶EdenåŒºå’ŒSurvivoråŒºä¸­ä¸ç”¨çš„å¯¹è±¡ã€‚ä¼šå¯¼è‡´STWï¼ŒG1ä¸­å¯ä»¥é€šè¿‡å‚æ•°</p><p>-XX:MaxGCPauseMillis=nï¼ˆé»˜è®¤200ï¼‰ è®¾ç½®æ¯æ¬¡åƒåœ¾å›æ”¶æ—¶çš„æœ€å¤§æš‚åœæ—¶é—´æ¯«ç§’æ•°ï¼ŒG1åƒåœ¾å›æ”¶å™¨ä¼šå°½å¯èƒ½åœ°ä¿è¯æš‚åœæ—¶é—´ã€‚</p><p>1ã€æ–°åˆ›å»ºçš„å¯¹è±¡ä¼šå­˜æ”¾åœ¨EdenåŒºã€‚å½“G1åˆ¤æ–­å¹´è½»ä»£åŒºä¸è¶³ï¼ˆmaxé»˜è®¤60%å³å å¹´è½»ä»£è®¾ç½®å¤§å°çš„60%ï¼‰ï¼Œæ— æ³•åˆ†é…å¯¹è±¡æ—¶éœ€è¦å›æ”¶æ—¶ä¼šæ‰§è¡ŒYoung GCã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1385.png" alt="img"></p><p>2ã€æ ‡è®°å‡ºEdenå’ŒSurvivoråŒºåŸŸä¸­çš„å­˜æ´»å¯¹è±¡ï¼Œ</p><p>3ã€æ ¹æ®é…ç½®çš„æœ€å¤§æš‚åœæ—¶é—´é€‰æ‹©æŸäº›åŒºåŸŸå°†<strong>å­˜æ´»å¯¹è±¡</strong>å¤åˆ¶åˆ°ä¸€ä¸ªæ–°çš„SurvivoråŒºä¸­ï¼ˆå¹´é¾„+1ï¼‰ï¼Œæ¸…ç©ºè¿™äº›åŒºåŸŸã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1386.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1387.png" alt="img"></p><p>G1åœ¨è¿›è¡ŒYoung GCçš„è¿‡ç¨‹ä¸­ä¼šå»è®°å½•æ¯æ¬¡åƒåœ¾å›æ”¶æ—¶æ¯ä¸ªEdenåŒºå’ŒSurvivoråŒºçš„å¹³å‡è€—æ—¶ï¼Œä»¥ä½œä¸ºä¸‹æ¬¡å›æ”¶æ—¶çš„å‚è€ƒä¾æ®ã€‚è¿™æ ·å°±å¯ä»¥æ ¹æ®é…ç½®çš„æœ€å¤§æš‚åœæ—¶é—´è®¡ç®—å‡ºæœ¬æ¬¡å›æ”¶æ—¶æœ€å¤šèƒ½å›æ”¶å¤šå°‘ä¸ªRegionåŒºåŸŸäº†ã€‚</p><p>æ¯”å¦‚ -XX:MaxGCPauseMillis=nï¼ˆé»˜è®¤200ï¼‰ï¼Œæ¯ä¸ªRegionå›æ”¶è€—æ—¶40msï¼Œé‚£ä¹ˆè¿™æ¬¡å›æ”¶æœ€å¤šåªèƒ½å›æ”¶4ä¸ªRegionã€‚</p><p>4ã€åç»­Young GCæ—¶ä¸ä¹‹å‰ç›¸åŒï¼Œåªä¸è¿‡SurvivoråŒºä¸­å­˜æ´»å¯¹è±¡ä¼šè¢«æ¬è¿åˆ°å¦ä¸€ä¸ªSurvivoråŒºã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1388.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1389.png" alt="img"></p><p>5ã€å½“æŸä¸ªå­˜æ´»å¯¹è±¡çš„å¹´é¾„åˆ°è¾¾é˜ˆå€¼ï¼ˆé»˜è®¤15ï¼‰ï¼Œå°†è¢«æ”¾å…¥è€å¹´ä»£ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1392.png" alt="img"></p><p>6ã€éƒ¨åˆ†å¯¹è±¡å¦‚æœå¤§å°è¶…è¿‡Regionçš„ä¸€åŠï¼Œä¼šç›´æ¥æ”¾å…¥è€å¹´ä»£ï¼Œè¿™ç±»è€å¹´ä»£è¢«ç§°ä¸ºHumongousåŒºã€‚æ¯”å¦‚å †å†…å­˜æ˜¯4Gï¼Œæ¯ä¸ªRegionæ˜¯2Mï¼Œåªè¦ä¸€ä¸ªå¤§å¯¹è±¡è¶…è¿‡äº†1Må°±è¢«æ”¾å…¥HumongousåŒºï¼Œå¦‚æœå¯¹è±¡è¿‡å¤§ä¼šæ¨ªè·¨å¤šä¸ªRegionã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1393.png" alt="img"></p><p>7ã€å¤šæ¬¡å›æ”¶ä¹‹åï¼Œä¼šå‡ºç°å¾ˆå¤šOldè€å¹´ä»£åŒºï¼Œæ­¤æ—¶æ€»å †å æœ‰ç‡è¾¾åˆ°é˜ˆå€¼æ—¶</p><p>ï¼ˆ-XX:InitiatingHeapOccupancyPercenté»˜è®¤45%ï¼‰ä¼šè§¦å‘æ··åˆå›æ”¶MixedGCã€‚å›æ”¶æ‰€æœ‰å¹´è½»ä»£å’Œéƒ¨åˆ†è€å¹´ä»£çš„å¯¹è±¡ä»¥åŠå¤§å¯¹è±¡åŒºã€‚é‡‡ç”¨å¤åˆ¶ç®—æ³•æ¥å®Œæˆã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1394.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1395-1024x558.png" alt="img"></p><h5 id="æ··åˆå›æ”¶">æ··åˆå›æ”¶</h5><p>æ··åˆå›æ”¶åˆ†ä¸ºï¼šåˆå§‹æ ‡è®°ï¼ˆinitial markï¼‰ã€å¹¶å‘æ ‡è®°ï¼ˆconcurrent markï¼‰ã€æœ€ç»ˆæ ‡è®°ï¼ˆremarkæˆ–è€…Finalize Markingï¼‰ã€å¹¶å‘æ¸…ç†ï¼ˆcleanupï¼‰</p><p><strong>G1å¯¹è€å¹´ä»£çš„æ¸…ç†ä¼šé€‰æ‹©å­˜æ´»åº¦æœ€ä½çš„åŒºåŸŸæ¥è¿›è¡Œå›æ”¶ï¼Œè¿™æ ·å¯ä»¥ä¿è¯å›æ”¶æ•ˆç‡æœ€é«˜</strong>ï¼Œè¿™ä¹Ÿæ˜¯G1ï¼ˆGarbage firstï¼‰åç§°çš„ç”±æ¥ã€‚æœ€åæ¸…ç†é˜¶æ®µä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1396-1024x322.png" alt="img"></p><p>æ··åˆå›æ”¶çš„æ­¥éª¤ï¼š</p><ul><li>1ã€åˆå§‹æ ‡è®°ï¼ŒSTWï¼Œé‡‡ç”¨ä¸‰è‰²æ ‡è®°æ³•æ ‡è®°ä»GC Rootå¯ç›´è¾¾çš„å¯¹è±¡ã€‚ STWæ—¶é—´æçŸ­ã€‚</li><li>2ã€å¹¶å‘æ ‡è®°ï¼Œå¹¶å‘æ‰§è¡Œï¼Œå¯¹å­˜æ´»å¯¹è±¡è¿›è¡Œæ ‡è®°ã€‚</li><li>3ã€æœ€ç»ˆæ ‡è®°ï¼ŒSTWï¼Œå¤„ç†SATBç›¸å…³çš„å¯¹è±¡æ ‡è®°ã€‚ STWæ—¶é—´æçŸ­ã€‚</li><li>4ã€æ¸…ç†ï¼ŒSTWï¼Œå¦‚æœåŒºåŸŸä¸­æ²¡æœ‰ä»»ä½•å­˜æ´»å¯¹è±¡å°±ç›´æ¥æ¸…ç†ã€‚ STWæ—¶é—´æçŸ­ã€‚</li><li>5ã€è½¬ç§»ï¼Œå°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°åˆ«çš„åŒºåŸŸã€‚ STWæ—¶é—´è¾ƒé•¿ã€‚</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1397-1024x380.png" alt="img"></p><p>æ³¨æ„ï¼šå¦‚æœæ¸…ç†è¿‡ç¨‹ä¸­å‘ç°æ²¡æœ‰è¶³å¤Ÿçš„ç©ºRegionå­˜æ”¾è½¬ç§»çš„å¯¹è±¡ï¼Œä¼šå‡ºç°Full GCã€‚å•çº¿ç¨‹æ‰§è¡Œæ ‡è®°-æ•´ç†ç®—æ³•ï¼Œæ­¤æ—¶ä¼šå¯¼è‡´ç”¨æˆ·çº¿ç¨‹çš„æš‚åœã€‚æ‰€ä»¥å°½é‡ä¿è¯åº”è¯¥ç”¨çš„å †å†…å­˜æœ‰ä¸€å®šå¤šä½™çš„ç©ºé—´ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1398.png" alt="img"></p><h4 id="4-5-6G1-â€“-Garbage-First-åƒåœ¾å›æ”¶å™¨ï¼ˆç›¸å…³å‚æ•°ï¼‰">4.5.6G1 â€“ Garbage First åƒåœ¾å›æ”¶å™¨ï¼ˆç›¸å…³å‚æ•°ï¼‰</h4><p>å‚æ•°1ï¼š <code>-XX:+UseG1GC</code> æ‰“å¼€G1çš„å¼€å…³ï¼ŒJDK9ä¹‹åé»˜è®¤ä¸éœ€è¦æ‰“å¼€</p><p>å‚æ•°2ï¼š<code>-XX:MaxGCPauseMillis=æ¯«ç§’å€¼</code> æœ€å¤§æš‚åœçš„æ—¶é—´</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1400.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1399-1024x136.png" alt="img"></p><p>ä½¿ç”¨ä»¥ä¸‹ä»£ç æµ‹è¯•g1åƒåœ¾å›æ”¶å™¨ï¼Œæ‰“å°å‡ºæ¯ä¸ªé˜¶æ®µçš„æ—¶é—´:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">packagechapter04.gc;</span><br><span class="line"></span><br><span class="line">importjava.io.IOException;</span><br><span class="line">importjava.util.ArrayList;</span><br><span class="line">importjava.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** * åƒåœ¾å›æ”¶å™¨æ¡ˆä¾‹3 */</span></span><br><span class="line"> <span class="comment">//-XX:+UseG1GC   -Xmn8g -Xmx16g -XX:SurvivorRatio=8  -XX:+PrintGCDetails -verbose:gc</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GcDemo2</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] <span class="keyword">args</span></span>) throws IOException</span> &#123;</span><br><span class="line">        intcount = <span class="number">0</span>;</span><br><span class="line">        List&lt;Object&gt; list = newArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="comment">//System.out.println(++count);if(count++ % 10240 == 0)&#123;</span></span><br><span class="line">                list.clear();</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//            byte[] bytes = new byte[1024 * 1024 * 1];</span></span><br><span class="line">               list.<span class="keyword">add</span>(newbyte[<span class="number">1024</span> * <span class="number">1024</span> * <span class="number">1</span> / <span class="number">2</span>]);</span><br><span class="line"><span class="comment">//            System.gc();&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯ä¸ªregionå¤§å°ä¸º2mï¼Œä¸€å…±æœ‰84ä¸ªyoungåŒºï¼Œ26ä¸ªå¹¸å­˜è€…åŒºã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1401.png" alt="img"></p><p>åˆå§‹æ ‡è®°èŠ±äº†0.0478ç§’ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1402.png" alt="img"></p><p>å¹¶å‘æ ‡è®°æ€»å…±è€—æ—¶10msï¼Œä¸ä¼šäº§ç”ŸSTWã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1403.png" alt="img"></p><h4 id="4-5-7æ€»ç»“">4.5.7æ€»ç»“</h4><p>åƒåœ¾å›æ”¶å™¨çš„ç»„åˆå…³ç³»è™½ç„¶å¾ˆå¤šï¼Œä½†æ˜¯é’ˆå¯¹å‡ ä¸ªç‰¹å®šçš„ç‰ˆæœ¬ï¼Œæ¯”è¾ƒå¥½çš„ç»„åˆé€‰æ‹©å¦‚ä¸‹ï¼š</p><p>JDK8åŠä¹‹å‰ï¼š</p><p>ParNew + CMSï¼ˆå…³æ³¨æš‚åœæ—¶é—´ï¼‰ã€Parallel Scavenge + Parallel Old (å…³æ³¨ååé‡)ã€ G1ï¼ˆJDK8ä¹‹å‰ä¸å»ºè®®ï¼Œè¾ƒå¤§å †å¹¶ä¸”å…³æ³¨æš‚åœæ—¶é—´ï¼‰</p><p>JDK9ä¹‹å:</p><p>G1ï¼ˆé»˜è®¤ï¼‰</p><p>ä»JDK9ä¹‹åï¼Œç”±äºG1æ—¥è¶‹æˆç†Ÿï¼ŒJDKé»˜è®¤çš„åƒåœ¾å›æ”¶å™¨å·²ç»ä¿®æ”¹ä¸ºG1ï¼Œæ‰€ä»¥å¼ºçƒˆå»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸Šä½¿ç”¨G1ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1404-1024x517.png" alt="img"></p><p>å¯¹äºçº¿ç¨‹ä¸å…±äº«çš„ç¨‹åºè®¡æ•°å™¨å’Œæ ˆç©ºé—´æ¥è¯´ï¼Œå®ƒä¼šä¼´éšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œè·Ÿç€çº¿ç¨‹çš„å›æ”¶è€Œå›æ”¶</p><p>å¯¹äºçº¿ç¨‹å…±äº«çš„ä¸¤éƒ¨åˆ†æ–¹æ³•åŒºå’Œå †æ¥è¯´ï¼Œæ–¹æ³•åŒºä¸€èˆ¬ä¸éœ€è¦å›æ”¶ï¼Œåœ¨ç‰¹å®šçš„æŸäº›æŠ€æœ¯å¦‚JSPç­‰æŠ€æœ¯ä¼šé€šè¿‡å›æ”¶ç±»åŠ è½½å™¨å»å›æ”¶æ–¹æ³•åŒºçš„ç±»ï¼Œä½†ä¸€èˆ¬å¯¹äºç¨‹åºå‘˜æ¥è¯´è¿™å—å¾ˆå°‘å…³æ³¨ï¼›å †åˆ™ä¼šæœ‰åƒåœ¾å›æ”¶å™¨æ¥è´Ÿè´£å›æ”¶</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1406-1024x204.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1405.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1407-1024x396.png" alt="img"></p><p>æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼šæ ‡è®°ä¹‹åå†æ¸…é™¤ï¼Œå®¹æ˜“äº§ç”Ÿå†…å­˜ç¢ç‰‡</p><p>å¤åˆ¶ç®—æ³•ï¼šä»ä¸€å—åŒºåŸŸå¤åˆ¶åˆ°å¦ä¸€å—åŒºåŸŸå®¹æ˜“é€ æˆåªèƒ½ä½¿ç”¨ä¸€éƒ¨åˆ†å†…å­˜ï¼Œå¯¹å†…å­˜çš„ä½¿ç”¨ç‡ä¼šä¸‹é™</p><p>æ ‡è®°-æ•´ç†ç®—æ³•ï¼šæ ‡è®°ä¹‹åå°†å­˜æ´»çš„å¯¹è±¡æ¨åˆ°ä¸€è¾¹ï¼Œå¯¹è±¡ä¼šç§»åŠ¨ï¼Œæ•ˆç‡ä¸é«˜</p><p>åˆ†ä»£GCç®—æ³•:å°†å†…å­˜åŒºåŸŸåˆ’åˆ†ä¸ºå¹´è½»ä»£ã€å¹¸å­˜è€…åŒºã€è€å¹´ä»£è¿›è¡Œå›æ”¶ã€å¯ä»¥ä½¿ç”¨å¤šç§å›æ”¶ç®—æ³•</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1408-1024x469.png" alt="img"></p><p>Serialå’ŒSerial Oldçš„ç»„åˆï¼šå•çº¿ç¨‹å›æ”¶ï¼Œä¸»è¦é€‚ç”¨äºå•æ ¸CPUåœºæ™¯</p><p>ParNewå’ŒCMSçš„ç»„åˆ:æš‚åœæ—¶é—´è¾ƒçŸ­ï¼Œé€‚ç”¨äºå¤§å‹äº’è”ç½‘åº”ç”¨ä¸­ä¸ç”¨æˆ·äº¤äº’çš„éƒ¨åˆ†ï¼ˆåˆ›å»ºè®¢å•ï¼ŒæŸ¥è¯¢å•†å“ä¿¡æ¯ï¼‰ï¼Œä½†è¿˜éœ€æ³¨æ„CMSçš„ç¼ºç‚¹</p><p>Parallel Scavenge å’ŒParallel Oldçš„ç»„åˆï¼šååé‡é«˜ï¼Œé€‚ç”¨äºåå°è¿›è¡Œå¤§é‡æ•°æ®æ“ä½œ</p><p>G1åƒåœ¾å›æ”¶å™¨ï¼šé€‚ç”¨äºè¾ƒå¤§çš„å †ï¼Œå…·æœ‰å¯æ§çš„æš‚åœæ—¶é—´</p><h1 id="åŸºç¡€ç¯‡å®Œç»“">åŸºç¡€ç¯‡å®Œç»“</h1>]]></content>
    
    
    <summary type="html">é»‘é©¬ç¨‹åºå‘˜JVMä¸‰éƒ¨æ›²ä¸Šç¯‡-åŸºç¡€ç¯‡ï¼ˆåˆå§‹åŒ–JVMã€å­—èŠ‚ç æ–‡ä»¶è¯¦è§£ã€è¿è¡Œæ—¶æ•°æ®åŒºã€åƒåœ¾å›æ”¶ï¼‰</summary>
    
    
    
    <category term="JVM" scheme="https://itgeqian.github.io/categories/JVM/"/>
    
    
    <category term="JVM" scheme="https://itgeqian.github.io/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>mysqlåŸºç¡€ç¯‡</title>
    <link href="https://itgeqian.github.io/posts/9.html"/>
    <id>https://itgeqian.github.io/posts/9.html</id>
    <published>2025-06-15T01:19:03.000Z</published>
    <updated>2025-06-18T09:12:00.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1409-1024x502.png" alt="img"></p><h2 id="åŸºç¡€ç¯‡">åŸºç¡€ç¯‡</h2><h2 id="1-MySQLæ¦‚è¿°">1.MySQLæ¦‚è¿°</h2><h3 id="1-1æ•°æ®åº“ç›¸å…³æ¦‚å¿µ">1.1æ•°æ®åº“ç›¸å…³æ¦‚å¿µ</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1410.png" alt="img"></p><h3 id="1-2MySQLæ•°æ®åº“å®‰è£…ä¸é…ç½®-ç•¥">1.2MySQLæ•°æ®åº“å®‰è£…ä¸é…ç½® -ç•¥</h3><h3 id="1-3å…³ç³»å‹æ•°æ®åº“ä¸éå…³ç³»å‹æ•°æ®åº“">1.3å…³ç³»å‹æ•°æ®åº“ä¸éå…³ç³»å‹æ•°æ®åº“</h3><p>è¯¦è§-RedisåŸºç¡€ç¯‡ 1.1è®¤è¯†NoSQL</p><p>è¿™é‡Œç®€å•æ€»ç»“ä¸€ä¸‹ï¼š</p><h4 id="åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</h4><ul><li><p><strong>å…³ç³»å‹æ•°æ®åº“ï¼ˆRDBMSï¼‰</strong><br>åŸºäº<strong>è¡¨æ ¼ç»“æ„</strong>ï¼ˆè¡Œå’Œåˆ—ï¼‰ï¼Œä¸¥æ ¼éµå®ˆæ•°æ®æ¨¡å¼ï¼ˆschemaï¼‰ã€‚å¸¸è§ï¼šMySQLã€PostgreSQLã€Oracleã€SQL Serverã€‚</p></li><li><p>éå…³ç³»å‹æ•°æ®åº“ï¼ˆNoSQLï¼‰</p><p>å…¨ç§°</p><p>Not Only SQL</p><p>ï¼Œæ•°æ®ç»„ç»‡æ–¹å¼çµæ´»ï¼Œä¸ä¸€å®šæ˜¯è¡¨æ ¼ã€‚å¸¸è§ç±»å‹ï¼š</p><ul><li><strong>é”®å€¼å‹</strong>ï¼ˆRedisã€Memcachedï¼‰</li><li><strong>æ–‡æ¡£å‹</strong>ï¼ˆMongoDBï¼‰</li><li><strong>å›¾æ•°æ®åº“</strong>ï¼ˆNeo4jï¼‰</li></ul></li></ul><h4 id="ç»“æ„åŒ–-vs-éç»“æ„åŒ–">ç»“æ„åŒ– vs. éç»“æ„åŒ–</h4><ul><li><strong>å…³ç³»å‹æ•°æ®åº“</strong>ï¼šæ•°æ®æ˜¯<strong>ç»“æ„åŒ–çš„</strong>ï¼Œæ¯ä¸ªè¡¨éƒ½æœ‰æ˜ç¡®å­—æ®µã€æ•°æ®ç±»å‹å’Œçº¦æŸï¼Œæ’å…¥å¿…é¡»ç¬¦åˆè¿™äº›è§„åˆ™ã€‚</li><li><strong>NoSQL</strong>ï¼šæ ¼å¼æ›´è‡ªç”±ï¼Œæ²¡æœ‰å¼ºåˆ¶å›ºå®šç»“æ„ï¼Œå¯ä»¥ç›´æ¥å­˜é”®å€¼å¯¹ã€JSONæ–‡æ¡£ã€å›¾æ•°æ®ç­‰ã€‚<br>âœ… ä¼˜åŠ¿ï¼šçµæ´»ï¼Œé€‚åº”å¿«é€Ÿå˜åŒ–çš„ä¸šåŠ¡éœ€æ±‚<br>âŒ åŠ£åŠ¿ï¼šç¼ºä¹ç»Ÿä¸€æ ‡å‡†ï¼Œæ•°æ®ä¸€è‡´æ€§ä¾èµ–åº”ç”¨å±‚å¤„ç†</li></ul><h4 id="å…³è”å…³ç³»">å…³è”å…³ç³»</h4><ul><li><strong>å…³ç³»å‹æ•°æ®åº“</strong>ï¼šé€šè¿‡<strong>å¤–é”®</strong>ç­‰æœºåˆ¶ç»´æŠ¤è¡¨ä¹‹é—´çš„å…³è”ï¼Œæ•°æ®ä¸€è‡´æ€§å¼ºï¼ŒæŸ¥è¯¢å…³ç³»æ–¹ä¾¿ã€‚</li><li><strong>NoSQL</strong>ï¼šé€šå¸¸ä¸å†…ç½®å…³è”ï¼Œéœ€è¦åº”ç”¨å±‚é€»è¾‘æˆ–åœ¨æ–‡æ¡£ä¸­<strong>å†—ä½™å­˜å‚¨</strong>ï¼ˆæŠŠç›¸å…³æ•°æ®ç›´æ¥åµŒå…¥ï¼‰ï¼Œç‰ºç‰²äº†ä¼˜é›…æ€§æ¢å–æŸ¥è¯¢é€Ÿåº¦ã€‚</li></ul><h4 id="æŸ¥è¯¢æ–¹å¼">æŸ¥è¯¢æ–¹å¼</h4><ul><li><strong>å…³ç³»å‹æ•°æ®åº“</strong>ï¼šç»Ÿä¸€ä½¿ç”¨ <strong>SQL</strong>ï¼Œè¯­æ³•æ ‡å‡†åŒ–ï¼Œè·¨æ•°æ®åº“è¿ç§»ç›¸å¯¹å®¹æ˜“ã€‚</li><li><strong>NoSQL</strong>ï¼šæ¯ç§æ•°æ®åº“éƒ½æœ‰è‡ªå·±çš„æŸ¥è¯¢æ–¹å¼ï¼Œä¾‹å¦‚ MongoDB ç”¨ JSON è¯­æ³•ï¼ŒRedis ç”¨å‘½ä»¤è¡ŒæŒ‡ä»¤ï¼Œç¼ºä¹ç»Ÿä¸€æ€§ã€‚</li></ul><h4 id="äº‹åŠ¡å¤„ç†">äº‹åŠ¡å¤„ç†</h4><ul><li><strong>å…³ç³»å‹æ•°æ®åº“</strong>ï¼šéµå®ˆ <strong>ACID</strong> åŸåˆ™ï¼ˆåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ï¼‰ï¼Œé€‚åˆéœ€è¦å¼ºä¸€è‡´æ€§çš„åœºæ™¯ï¼ˆå¦‚é“¶è¡Œè½¬è´¦ï¼‰ã€‚</li><li><strong>NoSQL</strong>ï¼šäº‹åŠ¡æ”¯æŒæœ‰é™ï¼Œæœ‰äº›åªä¿è¯â€œæœ€ç»ˆä¸€è‡´æ€§â€ï¼Œæ€§èƒ½å¥½ä½†ä¸€è‡´æ€§å¼±ã€‚</li></ul><h4 id="å­˜å‚¨æ–¹å¼ä¸æ‰©å±•æ€§">å­˜å‚¨æ–¹å¼ä¸æ‰©å±•æ€§</h4><ul><li><p>å…³ç³»å‹æ•°æ®åº“</p><p>ï¼š</p><ul><li>å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼ˆå¤§é‡ç£ç›˜ I/Oï¼Œé€Ÿåº¦ç›¸å¯¹æ…¢ï¼‰</li><li>æ‰©å±•ä»¥<strong>å‚ç›´æ‰©å±•</strong>ï¼ˆæå‡å•æœºæ€§èƒ½ï¼‰ä¸ºä¸»ï¼Œåšæ°´å¹³æ‰©å±•ï¼ˆåˆ†åº“åˆ†è¡¨ï¼‰ä¼šå¾ˆéº»çƒ¦ï¼Œå› ä¸ºè¡¨ä¹‹é—´å­˜åœ¨å¤æ‚å…³è”</li></ul></li><li><p>NoSQL</p><p>ï¼š</p><ul><li>ä¾èµ–å†…å­˜æ“ä½œï¼ˆé€Ÿåº¦å¿«ï¼‰</li><li>åŸç”Ÿæ”¯æŒ<strong>æ°´å¹³æ‰©å±•</strong>ï¼ˆæ•°æ®åˆ†å¸ƒåˆ°å¤šå°æœºå™¨ä¸Šï¼‰ï¼Œé€‚åˆå¤„ç†æµ·é‡æ•°æ®</li></ul></li></ul><table><thead><tr><th>ç‰¹æ€§</th><th>å…³ç³»å‹æ•°æ®åº“</th><th>éå…³ç³»å‹æ•°æ®åº“</th></tr></thead><tbody><tr><td>æ•°æ®ç»“æ„</td><td>è¡¨æ ¼ç»“æ„</td><td>é”®å€¼ã€æ–‡æ¡£ã€å›¾ç­‰</td></tr><tr><td>ç»“æ„çº¦æŸ</td><td>ä¸¥æ ¼ schema</td><td>çµæ´»ï¼Œæ— å›ºå®š schema</td></tr><tr><td>å…³è”å…³ç³»</td><td>å¤–é”®ç»´æŠ¤</td><td>åº”ç”¨å±‚æˆ–å†—ä½™æ•°æ®</td></tr><tr><td>æŸ¥è¯¢è¯­è¨€</td><td>SQLï¼ˆç»Ÿä¸€ï¼‰</td><td>å„å®¶ä¸åŒ</td></tr><tr><td>äº‹åŠ¡</td><td>ACID</td><td>æœ€ç»ˆä¸€è‡´æ€§ä¸ºä¸»</td></tr><tr><td>å­˜å‚¨</td><td>ç£ç›˜ I/O</td><td>å†…å­˜ä¼˜å…ˆ</td></tr><tr><td>æ‰©å±•æ€§</td><td>å‚ç›´æ‰©å±•ä¸ºä¸»</td><td>æ°´å¹³æ‰©å±•ä¸ºä¸»</td></tr></tbody></table><p>å…³ç³»å‹æ•°æ®åº“å°±åƒ<strong>ä¸¥æ ¼çš„ Excel è¡¨æ ¼</strong>ï¼Œè§„åˆ™æ¸…æ™°ã€å…³ç³»ä¸¥è°¨ï¼›<br>NoSQL å°±åƒ<strong>çµæ´»çš„ç¬”è®°æœ¬</strong>ï¼Œéšä¾¿å†™ã€éšä¾¿ç”»ï¼Œé€Ÿåº¦å¿«ã€æ‰©å±•æ€§å¥½ï¼Œä½†éœ€è¦ä½ è‡ªå·±ä¿è¯å†…å®¹çš„é€»è¾‘æ€§ã€‚</p><h3 id="1-4MySQLå®¢æˆ·ç«¯è¿æ¥">1.4MySQLå®¢æˆ·ç«¯è¿æ¥</h3><p>1.ä½¿ç”¨MySQLæä¾›çš„å®¢æˆ·ç«¯å‘½ä»¤è¡Œå·¥å…·</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1411-1024x437.png" alt="img"></p><p>2.ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„å‘½ä»¤è¡Œå·¥å…·æ‰§è¡ŒæŒ‡ä»¤</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> mysql  [-h 127.0.0.1]  [-P 3306]  -u root -p</span><br><span class="line">å‚æ•°ï¼š</span><br><span class="line"><span class="deletion">-h : MySQLæœåŠ¡æ‰€åœ¨çš„ä¸»æœºIP</span></span><br><span class="line"><span class="deletion">-P : MySQLæœåŠ¡ç«¯å£å·ï¼Œ é»˜è®¤3306</span></span><br><span class="line"><span class="deletion">-u : MySQLæ•°æ®åº“ç”¨æˆ·å</span></span><br><span class="line"><span class="deletion">-p ï¼š MySQLæ•°æ®åº“ç”¨æˆ·åå¯¹åº”çš„å¯†</span></span><br></pre></td></tr></table></figure><h2 id="2-SQL">2.SQL</h2><p>å…¨ç§° Structured Query Languageï¼Œç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ã€‚æ“ä½œå…³ç³»å‹æ•°æ®åº“çš„ç¼–ç¨‹è¯­è¨€ï¼Œå®šä¹‰äº†<br>ä¸€å¥—æ“ä½œå…³ç³»å‹æ•°æ®åº“ç»Ÿä¸€æ ‡å‡†ã€‚</p><h3 id="1-é€šç”¨è¯­æ³•åŠåˆ†ç±»">1.é€šç”¨è¯­æ³•åŠåˆ†ç±»</h3><ul><li>DDL: æ•°æ®å®šä¹‰è¯­è¨€ï¼Œç”¨æ¥å®šä¹‰æ•°æ®åº“å¯¹è±¡ï¼ˆæ•°æ®åº“ã€è¡¨ã€å­—æ®µï¼‰</li><li>DML: æ•°æ®æ“ä½œè¯­è¨€ï¼Œç”¨æ¥å¯¹æ•°æ®åº“è¡¨ä¸­çš„æ•°æ®è¿›è¡Œå¢åˆ æ”¹</li><li>DQL: æ•°æ®æŸ¥è¯¢è¯­è¨€ï¼Œç”¨æ¥æŸ¥è¯¢æ•°æ®åº“ä¸­è¡¨çš„è®°å½•</li><li>DCL: æ•°æ®æ§åˆ¶è¯­è¨€ï¼Œç”¨æ¥åˆ›å»ºæ•°æ®åº“ç”¨æˆ·ã€æ§åˆ¶æ•°æ®åº“çš„æ§åˆ¶æƒé™</li></ul><h3 id="2-DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰">2.DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰</h3><p>æ•°æ®å®šä¹‰è¯­è¨€</p><h4 id="æ•°æ®åº“æ“ä½œ">æ•°æ®åº“æ“ä½œ</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥è¯¢æ‰€æœ‰æ•°æ®åº“ï¼š</span><br><span class="line"><span class="keyword">SHOW</span> DATABASES;</span><br><span class="line">æŸ¥è¯¢å½“å‰æ•°æ®åº“ï¼š</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DATABASE</span>();</span><br><span class="line">åˆ›å»ºæ•°æ®åº“ï¼š</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> [ <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> ] æ•°æ®åº“å [ <span class="keyword">DEFAULT</span> CHARSET å­—ç¬¦é›†] [<span class="keyword">COLLATE</span> æ’åºè§„åˆ™ ];</span><br><span class="line">åˆ é™¤æ•°æ®åº“ï¼š</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">DATABASE</span> [ <span class="keyword">IF</span> <span class="keyword">EXISTS</span> ] æ•°æ®åº“å;</span><br><span class="line">ä½¿ç”¨æ•°æ®åº“ï¼š</span><br><span class="line">USE æ•°æ®åº“å;</span><br></pre></td></tr></table></figure><p>æ³¨æ„äº‹é¡¹</p><ul><li>UTF8å­—ç¬¦é›†é•¿åº¦ä¸º3å­—èŠ‚ï¼Œæœ‰äº›ç¬¦å·å 4å­—èŠ‚ï¼Œæ‰€ä»¥æ¨èç”¨utf8mb4å­—ç¬¦é›†</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1416-1024x832.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1417-1024x872.png" alt="img"></p><h4 id="è¡¨æ“ä½œ">è¡¨æ“ä½œ</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥è¯¢å½“å‰æ•°æ®åº“æ‰€æœ‰è¡¨ï¼š</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLES</span>;</span><br><span class="line">æŸ¥è¯¢è¡¨ç»“æ„ï¼š</span><br><span class="line"><span class="keyword">DESC</span> è¡¨å;</span><br><span class="line">æŸ¥è¯¢æŒ‡å®šè¡¨çš„å»ºè¡¨è¯­å¥ï¼š</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> è¡¨å;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºè¡¨ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE <span class="selector-tag">TABLE</span>  è¡¨å(</span><br><span class="line">å­—æ®µ<span class="number">1</span>  å­—æ®µ<span class="number">1</span>ç±»å‹ <span class="selector-attr">[ COMMENT  å­—æ®µ1æ³¨é‡Š ]</span>,</span><br><span class="line">å­—æ®µ<span class="number">2</span>  å­—æ®µ<span class="number">2</span>ç±»å‹ <span class="selector-attr">[COMMENT  å­—æ®µ2æ³¨é‡Š ]</span>,</span><br><span class="line">å­—æ®µ<span class="number">3</span>  å­—æ®µ<span class="number">3</span>ç±»å‹ <span class="selector-attr">[COMMENT  å­—æ®µ3æ³¨é‡Š ]</span>,</span><br><span class="line"> ......</span><br><span class="line">å­—æ®µn  å­—æ®µnç±»å‹ <span class="selector-attr">[COMMENT  å­—æ®µnæ³¨é‡Š ]</span> </span><br><span class="line">) <span class="selector-attr">[ COMMENT  è¡¨æ³¨é‡Š ]</span> ;</span><br></pre></td></tr></table></figure><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1418.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1419.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1420.png" alt="img"></p><p><strong>æœ€åä¸€ä¸ªå­—æ®µåé¢æ²¡æœ‰é€—å·</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">æ·»åŠ å­—æ®µï¼š</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å <span class="keyword">ADD</span> å­—æ®µå ç±»å‹(é•¿åº¦) [<span class="keyword">COMMENT</span> æ³¨é‡Š] [çº¦æŸ];</span><br><span class="line">ä¾‹ï¼š<span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp <span class="keyword">ADD</span> nickname <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">COMMENT</span> <span class="string">&#x27;æ˜µç§°&#x27;</span>;</span><br><span class="line">ä¿®æ”¹æ•°æ®ç±»å‹ï¼š</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å MODIFY å­—æ®µå æ–°æ•°æ®ç±»å‹(é•¿åº¦);</span><br><span class="line">ä¿®æ”¹å­—æ®µåå’Œå­—æ®µç±»å‹ï¼š</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å CHANGE æ—§å­—æ®µå æ–°å­—æ®µå ç±»å‹(é•¿åº¦) [<span class="keyword">COMMENT</span> æ³¨é‡Š] [çº¦æŸ];</span><br><span class="line">ä¾‹ï¼šå°†empè¡¨çš„nicknameå­—æ®µä¿®æ”¹ä¸ºusernameï¼Œç±»å‹ä¸º<span class="type">varchar</span>(<span class="number">30</span>)</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp CHANGE nickname username <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">COMMENT</span> <span class="string">&#x27;æ˜µç§°&#x27;</span>;</span><br><span class="line">åˆ é™¤å­—æ®µï¼š</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å <span class="keyword">DROP</span> å­—æ®µå;</span><br><span class="line">ä¿®æ”¹è¡¨åï¼š</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å <span class="keyword">RENAME</span> <span class="keyword">TO</span> æ–°è¡¨å</span><br><span class="line">åˆ é™¤è¡¨ï¼š</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> [<span class="keyword">IF</span> <span class="keyword">EXISTS</span>] è¡¨å;</span><br><span class="line">åˆ é™¤è¡¨ï¼Œå¹¶é‡æ–°åˆ›å»ºè¯¥è¡¨ï¼š</span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> è¡¨å;</span><br></pre></td></tr></table></figure><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1421-1024x157.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1423-1024x197.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1424.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1425.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1426.png" alt="img"></p><h3 id="3-æ•°æ®ç±»å‹">3.æ•°æ®ç±»å‹</h3><h4 id="æ•°å€¼ç±»å‹">æ•°å€¼ç±»å‹</h4><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1412-1024x352.png" alt="img"></p><p>å¦‚:<br>1). å¹´é¾„å­—æ®µ â€“ ä¸ä¼šå‡ºç°è´Ÿæ•°, è€Œä¸”äººçš„å¹´é¾„ä¸ä¼šå¤ªå¤§<br>age tinyint unsigned</p><p>2). åˆ†æ•° â€“ æ€»åˆ†100åˆ†, æœ€å¤šå‡ºç°ä¸€ä½å°æ•° score double(4,1)</p><h4 id="å­—ç¬¦ä¸²ç±»å‹">å­—ç¬¦ä¸²ç±»å‹</h4><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1413-1024x363.png" alt="img"></p><p>å¦‚ï¼š<br>1). ç”¨æˆ·å username ------&gt; é•¿åº¦ä¸å®š, æœ€é•¿ä¸ä¼šè¶…è¿‡50<br>username varchar(50)</p><p>2). æ€§åˆ« gender ---------&gt; å­˜å‚¨å€¼, ä¸æ˜¯ç”·,å°±æ˜¯å¥³ gender char(1) 3). æ‰‹æœºå· phone --------&gt; å›ºå®šé•¿åº¦ä¸º11 phone char(11)</p><h4 id="æ—¥æœŸæ—¶é—´ç±»å‹">æ—¥æœŸæ—¶é—´ç±»å‹</h4><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1414-1024x247.png" alt="img"></p><p>å¦‚:<br>1). ç”Ÿæ—¥å­—æ®µ birthday<br>birthday date</p><p>2). åˆ›å»ºæ—¶é—´ createtime createtime  datetime</p><h3 id="4-å›¾å½¢åŒ–ç•Œé¢å·¥å…·">4 å›¾å½¢åŒ–ç•Œé¢å·¥å…·</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1415-1024x285.png" alt="img"></p><h3 id="5-DMLï¼ˆæ•°æ®æ“ä½œè¯­è¨€ï¼‰">5.DMLï¼ˆæ•°æ®æ“ä½œè¯­è¨€ï¼‰</h3><h4 id="æ·»åŠ æ•°æ®">æ·»åŠ æ•°æ®</h4><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">æŒ‡å®šå­—æ®µï¼š</span><br><span class="line">INSERT <span class="keyword">INTO</span> è¡¨å (å­—æ®µå<span class="number">1</span>, å­—æ®µå<span class="number">2</span>, <span class="params">...</span>) VALUES (å€¼<span class="number">1</span>, å€¼<span class="number">2</span>, <span class="params">...</span>);</span><br><span class="line">å…¨éƒ¨å­—æ®µï¼š</span><br><span class="line">INSERT <span class="keyword">INTO</span> è¡¨å VALUES (å€¼<span class="number">1</span>, å€¼<span class="number">2</span>, <span class="params">...</span>);</span><br><span class="line">æ‰¹é‡æ·»åŠ æ•°æ®ï¼š</span><br><span class="line">INSERT <span class="keyword">INTO</span> è¡¨å (å­—æ®µå<span class="number">1</span>, å­—æ®µå<span class="number">2</span>, <span class="params">...</span>) VALUES (å€¼<span class="number">1</span>, å€¼<span class="number">2</span>, <span class="params">...</span>), (å€¼<span class="number">1</span>, å€¼<span class="number">2</span>, <span class="params">...</span>), (å€¼<span class="number">1</span>, å€¼<span class="number">2</span>, <span class="params">...</span>);</span><br><span class="line">INSERT <span class="keyword">INTO</span> è¡¨å VALUES (å€¼<span class="number">1</span>, å€¼<span class="number">2</span>, <span class="params">...</span>), (å€¼<span class="number">1</span>, å€¼<span class="number">2</span>, <span class="params">...</span>), (å€¼<span class="number">1</span>, å€¼<span class="number">2</span>, <span class="params">...</span>);</span><br></pre></td></tr></table></figure><p>æ³¨æ„äº‹é¡¹</p><ul><li>å­—ç¬¦ä¸²å’Œæ—¥æœŸç±»å‹æ•°æ®åº”è¯¥åŒ…å«åœ¨å¼•å·ä¸­</li><li>æ’å…¥çš„æ•°æ®å¤§å°åº”è¯¥åœ¨å­—æ®µçš„è§„å®šèŒƒå›´å†…</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1427.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1428-1024x491.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1429-1024x166.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1430-1024x178.png" alt="img"></p><h4 id="æ›´æ–°å’Œåˆ é™¤æ•°æ®">æ›´æ–°å’Œåˆ é™¤æ•°æ®</h4><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ä¿®æ”¹æ•°æ®ï¼š</span><br><span class="line"><span class="keyword">UPDATE</span> è¡¨å <span class="keyword">SET</span> å­—æ®µå<span class="number">1</span> = å€¼<span class="number">1</span>, å­—æ®µå<span class="number">2</span> = å€¼<span class="number">2</span>, ... [ <span class="keyword">WHERE</span> æ¡ä»¶ ];</span><br><span class="line">ä¾‹ï¼š</span><br><span class="line"><span class="keyword">UPDATE</span> emp <span class="keyword">SET</span> name = <span class="string">&#x27;Jack&#x27;</span> <span class="keyword">WHERE</span> id = <span class="number">1</span>;</span><br><span class="line">åˆ é™¤æ•°æ®ï¼š</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> è¡¨å [ <span class="keyword">WHERE</span> æ¡ä»¶ ];</span><br></pre></td></tr></table></figure><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1431.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1432.png" alt="img"></p><h3 id="6-DQL-æ•°æ®æŸ¥è¯¢è¯­è¨€ï¼‰">6 .DQL(æ•°æ®æŸ¥è¯¢è¯­è¨€ï¼‰</h3><p>è¯­æ³•ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">è¯­æ³•ï¼š</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">å­—æ®µåˆ—è¡¨</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">è¡¨åå­—æ®µ</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">æ¡ä»¶åˆ—è¡¨</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">åˆ†ç»„å­—æ®µåˆ—è¡¨</span><br><span class="line"><span class="keyword">HAVING</span></span><br><span class="line">åˆ†ç»„åçš„æ¡ä»¶åˆ—è¡¨</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">æ’åºå­—æ®µåˆ—è¡¨</span><br><span class="line"><span class="keyword">LIMIT</span></span><br><span class="line">åˆ†é¡µå‚æ•°</span><br></pre></td></tr></table></figure><h4 id="åŸºç¡€æŸ¥è¯¢">åŸºç¡€æŸ¥è¯¢</h4><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥è¯¢å¤šä¸ªå­—æ®µï¼š</span><br><span class="line"><span class="keyword">SELECT</span> å­—æ®µ<span class="number">1</span>, å­—æ®µ<span class="number">2</span>, å­—æ®µ<span class="number">3</span>, ... <span class="keyword">FROM</span> è¡¨å;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> è¡¨å;</span><br><span class="line">è®¾ç½®åˆ«åï¼š</span><br><span class="line"><span class="keyword">SELECT</span> å­—æ®µ<span class="number">1</span> [ <span class="keyword">AS</span> åˆ«å<span class="number">1</span> ], å­—æ®µ<span class="number">2</span> [ <span class="keyword">AS</span> åˆ«å<span class="number">2</span> ], å­—æ®µ<span class="number">3</span> [ <span class="keyword">AS</span> åˆ«å<span class="number">3</span> ], ... <span class="keyword">FROM</span> è¡¨å;</span><br><span class="line"><span class="keyword">SELECT</span> å­—æ®µ<span class="number">1</span> [ åˆ«å<span class="number">1</span> ], å­—æ®µ<span class="number">2</span> [ åˆ«å<span class="number">2</span> ], å­—æ®µ<span class="number">3</span> [ åˆ«å<span class="number">3</span> ], ... <span class="keyword">FROM</span> è¡¨å;</span><br><span class="line">å»é™¤é‡å¤è®°å½•ï¼š</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> å­—æ®µåˆ—è¡¨ <span class="keyword">FROM</span> è¡¨å;</span><br><span class="line">è½¬ä¹‰ï¼š</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> è¡¨å <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;/_å¼ ä¸‰&#x27;</span> ESCAPE <span class="string">&#x27;/&#x27;</span></span><br><span class="line">/ ä¹‹åçš„_ä¸ä½œä¸ºé€šé…ç¬¦</span><br></pre></td></tr></table></figure><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1433.png" alt="img"></p><h4 id="æ¡ä»¶æŸ¥è¯¢">æ¡ä»¶æŸ¥è¯¢</h4><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¯­æ³•ï¼š</span><br><span class="line"><span class="keyword">SELECT</span> å­—æ®µåˆ—è¡¨ <span class="keyword">FROM</span> è¡¨å <span class="keyword">WHERE</span> æ¡ä»¶åˆ—è¡¨;</span><br></pre></td></tr></table></figure><p>æ¡ä»¶ï¼š</p><table><thead><tr><th>æ¯”è¾ƒè¿ç®—ç¬¦</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>&gt;</td><td>å¤§äº</td></tr><tr><td>&gt;=</td><td>å¤§äºç­‰äº</td></tr><tr><td>&lt;</td><td>å°äº</td></tr><tr><td>&lt;=</td><td>å°äºç­‰äº</td></tr><tr><td>=</td><td>ç­‰äº</td></tr><tr><td>&lt;&gt; æˆ– !=</td><td>ä¸ç­‰äº</td></tr><tr><td>BETWEEN â€¦ AND â€¦</td><td>åœ¨æŸä¸ªèŒƒå›´å†…ï¼ˆå«æœ€å°ã€æœ€å¤§å€¼ï¼‰</td></tr><tr><td>IN(â€¦)</td><td>åœ¨inä¹‹åçš„åˆ—è¡¨ä¸­çš„å€¼ï¼Œå¤šé€‰ä¸€</td></tr><tr><td>LIKE å ä½ç¬¦</td><td>æ¨¡ç³ŠåŒ¹é…ï¼ˆ_åŒ¹é…å•ä¸ªå­—ç¬¦ï¼Œ%åŒ¹é…ä»»æ„ä¸ªå­—ç¬¦ï¼‰</td></tr><tr><td>IS NULL</td><td>æ˜¯NULL</td></tr></tbody></table><table><thead><tr><th>é€»è¾‘è¿ç®—ç¬¦</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>AND æˆ– &amp;&amp;</td><td>å¹¶ä¸”ï¼ˆå¤šä¸ªæ¡ä»¶åŒæ—¶æˆç«‹ï¼‰</td></tr><tr><td>OR æˆ– ||</td><td>æˆ–è€…ï¼ˆå¤šä¸ªæ¡ä»¶ä»»æ„ä¸€ä¸ªæˆç«‹ï¼‰</td></tr><tr><td>NOT æˆ– !</td><td>éï¼Œä¸æ˜¯</td></tr></tbody></table><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¹´é¾„ç­‰äº30</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> age = <span class="number">30</span>;</span><br><span class="line"><span class="comment">-- å¹´é¾„å°äº30</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> age &lt; <span class="number">30</span>;</span><br><span class="line"><span class="comment">-- å°äºç­‰äº</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> age &lt;= <span class="number">30</span>;</span><br><span class="line"><span class="comment">-- æ²¡æœ‰èº«ä»½è¯</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> idcard <span class="keyword">is</span> <span class="keyword">null</span> <span class="keyword">or</span> idcard = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="comment">-- æœ‰èº«ä»½è¯</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> idcard;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> idcard <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>;</span><br><span class="line"><span class="comment">-- ä¸ç­‰äº</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> age != <span class="number">30</span>;</span><br><span class="line"><span class="comment">-- å¹´é¾„åœ¨20åˆ°30ä¹‹é—´</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> age <span class="keyword">between</span> <span class="number">20</span> <span class="keyword">and</span> <span class="number">30</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> age &gt;= <span class="number">20</span> <span class="keyword">and</span> age &lt;= <span class="number">30</span>;</span><br><span class="line"><span class="comment">-- ä¸‹é¢è¯­å¥ä¸æŠ¥é”™ï¼Œä½†æŸ¥ä¸åˆ°ä»»ä½•ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> age <span class="keyword">between</span> <span class="number">30</span> <span class="keyword">and</span> <span class="number">20</span>;</span><br><span class="line"><span class="comment">-- æ€§åˆ«ä¸ºå¥³ä¸”å¹´é¾„å°äº30</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> age &lt; <span class="number">30</span> <span class="keyword">and</span> gender = <span class="string">&#x27;å¥³&#x27;</span>;</span><br><span class="line"><span class="comment">-- å¹´é¾„ç­‰äº25æˆ–30æˆ–35</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> age = <span class="number">25</span> <span class="keyword">or</span> age = <span class="number">30</span> <span class="keyword">or</span> age = <span class="number">35</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> age <span class="keyword">in</span> (<span class="number">25</span>, <span class="number">30</span>, <span class="number">35</span>);</span><br><span class="line"><span class="comment">-- å§“åä¸ºä¸¤ä¸ªå­—</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> <span class="type">name</span> <span class="keyword">like</span> <span class="string">&#x27;__&#x27;</span>;</span><br><span class="line"><span class="comment">-- èº«ä»½è¯æœ€åä¸ºX</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> idcard <span class="keyword">like</span> <span class="string">&#x27;%X&#x27;</span>;</span><br></pre></td></tr></table></figure><h4 id="èšåˆæŸ¥è¯¢ï¼ˆèšåˆå‡½æ•°ï¼‰">èšåˆæŸ¥è¯¢ï¼ˆèšåˆå‡½æ•°ï¼‰</h4><p>å¸¸è§èšåˆå‡½æ•°ï¼š</p><table><thead><tr><th>å‡½æ•°</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>count</td><td>ç»Ÿè®¡æ•°é‡</td></tr><tr><td>max</td><td>æœ€å¤§å€¼</td></tr><tr><td>min</td><td>æœ€å°å€¼</td></tr><tr><td>avg</td><td>å¹³å‡å€¼</td></tr><tr><td>sum</td><td>æ±‚å’Œ</td></tr></tbody></table><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¯­æ³•ï¼š</span><br><span class="line"><span class="keyword">SELECT</span> èšåˆå‡½æ•°(å­—æ®µåˆ—è¡¨) <span class="keyword">FROM</span> è¡¨å;</span><br><span class="line">ä¾‹ï¼š</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">count</span>(id) <span class="keyword">from</span> employee <span class="keyword">where</span> workaddress = <span class="string">&quot;å¹¿ä¸œçœ&quot;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1434.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1435.png" alt="img"></p><h4 id="åˆ†ç»„æŸ¥è¯¢">åˆ†ç»„æŸ¥è¯¢</h4><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¯­æ³•ï¼š</span><br><span class="line"><span class="keyword">SELECT</span> å­—æ®µåˆ—è¡¨ <span class="keyword">FROM</span> è¡¨å [ <span class="keyword">WHERE</span> æ¡ä»¶ ] <span class="keyword">GROUP</span> <span class="keyword">BY</span> åˆ†ç»„å­—æ®µå [ <span class="keyword">HAVING</span> åˆ†ç»„åçš„è¿‡æ»¤æ¡ä»¶ ];</span><br></pre></td></tr></table></figure><p>where å’Œ having çš„åŒºåˆ«ï¼š</p><ul><li>æ‰§è¡Œæ—¶æœºä¸åŒï¼šwhereæ˜¯åˆ†ç»„ä¹‹å‰è¿›è¡Œè¿‡æ»¤ï¼Œä¸æ»¡è¶³whereæ¡ä»¶ä¸å‚ä¸åˆ†ç»„ï¼›havingæ˜¯åˆ†ç»„åå¯¹ç»“æœè¿›è¡Œè¿‡æ»¤ã€‚</li><li>åˆ¤æ–­æ¡ä»¶ä¸åŒï¼šwhereä¸èƒ½å¯¹èšåˆå‡½æ•°è¿›è¡Œåˆ¤æ–­ï¼Œè€Œhavingå¯ä»¥ã€‚</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1436.png" alt="img"></p><p>ä¾‹å­ï¼š</p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-- æ ¹æ®æ€§åˆ«åˆ†ç»„ï¼Œç»Ÿè®¡ç”·æ€§å’Œå¥³æ€§æ•°é‡ï¼ˆåªæ˜¾ç¤ºåˆ†ç»„æ•°é‡ï¼Œä¸æ˜¾ç¤ºå“ªä¸ªæ˜¯ç”·å“ªä¸ªæ˜¯å¥³ï¼‰</span><br><span class="line"><span class="keyword">select</span> count<span class="comment">(*) from employee group by gender;</span></span><br><span class="line"><span class="comment">-- æ ¹æ®æ€§åˆ«åˆ†ç»„ï¼Œç»Ÿè®¡ç”·æ€§å’Œå¥³æ€§æ•°é‡</span></span><br><span class="line"><span class="comment">select gender, count(*)</span> <span class="keyword">from</span> employee <span class="keyword">group</span> <span class="keyword">by</span> gender<span class="punctuation">;</span></span><br><span class="line">-- æ ¹æ®æ€§åˆ«åˆ†ç»„ï¼Œç»Ÿè®¡ç”·æ€§å’Œå¥³æ€§çš„å¹³å‡å¹´é¾„</span><br><span class="line"><span class="keyword">select</span> gender, avg(age) <span class="keyword">from</span> employee <span class="keyword">group</span> <span class="keyword">by</span> gender<span class="punctuation">;</span></span><br><span class="line">-- å¹´é¾„å°äº<span class="number">45</span>ï¼Œå¹¶æ ¹æ®å·¥ä½œåœ°å€åˆ†ç»„</span><br><span class="line"><span class="keyword">select</span> workaddress, count<span class="comment">(*) from employee where age &lt; 45 group by workaddress;</span></span><br><span class="line"><span class="comment">-- å¹´é¾„å°äº45ï¼Œå¹¶æ ¹æ®å·¥ä½œåœ°å€åˆ†ç»„ï¼Œè·å–å‘˜å·¥æ•°é‡å¤§äºç­‰äº3çš„å·¥ä½œåœ°å€</span></span><br><span class="line"><span class="comment">select workaddress, count(*)</span> address_count <span class="keyword">from</span> employee <span class="keyword">where</span> age &lt; <span class="number">45</span> <span class="keyword">group</span> <span class="keyword">by</span> workaddress having address_count &gt;= <span class="number">3</span><span class="punctuation">;</span></span><br></pre></td></tr></table></figure><h4 id="æ’åºæŸ¥è¯¢">æ’åºæŸ¥è¯¢</h4><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¯­æ³•ï¼š</span><br><span class="line"><span class="keyword">SELECT</span> å­—æ®µåˆ—è¡¨ <span class="keyword">FROM</span> è¡¨å <span class="keyword">ORDER</span> <span class="keyword">BY</span> å­—æ®µ<span class="number">1</span> æ’åºæ–¹å¼<span class="number">1</span>, å­—æ®µ<span class="number">2</span> æ’åºæ–¹å¼<span class="number">2</span>;</span><br></pre></td></tr></table></figure><p>æ’åºæ–¹å¼ï¼š</p><ul><li>ASC: å‡åºï¼ˆé»˜è®¤ï¼‰</li><li>DESC: é™åº</li></ul><p>ä¾‹å­ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ ¹æ®å¹´é¾„å‡åºæ’åº</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employee <span class="keyword">ORDER</span> <span class="keyword">BY</span> age <span class="keyword">ASC</span>;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employee <span class="keyword">ORDER</span> <span class="keyword">BY</span> age;</span><br><span class="line"><span class="comment">-- ä¸¤å­—æ®µæ’åºï¼Œæ ¹æ®å¹´é¾„å‡åºæ’åºï¼Œå…¥èŒæ—¶é—´é™åºæ’åº</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employee <span class="keyword">ORDER</span> <span class="keyword">BY</span> age <span class="keyword">ASC</span>, entrydate <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure><p>æ³¨æ„äº‹é¡¹</p><p>å¦‚æœæ˜¯å¤šå­—æ®µæ’åºï¼Œå½“ç¬¬ä¸€ä¸ªå­—æ®µå€¼ç›¸åŒæ—¶ï¼Œæ‰ä¼šæ ¹æ®ç¬¬äºŒä¸ªå­—æ®µè¿›è¡Œæ’åº</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1437.png" alt="img"></p><h4 id="åˆ†é¡µæŸ¥è¯¢">åˆ†é¡µæŸ¥è¯¢</h4><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¯­æ³•ï¼š</span><br><span class="line"><span class="keyword">SELECT</span> å­—æ®µåˆ—è¡¨ <span class="keyword">FROM</span> è¡¨å <span class="keyword">LIMIT</span> èµ·å§‹ç´¢å¼•, æŸ¥è¯¢è®°å½•æ•°;</span><br></pre></td></tr></table></figure><p>ä¾‹å­ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢ç¬¬ä¸€é¡µæ•°æ®ï¼Œå±•ç¤º10æ¡</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employee <span class="keyword">LIMIT</span> <span class="number">0</span>, <span class="number">10</span>;</span><br><span class="line"><span class="comment">-- æŸ¥è¯¢ç¬¬äºŒé¡µ</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employee <span class="keyword">LIMIT</span> <span class="number">10</span>, <span class="number">10</span>;</span><br></pre></td></tr></table></figure><p>æ³¨æ„äº‹é¡¹</p><ul><li>èµ·å§‹ç´¢å¼•ä»0å¼€å§‹ï¼Œèµ·å§‹ç´¢å¼• = ï¼ˆæŸ¥è¯¢é¡µç  - 1ï¼‰ * æ¯é¡µæ˜¾ç¤ºè®°å½•æ•°</li><li>åˆ†é¡µæŸ¥è¯¢æ˜¯æ•°æ®åº“çš„æ–¹è¨€ï¼Œä¸åŒæ•°æ®åº“æœ‰ä¸åŒå®ç°ï¼ŒMySQLæ˜¯LIMIT</li><li>å¦‚æœæŸ¥è¯¢çš„æ˜¯ç¬¬ä¸€é¡µæ•°æ®ï¼Œèµ·å§‹ç´¢å¼•å¯ä»¥çœç•¥ï¼Œç›´æ¥ç®€å†™ LIMIT 10</li></ul><h4 id="æ¡ˆä¾‹">æ¡ˆä¾‹</h4><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1438.png" alt="img"></p><h4 id="DQLæ‰§è¡Œé¡ºåº">DQLæ‰§è¡Œé¡ºåº</h4><p>FROM -&gt; WHERE -&gt; GROUP BY -&gt; SELECT -&gt; ORDER BY -&gt; LIMIT</p><h3 id="7-DCL-æ•°æ®æ§åˆ¶è¯­è¨€">7.DCL(æ•°æ®æ§åˆ¶è¯­è¨€)</h3><p>ç”¨æ¥ç®¡ç†æ•°æ®åº“ç”¨æˆ·ã€æ§åˆ¶æ•°æ®åº“çš„è®¿é—®æƒé™ã€‚</p><h4 id="ç®¡ç†ç”¨æˆ·">ç®¡ç†ç”¨æˆ·</h4><p>æŸ¥è¯¢ç”¨æˆ·ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">USE mysql;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line">åˆ›å»ºç”¨æˆ·:</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;ç”¨æˆ·å&#x27;</span>@<span class="string">&#x27;ä¸»æœºå&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;å¯†ç &#x27;</span>;</span><br><span class="line">ä¿®æ”¹ç”¨æˆ·å¯†ç ï¼š</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;ç”¨æˆ·å&#x27;</span>@<span class="string">&#x27;ä¸»æœºå&#x27;</span> IDENTIFIED <span class="keyword">WITH</span> mysql_native_password <span class="keyword">BY</span> <span class="string">&#x27;æ–°å¯†ç &#x27;</span>;</span><br><span class="line">åˆ é™¤ç”¨æˆ·ï¼š</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">&#x27;ç”¨æˆ·å&#x27;</span>@<span class="string">&#x27;ä¸»æœºå&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ä¾‹å­ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»ºç”¨æˆ·testï¼Œåªèƒ½åœ¨å½“å‰ä¸»æœºlocalhostè®¿é—®</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;test&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"><span class="comment">-- åˆ›å»ºç”¨æˆ·testï¼Œèƒ½åœ¨ä»»æ„ä¸»æœºè®¿é—®</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;test&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;test&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"><span class="comment">-- ä¿®æ”¹å¯†ç </span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> <span class="string">&#x27;test&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> identified <span class="keyword">with</span> mysql_native_password <span class="keyword">by</span> <span class="string">&#x27;1234&#x27;</span>;</span><br><span class="line"><span class="comment">-- åˆ é™¤ç”¨æˆ·</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> <span class="string">&#x27;test&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æ³¨æ„äº‹é¡¹</p><ul><li>ä¸»æœºåå¯ä»¥ä½¿ç”¨ % é€šé…</li></ul><h4 id="æƒé™æ§åˆ¶">æƒé™æ§åˆ¶</h4><p>å¸¸ç”¨æƒé™ï¼š</p><table><thead><tr><th>æƒé™</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ALL, ALL PRIVILEGES</td><td>æ‰€æœ‰æƒé™</td></tr><tr><td>SELECT</td><td>æŸ¥è¯¢æ•°æ®</td></tr><tr><td>INSERT</td><td>æ’å…¥æ•°æ®</td></tr><tr><td>UPDATE</td><td>ä¿®æ”¹æ•°æ®</td></tr><tr><td>DELETE</td><td>åˆ é™¤æ•°æ®</td></tr><tr><td>ALTER</td><td>ä¿®æ”¹è¡¨</td></tr><tr><td>DROP</td><td>åˆ é™¤æ•°æ®åº“/è¡¨/è§†å›¾</td></tr><tr><td>CREATE</td><td>åˆ›å»ºæ•°æ®åº“/è¡¨</td></tr></tbody></table><p>ä¸Šè¿°åªæ˜¯ç®€å•ç½—åˆ—äº†å¸¸è§çš„å‡ ç§æƒé™æè¿°ï¼Œå…¶ä»–æƒé™æè¿°åŠå«ä¹‰ï¼Œå¯ä»¥ç›´æ¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥è¯¢æƒé™ï¼š</span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;ç”¨æˆ·å&#x27;</span>@<span class="string">&#x27;ä¸»æœºå&#x27;</span>;</span><br><span class="line">æˆäºˆæƒé™ï¼š</span><br><span class="line"><span class="keyword">GRANT</span> æƒé™åˆ—è¡¨ <span class="keyword">ON</span> æ•°æ®åº“å.è¡¨å <span class="keyword">TO</span> <span class="string">&#x27;ç”¨æˆ·å&#x27;</span>@<span class="string">&#x27;ä¸»æœºå&#x27;</span>;</span><br><span class="line">æ’¤é”€æƒé™ï¼š</span><br><span class="line"><span class="keyword">REVOKE</span> æƒé™åˆ—è¡¨ <span class="keyword">ON</span> æ•°æ®åº“å.è¡¨å <span class="keyword">FROM</span> <span class="string">&#x27;ç”¨æˆ·å&#x27;</span>@<span class="string">&#x27;ä¸»æœºå&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æ³¨æ„äº‹é¡¹</p><ul><li>å¤šä¸ªæƒé™ç”¨é€—å·åˆ†éš”</li><li>æˆæƒæ—¶ï¼Œæ•°æ®åº“åå’Œè¡¨åå¯ä»¥ç”¨ * è¿›è¡Œé€šé…ï¼Œä»£è¡¨æ‰€æœ‰</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1439.png" alt="img"></p><h2 id="3-å‡½æ•°">3.å‡½æ•°</h2><ul><li>å­—ç¬¦ä¸²å‡½æ•°</li><li>æ•°å€¼å‡½æ•°</li><li>æ—¥æœŸå‡½æ•°</li><li>æµç¨‹å‡½æ•°</li></ul><h3 id="1-å­—ç¬¦ä¸²å‡½æ•°">1.å­—ç¬¦ä¸²å‡½æ•°</h3><p>å¸¸ç”¨å‡½æ•°ï¼š</p><table><thead><tr><th>å‡½æ•°</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>CONCAT(s1, s2, â€¦, sn)</td><td>å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå°†s1, s2, â€¦, snæ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²</td></tr><tr><td>LOWER(str)</td><td>å°†å­—ç¬¦ä¸²å…¨éƒ¨è½¬ä¸ºå°å†™</td></tr><tr><td>UPPER(str)</td><td>å°†å­—ç¬¦ä¸²å…¨éƒ¨è½¬ä¸ºå¤§å†™</td></tr><tr><td>LPAD(str, n, pad)</td><td>å·¦å¡«å……ï¼Œç”¨å­—ç¬¦ä¸²padå¯¹strçš„å·¦è¾¹è¿›è¡Œå¡«å……ï¼Œè¾¾åˆ°nä¸ªå­—ç¬¦ä¸²é•¿åº¦</td></tr><tr><td>RPAD(str, n, pad)</td><td>å³å¡«å……ï¼Œç”¨å­—ç¬¦ä¸²padå¯¹strçš„å³è¾¹è¿›è¡Œå¡«å……ï¼Œè¾¾åˆ°nä¸ªå­—ç¬¦ä¸²é•¿åº¦</td></tr><tr><td>TRIM(str)</td><td>å»æ‰å­—ç¬¦ä¸²å¤´éƒ¨å’Œå°¾éƒ¨çš„ç©ºæ ¼</td></tr><tr><td>SUBSTRING(str, start, len)</td><td>è¿”å›ä»å­—ç¬¦ä¸²strä»startä½ç½®èµ·çš„lenä¸ªé•¿åº¦çš„å­—ç¬¦ä¸²</td></tr><tr><td>REPLACE(column, source, replace)</td><td>æ›¿æ¢å­—ç¬¦ä¸²</td></tr></tbody></table><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ‹¼æ¥</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;Hello&#x27;</span>, <span class="string">&#x27;World&#x27;</span>);</span><br><span class="line"><span class="comment">-- å°å†™</span></span><br><span class="line"><span class="keyword">SELECT</span> LOWER(<span class="string">&#x27;Hello&#x27;</span>);</span><br><span class="line"><span class="comment">-- å¤§å†™</span></span><br><span class="line"><span class="keyword">SELECT</span> UPPER(<span class="string">&#x27;Hello&#x27;</span>);</span><br><span class="line"><span class="comment">-- å·¦å¡«å……</span></span><br><span class="line"><span class="keyword">SELECT</span> LPAD(<span class="string">&#x27;01&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line"><span class="comment">-- å³å¡«å……</span></span><br><span class="line"><span class="keyword">SELECT</span> RPAD(<span class="string">&#x27;01&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line"><span class="comment">-- å»é™¤ç©ºæ ¼</span></span><br><span class="line"><span class="keyword">SELECT</span> TRIM(<span class="string">&#x27; Hello World &#x27;</span>);</span><br><span class="line"><span class="comment">-- åˆ‡ç‰‡ï¼ˆèµ·å§‹ç´¢å¼•ä¸º1ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> SUBSTRING(<span class="string">&#x27;Hello World&#x27;</span>, <span class="number">1</span>, <span class="number">5</span>);</span><br></pre></td></tr></table></figure><h3 id="2-æ•°å€¼å‡½æ•°">2.æ•°å€¼å‡½æ•°</h3><p>å¸¸è§å‡½æ•°ï¼š</p><table><thead><tr><th>å‡½æ•°</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>CEIL(x)</td><td>å‘ä¸Šå–æ•´</td></tr><tr><td>FLOOR(x)</td><td>å‘ä¸‹å–æ•´</td></tr><tr><td>MOD(x, y)</td><td>è¿”å›x/yçš„æ¨¡</td></tr><tr><td>RAND()</td><td>è¿”å›0~1å†…çš„éšæœºæ•°</td></tr><tr><td>ROUND(x, y)</td><td>æ±‚å‚æ•°xçš„å››èˆäº”å…¥å€¼ï¼Œä¿ç•™yä½å°æ•°</td></tr></tbody></table><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1440.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1441.png" alt="img"></p><h3 id="3-æ—¥æœŸå‡½æ•°">3.æ—¥æœŸå‡½æ•°</h3><p>å¸¸ç”¨å‡½æ•°ï¼š</p><table><thead><tr><th>å‡½æ•°</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>CURDATE()</td><td>è¿”å›å½“å‰æ—¥æœŸ</td></tr><tr><td>CURTIME()</td><td>è¿”å›å½“å‰æ—¶é—´</td></tr><tr><td>NOW()</td><td>è¿”å›å½“å‰æ—¥æœŸå’Œæ—¶é—´</td></tr><tr><td>YEAR(date)</td><td>è·å–æŒ‡å®šdateçš„å¹´ä»½</td></tr><tr><td>MONTH(date)</td><td>è·å–æŒ‡å®šdateçš„æœˆä»½</td></tr><tr><td>DAY(date)</td><td>è·å–æŒ‡å®šdateçš„æ—¥æœŸ</td></tr><tr><td>DATE_ADD(date, INTERVAL expr type)</td><td>è¿”å›ä¸€ä¸ªæ—¥æœŸ/æ—¶é—´å€¼åŠ ä¸Šä¸€ä¸ªæ—¶é—´é—´éš”expråçš„æ—¶é—´å€¼</td></tr><tr><td>DATEDIFF(date1, date2)</td><td>è¿”å›èµ·å§‹æ—¶é—´date1å’Œç»“æŸæ—¶é—´date2ä¹‹é—´çš„å¤©æ•°</td></tr></tbody></table><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1442-519x1024.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1443.png" alt="img"></p><h3 id="4-æµç¨‹å‡½æ•°">4.æµç¨‹å‡½æ•°</h3><p>å¸¸ç”¨å‡½æ•°ï¼š</p><table><thead><tr><th>å‡½æ•°</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>IF(value, t, f)</td><td>å¦‚æœvalueä¸ºtrueï¼Œåˆ™è¿”å›tï¼Œå¦åˆ™è¿”å›f</td></tr><tr><td>IFNULL(value1, value2)</td><td>å¦‚æœvalue1ä¸ä¸ºç©ºï¼Œè¿”å›value1ï¼Œå¦åˆ™è¿”å›value2</td></tr><tr><td>CASE WHEN [ val1 ] THEN [ res1 ] â€¦ ELSE [ default ] END</td><td>å¦‚æœval1ä¸ºtrueï¼Œè¿”å›res1ï¼Œâ€¦ å¦åˆ™è¿”å›defaulté»˜è®¤å€¼</td></tr><tr><td>CASE [ expr ] WHEN [ val1 ] THEN [ res1 ] â€¦ ELSE [ default ] END</td><td>å¦‚æœexprçš„å€¼ç­‰äºval1ï¼Œè¿”å›res1ï¼Œâ€¦ å¦åˆ™è¿”å›defaulté»˜è®¤å€¼</td></tr></tbody></table><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1444.png" alt="img"></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">select</span></span><br><span class="line"> id,</span><br><span class="line"> <span class="type">name</span>,</span><br><span class="line"> (<span class="keyword">case</span> <span class="keyword">when</span> math &gt;= <span class="number">85</span> <span class="keyword">then</span> <span class="string">&#x27;ä¼˜ç§€&#x27;</span> <span class="keyword">when</span> math &gt;=<span class="number">60</span> <span class="keyword">then</span> <span class="string">&#x27;åŠæ ¼&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;ä¸åŠæ ¼&#x27;</span> <span class="keyword">end</span> ) </span><br><span class="line"><span class="string">&#x27;æ•°å­¦&#x27;</span>,</span><br><span class="line"> <span class="keyword">end</span> ) <span class="string">&#x27;è‹±è¯­&#x27;</span>,</span><br><span class="line"> <span class="keyword">end</span> ) <span class="string">&#x27;è¯­æ–‡&#x27;</span></span><br><span class="line"> (<span class="keyword">case</span> <span class="keyword">when</span> english &gt;= <span class="number">85</span> <span class="keyword">then</span> <span class="string">&#x27;ä¼˜ç§€&#x27;</span> <span class="keyword">when</span> english &gt;=<span class="number">60</span> <span class="keyword">then</span> <span class="string">&#x27;åŠæ ¼&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;ä¸åŠæ ¼&#x27;</span> </span><br><span class="line">(<span class="keyword">case</span> <span class="keyword">when</span> chinese &gt;= <span class="number">85</span> <span class="keyword">then</span> <span class="string">&#x27;ä¼˜ç§€&#x27;</span> <span class="keyword">when</span> chinese &gt;=<span class="number">60</span> <span class="keyword">then</span> <span class="string">&#x27;åŠæ ¼&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;ä¸åŠæ ¼&#x27;</span> </span><br><span class="line"><span class="keyword">from</span> score;</span><br></pre></td></tr></table></figure><h2 id="4-çº¦æŸ">4.çº¦æŸ</h2><p>æ¦‚å¿µï¼šçº¦æŸæ˜¯ä½œç”¨äºè¡¨ä¸­å­—æ®µä¸Šçš„è§„åˆ™ï¼Œç”¨äºé™åˆ¶å­˜å‚¨åœ¨è¡¨ä¸­çš„æ•°æ®ã€‚<br>ç›®çš„ï¼šä¿è¯æ•°æ®åº“ä¸­æ•°æ®çš„æ­£ç¡®ã€æœ‰æ•ˆæ€§å’Œå®Œæ•´æ€§ã€‚</p><p>åˆ†ç±»ï¼š</p><table><thead><tr><th>çº¦æŸ</th><th>æè¿°</th><th>å…³é”®å­—</th></tr></thead><tbody><tr><td>éç©ºçº¦æŸ</td><td>é™åˆ¶è¯¥å­—æ®µçš„æ•°æ®ä¸èƒ½ä¸ºnull</td><td>NOT NULL</td></tr><tr><td>å”¯ä¸€çº¦æŸ</td><td>ä¿è¯è¯¥å­—æ®µçš„æ‰€æœ‰æ•°æ®éƒ½æ˜¯å”¯ä¸€ã€ä¸é‡å¤çš„</td><td>UNIQUE</td></tr><tr><td>ä¸»é”®çº¦æŸ</td><td>ä¸»é”®æ˜¯ä¸€è¡Œæ•°æ®çš„å”¯ä¸€æ ‡è¯†ï¼Œè¦æ±‚éç©ºä¸”å”¯ä¸€</td><td>PRIMARY KEY</td></tr><tr><td>é»˜è®¤çº¦æŸ</td><td>ä¿å­˜æ•°æ®æ—¶ï¼Œå¦‚æœæœªæŒ‡å®šè¯¥å­—æ®µçš„å€¼ï¼Œåˆ™é‡‡ç”¨é»˜è®¤å€¼</td><td>DEFAULT</td></tr><tr><td>æ£€æŸ¥çº¦æŸï¼ˆ8.0.1ç‰ˆæœ¬åï¼‰</td><td>ä¿è¯å­—æ®µå€¼æ»¡è¶³æŸä¸€ä¸ªæ¡ä»¶</td><td>CHECK</td></tr><tr><td>å¤–é”®çº¦æŸ</td><td>ç”¨æ¥è®©ä¸¤å¼ å›¾çš„æ•°æ®ä¹‹é—´å»ºç«‹è¿æ¥ï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§</td><td>FOREIGN KEY</td></tr></tbody></table><p>çº¦æŸæ˜¯ä½œç”¨äºè¡¨ä¸­å­—æ®µä¸Šçš„ï¼Œå¯ä»¥å†åˆ›å»ºè¡¨/ä¿®æ”¹è¡¨çš„æ—¶å€™æ·»åŠ çº¦æŸã€‚</p><h3 id="1-å¸¸ç”¨çº¦æŸ">1.å¸¸ç”¨çº¦æŸ</h3><table><thead><tr><th>çº¦æŸæ¡ä»¶</th><th>å…³é”®å­—</th></tr></thead><tbody><tr><td>ä¸»é”®</td><td>PRIMARY KEY</td></tr><tr><td>è‡ªåŠ¨å¢é•¿</td><td>AUTO_INCREMENT</td></tr><tr><td>ä¸ä¸ºç©º</td><td>NOT NULL</td></tr><tr><td>å”¯ä¸€</td><td>UNIQUE</td></tr><tr><td>é€»è¾‘æ¡ä»¶</td><td>CHECK</td></tr><tr><td>é»˜è®¤å€¼</td><td>DEFAULT</td></tr></tbody></table><p>ä¾‹å­ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span>(</span><br><span class="line">id <span class="type">int</span> <span class="keyword">primary key</span> auto_increment,</span><br><span class="line"><span class="type">name</span> <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">unique</span>,</span><br><span class="line">age <span class="type">int</span> <span class="keyword">check</span>(age &gt; <span class="number">0</span> <span class="keyword">and</span> age &lt; <span class="number">120</span>),</span><br><span class="line">status <span class="type">char</span>(<span class="number">1</span>) <span class="keyword">default</span> <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">gender <span class="type">char</span>(<span class="number">1</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="2-å¤–é”®çº¦æŸ">2.å¤–é”®çº¦æŸ</h3><p>æ·»åŠ å¤–é”®ï¼š</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> è¡¨å(</span><br><span class="line">å­—æ®µå å­—æ®µç±»å‹,</span><br><span class="line">...</span><br><span class="line">[CONSTRAINT] [å¤–é”®åç§°] <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(å¤–é”®å­—æ®µå) <span class="keyword">REFERENCES</span> ä¸»è¡¨(ä¸»è¡¨åˆ—å)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å <span class="keyword">ADD</span> CONSTRAINT å¤–é”®åç§° <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (å¤–é”®å­—æ®µå) <span class="keyword">REFERENCES</span> ä¸»è¡¨(ä¸»è¡¨åˆ—å);</span><br><span class="line"></span><br><span class="line">-- ä¾‹å­</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> emp <span class="keyword">add</span> constraint fk_emp_dept_id <span class="keyword">foreign</span> <span class="keyword">key</span>(dept_id) <span class="keyword">references</span> dept(id);</span><br></pre></td></tr></table></figure><p>åˆ é™¤å¤–é”®ï¼š</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> å¤–é”®å;</span><br></pre></td></tr></table></figure><p>åˆ é™¤/æ›´æ–°è¡Œä¸º</p><table><thead><tr><th>è¡Œä¸º</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>NO ACTION</td><td>å½“åœ¨çˆ¶è¡¨ä¸­åˆ é™¤/æ›´æ–°å¯¹åº”è®°å½•æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥è¯¥è®°å½•æ˜¯å¦æœ‰å¯¹åº”å¤–é”®ï¼Œå¦‚æœæœ‰åˆ™ä¸å…è®¸åˆ é™¤/æ›´æ–°ï¼ˆä¸RESTRICTä¸€è‡´ï¼‰</td></tr><tr><td>RESTRICT</td><td>å½“åœ¨çˆ¶è¡¨ä¸­åˆ é™¤/æ›´æ–°å¯¹åº”è®°å½•æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥è¯¥è®°å½•æ˜¯å¦æœ‰å¯¹åº”å¤–é”®ï¼Œå¦‚æœæœ‰åˆ™ä¸å…è®¸åˆ é™¤/æ›´æ–°ï¼ˆä¸NO ACTIONä¸€è‡´ï¼‰</td></tr><tr><td>CASCADE</td><td>å½“åœ¨çˆ¶è¡¨ä¸­åˆ é™¤/æ›´æ–°å¯¹åº”è®°å½•æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥è¯¥è®°å½•æ˜¯å¦æœ‰å¯¹åº”å¤–é”®ï¼Œå¦‚æœæœ‰åˆ™ä¹Ÿåˆ é™¤/æ›´æ–°å¤–é”®åœ¨å­è¡¨ä¸­çš„è®°å½•</td></tr><tr><td>SET NULL</td><td>å½“åœ¨çˆ¶è¡¨ä¸­åˆ é™¤/æ›´æ–°å¯¹åº”è®°å½•æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥è¯¥è®°å½•æ˜¯å¦æœ‰å¯¹åº”å¤–é”®ï¼Œå¦‚æœæœ‰åˆ™è®¾ç½®å­è¡¨ä¸­è¯¥å¤–é”®å€¼ä¸ºnullï¼ˆè¦æ±‚è¯¥å¤–é”®å…è®¸ä¸ºnullï¼‰</td></tr><tr><td>SET DEFAULT</td><td>çˆ¶è¡¨æœ‰å˜æ›´æ—¶ï¼Œå­è¡¨å°†å¤–é”®è®¾ä¸ºä¸€ä¸ªé»˜è®¤å€¼ï¼ˆInnodbä¸æ”¯æŒï¼‰</td></tr></tbody></table><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ›´æ”¹åˆ é™¤/æ›´æ–°è¡Œä¸ºï¼š</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> å¤–é”®åç§° <span class="keyword">FOREIGN KEY</span> (å¤–é”®å­—æ®µ) <span class="keyword">REFERENCES</span> ä¸»è¡¨å(ä¸»è¡¨å­—æ®µå) <span class="keyword">ON</span> <span class="keyword">UPDATE</span> è¡Œä¸º <span class="keyword">ON</span> <span class="keyword">DELETE</span> è¡Œä¸º;</span><br></pre></td></tr></table></figure><h2 id="5-å¤šè¡¨æŸ¥è¯¢">5.å¤šè¡¨æŸ¥è¯¢</h2><h3 id="1-å¤šè¡¨å…³ç³»">1.å¤šè¡¨å…³ç³»</h3><ul><li>ä¸€å¯¹ä¸€</li><li>ä¸€å¯¹å¤šï¼ˆå¤šå¯¹ä¸€ï¼‰</li><li>å¤šå¯¹å¤š</li></ul><h4 id="ä¸€å¯¹å¤š">ä¸€å¯¹å¤š</h4><p>æ¡ˆä¾‹ï¼šéƒ¨é—¨ä¸å‘˜å·¥<br>å…³ç³»ï¼šä¸€ä¸ªéƒ¨é—¨å¯¹åº”å¤šä¸ªå‘˜å·¥ï¼Œä¸€ä¸ªå‘˜å·¥å¯¹åº”ä¸€ä¸ªéƒ¨é—¨<br>å®ç°ï¼šåœ¨å¤šçš„ä¸€æ–¹å»ºç«‹å¤–é”®ï¼ŒæŒ‡å‘ä¸€çš„ä¸€æ–¹çš„ä¸»é”®</p><h4 id="å¤šå¯¹å¤š">å¤šå¯¹å¤š</h4><p>æ¡ˆä¾‹ï¼šå­¦ç”Ÿä¸è¯¾ç¨‹<br>å…³ç³»ï¼šä¸€ä¸ªå­¦ç”Ÿå¯ä»¥é€‰å¤šé—¨è¯¾ç¨‹ï¼Œä¸€é—¨è¯¾ç¨‹ä¹Ÿå¯ä»¥ä¾›å¤šä¸ªå­¦ç”Ÿé€‰ä¿®<br>å®ç°ï¼šå»ºç«‹ç¬¬ä¸‰å¼ ä¸­é—´è¡¨ï¼Œä¸­é—´è¡¨è‡³å°‘åŒ…å«ä¸¤ä¸ªå¤–é”®ï¼Œåˆ†åˆ«å…³è”ä¸¤æ–¹ä¸»é”®</p><h4 id="ä¸€å¯¹ä¸€">ä¸€å¯¹ä¸€</h4><p>æ¡ˆä¾‹ï¼šç”¨æˆ·ä¸ç”¨æˆ·è¯¦æƒ…<br>å…³ç³»ï¼šä¸€å¯¹ä¸€å…³ç³»ï¼Œå¤šç”¨äºå•è¡¨æ‹†åˆ†ï¼Œå°†ä¸€å¼ è¡¨çš„åŸºç¡€å­—æ®µæ”¾åœ¨ä¸€å¼ è¡¨ä¸­ï¼Œå…¶ä»–è¯¦æƒ…å­—æ®µæ”¾åœ¨å¦ä¸€å¼ è¡¨ä¸­ï¼Œä»¥æå‡æ“ä½œæ•ˆç‡<br>å®ç°ï¼šåœ¨ä»»æ„ä¸€æ–¹åŠ å…¥å¤–é”®ï¼Œå…³è”å¦å¤–ä¸€æ–¹çš„ä¸»é”®ï¼Œå¹¶ä¸”è®¾ç½®å¤–é”®ä¸ºå”¯ä¸€çš„ï¼ˆUNIQUEï¼‰</p><h3 id="2-æŸ¥è¯¢">2.æŸ¥è¯¢</h3><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åˆå¹¶æŸ¥è¯¢ï¼ˆç¬›å¡å°”ç§¯ï¼Œä¼šå±•ç¤ºæ‰€æœ‰ç»„åˆç»“æœï¼‰ï¼š</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee, dept;</span><br></pre></td></tr></table></figure><blockquote><p>ç¬›å¡å°”ç§¯ï¼šä¸¤ä¸ªé›†åˆAé›†åˆå’ŒBé›†åˆçš„æ‰€æœ‰ç»„åˆæƒ…å†µï¼ˆåœ¨å¤šè¡¨æŸ¥è¯¢æ—¶ï¼Œéœ€è¦æ¶ˆé™¤æ— æ•ˆçš„ç¬›å¡å°”ç§¯ï¼‰</p></blockquote><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ¶ˆé™¤æ— æ•ˆç¬›å¡å°”ç§¯ï¼š</span><br><span class="line">select * <span class="keyword">from</span> employee, dept <span class="keyword">where</span> employee.dept = dept.<span class="built_in">id</span>;</span><br></pre></td></tr></table></figure><h3 id="3-å†…è¿æ¥æŸ¥è¯¢">3.å†…è¿æ¥æŸ¥è¯¢</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1445.png" alt="img"></p><p>å†…è¿æ¥æŸ¥è¯¢çš„æ˜¯ä¸¤å¼ è¡¨äº¤é›†çš„éƒ¨åˆ†</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">éšå¼å†…è¿æ¥ï¼š</span><br><span class="line"><span class="keyword">SELECT</span> å­—æ®µåˆ—è¡¨ <span class="keyword">FROM</span> è¡¨<span class="number">1</span>, è¡¨<span class="number">2</span> <span class="keyword">WHERE</span> æ¡ä»¶ ...;</span><br><span class="line">æ˜¾å¼å†…è¿æ¥ï¼š</span><br><span class="line"><span class="keyword">SELECT</span> å­—æ®µåˆ—è¡¨ <span class="keyword">FROM</span> è¡¨<span class="number">1</span> [ <span class="keyword">INNER</span> ] <span class="keyword">JOIN</span> è¡¨<span class="number">2</span> <span class="keyword">ON</span> è¿æ¥æ¡ä»¶ ...;</span><br></pre></td></tr></table></figure><p>æ˜¾å¼æ€§èƒ½æ¯”éšå¼é«˜</p><p>ä¾‹å­ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢å‘˜å·¥å§“åï¼ŒåŠå…³è”çš„éƒ¨é—¨çš„åç§°</span></span><br><span class="line"><span class="comment">-- éšå¼</span></span><br><span class="line"><span class="keyword">select</span> e.name, d.name <span class="keyword">from</span> employee <span class="keyword">as</span> e, dept <span class="keyword">as</span> d <span class="keyword">where</span> e.dept = d.id;</span><br><span class="line"><span class="comment">-- æ˜¾å¼</span></span><br><span class="line"><span class="keyword">select</span> e.name, d.name <span class="keyword">from</span> employee <span class="keyword">as</span> e <span class="keyword">inner</span> <span class="keyword">join</span> dept <span class="keyword">as</span> d <span class="keyword">on</span> e.dept = d.id;</span><br></pre></td></tr></table></figure><h3 id="4-å¤–è¿æ¥æŸ¥è¯¢">4.å¤–è¿æ¥æŸ¥è¯¢</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1446.png" alt="img"></p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å·¦å¤–è¿æ¥ï¼š</span><br><span class="line">æŸ¥è¯¢å·¦è¡¨æ‰€æœ‰æ•°æ®ï¼Œä»¥åŠä¸¤å¼ è¡¨äº¤é›†éƒ¨åˆ†æ•°æ®</span><br><span class="line"><span class="keyword">SELECT</span> å­—æ®µåˆ—è¡¨ <span class="keyword">FROM</span> è¡¨<span class="number">1</span> <span class="keyword">LEFT</span> [ <span class="keyword">OUTER</span> ] <span class="keyword">JOIN</span> è¡¨<span class="number">2</span> <span class="keyword">ON</span> æ¡ä»¶ ...;</span><br><span class="line">ç›¸å½“äºæŸ¥è¯¢è¡¨1çš„æ‰€æœ‰æ•°æ®ï¼ŒåŒ…å«è¡¨1å’Œè¡¨2äº¤é›†éƒ¨åˆ†æ•°æ®</span><br><span class="line">å³å¤–è¿æ¥ï¼š</span><br><span class="line">æŸ¥è¯¢å³è¡¨æ‰€æœ‰æ•°æ®ï¼Œä»¥åŠä¸¤å¼ è¡¨äº¤é›†éƒ¨åˆ†æ•°æ®</span><br><span class="line"><span class="keyword">SELECT</span> å­—æ®µåˆ—è¡¨ <span class="keyword">FROM</span> è¡¨<span class="number">1</span> <span class="keyword">RIGHT</span> [ <span class="keyword">OUTER</span> ] <span class="keyword">JOIN</span> è¡¨<span class="number">2</span> <span class="keyword">ON</span> æ¡ä»¶ ...;</span><br></pre></td></tr></table></figure><p>ä¾‹å­ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- å·¦</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">e</span>.*, d.name <span class="keyword">from</span> employee <span class="keyword">as</span> <span class="built_in">e</span> <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> dept <span class="keyword">as</span> d <span class="keyword">on</span> <span class="built_in">e</span>.dept = d.id;</span><br><span class="line"><span class="keyword">select</span> d.name, <span class="built_in">e</span>.* <span class="keyword">from</span> dept d <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> emp <span class="built_in">e</span> <span class="keyword">on</span> <span class="built_in">e</span>.dept = d.id;  -- è¿™æ¡è¯­å¥ä¸ä¸‹é¢çš„è¯­å¥æ•ˆæœä¸€æ ·</span><br><span class="line">-- å³</span><br><span class="line"><span class="keyword">select</span> d.name, <span class="built_in">e</span>.* <span class="keyword">from</span> employee <span class="keyword">as</span> <span class="built_in">e</span> <span class="keyword">right</span> <span class="keyword">outer</span> <span class="keyword">join</span> dept <span class="keyword">as</span> d <span class="keyword">on</span> <span class="built_in">e</span>.dept = d.id;</span><br></pre></td></tr></table></figure><p>å·¦è¿æ¥å¯ä»¥æŸ¥è¯¢åˆ°æ²¡æœ‰deptçš„employeeï¼Œå³è¿æ¥å¯ä»¥æŸ¥è¯¢åˆ°æ²¡æœ‰employeeçš„dept</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1447.png" alt="img"></p><h3 id="5-è‡ªè¿æ¥æŸ¥è¯¢">5.è‡ªè¿æ¥æŸ¥è¯¢</h3><p>å½“å‰è¡¨ä¸è‡ªèº«çš„è¿æ¥æŸ¥è¯¢ï¼Œè‡ªè¿æ¥å¿…é¡»ä½¿ç”¨è¡¨åˆ«å</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¯­æ³•ï¼š</span><br><span class="line"><span class="selector-tag">SELECT</span> å­—æ®µåˆ—è¡¨ <span class="selector-tag">FROM</span> è¡¨<span class="selector-tag">A</span> åˆ«å<span class="selector-tag">A</span> JOIN è¡¨<span class="selector-tag">A</span> åˆ«å<span class="selector-tag">B</span> ON æ¡ä»¶ ...;</span><br></pre></td></tr></table></figure><p>è‡ªè¿æ¥æŸ¥è¯¢ï¼Œå¯ä»¥æ˜¯å†…è¿æ¥æŸ¥è¯¢ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤–è¿æ¥æŸ¥è¯¢</p><p>ä¾‹å­ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢å‘˜å·¥åŠå…¶æ‰€å±é¢†å¯¼çš„åå­—</span></span><br><span class="line"><span class="keyword">select</span> a.name, b.name <span class="keyword">from</span> employee a, employee b <span class="keyword">where</span> a.manager = b.id;</span><br><span class="line"><span class="comment">-- æ²¡æœ‰é¢†å¯¼çš„ä¹ŸæŸ¥è¯¢å‡ºæ¥</span></span><br><span class="line"><span class="keyword">select</span> a.name, b.name <span class="keyword">from</span> employee a <span class="keyword">left join</span> employee b <span class="keyword">on</span> a.manager = b.id;</span><br></pre></td></tr></table></figure><p>æ³¨æ„äº‹é¡¹:</p><ul><li>åœ¨è‡ªè¿æ¥æŸ¥è¯¢ä¸­ï¼Œå¿…é¡»è¦ä¸ºè¡¨èµ·åˆ«åï¼Œè¦ä¸ç„¶æˆ‘ä»¬ä¸æ¸…æ¥šæ‰€æŒ‡å®šçš„æ¡ä»¶ã€è¿”å›çš„å­—æ®µï¼Œåˆ°åº•æ˜¯å“ªä¸€å¼ è¡¨çš„å­—æ®µã€‚</li></ul><h3 id="6-è”åˆæŸ¥è¯¢-union-union-all">6.è”åˆæŸ¥è¯¢ union, union all</h3><p>æŠŠå¤šæ¬¡æŸ¥è¯¢çš„ç»“æœåˆå¹¶ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„æŸ¥è¯¢é›†</p><p>è¯­æ³•ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">SELECT</span> å­—æ®µåˆ—è¡¨ <span class="selector-tag">FROM</span> è¡¨<span class="selector-tag">A</span> ...</span><br><span class="line">UNION <span class="selector-attr">[ALL]</span></span><br><span class="line"><span class="selector-tag">SELECT</span> å­—æ®µåˆ—è¡¨ <span class="selector-tag">FROM</span> è¡¨<span class="selector-tag">B</span> ...</span><br></pre></td></tr></table></figure><p>æ³¨æ„äº‹é¡¹</p><ul><li>UNION ALL ä¼šæœ‰é‡å¤ç»“æœï¼ŒUNION ä¸ä¼š</li><li>è”åˆæŸ¥è¯¢æ¯”ä½¿ç”¨oræ•ˆç‡é«˜ï¼Œä¸ä¼šä½¿ç´¢å¼•å¤±æ•ˆ</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1448.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1449.png" alt="img"></p><h3 id="7-å­æŸ¥è¯¢">7.å­æŸ¥è¯¢</h3><p>SQLè¯­å¥ä¸­åµŒå¥—SELECTè¯­å¥ï¼Œç§°è°“åµŒå¥—æŸ¥è¯¢ï¼Œåˆç§°å­æŸ¥è¯¢ã€‚<br><code>SELECT * FROM t1 WHERE column1 = ( SELECT column1 FROM t2);</code><br><strong>å­æŸ¥è¯¢å¤–éƒ¨çš„è¯­å¥å¯ä»¥æ˜¯ INSERT / UPDATE / DELETE / SELECT çš„ä»»ä½•ä¸€ä¸ª</strong></p><p>æ ¹æ®å­æŸ¥è¯¢ç»“æœå¯ä»¥åˆ†ä¸ºï¼š</p><ul><li>æ ‡é‡å­æŸ¥è¯¢ï¼ˆå­æŸ¥è¯¢ç»“æœä¸ºå•ä¸ªå€¼ï¼‰</li><li>åˆ—å­æŸ¥è¯¢ï¼ˆå­æŸ¥è¯¢ç»“æœä¸ºä¸€åˆ—ï¼‰</li><li>è¡Œå­æŸ¥è¯¢ï¼ˆå­æŸ¥è¯¢ç»“æœä¸ºä¸€è¡Œï¼‰</li><li>è¡¨å­æŸ¥è¯¢ï¼ˆå­æŸ¥è¯¢ç»“æœä¸ºå¤šè¡Œå¤šåˆ—ï¼‰</li></ul><p>æ ¹æ®å­æŸ¥è¯¢ä½ç½®å¯åˆ†ä¸ºï¼š</p><ul><li>WHERE ä¹‹å</li><li>FROM ä¹‹å</li><li>SELECT ä¹‹å</li></ul><h4 id="æ ‡é‡å­æŸ¥è¯¢">æ ‡é‡å­æŸ¥è¯¢</h4><p>å­æŸ¥è¯¢è¿”å›çš„ç»“æœæ˜¯å•ä¸ªå€¼ï¼ˆæ•°å­—ã€å­—ç¬¦ä¸²ã€æ—¥æœŸç­‰ï¼‰ã€‚<br>å¸¸ç”¨æ“ä½œç¬¦ï¼š- &lt; &gt; &gt; &gt;= &lt; &lt;=</p><p>ä¾‹å­ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢é”€å”®éƒ¨æ‰€æœ‰å‘˜å·¥</span></span><br><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span> dept <span class="keyword">where</span> <span class="type">name</span> = <span class="string">&#x27;é”€å”®éƒ¨&#x27;</span>;</span><br><span class="line"><span class="comment">-- æ ¹æ®é”€å”®éƒ¨éƒ¨é—¨IDï¼ŒæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> dept = <span class="number">4</span>;</span><br><span class="line"><span class="comment">-- åˆå¹¶ï¼ˆå­æŸ¥è¯¢ï¼‰</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> dept = (<span class="keyword">select</span> id <span class="keyword">from</span> dept <span class="keyword">where</span> <span class="type">name</span> = <span class="string">&#x27;é”€å”®éƒ¨&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥è¯¢xxxå…¥èŒä¹‹åçš„å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> entrydate &gt; (<span class="keyword">select</span> entrydate <span class="keyword">from</span> employee <span class="keyword">where</span> <span class="type">name</span> = <span class="string">&#x27;xxx&#x27;</span>);</span><br></pre></td></tr></table></figure><h4 id="åˆ—å­æŸ¥è¯¢">åˆ—å­æŸ¥è¯¢</h4><p>è¿”å›çš„ç»“æœæ˜¯ä¸€åˆ—ï¼ˆå¯ä»¥æ˜¯å¤šè¡Œï¼‰ã€‚</p><p>å¸¸ç”¨æ“ä½œç¬¦ï¼š</p><table><thead><tr><th>æ“ä½œç¬¦</th><th>æè¿°</th></tr></thead><tbody><tr><td>IN</td><td>åœ¨æŒ‡å®šçš„é›†åˆèŒƒå›´å†…ï¼Œå¤šé€‰ä¸€</td></tr><tr><td>NOT IN</td><td>ä¸åœ¨æŒ‡å®šçš„é›†åˆèŒƒå›´å†…</td></tr><tr><td>ANY</td><td>å­æŸ¥è¯¢è¿”å›åˆ—è¡¨ä¸­ï¼Œæœ‰ä»»æ„ä¸€ä¸ªæ»¡è¶³å³å¯</td></tr><tr><td>SOME</td><td>ä¸ANYç­‰åŒï¼Œä½¿ç”¨SOMEçš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨ANY</td></tr><tr><td>ALL</td><td>å­æŸ¥è¯¢è¿”å›åˆ—è¡¨çš„æ‰€æœ‰å€¼éƒ½å¿…é¡»æ»¡è¶³</td></tr></tbody></table><p>ä¾‹å­ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢é”€å”®éƒ¨å’Œå¸‚åœºéƒ¨çš„æ‰€æœ‰å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> dept <span class="keyword">in</span> (<span class="keyword">select</span> id <span class="keyword">from</span> dept <span class="keyword">where</span> <span class="type">name</span> = <span class="string">&#x27;é”€å”®éƒ¨&#x27;</span> <span class="keyword">or</span> <span class="type">name</span> = <span class="string">&#x27;å¸‚åœºéƒ¨&#x27;</span>);</span><br><span class="line"><span class="comment">-- æŸ¥è¯¢æ¯”è´¢åŠ¡éƒ¨æ‰€æœ‰äººå·¥èµ„éƒ½é«˜çš„å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> salary &gt; <span class="keyword">all</span>(<span class="keyword">select</span> salary <span class="keyword">from</span> employee <span class="keyword">where</span> dept = (<span class="keyword">select</span> id <span class="keyword">from</span> dept <span class="keyword">where</span> <span class="type">name</span> = <span class="string">&#x27;è´¢åŠ¡éƒ¨&#x27;</span>));</span><br><span class="line"><span class="comment">-- æŸ¥è¯¢æ¯”ç ”å‘éƒ¨ä»»æ„ä¸€äººå·¥èµ„é«˜çš„å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> salary &gt; <span class="keyword">any</span> (<span class="keyword">select</span> salary <span class="keyword">from</span> employee <span class="keyword">where</span> dept = (<span class="keyword">select</span> id <span class="keyword">from</span> dept <span class="keyword">where</span> <span class="type">name</span> = <span class="string">&#x27;ç ”å‘éƒ¨&#x27;</span>));</span><br></pre></td></tr></table></figure><h4 id="è¡Œå­æŸ¥è¯¢">è¡Œå­æŸ¥è¯¢</h4><p>è¿”å›çš„ç»“æœæ˜¯ä¸€è¡Œï¼ˆå¯ä»¥æ˜¯å¤šåˆ—ï¼‰ã€‚<br>å¸¸ç”¨æ“ä½œç¬¦ï¼š=, &lt;, &gt;, IN, NOT IN</p><p>ä¾‹å­ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢ä¸xxxçš„è–ªèµ„åŠç›´å±é¢†å¯¼ç›¸åŒçš„å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> (salary, manager) = (<span class="number">12500</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> (salary, manager) = (<span class="keyword">select</span> salary, manager <span class="keyword">from</span> employee <span class="keyword">where</span> <span class="type">name</span> = <span class="string">&#x27;xxx&#x27;</span>);</span><br></pre></td></tr></table></figure><h4 id="è¡¨å­æŸ¥è¯¢">è¡¨å­æŸ¥è¯¢</h4><p>è¿”å›çš„ç»“æœæ˜¯å¤šè¡Œå¤šåˆ—<br>å¸¸ç”¨æ“ä½œç¬¦ï¼šIN</p><p>ä¾‹å­ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- æŸ¥è¯¢ä¸xxx1ï¼Œxxx2çš„èŒä½å’Œè–ªèµ„ç›¸åŒçš„å‘˜å·¥</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> (job, salary) <span class="keyword">in</span> (<span class="keyword">select</span> job, salary <span class="keyword">from</span> employee <span class="keyword">where</span> name = <span class="string">&#x27;xxx1&#x27;</span> <span class="keyword">or</span> name = <span class="string">&#x27;xxx2&#x27;</span>);</span><br><span class="line">-- æŸ¥è¯¢å…¥èŒæ—¥æœŸæ˜¯2006-01-01ä¹‹åçš„å‘˜å·¥ï¼ŒåŠå…¶éƒ¨é—¨ä¿¡æ¯</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">e</span>.*, d.* <span class="keyword">from</span> (<span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> entrydate &gt; <span class="string">&#x27;2006-01-01&#x27;</span>) <span class="keyword">as</span> <span class="built_in">e</span> <span class="keyword">left</span> <span class="keyword">join</span> dept <span class="keyword">as</span> d <span class="keyword">on</span> <span class="built_in">e</span>.dept = d.id;</span><br></pre></td></tr></table></figure><h3 id="8-æ¡ˆä¾‹">8.æ¡ˆä¾‹</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1450-1024x952.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1451.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1452.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1453.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1454-936x1024.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1455.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1456.png" alt="img"></p><h2 id="6-äº‹åŠ¡">6.äº‹åŠ¡</h2><p>äº‹åŠ¡æ˜¯ä¸€ç»„æ“ä½œçš„é›†åˆï¼Œäº‹åŠ¡ä¼šæŠŠæ‰€æœ‰æ“ä½œä½œä¸ºä¸€ä¸ªæ•´ä½“ä¸€èµ·å‘ç³»ç»Ÿæäº¤æˆ–æ’¤é”€æ“ä½œè¯·æ±‚ï¼Œå³è¿™äº›æ“ä½œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚</p><p>åŸºæœ¬æ“ä½œï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1. æŸ¥è¯¢å¼ ä¸‰è´¦æˆ·ä½™é¢</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> account <span class="keyword">where</span> <span class="type">name</span> = <span class="string">&#x27;å¼ ä¸‰&#x27;</span>;</span><br><span class="line"><span class="comment">-- 2. å°†å¼ ä¸‰è´¦æˆ·ä½™é¢-1000</span></span><br><span class="line"><span class="keyword">update</span> account <span class="keyword">set</span> <span class="type">money</span> = <span class="type">money</span> - <span class="number">1000</span> <span class="keyword">where</span> <span class="type">name</span> = <span class="string">&#x27;å¼ ä¸‰&#x27;</span>;</span><br><span class="line"><span class="comment">-- æ­¤è¯­å¥å‡ºé”™åå¼ ä¸‰é’±å‡å°‘ä½†æ˜¯æå››é’±æ²¡æœ‰å¢åŠ </span></span><br><span class="line">æ¨¡æ‹Ÿ<span class="keyword">sql</span>è¯­å¥é”™è¯¯</span><br><span class="line"><span class="comment">-- 3. å°†æå››è´¦æˆ·ä½™é¢+1000</span></span><br><span class="line"><span class="keyword">update</span> account <span class="keyword">set</span> <span class="type">money</span> = <span class="type">money</span> + <span class="number">1000</span> <span class="keyword">where</span> <span class="type">name</span> = <span class="string">&#x27;æå››&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥çœ‹äº‹åŠ¡æäº¤æ–¹å¼</span></span><br><span class="line"><span class="keyword">SELECT</span> @@AUTOCOMMIT;</span><br><span class="line"><span class="comment">-- è®¾ç½®äº‹åŠ¡æäº¤æ–¹å¼ï¼Œ1ä¸ºè‡ªåŠ¨æäº¤ï¼Œ0ä¸ºæ‰‹åŠ¨æäº¤ï¼Œè¯¥è®¾ç½®åªå¯¹å½“å‰ä¼šè¯æœ‰æ•ˆ</span></span><br><span class="line"><span class="keyword">SET</span> @@AUTOCOMMIT = <span class="number">0</span>;</span><br><span class="line"><span class="comment">-- æäº¤äº‹åŠ¡</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="comment">-- å›æ»šäº‹åŠ¡</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è®¾ç½®æ‰‹åŠ¨æäº¤åä¸Šé¢ä»£ç æ”¹ä¸ºï¼š</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> account <span class="keyword">where</span> <span class="type">name</span> = <span class="string">&#x27;å¼ ä¸‰&#x27;</span>;</span><br><span class="line"><span class="keyword">update</span> account <span class="keyword">set</span> <span class="type">money</span> = <span class="type">money</span> - <span class="number">1000</span> <span class="keyword">where</span> <span class="type">name</span> = <span class="string">&#x27;å¼ ä¸‰&#x27;</span>;</span><br><span class="line"><span class="keyword">update</span> account <span class="keyword">set</span> <span class="type">money</span> = <span class="type">money</span> + <span class="number">1000</span> <span class="keyword">where</span> <span class="type">name</span> = <span class="string">&#x27;æå››&#x27;</span>;</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure><p>æ“ä½œæ–¹å¼äºŒï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">å¼€å¯äº‹åŠ¡ï¼š</span><br><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span> æˆ– <span class="keyword">BEGIN</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line">æäº¤äº‹åŠ¡ï¼š</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line">å›æ»šäº‹åŠ¡ï¼š</span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> account <span class="keyword">where</span> <span class="type">name</span> = <span class="string">&#x27;å¼ ä¸‰&#x27;</span>;</span><br><span class="line"><span class="keyword">update</span> account <span class="keyword">set</span> <span class="type">money</span> = <span class="type">money</span> - <span class="number">1000</span> <span class="keyword">where</span> <span class="type">name</span> = <span class="string">&#x27;å¼ ä¸‰&#x27;</span>;</span><br><span class="line"><span class="keyword">update</span> account <span class="keyword">set</span> <span class="type">money</span> = <span class="type">money</span> + <span class="number">1000</span> <span class="keyword">where</span> <span class="type">name</span> = <span class="string">&#x27;æå››&#x27;</span>;</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure><h3 id="å››å¤§ç‰¹æ€§ACID">å››å¤§ç‰¹æ€§ACID</h3><ul><li>åŸå­æ€§(Atomicity)ï¼šäº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°æ“ä½œå•å…ƒï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥</li><li>ä¸€è‡´æ€§(Consistency)ï¼šäº‹åŠ¡å®Œæˆæ—¶ï¼Œå¿…é¡»ä½¿æ‰€æœ‰æ•°æ®éƒ½ä¿æŒä¸€è‡´çŠ¶æ€</li><li>éš”ç¦»æ€§(Isolation)ï¼šæ•°æ®åº“ç³»ç»Ÿæä¾›çš„éš”ç¦»æœºåˆ¶ï¼Œä¿è¯äº‹åŠ¡åœ¨ä¸å—å¤–éƒ¨å¹¶å‘æ“ä½œå½±å“çš„ç‹¬ç«‹ç¯å¢ƒä¸‹è¿è¡Œ</li><li>æŒä¹…æ€§(Durability)ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤æˆ–å›æ»šï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…çš„</li></ul><h3 id="å¹¶å‘äº‹åŠ¡">å¹¶å‘äº‹åŠ¡</h3><table><thead><tr><th>é—®é¢˜</th><th>æè¿°</th></tr></thead><tbody><tr><td>è„è¯»</td><td>ä¸€ä¸ªäº‹åŠ¡è¯»åˆ°å¦ä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æäº¤çš„æ•°æ®</td></tr><tr><td>ä¸å¯é‡å¤è¯»</td><td>ä¸€ä¸ªäº‹åŠ¡å…ˆåè¯»å–åŒä¸€æ¡è®°å½•ï¼Œä½†ä¸¤æ¬¡è¯»å–çš„æ•°æ®ä¸åŒ</td></tr><tr><td>å¹»è¯»</td><td>ä¸€ä¸ªäº‹åŠ¡æŒ‰ç…§æ¡ä»¶æŸ¥è¯¢æ•°æ®æ—¶ï¼Œæ²¡æœ‰å¯¹åº”çš„æ•°æ®è¡Œï¼Œä½†æ˜¯å†æ’å…¥æ•°æ®æ—¶ï¼Œåˆå‘ç°è¿™è¡Œæ•°æ®å·²ç»å­˜åœ¨</td></tr></tbody></table><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1457.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1458.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/06/image-1459.png" alt="img"></p><p>å¹¶å‘äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼š</p><table><thead><tr><th>éš”ç¦»çº§åˆ«</th><th>è„è¯»</th><th>ä¸å¯é‡å¤è¯»</th><th>å¹»è¯»</th></tr></thead><tbody><tr><td>Read uncommitted</td><td>âˆš</td><td>âˆš</td><td>âˆš</td></tr><tr><td>Read committed</td><td>Ã—</td><td>âˆš</td><td>âˆš</td></tr><tr><td>Repeatable Read(é»˜è®¤)</td><td>Ã—</td><td>Ã—</td><td>âˆš</td></tr><tr><td>Serializable</td><td>Ã—</td><td>Ã—</td><td>Ã—</td></tr></tbody></table><ul><li>âˆšè¡¨ç¤ºåœ¨å½“å‰éš”ç¦»çº§åˆ«ä¸‹è¯¥é—®é¢˜ä¼šå‡ºç°</li><li>Serializable æ€§èƒ½æœ€ä½ï¼›Read uncommitted æ€§èƒ½æœ€é«˜ï¼Œæ•°æ®å®‰å…¨æ€§æœ€å·®</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥çœ‹äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼š</span><br><span class="line"><span class="keyword">SELECT</span> @@TRANSACTION_ISOLATION;</span><br><span class="line">è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼š</span><br><span class="line"><span class="keyword">SET</span> [ <span class="keyword">SESSION</span> | <span class="keyword">GLOBAL</span> ] <span class="keyword">TRANSACTION</span> <span class="keyword">ISOLATION</span> <span class="keyword">LEVEL</span> &#123;<span class="keyword">READ</span> <span class="keyword">UNCOMMITTED</span> | <span class="keyword">READ</span> <span class="keyword">COMMITTED</span> | <span class="keyword">REPEATABLE</span> <span class="keyword">READ</span> | <span class="keyword">SERIALIZABLE</span> &#125;;</span><br><span class="line"><span class="keyword">SESSION</span> æ˜¯ä¼šè¯çº§åˆ«ï¼Œè¡¨ç¤ºåªé’ˆå¯¹å½“å‰ä¼šè¯æœ‰æ•ˆï¼Œ<span class="keyword">GLOBAL</span> è¡¨ç¤ºå¯¹æ‰€æœ‰ä¼šè¯æœ‰æ•ˆ</span><br></pre></td></tr></table></figure><h2 id="åŸºç¡€ç¯‡å®Œç»“">åŸºç¡€ç¯‡å®Œç»“</h2>]]></content>
    
    
    <summary type="html">é»‘é©¬ç¨‹åºå‘˜mysqlä¸‰éƒ¨æ›²ä¸Šç¯‡-åŸºç¡€ç¯‡</summary>
    
    
    
    <category term="mysql" scheme="https://itgeqian.github.io/categories/mysql/"/>
    
    
    <category term="mysql" scheme="https://itgeqian.github.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>å‰ç«¯webå¤ä¹ </title>
    <link href="https://itgeqian.github.io/posts/4.html"/>
    <id>https://itgeqian.github.io/posts/4.html</id>
    <published>2025-05-21T04:19:03.000Z</published>
    <updated>2025-05-27T11:12:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¤‡è€ƒè“æ¡¥æ¯æ—¶å†™çš„å¤ä¹ æ–‡æ¡£ï¼ˆç›®å‰æœ‰html+css+JavaScript+Ajaxï¼‰<br>å…±263é¡µ</p><p><a href="https://www.legendkiller.xyz/wp-content/uploads/2025/05/web%E5%A4%8D%E4%B9%A0.pdf">https://www.legendkiller.xyz/wp-content/uploads/2025/05/webå¤ä¹ .pdf</a></p>]]></content>
    
    
    <summary type="html">å‰ç«¯webå¤ä¹  html+css+JavaScript ä¸‰ä»¶å¥—  å®Œç»“</summary>
    
    
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://itgeqian.github.io/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    <category term="å‰ç«¯" scheme="https://itgeqian.github.io/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="å‰ç«¯" scheme="https://itgeqian.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>å…­çº§ç”Ÿè¯</title>
    <link href="https://itgeqian.github.io/posts/3.html"/>
    <id>https://itgeqian.github.io/posts/3.html</id>
    <published>2025-05-20T04:19:03.000Z</published>
    <updated>2025-05-27T11:12:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>radiate æ•£å‘</p><p>herd å…½ç¾¤</p><p>immerse æ²‰æµ¸äº</p><p>consent åŒæ„</p><p>manipulate æš—ä¸­æ“ä½œ</p><p>relentless ä¸åœçš„ï¼ŒæŒç»­çš„</p><p>fluctuate æ³¢åŠ¨</p><p>exotic å¼‚å›½é£æƒ…çš„ï¼Œå¤–æ¥çš„</p><p>census å®˜æ–¹ç»Ÿè®¡</p><p>simultaneous åŒæ­¥çš„ï¼ŒåŒæ—¶å­˜åœ¨</p><p>hinge é“°é“¾</p><p>inevitable ä¸å¯é¿å…çš„</p><p>impair å‰Šå¼±</p><p>saturate æµ¸é€ï¼Œä½¿é¥±å’Œ</p><p>crawl çˆ¬è¡Œ</p><p>retail é›¶å”®</p><p>insurance ä¿é™©</p><p>device æƒ³å‡º</p><p>dynamic åŠ¨æ€çš„ï¼Œå……æ»¡æ´»åŠ›çš„</p><p>fiscal è´¢æ”¿çš„</p><p>patrol å·¡é€»</p><p>scrape åˆ®æ‰</p><p>pasture ç‰§åœº</p><p>metropolitan å¤§åŸå¸‚çš„</p><p>explicit æ¸…æ¥šçš„</p><p>institution æœºæ„ï¼Œä¹ ä¿—</p><p>crack ç ´è£‚</p><p>incorporate åŒ…å«ï¼Œå¹¶å…¥</p><p>conserve èŠ‚çº¦</p><p>lever æ“çºµæ†</p><p>utter å®Œå…¨çš„</p><p>preliminary åˆæ­¥çš„</p><p>harsh ä¸¥å‰çš„</p><p>illuminate ç…§äº®</p><p>ascend ä¸Šå‡</p><p>decay è…çƒ‚</p><p>bizarre å¥‡å¼‚çš„ï¼Œå¤æ€ªçš„</p><p>sensitive ä½“è´´çš„</p><p>diagnose è¯Šæ–­</p><p>authentic çœŸå“çš„</p><p>substantial å¤§é‡çš„</p><p>destined å‘½ä¸­æ³¨å®šçš„</p><p>contrive è®¾æ³•åšåˆ°</p><p>feebleè™šå¼±æ— åŠ›çš„</p><p>cater æ»¡è¶³ï¼Œè¿åˆ</p><p>catastrophe é‡å¤§ç¾éš¾</p><p>correlate ç›¸äº’å…³è”</p><p>torture æ‹·æ‰“</p><p>perish æ­»äº¡</p><p>fragile æ˜“ç¢çš„</p><p>peculiar å¤æ€ªçš„ï¼Œå¥‡æ€ªçš„</p><p>cruise ä¹˜èˆ¹æ¸¸è§ˆ</p><p>parliament è®®ä¼š</p><p>perpetual é•¿ä¹…çš„</p><p>reckless é²è½çš„</p><p>calorie å¡è·¯é‡Œ</p><p>intrigue æ¿€èµ·â€¦å…´è¶£</p><p>assemble é›†åˆ</p><p>estimate ä¼°è®¡</p><p>impulse å†²åŠ¨</p><p>eligible æœ‰èµ„æ ¼çš„</p><p>deliverå‘è¡¨</p><p>averté˜²æ­¢</p><p>glitter é—ªäº®</p><p>consensus ä¸€è‡´çœ‹æ³•</p><p>versus ä¸â€¦ç›¸æ¯”</p><p>fabricate æé€ </p><p>tumble è·Œå€’</p><p>lure å¼•è¯±</p><p>spectrum å…‰è°±ï¼Œç³»åˆ—</p><p>aviation èˆªç©º</p><p>extinct å·²ç­ç»çš„</p><p>tremendous å·¨å¤§çš„</p><p>priest ç‰§å¸ˆ</p><p>unveil å…¬å¸ƒ</p><p>renowned æœ‰åçš„</p><p>signify è¡¨ç¤º</p><p>designate æŒ‡å®š</p><p>insulate ä½¿éš”çƒ­ï¼Œä½¿éš”éŸ³</p><p>inferior è¾ƒå·®çš„</p><p>proclaim å®£å¸ƒï¼Œå£°æ˜</p><p>vigorous ç²¾åŠ›æ—ºç››çš„</p><p>candidate å€™é€‰äºº</p><p>greed è´ªå©ª</p><p>imperial å¸å›½çš„</p><p>inhibit æŠ‘åˆ¶</p><p>revolve æ—‹è½¬</p><p>temperament æ°”è´¨</p><p>corporate å…¬å¸çš„</p><p>substitute ä»£æ›¿è€…</p><p>compliment ç§°èµ</p><p>contradict åé©³</p><p>fragile æ˜“ç¢çš„</p><p>scare ç¼ºä¹çš„</p><p>ultimate æœ€ç»ˆçš„</p><p>escalate æ‰©å¤§</p><p>adolescent é’å°‘å¹´</p><p>mediate è°ƒåœ</p><p>stroke ä¸€å‡»</p><p>collaboration åˆä½œ</p><p>monetary è´§å¸çš„</p><p>clinic è¯Šæ‰€</p><p>suicide è‡ªæ€</p><p>interpret è§£é‡Šï¼Œè¯´æ˜</p><p>conspicuous æ˜“è§çš„</p><p>evacuate æ’¤ç¦»</p><p>evoke å¼•èµ·</p><p>profitable ç›ˆåˆ©çš„</p><p>counsel å¿ å‘Šï¼Œå»ºè®®</p><p>aggressive å¥½æ–—çš„</p><p>pitch çƒåœº</p><p>fatigue ç–²æƒ«çš„</p><p>legitimate åˆæ³•çš„</p><p>tropical çƒ­å¸¦çš„</p><p>perceive çœ‹å¾…</p><p>prototype åŸå‹</p><p>derail è„±è½¨</p><p>deficit äºæŸ</p><p>contract åˆåŒ</p><p>institute n.æœºæ„ v. å»ºç«‹</p><p>catastrophe é‡å¤§ç¾éš¾</p><p>recreation å¨±ä¹</p><p>veteran æœ‰ç»éªŒçš„äººï¼Œè€æ‰‹</p><p>eject é©±é€</p><p>plight å›°å¢ƒ</p><p>ascribe å°†â€¦å½’å› äº</p><p>poll æ°‘æ„è°ƒæŸ¥</p><p>indigenous å½“åœ°çš„</p><p>advisable æ˜æ™ºçš„</p><p>chronic æ…¢æ€§çš„</p><p>external å¤–éƒ¨çš„</p><p>momentum åŠ¿å¤´</p><p>gloomy æ˜æš—çš„</p><p>ingenious ç²¾å·§çš„</p><p>stagger è¹’è·š</p><p>arrogant å‚²æ…¢çš„</p><p>exclude å°†â€¦â€¦æ’æ–¥åœ¨å¤–</p><p>retrieve å–å›</p><p>workship å´‡æ‹œ</p><p>biography äººç‰©ä¼ è®°</p><p>ambiguous æ¨¡æ£±ä¸¤å¯çš„</p><p>dispatch æ´¾é£</p><p>concede æ‰¿è®¤â€¦â€¦å±å®</p><p>neutral ä¸­ç«‹çš„</p><p>strive åŠªåŠ›</p><p>speculate çŒœæµ‹</p><p>inventory å­˜è´§</p><p>coordinate ä½¿â€¦â€¦åè°ƒ</p><p>dazzle ä½¿ç›®çœ©</p><p>transient çŸ­æš‚çš„</p><p>ferry æ¸¡èˆ¹</p><p>lawsuit è¯‰è®¼</p><p>depict æç»˜</p><p>fascinate ä½¿ç€è¿·</p><p>moan å‘»åŸ</p><p>dimension å°ºå¯¸</p><p>sway æ‘‡æ‘†</p><p>academic å­¦æœ¯çš„</p><p>applause é¼“æŒ</p><p>dictate å£è¿°ï¼Œå‘½ä»¤</p><p>quote å¼•ç”¨</p><p>circulation è¡€æ¶²å¾ªç¯</p><p>ration å®šé‡ä¾›åº”</p><p>odd å¥‡æ€ªçš„</p><p>indicate å£°æ˜ï¼Œæš—ç¤º</p><p>eliminate æ¶ˆé™¤</p><p>municipal åŸå¸‚çš„</p><p>migrate è¿ç§»</p><p>rigor ä¸¥è°¨</p><p>merit ä¼˜ç§€å“è´¨</p><p>warrant æˆæƒä»¤ï¼Œä½¿åˆç†</p><p>scenario è®¾æƒ³</p><p>exempt è¢«å…é™¤</p><p>coalition è”åˆä½“ï¼Œè”ç›Ÿ</p><p>expire åˆ°æœŸ</p><p>coincide åŒæ—¶å‘ç”Ÿ</p><p>propel æ¨åŠ¨</p><p>execute æ‰§è¡Œ</p><p>rage æš´æ€’</p><p>refine æç‚¼</p><p>rash è½»ç‡çš„</p><p>cater æä¾›é¥®é£Ÿï¼Œè¿åˆ</p><p>induce å¼•è¯±</p><p>permeate æ¸—é€</p><p>spontaneous è‡ªå‘çš„</p><p>robust å¼ºå¥çš„</p><p>blend èåˆ</p><p>colonial æ®–æ°‘åœ°çš„</p><p>pedestrian è¡Œäºº</p><p>antibiotic æŠ—ç”Ÿç´ çš„</p><p>simulate å‡è£…</p><p>flee é€ƒç¦»</p><p>hurricane é£“é£</p><p>recipient æ¥å—è€…</p><p>controversy äº‰è®º</p><p>confer æˆäºˆ</p><p>refer æ¶‰åŠ</p><p>infer æ¨æ–­</p><p>shuttle èˆªå¤©é£æœº</p><p>intrinsic æœ¬è´¨çš„</p><p>sentiment æƒ…ç»ª</p><p>inquireè¯¢é—®</p><p>requireéœ€è¦</p><p>acquireè·å¾—</p><p>enquireè¯¢é—®</p><p>diligent å‹¤å¥‹çš„</p><p>segregate éš”ç¦»</p><p>shatter ç ´ç¢</p><p>epidemic æµè¡Œç—…</p><p>enterprise ä¼ä¸š</p><p>viable å¯è¡Œçš„</p><p>precise ç²¾ç¡®çš„</p><p>manifest æ˜¾ç¤ºï¼Œè¡¨æ˜</p><p>esteem å°Šé‡</p><p>premium ä¿é™©è´¹</p><p>spectacle çœ¼ç›ï¼Œå¥‡ç‰¹çš„ç°è±¡</p><p>prejudice åè§</p><p>setback æŒ«æŠ˜</p><p>buck ç¾å…ƒï¼ŒæŠµåˆ¶</p><p>drastic ä¸¥å‰çš„</p><p>offspring å­å¥³ï¼Œåä»£</p><p>acquaint ä½¿ç†Ÿæ‚‰</p><p>demography äººå£å­¦çš„</p><p>nonetheless å°½ç®¡å¦‚æ­¤</p><p>scrutiny å½»åº•å®¡æŸ¥</p><p>disclose é€éœ²</p><p>magnitude å·¨å¤§</p><p>retort åé©³</p><p>session ä¸€åœº</p><p>therapy ç–—æ³•</p><p>predecessor å‰ä»»</p><p>formula å…¬å¼</p><p>ward ç—…æˆ¿</p><p>expel å¼€é™¤</p><p>gadget å°å™¨å…·</p><p>pension å…»è€é‡‘</p><p>prosper å…´æ—º</p><p>fraud è¯ˆéª—</p><p>supervisor ç›‘ç£è€…</p><p>toll ä¼¤äº¡äººæ•°</p><p>descend ä¸‹æ¥ï¼Œä¸‹é™</p><p>enormous å·¨å¤§çš„</p><p>furnish å¸ƒç½®</p><p>incentive æ¿€åŠ±</p><p>refute åé©³</p><p>negotiateè°ˆåˆ¤</p><p>aggravate åŠ é‡</p><p>terminate ç»“æŸï¼Œç»ˆæ­¢</p><p>enlighten å¯å‘</p><p>inertia æƒ¯æ€§</p><p>skeptical æ€€ç–‘çš„</p><p>chunk åšå—</p><p>brew å•¤é…’ï¼Œé…é…¿</p><p>duplicate å¤åˆ¶</p><p>assess è¯„ä¼°</p><p>sakeç›®çš„</p><p>narrative å™äº‹</p><p>purchase è´­ä¹°</p><p>magnifyæ”¾å¤§</p><p>severe ä¸¥é‡çš„</p><p>installment ä¸€æœŸ</p><p>assert æ–­è¨€</p><p>boom ç¹è£</p><p>hectic å¿™ç¢Œçš„</p><p>dismay ä½¿æ‹…å¿ƒï¼Œä½¿å¤±æœ›</p><p>democratic æ°‘ä¸»çš„</p><p>justify è¯æ˜</p><p>conflict å†²çª</p><p>dilemma çª˜å¢ƒï¼Œå›°å¢ƒ</p><p>peculiar å¤æ€ªçš„</p><p>tenant æˆ¿å®¢</p><p>ascertain å¼„æ¸…</p><p>heirç»§æ‰¿äºº</p><p>chamber æˆ¿é—´ï¼Œè®®é™¢</p><p>detain æ‹˜ç•™</p><p>greedy è´ªå©ªçš„</p><p>resort æ±‚åŠ©</p><p>migrant ç§»æ°‘è€…</p><p>weird å¤æ€ªçš„</p><p>crucial è‡³å…³é‡è¦çš„</p><p>moreover è€Œä¸”</p><p>agony æåº¦ç—›è‹¦çš„</p><p>demonstrate è¡¨æ˜ï¼Œè¯æ˜</p><p>graphic ç»˜ç”»çš„</p><p>vaccine ç–«è‹—</p><p>cruise ä¹˜èˆ¹æµè§ˆ</p><p>rational åˆç†çš„</p><p>domestic å›½å†…çš„</p><p>accurate å‡†ç¡®çš„</p><p>ethnic ç§æ—çš„</p><p>conducive æœ‰åŠ©äºçš„</p><p>remedy è§£å†³æ–¹æ³•</p><p>collide ç¢°æ’</p><p>cripple ç˜¸å­</p><p>livestock ç‰²ç•œ</p><p>disgust åŒæ¶</p><p>envisage è®¾æƒ³</p><p>inherent å†…åœ¨çš„</p><p>solemn ä¸¥è‚ƒçš„</p><p>concise ç®€æ´çš„</p><p>condemn è°´è´£</p><p>augmentå¢å¤§</p><p>obedient æœä»çš„</p><p>lane å°è·¯</p><p>maneuver ç­–ç•¥</p><p>portrayæè¿°</p><p>surgeon å¤–ç§‘åŒ»ç”Ÿ</p><p>forge å»ºç«‹</p><p>reconcile ä½¿å’Œè°ä¸€è‡´</p><p>liberal è‡ªç”±çš„</p><p>accommodation ä½å®¿</p><p>implement å±¥è¡Œ</p><p>internal å›½å†…çš„</p><p>navigateå¯¼èˆª</p><p>mortgage æŠµæŠ¼</p><p>accessory é…ä»¶</p><p>executive ç»ç†</p><p>exile æµè¡Œ</p><p>dividend çº¢åˆ©</p><p>regulation è§„ç« </p><p>correlate ç›¸äº’å…³è”</p><p>instruct æŒ‡ç¤º</p><p>kit æˆå¥—å·¥å…·</p><p>arrogance å‚²æ…¢</p><p>unprecedented å²æ— å‰ä¾‹çš„</p><p>swell è‚¿èƒ€</p><p>amend ä¿®è®¢</p><p>extract æå–</p><p>intimate äº²å¯†çš„</p><p>devastate å½»åº•ç ´å</p><p>withdraw æ’¤å›</p><p>graze åƒé’è‰</p><p>grope æ‘¸ç´¢ï¼Œå¯»æ‰¾</p><p>distracted æ³¨æ„åŠ›åˆ†æ•£çš„</p><p>obscure éš¾ä»¥ç†è§£çš„ï¼Œæ©ç›–</p><p>subordinate ä¸‹çº§ï¼Œä¸‹å±</p><p>contaminate å¼„è„ï¼Œæ±¡æŸ“</p><p>retreat æ’¤é€€</p><p>cherish ççˆ±</p><p>conscience è‰¯å¿ƒ</p><p>erupt ç«å±±çˆ†å‘</p><p>subtle ç»†å¾®çš„</p><p>unleash é‡Šæ”¾</p><p>endorse å…¬å¼€æ”¯æŒ</p><p>flaw ç‘•ç–µ</p><p>publicity å…³æ³¨</p><p>endurance è€åŠ›</p><p>fabric ç»‡ç‰©</p><p>discriminate æ­§è§†</p><p>peer åŒé¾„äºº</p><p>subsidy è¡¥è´´</p><p>prime é¦–è¦çš„</p><p>compatible å…¼å®¹çš„</p><p>facet éƒ¨åˆ†</p><p>bleak æ²¡æœ‰å¸Œæœ›çš„</p><p>scatter æ•£å¼€ï¼Œæ’­æ’’</p><p>revive è‹é†’</p><p>irritate ä½¿çƒ¦èº</p><p>maturity æˆç†Ÿ</p><p>plausible è²Œä¼¼åˆç†çš„</p><p>trivial çç¢çš„</p><p>circuit ç”µè·¯</p><p>galaxy æ˜Ÿç³»</p><p>deplete å¤§é‡æ¶ˆè€—</p><p>preception ç†è§£</p><p>loyalty å¿ è¯š</p><p>violate è¿å</p><p>adhere é»é™„</p><p>paradox çŸ›ç›¾çš„äººï¼Œæ‚–è®º</p><p>presume æ¨æµ‹</p><p>quit è¾å»</p><p>irrational ä¸åˆç†çš„</p><p>notion è§‚å¿µ</p><p>guard å«å…µï¼Œçœ‹å®ˆ</p><p>baffle ä½¿â€¦å›°æƒ‘</p><p>dub å°†â€¦æˆç§°ä¸º</p><p>institution æœºæ„</p><p>superior æ›´å¥½çš„ï¼Œä¸Šçº§</p><p>contest æ¯”èµ›</p><p>amplify æ”¾å¤§</p><p>deduce æ¨æ–­</p><p>dignity å°Šä¸¥ï¼Œè‡ªå°Š</p><p>monopoly å„æ–­</p><p>cognitive è®¤è¯†çš„</p><p>episode ä¸€æ®µç»å†</p><p>exclusive ç‹¬å çš„</p><p>jerk çŒ›æ‹½</p><p>commute ä¸Šä¸‹ç­å¾€è¿”</p><p>conceive æƒ³è±¡</p><p>undermine é€æ¸å‰Šå¼±</p><p>comply æœä»</p><p>sophisticated ç²¾å¯†çš„ï¼Œè§å¤šè¯†å¹¿çš„ï¼Œè€ç»ƒçš„</p><p>malicious æ¶æ¯’çš„</p><p>guardian ç›‘æŠ¤äºº</p><p>multitude ä¼—å¤š</p><p>nurture åŸ¹å…»</p><p>proposition æè®®</p><p>diesel æŸ´æ²¹</p><p>articulate æ¸…æ¥šåœ°è¡¨è¾¾</p><p>precedent å…ˆä¾‹</p><p>infinite æ— é™çš„</p><p>consolidate åŠ å¼º</p><p>boost ä½¿å¢é•¿</p><p>relay ä¼ é€’</p><p>downside ç¼ºç‚¹</p><p>distinct æˆªç„¶ä¸åŒçš„</p><p>allege æ–­è¨€</p><p>allocate åˆ†é…</p><p>ponder æ²‰æ€</p><p>sanctuary ç¦çŒåŒº</p><p>vicinity å‘¨å›´åœ°åŒº</p><p>initial å¼€å§‹çš„ï¼Œæœ€åˆçš„</p><p>contempt é„™è§†</p><p>overwhelm å‡»è´¥</p><p>territory é¢†åœŸ</p><p>trillion ä¸€ä¸‡äº¿</p><p>outdated è¿‡æ—¶çš„</p><p>real estate æˆ¿åœ°äº§</p><p>specify å…·ä½“æŒ‡æ˜</p><p>delicate å¾®å¦™çš„</p><p>blunt é’çš„</p><p>deprive å‰¥å¤º</p><p>declaration å®£å¸ƒ</p><p>barrel æ¡¶</p><p>equation ç­‰å¼</p><p>oppress å‹è¿«</p><p>flourish ç¹è£</p><p>handicap ç”Ÿç†ç¼ºé™·</p><p>extravagant å¥¢ä¾ˆçš„</p><p>erase æ¶ˆé™¤</p><p>brisk è½»å¿«çš„</p><p>negligible å¾®ä¸è¶³é“çš„</p><p>addict ç˜¾å›å­</p><p>continent æ´²ï¼Œå¤§é™†</p><p>patent ä¸“åˆ©æƒ</p><p>recession ç»æµè¡°é€€</p><p>rival ç«äº‰è€…</p><p>detach æ‘†è„±</p><p>integral å¿…ä¸å¯å°‘çš„</p><p>endow ææ¬¾</p><p>immune å…ç–«çš„</p><p>wipe out å½»åº•æ¶ˆç­</p><p>implicit å«è“„çš„</p><p>render ä½¿å˜å¾—</p><p>prevail ç››è¡Œ</p><p>slump æš´è·Œ</p><p>disrupt ä½¿ä¸­æ–­</p><p>deteriorate æ¶åŒ–</p><p>stake è‚¡ä»½</p><p>consecutive è¿ç»­çš„</p><p>turbulent åŠ¨è¡çš„</p><p>anticipate é¢„æ–™</p><p>viaç»è¿‡</p><p>startle ä½¿â€¦å“ä¸€è·³</p><p>quota é™é¢</p><p>literal å­—é¢ä¸Šçš„</p><p>penalty ç½šé‡‘</p><p>eccentric å¤æ€ªçš„</p><p>prospective æ½œåœ¨çš„</p><p>plunge æš´è·Œ</p><p>neglect ç–å¿½</p><p>stimulus åˆºæ¿€ç‰©</p><p>intricate é”™ç»¼å¤æ‚çš„</p><p>occasional å¶å°”çš„</p><p>hierarchy ç­‰çº§åˆ¶åº¦</p><p>scholarly å­¦æœ¯çš„</p><p>protein è›‹ç™½è´¨</p><p>evaporate è’¸å‘</p><p>outset å¼€å§‹</p><p>tuition æ•™æˆ</p><p>intimidate æå“</p><p>pharmacy ç—…æˆ¿</p><p>optic çœ¼çš„ï¼Œè§†åŠ›çš„</p><p>memorial çºªå¿µç¢‘</p><p>intuition ç›´è§‰</p><p>prestige å¨ä¿¡</p><p>trait ç‰¹å¾</p><p>mourn å“€æ‚¼</p><p>enroll ä½¿åŠ å…¥ï¼Œæ‹›æ”¶</p><p>bureau å±€ï¼Œå¸ï¼Œå¤„ï¼ŒåŠäº‹å¤„</p><p>milestone é‡Œç¨‹ç¢‘</p><p>tangle ç¼ ç»“åœ¨ä¸€èµ·</p><p>cast æ‰”</p><p>involved å·å…¥çš„</p><p>obsess ä½¿ç—´è¿·</p><p>stun ä½¿éœ‡æƒŠ</p><p>toss æ‰”</p><p>justification æ­£å½“ç†ç”±</p><p>integrity æ­£ç›´</p><p>dedicate çŒ®èº«</p><p>parliament è®®ä¼š</p><p>beam å…‰æŸ</p><p>assure ç¡®ä¿</p><p>navigation å¯¼èˆª</p><p>endeavor åŠªåŠ›</p><p>scope èŒƒå›´</p><p>multiple å¤šä¸ªçš„</p><p>prominent æ°å‡ºçš„</p><p>luxury å¥¢ä¾ˆ</p><p>impractical ä¸åˆ‡å®é™…çš„</p><p>insight æ´æ‚‰ï¼Œæ´å¯ŸåŠ›</p><p>deposit å­˜æ¬¾</p><p>emulate æ•ˆä»¿</p><p>subsidiary è¾…åŠ©çš„ï¼Œæ¬¡è¦çš„</p><p>drown æººæ­»</p><p>rein æ§åˆ¶</p><p>jeopardize ä½¿å¤„äºå±é™©å¢ƒåœ°ï¼Œå±åŠ</p><p>proof è¯æ®</p><p>formulate è§„åˆ’</p><p>thermal çƒ­çš„ï¼Œçƒ­é‡çš„</p><p>curriculum è¯¾ç¨‹</p><p>prevalent æµè¡Œçš„</p><p>antique å¤è‘£</p><p>contemplate æ‰“ç®—ï¼Œè€ƒè™‘</p><p>capture æŠ“ä½</p><p>elevate ææ‹”</p><p>debris æ®‹éª¸</p><p>paradise å¤©å ‚</p><p>slack æ‡ˆæ€ çš„ï¼Œæ¾å¼›çš„</p><p>hazard å±é™©</p><p>senator å‚è®®å‘˜</p><p>exert æ–½åŠ </p><p>haunt è¦ç»•ï¼Œé•¿æœŸå›°æ‰°</p><p>mutual ç›¸äº’çš„</p><p>ornament è£…é¥°å“</p><p>confront ç›´é¢ï¼Œæ­£è§†</p><p>slight è½»å¾®çš„</p><p>incur æ‹›è‡´</p><p>sculpture é›•åƒ</p><p>bare èµ¤è£¸çš„ï¼Œè’èŠœçš„</p><p>irrigate çŒæº‰</p><p>vacant ç©ºçš„</p><p>reproach è´£å¤‡</p><p>twist å¼¯æ›²å˜å½¢</p><p>routine æƒ¯ä¾‹ï¼Œå¸¸è§„</p><p>reassure ä½¿å®‰å¿ƒ</p><p>descendant åä»£ï¼Œåè£”</p><p>barren è´«ç˜ çš„ï¼Œè’èŠœçš„</p><p>rescue è¥æ•‘</p><p>grim ä¸¥è‚ƒçš„ï¼Œä»¤äººæ²®ä¸§çš„</p><p>negotiation è°ˆåˆ¤</p><p>guilt å†…ç–š</p><p>industrial å·¥ä¸šçš„</p><p>hijack åŠ«æŒï¼Œæ§åˆ¶</p><p>overstate å¤¸å¤§</p><p>porch é—¨å»Š</p><p>analogy ç±»æ¯”</p><p>vulnerable è„†å¼±çš„</p><p>assumption å‡è®¾</p><p>contradiction çŸ›ç›¾</p><p>intend è®¡åˆ’æ‰“ç®—</p><p>humane äººé“çš„</p><p>fossil åŒ–çŸ³</p><p>statue é›•åƒ</p><p>alter è­¦è§‰çš„</p><p>transplant ç§»æ¤</p><p>temptation å¼•è¯±</p><p>solitude ç‹¬å¤„</p><p>eager çƒ­åˆ‡çš„</p><p>alternate äº¤æ›¿çš„</p><p>resign è¾èŒ</p><p>curb æ§åˆ¶</p><p>revenge æŠ¥å¤</p><p>assault æ”»å‡»</p><p>liable å¯èƒ½åšâ€¦çš„</p><p>hatch å­µåŒ–</p><p>cable ç”µç¼†</p><p>pest å®³è™«</p><p>surge æ¿€å¢</p><p>nominal è±¡å¾æ€§çš„ï¼Œåä¹‰ä¸Šçš„</p><p>settlement åè®®ï¼Œå’Œè§£</p><p>frontier è¾¹ç•Œ</p><p>concrete ç¡®å®çš„ï¼Œå…·ä½“çš„</p><p>summon å¬å”¤</p><p>embark ä»äº‹ï¼Œç€æ‰‹</p><p>occupation èŒä¸š</p><p>abrupt çªç„¶çš„ï¼Œæ„å¤–çš„</p><p>reluctant å‹‰å¼ºçš„</p><p>crush æ£ç¢ï¼Œå‹ç¢</p><p>dominant å æ”¯é…åœ°ä½çš„</p><p>compensate å¼¥è¡¥ï¼Œè¡¥å¿</p><p>instrument ä»ªå™¨ï¼Œä¹å™¨</p><p>stance æ€åº¦ï¼Œç«‹åœº</p><p>commerce å•†ä¸šï¼Œè´¸æ˜“</p><p>corrupt è…è´¥çš„ï¼Œä¸é“å¾·çš„</p><p>redundant å¤šä½™çš„</p><p>jungle çƒ­å¸¦ä¸›æ—</p><p>stabilize ç¨³å®š</p><p>embed ä½¿â€¦åµŒå…¥</p><p>literature æ–‡å­¦ä½œå“</p><p>commence å¼€å§‹ï¼Œç€æ‰‹</p><p>surpass è¶…è¿‡</p><p>destiny å‘½è¿</p><p>comprehensive å…¨é¢çš„ï¼Œç»¼åˆæ€§çš„</p><p>resume ç»§ç»­ï¼Œç®€å†</p><p>synthetic åˆæˆçš„ï¼Œäººé€ çš„</p><p>sufficient å……è¶³çš„</p><p>soar å‡ç©ºï¼ŒçŒ›å¢</p><p>bias åè§</p><p>degrade æœ‰è¾±â€¦çš„äººæ ¼</p><p>conference ä¼šè®®</p><p>underestimate ä½ä¼°</p><p>disorder å¤±è°ƒï¼Œç´Šä¹±</p><p>tough è‰°éš¾çš„</p><p>interact äº’åŠ¨</p><p>preserve ç»´æŠ¤</p><p>devastating æ¯ç­æ€§çš„</p><p>hemisphere åŠçƒ</p><p>appliance è£…ç½®ï¼Œå®¶ç”µ</p><p>autonomy è‡ªæ²»æƒ</p><p>dwell å±…ä½</p><p>stimulate åˆºæ¿€ï¼Œæ¿€å‘</p><p>intent æ„å›¾ï¼Œç›®çš„</p><p>pessimistic æ‚²è§‚çš„</p><p>superiority ä¼˜è¶Š</p><p>jury é™ªå®¡å›¢</p><p>given æŒ‡å®šçš„</p><p>notorious è‡­åæ˜­è‘—çš„</p><p>considerable ç›¸å½“å¤šçš„</p><p>compact ç´§å‡‘çš„</p><p>carton ç¡¬çº¸ç›’</p><p>freight è´§ç‰©</p><p>choke çª’æ¯</p><p>fuss ç´§å¼ ä¸å®‰</p><p>entertain ä½¿å¿«ä¹ï¼Œå¨±ä¹</p><p>prolong å»¶é•¿</p><p>criterion æ ‡å‡†</p><p>tactic ç­–ç•¥</p><p>hypothesis å‡è¯´</p><p>consult å‘â€¦å’¨è¯¢ï¼Œæ±‚æ•‘</p><p>imperative ç´§æ€¥çš„</p><p>bonus å¥–é‡‘</p><p>incidentally é¡ºä¾¿æä¸€ä¸‹ï¼Œå¶ç„¶åœ°</p><p>regardless ä¸ç®¡ï¼Œæ— è®ºå¦‚ä½•</p><p>surgery å¤–ç§‘æ‰‹æœ¯</p><p>massive å·¨å¤§çš„</p><p>consistent ä¸€è´¯çš„</p><p>collision ç¢°æ’</p><p>resemble çœ‹èµ·æ¥åƒ</p><p>breakthrough çªç ´</p><p>federal è”é‚¦åˆ¶çš„</p><p>illustrate è¯´æ˜</p><p>distinctive ç‹¬ç‰¹çš„ï¼Œæœ‰ç‰¹è‰²çš„</p><p>responsive ååº”æ•æ·çš„</p><p>excess è¿‡å¤š</p><p>casualty ä¼¤äº¡äººå‘˜</p><p>testify ä½œè¯</p><p>specialise ä¸“é—¨ä»äº‹</p><p>delegate ä»£è¡¨</p><p>solidarity å›¢ç»“ä¸€è‡´</p><p>drill é’»æœºï¼Œæ¼”ä¹ </p><p>transaction äº¤æ˜“ï¼Œä¸šåŠ¡</p><p>immigrant ç§»æ°‘</p><p>generalize æ¦‚æ‹¬ï¼Œå½’çº³</p><p>sober å†·é™çš„</p><p>impetus åŠ¨åŠ›ï¼Œä¿ƒè¿›</p><p>benign å’Œå–„çš„ï¼Œè‰¯æ€§çš„</p><p>reserve é¢„è®¢ï¼Œé¢„çº¦</p><p>triumph æˆåŠŸï¼Œèƒœåˆ©</p><p>likelihood å¯èƒ½æ€§</p><p>contact è”ç³»</p><p>malignant æ¶æ„çš„ï¼Œæ¶æ€§çš„</p><p>liability è´£ä»»</p><p>renew å»¶é•¿</p><p>authority æƒå¨ï¼ŒæƒåŠ›</p><p>browse æµè§ˆï¼Œåƒè‰</p><p>mentor å¯¼å¸ˆ</p><p>innocent æ— ç½ªçš„</p><p>repel é©±é€ï¼Œèµ¶èµ°</p><p>distress æ‚²ä¼¤ï¼Œå¿§è™‘</p><p>obese ç—…æ€è‚¥èƒ–çš„ï¼Œè‡ƒè‚¿çš„</p><p>vegetation æ¤è¢«</p><p>discharge æ’å‡ºï¼Œè§£é›‡</p><p>interaction äº’åŠ¨</p><p>ideal ç†æƒ³çš„</p><p>suppress é•‡å‹ï¼Œå‹æŠ‘</p><p>illiterate æ–‡ç›²</p><p>paralyze ä½¿ç˜«ç—ª</p><p>plentiful ä¸°å¯Œçš„</p><p>destined å‘½ä¸­æ³¨å®šçš„</p><p>discrepancy å·®å¼‚</p><p>conception æ„æ€ï¼Œæ¦‚å¿µ</p><p>recognition è®¤å‡ºï¼Œè¯†åˆ«</p><p>affiliate ä½¿éš¶å±äºï¼Œä½¿ç´§å¯†è”ç³»</p><p>conscientious è®¤çœŸçš„ï¼Œå‹¤å‹¤æ³æ³</p><p>manual äººåŠ›çš„ï¼Œä½“åŠ›çš„</p><p>minister éƒ¨é•¿ï¼Œå¤§è‡£</p><p>oppose åå¯¹</p><p>distort ä½¿å˜å½¢ï¼Œä½¿æ‰­æ›²</p><p>deploy éƒ¨ç½²</p><p>intelligible å¯ç†è§£çš„</p><p>intermittent é—´æ­‡çš„ï¼Œæ–­æ–­ç»­ç»­çš„</p><p>formidable ä»¤äººæ•¬ç•çš„</p><p>indifferent ä¸æ„Ÿå…´è¶£çš„</p><p>denial å¦è®¤</p><p>phase é˜¶æ®µ</p><p>substantial å¤§é‡çš„</p><p>pause æš‚åœ</p><p>drought å¹²æ—±</p><p>sustainable å¯æŒç»­çš„</p><p>intangible æ— å½¢çš„ï¼Œéš¾ä»¥æè¿°åœ°</p><p>expedition è¿œå¾ï¼Œæ¢é™©</p><p>indulge æ²‰è¿·ï¼Œæ»¡è¶³</p><p>quest æ¢ç´¢ï¼Œå¯»æ±‚</p><p>disastrous ç¾éš¾æ€§çš„</p><p>sensation çŸ¥è§‰ï¼Œæ„Ÿè§‰èƒ½åŠ›</p><p>observe è§‚å¯Ÿ</p><p>resent æ€¨æ¨ï¼Œæ†æ¶</p><p>disguise è£…æ‰®ï¼Œå‡æ‰®</p><p>feasible å¯è¡Œçš„</p><p>provoke æ¿€èµ·</p><p>accumulate ç§¯ç´¯</p><p>assurance æ‹…ä¿ï¼Œä¿è¯</p><p>tackle å¤„ç†</p><p>feeble è™šå¼±æ— åŠ›çš„</p><p>pursuit è¿½æ±‚</p><p>accuse èŒè´£</p><p>compile æ±‡ç¼–</p><p>cabinet å‚¨è—æŸœ</p><p>objection åå¯¹</p><p>engage ä»äº‹ï¼Œå‚åŠ </p><p>vast å·¨å¤§çš„</p><p>preside ä¸»æŒ</p><p>suspicion æ€€ç–‘</p><p>particle å¾®ç²’ï¼Œç²’å­</p><p>subsistence å‹‰å¼ºç”Ÿå­˜</p><p>racial ç§æ—é—´çš„ï¼Œç§æ—çš„</p><p>persistence æ¯…åŠ›</p><p>blaze é—ªè€€</p><p>convene å¬é›†ï¼Œå¬å¼€</p><p>console å®‰æ…°ï¼Œæ§åˆ¶å°</p><p>transition è¿‡æ¸¡ï¼Œè½¬å˜</p><p>competence èƒ½åŠ›ï¼Œæ‰å¹²</p><p>hostile æ•Œæ„çš„ï¼Œåå¯¹çš„</p><p>erect å»ºé€ </p><p>haze çƒŸé›¾</p><p>authorize æ‰¹å‡†ï¼Œæˆæƒ</p><p>alternative å¯ä»£æ›¿çš„</p><p>consultant é¡¾é—®</p><p>perference åå¥½</p><p>pole æ†å­ï¼Œåœ°çº§</p><p>prescribe å¼€è¯ï¼Œè§„å®š</p><p>populate å±…ä½äº</p><p>drawback ç¼ºç‚¹ï¼Œä¸åˆ©æ¡ä»¶</p><p>morality é“å¾·</p><p>ritual ä»ªå¼</p><p>genetic é—ä¼ çš„ï¼ŒåŸºå› çš„</p><p>ingredient é…æ–™ï¼Œæˆåˆ†ï¼Œå› ç´ </p><p>layer å±‚</p><p>transcend è¶…å‡ºï¼Œè¶…è¶Š</p><p>plate ç›˜</p><p>angle è§’åº¦</p><p>spotlight èšå…‰ç¯</p><p>eternal æ°¸æ’çš„</p><p>successive è¿ç»­çš„</p><p>separate å•ç‹¬çš„</p><p>promising å¤§æœ‰å¸Œæœ›çš„</p><p>sequence ä¸€ç³»åˆ—</p><p>priority ä¼˜å…ˆæƒ</p><p>compel å¼ºè¿«ï¼Œé€¼è¿«</p><p>implication æš—ç¤ºï¼Œå¯èƒ½çš„å½±å“</p><p>prosperity å…´æ—º</p><p>sneak å·å·åœ°èµ°ï¼Œæ½œè¡Œ</p><p>concession è®©æ­¥ï¼Œè®¤è¾“</p><p>hamper å¦¨ç¢ï¼Œé˜»ç¢</p><p>initiate å¼€å§‹ï¼Œå‘èµ·</p><p>essence æœ¬è´¨</p><p>contrive è®¾æ³•åšåˆ°ï¼Œå›¾è°‹</p><p>instinct æœ¬èƒ½</p><p>identical å®Œå…¨ç›¸åŒçš„</p><p>protest æŠ—è®®ï¼Œåå¯¹</p><p>conformity éµä»ï¼Œéµå®ˆ</p><p>deliberate æ•…æ„çš„</p><p>luminous å‘äº®çš„ï¼Œå‘å…‰çš„</p><p>plead æ³æ±‚</p><p>outbreak çˆ†å‘</p><p>fraction å°‘é‡ï¼Œä¸€ç‚¹å„¿</p><p>derive èµ·æºäºï¼Œæ¥è‡ª</p><p>elastic æœ‰å¼¹æ€§çš„</p><p>mislead è¯¯å¯¼</p><p>engagement è®¢å©šï¼Œå‚åŠ </p><p>reliance ä¾èµ–ï¼Œä¾é </p><p>polar æåœ°çš„</p><p>prescription å¤„æ–¹</p><p>cumulative ç´¯åŠ çš„</p><p>commodity å•†å“</p><p>revelation æ­éœ²</p><p>strike ç½¢å·¥ï¼Œæ‰“ï¼Œå‡»</p><p>reservation é¢„è®¢</p><p>encounter é­é‡</p><p>dispose ä¸¢æ‰</p><p>bypass æ—é“</p><p>combat æˆ˜æ–—ï¼Œææ–—</p><p>stick æ£ï¼Œåˆºå…¥æ’å…¥</p><p>stride å¤§æ­¥èµ°ï¼Œæ­¥ä¼</p><p>glamour é­…åŠ›ï¼Œå¸å¼•åŠ›</p><p>reap è·å¾—</p><p>layman å¤–è¡Œï¼Œé—¨å¤–æ±‰</p><p>polish æ”¹å–„ï¼Œæ¶¦è‰²</p><p>patch å°å—ï¼Œæ–‘ç‚¹</p><p>perish æ­»äº¡</p><p>plea æ³æ±‚</p><p>virgin æœªå¼€å‘çš„ï¼ŒåŸå§‹çŠ¶æ€çš„</p><p>exceptional æ°å‡ºçš„ï¼Œéå‡¡çš„</p><p>rural ä¹¡ä¸‹çš„ï¼Œä¹¡æ‘çš„</p><p>breed ç¹æ®–ï¼Œé¥²å…»</p><p>threshold é—¨æ§›ï¼Œèµ·å§‹ç‚¹</p><p>additive æ·»åŠ å‰‚ï¼Œæ·»åŠ ç‰©</p><p>turnover è¥ä¸šé¢</p><p>presumably å¾ˆå¯èƒ½</p><p>overturn æ¨ç¿»</p><p>cease åœæ­¢</p><p>elite ç²¾è‹±</p><p>intensive å¯†é›†çš„</p><p>harmonious å’Œç¦çš„</p><p>circumstance æƒ…å†µï¼Œæƒ…å½¢</p><p>persist é¡½å¼ºåšæŒï¼ŒæŒç»­</p><p>tease é€—å¼„</p><p>elicit å¼•å‡º</p><p>celebrity åäººï¼Œæ˜æ˜Ÿ</p><p>recur å†æ¬¡å‘ç”Ÿ</p><p>barely ä»…ä»…</p><p>extent ç¨‹åº¦</p><p>disregard ä¸ç†ä¼š</p><p>integrate åˆå¹¶</p><p>torture æ‹·æ‰“ï¼Œæ‹·é—®</p><p>nourish ç»™â€¦æä¾›è¥å…»</p><p>inhabitant å±…æ°‘</p><p>suspend æš‚åœï¼Œä¸­æ­¢</p><p>snap å•ªå—’å£°ï¼Œæ–­è£‚</p><p>provocative æŒ‘è¡…çš„ï¼Œç…½åŠ¨çš„</p><p>autonomous è‡ªæ²»çš„</p><p>federation è”ç›Ÿï¼Œè”åˆä¼š</p><p>pesticide æ€è™«å‰‚</p><p>potency å½±å“åŠ›</p><p>interactive äº¤äº’çš„</p><p>potent æœ‰å¼ºæ•ˆçš„ï¼Œçƒˆæ€§çš„</p><p>deviate èƒŒç¦»ï¼Œåç¦»</p><p>specification è§„æ ¼</p><p>convention ä¹ ä¿—ï¼Œå¤§ä¼š</p><p>specific æ˜ç¡®å…·ä½“çš„</p><p>terrify ä½¿å®³æ€•ï¼Œä½¿ææƒ§</p><p>contention çœ‹æ³•ï¼Œäº‰è®º</p><p>vice æ¶ä¹ ï¼Œå‰¯çš„æ¬¡çš„</p><p>submerge ä½¿æµ¸æ²¡ï¼Œæ·¹æ²¡</p><p>opponent å¯¹æ‰‹ï¼Œç«äº‰è€…</p><p>obesity è‚¥èƒ–</p><p>defy è¿æŠ—</p><p>terrific æå¥½çš„</p><p>tragedy ä¸å¹¸ï¼Œæ‚²å‰§</p><p>acquaintance ç†Ÿäººï¼Œäº†è§£</p><p>detect å‘ç°</p><p>glacier å†°å·</p><p>probe è¿½é—®</p><p>frantic å‘ç‹‚ä¼¼çš„</p><p>practitioner ä»ä¸šäººå‘˜</p><p>fund åŸºé‡‘</p><p>cooperative åˆä½œçš„</p><p>invoke å”¤èµ·ï¼Œå¼•ç”¨</p><p>compulsory å¼ºåˆ¶æ€§çš„ï¼Œä¹‰åŠ¡çš„</p><p>craftsmanship æ‰‹è‰º</p><p>disposal ä¸¢æ‰</p><p>intensity å¼ºçƒˆï¼Œå‰§çƒˆ</p><p>striking æ˜¾è‘—çš„</p><p>elaborate å¤æ‚çš„ï¼Œè¯¦å°½çš„</p><p>elementary åŸºæœ¬çš„</p><p>subsidize ç»™â€¦å‘è¡¥è´´ï¼Œè¡¥åŠ©</p><p>disperse æ‰©æ•£ï¼Œæ•£å¼€</p><p>underlie æ„æˆâ€¦çš„åŸºç¡€</p><p>storage å‚¨è—</p><p>peak é¡¶å³°</p><p>mechanical æœºæ¢°çš„</p><p>likewise åŒæ ·åœ°</p><p>testimony è¯è¯</p><p>utilize åˆ©ç”¨ï¼Œä½¿ç”¨</p><p>breakdown æ•…éšœ</p><p>restraint åˆ¶æ­¢ï¼Œå…‹åˆ¶</p><p>quantitative æ•°é‡çš„</p><p>excessive è¿‡å¤šçš„</p><p>recruit æ‹›æ”¶ï¼Œæ‹›è˜</p><p>lens é•œç‰‡</p><p>strategic æˆ˜ç•¥æ€§çš„</p><p>qualitative è´¨é‡çš„</p><p>invariably æ€»æ˜¯ï¼Œä¸å˜åœ°</p><p>surgical å¤–ç§‘æ‰‹æœ¯çš„</p><p>miniature å¾ˆå°çš„ï¼Œå¾®å‹çš„</p><p>premises å‰æ</p><p>headline é‡è¦æ–°é—»</p><p>nominate æå</p><p>urgency ç´§æ€¥</p><p>marginal å¾®ä¸è¶³é“çš„</p><p>voyage èˆªè¡Œï¼Œèˆªæµ·</p><p>vicious æ¶æ€§çš„ï¼Œæ®‹æš´çš„</p><p>journalist è®°è€…</p><p>misguide é”™è¯¯åœ°å¼•å¯¼</p><p>monitor ç›‘è§†</p><p>initiative ä¸»åŠ¨æ€§</p><p>shrink ç¼©æ°´</p><p>precaution é¢„é˜²æªæ–½</p><p>currency è´§å¸ï¼Œé€šè´§</p><p>questionnaire è°ƒæŸ¥é—®å·</p><p>bureaucracy å®˜åƒšåˆ¶åº¦ï¼Œå®˜åƒšä¸»ä¹‰</p><p>crisp è„†çš„</p><p>expertise ä¸“é—¨æŠ€æœ¯</p><p>compassion åŒæƒ…ï¼Œæ€œæ‚¯</p><p>conventional ä¼ ç»Ÿçš„</p><p>invisible çœ‹ä¸è§çš„</p><p>compromise æŠ˜ä¸­ï¼Œå¦¥åï¼Œè®©æ­¥</p><p>heighten åŠ å¼ºï¼Œå¢åŠ </p><p>composer ä½œæ›²å®¶</p><p>comprise åŒ…æ‹¬</p><p>thereby å› æ­¤</p><p>exaggerate å¤¸å¤§</p><p>psychological å¿ƒç†çš„</p><p>coverage æ–°é—»æŠ¥é“</p><p>orthodox æ­£ç»Ÿçš„</p><p>decent åƒæ ·çš„ï¼Œå¾—ä½“çš„</p><p>doom å„è¿ï¼Œä½¿â€¦æ³¨å®šé­å—</p><p>specialty ä¸“ä¸š</p><p>crude ç²—ç•¥çš„</p><p>masterpiece æ°ä½œ</p><p>ordeal æŠ˜ç£¨ï¼Œè‹¦éš¾çš„ç»å†</p><p>intensify åŠ å¼º</p><p>disposition æ€§æƒ…ï¼Œå¸ƒç½®</p><p>burden è´Ÿæ‹…</p><p>mechanism æœºæ¢°è£…ç½®ï¼Œæ–¹æ³•</p><p>syndrome ç»¼åˆå¾</p><p>transmission ä¼ è¾“</p><p>underlying æ·±å±‚çš„</p><p>extensive å¹¿é˜”çš„</p><p>suspicious è§‰å¾—å¯ç–‘çš„</p><p>plenty å¤§é‡</p><p>inclined å€¾å‘äºâ€¦çš„</p><h1 id="å…­çº§ä½œæ–‡æ¨¡ç‰ˆ">å…­çº§ä½œæ–‡æ¨¡ç‰ˆ</h1><h2 id="è®®è®ºæ–‡">è®®è®ºæ–‡</h2><p>å¼€å¤´ Living in an era of rapid technological development ,and continuous expansion of knowledge,(ä¸»é¢˜)have/has become increasingly important,which is significantly impacting ( æŸäººçš„ç”Ÿæ´»/å­¦æ ¡ç”Ÿæ´»/ä¸ªäººç»å† ) <strong>ç”Ÿæ´»åœ¨æŠ€æœ¯å¿«é€Ÿå‘å±•ã€çŸ¥è¯†ä¸æ–­æ‰©å±•çš„æ—¶ä»£ï¼Œsthå·²ç»å˜å¾—è¶Šæ¥è¶Šé‡è¦ï¼Œè¿™å¯¹å½±å“äº†æŸäººçš„ç”Ÿæ´»/å­¦æ ¡ç”Ÿæ´»/ä¸ªäººç»å†</strong></p><ul><li><p>å½“ä¸»é¢˜æ˜¯â€¦çš„å½±å“æ—¶ï¼š Therefore, itâ€™s of great significance for sb to do sth ï¼ŒThe following reasons can account for this viewpoint. <strong>å› æ­¤ï¼ŒæŸäººåšæŸäº‹å…·æœ‰é‡è¦æ„ä¹‰ï¼Œä»¥ä¸‹åŸå› å¯ä»¥è§£é‡Šè¿™ä¸€è§‚ç‚¹ã€‚</strong></p></li><li><p>å½“ä¸»é¢˜æ˜¯â€¦çš„é‡è¦æ€§æ—¶ï¼šTherefore,I deem that the (importance of AI â€¦çš„é‡è¦æ€§/è¦è´´è¿‘ä¸»é¢˜) lies in the following aspects <strong>å› æ­¤ï¼Œæˆ‘è®¤ä¸ºsthçš„é‡è¦æ€§åœ¨äºä»¥ä¸‹å‡ ä¸ªæ–¹é¢</strong></p></li></ul><p>è®ºæ®+è®ºç‚¹</p><ul><li><p>è®ºç‚¹1ï¼šFirst and foremost,there is no doubt that ï¼ˆsth can enhance sb work/study efficiency,and offer tremendous convenience in our daily/school lifeï¼‰ <strong>é¦–å…ˆï¼Œæ¯«æ— ç–‘é—®ï¼ˆæŸç‰©å¯ä»¥æé«˜æŸäººçš„å·¥ä½œ/å­¦ä¹ æ•ˆç‡ï¼Œä¸ºæˆ‘ä»¬çš„æ—¥å¸¸/å­¦æ ¡ç”Ÿæ´»æä¾›æå¤§çš„ä¾¿åˆ©ï¼‰</strong></p></li><li><p>è®ºæ®1ï¼šBased on the investigation of big data(Based on big data research), it can be found thatï¼Œa majority of (Accomplished individuals) admitted that theyâ€™ve spent most of their time doing sth <strong>é€šè¿‡å¤§æ•°æ®è°ƒæŸ¥å¯ä»¥å‘ç°ï¼Œå¤§å¤šæ•°ï¼ˆæˆåŠŸäººå£«ï¼‰æ‰¿è®¤ï¼Œä»–ä»¬å¤§éƒ¨åˆ†æ—¶é—´éƒ½èŠ±åœ¨åšæŸäº‹ä¸Š</strong></p></li><li><p>è®ºç‚¹2ï¼šMoreover,it has formed a consensus thatï¼ˆit has become a general consensusï¼‰ (by sth can acquire adequate knowledge and experience easily,it is an excellent way for sb to understand what they hope and need) <strong>è€Œä¸”ï¼Œè¿™å·²ç»å½¢æˆäº†ä¸€ä¸ªå…±è¯†ï¼Œå³ï¼ˆé€šè¿‡æŸäº‹å¯ä»¥è½»æ¾è·å¾—è¶³å¤Ÿçš„çŸ¥è¯†å’Œç»éªŒï¼Œè¿™æ˜¯è®©æŸäººäº†è§£ä»–ä»¬å¸Œæœ›å’Œéœ€è¦ä»€ä¹ˆçš„ç»ä½³æ–¹å¼ï¼‰</strong></p></li><li><p>è®ºç‚¹3ï¼šLast but not least,I sincerely believe that(by sth can facilitate communication and collaboration,which helpful <strong>in broadening</strong> ours horizons) <strong>æœ€åä½†åŒæ ·é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œæˆ‘çœŸè¯šåœ°ç›¸ä¿¡ï¼ˆé€šè¿‡æŸäº‹å¯ä»¥ä¿ƒè¿›æ²Ÿé€šå’Œåˆä½œï¼Œæœ‰åŠ©äºæ‹“å®½æˆ‘ä»¬çš„è§†é‡ï¼‰</strong></p></li></ul><p>ç»“å°¾</p><p>In short, the above statement can lead us reach a conclusion <strong>ç®€è€Œè¨€ä¹‹ï¼Œé€šè¿‡ä¸Šè¿°é™ˆè¿°æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®º</strong></p><p>sth is revolutionizing the way we live,it is predictable that if sb makes reasonable use of sth,the future of sth will be become more beautiful and hopeful <strong>æŸäº‹ç‰©æ­£åœ¨å½»åº•æ”¹å˜æˆ‘ä»¬æ¯ä¸ªäººçš„ç”Ÿæ´»æ–¹å¼ï¼Œå¯ä»¥é¢„è§ï¼Œå¦‚æœæŸäººåˆç†åœ°åˆ©ç”¨æŸäº‹ç‰©ï¼Œå…¶æœªæ¥å°†ä¼šå˜å¾—æ›´åŠ ç¾å¥½å’Œå……æ»¡å¸Œæœ›</strong></p>]]></content>
    
    
    <summary type="html">è‹±è¯­å…­çº§ç”Ÿè¯+ä½œæ–‡æ¨¡ç‰ˆ</summary>
    
    
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://itgeqian.github.io/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="è‹±è¯­å…­çº§" scheme="https://itgeqian.github.io/tags/%E8%8B%B1%E8%AF%AD%E5%85%AD%E7%BA%A7/"/>
    
  </entry>
  
  <entry>
    <title>å®éªŒä¸‰ æ±½è½¦ç§Ÿèµç³»ç»Ÿçš„UMLè®¾è®¡å»ºæ¨¡ ï¼ˆå®Œç»“ï¼‰</title>
    <link href="https://itgeqian.github.io/posts/1.html"/>
    <id>https://itgeqian.github.io/posts/1.html</id>
    <published>2025-05-20T04:19:03.000Z</published>
    <updated>2025-05-27T11:12:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€ã€å®éªŒç›®çš„åŠè¦æ±‚<br>å¯¹æ±½è½¦ç§Ÿèµç³»ç»Ÿè¿›è¡Œåˆ†æï¼Œåˆ©ç”¨ UML å·¥å…·è¿›è¡Œå»ºæ¨¡ã€‚<br>äºŒã€å®éªŒç¯å¢ƒ<br>å¾®å‹è®¡ç®—æœºã€Rational Rose<br>ä¸‰ã€å®éªŒå†…å®¹</p><ol><li>å¯¹æ±½è½¦ç§Ÿèµç³»ç»Ÿè¿›è¡Œéœ€æ±‚åˆ†æï¼Œå¹¶ç¡®å®šå…¶åŸºæœ¬æ¨¡å—ï¼Œå¦‚åŸºæœ¬æ•°æ®ç»´æŠ¤æ¨¡å—ã€åŸºæœ¬ä¸šåŠ¡<br>æ¨¡å—ã€æ•°æ®åº“æ¨¡å—ã€ä¿¡æ¯æŸ¥è¯¢æ¨¡å—ã€‚</li><li>ç¡®å®šç³»ç»Ÿä¸­çš„ç±»ï¼Œå¹¶ç”Ÿæˆç±»å›¾å’Œå„ä¸ªç±»ä¹‹é—´çš„å…³ç³»ã€‚</li><li>ç¡®å®š UML æ¨¡å‹æ¡†æ¶ï¼Œå¹¶ä½œå‡ºä»¥ä¸‹å„å›¾ï¼š<br>ï¼ˆ1ï¼‰ç³»ç»Ÿçš„ç”¨ä¾‹å›¾<br>ï¼ˆ2ï¼‰ç³»ç»Ÿçš„æ—¶åºå›¾<br>ï¼ˆ3ï¼‰ç³»ç»Ÿçš„åä½œå›¾<br>ï¼ˆ4ï¼‰ç³»ç»Ÿçš„æ´»åŠ¨å›¾<br>å››ã€å®éªŒæ­¥éª¤<br>1ï¼åˆ†æç³»ç»Ÿï¼Œå†™å‡ºç³»ç»Ÿçš„åŠŸèƒ½éœ€æ±‚åˆ†ææè¿°ã€‚<br>ï¼ˆ1ï¼‰åŸºæœ¬æ•°æ®ç»´æŠ¤æ¨¡å—åº”åŒ…æ‹¬ï¼š<br>æ·»åŠ è½¦è¾†ä¿¡æ¯ï¼›ä¿®æ”¹è½¦è¾†ä¿¡æ¯ï¼›æ·»åŠ å‘˜å·¥ä¿¡æ¯ï¼›ä¿®æ”¹å‘˜å·¥ä¿¡æ¯ç­‰ã€‚<br>ï¼ˆ2ï¼‰åŸºæœ¬ä¸šåŠ¡æ¨¡å—åº”åŒ…æ‹¬ï¼š<br>ç”¨æˆ·å¡«å†™é¢„å®šç”³è¯·ï¼›å·¥ä½œäººå‘˜å¤„ç†é¢„å®šè¯·æ±‚ï¼›æŠ€æœ¯äººå‘˜å¡«å†™æœåŠ¡çºªå½•ï¼›å·¥ä½œäººå‘˜å¤„ç†è¿˜<br>è½¦è¯·æ±‚ï¼›<br>ï¼ˆ3ï¼‰æ•°æ®åº“æ¨¡å—åº”åŒ…æ‹¬ï¼š<br>å®¢æˆ·ä¿¡æ¯ç®¡ç†ï¼›è½¦è¾†ä¿¡æ¯ç®¡ç†ï¼›ç§Ÿèµä¿¡æ¯ç®¡ç†ï¼›å‘˜å·¥ä¿¡æ¯ç®¡ç†ï¼›<br>ï¼ˆ4ï¼‰ä¿¡æ¯æŸ¥è¯¢æ¨¡å—åº”åŒ…æ‹¬ï¼š<br>æŸ¥è¯¢å®¢æˆ·ä¿¡æ¯ï¼›æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯ï¼›æŸ¥è¯¢è½¦è¾†ä¿¡æ¯ï¼›æŸ¥è¯¢å®¢æˆ·ç§Ÿè½¦è®°å½•ç­‰ï¼›</li><li>å»ºç«‹ UML æ¨¡å‹<br>åŒ…æ‹¬ç”¨ä¾‹å›¾ã€ç±»å›¾ã€æ—¶åºå›¾ã€æ´»åŠ¨å›¾ã€åä½œå›¾ã€çŠ¶æ€å›¾çš„æ„å»ºã€‚</li></ol><h2 id="å…·ä½“åˆ†æï¼š"><strong>å…·ä½“åˆ†æï¼š</strong></h2><h2 id="1-éœ€æ±‚åˆ†æéƒ¨åˆ†ï¼š">1.éœ€æ±‚åˆ†æéƒ¨åˆ†ï¼š</h2><h3 id="1-ç³»ç»Ÿçš„åŠŸèƒ½éœ€æ±‚åˆ†æ"><strong>1.ç³»ç»Ÿçš„åŠŸèƒ½éœ€æ±‚åˆ†æ</strong></h3><p>ï¼ˆ1ï¼‰åŸºæœ¬æ•°æ®ç»´æŠ¤æ¨¡å—åº”åŒ…æ‹¬ï¼š</p><p>æ·»åŠ è½¦è¾†ä¿¡æ¯ï¼›ä¿®æ”¹è½¦è¾†ä¿¡æ¯ï¼›æ·»åŠ å‘˜å·¥ä¿¡æ¯ï¼›ä¿®æ”¹å‘˜å·¥ä¿¡æ¯ç­‰ã€‚</p><p>ï¼ˆ2ï¼‰åŸºæœ¬ä¸šåŠ¡æ¨¡å—åº”åŒ…æ‹¬ï¼šç”¨æˆ·å¡«å†™é¢„å®šç”³è¯·ï¼›å·¥ä½œäººå‘˜å¤„ç†é¢„å®šè¯·æ±‚ï¼›æŠ€æœ¯äººå‘˜å¡«å†™æœåŠ¡çºªå½•ï¼›å·¥ä½œäººå‘˜å¤„ç†è¿˜è½¦è¯·æ±‚ï¼›<br>ï¼ˆ3ï¼‰æ•°æ®åº“æ¨¡å—åº”åŒ…æ‹¬ï¼šå®¢æˆ·ä¿¡æ¯ç®¡ç†ï¼›è½¦è¾†ä¿¡æ¯ç®¡ç†ï¼›ç§Ÿèµä¿¡æ¯ç®¡ç†ï¼›å‘˜å·¥ä¿¡æ¯ç®¡ç†ï¼›</p><p>ï¼ˆ4ï¼‰ä¿¡æ¯æŸ¥è¯¢æ¨¡å—åº”åŒ…æ‹¬ï¼šæŸ¥è¯¢å®¢æˆ·ä¿¡æ¯ï¼›æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯ï¼›æŸ¥è¯¢è½¦è¾†ä¿¡æ¯ï¼›æŸ¥è¯¢å®¢æˆ·ç§Ÿè½¦è®°å½•ç­‰ï¼›</p><h3 id="2-åŸºæœ¬æ•°æ®ç»´æŠ¤æ¨¡å—"><strong>2</strong>.åŸºæœ¬æ•°æ®ç»´æŠ¤æ¨¡å—</h3><p>åŸºæœ¬æ•°æ®ç»´æŠ¤æ¨¡å—æ˜¯æ±½è½¦ç§Ÿèµç³»ç»Ÿä¸­çš„åŸºç¡€åŠŸèƒ½æ¨¡å—ï¼Œä¸»è¦ç”¨äºç®¡ç†ä¸ç³»ç»Ÿè¿è¡Œç›¸å…³çš„åŸºç¡€æ•°æ®ï¼ŒåŒ…æ‹¬è½¦è¾†ä¿¡æ¯ä¸å‘˜å·¥ä¿¡æ¯çš„æ·»åŠ ã€ä¿®æ”¹ç­‰æ“ä½œã€‚è¯¥æ¨¡å—çš„è‰¯å¥½è®¾è®¡æœ‰åŠ©äºä¿æŒæ•°æ®ä¸€è‡´æ€§å’Œç³»ç»Ÿç¨³å®šæ€§ï¼Œä¸ºåç»­ä¸šåŠ¡æ“ä½œæä¾›æ•°æ®æ”¯æŒã€‚</p><p>ï¼ˆ1ï¼‰æ·»åŠ æ±½è½¦ä¿¡æ¯ï¼šæ±½è½¦ç§Ÿè˜å¤„çš„è½¦è¾†ä¿¡æ¯å…¨éƒ¨ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œç¡®ä¿åç»­ç§Ÿèµã€ç»´æŠ¤ã€æŸ¥è¯¢ç­‰æ“ä½œèƒ½å‡†ç¡®å®šä½ç›®æ ‡è½¦è¾†ã€‚<br>åº”åŒ…æ‹¬ä»¥ä¸‹å­—æ®µï¼š</p><ul><li>è½¦è¾†ç¼–å·ï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰</li><li>å“ç‰Œå‹å·ï¼ˆå¦‚ï¼šä¸°ç”°å‡¯ç¾ç‘ï¼‰</li><li>è½¦ç‰Œå·ç </li><li>é¢œè‰²</li><li>ç±»å‹ï¼ˆè½¿è½¦/è¶Šé‡è½¦/å•†åŠ¡è½¦ç­‰ï¼‰</li><li>æ—¥ç§Ÿé‡‘</li><li>å½“å‰çŠ¶æ€ï¼ˆç©ºé—²/ç§Ÿèµä¸­/ç»´æŠ¤ä¸­ï¼‰</li></ul><p>åŠŸèƒ½éœ€æ±‚ï¼š</p><ul><li>ä¿¡æ¯æäº¤åï¼Œåº”è‡ªåŠ¨å­˜å…¥è½¦è¾†ä¿¡æ¯è¡¨ä¸­ã€‚</li><li>ç³»ç»Ÿç®¡ç†å‘˜ç™»å½•åå¯é€šè¿‡å›¾å½¢ç•Œé¢å¡«å†™è½¦è¾†ä¿¡æ¯ã€‚</li><li>ç³»ç»Ÿåº”å¯¹è½¦è¾†ç¼–å·ã€è½¦ç‰Œå·è¿›è¡Œå”¯ä¸€æ€§æ ¡éªŒã€‚</li></ul><p>ï¼ˆ2ï¼‰ä¿®æ”¹è½¦è¾†ä¿¡æ¯ï¼šç”±äºè½¦è¾†ä¿¡æ¯å¯èƒ½å‘ç”Ÿå˜æ›´ï¼ˆå¦‚çŠ¶æ€å˜æ›´ã€æ—¥ç§Ÿé‡‘è°ƒæ•´ç­‰ï¼‰ï¼Œç³»ç»Ÿåº”æ”¯æŒå¯¹å·²æœ‰è½¦è¾†ä¿¡æ¯çš„ä¿®æ”¹ã€‚</p><p>åŠŸèƒ½éœ€æ±‚ï¼š</p><ul><li>ç³»ç»Ÿæä¾›æŒ‰è½¦ç‰Œå·æˆ–è½¦è¾†ç¼–å·çš„æŸ¥è¯¢åŠŸèƒ½ã€‚</li><li>æ”¯æŒå¯¹è½¦è¾†çŠ¶æ€ã€æ—¥ç§Ÿé‡‘ç­‰å­—æ®µçš„ä¿®æ”¹ã€‚</li></ul><p>ï¼ˆ3ï¼‰æ·»åŠ å‘˜å·¥ä¿¡æ¯ï¼šä¸ºæ”¯æŒç³»ç»Ÿæ“ä½œã€å®¢æˆ·æœåŠ¡ç­‰åŠŸèƒ½ï¼Œæ‰€æœ‰å‘˜å·¥çš„ä¿¡æ¯éœ€å½•å…¥ç³»ç»Ÿã€‚</p><p>åº”åŒ…æ‹¬ä»¥ä¸‹å­—æ®µï¼š</p><ul><li>å‘˜å·¥ç¼–å·ï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰</li><li>å§“å</li><li>å²—ä½ï¼ˆå¦‚ï¼šç®¡ç†å‘˜ã€æŠ€æœ¯äººå‘˜ã€å®¢æœäººå‘˜ï¼‰</li><li>è”ç³»ç”µè¯</li><li>å…¥èŒæ—¥æœŸ</li></ul><p>åŠŸèƒ½éœ€æ±‚ï¼š</p><ul><li>ä¿¡æ¯éªŒè¯åä¿å­˜è‡³å‘˜å·¥ä¿¡æ¯è¡¨ä¸­ã€‚</li><li>ç”±ç®¡ç†å‘˜æ·»åŠ å‘˜å·¥ä¿¡æ¯ã€‚</li><li>å‘˜å·¥ç¼–å·è‡ªåŠ¨ç”Ÿæˆæˆ–æ‰‹åŠ¨å½•å…¥ï¼Œç¡®ä¿å”¯ä¸€æ€§ã€‚</li></ul><p>ï¼ˆ4ï¼‰ä¿®æ”¹å‘˜å·¥ä¿¡æ¯</p><p>ä¸ºåº”å¯¹å‘˜å·¥å²—ä½è°ƒæ•´ã€è”ç³»æ–¹å¼å˜æ›´ç­‰æƒ…å†µï¼Œç³»ç»Ÿåº”æ”¯æŒå‘˜å·¥ä¿¡æ¯çš„ç»´æŠ¤ä¸æ›´æ–°ã€‚</p><p>åŠŸèƒ½éœ€æ±‚ï¼š</p><ul><li>ä¿®æ”¹è®°å½•åº”è‡ªåŠ¨å­˜æ¡£ä»¥å¤‡è¿½è¸ªã€‚</li><li>æ”¯æŒé€šè¿‡å‘˜å·¥ç¼–å·æŸ¥è¯¢ç›®æ ‡å‘˜å·¥ã€‚</li><li>å¯ä¿®æ”¹å§“åã€è”ç³»æ–¹å¼ã€å²—ä½ç­‰å†…å®¹ã€‚</li></ul><h3 id="3-åŸºæœ¬ä¸šåŠ¡æ¨¡å—"><strong>3.åŸºæœ¬ä¸šåŠ¡æ¨¡å—</strong></h3><p>åŸºæœ¬ä¸šåŠ¡æ¨¡å—æ˜¯æ±½è½¦ç§Ÿèµç³»ç»Ÿä¸­æœ€æ ¸å¿ƒçš„åŠŸèƒ½æ¿å—ï¼Œæ¶‰åŠç”¨æˆ·ä¸ç³»ç»Ÿä¹‹é—´çš„äº¤äº’è¡Œä¸ºï¼Œè¦†ç›–ç§Ÿèµå…¨è¿‡ç¨‹çš„æ“ä½œï¼ŒåŒ…æ‹¬é¢„å®šã€è½¦è¾†æœåŠ¡ã€è¿˜è½¦ç­‰ç¯èŠ‚ã€‚</p><p>ï¼ˆ1ï¼‰ç”¨æˆ·å¡«å†™é¢„å®šç”³è¯·ï¼š</p><p>ç”¨æˆ·åœ¨ç³»ç»Ÿä¸­å‘èµ·ç§Ÿè½¦è¯·æ±‚ï¼Œå¡«å†™æ‰€éœ€ç§Ÿèµçš„è½¦è¾†ç±»å‹ã€èµ·æ­¢æ—¶é—´ç­‰ä¿¡æ¯ï¼Œç³»ç»Ÿå°†è®°å½•å¹¶ç­‰å¾…å·¥ä½œäººå‘˜å¤„ç†ã€‚</p><blockquote><p><strong>åŠŸèƒ½éœ€æ±‚ï¼š</strong></p><ul><li>é¢„å®šä¿¡æ¯å¯ç”±ç”¨æˆ·éšæ—¶æŸ¥çœ‹å’Œå–æ¶ˆï¼ˆåœ¨å®¡æ ¸å‰ï¼‰ã€‚</li><li>ç”¨æˆ·ç™»å½•åå¯è¿›å…¥â€œè½¦è¾†é¢„å®šâ€ç•Œé¢ï¼›</li><li>å¡«å†™é¢„å®šè¡¨å•å†…å®¹ï¼šç§Ÿè½¦äººä¿¡æ¯ã€ç§Ÿèµæ—¶é—´æ®µã€æ‰€éœ€è½¦å‹ã€ç”¨é€”è¯´æ˜ç­‰ï¼›</li><li>ç³»ç»Ÿè‡ªåŠ¨æ£€ç´¢å¯¹åº”æ—¶é—´æ®µå†…å¯ç§Ÿè½¦è¾†ï¼›</li><li>æäº¤æˆåŠŸåï¼Œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆé¢„å®šè®°å½•ï¼ŒçŠ¶æ€ä¸ºâ€œå¾…å¤„ç†â€ï¼›</li></ul></blockquote><p>ï¼ˆ2ï¼‰å·¥ä½œäººå‘˜å¤„ç†é¢„å®šè¯·æ±‚ï¼š</p><p>å·¥ä½œäººå‘˜è´Ÿè´£å®¡æ ¸ç”¨æˆ·é¢„å®šè¯·æ±‚ï¼Œç¡®è®¤è½¦è¾†çŠ¶æ€ï¼Œå¹¶å°†çŠ¶æ€å˜æ›´ä¸ºâ€œå·²é¢„å®šâ€æˆ–â€œæ‹’ç»â€ã€‚</p><p><strong>åŠŸèƒ½éœ€æ±‚ï¼š</strong></p><ul><li>å®¡æ ¸é€šè¿‡çš„é¢„å®šä¼šé”å®šå¯¹åº”è½¦è¾†çš„æ—¶é—´æ®µçŠ¶æ€ã€‚</li><li>å·¥ä½œäººå‘˜ç™»å½•åå¯æŸ¥çœ‹æ‰€æœ‰â€œå¾…å¤„ç†â€çš„é¢„å®šç”³è¯·ï¼›</li><li>æ”¯æŒæŒ‰æ—¥æœŸã€ç”¨æˆ·ã€è½¦è¾†ç±»å‹ç­‰æ¡ä»¶ç­›é€‰ï¼›</li><li>å¯è¿›è¡Œâ€œé€šè¿‡â€æˆ–â€œæ‹’ç»â€æ“ä½œï¼Œå¹¶æ·»åŠ å¤„ç†å¤‡æ³¨ï¼›</li><li>å¤„ç†å®Œæˆåï¼Œç³»ç»Ÿå°†é€šçŸ¥ç”¨æˆ·å®¡æ ¸ç»“æœï¼›</li></ul><p>ï¼ˆ3ï¼‰æŠ€æœ¯äººå‘˜å¡«å†™æœåŠ¡è®°å½•ï¼š</p><p>æŠ€æœ¯äººå‘˜åœ¨è½¦è¾†ä½¿ç”¨å‰/åè¿›è¡Œæ£€æŸ¥ï¼Œå¡«å†™è½¦è¾†ç»´æŠ¤ä¸æ£€æµ‹è®°å½•ï¼Œä¿éšœè½¦è¾†å®‰å…¨ä¸çŠ¶æ€ä¿¡æ¯å‡†ç¡®ã€‚</p><p><strong>åŠŸèƒ½éœ€æ±‚ï¼š</strong></p><ul><li>ç™»å½•ç³»ç»Ÿåï¼Œå¯æŸ¥è¯¢å¹¶é€‰æ‹©éœ€è¦ç»´æŠ¤è®°å½•çš„è½¦è¾†ï¼›</li><li>å¡«å†™å†…å®¹åŒ…æ‹¬ï¼šæ£€æŸ¥æ—¥æœŸã€æ£€æŸ¥äººã€è½¦è¾†çŠ¶å†µã€å»ºè®®ç»´ä¿®ã€æ˜¯å¦å¯ç§Ÿç­‰ï¼›</li><li>æäº¤åï¼Œç³»ç»Ÿæ›´æ–°è½¦è¾†çŠ¶æ€ï¼ˆå¯ç§Ÿ/éœ€ç»´æŠ¤ï¼‰ï¼›</li><li>æœåŠ¡è®°å½•ä¿å­˜è‡³è½¦è¾†æœåŠ¡å†å²ä¸­ã€‚</li></ul><p>ï¼ˆ4ï¼‰å·¥ä½œäººå‘˜å¤„ç†è¿˜è½¦è¯·æ±‚ï¼š</p><p>ç§ŸèµæœŸç»“æŸï¼Œç”¨æˆ·å½’è¿˜è½¦è¾†ï¼Œå·¥ä½œäººå‘˜éœ€æ ¸å¯¹è½¦è¾†çŠ¶å†µï¼Œå¹¶æ›´æ–°è½¦è¾†ä½¿ç”¨ä¿¡æ¯åŠç§Ÿèµè®°å½•ã€‚ï¼ˆæ ¹æ®ç§Ÿèµæ—¶é—´å’Œè½¦è¾†ä½¿ç”¨çŠ¶æ€æ”¶å–ç§Ÿèµè´¹ï¼Œå¦‚æœè½¦è¾†æœ‰æŸåæ”¶å–ä¸€å®šçš„ç½šé‡‘ï¼‰</p><p><strong>åŠŸèƒ½éœ€æ±‚ï¼š</strong></p><ul><li>å½’è¿˜ä¿¡æ¯åŒæ­¥åˆ°ç§Ÿèµå†å²è®°å½•ä¸­ã€‚</li><li>ç³»ç»Ÿæä¾›â€œè¿˜è½¦å¤„ç†â€ç•Œé¢ï¼›</li><li>å·¥ä½œäººå‘˜è¾“å…¥è½¦è¾†ç¼–å·æˆ–ç§Ÿèµå•å·æŸ¥è¯¢ï¼›</li><li>æ ¸å¯¹è½¦è¾†å½’è¿˜æ—¶é—´ã€æ²¹é‡ã€è½¦å†µã€è¿ç« ç­‰æƒ…å†µï¼›</li><li>è®¡ç®—æœ€ç»ˆç§Ÿèµè´¹ç”¨ï¼ˆæŒ‰æ—¥ç§Ÿé‡‘Ã—å¤©æ•°+å…¶ä»–è´¹ç”¨ï¼‰ï¼›</li><li>å¦‚è‹¥è½¦è¾†æ— è¯¯ç³»ç»Ÿè‡ªåŠ¨å°†ç§Ÿèµè®°å½•å½’æ¡£ï¼Œè½¦è¾†çŠ¶æ€æ›´æ–°ä¸ºâ€œç©ºé—²â€ï¼›</li><li>å¦‚è‹¥è½¦è¾†æœ‰æŸåï¼Œæ”¶å–ä¸€å®šçš„ç½šé‡‘ï¼Œå°†è½¦è¾†é€å¾€ç»´ä¿®å‚ï¼Œè½¦è¾†çŠ¶æ€æ›´æ–°ä¸ºâ€œç»´æŠ¤ä¸­â€</li></ul><h3 id="4-æ•°æ®åº“æ¨¡å—"><strong>4.æ•°æ®åº“æ¨¡å—</strong></h3><p>æ•°æ®åº“æ¨¡å—æ˜¯æ•´ä¸ªæ±½è½¦ç§Ÿèµç³»ç»Ÿçš„æ•°æ®æ ¸å¿ƒï¼Œè´Ÿè´£ç³»ç»Ÿä¸­å„ç±»ä¿¡æ¯çš„å­˜å‚¨ã€ç®¡ç†å’Œè°ƒç”¨ã€‚é€šè¿‡ç§‘å­¦çš„æ•°æ®ç»“æ„è®¾è®¡ä¸æ•°æ®è¡¨ç®¡ç†ï¼Œç¡®ä¿ç³»ç»Ÿé«˜æ•ˆã€ç¨³å®šã€å®‰å…¨è¿è¡Œï¼Œä¸ºä¸šåŠ¡æ¨¡å—æä¾›æ”¯æ’‘ã€‚</p><h4 id="ï¼ˆ1ï¼‰å®¢æˆ·ä¿¡æ¯ç®¡ç†ï¼š">ï¼ˆ1ï¼‰å®¢æˆ·ä¿¡æ¯ç®¡ç†ï¼š</h4><p>ç”¨äºå­˜å‚¨å’Œç®¡ç†å®¢æˆ·çš„åŸºæœ¬èµ„æ–™ï¼Œæ˜¯ç§Ÿèµæµç¨‹ä¸­ç”¨æˆ·è¯†åˆ«ä¸ä¿¡ç”¨è¿½è¸ªçš„é‡è¦ä¾æ®ã€‚</p><p><strong>ä¸»è¦å­—æ®µåŒ…æ‹¬ï¼š</strong></p><ul><li>å®¢æˆ·ç¼–å·ï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰</li><li>å§“å</li><li>æ€§åˆ«</li><li>èº«ä»½è¯å·/é©¾ç…§å·</li><li>è”ç³»æ–¹å¼</li><li>æ³¨å†Œæ—¥æœŸ</li><li>ç§Ÿèµå†å²è®°å½•</li><li>å¤‡æ³¨ï¼ˆå¦‚è¿ç« è®°å½•ã€é»‘åå•ç­‰ï¼‰</li></ul><p><strong>åŠŸèƒ½éœ€æ±‚ï¼š</strong></p><ul><li>æ”¯æŒæ·»åŠ ã€æŸ¥è¯¢ã€ä¿®æ”¹å®¢æˆ·ä¿¡æ¯ï¼›</li><li>å®¢æˆ·ä¿¡æ¯åœ¨æ³¨å†Œæˆ–é¦–æ¬¡ç§Ÿèµæ—¶å½•å…¥ï¼›</li><li>ç³»ç»Ÿå¯æ ¹æ®å®¢æˆ·ç¼–å·æˆ–è¯ä»¶å·è¿›è¡Œå”¯ä¸€æ€§æ ¡éªŒï¼›</li><li>æ•æ„Ÿä¿¡æ¯åº”åŠ å¯†å­˜å‚¨ï¼Œä¿éšœæ•°æ®å®‰å…¨ã€‚</li></ul><h4 id="ï¼ˆ2ï¼‰è½¦è¾†ä¿¡æ¯ç®¡ç†ï¼š">ï¼ˆ2ï¼‰è½¦è¾†ä¿¡æ¯ç®¡ç†ï¼š</h4><p>ç”¨äºç»´æŠ¤ç³»ç»Ÿä¸­æ‰€æœ‰è½¦è¾†çš„è¯¦ç»†èµ„æ–™ï¼Œæ˜¯æ”¯æ’‘é¢„å®šã€è¿˜è½¦ã€æŸ¥è¯¢ã€æœåŠ¡ç­‰æ¨¡å—çš„å…³é”®æ•°æ®æ¥æºã€‚</p><p><strong>ä¸»è¦å­—æ®µåŒ…æ‹¬ï¼š</strong></p><ul><li>è½¦è¾†ç¼–å·</li><li>å“ç‰Œå‹å·</li><li>è½¦ç‰Œå·ç </li><li>ç±»å‹</li><li>å½“å‰çŠ¶æ€ï¼ˆç©ºé—²/ç§Ÿèµä¸­/ç»´æŠ¤ä¸­ï¼‰</li><li>æ—¥ç§Ÿé‡‘</li></ul><p><strong>åŠŸèƒ½éœ€æ±‚ï¼š</strong></p><ul><li>æ‰€æœ‰è½¦è¾†åœ¨å½•å…¥ç³»ç»Ÿæ—¶è‡ªåŠ¨ç”Ÿæˆè®°å½•ï¼›</li><li>çŠ¶æ€å­—æ®µæ ¹æ®ä¸šåŠ¡æµç¨‹åŠ¨æ€æ›´æ–°ï¼›</li><li>æ”¯æŒæŒ‰è½¦å‹ã€çŠ¶æ€ã€ç¼–å·ç­‰æ¡ä»¶æŸ¥è¯¢ï¼›</li><li>å¯å¯¹è½¦è¾†ä¿¡æ¯è¿›è¡Œæ›´æ–°ï¼ˆå¦‚ç§Ÿé‡‘è°ƒæ•´ã€çŠ¶æ€æ›´æ”¹ï¼‰ã€‚</li></ul><h4 id="ï¼ˆ3ï¼‰ç§Ÿèµä¿¡æ¯ç®¡ç†ï¼š">ï¼ˆ3ï¼‰ç§Ÿèµä¿¡æ¯ç®¡ç†ï¼š</h4><p>ç”¨äºè®°å½•æ¯ä¸€æ¬¡ç§Ÿèµäº¤æ˜“çš„å®Œæ•´æ•°æ®ï¼ŒåŒ…æ‹¬å®¢æˆ·ã€è½¦è¾†ã€æ—¶é—´æ®µã€è´¹ç”¨ç­‰ï¼Œæ˜¯ç»Ÿè®¡ã€æŠ¥è¡¨ã€è¿½è´£ç­‰åŠŸèƒ½çš„ä¾æ®ã€‚</p><p><strong>ä¸»è¦å­—æ®µåŒ…æ‹¬ï¼š</strong></p><ul><li>ç§Ÿèµç¼–å·ï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰</li><li>å®¢æˆ·ç¼–å·</li><li>è½¦è¾†ç¼–å·</li><li>èµ·ç§Ÿæ—¶é—´</li><li>å½’è¿˜æ—¶é—´</li><li>å®é™…å½’è¿˜æ—¶é—´</li><li>æ€»è´¹ç”¨</li><li>ç§ŸèµçŠ¶æ€ï¼ˆå·²å®Œæˆ/æœªè¿˜è½¦/é€¾æœŸç­‰ï¼‰</li><li>è¿ç« æˆ–æŸåè®°å½•ï¼ˆå¦‚æœ‰ï¼‰</li></ul><p><strong>åŠŸèƒ½éœ€æ±‚ï¼š</strong></p><ul><li>æ¯æ¬¡æˆåŠŸé¢„å®šåç”Ÿæˆç§Ÿèµè®°å½•ï¼›</li><li>è®°å½•è½¦è¾†çš„å®é™…å½’è¿˜æƒ…å†µä¸è´¹ç”¨ï¼›</li><li>å¯æŒ‰å®¢æˆ·ã€è½¦è¾†ã€æ—¶é—´æ®µç­‰æŸ¥è¯¢å†å²ç§Ÿèµè®°å½•ï¼›</li><li>é‡è¦å­—æ®µä¸å…è®¸æ“…è‡ªä¿®æ”¹ï¼Œä¿éšœæ•°æ®ä¸€è‡´æ€§ã€‚</li></ul><h4 id="ï¼ˆ4ï¼‰å‘˜å·¥ä¿¡æ¯ç®¡ç†ï¼š">ï¼ˆ4ï¼‰å‘˜å·¥ä¿¡æ¯ç®¡ç†ï¼š</h4><p>ç”¨äºç»´æŠ¤ç³»ç»Ÿä¸­æ‰€æœ‰å·¥ä½œäººå‘˜çš„æ•°æ®ï¼Œåˆ†ä¸ºä¸åŒå²—ä½æƒé™ï¼Œä¸ºåå°ç®¡ç†æ“ä½œå’Œåˆ†å·¥åä½œæä¾›ä¾æ®ã€‚</p><p><strong>ä¸»è¦å­—æ®µåŒ…æ‹¬ï¼š</strong></p><ul><li>å‘˜å·¥ç¼–å·</li><li>å§“å</li><li>è”ç³»ç”µè¯</li><li>å²—ä½ï¼ˆç®¡ç†å‘˜/å®¢æœ/æŠ€æœ¯äººå‘˜ç­‰ï¼‰</li><li>ç™»å½•è´¦å·</li><li>å¯†ç ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰</li><li>å…¥èŒæ—¶é—´</li></ul><p><strong>åŠŸèƒ½éœ€æ±‚ï¼š</strong></p><ul><li>ç®¡ç†å‘˜å…·å¤‡æ·»åŠ ã€ä¿®æ”¹å‘˜å·¥ä¿¡æ¯æƒé™ï¼›</li><li>ç³»ç»Ÿç™»å½•éœ€æ ¹æ®å‘˜å·¥è´¦å·è¿›è¡Œæƒé™éªŒè¯ï¼›</li><li>æ”¯æŒå²—ä½æƒé™ç®¡ç†ï¼Œä¸åŒå²—ä½è®¿é—®ç³»ç»Ÿä¸åŒæ¨¡å—ï¼›</li><li>å¯æŒ‰å‘˜å·¥ç¼–å·ã€å§“åç­‰æ¡ä»¶æ£€ç´¢ã€‚</li></ul><h3 id="5-ä¿¡æ¯æŸ¥è¯¢æ¨¡å—"><strong>5.ä¿¡æ¯æŸ¥è¯¢æ¨¡å—</strong></h3><p>ä¿¡æ¯æŸ¥è¯¢æ¨¡å—ä¸ºç”¨æˆ·ä¸å·¥ä½œäººå‘˜æä¾›é«˜æ•ˆã€ä¾¿æ·çš„æ•°æ®æ£€ç´¢æœåŠ¡ï¼Œæ”¯æŒå¯¹å®¢æˆ·ã€å‘˜å·¥ã€è½¦è¾†åŠç§Ÿèµè®°å½•ç­‰ä¿¡æ¯çš„å¤šç»´åº¦æŸ¥è¯¢ï¼Œç¡®ä¿ç³»ç»Ÿæ•°æ®çš„å¯è®¿é—®æ€§å’Œé€æ˜åº¦ã€‚æœ¬æ¨¡å—æ˜¯ç³»ç»Ÿæ“ä½œè¿‡ç¨‹ä¸­çš„é‡è¦è¾…åŠ©åŠŸèƒ½ã€‚</p><h4 id="ï¼ˆ1ï¼‰æŸ¥è¯¢å®¢æˆ·ä¿¡æ¯ï¼š">ï¼ˆ1ï¼‰æŸ¥è¯¢å®¢æˆ·ä¿¡æ¯ï¼š</h4><p>å·¥ä½œäººå‘˜æˆ–ç®¡ç†å‘˜å¯æ ¹æ®å®¢æˆ·ä¿¡æ¯è¿›è¡Œå¿«é€Ÿå®šä½ä¸æ ¸æŸ¥ã€‚</p><p><strong>åŠŸèƒ½éœ€æ±‚ï¼š</strong></p><ul><li>æ”¯æŒæŒ‰å®¢æˆ·ç¼–å·ã€å§“åã€èº«ä»½è¯å·/é©¾ç…§å·ç­‰æ¡ä»¶æ¨¡ç³Šæˆ–ç²¾ç¡®æŸ¥è¯¢ï¼›</li><li>å±•ç¤ºå®¢æˆ·åŸºæœ¬ä¿¡æ¯ã€è”ç³»æ–¹å¼ã€æ³¨å†Œæ—¶é—´ã€ç´¯è®¡ç§Ÿèµæ¬¡æ•°ç­‰ï¼›</li><li>å¯æŸ¥çœ‹è¯¥å®¢æˆ·æ‰€æœ‰å†å²ç§Ÿèµè®°å½•ï¼›</li><li>æä¾›é»‘åå•æˆ–è¿ç« è®°å½•çš„æ ‡æ³¨æç¤ºã€‚</li></ul><h4 id="ï¼ˆ2ï¼‰æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯ï¼š">ï¼ˆ2ï¼‰æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯ï¼š</h4><p>ç®¡ç†å‘˜ç”¨äºç®¡ç†å‘˜å·¥çš„èº«ä»½ã€å²—ä½ã€æƒé™ç­‰ä¿¡æ¯ã€‚</p><p><strong>åŠŸèƒ½éœ€æ±‚ï¼š</strong></p><ul><li>å¯æ ¹æ®å‘˜å·¥ç¼–å·ã€å§“åã€å²—ä½è¿›è¡ŒæŸ¥è¯¢ï¼›</li><li>å±•ç¤ºå‘˜å·¥åŸºæœ¬èµ„æ–™ã€è”ç³»æ–¹å¼ã€æ‰€å±å²—ä½åŠå…¥èŒæ—¥æœŸï¼›</li><li>æä¾›å²—ä½æƒé™ä¿¡æ¯ï¼Œåˆ¤æ–­å‘˜å·¥æ˜¯å¦å…·å¤‡æŸé¡¹æ“ä½œæƒé™ï¼›</li><li>å¯å¯¼å‡ºå‘˜å·¥ä¿¡æ¯è¡¨ä½œä¸ºç®¡ç†èµ„æ–™ã€‚</li></ul><h4 id="ï¼ˆ3ï¼‰æŸ¥è¯¢è½¦è¾†ä¿¡æ¯ï¼š">ï¼ˆ3ï¼‰æŸ¥è¯¢è½¦è¾†ä¿¡æ¯ï¼š</h4><p>ä¾¿äºç”¨æˆ·é€‰æ‹©åˆé€‚è½¦è¾†åŠå·¥ä½œäººå‘˜æŒæ¡è½¦è¾†è¿è¥çŠ¶æ€ã€‚</p><p><strong>åŠŸèƒ½éœ€æ±‚ï¼š</strong></p><ul><li>æ”¯æŒæŒ‰è½¦è¾†ç¼–å·ã€å“ç‰Œå‹å·ã€è½¦ç‰Œå·ã€è½¦è¾†ç±»å‹ã€å½“å‰çŠ¶æ€ç­‰æŸ¥è¯¢æ¡ä»¶ï¼›</li><li>å±•ç¤ºè½¦è¾†çš„åŸºæœ¬ä¿¡æ¯ã€å½“å‰çŠ¶æ€ã€æ˜¯å¦å¯ç§Ÿã€æ—¥ç§Ÿé‡‘ç­‰ï¼›</li><li>æä¾›è½¦è¾†å†å²æœåŠ¡è®°å½•åŠç»´ä¿®è®°å½•æŸ¥çœ‹æ¥å£ï¼›</li><li>æ”¯æŒçŠ¶æ€ç­›é€‰ï¼ˆä»…æŸ¥çœ‹â€œç©ºé—²â€è½¦è¾†ã€ä»…æŸ¥çœ‹â€œç»´ä¿®ä¸­â€è½¦è¾†ç­‰ï¼‰ï¼›</li><li>å¯å°†è½¦è¾†æŸ¥è¯¢ç»“æœå¯¼å‡ºä¸ºè¡¨æ ¼æˆ–æ‰“å°ã€‚</li></ul><h4 id="ï¼ˆ4ï¼‰æŸ¥è¯¢å®¢æˆ·ç§Ÿè½¦è®°å½•ï¼š">ï¼ˆ4ï¼‰æŸ¥è¯¢å®¢æˆ·ç§Ÿè½¦è®°å½•ï¼š</h4><p>ç”¨äºå®¢æˆ·æœåŠ¡ã€ä¿¡ç”¨è¯„ä¼°ã€å¼‚å¸¸äº¤æ˜“è¿½è¸ªç­‰ç›®çš„ã€‚</p><p><strong>åŠŸèƒ½éœ€æ±‚ï¼š</strong></p><ul><li>å¯æŒ‰å®¢æˆ·ç¼–å·ã€å§“åè¿›è¡ŒæŸ¥è¯¢ï¼›</li><li>å±•ç¤ºæ‰€æœ‰å†å²ç§Ÿè½¦è®°å½•ï¼ŒåŒ…æ‹¬ç§Ÿèµæ—¶é—´æ®µã€è½¦è¾†ä¿¡æ¯ã€è´¹ç”¨ã€å½’è¿˜æƒ…å†µï¼›</li><li>æ”¯æŒå¯¹ç§ŸèµçŠ¶æ€ï¼ˆå·²å®Œæˆ/é€¾æœŸ/æœªè¿˜ï¼‰è¿›è¡Œç­›é€‰ï¼›</li><li>è®°å½•ä¸­åº”åŒ…å«æ¯æ¬¡ç§Ÿè½¦çš„æœåŠ¡æƒ…å†µã€æ˜¯å¦å­˜åœ¨è¿ç« æˆ–æŸåï¼›</li><li>å¯å¯¼å‡ºç§Ÿèµè®°å½•æ˜ç»†ç”¨äºå¯¹è´¦ã€å¤‡ä»½æˆ–è¿½è´£ã€‚</li></ul><h2 id="2-ç”¨ä¾‹å›¾è®¾è®¡">2.ç”¨ä¾‹å›¾è®¾è®¡</h2><h3 id="1-1-å‚ä¸è€…ï¼ˆActorsï¼‰">1.1 å‚ä¸è€…ï¼ˆActorsï¼‰</h3><p>ç³»ç»Ÿä¸­ä¸»è¦çš„å‚ä¸è€…æœ‰ï¼š</p><ul><li><strong>å®¢æˆ·ï¼ˆCustomerï¼‰</strong>ï¼šä½¿ç”¨ç³»ç»Ÿæäº¤é¢„å®šã€æŸ¥è¯¢ç§Ÿè½¦è®°å½•ç­‰ã€‚</li><li><strong>å·¥ä½œäººå‘˜ï¼ˆStaffï¼‰</strong>ï¼šè´Ÿè´£å®¡æ ¸é¢„å®šã€å¤„ç†è¿˜è½¦ç­‰ã€‚</li><li><strong>æŠ€æœ¯äººå‘˜ï¼ˆTechnicianï¼‰</strong>ï¼šè´Ÿè´£å¡«å†™æœåŠ¡è®°å½•ï¼Œæ›´æ–°è½¦è¾†çŠ¶æ€ã€‚</li><li><strong>ç®¡ç†å‘˜ï¼ˆAdminï¼‰</strong>ï¼šè´Ÿè´£ç³»ç»Ÿæ•°æ®ç»´æŠ¤ï¼ŒåŒ…æ‹¬æ·»åŠ /ä¿®æ”¹å‘˜å·¥å’Œè½¦è¾†ä¿¡æ¯ã€‚</li></ul><h3 id="1-2-ç³»ç»Ÿä¸»è¦ç”¨ä¾‹ï¼ˆUse-Casesï¼‰">1.2 ç³»ç»Ÿä¸»è¦ç”¨ä¾‹ï¼ˆUse Casesï¼‰</h3><p>å°†å‰é¢åˆ†æè¿‡çš„åŠŸèƒ½æ¨¡å—è½¬åŒ–ä¸ºç”¨ä¾‹ï¼š</p><h4 id="ï¼ˆ1ï¼‰åŸºæœ¬æ•°æ®ç»´æŠ¤">ï¼ˆ1ï¼‰åŸºæœ¬æ•°æ®ç»´æŠ¤</h4><ul><li>æ·»åŠ è½¦è¾†ä¿¡æ¯</li><li>ä¿®æ”¹è½¦è¾†ä¿¡æ¯</li><li>æ·»åŠ å‘˜å·¥ä¿¡æ¯</li><li>ä¿®æ”¹å‘˜å·¥ä¿¡æ¯</li></ul><h4 id="ï¼ˆ2ï¼‰åŸºæœ¬ä¸šåŠ¡æ“ä½œ">ï¼ˆ2ï¼‰åŸºæœ¬ä¸šåŠ¡æ“ä½œ</h4><ul><li>å¡«å†™ç§Ÿè½¦é¢„å®šç”³è¯·</li><li>å®¡æ ¸é¢„å®šè¯·æ±‚</li><li>å¡«å†™è½¦è¾†æœåŠ¡è®°å½•</li><li>å¤„ç†è¿˜è½¦è¯·æ±‚</li></ul><h4 id="ï¼ˆ3ï¼‰ä¿¡æ¯æŸ¥è¯¢">ï¼ˆ3ï¼‰ä¿¡æ¯æŸ¥è¯¢</h4><ul><li>æŸ¥è¯¢å®¢æˆ·ä¿¡æ¯</li><li>æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯</li><li>æŸ¥è¯¢è½¦è¾†ä¿¡æ¯</li><li>æŸ¥è¯¢å®¢æˆ·ç§Ÿè½¦è®°å½•</li></ul><h3 id="1-3-å‚ä¸è€…ä¸ç”¨ä¾‹ä¹‹é—´çš„å…³ç³»">1.3 å‚ä¸è€…ä¸ç”¨ä¾‹ä¹‹é—´çš„å…³ç³»</h3><table><thead><tr><th>å‚ä¸è€…</th><th>å¯æ‰§è¡Œçš„ç”¨ä¾‹</th></tr></thead><tbody><tr><td>å®¢æˆ·</td><td>å¡«å†™ç§Ÿè½¦é¢„å®šç”³è¯·ã€æŸ¥è¯¢å®¢æˆ·ç§Ÿè½¦è®°å½•</td></tr><tr><td>æ™®é€šå·¥ä½œäººå‘˜ï¼ˆå®¢æœï¼‰</td><td>å®¡æ ¸é¢„å®šè¯·æ±‚ã€å¤„ç†è¿˜è½¦è¯·æ±‚ã€æŸ¥è¯¢å®¢æˆ·/è½¦è¾†ä¿¡æ¯</td></tr><tr><td>æŠ€æœ¯äººå‘˜</td><td>å¡«å†™è½¦è¾†æœåŠ¡è®°å½•</td></tr><tr><td>ç®¡ç†å‘˜</td><td>æ·»åŠ /ä¿®æ”¹è½¦è¾†ä¿¡æ¯ã€æ·»åŠ /ä¿®æ”¹å‘˜å·¥ä¿¡æ¯ã€æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯</td></tr></tbody></table><h3 id="1-4å¯è§†åŒ–å»ºè®®ï¼ˆåœ¨Rational-Roseä¸­å»ºå›¾ï¼‰ï¼š">1.4å¯è§†åŒ–å»ºè®®ï¼ˆåœ¨Rational Roseä¸­å»ºå›¾ï¼‰ï¼š</h3><p>æ•´ä½“ç”¨ä¸€ä¸ªç³»ç»Ÿè¾¹æ¡†ï¼ˆSystemï¼‰åŒ…ä½æ‰€æœ‰ç”¨ä¾‹ï¼Œå‘½åä¸ºâ€œæ±½è½¦ç§Ÿèµç³»ç»Ÿâ€</p><p>åˆ›å»º4ä¸ªActorï¼Œåˆ†åˆ«å‘½åä¸ºï¼š</p><ul><li><code>å®¢æˆ·</code></li><li><code>å·¥ä½œäººå‘˜</code></li><li><code>æŠ€æœ¯äººå‘˜</code></li><li><code>ç®¡ç†å‘˜</code></li></ul><p>åˆ›å»º12ä¸ªç”¨ä¾‹ï¼ˆUse Caseï¼‰ï¼š</p><p>æ¯ä¸ªåŠŸèƒ½ç‚¹ç”¨æ¤­åœ†è¡¨ç¤ºï¼Œç”¨çº¿è¿æ¥Actorä¸ä»–ä»¬èƒ½å¤Ÿä½¿ç”¨çš„ç”¨ä¾‹</p><table><thead><tr><th>æ¨¡å—</th><th>ç”¨ä¾‹ï¼ˆåŠŸèƒ½ï¼‰åç§°</th><th>æ‰€å±è§’è‰²</th></tr></thead><tbody><tr><td>æ•°æ®ç»´æŠ¤æ¨¡å—</td><td>æ·»åŠ è½¦è¾†ä¿¡æ¯</td><td>ç®¡ç†å‘˜</td></tr><tr><td>æ•°æ®ç»´æŠ¤æ¨¡å—</td><td>ä¿®æ”¹è½¦è¾†ä¿¡æ¯</td><td>ç®¡ç†å‘˜</td></tr><tr><td>æ•°æ®ç»´æŠ¤æ¨¡å—</td><td>æ·»åŠ å‘˜å·¥ä¿¡æ¯</td><td>ç®¡ç†å‘˜</td></tr><tr><td>æ•°æ®ç»´æŠ¤æ¨¡å—</td><td>ä¿®æ”¹å‘˜å·¥ä¿¡æ¯</td><td>ç®¡ç†å‘˜</td></tr><tr><td>ä¸šåŠ¡æ¨¡å—</td><td>å¡«å†™ç§Ÿè½¦é¢„å®šç”³è¯·</td><td>å®¢æˆ·</td></tr><tr><td>ä¸šåŠ¡æ¨¡å—</td><td>å®¡æ ¸é¢„å®šè¯·æ±‚</td><td>å·¥ä½œäººå‘˜</td></tr><tr><td>ä¸šåŠ¡æ¨¡å—</td><td>å¡«å†™æœåŠ¡è®°å½•</td><td>æŠ€æœ¯äººå‘˜</td></tr><tr><td>ä¸šåŠ¡æ¨¡å—</td><td>å¤„ç†è¿˜è½¦è¯·æ±‚</td><td>å·¥ä½œäººå‘˜</td></tr><tr><td>æŸ¥è¯¢æ¨¡å—</td><td>æŸ¥è¯¢å®¢æˆ·ä¿¡æ¯</td><td>å·¥ä½œäººå‘˜/ç®¡ç†å‘˜</td></tr><tr><td>æŸ¥è¯¢æ¨¡å—</td><td>æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯</td><td>ç®¡ç†å‘˜</td></tr><tr><td>æŸ¥è¯¢æ¨¡å—</td><td>æŸ¥è¯¢è½¦è¾†ä¿¡æ¯</td><td>å·¥ä½œäººå‘˜/ç®¡ç†å‘˜</td></tr><tr><td>æŸ¥è¯¢æ¨¡å—</td><td>æŸ¥è¯¢å®¢æˆ·ç§Ÿè½¦è®°å½•</td><td>å®¢æˆ·/å·¥ä½œäººå‘˜</td></tr></tbody></table><h3 id="æ€»ç»“ï¼š">æ€»ç»“ï¼š</h3><ul><li><strong>â€œå‚ä¸è€…â€æ˜¯ä½¿ç”¨ç³»ç»Ÿçš„äººæˆ–è§’è‰²</strong></li><li><strong>â€œç”¨ä¾‹â€æ˜¯ç³»ç»Ÿæä¾›çš„æŸé¡¹åŠŸèƒ½æˆ–æœåŠ¡</strong></li><li>ä¸€ä¸ªå‚ä¸è€…å¯ä»¥å‚ä¸å¤šä¸ªç”¨ä¾‹</li><li>ä¸€ä¸ªç”¨ä¾‹ä¹Ÿå¯ä»¥è¢«å¤šä¸ªå‚ä¸è€…ä½¿ç”¨ï¼ˆä¾‹å¦‚æŸ¥è¯¢è½¦è¾†ä¿¡æ¯ï¼‰</li></ul><h2 id="3-ç±»å›¾è®¾è®¡">3.ç±»å›¾è®¾è®¡</h2><p><strong>ç±»å›¾è¯´æ˜ç³»ç»Ÿçš„é™æ€ç»“æ„</strong>ï¼šæœ‰å“ªäº›ç±»ï¼ˆå®ä½“ï¼‰ï¼Œå®ƒä»¬æœ‰å“ªäº›å±æ€§ï¼ˆå­—æ®µï¼‰ã€æ–¹æ³•ï¼ˆåŠŸèƒ½ï¼‰ï¼Œä»¥åŠç±»ä¹‹é—´çš„å…³ç³»ï¼ˆå…³è”ã€ç»§æ‰¿ã€ä¾èµ–ç­‰ï¼‰ã€‚</p><h3 id="ç³»ç»Ÿä¸­çš„æ ¸å¿ƒç±»">ç³»ç»Ÿä¸­çš„æ ¸å¿ƒç±»</h3><table><thead><tr><th>ç±»å</th><th>ä¸Šå±‚ç»§æ‰¿/ä»å±å…³ç³»</th><th>å…³è”å¯¹è±¡</th><th>ä¸»è¦å±æ€§å­—æ®µ</th><th>ä¸»è¦æ–¹æ³•ï¼ˆåŠŸèƒ½ï¼‰</th></tr></thead><tbody><tr><td><strong>Personï¼ˆæŠ½è±¡ç±»ï¼‰</strong></td><td>-</td><td>-</td><td>nameã€IDã€addressã€phoneNo</td><td>getName()ã€setName() ç­‰</td></tr><tr><td>â”œâ”€ <strong>Customer</strong>ï¼ˆå®¢æˆ·ç±»ï¼‰</td><td>Person</td><td>Rentalï¼ˆ1å¯¹å¤šï¼‰</td><td>ç¼–å·ã€è¯ä»¶å·ã€è”ç³»æ–¹å¼ã€ç§Ÿèµå†å²è®°å½•</td><td>æäº¤é¢„å®šç”³è¯·()ã€æŸ¥è¯¢ç§Ÿèµè®°å½•()</td></tr><tr><td>â””â”€â”€ <strong>Employeeï¼ˆæŠ½è±¡ç±»-å‘˜å·¥ï¼‰</strong></td><td>Person</td><td>æ— </td><td>ç¼–å·ã€å²—ä½ã€ç”µè¯ã€è´¦å·å¯†ç </td><td>ç™»å½•()ã€æ“ä½œåŠŸèƒ½ï¼ˆç”±å­ç±»å…·ä½“å®ç°ï¼‰</td></tr><tr><td>â”œâ”€â”€ <em><strong>*Admin*</strong></em>ï¼ˆ<strong>ç®¡ç†å‘˜</strong>ï¼‰</td><td>Employee</td><td>æ— </td><td>æ˜¯å¦ä¸ºé«˜çº§ç®¡ç†å‘˜</td><td>æ·»åŠ å‘˜å·¥()ã€æ·»åŠ è½¦è¾†()</td></tr><tr><td>â”œâ”€â”€ <strong>CommonWorker</strong>ï¼ˆä¸€èˆ¬å‘˜å·¥-å®¢æœï¼‰</td><td>Employee</td><td>æ— </td><td>å¤„ç†ç§Ÿèµæµç¨‹</td><td>å¤„ç†é¢„å®š()ã€å¤„ç†è¿˜è½¦()</td></tr><tr><td>â””â”€â”€ <strong>SkillWorker</strong>ï¼ˆæŠ€æœ¯äººå‘˜ï¼‰</td><td>Employee</td><td>ServiceRecordï¼ˆ1å¯¹å¤šï¼‰</td><td>æŠ€èƒ½é¡¹ã€èµ„æ ¼è¯ä¹¦ã€æœåŠ¡è®°å½•</td><td>å¡«å†™æœåŠ¡è®°å½•()</td></tr><tr><td><strong>Vehicle</strong>ï¼ˆè½¦è¾†ç±»ï¼‰</td><td>-</td><td>Rentalã€ServiceRecord</td><td>ç¼–å·ã€è½¦ç‰Œã€å“ç‰Œã€ç±»å‹ã€çŠ¶æ€ã€ç§Ÿé‡‘ã€ç»´ä¿®è®°å½•</td><td>æ›´æ–°çŠ¶æ€()ã€è®¡ç®—ç§Ÿé‡‘()</td></tr><tr><td><strong>Rental</strong>ï¼ˆç§Ÿèµç±»ï¼‰</td><td>-</td><td>Customerã€Vehicle</td><td>ç§Ÿèµç¼–å·ã€å®¢æˆ·ç¼–å·ã€è½¦è¾†ç¼–å·ã€èµ·æ­¢æ—¥æœŸã€è´¹ç”¨ã€çŠ¶æ€</td><td>åˆ›å»ºç§Ÿèµè®°å½•()ã€è®¡ç®—è´¹ç”¨()</td></tr><tr><td><strong>ServiceRecord</strong>ï¼ˆæœåŠ¡è®°å½•ç±»ï¼‰</td><td>-</td><td>Vehicleã€SkillWorker</td><td>æœåŠ¡ç¼–å·ã€è½¦è¾†ç¼–å·ã€æŠ€æœ¯å‘˜ç¼–å·ã€æ£€æŸ¥æ—¶é—´ã€çŠ¶å†µã€å»ºè®®ç»´ä¿®</td><td>æäº¤æœåŠ¡è®°å½•()</td></tr></tbody></table><p><strong>æ€è·¯ï¼šåˆ†ä¸¤ä¸ªç±»å›¾ç”»ï¼Œä¸€ä¸ªå®¢æˆ·åŠå…¬å¸å‘˜å·¥ç±»å›¾ï¼Œä¸€ä¸ªæ±½è½¦ç§Ÿèµç³»ç»Ÿç±»å›¾</strong></p><h2 id="4-æ—¶åºå›¾è®¾è®¡">4.æ—¶åºå›¾è®¾è®¡</h2><p>å±•ç¤ºâ€œå¯¹è±¡é—´åœ¨æŸä¸ªä¸šåŠ¡è¿‡ç¨‹ä¸­çš„äº¤äº’é¡ºåºâ€ã€‚</p><p>æ—¶åºå›¾ï¼ˆSequence Diagramï¼‰ç”¨äºå±•ç¤º<strong>å¯¹è±¡ä¹‹é—´åœ¨æŸä¸€ç”¨ä¾‹ä¸­çš„äº¤äº’è¿‡ç¨‹</strong>ï¼Œå…³æ³¨æ¶ˆæ¯å‘é€é¡ºåºã€‚</p><p>åŸºæœ¬å…ƒç´ åŒ…æ‹¬ï¼š</p><ul><li><strong>å‚ä¸å¯¹è±¡ï¼ˆActor æˆ–ç±»çš„å®ä¾‹ï¼‰</strong>ï¼šä¸Šæ–¹æ°´å¹³æ’åˆ—</li><li><strong>ç”Ÿå‘½çº¿ï¼ˆLifelineï¼‰</strong>ï¼šå‚ç›´è™šçº¿ï¼Œè¡¨ç¤ºå¯¹è±¡çš„å­˜æ´»æœŸ</li><li><strong>æ¶ˆæ¯ï¼ˆMessageï¼‰</strong>ï¼šå¯¹è±¡ä¹‹é—´å‘é€çš„è¯·æ±‚ï¼Œç”¨ç®­å¤´æ ‡ç¤ºï¼ŒæŒ‰æ—¶é—´ä»ä¸Šåˆ°ä¸‹</li></ul><h3 id="ï¼ˆ1ï¼‰ç®¡ç†å‘˜æŸ¥çœ‹å·¥ä½œè®°å½•æ—¶åºå›¾">ï¼ˆ1ï¼‰ç®¡ç†å‘˜æŸ¥çœ‹å·¥ä½œè®°å½•æ—¶åºå›¾</h3><p>è¯¥å›¾æè¿°äº†ç®¡ç†å‘˜åœ¨ç³»ç»Ÿä¸­æŸ¥çœ‹æ™®é€šå·¥ä½œäººå‘˜çš„å·¥ä½œè®°å½•åŠå…¶ä»»åŠ¡å®Œæˆç‡çš„æµç¨‹ã€‚è¯¥æ“ä½œç”¨äºç®¡ç†ç›‘ç£å’Œç»©æ•ˆè¯„ä¼°ã€‚</p><p><strong>å‚ä¸å¯¹è±¡</strong>ï¼š</p><ul><li><code>ç®¡ç†å‘˜</code>ï¼ˆAdminï¼‰</li><li><code>æ™®é€šå·¥ä½œäººå‘˜</code>ï¼ˆCommonWorkerï¼‰</li><li><code>æœåŠ¡è®°å½•</code>ï¼ˆServiceRecordï¼‰</li></ul><p><strong>äº¤äº’é¡ºåº</strong>ï¼š</p><ol><li>ç®¡ç†å‘˜å¯æ ¹æ®ä»»åŠ¡æƒ…å†µè¿›è¡Œè¯„ä¼°ä¸è®°å½•ã€‚</li><li><code>Admin</code> ç™»å½•ç³»ç»Ÿå¹¶è¿›å…¥â€œå‘˜å·¥ç®¡ç†â€åŠŸèƒ½ç•Œé¢ï¼›</li><li>ç³»ç»Ÿå±•ç¤ºå¯æŸ¥è¯¢å‘˜å·¥åˆ—è¡¨ï¼›</li><li><code>Admin</code> é€‰å®šæŸä½ <code>CommonWorker</code>ï¼Œè°ƒç”¨å…¶æ–¹æ³• <code>æŸ¥çœ‹å·¥ä½œè®°å½•()</code>ï¼›</li><li><code>CommonWorker</code> è¿”å›å…¶å†å² <code>ServiceRecord</code>ï¼›</li><li><code>Admin</code> è¦æ±‚è¯„ä¼°ä»»åŠ¡å®Œæˆæƒ…å†µï¼Œè°ƒç”¨ <code>calculate()</code> æ–¹æ³•è®¡ç®— <code>commissionRate</code>ï¼›</li><li><code>CommonWorker</code> è¿”å›ä»»åŠ¡å®Œæˆç‡ç»™ <code>Admin</code>ï¼›</li></ol><h3 id="ï¼ˆ2ï¼‰å®¢æˆ·é¢„è®¢è½¦è¾†æ—¶åºå›¾"><strong>ï¼ˆ2ï¼‰å®¢æˆ·é¢„è®¢è½¦è¾†æ—¶åºå›¾</strong></h3><p>è¯¥å›¾æè¿°äº†å®¢æˆ·é€šè¿‡ç³»ç»Ÿå‘èµ·ç§Ÿè½¦ç”³è¯·å¹¶ç”±å·¥ä½œäººå‘˜å¤„ç†çš„å…¨è¿‡ç¨‹ã€‚</p><p><strong>å‚ä¸å¯¹è±¡</strong>ï¼š</p><ul><li><code>å®¢æˆ·</code>ï¼ˆCustomerï¼‰</li><li><code>æ™®é€šå·¥ä½œäººå‘˜</code>ï¼ˆCommonWorkerï¼‰</li><li><code>è½¦è¾†</code>ï¼ˆVehicleï¼‰</li><li><code>ç§Ÿèµè®°å½•</code>ï¼ˆRentalï¼‰</li></ul><p><strong>äº¤äº’é¡ºåº</strong>ï¼š</p><blockquote><ol><li><code>Customer</code> å¡«å†™å¹¶æäº¤ç§Ÿèµç”³è¯·ï¼ˆè°ƒç”¨ <code>æäº¤é¢„å®šç”³è¯·()</code> æ–¹æ³•ï¼‰ï¼›</li><li><code>CommonWorker</code> æ¥æ”¶ç”³è¯·å¹¶è°ƒç”¨ <code>å¤„ç†é¢„å®š()</code> ï¼›</li><li><code>CommonWorker</code> é€šè¿‡ <code>Vehicle</code> æŸ¥è¯¢æ‰€éœ€è½¦å‹æ˜¯å¦å¯ç§Ÿï¼ˆè°ƒç”¨ <code>æ›´æ–°çŠ¶æ€()</code>ã€æŸ¥è¯¢ <code>å½“å‰çŠ¶æ€</code> å±æ€§ï¼‰ï¼›</li><li>è‹¥è½¦è¾†ç©ºé—²ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Rental</code> å®ä¾‹ï¼›</li><li><code>Rental</code> è®°å½•å®¢æˆ·ã€è½¦è¾†ã€èµ·æ­¢æ—¶é—´ç­‰ä¿¡æ¯ï¼Œå¹¶ç”± <code>CommonWorker</code> å®Œæˆé¢„å®šå¤„ç†ï¼›</li><li>è¿”å›é¢„å®šç»“æœç»™ <code>Customer</code>ã€‚</li></ol></blockquote><h3 id="ï¼ˆ3ï¼‰å®¢æˆ·å–è½¦æ—¶åºå›¾"><strong>ï¼ˆ3ï¼‰å®¢æˆ·å–è½¦æ—¶åºå›¾</strong></h3><p>è¯¥å›¾å±•ç¤ºäº†å®¢æˆ·åœ¨é¢„å®šæˆåŠŸåå‰å¾€é—¨åº—å–è½¦çš„ä¸šåŠ¡æµç¨‹ã€‚æ¶‰åŠå¯¹ç§ŸèµçŠ¶æ€ç¡®è®¤ã€ä»˜æ¬¾ã€è½¦è¾†çŠ¶æ€æ›´æ–°ç­‰å…³é”®æ“ä½œã€‚</p><p><strong>å‚ä¸å¯¹è±¡</strong>ï¼š</p><ul><li><code>å®¢æˆ·</code>ï¼ˆCustomerï¼‰</li><li><code>æ™®é€šå·¥ä½œäººå‘˜</code>ï¼ˆCommonWorkerï¼‰</li><li><code>è½¦è¾†</code>ï¼ˆVehicleï¼‰</li><li><code>ç§Ÿèµè®°å½•</code>ï¼ˆRentalï¼‰</li><li><code>æœåŠ¡è®°å½•</code>ï¼ˆServiceRecord`ï¼‰ï¼ˆå¡«å†™å·¥ä½œè®°å½•ï¼‰</li></ul><p><strong>äº¤äº’é¡ºåº</strong>ï¼š</p><ol><li><code>Customer</code> æŒ‰çº¦å®šæ—¶é—´åˆ°åº—å–è½¦ï¼›</li><li><code>CommonWorker</code> æ ¡éªŒå®¢æˆ·çš„èº«ä»½å’Œç§ŸèµçŠ¶æ€ï¼›</li><li>è‹¥éªŒè¯æˆåŠŸï¼Œæç¤º <code>Customer</code> è¿›è¡Œä»˜æ¬¾ï¼›</li><li>ä»˜æ¬¾å®Œæˆåï¼Œ<code>CommonWorker</code> å¡«å†™ <code>ServiceRecord</code>ï¼ˆè°ƒç”¨ <code>å¡«å†™æœåŠ¡è®°å½•()</code> æ–¹æ³•ï¼Œè®°å½•å–è½¦ä¿¡æ¯ï¼‰ï¼›</li><li><code>CommonWorker</code> è°ƒç”¨ <code>Vehicle</code> ç±»æ–¹æ³• <code>æ›´æ–°çŠ¶æ€()</code>ï¼Œå°†è½¦è¾†çŠ¶æ€æ›´æ–°ä¸ºâ€œç§Ÿèµä¸­â€ï¼›</li><li><code>Rental</code> å¯¹è±¡çŠ¶æ€è®¾ç½®ä¸ºâ€œè¿›è¡Œä¸­â€ï¼Œç³»ç»Ÿå®Œæˆç§Ÿèµæ¿€æ´»ï¼›</li><li>ç³»ç»Ÿé€šçŸ¥å®¢æˆ·å–è½¦å®Œæˆã€‚</li></ol><h3 id="ï¼ˆ4ï¼‰å®¢æˆ·è¿˜è½¦æ—¶åºå›¾"><strong>ï¼ˆ4ï¼‰å®¢æˆ·è¿˜è½¦æ—¶åºå›¾</strong></h3><p>è¯¥å›¾å±•ç¤ºäº†å®¢æˆ·å®Œæˆç”¨è½¦åå½’è¿˜è½¦è¾†çš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬è½¦è¾†æ£€æŸ¥ã€è´¹ç”¨ç»“ç®—ã€æœåŠ¡è®°å½•å¡«å†™ã€çŠ¶æ€æ›´æ–°ç­‰æ“ä½œã€‚</p><p><strong>å‚ä¸å¯¹è±¡</strong>ï¼š</p><ul><li><code>å®¢æˆ·</code>ï¼ˆCustomerï¼‰</li><li><code>æ™®é€šå·¥ä½œäººå‘˜</code>ï¼ˆCommonWorkerï¼‰</li><li><code>æŠ€æœ¯äººå‘˜</code>ï¼ˆSkillWorkerï¼‰</li><li><code>è½¦è¾†</code>ï¼ˆVehicleï¼‰</li><li><code>ç§Ÿèµè®°å½•</code>ï¼ˆRentalï¼‰</li><li><code>æœåŠ¡è®°å½•</code>ï¼ˆServiceRecord`ï¼‰</li></ul><p><strong>äº¤äº’é¡ºåº</strong>ï¼š</p><ol><li>Customer æŒ‰çº¦å®šæ—¶é—´å½’è¿˜è½¦è¾†ï¼›</li><li>SkillWorker å¯¹ Vehicle è¿›è¡Œæ£€æŸ¥ï¼Œç¡®è®¤è½¦å†µå¹¶è°ƒç”¨ å¡«å†™æœåŠ¡è®°å½•()ï¼›</li><li>è‹¥è½¦è¾†å­˜åœ¨æŸåï¼Œè®°å½•åœ¨ ServiceRecord ä¸­ï¼Œå¹¶æäº¤ç»´ä¿®å»ºè®®ï¼›</li><li>CommonWorker æ ¹æ® Rental ä¸­çš„èµ·æ­¢æ—¶é—´ä¸è½¦è¾†çŠ¶æ€ï¼Œè®¡ç®—è´¹ç”¨ï¼ˆè°ƒç”¨ è®¡ç®—è´¹ç”¨() æ–¹æ³•ï¼‰ï¼›</li><li>è‹¥æœ‰æŸåæˆ–è¿ç« ï¼Œé¢å¤–è´¹ç”¨ä¸€å¹¶è®¡ç®—ï¼›</li><li>Vehicle çŠ¶æ€é€šè¿‡ æ›´æ–°çŠ¶æ€() æ–¹æ³•è®¾ä¸ºâ€œç©ºé—²â€æˆ–â€œç»´æŠ¤ä¸­â€ï¼›</li><li>Rental çŠ¶æ€è®¾ä¸ºâ€œå·²å®Œæˆâ€ï¼Œäº¤æ˜“ç»“æŸï¼›</li></ol><h2 id="5-åä½œå›¾è®¾è®¡">5.åä½œå›¾è®¾è®¡</h2><p>åä½œå›¾ï¼ˆCollaboration Diagramï¼‰ç”¨äºæè¿°åœ¨æŸä¸ªç”¨ä¾‹åœºæ™¯ä¸­ï¼Œå‚ä¸å¯¹è±¡ä¹‹é—´ä¸ºäº†å®Œæˆä»»åŠ¡æ‰€è¿›è¡Œçš„äº¤äº’è¡Œä¸ºã€‚å®ƒé‡ç‚¹çªå‡ºå¯¹è±¡ä¹‹é—´çš„<strong>ç»“æ„å…³ç³»</strong>ä¸<strong>æ¶ˆæ¯ä¼ é€’é¡ºåº</strong>ã€‚</p><p>æœ¬ç³»ç»Ÿåä½œå›¾è®¾è®¡è¦†ç›–ä¸‰ä¸ªå…¸å‹åœºæ™¯ï¼š</p><h3 id="ï¼ˆ1ï¼‰å®¢æˆ·é¢„è®¢è½¦è¾†åä½œå›¾">ï¼ˆ1ï¼‰å®¢æˆ·é¢„è®¢è½¦è¾†åä½œå›¾</h3><p>è¯¥å›¾æè¿°å®¢æˆ·å‘èµ·ç§Ÿè½¦è¯·æ±‚å¹¶ç”±ç³»ç»Ÿå¤„ç†çš„è¿‡ç¨‹ï¼Œçªå‡ºâ€œå®¢æˆ·â€”å·¥ä½œäººå‘˜â€”è½¦è¾†â€”ç§Ÿèµè®°å½•â€ä¹‹é—´çš„åä½œå…³ç³»ã€‚</p><p><strong>å‚ä¸å¯¹è±¡</strong>ï¼š</p><ul><li><code>å®¢æˆ·</code>ï¼ˆCustomerï¼‰</li><li><code>æ™®é€šå·¥ä½œäººå‘˜</code>ï¼ˆCommonWorkerï¼‰</li><li><code>è½¦è¾†</code>ï¼ˆVehicleï¼‰</li><li><code>ç§Ÿèµè®°å½•</code>ï¼ˆRentalï¼‰</li></ul><p><strong>åä½œè¿‡ç¨‹</strong>ï¼š</p><ol><li><code>Customer</code> å‘èµ·ç§Ÿè½¦è¯·æ±‚ï¼›</li><li><code>CommonWorker</code> æ¥æ”¶å¹¶æ£€æŸ¥è¯·æ±‚ï¼›</li><li>å‘ <code>Vehicle</code> æŸ¥è¯¢å½“å‰çŠ¶æ€ï¼ˆæ˜¯å¦å¯ç§Ÿï¼‰ï¼›</li><li>å¦‚æœå¯ç§Ÿï¼Œç”Ÿæˆ <code>Rental</code> è®°å½•å¹¶å­˜å‚¨ç§ŸæœŸã€è´¹ç”¨ç­‰ä¿¡æ¯ï¼›</li><li>è¿”å›å¤„ç†ç»“æœç»™ <code>Customer</code>ã€‚</li></ol><h3 id="ï¼ˆ2ï¼‰å®¢æˆ·å–è½¦åä½œå›¾">ï¼ˆ2ï¼‰å®¢æˆ·å–è½¦åä½œå›¾</h3><p>å®¢æˆ·åœ¨é—¨åº—å–è½¦ï¼Œç”±å·¥ä½œäººå‘˜å®ŒæˆéªŒè¯ã€è®°å½•ä¸çŠ¶æ€æ›´æ–°ã€‚</p><p><strong>å‚ä¸å¯¹è±¡</strong>ï¼š</p><ul><li><code>å®¢æˆ·</code>ï¼ˆCustomerï¼‰</li><li><code>æ™®é€šå·¥ä½œäººå‘˜</code>ï¼ˆCommonWorkerï¼‰</li><li><code>è½¦è¾†</code>ï¼ˆVehicleï¼‰</li><li><code>æœåŠ¡è®°å½•</code>ï¼ˆServiceRecordï¼‰</li><li><code>ç§Ÿèµè®°å½•</code>ï¼ˆRentalï¼‰</li></ul><p><strong>åä½œè¿‡ç¨‹</strong>ï¼š</p><ol><li><code>Customer</code> åˆ°è¾¾å‰å°ï¼Œå‡ºç¤ºèº«ä»½ä¿¡æ¯ï¼›</li><li><code>CommonWorker</code> æ ¡éªŒä¿¡æ¯ä¸ç§ŸèµçŠ¶æ€ï¼›</li><li>è¦æ±‚ä»˜æ¬¾å¹¶è°ƒç”¨ <code>ServiceRecord</code> å¡«å†™è®°å½•ï¼›</li><li>ä¿®æ”¹ <code>Vehicle</code> çš„çŠ¶æ€ä¸ºâ€œç§Ÿèµä¸­â€ï¼›</li><li>å°† <code>Rental</code> çŠ¶æ€è®¾ä¸ºâ€œè¿›è¡Œä¸­â€ï¼›</li><li>é€šçŸ¥ <code>Customer</code> æˆåŠŸå–è½¦ã€‚</li></ol><h3 id="ï¼ˆ3ï¼‰å®¢æˆ·è¿˜è½¦åä½œå›¾">ï¼ˆ3ï¼‰å®¢æˆ·è¿˜è½¦åä½œå›¾</h3><p>å®¢æˆ·å®Œæˆä½¿ç”¨åå½’è¿˜è½¦è¾†ï¼Œç³»ç»Ÿè¿›è¡Œæ£€æŸ¥ã€ç»“ç®—ä¸çŠ¶æ€åŒæ­¥ã€‚</p><p><strong>å‚ä¸å¯¹è±¡</strong>ï¼š</p><ul><li><code>å®¢æˆ·</code>ï¼ˆCustomerï¼‰</li><li><code>æ™®é€šå·¥ä½œäººå‘˜</code>ï¼ˆCommonWorkerï¼‰</li><li><code>æŠ€æœ¯äººå‘˜</code>ï¼ˆSkillWorkerï¼‰</li><li><code>è½¦è¾†</code>ï¼ˆVehicleï¼‰</li><li><code>æœåŠ¡è®°å½•</code>ï¼ˆServiceRecordï¼‰</li><li><code>ç§Ÿèµè®°å½•</code>ï¼ˆRentalï¼‰</li></ul><p><strong>åä½œè¿‡ç¨‹</strong>ï¼š</p><ol><li><code>Customer</code> æäº¤è¿˜è½¦ï¼›</li><li><code>SkillWorker</code> æ£€æŸ¥è½¦è¾†ï¼Œå¡«å†™ <code>ServiceRecord</code>ï¼›</li><li><code>CommonWorker</code> æ ¹æ® <code>Rental</code> è®¡ç®—è´¹ç”¨ï¼›</li><li>å¦‚æœ‰å¼‚å¸¸ï¼ˆå¦‚è½¦è¾†æŸåï¼‰ï¼ŒåŠ å…¥é¢å¤–ç½šé‡‘ï¼›</li><li>è°ƒç”¨ <code>Vehicle</code> æ›´æ–°çŠ¶æ€ä¸ºâ€œç©ºé—²â€æˆ–â€œç»´æŠ¤ä¸­â€ï¼›</li><li>æ›´æ–° <code>Rental</code> ä¸ºâ€œå·²å®Œæˆâ€ï¼Œå…³é—­æµç¨‹ï¼›</li><li>é€šçŸ¥ <code>Customer</code> äº¤æ˜“ç»“æŸã€‚</li></ol><h2 id="6-æ´»åŠ¨å›¾è®¾è®¡">6. æ´»åŠ¨å›¾è®¾è®¡</h2><p>æ´»åŠ¨å›¾ï¼ˆActivity Diagramï¼‰ç”¨äºè¡¨ç¤ºç³»ç»Ÿä¸­æŸä¸ªç”¨ä¾‹æˆ–ä¸šåŠ¡æµç¨‹çš„<strong>æ§åˆ¶æµç¨‹</strong>ä¸<strong>çŠ¶æ€æµè½¬</strong>ï¼Œå¼ºè°ƒæ“ä½œçš„æ‰§è¡Œé¡ºåºä¸å¹¶å‘ç»“æ„ã€‚ä»¥ä¸‹é€‰å–ä¸‰ä¸ªå…¸å‹ä¸šåŠ¡æµç¨‹è¿›è¡Œå»ºæ¨¡ã€‚</p><h3 id="ï¼ˆ1ï¼‰å®¢æˆ·é¢„è®¢è½¦è¾†æ´»åŠ¨å›¾">ï¼ˆ1ï¼‰å®¢æˆ·é¢„è®¢è½¦è¾†æ´»åŠ¨å›¾</h3><p>è¯¥å›¾æè¿°äº†å®¢æˆ·ç§Ÿè½¦ç”³è¯·ä»å¡«å†™è¡¨å•åˆ°ç³»ç»Ÿç”Ÿæˆé¢„å®šè®°å½•çš„å…¨è¿‡ç¨‹ã€‚</p><p><strong>æµç¨‹è¯´æ˜</strong>ï¼š</p><ul><li>åˆå§‹èŠ‚ç‚¹ï¼šå®¢æˆ·ç™»å½•ç³»ç»Ÿï¼›</li><li>å¡«å†™ç§Ÿè½¦ç”³è¯·è¡¨ï¼ˆè½¦å‹ã€æ—¶é—´ç­‰ï¼‰ï¼›</li><li>ç³»ç»Ÿæ ¡éªŒå­—æ®µå®Œæ•´æ€§ï¼›</li><li>ç³»ç»Ÿæ£€æŸ¥è¯¥æ—¶é—´æ®µå†…æ˜¯å¦æœ‰å¯ç§Ÿè½¦è¾†ï¼›<ul><li>è‹¥æ— è½¦è¾† â†’ æµç¨‹ç»“æŸï¼Œæç¤ºâ€œé¢„å®šå¤±è´¥â€ï¼›</li><li>è‹¥æœ‰è½¦è¾† â†’ è¿›å…¥ä¸‹ä¸€æ­¥ï¼›</li></ul></li><li>ç³»ç»Ÿç”Ÿæˆé¢„å®šè®°å½•ï¼›</li><li>å°†é¢„å®šçŠ¶æ€è®¾ä¸ºâ€œå¾…å®¡æ ¸â€ï¼›</li><li>è¿”å›â€œé¢„å®šæäº¤æˆåŠŸâ€æç¤ºã€‚</li></ul><h3 id="ï¼ˆ2ï¼‰å®¢æˆ·å–è½¦æ´»åŠ¨å›¾">ï¼ˆ2ï¼‰å®¢æˆ·å–è½¦æ´»åŠ¨å›¾</h3><p>å±•ç¤ºå®¢æˆ·å‰å¾€é—¨åº—é¢†å–è½¦è¾†çš„å®Œæ•´æ“ä½œæµç¨‹ã€‚</p><p><strong>æµç¨‹è¯´æ˜</strong>ï¼š</p><ul><li>åˆå§‹èŠ‚ç‚¹ï¼šå®¢æˆ·åˆ°è¾¾é—¨åº—ï¼›</li><li>å‡ºç¤ºèº«ä»½ä¿¡æ¯ï¼›</li><li>å·¥ä½œäººå‘˜éªŒè¯é¢„è®¢çŠ¶æ€ï¼›<ul><li>è‹¥çŠ¶æ€å¼‚å¸¸ â†’ ç»“æŸæµç¨‹ï¼Œæç¤ºâ€œéªŒè¯å¤±è´¥â€ï¼›</li><li>è‹¥éªŒè¯æˆåŠŸ â†’ è¿›å…¥ä¸‹ä¸€æ­¥ï¼›</li></ul></li><li>ç³»ç»Ÿæç¤ºä»˜æ¬¾ï¼›</li><li>å®¢æˆ·ä»˜æ¬¾ï¼›</li><li>å·¥ä½œäººå‘˜å¡«å†™æœåŠ¡è®°å½•ï¼›</li><li>æ›´æ–°è½¦è¾†çŠ¶æ€ä¸ºâ€œç§Ÿèµä¸­â€ï¼›</li><li>ç»“æŸæµç¨‹ï¼Œå®¢æˆ·å®Œæˆå–è½¦ã€‚</li></ul><h3 id="ï¼ˆ3ï¼‰å®¢æˆ·è¿˜è½¦æ´»åŠ¨å›¾">ï¼ˆ3ï¼‰å®¢æˆ·è¿˜è½¦æ´»åŠ¨å›¾</h3><p>æè¿°å®¢æˆ·ç”¨è½¦ç»“æŸåå½’è¿˜è½¦è¾†çš„ä¸šåŠ¡æµç¨‹ã€‚</p><p><strong>æµç¨‹è¯´æ˜</strong>ï¼š</p><ul><li>åˆå§‹èŠ‚ç‚¹ï¼šå®¢æˆ·æäº¤è¿˜è½¦ï¼›</li><li>æŠ€æœ¯äººå‘˜è¿›è¡Œè½¦è¾†æ£€æŸ¥ï¼›</li><li>ç³»ç»Ÿè®°å½•æœåŠ¡æ£€æŸ¥ç»“æœï¼›</li><li>å·¥ä½œäººå‘˜æ ¹æ®ç§ŸæœŸä¸è½¦å†µè®¡ç®—è´¹ç”¨ï¼›</li><li>å®¢æˆ·ä»˜æ¬¾ï¼ˆå«é¢å¤–ç½šé‡‘ï¼‰ï¼›</li><li>ç³»ç»Ÿæ›´æ–°è½¦è¾†çŠ¶æ€ï¼ˆç©ºé—²/ç»´æŠ¤ä¸­ï¼‰ï¼›</li><li>ç§Ÿèµè®°å½•è®¾ä¸ºâ€œå·²å®Œæˆâ€ï¼›</li><li>æµç¨‹ç»ˆæ­¢ã€‚</li></ul><h2 id="7-çŠ¶æ€å›¾è®¾è®¡">7. çŠ¶æ€å›¾è®¾è®¡</h2><p>çŠ¶æ€å›¾ï¼ˆState Diagramï¼‰ç”¨äºæè¿°ç³»ç»Ÿä¸­æŸä¸€å¯¹è±¡åœ¨ç”Ÿå‘½å‘¨æœŸä¸­æ‰€ç»å†çš„<strong>çŠ¶æ€å˜è¿</strong>ï¼Œä»¥åŠå¼•èµ·è¿™äº›çŠ¶æ€å˜åŒ–çš„äº‹ä»¶æˆ–æ¡ä»¶ã€‚å®ƒå¯¹äºç†è§£å¯¹è±¡è¡Œä¸ºåŠå…¶è§¦å‘é€»è¾‘å°¤ä¸ºé‡è¦ã€‚</p><p>æœ¬ç³»ç»Ÿé‡ç‚¹ç»˜åˆ¶ä»¥ä¸‹ä¸¤ä¸ªçŠ¶æ€å›¾ï¼š</p><h3 id="ï¼ˆ1ï¼‰è½¦è¾†ï¼ˆVehicleï¼‰çŠ¶æ€å›¾">ï¼ˆ1ï¼‰è½¦è¾†ï¼ˆVehicleï¼‰çŠ¶æ€å›¾</h3><p>è½¦è¾†åœ¨ç§Ÿèµç”Ÿå‘½å‘¨æœŸä¸­ä¼šç»å†å¤šä¸ªçŠ¶æ€å˜åŒ–ï¼ŒçŠ¶æ€å›¾å¯æ¸…æ™°å±•ç¤ºå…¶çŠ¶æ€åˆ‡æ¢é€»è¾‘ã€‚</p><p><strong>çŠ¶æ€èŠ‚ç‚¹</strong>ï¼š</p><ul><li>ç©ºé—²ï¼ˆIdleï¼‰</li><li>å·²é¢„å®šï¼ˆReservedï¼‰</li><li>ç§Ÿèµä¸­ï¼ˆRentedï¼‰</li><li>æ£€ä¿®ä¸­ï¼ˆUnder Maintenanceï¼‰</li></ul><p><strong>è§¦å‘äº‹ä»¶</strong>ï¼š</p><ul><li>å®¢æˆ·æäº¤é¢„å®šç”³è¯· â†’ çŠ¶æ€ç”±â€œç©ºé—²â€å˜ä¸ºâ€œå·²é¢„å®šâ€</li><li>å®¢æˆ·å–è½¦ â†’ çŠ¶æ€å˜ä¸ºâ€œç§Ÿèµä¸­â€</li><li>å®¢æˆ·è¿˜è½¦åè½¦è¾†æ­£å¸¸ â†’ çŠ¶æ€å˜ä¸ºâ€œç©ºé—²â€</li><li>å®¢æˆ·è¿˜è½¦åè½¦è¾†æŸå â†’ çŠ¶æ€å˜ä¸ºâ€œæ£€ä¿®ä¸­â€</li><li>æ£€ä¿®å®Œæ¯• â†’ çŠ¶æ€æ¢å¤ä¸ºâ€œç©ºé—²â€</li></ul><h3 id="ï¼ˆ2ï¼‰ç§Ÿèµè®°å½•ï¼ˆRentalï¼‰çŠ¶æ€å›¾">ï¼ˆ2ï¼‰ç§Ÿèµè®°å½•ï¼ˆRentalï¼‰çŠ¶æ€å›¾</h3><p><code>Rental</code> å¯¹è±¡ä»£è¡¨ä¸€æ¬¡ç§Ÿèµäº¤æ˜“ï¼Œå…¶çŠ¶æ€æµè½¬åæ˜ äº¤æ˜“çš„æ‰§è¡Œè¿›åº¦ä¸å®Œæˆæƒ…å†µã€‚</p><p><strong>çŠ¶æ€èŠ‚ç‚¹</strong>ï¼š</p><ul><li>å¾…å®¡æ ¸ï¼ˆPendingï¼‰</li><li>å·²æ‰¹å‡†ï¼ˆApprovedï¼‰</li><li>è¿›è¡Œä¸­ï¼ˆOngoingï¼‰</li><li>å·²å®Œæˆï¼ˆCompletedï¼‰</li><li>è¢«æ‹’ç»ï¼ˆRejectedï¼‰</li></ul><p><strong>è§¦å‘äº‹ä»¶</strong>ï¼š</p><ul><li>ç”¨æˆ·æäº¤ç”³è¯· â†’ çŠ¶æ€è®¾ä¸ºâ€œå¾…å®¡æ ¸â€</li><li>å·¥ä½œäººå‘˜å®¡æ ¸é€šè¿‡ â†’ çŠ¶æ€å˜ä¸ºâ€œå·²æ‰¹å‡†â€</li><li>å®¢æˆ·å–è½¦å â†’ çŠ¶æ€è®¾ä¸ºâ€œè¿›è¡Œä¸­â€</li><li>å®¢æˆ·è¿˜è½¦å¹¶ç»“ç®—å®Œæˆ â†’ çŠ¶æ€è®¾ä¸ºâ€œå·²å®Œæˆâ€</li><li>å®¡æ ¸ä¸é€šè¿‡ â†’ çŠ¶æ€å˜ä¸ºâ€œè¢«æ‹’ç»â€</li></ul><p>ä»¥ä¸‹é™„ä¸Šå®éªŒæŠ¥å‘Š</p><p><a href="https://www.legendkiller.xyz/wp-content/uploads/2025/05/%E8%AE%A1%E6%9C%AC2204-202214024112-%E7%8E%8B%E7%A3%8A-1-3.doc">è®¡æœ¬2204 202214024112 ç‹ç£Š</a><a href="https://www.legendkiller.xyz/wp-content/uploads/2025/05/%E8%AE%A1%E6%9C%AC2204-202214024112-%E7%8E%8B%E7%A3%8A-1-3.doc">ä¸‹è½½</a></p>]]></content>
    
    
    <summary type="html">å…³äºæ±½è½¦ç§Ÿèµç³»ç»Ÿçš„UMLè®¾è®¡å»ºæ¨¡</summary>
    
    
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://itgeqian.github.io/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="UMLå»ºæ¨¡" scheme="https://itgeqian.github.io/tags/UML%E5%BB%BA%E6%A8%A1/"/>
    
  </entry>
  
  <entry>
    <title>è½æ—¥</title>
    <link href="https://itgeqian.github.io/posts/7.html"/>
    <id>https://itgeqian.github.io/posts/7.html</id>
    <published>2025-05-20T04:19:03.000Z</published>
    <updated>2025-05-20T04:19:05.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç¢‘æ˜¯é‚£ä¹ˆå°ï¼Œä¸å…¶è¯´æ˜¯ä¸ºäº†çºªå¿µï¼Œæ›´åƒæ˜¯ä¸ºäº†å¿˜å´ã€‚</p><p>å¶æ–‡æ´èµ°åˆ°æ‚¬å´–è¾¹ï¼Œå¥¹æ›¾åœ¨è¿™é‡Œäº²æ‰‹ç»“æŸäº†ä¸¤ä¸ªå†›äººçš„ç”Ÿå‘½ã€‚å¥¹å¹¶æ²¡æœ‰åƒå…¶ä»–åŒè¡Œçš„äººé‚£æ ·çœºæœ›äº‘æµ·ï¼Œè€Œæ˜¯æŠŠç›®å…‰é›†ä¸­åˆ°ä¸€ä¸ªæ–¹å‘ï¼Œåœ¨é‚£ä¸€ç‰‡äº‘å±‚ä¸‹é¢ï¼Œæœ‰ä¸€ä¸ªå«é½å®¶å±¯çš„å°æ‘åº„â€¦â€¦</p><p>å¶æ–‡æ´çš„å¿ƒè„è‰°éš¾åœ°è·³åŠ¨ç€ï¼Œåƒä¸€æ ¹å³å°†æ–­è£‚çš„ç´å¼¦ï¼Œé»‘é›¾å¼€å§‹åœ¨å¥¹çš„çœ¼å‰æ¼«æ¶Œï¼Œå¥¹ç”¨å°½ç”Ÿå‘½çš„æœ€åèƒ½é‡åšæŒç€ï¼Œåœ¨ä¸€åˆ‡éƒ½æ²¡å…¥æ°¸æ’çš„é»‘æš—ä¹‹å‰ï¼Œå¥¹æƒ³å†çœ‹ä¸€æ¬¡çº¢å²¸åŸºåœ°çš„æ—¥è½ã€‚</p><p>åœ¨è¥¿æ–¹çš„å¤©é™…ï¼Œæ­£åœ¨äº‘æµ·ä¸­ä¸‹æ²‰çš„å¤•é˜³ä»¿ä½›è¢«èåŒ–äº†ï¼Œå¤ªé˜³çš„è¡€åœ¨äº‘æµ·å’Œå¤©ç©ºä¸­å¼¥æ¼«å¼€æ¥ï¼Œæ˜ ç°å‡ºä¸€å¤§ç‰‡å£®ä¸½çš„è¡€çº¢ã€‚</p><p>â€œè¿™æ˜¯äººç±»çš„è½æ—¥â€¦â€¦â€å¶æ–‡æ´è½»è½»åœ°è¯´ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-485-1024x657.png" alt="img"></p>]]></content>
    
    
    <summary type="html">è½æ—¥</summary>
    
    
    
    <category term="æ‚é¡¹" scheme="https://itgeqian.github.io/categories/%E6%9D%82%E9%A1%B9/"/>
    
    
    <category term="çŸ­æ–‡" scheme="https://itgeqian.github.io/tags/%E7%9F%AD%E6%96%87/"/>
    
  </entry>
  
  <entry>
    <title>Rediså®æˆ˜ç¯‡</title>
    <link href="https://itgeqian.github.io/posts/6.html"/>
    <id>https://itgeqian.github.io/posts/6.html</id>
    <published>2024-09-14T01:19:03.000Z</published>
    <updated>2024-09-17T13:12:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¯¼è¯»ï¼šå®æˆ˜ç¯‡æˆ‘ä»¬è¦å­¦ä¹ ä¸€äº›ä»€ä¹ˆæ ·çš„å†…å®¹</p><ul><li>çŸ­ä¿¡ç™»å½•</li></ul><p>è¿™ä¸€å—æˆ‘ä»¬ä¼šä½¿ç”¨rediså…±äº«sessionæ¥å®ç°</p><ul><li>å•†æˆ·æŸ¥è¯¢ç¼“å­˜</li></ul><p>é€šè¿‡æœ¬ç« èŠ‚ï¼Œæˆ‘ä»¬ä¼šç†è§£ç¼“å­˜å‡»ç©¿ï¼Œç¼“å­˜ç©¿é€ï¼Œç¼“å­˜é›ªå´©ç­‰é—®é¢˜ï¼Œè®©å°ä¼™ä¼´çš„å¯¹äºè¿™äº›æ¦‚å¿µçš„ç†è§£ä¸ä»…ä»…æ˜¯åœç•™åœ¨æ¦‚å¿µä¸Šï¼Œæ›´æ˜¯èƒ½åœ¨ä»£ç ä¸­çœ‹åˆ°å¯¹åº”çš„å†…å®¹</p><ul><li>ä¼˜æƒ å·ç§’æ€</li></ul><p>é€šè¿‡æœ¬ç« èŠ‚ï¼Œæˆ‘ä»¬å¯ä»¥å­¦ä¼šRedisçš„è®¡æ•°å™¨åŠŸèƒ½ï¼Œ ç»“åˆLuaå®Œæˆé«˜æ€§èƒ½çš„redisæ“ä½œï¼ŒåŒæ—¶å­¦ä¼šRedisåˆ†å¸ƒå¼é”çš„åŸç†ï¼ŒåŒ…æ‹¬Redisçš„ä¸‰ç§æ¶ˆæ¯é˜Ÿåˆ—</p><ul><li>é™„è¿‘çš„å•†æˆ·</li></ul><p>æˆ‘ä»¬åˆ©ç”¨Redisçš„GEOHashæ¥å®Œæˆå¯¹äºåœ°ç†åæ ‡çš„æ“ä½œ</p><ul><li>UVç»Ÿè®¡</li></ul><p>ä¸»è¦æ˜¯ä½¿ç”¨Redisæ¥å®Œæˆç»Ÿè®¡åŠŸèƒ½</p><ul><li>ç”¨æˆ·ç­¾åˆ°</li></ul><p>ä½¿ç”¨Redisçš„BitMapæ•°æ®ç»Ÿè®¡åŠŸèƒ½</p><ul><li>å¥½å‹å…³æ³¨</li></ul><p>åŸºäºSeté›†åˆçš„å…³æ³¨ã€å–æ¶ˆå…³æ³¨ï¼Œå…±åŒå…³æ³¨ç­‰ç­‰åŠŸèƒ½ï¼Œè¿™ä¸€å—çŸ¥è¯†å’±ä»¬ä¹‹å‰å°±è®²è¿‡ï¼Œè¿™æ¬¡æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­æ¥ä½¿ç”¨ä¸€ä¸‹</p><ul><li>æ‰“äººæ¢åº—</li></ul><p>åŸºäºListæ¥å®Œæˆç‚¹èµåˆ—è¡¨çš„æ“ä½œï¼ŒåŒæ—¶åŸºäºSortedSetæ¥å®Œæˆç‚¹èµçš„æ’è¡Œæ¦œåŠŸèƒ½</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-24-1024x590.png" alt="img"></p><h2 id="1ã€çŸ­ä¿¡ç™»å½•">1ã€çŸ­ä¿¡ç™»å½•</h2><h3 id="1-1ã€å¯¼å…¥é»‘é©¬ç‚¹è¯„é¡¹ç›®">1.1ã€å¯¼å…¥é»‘é©¬ç‚¹è¯„é¡¹ç›®</h3><h4 id="1-1-1-ã€å¯¼å…¥SQLï¼ˆMysqlç‰ˆæœ¬å¤§äº5-7ï¼‰">1.1.1 ã€å¯¼å…¥SQLï¼ˆMysqlç‰ˆæœ¬å¤§äº5.7ï¼‰</h4><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-25.png" alt="img"></p><h4 id="1-1-2ã€æœ‰å…³å½“å‰æ¨¡å‹">1.1.2ã€æœ‰å…³å½“å‰æ¨¡å‹</h4><p>æ‰‹æœºæˆ–è€…appç«¯å‘èµ·è¯·æ±‚ï¼Œè¯·æ±‚æˆ‘ä»¬çš„nginxæœåŠ¡å™¨ï¼ŒnginxåŸºäºä¸ƒå±‚æ¨¡å‹èµ°çš„äº‹HTTPåè®®ï¼Œå¯ä»¥å®ç°åŸºäºLuaç›´æ¥ç»•å¼€tomcatè®¿é—®redisï¼Œä¹Ÿå¯ä»¥ä½œä¸ºé™æ€èµ„æºæœåŠ¡å™¨ï¼Œè½»æ¾æ‰›ä¸‹ä¸Šä¸‡å¹¶å‘ï¼Œ è´Ÿè½½å‡è¡¡åˆ°ä¸‹æ¸¸tomcatæœåŠ¡å™¨ï¼Œæ‰“æ•£æµé‡ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ä¸€å°4æ ¸8Gçš„tomcatï¼Œåœ¨ä¼˜åŒ–å’Œå¤„ç†ç®€å•ä¸šåŠ¡çš„åŠ æŒä¸‹ï¼Œå¤§ä¸äº†å°±å¤„ç†1000å·¦å³çš„å¹¶å‘ï¼Œ ç»è¿‡nginxçš„è´Ÿè½½å‡è¡¡åˆ†æµåï¼Œåˆ©ç”¨é›†ç¾¤æ”¯æ’‘èµ·æ•´ä¸ªé¡¹ç›®ï¼ŒåŒæ—¶nginxåœ¨éƒ¨ç½²äº†å‰ç«¯é¡¹ç›®åï¼Œæ›´æ˜¯å¯ä»¥åšåˆ°åŠ¨é™åˆ†ç¦»ï¼Œè¿›ä¸€æ­¥é™ä½tomcatæœåŠ¡çš„å‹åŠ›ï¼Œè¿™äº›åŠŸèƒ½éƒ½å¾—é nginxèµ·ä½œç”¨ï¼Œæ‰€ä»¥nginxæ˜¯æ•´ä¸ªé¡¹ç›®ä¸­é‡è¦çš„ä¸€ç¯ã€‚</p><p>åœ¨tomcatæ”¯æ’‘èµ·å¹¶å‘æµé‡åï¼Œæˆ‘ä»¬å¦‚æœè®©tomcatç›´æ¥å»è®¿é—®Mysqlï¼Œæ ¹æ®ç»éªŒMysqlä¼ä¸šçº§æœåŠ¡å™¨åªè¦ä¸Šç‚¹å¹¶å‘ï¼Œä¸€èˆ¬æ˜¯16æˆ–32 æ ¸å¿ƒcpuï¼Œ32 æˆ–64Gå†…å­˜ï¼Œåƒä¼ä¸šçº§mysqlåŠ ä¸Šå›ºæ€ç¡¬ç›˜èƒ½å¤Ÿæ”¯æ’‘çš„å¹¶å‘ï¼Œå¤§æ¦‚å°±æ˜¯4000èµ·~7000å·¦å³ï¼Œä¸Šä¸‡å¹¶å‘ï¼Œ ç¬é—´å°±ä¼šè®©MysqlæœåŠ¡å™¨çš„cpuï¼Œç¡¬ç›˜å…¨éƒ¨æ‰“æ»¡ï¼Œå®¹æ˜“å´©æºƒï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œä¼šé€‰æ‹©ä½¿ç”¨mysqlé›†ç¾¤ï¼ŒåŒæ—¶ä¸ºäº†è¿›ä¸€æ­¥é™ä½Mysqlçš„å‹åŠ›ï¼ŒåŒæ—¶å¢åŠ è®¿é—®çš„æ€§èƒ½ï¼Œæˆ‘ä»¬ä¹Ÿä¼šåŠ å…¥Redisï¼ŒåŒæ—¶ä½¿ç”¨Redisé›†ç¾¤ä½¿å¾—Rediså¯¹å¤–æä¾›æ›´å¥½çš„æœåŠ¡ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-26-1024x432.png" alt="img"></p><p>1.1.3ã€å¯¼å…¥åç«¯é¡¹ç›®</p><p>æ³¨æ„è¦ä¿®æ”¹application.yamlæ–‡ä»¶é‡Œçš„mysqlï¼Œredisåœ°å€ä¿¡æ¯</p><p>1.1.4ã€å¯¼å…¥å‰ç«¯å·¥ç¨‹</p><p>1.1.5 è¿è¡Œå‰ç«¯é¡¹ç›®</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">localhost</span>ï¼š<span class="number">8080</span></span><br></pre></td></tr></table></figure><h3 id="1-2-ã€åŸºäºSessionå®ç°ç™»å½•æµç¨‹">1.2 ã€åŸºäºSessionå®ç°ç™»å½•æµç¨‹</h3><p><strong>å‘é€éªŒè¯ç ï¼š</strong></p><p>ç”¨æˆ·åœ¨æäº¤æ‰‹æœºå·åï¼Œä¼šæ ¡éªŒæ‰‹æœºå·æ˜¯å¦åˆæ³•ï¼Œå¦‚æœä¸åˆæ³•ï¼Œåˆ™è¦æ±‚ç”¨æˆ·é‡æ–°è¾“å…¥æ‰‹æœºå·</p><p>å¦‚æœæ‰‹æœºå·åˆæ³•ï¼Œåå°æ­¤æ—¶ç”Ÿæˆå¯¹åº”çš„éªŒè¯ç ï¼ŒåŒæ—¶å°†éªŒè¯ç è¿›è¡Œä¿å­˜ï¼Œç„¶åå†é€šè¿‡çŸ­ä¿¡çš„æ–¹å¼å°†éªŒè¯ç å‘é€ç»™ç”¨æˆ·</p><p><strong>çŸ­ä¿¡éªŒè¯ç ç™»å½•ã€æ³¨å†Œï¼š</strong></p><p>ç”¨æˆ·å°†éªŒè¯ç å’Œæ‰‹æœºå·è¿›è¡Œè¾“å…¥ï¼Œåå°ä»sessionä¸­æ‹¿åˆ°å½“å‰éªŒè¯ç ï¼Œç„¶åå’Œç”¨æˆ·è¾“å…¥çš„éªŒè¯ç è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œåˆ™æ— æ³•é€šè¿‡æ ¡éªŒï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™åå°æ ¹æ®æ‰‹æœºå·æŸ¥è¯¢ç”¨æˆ·ï¼Œå¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œåˆ™ä¸ºç”¨æˆ·åˆ›å»ºè´¦å·ä¿¡æ¯ï¼Œä¿å­˜åˆ°æ•°æ®åº“ï¼Œæ— è®ºæ˜¯å¦å­˜åœ¨ï¼Œéƒ½ä¼šå°†ç”¨æˆ·ä¿¡æ¯ä¿å­˜åˆ°sessionä¸­ï¼Œæ–¹ä¾¿åç»­è·å¾—å½“å‰ç™»å½•ä¿¡æ¯</p><p><strong>æ ¡éªŒç™»å½•çŠ¶æ€:</strong></p><p>ç”¨æˆ·åœ¨è¯·æ±‚æ—¶å€™ï¼Œä¼šä»cookieä¸­æºå¸¦è€…JsessionIdåˆ°åå°ï¼Œåå°é€šè¿‡JsessionIdä»sessionä¸­æ‹¿åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰sessionä¿¡æ¯ï¼Œåˆ™è¿›è¡Œæ‹¦æˆªï¼Œå¦‚æœæœ‰sessionä¿¡æ¯ï¼Œåˆ™å°†ç”¨æˆ·ä¿¡æ¯ä¿å­˜åˆ°threadLocalä¸­ï¼Œå¹¶ä¸”æ”¾è¡Œ</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-27-1024x494.png" alt="img"></p><h3 id="1-3å®ç°å‘é€çŸ­ä¿¡éªŒè¯ç ">1.3å®ç°å‘é€çŸ­ä¿¡éªŒè¯ç </h3><p><strong>é¡µé¢æµç¨‹</strong></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-29-1024x443.png" alt="img"></p><p>å…·ä½“ä»£ç å¦‚ä¸‹</p><ul><li>*<strong>å‘é€éªŒè¯ç *</strong></li></ul><p>UserController</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‘é€æ‰‹æœºéªŒè¯ç </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable">@PostMapping</span>(<span class="string">&quot;code&quot;</span>)</span><br><span class="line">public Result <span class="built_in">sendCode</span>(<span class="variable">@RequestParam</span>(<span class="string">&quot;phone&quot;</span>) String phone, HttpSession session) &#123;</span><br><span class="line">    <span class="comment">// TODO å‘é€çŸ­ä¿¡éªŒè¯ç å¹¶ä¿å­˜éªŒè¯ç </span></span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">userService</span><span class="selector-class">.sendCode</span>(phone, session);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>IUserService</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;<span class="title class_">User</span>&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€éªŒè¯ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> <span class="variable">phone</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> <span class="variable">session</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title class_">Result</span> <span class="title function_">sendCode</span>(<span class="title class_">String</span> phone, <span class="title class_">HttpSession</span> session);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">IUserServiceImpl</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‘é€éªŒè¯ç </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">phone</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">session</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> <span class="title class_">Result</span> <span class="title function_">sendCode</span>(<span class="params"><span class="title class_">String</span> phone, <span class="title class_">HttpSession</span> session</span>) &#123;</span><br><span class="line"> <span class="comment">// 1.æ ¡éªŒæ‰‹æœºå·</span></span><br><span class="line"> <span class="keyword">if</span> (<span class="title class_">RegexUtils</span>.<span class="title function_">isPhoneInvalid</span>(phone)) &#123;</span><br><span class="line"> <span class="comment">// 2.å¦‚æœä¸ç¬¦åˆï¼Œè¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class="line"> <span class="keyword">return</span> <span class="title class_">Result</span>.<span class="title function_">fail</span>(<span class="string">&quot;æ‰‹æœºå·æ ¼å¼é”™è¯¯ï¼&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">// 3.ç¬¦åˆï¼Œç”ŸæˆéªŒè¯ç </span></span><br><span class="line"> <span class="title class_">String</span> code = <span class="title class_">RandomUtil</span>.<span class="title function_">randomNumbers</span>(<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 4.ä¿å­˜éªŒè¯ç åˆ° session</span></span><br><span class="line"> session.<span class="title function_">setAttribute</span>(<span class="string">&quot;code&quot;</span>,code);</span><br><span class="line"> <span class="comment">// 5.å‘é€éªŒè¯ç </span></span><br><span class="line"> log.<span class="title function_">debug</span>(<span class="string">&quot;å‘é€çŸ­ä¿¡éªŒè¯ç æˆåŠŸï¼ŒéªŒè¯ç ï¼š&#123;&#125;&quot;</span>, code);</span><br><span class="line"> <span class="comment">// è¿”å›ok</span></span><br><span class="line"> <span class="keyword">return</span> <span class="title class_">Result</span>.<span class="title function_">ok</span>();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><ul><li>*<strong>ç™»å½•*</strong></li></ul><p>UserController</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç™»å½•åŠŸèƒ½</span></span><br><span class="line"><span class="comment"> * @param loginForm ç™»å½•å‚æ•°ï¼ŒåŒ…å«æ‰‹æœºå·ã€éªŒè¯ç ï¼›æˆ–è€…æ‰‹æœºå·ã€å¯†ç </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable">@PostMapping</span>(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">public Result <span class="built_in">login</span>(<span class="variable">@RequestBody</span> LoginFormDTO loginForm, HttpSession session)&#123;</span><br><span class="line">    <span class="comment">// å®ç°ç™»å½•åŠŸèƒ½</span></span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">userService</span><span class="selector-class">.login</span>(loginForm, session);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>IUserService</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç™»å½•åŠŸèƒ½</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> loginForm</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Result <span class="title">login</span><span class="params">(LoginFormDTO loginForm, HttpSession session)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>IUserServiceImpl</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·ç™»å½•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">loginForm</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">session</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_">Result</span> <span class="title function_">login</span>(<span class="params"><span class="title class_">LoginFormDTO</span> loginForm, <span class="title class_">HttpSession</span> session</span>) &#123;</span><br><span class="line">    <span class="comment">//1.æ ¡éªŒæ‰‹æœºå·</span></span><br><span class="line">    <span class="title class_">String</span> phone = loginForm.<span class="title function_">getPhone</span>();</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">RegexUtils</span>.<span class="title function_">isPhoneInvalid</span>(phone)) &#123;</span><br><span class="line">        <span class="comment">//å¦‚æœä¸ç¬¦åˆï¼Œè¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Result</span>.<span class="title function_">fail</span>(<span class="string">&quot;æ‰‹æœºå·æ ¼å¼é”™è¯¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.æ ¡éªŒéªŒè¯ç </span></span><br><span class="line">    <span class="title class_">Object</span> cacheCode = session.<span class="title function_">getAttribute</span>(<span class="string">&quot;code&quot;</span>);</span><br><span class="line">    <span class="title class_">String</span> code = loginForm.<span class="title function_">getCode</span>();</span><br><span class="line">    <span class="keyword">if</span> (cacheCode == <span class="literal">null</span> || !cacheCode.<span class="title function_">toString</span>().<span class="title function_">equals</span>(code)) &#123;</span><br><span class="line">        <span class="comment">//3.ä¸ä¸€è‡´ï¼Œç›´æ¥è¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Result</span>.<span class="title function_">fail</span>(<span class="string">&quot;éªŒè¯ç é”™è¯¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.ä¸€è‡´ï¼Œæ ¹æ®æ‰‹æœºå·æŸ¥è¯¢ç”¨æˆ· select * from tb_user where phone = ?</span></span><br><span class="line">    <span class="title class_">User</span> user = <span class="title function_">query</span>().<span class="title function_">eq</span>(<span class="string">&quot;phone&quot;</span>, phone).<span class="title function_">one</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">//6ã€‚ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°ç”¨æˆ·å¹¶ä¿å­˜</span></span><br><span class="line">        user = <span class="title function_">createUserWithPhone</span>(phone);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//7.å­˜åœ¨ï¼Œä¿å­˜ç”¨æˆ·åˆ°session</span></span><br><span class="line">    session.<span class="title function_">setAttribute</span>(<span class="string">&quot;user&quot;</span>, user);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//8.è¿”å›ç™»å½•æˆåŠŸçš„ç»“æœ</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Result</span>.<span class="title function_">ok</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="title class_">User</span> <span class="title function_">createUserWithPhone</span>(<span class="params"><span class="title class_">String</span> phone</span>) &#123;</span><br><span class="line">    <span class="comment">//1.åˆ›å»ºç”¨æˆ·</span></span><br><span class="line">    <span class="title class_">User</span> user = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.<span class="title function_">setPhone</span>(phone);</span><br><span class="line">    user.<span class="title function_">setNickName</span>(<span class="variable constant_">USER_NICK_NAME_PREFIX</span>+<span class="title class_">RandomUtil</span>.<span class="title function_">randomString</span>(<span class="number">10</span>));</span><br><span class="line">    <span class="comment">//2.ä¿å­˜ç”¨æˆ·åˆ°æ•°æ®åº“ insert into tb_user values (null, ?, null)</span></span><br><span class="line">    <span class="title function_">save</span>(user);</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-4-æ˜¾ç¤ºç™»å½•æ‹¦æˆª">1.4 æ˜¾ç¤ºç™»å½•æ‹¦æˆª</h3><p><strong>tomcatçš„è¿è¡ŒåŸç†</strong></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-53-1024x599.png" alt="img"></p><h4 id="1-å»ºç«‹è¿æ¥"><strong>1. å»ºç«‹è¿æ¥</strong></h4><ul><li><strong>ç”¨æˆ·ï¼ˆå®¢æˆ·ç«¯ï¼‰</strong> å‘èµ·ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œé¦–å…ˆä¼šé€šè¿‡æµè§ˆå™¨æˆ–å…¶ä»–å®¢æˆ·ç«¯å‘èµ· <strong>TCP è¿æ¥</strong>ã€‚</li><li>è¿™ä¸ªè¿æ¥ç”±ç”¨æˆ·çš„ <strong>socket</strong> å»ºç«‹ï¼Œè¿æ¥åˆ°æœåŠ¡å™¨ä¸ŠæŒ‡å®šçš„ <strong>ç«¯å£å·</strong>ï¼ˆTomcat æ³¨å†Œçš„ç«¯å£ï¼Œå¦‚é»˜è®¤çš„ 8080ï¼‰ã€‚</li><li>Tomcat åœ¨å¯åŠ¨æ—¶ï¼Œä¼šå¼€å¯ä¸€ä¸ª <strong>ç›‘å¬çº¿ç¨‹</strong>ï¼ˆAcceptorï¼‰ï¼Œä¸“é—¨è´Ÿè´£ç›‘å¬è¯¥ç«¯å£ï¼Œç­‰å¾…æ¥å…¥çš„ socket è¿æ¥ã€‚</li></ul><h4 id="2-åˆ†å‘è¯·æ±‚"><strong>2. åˆ†å‘è¯·æ±‚</strong></h4><ul><li>ä¸€æ—¦ç›‘å¬çº¿ç¨‹ç›‘å¬åˆ°å®¢æˆ·ç«¯å‘æ¥çš„è¿æ¥è¯·æ±‚ï¼Œå®ƒå°±ä¼šï¼š<ul><li><strong>æ¥æ”¶ socket è¿æ¥</strong></li><li>å°†è¿™ä¸ªè¿æ¥äº¤ç»™ <strong>å·¥ä½œçº¿ç¨‹æ± ï¼ˆWorker Thread Poolï¼‰</strong> ä¸­çš„ä¸€ä¸ªçº¿ç¨‹å»å¤„ç†ã€‚</li></ul></li><li>è¿™ä¸€æ­¥å¾ˆå…³é”®ï¼š<ul><li>æ¯ä¸ªè¯·æ±‚éƒ½è¢«åˆ†å‘ç»™çº¿ç¨‹æ± ä¸­çš„ä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œ<strong>å®ç°äº†å¤šçº¿ç¨‹å¹¶å‘å¤„ç†</strong>ã€‚</li><li>è¿™ä¸ªçº¿ç¨‹éšåä¼šè´Ÿè´£æ•´ä¸ªè¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸã€‚</li></ul></li></ul><h4 id="3-å¤„ç†è¯·æ±‚"><strong>3. å¤„ç†è¯·æ±‚</strong></h4><ul><li><p>å·¥ä½œçº¿ç¨‹æ¥æ‰‹åï¼Œå®ƒä¼šï¼š</p><ul><li>è¯»å–å®¢æˆ·ç«¯å‘é€çš„ HTTP è¯·æ±‚æ•°æ®ã€‚</li><li>æŠŠè¿™äº›æ•°æ®è§£ææˆæ ‡å‡†çš„ <strong><code>HttpServletRequest</code></strong> å¯¹è±¡ï¼Œå¹¶å‡†å¤‡å¥½ä¸€ä¸ªç©ºçš„ <strong><code>HttpServletResponse</code></strong>ã€‚</li></ul></li><li><p>ç„¶åè¯·æ±‚è¿›å…¥ä½ éƒ¨ç½²åœ¨ Tomcat ä¸­çš„</p><p>WebApp</p><p>ï¼ˆSpringMVCã€Servlet åº”ç”¨ç­‰ï¼‰ï¼š</p><ul><li>ä¾æ¬¡ç»è¿‡ï¼š<ul><li><strong>Controller</strong>ï¼ˆæ¥æ”¶è¯·æ±‚ï¼Œè·¯ç”±åˆ†å‘ï¼‰</li><li><strong>Service</strong>ï¼ˆå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼‰</li><li><strong>DAO</strong>ï¼ˆè®¿é—®æ•°æ®åº“ï¼Œè·å–æˆ–ä¿®æ”¹æ•°æ®ï¼‰</li></ul></li></ul></li><li><p>æ•°æ®å¤„ç†å®Œæˆåï¼Œè¿”å›å€¼ä¼šå°è£…åˆ° <code>response</code> ä¸­ã€‚</p></li></ul><h4 id="4-è¿”å›å“åº”"><strong>4. è¿”å›å“åº”</strong></h4><ul><li>ä¸€æ—¦ä¸šåŠ¡å¤„ç†å®Œæ¯•ï¼Œçº¿ç¨‹å°†å“åº”å†…å®¹å†™å…¥ <code>HttpServletResponse</code>ã€‚</li><li>ç„¶åå†é€šè¿‡æœ€åˆå»ºç«‹çš„ <strong>socket è¿æ¥</strong>ï¼ŒæŠŠå“åº”æ•°æ®å‘é€å›å®¢æˆ·ç«¯ï¼ˆç”¨æˆ·ï¼‰ã€‚</li><li>è‡³æ­¤ï¼Œ<strong>ä¸€ä¸ªè¯·æ±‚-å“åº”ç”Ÿå‘½å‘¨æœŸå®Œæˆ</strong>ï¼Œsocket è¿æ¥å¯èƒ½è¢«å…³é—­æˆ–å¤ç”¨ï¼ˆæ ¹æ®æ˜¯å¦ä½¿ç”¨ keep-aliveï¼‰ã€‚</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-54-1024x522.png" alt="img"></p><p>preHandleå‰ç½®æ‹¦æˆªï¼š</p><p>postHandleåç½®æ‹¦æˆªï¼š</p><p>afterCompletionè§†å›¾æ¸²æŸ“ä¹‹åè¿”å›ç»™ç”¨æˆ·ä¹‹å‰ï¼š</p><p>åœ¨utilsä¸‹é¢ç¼–å†™ä¸€ä¸ªLoginInterceptorç±»ï¼Œå®ç°preHandleå’ŒafterCompletionè¿™ä¸¤ä¸ªæ–¹æ³•ï¼ˆè¿™é‡ŒUserå’ŒUserDtoçš„é—®é¢˜ï¼Œæˆ‘æ¨èçš„æ˜¯ç»Ÿä¸€ä½¿ç”¨UserDtoï¼Œé‡‡ç”¨BeanUtilsé‡Œçš„copyæ–¹æ³•å³å¯ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//è·å–session</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        <span class="comment">//è·å–ç”¨æˆ·</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) session.getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="comment">//åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span>(user==<span class="literal">null</span>)&#123;</span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDTO</span>();</span><br><span class="line">        BeanUtils.copyProperties(user,userDTO);</span><br><span class="line">        <span class="comment">//å­˜åœ¨ï¼Œä¿å­˜ç”¨æˆ·ä¿¡æ¯çš„ThreadLocal</span></span><br><span class="line">        UserHolder.saveUser(userDTO);</span><br><span class="line">        <span class="comment">//æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//ç§»é™¤ç”¨æˆ·</span></span><br><span class="line">        UserHolder.removeUser();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>â€‹<br>åœ¨configä¸‹é¢åˆ›å»ºä¸€ä¸ªMvcConfigç±»ï¼š</p><p>é€šè¿‡addInterceptorsæ–¹æ³•æ¥æ·»åŠ æ‹¦æˆªå™¨ï¼Œregistryæ˜¯æ‹¦æˆªå™¨çš„æ³¨å†Œå™¨ã€‚</p><p>ç”¨.excludePathPatternsæ¥æ’é™¤ä¸éœ€è¦æ‹¦æˆªçš„è·¯å¾„ã€‚åœ¨è¿™é‡Œcodeã€loginã€bloghotã€shopã€shopTypeã€uploadå’Œvoucherç­‰éƒ½ä¸éœ€è¦æ‹¦æˆªã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">StringRedisTemplate</span> stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">addInterceptors</span>(<span class="params"><span class="title class_">InterceptorRegistry</span> registry</span>) &#123;</span><br><span class="line">        <span class="comment">// ç™»å½•æ‹¦æˆªå™¨</span></span><br><span class="line">        registry.<span class="title function_">addInterceptor</span>(<span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>())</span><br><span class="line">                .<span class="title function_">excludePathPatterns</span>(</span><br><span class="line">                        <span class="string">&quot;/shop/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/voucher/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/shop-type/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/upload/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/blog/hot&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/user/code&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/user/login&quot;</span></span><br><span class="line">                ).<span class="title function_">order</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// tokenåˆ·æ–°çš„æ‹¦æˆªå™¨</span></span><br><span class="line">        registry.<span class="title function_">addInterceptor</span>(<span class="keyword">new</span> <span class="title class_">RefreshTokenInterceptor</span>(stringRedisTemplate)).<span class="title function_">addPathPatterns</span>(<span class="string">&quot;/**&quot;</span>).<span class="title function_">order</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å…¥æ‰‹æœºå·ç ç‚¹å‡»è·å–éªŒè¯ç ï¼Œå†™å…¥è¿”å›åç«¯çš„éªŒè¯ç ï¼Œå‹¾é€‰åè®®ä¹‹åï¼Œç™»å½•ä¼šç›´æ¥è¿”å›é¦–é¡µï¼Œæ­¤æ—¶çœ‹æˆ‘çš„ä¸ªäººä¸»é¡µæ²¡é—®é¢˜ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-55.png" alt="img"></p><h3 id="1-5ã€éšè—ç”¨æˆ·æ•æ„Ÿä¿¡æ¯">1.5ã€éšè—ç”¨æˆ·æ•æ„Ÿä¿¡æ¯</h3><p>æˆ‘ä»¬é€šè¿‡æµè§ˆå™¨è§‚å¯Ÿåˆ°æ­¤æ—¶ç”¨æˆ·çš„å…¨éƒ¨ä¿¡æ¯éƒ½åœ¨ï¼Œè¿™æ ·æä¸ºä¸é è°±ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”å½“åœ¨è¿”å›ç”¨æˆ·ä¿¡æ¯ä¹‹å‰ï¼Œå°†ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯è¿›è¡Œéšè—ï¼Œé‡‡ç”¨çš„æ ¸å¿ƒæ€è·¯å°±æ˜¯ä¹¦å†™ä¸€ä¸ªUserDtoå¯¹è±¡ï¼Œè¿™ä¸ªUserDtoå¯¹è±¡å°±æ²¡æœ‰æ•æ„Ÿä¿¡æ¯äº†ï¼Œæˆ‘ä»¬åœ¨è¿”å›å‰ï¼Œå°†æœ‰ç”¨æˆ·æ•æ„Ÿä¿¡æ¯çš„Userå¯¹è±¡è½¬åŒ–æˆæ²¡æœ‰æ•æ„Ÿä¿¡æ¯çš„UserDtoå¯¹è±¡ï¼Œé‚£ä¹ˆå°±èƒ½å¤Ÿé¿å…è¿™ä¸ªå°´å°¬çš„é—®é¢˜äº†</p><p>åœ¨1.4å·²å°†Userè½¬ä¸ºUserDTOè¿”å›ç»™å‰ç«¯ã€‚</p><h3 id="1-6ã€sessionå…±äº«é—®é¢˜">1.6ã€sessionå…±äº«é—®é¢˜</h3><p><strong>æ ¸å¿ƒæ€è·¯åˆ†æï¼š</strong></p><p>æ¯ä¸ªtomcatä¸­éƒ½æœ‰ä¸€ä»½å±äºè‡ªå·±çš„session,å‡è®¾ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®ç¬¬ä¸€å°tomcatï¼Œå¹¶ä¸”æŠŠè‡ªå·±çš„ä¿¡æ¯å­˜æ”¾åˆ°ç¬¬ä¸€å°æœåŠ¡å™¨çš„sessionä¸­ï¼Œä½†æ˜¯ç¬¬äºŒæ¬¡è¿™ä¸ªç”¨æˆ·è®¿é—®åˆ°äº†ç¬¬äºŒå°tomcatï¼Œé‚£ä¹ˆåœ¨ç¬¬äºŒå°æœåŠ¡å™¨ä¸Šï¼Œè‚¯å®šæ²¡æœ‰ç¬¬ä¸€å°æœåŠ¡å™¨å­˜æ”¾çš„sessionï¼Œæ‰€ä»¥æ­¤æ—¶ æ•´ä¸ªç™»å½•æ‹¦æˆªåŠŸèƒ½å°±ä¼šå‡ºç°é—®é¢˜ï¼Œæˆ‘ä»¬èƒ½å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæ—©æœŸçš„æ–¹æ¡ˆæ˜¯<strong>sessionæ‹·è´</strong>ï¼Œå°±æ˜¯è¯´è™½ç„¶æ¯ä¸ªtomcatä¸Šéƒ½æœ‰ä¸åŒçš„sessionï¼Œä½†æ˜¯æ¯å½“ä»»æ„ä¸€å°æœåŠ¡å™¨çš„sessionä¿®æ”¹æ—¶ï¼Œéƒ½ä¼šåŒæ­¥ç»™å…¶ä»–çš„TomcatæœåŠ¡å™¨çš„sessionï¼Œè¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥å®ç°sessionçš„å…±äº«äº†</p><p>ä½†æ˜¯è¿™ç§æ–¹æ¡ˆå…·æœ‰<strong>ä¸¤ä¸ªå¤§é—®é¢˜</strong></p><p>1ã€æ¯å°æœåŠ¡å™¨ä¸­éƒ½æœ‰å®Œæ•´çš„ä¸€ä»½sessionæ•°æ®ï¼Œ<strong>æœåŠ¡å™¨å‹åŠ›è¿‡å¤§ã€‚</strong></p><p>2ã€sessionæ‹·è´æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°<strong>å»¶è¿Ÿ</strong></p><p>æ‰€ä»¥å’±ä»¬åæ¥é‡‡ç”¨çš„æ–¹æ¡ˆéƒ½æ˜¯<strong>åŸºäºredisæ¥å®Œæˆ</strong>ï¼Œæˆ‘ä»¬æŠŠsessionæ¢æˆredisï¼Œ<strong>redisæ•°æ®æœ¬èº«å°±æ˜¯å…±äº«çš„</strong>ï¼Œå°±å¯ä»¥é¿å…sessionå…±äº«çš„é—®é¢˜äº†</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-56-1024x444.png" alt="img"></p><h3 id="1-7-Redisä»£æ›¿sessionçš„ä¸šåŠ¡æµç¨‹">1.7 Redisä»£æ›¿sessionçš„ä¸šåŠ¡æµç¨‹</h3><p>æ€è€ƒä¸€ä¸‹åˆ©ç”¨redisæ¥å­˜å‚¨æ•°æ®ï¼Œé‚£ä¹ˆåˆ°åº•ä½¿ç”¨å“ªç§ç»“æ„å‘¢</p><p>æƒ³è¦ä¿å­˜ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯æœ‰2ç§æ–¹æ³•ï¼š1.ç”¨Stringç±»å‹ã€‚2.ç”¨Hashç±»å‹ã€‚</p><p>å¦‚ä¸‹å›¾ï¼Œå¦‚æœä½¿ç”¨Stringï¼Œæ³¨æ„ä»–çš„valueï¼Œç”¨å¤šå ç”¨ä¸€ç‚¹ç©ºé—´ï¼Œå¦‚æœä½¿ç”¨å“ˆå¸Œï¼Œåˆ™ä»–çš„valueä¸­åªä¼šå­˜å‚¨ä»–æ•°æ®æœ¬èº«ï¼Œå¦‚æœä¸æ˜¯ç‰¹åˆ«åœ¨æ„å†…å­˜ï¼Œå…¶å®ä½¿ç”¨Stringå°±å¯ä»¥å•¦ã€‚</p><p>Stringç±»å‹æ˜¯ä»¥JSONå­—ç¬¦ä¸²æ ¼å¼æ¥ä¿å­˜ï¼Œæ¯”è¾ƒç®€å•ç›´è§‚ï¼Œä½†æ˜¯å ç”¨å†…å­˜æ¯”è¾ƒå¤šï¼ˆå› ä¸ºæœ‰nameå’Œageè¿™ç±»çš„jsonæ ¼å¼ï¼‰ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-59.png" alt="img"></p><p>Hashç»“æ„å¯ä»¥å°†å¯¹è±¡ä¸­çš„æ¯ä¸ªå­—æ®µç‹¬ç«‹å­˜å‚¨ï¼Œå¯ä»¥é’ˆå¯¹å•ä¸ªå­—æ®µåšCRUDï¼Œå¹¶ä¸”å†…å­˜å ç”¨æ›´å°‘ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-58.png" alt="img"></p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Stringç»“æ„ï¼Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„keyï¼Œvalueé”®å€¼å¯¹çš„æ–¹å¼ï¼Œä½†æ˜¯å…³äºkeyçš„å¤„ç†ï¼Œsessionä»–æ˜¯æ¯ä¸ªç”¨æˆ·éƒ½æœ‰è‡ªå·±çš„sessionï¼Œä½†æ˜¯redisçš„keyæ˜¯å…±äº«çš„ï¼Œå’±ä»¬å°±ä¸èƒ½ä½¿ç”¨codeäº†</p><h4 id="1-7-1åœ¨è®¾è®¡è¿™ä¸ªkeyçš„æ—¶å€™ï¼Œéœ€è¦æ»¡è¶³ä¸¤ç‚¹">1.7.1åœ¨è®¾è®¡è¿™ä¸ªkeyçš„æ—¶å€™ï¼Œéœ€è¦æ»¡è¶³ä¸¤ç‚¹</h4><p>1ã€keyè¦å…·æœ‰å”¯ä¸€æ€§</p><p>2ã€keyè¦æ–¹ä¾¿æºå¸¦</p><p>å¦‚æœæˆ‘ä»¬é‡‡ç”¨phoneï¼šæ‰‹æœºå·è¿™ä¸ªçš„æ•°æ®æ¥å­˜å‚¨å½“ç„¶æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯å¦‚æœæŠŠè¿™æ ·çš„æ•æ„Ÿæ•°æ®å­˜å‚¨åˆ°redisä¸­å¹¶ä¸”ä»é¡µé¢ä¸­å¸¦è¿‡æ¥æ¯•ç«Ÿä¸å¤ªåˆé€‚ï¼Œ<strong>æ‰€ä»¥æˆ‘ä»¬åœ¨åå°ç”Ÿæˆä¸€ä¸ªéšæœºä¸²token</strong>ï¼Œç„¶åè®©å‰ç«¯å¸¦æ¥è¿™ä¸ªtokenå°±èƒ½å®Œæˆæˆ‘ä»¬çš„æ•´ä½“é€»è¾‘äº†</p><h4 id="1-7-2-æ•´ä½“è®¿é—®æµç¨‹">1.7.2 æ•´ä½“è®¿é—®æµç¨‹</h4><p>å½“æ³¨å†Œå®Œæˆåï¼Œç”¨æˆ·å»ç™»å½•ä¼šå»æ ¡éªŒç”¨æˆ·æäº¤çš„æ‰‹æœºå·å’ŒéªŒè¯ç ï¼Œæ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™æ ¹æ®æ‰‹æœºå·æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œä¸å­˜åœ¨åˆ™æ–°å»ºï¼Œæœ€åå°†ç”¨æˆ·æ•°æ®ä¿å­˜åˆ°redisï¼Œå¹¶ä¸”ç”Ÿæˆtokenä½œä¸ºredisçš„keyï¼Œå½“æˆ‘ä»¬æ ¡éªŒç”¨æˆ·æ˜¯å¦ç™»å½•æ—¶ï¼Œä¼šå»æºå¸¦ç€tokenè¿›è¡Œè®¿é—®ï¼Œä»redisä¸­å–å‡ºtokenå¯¹åº”çš„valueï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨è¿™ä¸ªæ•°æ®ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ‹¦æˆªï¼Œå¦‚æœå­˜åœ¨åˆ™å°†å…¶ä¿å­˜åˆ°threadLocalä¸­ï¼Œå¹¶ä¸”æ”¾è¡Œã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-60-1024x557.png" alt="img"></p><h3 id="1-8-åŸºäºRediså®ç°çŸ­ä¿¡ç™»å½•">1.8 åŸºäºRediså®ç°çŸ­ä¿¡ç™»å½•</h3><p>åœ¨UserServiceImplä¸­å†™å…¥å¦‚ä¸‹ä»£ç ï¼ˆè°ƒç”¨StringRedisTemplateä¸­çš„setæ–¹æ³•è¿›è¡Œæ•°æ®æ’å…¥ï¼Œæœ€å¥½åœ¨keyçš„å‰é¢åŠ å…¥ä¸šåŠ¡å‰ç¼€ä»¥ç¤ºåŒºåˆ†ï¼Œå½¢æˆåŒºåˆ†ï¼‰ï¼š</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Resource</span><br><span class="line"><span class="keyword">private</span> StringRedisTemplate <span class="built_in">string</span>RedisTemplate;</span><br></pre></td></tr></table></figure><p>åœ¨sendCodeè¿™ä¸ªæ–¹æ³•é‡Œå°†ä¿å­˜éªŒè¯ç çš„ä»£ç æ›¿æ¢ä¸ºä¸‹é¢ï¼š</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¿å­˜éªŒè¯ç åˆ°redis</span></span><br><span class="line"><span class="symbol">stringRedisTemplate.opsForValue</span>()<span class="meta">.set</span>(LOGIN_CODE_KEY+phone,<span class="meta">code</span>,LOGIN_CODE_TTL, TimeUnit.MINUTES)<span class="comment">;</span></span><br></pre></td></tr></table></figure><p>åœ¨loginè¿™ä¸ªæ–¹æ³•é‡Œè¿›è¡Œå¦‚ä¸‹2å¤„ä¿®æ”¹ï¼š</p><p>é¦–å…ˆæ˜¯æ ¡éªŒéªŒè¯ç ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ ¡éªŒéªŒè¯ç </span></span><br><span class="line"><span class="built_in">String</span> cacheCode = stringRedisTemplate.opsForValue().<span class="keyword">get</span>(LOGIN_CODE_KEY + phone);</span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯æ·»åŠ æŠŠç”¨æˆ·ä¿¡æ¯æ·»åŠ åˆ°Redisçš„é€»è¾‘</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 7.ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ° redisä¸­</span></span><br><span class="line">    <span class="comment">// 7.1.éšæœºç”Ÿæˆtokenï¼Œä½œä¸ºç™»å½•ä»¤ç‰Œ</span></span><br><span class="line">    <span class="built_in">String</span> token = UUID.randomUUID().toString(<span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">// 7.2.å°†Userå¯¹è±¡è½¬ä¸ºHashMapå­˜å‚¨</span></span><br><span class="line">    UserDTO userDTO = BeanUtil.copyProperties(user, UserDTO.<span class="keyword">class</span>);</span><br><span class="line">    <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">Object</span>&gt; userMap = BeanUtil.beanToMap(userDTO, <span class="keyword">new</span> HashMap&lt;&gt;(),</span><br><span class="line">            CopyOptions.create()</span><br><span class="line">                    .setIgnoreNullValue(<span class="keyword">true</span>)</span><br><span class="line">                    .setFieldValueEditor((fieldName, fieldValue) -&gt; fieldValue.toString()));</span><br><span class="line">    <span class="comment">// 7.3.å­˜å‚¨</span></span><br><span class="line">    <span class="built_in">String</span> tokenKey = LOGIN_USER_KEY + token;</span><br><span class="line">    stringRedisTemplate.opsForHash().putAll(tokenKey, userMap);</span><br><span class="line">    <span class="comment">// 7.4.è®¾ç½®tokenæœ‰æ•ˆæœŸ</span></span><br><span class="line">    stringRedisTemplate.expire(tokenKey, LOGIN_USER_TTL, TimeUnit.MINUTES);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 8.è¿”å›token</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(token);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨MvcConfigç±»ä¸Šæœ‰@Configurationæ³¨è§£ï¼Œè¯´æ˜æ˜¯ç”±Springæ¥è´Ÿè´£ä¾èµ–æ³¨å…¥ã€‚</p><p>åœ¨MvcConfigç±»ä¸­è¦ç¼–å†™å¦‚ä¸‹çš„ä»£ç ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">StringRedisTemplate</span> stringRedisTemplate;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">addInterceptors</span>(<span class="params"><span class="title class_">InterceptorRegistry</span> registry</span>)&#123;</span><br><span class="line">        registry.<span class="title function_">addInterceptor</span>(<span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>(stringRedisTemplate))</span><br><span class="line">                .<span class="title function_">excludePathPatterns</span>(</span><br><span class="line">                        <span class="string">&quot;/user/code&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/user/login&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/upload/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/blog/hot&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/shop/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/shop-type/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/voucher/**&quot;</span></span><br><span class="line">                );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨utilsä¸‹çš„LoginInterceptorä¸­å†™å…¥å¦‚ä¸‹ä»£ç </p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoginInterceptor</span><span class="params">(StringRedisTemplate stringRedisTemplate)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object <span class="keyword">handler</span>)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//TODOï¼›1.è·å–è¯·æ±‚å¤´ä¸­çš„token</span></span><br><span class="line">        String token = request.getHeader(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StrUtil.isBlank(token))&#123;</span><br><span class="line">            <span class="comment">//ä¸å­˜åœ¨ï¼Œæ‹¦æˆªï¼Œè¿”å›401çŠ¶æ€ç </span></span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//TODOï¼š2.åŸºäºTOKENè·å–redisçš„ç”¨æˆ·</span></span><br><span class="line">        Map&lt;Object, Object&gt; userMap = stringRedisTemplate.opsForHash().entries(LOGIN_USER_KEY + token);</span><br><span class="line">        <span class="comment">//åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span>(userMap.isEmpty())&#123;</span><br><span class="line">            <span class="comment">//ä¸å­˜åœ¨ï¼Œæ‹¦æˆªï¼Œè¿”å›401çŠ¶æ€ç </span></span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//TODOï¼š3.å°†æŸ¥è¯¢åˆ°çš„Hashæ•°æ®è½¬åŒ–ä¸ºUserDTOå¯¹è±¡</span></span><br><span class="line">        UserDTO userDTO = BeanUtil.fillBeanWithMap(userMap, <span class="keyword">new</span> UserDTO(), <span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">//TODOï¼š4.å­˜åœ¨ï¼Œä¿å­˜ç”¨æˆ·ä¿¡æ¯çš„ThreadLocal</span></span><br><span class="line">        UserHolder.saveUser(userDTO);</span><br><span class="line">        <span class="comment">//TODOï¼š5.åˆ·æ–°tokenæœ‰æ•ˆæœŸ</span></span><br><span class="line">        stringRedisTemplate.expire(LOGIN_USER_KEY + token,RedisConstants.LOGIN_USER_TTL, TimeUnit.MINUTES);</span><br><span class="line">        <span class="comment">//æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object <span class="keyword">handler</span>, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//ç§»é™¤ç”¨æˆ·</span></span><br><span class="line">        UserHolder.removeUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼šé¦–å…ˆæŠŠRediså’Œæ•°æ®åº“éƒ½å¯åŠ¨ã€‚ åŸå§‹çš„é¡¹ç›®çš„Redisçš„æœåŠ¡å™¨IDéœ€è¦æ›´æ”¹ä¸ºè‡ªå·±çš„ã€‚ç‚¹å‡»å‘é€éªŒè¯ç ï¼Œredisä¸­æœ‰è®°å½•ï¼Œæ²¡é—®é¢˜ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-61-1024x369.png" alt="img"></p><p>ä½†ç‚¹å‡»ç™»å½•çš„æ—¶å€™ä¼šæŠ¥ä¸€ä¸ªæ— æ³•å°†Longè½¬Stringçš„é”™è¯¯ã€‚å› ä¸ºç”¨çš„æ˜¯stringRedisTemplateè¦æ±‚æ‰€æœ‰çš„å­—æ®µéƒ½æ˜¯stringç±»å‹çš„ã€‚</p><p>éœ€è¦å¯¹UserServiceImplä¸­å¦‚ä¸‹çš„ä½ç½®è¿›è¡Œä¿®æ”¹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-62-1024x471.png" alt="img"></p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">Object</span>&gt; userMap = BeanUtil.beanToMap(userDTO,<span class="keyword">new</span> HashMap&lt;&gt;(),</span><br><span class="line">        CopyOptions.create()</span><br><span class="line">                .setIgnoreNullValue(<span class="literal">true</span>)</span><br><span class="line">                .setFieldValueEditor<span class="function"><span class="params">((fieldName,fieldValue)-&gt;fieldValue.toString())</span>);</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-63-1024x391.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-64-1024x249.png" alt="img"></p><h3 id="1-9-è§£å†³çŠ¶æ€ç™»å½•åˆ·æ–°é—®é¢˜">1.9 è§£å†³çŠ¶æ€ç™»å½•åˆ·æ–°é—®é¢˜</h3><h4 id="1-9-1-åˆå§‹æ–¹æ¡ˆæ€è·¯æ€»ç»“ï¼š">1.9.1 åˆå§‹æ–¹æ¡ˆæ€è·¯æ€»ç»“ï¼š</h4><p>åœ¨è¿™ä¸ªæ–¹æ¡ˆä¸­ï¼Œä»–ç¡®å®å¯ä»¥ä½¿ç”¨å¯¹åº”è·¯å¾„çš„æ‹¦æˆªï¼ŒåŒæ—¶åˆ·æ–°ç™»å½•tokenä»¤ç‰Œçš„å­˜æ´»æ—¶é—´ï¼Œä½†æ˜¯ç°åœ¨è¿™ä¸ªæ‹¦æˆªå™¨ä»–åªæ˜¯æ‹¦æˆªéœ€è¦è¢«æ‹¦æˆªçš„è·¯å¾„ï¼Œ<strong>å‡è®¾å½“å‰ç”¨æˆ·è®¿é—®äº†ä¸€äº›ä¸éœ€è¦æ‹¦æˆªçš„è·¯å¾„ï¼Œé‚£ä¹ˆè¿™ä¸ªæ‹¦æˆªå™¨å°±ä¸ä¼šç”Ÿæ•ˆï¼Œæ‰€ä»¥æ­¤æ—¶ä»¤ç‰Œåˆ·æ–°çš„åŠ¨ä½œå®é™…ä¸Šå°±ä¸ä¼šæ‰§è¡Œ</strong>ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ¡ˆä»–æ˜¯å­˜åœ¨é—®é¢˜çš„</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-65-1024x571.png" alt="img"></p><h4 id="1-9-2-ä¼˜åŒ–æ–¹æ¡ˆ">1.9.2 ä¼˜åŒ–æ–¹æ¡ˆ</h4><p>æ—¢ç„¶ä¹‹å‰çš„æ‹¦æˆªå™¨æ— æ³•å¯¹ä¸éœ€è¦æ‹¦æˆªçš„è·¯å¾„ç”Ÿæ•ˆï¼Œ<strong>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œåœ¨ç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨ä¸­æ‹¦æˆªæ‰€æœ‰çš„è·¯å¾„ï¼ŒæŠŠç¬¬äºŒä¸ªæ‹¦æˆªå™¨åšçš„äº‹æƒ…æ”¾å…¥åˆ°ç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨ä¸­ï¼ŒåŒæ—¶åˆ·æ–°ä»¤ç‰Œ</strong>ï¼Œå› ä¸ºç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨æœ‰äº†threadLocalçš„æ•°æ®ï¼Œæ‰€ä»¥æ­¤æ—¶ç¬¬äºŒä¸ªæ‹¦æˆªå™¨åªéœ€è¦åˆ¤æ–­æ‹¦æˆªå™¨ä¸­çš„userå¯¹è±¡æ˜¯å¦å­˜åœ¨å³å¯ï¼Œå®Œæˆæ•´ä½“åˆ·æ–°åŠŸèƒ½ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-66-1024x507.png" alt="img"></p><h4 id="1-9-3-ä»£ç ">1.9.3 ä»£ç </h4><p>å¤åˆ¶LoginInterceptorå˜æˆä¸€ä»½æ–°çš„RefreshTokenInterceptorï¼ŒæŠŠä¸‹é¢å‡ å¤„åœ°æ–¹æ”¹ä¸ºreturn trueå³å¯ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-67-1024x725.png" alt="img"></p><p>LoginInterceptorçš„ä»£ç å˜æˆå¦‚ä¸‹ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object <span class="keyword">handler</span>)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//1.åˆ¤æ–­æ˜¯å¦éœ€è¦æ‹¦æˆªï¼ˆThreadLocalä¸­æ˜¯å¦æœ‰ç”¨æˆ·ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span>(UserHolder.getUser()==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">//æ²¡æœ‰ï¼Œéœ€è¦æ‹¦æˆªï¼Œè®¾ç½®çŠ¶æ€ç </span></span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">            <span class="comment">//æ‹¦æˆª</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object <span class="keyword">handler</span>, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//ç§»é™¤ç”¨æˆ·</span></span><br><span class="line">        UserHolder.removeUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨è¿˜éœ€è¦åœ¨MvcConfigé‡Œé¢å¯¹æ‹¦æˆªå™¨è¿›è¡Œæ›´æ–°é…ç½®ï¼Œéœ€è¦ï¼ˆç”¨orderï¼‰è°ƒæ•´æ‹¦æˆªå™¨çš„æ‰§è¡Œé¡ºåºï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">StringRedisTemplate</span> stringRedisTemplate;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">addInterceptors</span>(<span class="params"><span class="title class_">InterceptorRegistry</span> registry</span>)&#123;</span><br><span class="line">        registry.<span class="title function_">addInterceptor</span>(<span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>())</span><br><span class="line">                .<span class="title function_">excludePathPatterns</span>(</span><br><span class="line">                        <span class="string">&quot;/user/code&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/user/login&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/upload/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/blog/hot&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/shop/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/shop-type/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/voucher/**&quot;</span></span><br><span class="line">                ).<span class="title function_">order</span>(<span class="number">1</span>);</span><br><span class="line">        registry.<span class="title function_">addInterceptor</span>(<span class="keyword">new</span> <span class="title class_">RefreshTokenInterceptor</span>(stringRedisTemplate))</span><br><span class="line">                .<span class="title function_">addPathPatterns</span>(<span class="string">&quot;/**&quot;</span>).<span class="title function_">order</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2ã€å•†æˆ·æŸ¥è¯¢ç¼“å­˜">2ã€å•†æˆ·æŸ¥è¯¢ç¼“å­˜</h2><h3 id="2-1ä»€ä¹ˆæ˜¯ç¼“å­˜">2.1ä»€ä¹ˆæ˜¯ç¼“å­˜</h3><p><strong>ç¼“å­˜(<strong>Cache),å°±æ˜¯æ•°æ®äº¤æ¢çš„</strong>ç¼“å†²åŒº</strong>,ä¿—ç§°çš„ç¼“å­˜å°±æ˜¯<strong>ç¼“å†²åŒºå†…çš„æ•°æ®</strong>,ä¸€èˆ¬ä»æ•°æ®åº“ä¸­è·å–,å­˜å‚¨äºæœ¬åœ°ä»£ç ä¸€èˆ¬<strong>è¯»å†™æ€§èƒ½è¾ƒé«˜</strong>ï¼Œ</p><p>ä¾‹å¦‚:</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ä¾‹<span class="number">1</span>:Static <span class="keyword">final</span> ConcurrentHashMap&lt;K,V&gt; map = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;(); æœ¬åœ°ç”¨äºé«˜å¹¶å‘</span><br><span class="line"></span><br><span class="line">ä¾‹<span class="number">2</span>:<span class="type">static</span> <span class="keyword">final</span> Cache&lt;K,V&gt; USER_CACHE = CacheBuilder.<span class="built_in">newBuilder</span>().<span class="built_in">build</span>(); ç”¨äºredisç­‰ç¼“å­˜</span><br><span class="line"></span><br><span class="line">ä¾‹<span class="number">3</span>:Static <span class="keyword">final</span> Map&lt;K,V&gt; map =  <span class="keyword">new</span> <span class="built_in">HashMap</span>(); æœ¬åœ°ç¼“å­˜</span><br></pre></td></tr></table></figure><p>ç”±äºå…¶è¢«<strong>Static</strong>ä¿®é¥°,æ‰€ä»¥éšç€ç±»çš„åŠ è½½è€Œè¢«åŠ è½½åˆ°<strong>å†…å­˜ä¹‹ä¸­</strong>,ä½œä¸ºæœ¬åœ°ç¼“å­˜,ç”±äºå…¶åˆè¢«<strong>final</strong>ä¿®é¥°,æ‰€ä»¥å…¶å¼•ç”¨(ä¾‹3:map)å’Œå¯¹è±¡(ä¾‹3:new HashMap())ä¹‹é—´çš„å…³ç³»æ˜¯å›ºå®šçš„,ä¸èƒ½æ”¹å˜,å› æ­¤ä¸ç”¨æ‹…å¿ƒèµ‹å€¼(=)å¯¼è‡´ç¼“å­˜å¤±æ•ˆ;</p><p><strong>ç¼“å­˜ä½œç”¨</strong>ï¼šé™ä½åç«¯è´Ÿè½½ï¼›æé«˜è¯»å†™çš„æ•ˆç‡ï¼Œé™ä½å“åº”æ—¶é—´ã€‚</p><p><strong>ç¼“å­˜æˆæœ¬</strong>ï¼šæ•°æ®ä¸€è‡´æ€§æˆæœ¬ï¼ˆæ•°æ®åº“é‡Œçš„æ•°æ®å¦‚æœå‘ç”Ÿå˜åŒ–ï¼Œå®¹æ˜“ä¸ç¼“å­˜ä¸­çš„æ•°æ®å½¢æˆä¸ä¸€è‡´ï¼‰ã€‚ä»£ç ç»´æŠ¤æˆæœ¬é«˜ï¼ˆæ­å»ºé›†ç¾¤ï¼‰ã€‚è¿è¥æˆæœ¬é«˜ã€‚</p><p><strong>å¦‚ä½•ä½¿ç”¨ç¼“å­˜</strong></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-68-1024x432.png" alt="img"></p><h3 id="2-2-æ·»åŠ å•†æˆ·ç¼“å­˜">2.2 æ·»åŠ å•†æˆ·ç¼“å­˜</h3><p>æ ‡å‡†çš„æ“ä½œæ–¹å¼å°±æ˜¯æŸ¥è¯¢æ•°æ®åº“ä¹‹å‰å…ˆæŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜æ•°æ®å­˜åœ¨ï¼Œåˆ™ç›´æ¥ä»ç¼“å­˜ä¸­è¿”å›ï¼Œå¦‚æœç¼“å­˜æ•°æ®ä¸å­˜åœ¨ï¼Œå†æŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åå°†æ•°æ®å­˜å…¥redisã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-77.png" alt="img"></p><p>åœ¨ShopControllerç±»çš„queryShopByIdæ–¹æ³•ä¸­ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@GetMapping</span>(<span class="string">&quot;/&#123;id&#125;&quot;</span>)</span><br><span class="line">public Result <span class="built_in">queryShopById</span>(<span class="variable">@PathVariable</span>(<span class="string">&quot;id&quot;</span>) Long id) &#123;</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">Result</span><span class="selector-class">.ok</span>(shopService.<span class="built_in">queryById</span>(id));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨IShopServiceæ¥å£ä¸­ç¼–å†™å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="symbol">IShopService</span> <span class="symbol">extends</span> <span class="symbol">IService</span>&lt;<span class="symbol">Shop</span>&gt; &#123;</span><br><span class="line">    Object queryById(Long id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ShopServiceImplç±»çš„queryByIdæ–¹æ³•ä¸­ç¼–å†™å…·ä½“ä»£ç ï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">ShopServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl&lt;ShopMapper</span>, <span class="title">Shop&gt;</span> <span class="title">implements</span> <span class="title">IShopService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">StringRedisTemplate</span> stringRedisTemplate;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    public <span class="type">Object</span> queryById(<span class="type">Long</span> id) &#123;</span><br><span class="line">        <span class="type">String</span> key = <span class="type">CACHE_SHOP_KEY</span> + id;</span><br><span class="line">        <span class="comment">//1.ä»RedisæŸ¥è¯¢ç¼“å­˜</span></span><br><span class="line">        <span class="type">String</span> shopJson = stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="comment">//2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="type">StrUtil</span>.isNotBlank(shopJson))&#123;</span><br><span class="line">            <span class="comment">//3.å­˜åœ¨ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">            <span class="type">Shop</span> shop = <span class="type">JSONUtil</span>.toBean(shopJson, <span class="type">Shop</span>.<span class="keyword">class</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Result</span>.ok(shop);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//4.ä¸å­˜åœ¨ï¼Œæ ¹æ®idæŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">        <span class="type">Shop</span> shop = getById(id);</span><br><span class="line">        <span class="comment">//5.ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯</span></span><br><span class="line">        <span class="keyword">if</span>(shop==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Result</span>.fail(<span class="string">&quot;åº—é“ºä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//6.å­˜åœ¨ï¼Œå†™å…¥Redis</span></span><br><span class="line">        stringRedisTemplate.opsForValue().set(key, <span class="type">JSONUtil</span>.toJsonStr(shop));</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Result</span>.ok(shop);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¸å¿ƒæ˜¯é€šè¿‡è°ƒç”¨hutoolå·¥å…·åŒ…ä¸­çš„JSONUtilç±»æ¥å®ç°å¯¹è±¡è½¬JSONï¼ˆæ–¹æ³•ï¼štoJsonStr(å¯¹è±¡)ï¼‰å’ŒJSONè½¬å¯¹è±¡ï¼ˆæ–¹æ³•ï¼štoBean(json,Beançš„ç±»å‹)ï¼‰</p><p>TODOï¼šå¯¹åˆ†ç±»è¿›è¡Œç¼“å­˜ã€‚</p><p>åœ¨ShopControllerç±»çš„queryShopByListæ–¹æ³•ä¸­ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">&quot;list&quot;</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="function">Result <span class="title">queryTypeList</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//        List&lt;ShopType&gt; typeList = typeService</span></span><br><span class="line"><span class="comment">//                .query().orderByAsc(&quot;sort&quot;).list();</span></span><br><span class="line">        List&lt;ShopType&gt; typeList = typeService.queryTypeList();</span><br><span class="line">        <span class="function"><span class="keyword">return</span> Result.<span class="title">ok</span><span class="params">(typeList)</span></span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åœ¨IShopServiceæ¥å£ä¸­ç¼–å†™å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="symbol">IShopTypeService</span> <span class="symbol">extends</span> <span class="symbol">IService</span>&lt;<span class="symbol">ShopType</span>&gt; &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;ShopType&gt; queryTypeList();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ShopTypeServiceImplï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">ShopTypeServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl&lt;ShopTypeMapper</span>, <span class="title">ShopType&gt;</span> <span class="title">implements</span> <span class="title">IShopTypeService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">StringRedisTemplate</span> stringRedisTemplate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    public <span class="type">List</span>&lt;<span class="type">ShopType</span>&gt; queryTypeList() &#123;</span><br><span class="line">        <span class="type">String</span> key = <span class="string">&quot;login:type&quot;</span>;</span><br><span class="line"><span class="comment">//        SetOperations&lt;String, String&gt; setOps = redisTemplate.opsForSet();</span></span><br><span class="line">        <span class="comment">// 1. ä»redisæŸ¥è¯¢å•†é“ºç¼“å­˜</span></span><br><span class="line"><span class="comment">//        String shopTypeJson = setOps.members(key).toString();</span></span><br><span class="line">        <span class="type">String</span> shopTypeJson = stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="comment">// 2. åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="type">StrUtil</span>.isNotBlank(shopTypeJson)) &#123;</span><br><span class="line">            <span class="comment">// 3. å­˜åœ¨ï¼Œè½¬åŒ–ä¸ºListè¿”å›</span></span><br><span class="line"><span class="comment">//            return objectMapper.readValue(shopTypeJson, new TypeReference&lt;List&lt;ShopType&gt;&gt;()&#123;&#125;);</span></span><br><span class="line">            <span class="keyword">return</span> <span class="type">JSONUtil</span>.toList(shopTypeJson, <span class="type">ShopType</span>.<span class="keyword">class</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4. ä¸å­˜åœ¨ï¼ŒæŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">        <span class="type">List</span>&lt;<span class="type">ShopType</span>&gt; typeList = <span class="keyword">this</span>.query().orderByAsc(<span class="string">&quot;sort&quot;</span>).list();</span><br><span class="line">        <span class="comment">// 5. ä¸å­˜åœ¨ï¼Œè¿”å›ç©ºåˆ—è¡¨</span></span><br><span class="line">        <span class="keyword">if</span> (typeList.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="type">ArrayList</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 6. å­˜åœ¨ï¼Œå†™å…¥redis</span></span><br><span class="line">        stringRedisTemplate.opsForValue().set(key, <span class="type">JSONUtil</span>.toJsonStr(typeList));</span><br><span class="line">        <span class="comment">// 7. è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> typeList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-ç¼“å­˜æ›´æ–°ç­–ç•¥">2.3 ç¼“å­˜æ›´æ–°ç­–ç•¥</h3><p>ç¼“å­˜æ›´æ–°æ˜¯<strong>redisä¸ºäº†èŠ‚çº¦å†…å­˜è€Œè®¾è®¡å‡ºæ¥çš„ä¸€ä¸ªä¸œè¥¿</strong>ï¼Œä¸»è¦æ˜¯å› ä¸ºå†…å­˜æ•°æ®å®è´µï¼Œå½“æˆ‘ä»¬å‘redisæ’å…¥å¤ªå¤šæ•°æ®ï¼Œæ­¤æ—¶å°±å¯èƒ½ä¼šå¯¼è‡´ç¼“å­˜ä¸­çš„æ•°æ®è¿‡å¤šï¼Œæ‰€ä»¥<strong>redisä¼šå¯¹éƒ¨åˆ†æ•°æ®è¿›è¡Œæ›´æ–°</strong>ï¼Œæˆ–è€…æŠŠä»–å«ä¸ºæ·˜æ±°æ›´åˆé€‚ã€‚</p><ul><li><strong>å†…å­˜æ·˜æ±°ï¼šredisè‡ªåŠ¨è¿›è¡Œ</strong>ï¼Œå½“rediså†…å­˜è¾¾åˆ°å’±ä»¬è®¾å®šçš„max-memeryçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è§¦å‘æ·˜æ±°æœºåˆ¶ï¼Œæ·˜æ±°æ‰ä¸€äº›ä¸é‡è¦çš„æ•°æ®(å¯ä»¥è‡ªå·±è®¾ç½®ç­–ç•¥æ–¹å¼)</li><li>**è¶…æ—¶å‰”é™¤ï¼š**å½“æˆ‘ä»¬ç»™redisè®¾ç½®äº†è¿‡æœŸæ—¶é—´ttlä¹‹åï¼Œ<strong>redisä¼šå°†è¶…æ—¶çš„æ•°æ®è¿›è¡Œåˆ é™¤</strong>ï¼Œæ–¹ä¾¿å’±ä»¬ç»§ç»­ä½¿ç”¨ç¼“å­˜</li><li><strong>ä¸»åŠ¨æ›´æ–°ï¼š<strong>æˆ‘ä»¬å¯ä»¥</strong>æ‰‹åŠ¨è°ƒç”¨æ–¹æ³•</strong>æŠŠç¼“å­˜åˆ æ‰ï¼Œé€šå¸¸ç”¨äºè§£å†³ç¼“å­˜å’Œæ•°æ®åº“ä¸ä¸€è‡´é—®é¢˜</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-88.png" alt="img"></p><h4 id="2-3-1-æ•°æ®åº“ç¼“å­˜ä¸ä¸€è‡´è§£å†³æ–¹æ¡ˆï¼š">2.3.1 æ•°æ®åº“ç¼“å­˜ä¸ä¸€è‡´è§£å†³æ–¹æ¡ˆï¼š</h4><p><strong>ç¼“å­˜çš„æ•°æ®æºæ¥è‡ªäºæ•°æ®åº“</strong>,è€Œæ•°æ®åº“çš„<strong>æ•°æ®æ˜¯ä¼šå‘ç”Ÿå˜åŒ–çš„</strong>,å› æ­¤,å¦‚æœå½“æ•°æ®åº“ä¸­<strong>æ•°æ®å‘ç”Ÿå˜åŒ–,è€Œç¼“å­˜å´æ²¡æœ‰åŒæ­¥</strong>,æ­¤æ—¶å°±ä¼šæœ‰<strong>ä¸€è‡´æ€§é—®é¢˜å­˜åœ¨</strong>ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-89.png" alt="img"></p><h4 id="2-3-2-æ•°æ®åº“å’Œç¼“å­˜ä¸ä¸€è‡´é‡‡ç”¨ä»€ä¹ˆæ–¹æ¡ˆ">2.3.2 æ•°æ®åº“å’Œç¼“å­˜ä¸ä¸€è‡´é‡‡ç”¨ä»€ä¹ˆæ–¹æ¡ˆ</h4><p>é€‰æ‹©æ–¹æ¡ˆä¸€ï¼šä½†æ˜¯æ–¹æ¡ˆä¸€è°ƒç”¨è€…å¦‚ä½•å¤„ç†å‘¢ï¼Ÿè¿™é‡Œæœ‰å‡ ä¸ªé—®é¢˜æ“ä½œç¼“å­˜å’Œæ•°æ®åº“æ—¶æœ‰ä¸‰ä¸ªé—®é¢˜éœ€è¦è€ƒè™‘ï¼š</p><p>1.é€‰æ‹©åˆ é™¤ç¼“å­˜è¿˜æ˜¯æ›´æ–°ç¼“å­˜ï¼Ÿ</p><ul><li>æ›´æ–°ç¼“å­˜ï¼šæ¯æ¬¡æ›´æ–°æ•°æ®åº“éƒ½ä¼šæ›´æ–°ç¼“å­˜ï¼Œæ— æ•ˆçš„å†™æ“ä½œæ¯”è¾ƒå¤šã€‚</li><li>åˆ é™¤ç¼“å­˜ï¼šæ›´æ–°æ•°æ®åº“æ—¶è®©ç¼“å­˜å¤±æ•ˆï¼ŒæŸ¥è¯¢æ—¶å†æ›´æ–°ç¼“å­˜ã€‚</li></ul><p>2.å¦‚ä½•ä¿è¯ç¼“å­˜ä¸æ•°æ®åº“çš„æ“ä½œçš„åŒæ—¶æˆåŠŸæˆ–å¤±è´¥ï¼Ÿ</p><ul><li>å•ä½“ç³»ç»Ÿï¼Œå°†ç¼“å­˜ä¸æ•°æ®åº“æ“ä½œæ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡</li><li>åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œåˆ©ç”¨TCCç­‰åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆ</li></ul><p>3.å…ˆæ“ä½œç¼“å­˜è¿˜æ˜¯å…ˆæ“ä½œæ•°æ®åº“ï¼Ÿ</p><ul><li>å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ“ä½œæ•°æ®åº“</li><li>å…ˆæ“ä½œæ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</li></ul><p>ç­”ï¼šæˆ‘ä»¬åº”å½“æ˜¯<strong>å…ˆæ“ä½œæ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</strong>ï¼ŒåŸå› åœ¨äºï¼Œå¦‚æœä½ é€‰æ‹©ç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œåœ¨ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘æ¥è®¿é—®æ—¶ï¼Œå‡è®¾çº¿ç¨‹1å…ˆæ¥ï¼Œä»–å…ˆæŠŠç¼“å­˜åˆ äº†ï¼Œæ­¤æ—¶çº¿ç¨‹2è¿‡æ¥ï¼Œä»–æŸ¥è¯¢ç¼“å­˜æ•°æ®å¹¶ä¸å­˜åœ¨ï¼Œæ­¤æ—¶ä»–å†™å…¥ç¼“å­˜ï¼Œå½“ä»–å†™å…¥ç¼“å­˜åï¼Œçº¿ç¨‹1å†æ‰§è¡Œæ›´æ–°åŠ¨ä½œæ—¶ï¼Œå®é™…ä¸Šå†™å…¥çš„å°±æ˜¯æ—§çš„æ•°æ®ï¼Œæ–°çš„æ•°æ®è¢«æ—§æ•°æ®è¦†ç›–äº†ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-90.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-91.png" alt="img"></p><h3 id="2-4-å®ç°å•†é“ºå’Œç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´">2.4 å®ç°å•†é“ºå’Œç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´</h3><p>ç»™æŸ¥è¯¢å•†é“ºçš„ç¼“å­˜æ·»åŠ è¶…æ—¶å‰”é™¤å’Œä¸»åŠ¨æ›´æ–°çš„ç­–ç•¥ã€‚</p><p>ä¿®æ”¹ShopControllerä¸­çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ»¡è¶³ä¸‹é¢è¦æ±‚ï¼š</p><p>1.æ ¹æ®idæŸ¥è¯¢å•†é“ºæ—¶ï¼Œå¦‚æœç¼“å­˜æœªå‘½ä¸­ï¼Œåˆ™æŸ¥è¯¢æ•°æ®åº“ï¼Œå°†æ•°æ®åº“ç»“æœå†™å…¥ç¼“å­˜ï¼Œå¹¶è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚</p><p>2.æ ¹æ®idä¿®æ”¹åº—é“ºæ—¶ï¼Œå…ˆä¿®æ”¹æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ã€‚</p><p>é¦–å…ˆä¿®æ”¹ShopServiceImplçš„redisè¿‡æœŸæ—¶é—´ï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stringRedisTemplate.opsForValue()<span class="meta">.set</span>(key, <span class="keyword">JSONUtil.toJsonStr(shop),CACHE_SHOP_TTL, </span>TimeUnit.MINUTES);</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ShopControllerä¸­çš„updateShopæ–¹æ³•ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@PutMapping</span></span><br><span class="line">public Result <span class="built_in">updateShop</span>(<span class="variable">@RequestBody</span> Shop shop) &#123;</span><br><span class="line">    <span class="comment">// å†™å…¥æ•°æ®åº“</span></span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">Result</span><span class="selector-class">.ok</span>(shopService.<span class="built_in">update</span>(shop));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘IShopServiceæ¥å£ä¸­æ·»åŠ updateæ–¹æ³•ï¼š</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable"><span class="class">Object</span></span> <span class="function"><span class="title">update</span>(<span class="variable">Shop</span> <span class="variable">shop</span>);</span></span><br></pre></td></tr></table></figure><p>å‘ShopServiceImplç±»ä¸­æ·»åŠ updateæ–¹æ³•ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="function">Object <span class="title">update</span><span class="params">(Shop shop)</span> </span>&#123;</span><br><span class="line">    Long id = shop.getId();</span><br><span class="line">    <span class="keyword">if</span>(id == <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="function"><span class="keyword">return</span> Result.<span class="title">fail</span><span class="params">(<span class="string">&quot;å•†é“ºidä¸å­˜åœ¨&quot;</span>)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    updateById(shop);</span><br><span class="line">    stringRedisTemplate.delete(CACHE_SHOP_KEY + id);</span><br><span class="line">    <span class="function"><span class="keyword">return</span> Result.<span class="title">ok</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼šé¦–å…ˆåˆ é™¤ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œç„¶åçœ‹SQLè¯­å¥æ˜¯å¦æ‰§è¡Œï¼Œæ˜¯å¦åŠ ä¸Šäº†TTLè¿‡æœŸæ—¶é—´ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-92.png" alt="img"></p><p>è®¿é—®http://localhost:8081/shopï¼Œç„¶åä¿®æ”¹101èŒ¶é¤å…ä¸º102èŒ¶é¤å…ï¼š</p><p>æ³¨æ„è¦å‘é€çš„æ˜¯PUTè¯·æ±‚ï¼Œè¯·æ±‚çš„å†…å®¹å¦‚ä¸‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-93.png" alt="img"></p><p>ç„¶åå»æ•°æ®åº“çœ‹æ˜¯å¦åç§°æ›´æ–°ä¸º102èŒ¶é¤å…ï¼Œç„¶åçœ‹ç¼“å­˜ä¸­çš„æ•°æ®æ˜¯å¦è¢«åˆ é™¤ï¼Œç”¨æˆ·åˆ·æ–°é¡µé¢çœ‹åˆ°102èŒ¶é¤å…ï¼Œç¼“å­˜ä¸­ä¼šæœ‰æœ€æ–°çš„æ•°æ®ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-94.png" alt="img"></p><h3 id="2-5-ç¼“å­˜ç©¿é€é—®é¢˜çš„è§£å†³æ€è·¯">2.5 ç¼“å­˜ç©¿é€é—®é¢˜çš„è§£å†³æ€è·¯</h3><p>ç¼“å­˜ç©¿é€ ï¼š<strong>ç¼“å­˜ç©¿é€æ˜¯æŒ‡å®¢æˆ·ç«¯è¯·æ±‚çš„æ•°æ®åœ¨ç¼“å­˜ä¸­å’Œæ•°æ®åº“ä¸­éƒ½ä¸å­˜åœ¨ï¼Œè¿™æ ·ç¼“å­˜æ°¸è¿œä¸ä¼šç”Ÿæ•ˆï¼Œè¿™äº›è¯·æ±‚éƒ½ä¼šæ‰“åˆ°æ•°æ®åº“ã€‚</strong></p><p>å¸¸è§çš„è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š</p><ul><li>ç¼“å­˜ç©ºå¯¹è±¡</li><li>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œç»´æŠ¤æ–¹ä¾¿</li><li>ç¼ºç‚¹ï¼š<ul><li>é¢å¤–çš„å†…å­˜æ¶ˆè€—</li><li>å¯èƒ½é€ æˆçŸ­æœŸçš„ä¸ä¸€è‡´</li></ul></li><li>å¸ƒéš†è¿‡æ»¤</li><li>ä¼˜ç‚¹ï¼šå†…å­˜å ç”¨è¾ƒå°‘ï¼Œæ²¡æœ‰å¤šä½™key</li><li>ç¼ºç‚¹ï¼š<ul><li>å®ç°å¤æ‚</li><li>å­˜åœ¨è¯¯åˆ¤å¯èƒ½</li></ul></li></ul><p>ç¼“å­˜ç©ºå¯¹è±¡ï¼š</p><p>å½“æˆ‘ä»¬å®¢æˆ·ç«¯è®¿é—®ä¸å­˜åœ¨çš„æ•°æ®æ—¶ï¼Œå…ˆè¯·æ±‚redisï¼Œä½†æ˜¯æ­¤æ—¶redisä¸­æ²¡æœ‰æ•°æ®ï¼Œæ­¤æ—¶ä¼šè®¿é—®åˆ°æ•°æ®åº“ï¼Œä½†æ˜¯æ•°æ®åº“ä¸­ä¹Ÿæ²¡æœ‰æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®ç©¿é€äº†ç¼“å­˜ï¼Œç›´å‡»æ•°æ®åº“ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“æ•°æ®åº“èƒ½å¤Ÿæ‰¿è½½çš„å¹¶å‘ä¸å¦‚redisè¿™ä¹ˆé«˜ï¼Œå¦‚æœå¤§é‡çš„è¯·æ±‚åŒæ—¶è¿‡æ¥è®¿é—®è¿™ç§ä¸å­˜åœ¨çš„æ•°æ®ï¼Œè¿™äº›è¯·æ±‚å°±éƒ½ä¼šè®¿é—®åˆ°æ•°æ®åº“ï¼Œ<strong>ç®€å•çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯å“ªæ€•è¿™ä¸ªæ•°æ®åœ¨æ•°æ®åº“ä¸­ä¹Ÿä¸å­˜åœ¨ï¼Œæˆ‘ä»¬ä¹ŸæŠŠè¿™ä¸ªæ•°æ®å­˜å…¥åˆ°redisä¸­å»ï¼Œè¿™æ ·ï¼Œä¸‹æ¬¡ç”¨æˆ·è¿‡æ¥è®¿é—®è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®ï¼Œé‚£ä¹ˆåœ¨redisä¸­ä¹Ÿèƒ½æ‰¾åˆ°è¿™ä¸ªæ•°æ®å°±ä¸ä¼šè¿›å…¥åˆ°ç¼“å­˜äº†</strong></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-95.png" alt="img"></p><p>å¸ƒéš†è¿‡æ»¤ï¼š</p><p>å¸ƒéš†è¿‡æ»¤å™¨å…¶å®é‡‡ç”¨çš„æ˜¯<strong>å“ˆå¸Œæ€æƒ³</strong>æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé€šè¿‡ä¸€ä¸ªåºå¤§çš„äºŒè¿›åˆ¶æ•°ç»„ï¼Œèµ°å“ˆå¸Œæ€æƒ³å»åˆ¤æ–­å½“å‰è¿™ä¸ªè¦æŸ¥è¯¢çš„è¿™ä¸ªæ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­å­˜åœ¨ï¼Œåˆ™æ”¾è¡Œï¼Œè¿™ä¸ªè¯·æ±‚ä¼šå»è®¿é—®redisï¼Œå“ªæ€•æ­¤æ—¶redisä¸­çš„æ•°æ®è¿‡æœŸäº†ï¼Œä½†æ˜¯æ•°æ®åº“ä¸­ä¸€å®šå­˜åœ¨è¿™ä¸ªæ•°æ®ï¼Œåœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ¥è¿™ä¸ªæ•°æ®åï¼Œå†å°†å…¶æ”¾å…¥åˆ°redisä¸­ï¼Œ</p><p>å‡è®¾å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­è¿™ä¸ªæ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›</p><p>è¿™ç§æ–¹å¼<strong>ä¼˜ç‚¹åœ¨äºèŠ‚çº¦å†…å­˜ç©ºé—´</strong>ï¼Œ<strong>ç¼ºç‚¹æ˜¯å­˜åœ¨è¯¯åˆ¤</strong>ï¼Œè¯¯åˆ¤åŸå› åœ¨äºï¼š<strong>å¸ƒéš†è¿‡æ»¤å™¨èµ°çš„æ˜¯å“ˆå¸Œæ€æƒ³ï¼Œåªè¦å“ˆå¸Œæ€æƒ³ï¼Œå°±å¯èƒ½å­˜åœ¨å“ˆå¸Œå†²çª</strong></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-96.png" alt="img"></p><h3 id="2-6-ç¼–ç è§£å†³å•†å“æŸ¥è¯¢çš„ç¼“å­˜ç©¿é€é—®é¢˜ï¼š">2.6 ç¼–ç è§£å†³å•†å“æŸ¥è¯¢çš„ç¼“å­˜ç©¿é€é—®é¢˜ï¼š</h3><p>ä¸‹å›¾æ˜¯åŸå§‹çš„ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-97.png" alt="img"></p><p>åœ¨åŸæ¥çš„é€»è¾‘ä¸­ï¼Œæˆ‘ä»¬å¦‚æœå‘ç°è¿™ä¸ªæ•°æ®åœ¨mysqlä¸­ä¸å­˜åœ¨ï¼Œç›´æ¥å°±è¿”å›404äº†ï¼Œ<strong>è¿™æ ·æ˜¯ä¼šå­˜åœ¨ç¼“å­˜ç©¿é€é—®é¢˜çš„</strong></p><p>æ›´æ”¹åçš„æ–¹æ¡ˆï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-98.png" alt="img"></p><p>å¦‚æœè¿™ä¸ªæ•°æ®ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬ä¸ä¼šè¿”å›404 ï¼Œè¿˜æ˜¯<strong>ä¼šæŠŠè¿™ä¸ªæ•°æ®å†™å…¥åˆ°Redisä¸­ï¼Œå¹¶ä¸”å°†valueè®¾ç½®ä¸ºç©º</strong>ï¼Œå½“å†æ¬¡å‘èµ·æŸ¥è¯¢æ—¶ï¼Œæˆ‘ä»¬å¦‚æœå‘ç°å‘½ä¸­ä¹‹åï¼Œ<strong>åˆ¤æ–­è¿™ä¸ªvalueæ˜¯å¦æ˜¯nullï¼Œå¦‚æœæ˜¯nullï¼Œåˆ™æ˜¯ä¹‹å‰å†™å…¥çš„æ•°æ®ï¼Œè¯æ˜æ˜¯ç¼“å­˜ç©¿é€æ•°æ®ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ç›´æ¥è¿”å›æ•°æ®ã€‚</strong></p><p>åœ¨ShopServiceImplç±»é‡Œå¯¹queryByIdæ–¹æ³•è¿›è¡Œä¿®æ”¹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Object queryById(<span class="built_in">Long</span> id) &#123;</span><br><span class="line">    String key = CACHE_SHOP_KEY + id;</span><br><span class="line">    <span class="comment">//1.ä»RedisæŸ¥è¯¢ç¼“å­˜</span></span><br><span class="line">    String shopJson = stringRedisTemplate.opsForValue().<span class="keyword">get</span>(key);</span><br><span class="line">    <span class="comment">//2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span>(StrUtil.isNotBlank(shopJson))&#123;</span><br><span class="line">        <span class="comment">//3.å­˜åœ¨ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">        Shop shop = JSONUtil.toBean(shopJson, Shop.<span class="keyword">class</span>);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(shop);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä¸Šé¢æ˜¯æœ‰å€¼çš„æƒ…å†µï¼Œä¸‹é¢æ˜¯æ— å€¼çš„2ç§æƒ…å†µï¼šAï¼šç©ºå­—ç¬¦ä¸²ã€‚Bï¼šnullã€‚</span></span><br><span class="line">    <span class="keyword">if</span>(shopJson != <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº—é“ºä¿¡æ¯ä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//4.ä¸å­˜åœ¨ï¼Œæ ¹æ®idæŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">    Shop shop = getById(id);</span><br><span class="line">    <span class="comment">//5.ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯</span></span><br><span class="line">    <span class="keyword">if</span>(shop==<span class="literal">null</span>)&#123;</span><br><span class="line">        stringRedisTemplate.opsForValue().<span class="keyword">set</span>(key,<span class="string">&quot;&quot;</span>,CACHE_NULL_TTL,TimeUnit.MINUTES);</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº—é“ºä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6.å­˜åœ¨ï¼Œå†™å…¥Redis</span></span><br><span class="line">    stringRedisTemplate.opsForValue().<span class="keyword">set</span>(key, JSONUtil.toJsonStr(shop),CACHE_SHOP_TTL, TimeUnit.MINUTES);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(shop);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><p>localhost:8080/api/shop/1æ­¤æ—¶æ˜¯å‘½ä¸­æ•°æ®ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-99.png" alt="img"></p><p>localhost:8080/api/shop/0æ­¤æ—¶æœªå‘½ä¸­æ•°æ®ã€‚æ‰“å¼€ç¼“å­˜å¯ä»¥çœ‹åˆ°ç¼“å­˜çš„æ˜¯ç©ºï¼Œå¹¶ä¸”TTLæ˜¯200ç§’</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-100.png" alt="img"></p><p><strong>å°æ€»ç»“ï¼š</strong></p><p>1.ç¼“å­˜ç©¿é€äº§ç”Ÿçš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>ç­”ï¼š<strong>ç”¨æˆ·è¯·æ±‚çš„æ•°æ®åœ¨ç¼“å­˜ä¸­å’Œæ•°æ®åº“ä¸­éƒ½ä¸å­˜åœ¨ï¼Œä¸æ–­å‘èµ·è¿™æ ·çš„è¯·æ±‚ï¼Œç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§å‹åŠ›</strong></p><p>2.ç¼“å­˜ç©¿é€çš„è§£å†³æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ</p><p>ç­”ï¼š</p><ul><li>ç¼“å­˜nullå€¼</li><li>å¸ƒéš†è¿‡æ»¤</li><li>å¢å¼ºidçš„å¤æ‚åº¦ï¼Œé¿å…è¢«çŒœæµ‹idè§„å¾‹</li><li>åšå¥½æ•°æ®çš„åŸºç¡€æ ¼å¼æ ¡éªŒ</li><li>åŠ å¼ºç”¨æˆ·æƒé™æ ¡éªŒ</li><li>åšå¥½çƒ­ç‚¹å‚æ•°çš„é™æµ</li></ul><h3 id="2-7-ç¼“å­˜é›ªå´©é—®é¢˜åŠè§£å†³æ€è·¯">2.7 ç¼“å­˜é›ªå´©é—®é¢˜åŠè§£å†³æ€è·¯</h3><p>1.ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Ÿ</p><p>ç­”ï¼š<strong>ç¼“å­˜é›ªå´©æ˜¯æŒ‡åœ¨åŒä¸€æ—¶æ®µå¤§é‡çš„ç¼“å­˜keyåŒæ—¶å¤±æ•ˆæˆ–è€…RedisæœåŠ¡å®•æœºï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚åˆ°è¾¾æ•°æ®åº“ï¼Œå¸¦æ¥å·¨å¤§å‹åŠ›ã€‚</strong></p><p>2.ç¼“å­˜é›ªå´©çš„è§£å†³æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ</p><p>ç­”ï¼š</p><ul><li>ç»™ä¸šåŠ¡æ·»åŠ å¤šçº§ç¼“å­˜</li><li>ç»™ä¸åŒçš„Keyçš„TTLæ·»åŠ éšæœºå€¼ï¼ˆè§£å†³å¤§é‡ç¼“å­˜keyåŒæ—¶å¤±æ•ˆï¼‰</li><li>åˆ©ç”¨Redisé›†ç¾¤æé«˜æœåŠ¡çš„å¯ç”¨æ€§ï¼ˆè§£å†³Rediså®•æœºï¼‰</li><li>ç»™ç¼“å­˜ä¸šåŠ¡æ·»åŠ é™çº§é™æµç­–ç•¥</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-102.png" alt="img"></p><h3 id="2-8-ç¼“å­˜å‡»ç©¿é—®é¢˜åŠè§£å†³æ€è·¯">2.8 ç¼“å­˜å‡»ç©¿é—®é¢˜åŠè§£å†³æ€è·¯</h3><p>1.ä»€ä¹ˆæ˜¯ç¼“å­˜å‡»ç©¿ï¼Ÿ</p><p>ç­”ï¼šç¼“å­˜å‡»ç©¿é—®é¢˜ä¹Ÿå«çƒ­ç‚¹Keyé—®é¢˜ï¼Œ<strong>å°±æ˜¯ä¸€ä¸ªè¢«é«˜å¹¶å‘è®¿é—®å¹¶ä¸”ç¼“å­˜é‡å»ºä¸šåŠ¡è¾ƒå¤æ‚çš„keyçªç„¶å¤±æ•ˆäº†ï¼Œæ— æ•°çš„è¯·æ±‚è®¿é—®ä¼šåœ¨ç¬é—´ç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§çš„å†²å‡»ã€‚</strong></p><p>2.ç¼“å­˜å‡»ç©¿çš„è§£å†³æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ</p><p>ç­”ï¼šå¸¸è§çš„è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§</p><ul><li>äº’æ–¥é”</li><li>é€»è¾‘è¿‡æœŸ</li></ul><p>åˆ†æï¼šå‡è®¾çº¿ç¨‹1åœ¨æŸ¥è¯¢ç¼“å­˜ä¹‹åï¼Œæœ¬æ¥åº”è¯¥å»æŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åæŠŠè¿™ä¸ªæ•°æ®é‡æ–°åŠ è½½åˆ°ç¼“å­˜çš„ï¼Œæ­¤æ—¶åªè¦çº¿ç¨‹1èµ°å®Œè¿™ä¸ªé€»è¾‘ï¼Œå…¶ä»–çº¿ç¨‹å°±éƒ½èƒ½ä»ç¼“å­˜ä¸­åŠ è½½è¿™äº›æ•°æ®äº†ï¼Œä½†æ˜¯å‡è®¾åœ¨çº¿ç¨‹1æ²¡æœ‰èµ°å®Œçš„æ—¶å€™ï¼Œåç»­çš„çº¿ç¨‹2ï¼Œçº¿ç¨‹3ï¼Œçº¿ç¨‹4åŒæ—¶è¿‡æ¥è®¿é—®å½“å‰è¿™ä¸ªæ–¹æ³•ï¼Œ é‚£ä¹ˆè¿™äº›çº¿ç¨‹éƒ½ä¸èƒ½ä»ç¼“å­˜ä¸­æŸ¥è¯¢åˆ°æ•°æ®ï¼Œé‚£ä¹ˆä»–ä»¬å°±ä¼šåŒä¸€æ—¶åˆ»æ¥è®¿é—®æŸ¥è¯¢ç¼“å­˜ï¼Œéƒ½æ²¡æŸ¥åˆ°ï¼Œæ¥ç€åŒä¸€æ—¶é—´å»è®¿é—®æ•°æ®åº“ï¼ŒåŒæ—¶çš„å»æ‰§è¡Œæ•°æ®åº“ä»£ç ï¼Œå¯¹æ•°æ®åº“è®¿é—®å‹åŠ›è¿‡å¤§</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-103.png" alt="img"></p><p><strong>è§£å†³æ–¹æ¡ˆä¸€  ä½¿ç”¨é”äº’æ–¥é”æ¥è§£å†³ï¼š</strong></p><p>æˆ‘ä»¬å¯ä»¥é‡‡ç”¨tryLockæ–¹æ³• + double checkæ¥è§£å†³è¿™æ ·çš„é—®é¢˜ã€‚</p><p>åˆ†æï¼šå‡è®¾ç°åœ¨çº¿ç¨‹1è¿‡æ¥è®¿é—®ï¼Œä»–æŸ¥è¯¢ç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼Œä½†æ˜¯æ­¤æ—¶ä»–è·å¾—åˆ°äº†é”çš„èµ„æºï¼Œé‚£ä¹ˆçº¿ç¨‹1å°±ä¼šä¸€ä¸ªäººå»æ‰§è¡Œé€»è¾‘ï¼Œå‡è®¾ç°åœ¨çº¿ç¨‹2è¿‡æ¥ï¼Œçº¿ç¨‹2åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¹¶æ²¡æœ‰è·å¾—åˆ°é”ï¼Œé‚£ä¹ˆçº¿ç¨‹2å°±å¯ä»¥è¿›è¡Œåˆ°ä¼‘çœ ï¼Œç›´åˆ°çº¿ç¨‹1æŠŠé”é‡Šæ”¾åï¼Œçº¿ç¨‹2è·å¾—åˆ°é”ï¼Œç„¶åå†æ¥æ‰§è¡Œé€»è¾‘ï¼Œæ­¤æ—¶å°±èƒ½å¤Ÿä»ç¼“å­˜ä¸­æ‹¿åˆ°æ•°æ®äº†ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-104.png" alt="img"></p><p><strong>è§£å†³æ–¹æ¡ˆäºŒ é€»è¾‘è¿‡æœŸæ–¹æ¡ˆ</strong></p><p>æ–¹æ¡ˆåˆ†æï¼šæˆ‘ä»¬ä¹‹æ‰€ä»¥ä¼šå‡ºç°è¿™ä¸ªç¼“å­˜å‡»ç©¿é—®é¢˜ï¼Œä¸»è¦åŸå› æ˜¯åœ¨äºæˆ‘ä»¬å¯¹keyè®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œå‡è®¾æˆ‘ä»¬ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå…¶å®å°±ä¸ä¼šæœ‰ç¼“å­˜å‡»ç©¿çš„é—®é¢˜ï¼Œä½†æ˜¯ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·æ•°æ®ä¸å°±ä¸€ç›´å ç”¨æˆ‘ä»¬å†…å­˜äº†å—ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨é€»è¾‘è¿‡æœŸæ–¹æ¡ˆã€‚</p><p>æˆ‘ä»¬æŠŠè¿‡æœŸæ—¶é—´è®¾ç½®åœ¨ redisçš„valueä¸­ï¼Œæ³¨æ„ï¼š<strong>è¿™ä¸ªè¿‡æœŸæ—¶é—´å¹¶ä¸ä¼šç›´æ¥ä½œç”¨äºredisï¼Œè€Œæ˜¯æˆ‘ä»¬åç»­é€šè¿‡é€»è¾‘å»å¤„ç†</strong>ã€‚å‡è®¾çº¿ç¨‹1å»æŸ¥è¯¢ç¼“å­˜ï¼Œç„¶åä»valueä¸­åˆ¤æ–­å‡ºæ¥å½“å‰çš„æ•°æ®å·²ç»è¿‡æœŸäº†ï¼Œæ­¤æ—¶çº¿ç¨‹1å»è·å¾—äº’æ–¥é”ï¼Œé‚£ä¹ˆå…¶ä»–çº¿ç¨‹ä¼šè¿›è¡Œé˜»å¡ï¼Œè·å¾—äº†é”çš„çº¿ç¨‹ä»–ä¼šå¼€å¯ä¸€ä¸ª çº¿ç¨‹å»è¿›è¡Œ ä»¥å‰çš„é‡æ„æ•°æ®çš„é€»è¾‘ï¼Œç›´åˆ°æ–°å¼€çš„çº¿ç¨‹å®Œæˆè¿™ä¸ªé€»è¾‘åï¼Œæ‰é‡Šæ”¾é”ï¼Œ è€Œçº¿ç¨‹1ç›´æ¥è¿›è¡Œè¿”å›ï¼Œå‡è®¾ç°åœ¨çº¿ç¨‹3è¿‡æ¥è®¿é—®ï¼Œç”±äºçº¿ç¨‹çº¿ç¨‹2æŒæœ‰ç€é”ï¼Œæ‰€ä»¥çº¿ç¨‹3æ— æ³•è·å¾—é”ï¼Œçº¿ç¨‹3ä¹Ÿç›´æ¥è¿”å›æ•°æ®ï¼Œåªæœ‰ç­‰åˆ°æ–°å¼€çš„çº¿ç¨‹2æŠŠé‡å»ºæ•°æ®æ„å»ºå®Œåï¼Œå…¶ä»–çº¿ç¨‹æ‰èƒ½èµ°è¿”å›æ­£ç¡®çš„æ•°æ®ã€‚</p><p>è¿™ç§æ–¹æ¡ˆå·§å¦™åœ¨äºï¼Œå¼‚æ­¥çš„æ„å»ºç¼“å­˜ï¼Œç¼ºç‚¹åœ¨äºåœ¨æ„å»ºå®Œç¼“å­˜ä¹‹å‰ï¼Œè¿”å›çš„éƒ½æ˜¯è„æ•°æ®ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-105.png" alt="img"></p><p>è¿›è¡Œå¯¹æ¯”</p><p><strong>äº’æ–¥é”æ–¹æ¡ˆï¼š<strong>ç”±äº</strong>ä¿è¯äº†äº’æ–¥æ€§ï¼Œæ‰€ä»¥æ•°æ®ä¸€è‡´</strong>ï¼Œä¸”å®ç°ç®€å•ï¼Œå› ä¸ºä»…ä»…åªéœ€è¦åŠ ä¸€æŠŠé”è€Œå·²ï¼Œä¹Ÿæ²¡å…¶ä»–çš„äº‹æƒ…éœ€è¦æ“å¿ƒï¼Œæ‰€ä»¥<strong>æ²¡æœ‰é¢å¤–çš„å†…å­˜æ¶ˆè€—</strong>ï¼Œç¼ºç‚¹åœ¨äºæœ‰é”å°±æœ‰<strong>æ­»é”é—®é¢˜çš„å‘ç”Ÿ</strong>ï¼Œä¸”<strong>åªèƒ½ä¸²è¡Œæ‰§è¡Œ</strong>æ€§èƒ½è‚¯å®šå—åˆ°å½±å“</p><p><strong>é€»è¾‘è¿‡æœŸæ–¹æ¡ˆï¼š</strong> çº¿ç¨‹è¯»å–è¿‡ç¨‹ä¸­ä¸éœ€è¦ç­‰å¾…ï¼Œ<strong>æ€§èƒ½å¥½ï¼Œæœ‰ä¸€ä¸ªé¢å¤–çš„çº¿ç¨‹æŒæœ‰é”å»è¿›è¡Œé‡æ„æ•°æ®</strong>ï¼Œ<strong>ä½†æ˜¯åœ¨é‡æ„æ•°æ®å®Œæˆå‰ï¼Œå…¶ä»–çš„çº¿ç¨‹åªèƒ½è¿”å›ä¹‹å‰çš„æ•°æ®</strong>ï¼Œä¸”å®ç°èµ·æ¥éº»çƒ¦</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-106.png" alt="img"></p><h3 id="2-9-åˆ©ç”¨äº’æ–¥é”è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜">2.9 åˆ©ç”¨äº’æ–¥é”è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜</h3><p>æ€è·¯ï¼šç›¸è¾ƒäºåŸæ¥ä»ç¼“å­˜ä¸­æŸ¥è¯¢ä¸åˆ°æ•°æ®åç›´æ¥æŸ¥è¯¢æ•°æ®åº“è€Œè¨€ï¼Œç°åœ¨çš„æ–¹æ¡ˆæ˜¯è¿›è¡ŒæŸ¥è¯¢ä¹‹åï¼Œå¦‚æœä»ç¼“å­˜æ²¡æœ‰æŸ¥è¯¢åˆ°æ•°æ®ï¼Œåˆ™è¿›è¡Œäº’æ–¥é”çš„è·å–ï¼Œè·å–äº’æ–¥é”åï¼Œåˆ¤æ–­æ˜¯å¦è·å¾—åˆ°äº†é”ï¼Œå¦‚æœæ²¡æœ‰è·å¾—åˆ°ï¼Œåˆ™ä¼‘çœ ï¼Œè¿‡ä¸€ä¼šå†è¿›è¡Œå°è¯•ï¼Œç›´åˆ°è·å–åˆ°é”ä¸ºæ­¢ï¼Œæ‰èƒ½è¿›è¡ŒæŸ¥è¯¢</p><p>å¦‚æœè·å–åˆ°äº†é”çš„çº¿ç¨‹ï¼Œå†å»è¿›è¡ŒæŸ¥è¯¢ï¼ŒæŸ¥è¯¢åå°†æ•°æ®å†™å…¥redisï¼Œå†é‡Šæ”¾é”ï¼Œè¿”å›æ•°æ®ï¼Œåˆ©ç”¨äº’æ–¥é”å°±èƒ½ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œæ“ä½œæ•°æ®åº“çš„é€»è¾‘ï¼Œé˜²æ­¢ç¼“å­˜å‡»ç©¿</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-107.png" alt="img"></p><p><strong>æ“ä½œé”çš„ä»£ç ï¼š</strong></p><p>æ ¸å¿ƒæ€è·¯å°±æ˜¯åˆ©ç”¨redisçš„setnxæ–¹æ³•æ¥è¡¨ç¤ºè·å–é”ï¼Œè¯¥æ–¹æ³•å«ä¹‰æ˜¯redisä¸­å¦‚æœæ²¡æœ‰è¿™ä¸ªkeyï¼Œåˆ™æ’å…¥æˆåŠŸï¼Œè¿”å›1ï¼Œåœ¨stringRedisTemplateä¸­è¿”å›trueï¼Œ å¦‚æœæœ‰è¿™ä¸ªkeyåˆ™æ’å…¥å¤±è´¥ï¼Œåˆ™è¿”å›0ï¼Œåœ¨stringRedisTemplateè¿”å›falseï¼Œ<strong>æˆ‘ä»¬å¯ä»¥é€šè¿‡trueï¼Œæˆ–è€…æ˜¯falseï¼Œæ¥è¡¨ç¤ºæ˜¯å¦æœ‰çº¿ç¨‹æˆåŠŸæ’å…¥keyï¼ŒæˆåŠŸæ’å…¥çš„keyçš„çº¿ç¨‹æˆ‘ä»¬è®¤ä¸ºä»–å°±æ˜¯è·å¾—åˆ°é”çš„çº¿ç¨‹</strong>ã€‚</p><p>åœ¨ShopServiceImplç±»ä¸­å®šä¹‰ä¸€ä¸ªtryLockæ–¹æ³•ï¼ˆåœ¨Redisä¸­çš„setnxç›¸å½“äºsetIfAbsentæ–¹æ³•ã€‚ï¼‰</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">boolean</span> <span class="title function_">tryLock</span>(<span class="params"><span class="title class_">String</span> key</span>)&#123;</span><br><span class="line">    <span class="title class_">Boolean</span> flag = stringRedisTemplate.<span class="title function_">opsForValue</span>().<span class="title function_">setIfAbsent</span>(key, <span class="string">&quot;1&quot;</span>, <span class="number">10</span>, <span class="title class_">TimeUnit</span>.<span class="property">SECONDS</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">BooleanUtil</span>.<span class="title function_">isTrue</span>(flag);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ShopServiceImplç±»ä¸­å®šä¹‰ä¸€ä¸ªunLockæ–¹æ³•ç”¨äºè§£é”ã€‚</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unLock</span>(<span class="built_in">String</span> <span class="built_in">key</span>)&#123;</span><br><span class="line">    stringRedisTemplate.<span class="property">delete</span>(<span class="built_in">key</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ShopServiceImplç±»ä¸­å®šä¹‰ä¸€ä¸ªqueryWithPassThroughæ–¹æ³•ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Shop queryWithPassThrough(<span class="built_in">Long</span> id)&#123;</span><br><span class="line">    String key = CACHE_SHOP_KEY + id;</span><br><span class="line">    <span class="comment">//1.ä»RedisæŸ¥è¯¢ç¼“å­˜</span></span><br><span class="line">    String shopJson = stringRedisTemplate.opsForValue().<span class="keyword">get</span>(key);</span><br><span class="line">    <span class="comment">//2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span>(StrUtil.isNotBlank(shopJson))&#123;</span><br><span class="line">        <span class="comment">//3.å­˜åœ¨ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">        Shop shop = JSONUtil.toBean(shopJson, Shop.<span class="keyword">class</span>);</span><br><span class="line">        <span class="keyword">return</span> shop;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä¸Šé¢æ˜¯æœ‰å€¼çš„æƒ…å†µï¼Œä¸‹é¢æ˜¯æ— å€¼çš„2ç§æƒ…å†µï¼šAï¼šç©ºå­—ç¬¦ä¸²ã€‚Bï¼šnullã€‚</span></span><br><span class="line">    <span class="keyword">if</span>(shopJson != <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//4.ä¸å­˜åœ¨ï¼Œæ ¹æ®idæŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">    Shop shop = getById(id);</span><br><span class="line">    <span class="comment">//5.ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯</span></span><br><span class="line">    <span class="keyword">if</span>(shop==<span class="literal">null</span>)&#123;</span><br><span class="line">        stringRedisTemplate.opsForValue().<span class="keyword">set</span>(key,<span class="string">&quot;&quot;</span>,CACHE_NULL_TTL,TimeUnit.MINUTES);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6.å­˜åœ¨ï¼Œå†™å…¥Redis</span></span><br><span class="line">    stringRedisTemplate.opsForValue().<span class="keyword">set</span>(key, JSONUtil.toJsonStr(shop),CACHE_SHOP_TTL, TimeUnit.MINUTES);</span><br><span class="line">    <span class="keyword">return</span> shop;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ShopServiceImplç±»ä¸­å®šä¹‰ä¸€ä¸ªqueryWithMutexæ–¹æ³•ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Shop queryWithMutex(<span class="built_in">Long</span> id)&#123;</span><br><span class="line">    String key = CACHE_SHOP_KEY + id;</span><br><span class="line">    <span class="comment">//1.ä»RedisæŸ¥è¯¢ç¼“å­˜</span></span><br><span class="line">    String shopJson = stringRedisTemplate.opsForValue().<span class="keyword">get</span>(key);</span><br><span class="line">    <span class="comment">//2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span>(StrUtil.isNotBlank(shopJson))&#123;</span><br><span class="line">        <span class="comment">//3.å­˜åœ¨ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">        Shop shop = JSONUtil.toBean(shopJson, Shop.<span class="keyword">class</span>);</span><br><span class="line">        <span class="keyword">return</span> shop;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä¸Šé¢æ˜¯æœ‰å€¼çš„æƒ…å†µï¼Œä¸‹é¢æ˜¯æ— å€¼çš„2ç§æƒ…å†µï¼šAï¼šç©ºå­—ç¬¦ä¸²ã€‚Bï¼šnullã€‚</span></span><br><span class="line">    <span class="keyword">if</span>(shopJson != <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//4.å®ç°ç¼“å­˜é‡å»º</span></span><br><span class="line">    <span class="comment">//4.1 è·å–äº’æ–¥é”</span></span><br><span class="line">    String lockKey = LOCK_SHOP_KEY+id;</span><br><span class="line">    Shop shop = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        boolean isLock = tryLock(lockKey);</span><br><span class="line">        <span class="comment">//4.2 åˆ¤æ–­æ˜¯å¦è·å–æˆåŠŸ</span></span><br><span class="line">        <span class="keyword">if</span>(!isLock)&#123;</span><br><span class="line">            <span class="comment">//4.3 å¤±è´¥ï¼Œåˆ™ä¼‘çœ å¹¶é‡è¯•</span></span><br><span class="line">            Thread.sleep(<span class="number">50</span>);</span><br><span class="line">            <span class="keyword">return</span> queryWithMutex(id);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//4.4 è·å–äº’æ–¥é”æˆåŠŸï¼Œæ ¹æ®idæŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">        shop = getById(id);</span><br><span class="line">        <span class="comment">//æ¨¡æ‹Ÿé‡å»ºçš„å»¶æ—¶</span></span><br><span class="line">        Thread.sleep(<span class="number">200</span>);</span><br><span class="line">        <span class="comment">//5.æ•°æ®åº“æŸ¥è¯¢å¤±è´¥ï¼Œè¿”å›é”™è¯¯</span></span><br><span class="line">        <span class="keyword">if</span>(shop==<span class="literal">null</span>)&#123;</span><br><span class="line">            stringRedisTemplate.opsForValue().<span class="keyword">set</span>(key,<span class="string">&quot;&quot;</span>,CACHE_NULL_TTL,TimeUnit.MINUTES);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//6.å­˜åœ¨ï¼Œå†™å…¥Redis</span></span><br><span class="line">        stringRedisTemplate.opsForValue().<span class="keyword">set</span>(key, JSONUtil.toJsonStr(shop),CACHE_SHOP_TTL, TimeUnit.MINUTES);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> new RuntimeException(e);</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">//7.é‡Šæ”¾äº’æ–¥é”</span></span><br><span class="line">        unLock(lockKey);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//8.è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> shop;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ShopServiceImplç±»ä¸­ä¿®æ”¹queryByIdï¼Œè°ƒç”¨queryWithMutexï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title class_">Object</span> <span class="title function_">queryById</span>(<span class="params"><span class="title class_">Long</span> id</span>) &#123;</span><br><span class="line">    <span class="comment">//ç¼“å­˜ç©¿é€</span></span><br><span class="line">    <span class="comment">//Shop shop = queryWithPassThrough(id);</span></span><br><span class="line">    <span class="comment">//äº’æ–¥é”è§£å†³ç¼“å­˜å‡»ç©¿</span></span><br><span class="line">    <span class="title class_">Shop</span> shop = <span class="title function_">queryWithMutex</span>(id);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Result</span>.<span class="title function_">ok</span>(shop);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-10-åˆ©ç”¨é€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜">2.10  åˆ©ç”¨é€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜</h3><p><strong>éœ€æ±‚ï¼šä¿®æ”¹æ ¹æ®idæŸ¥è¯¢å•†é“ºçš„ä¸šåŠ¡ï¼ŒåŸºäºé€»è¾‘è¿‡æœŸæ–¹å¼æ¥è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜</strong></p><p>æ€è·¯åˆ†æï¼šå½“ç”¨æˆ·å¼€å§‹æŸ¥è¯¢redisæ—¶ï¼Œåˆ¤æ–­æ˜¯å¦å‘½ä¸­ï¼Œå¦‚æœæ²¡æœ‰å‘½ä¸­åˆ™ç›´æ¥è¿”å›ç©ºæ•°æ®ï¼Œä¸æŸ¥è¯¢æ•°æ®åº“ï¼Œè€Œä¸€æ—¦å‘½ä¸­åï¼Œå°†valueå–å‡ºï¼Œåˆ¤æ–­valueä¸­çš„è¿‡æœŸæ—¶é—´æ˜¯å¦æ»¡è¶³ï¼Œå¦‚æœæ²¡æœ‰è¿‡æœŸï¼Œåˆ™ç›´æ¥è¿”å›redisä¸­çš„æ•°æ®ï¼Œå¦‚æœè¿‡æœŸï¼Œåˆ™åœ¨å¼€å¯ç‹¬ç«‹çº¿ç¨‹åç›´æ¥è¿”å›ä¹‹å‰çš„æ•°æ®ï¼Œç‹¬ç«‹çº¿ç¨‹å»é‡æ„æ•°æ®ï¼Œé‡æ„å®Œæˆåé‡Šæ”¾äº’æ–¥é”ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-108.png" alt="img"></p><p>å¦‚æœå°è£…æ•°æ®ï¼Œæ·»åŠ é€»è¾‘è¿‡æœŸå­—æ®µï¼šå› ä¸ºç°åœ¨redisä¸­å­˜å‚¨çš„æ•°æ®çš„valueéœ€è¦å¸¦ä¸Šè¿‡æœŸæ—¶é—´ï¼Œæ­¤æ—¶è¦ä¹ˆä½ å»ä¿®æ”¹åŸæ¥çš„å®ä½“ç±»</p><p>ç­”ï¼šå¯ä»¥åœ¨utilsåŒ…ä¸‹å®šä¹‰RedisDataç±»ï¼ˆå¯ä»¥è®©Shopç»§æ‰¿RedisDataç±»ï¼‰ï¼Œä¹Ÿå¯ä»¥åœ¨RedisDataä¸­è®¾ç½®ä¸€ä¸ªShopç±»çš„dataå±æ€§ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisData</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime expireTime;</span><br><span class="line">    <span class="keyword">private</span> Object <span class="keyword">data</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ShopServiceImplç±»ä¸­å®šä¹‰saveShop2Redisæ–¹æ³•ï¼š</p><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> saveShop2Redis(Long <span class="built_in">id</span>,Long expireSeconds)&#123;</span><br><span class="line">    <span class="comment">//1.æŸ¥è¯¢åº—é“ºæ•°æ®</span></span><br><span class="line">    Shop shop <span class="operator">=</span> getById(<span class="built_in">id</span>);</span><br><span class="line">    <span class="comment">//2.å°è£…é€»è¾‘è¿‡æœŸæ—¶é—´</span></span><br><span class="line">    RedisData redisData <span class="operator">=</span> <span class="keyword">new</span> RedisData();</span><br><span class="line">    redisData.setData(shop);</span><br><span class="line">    redisData.setExpireTime(LocalDateTime.now().plusSeconds(expireSeconds));</span><br><span class="line">    <span class="comment">//3.å†™å…¥Redis</span></span><br><span class="line">    stringRedisTemplate.opsForValue().<span class="built_in">set</span>(CACHE_SHOP_KEY<span class="operator">+</span><span class="built_in">id</span>,JSONUtil.toJsonStr(redisData));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å•å…ƒæµ‹è¯•ï¼Œåœ¨teståŒ…ä¸‹çš„HmDianPingApplicationTestsä¸­åˆ›å»ºtestSaveShopç±»å†™å…¥æµ‹è¯•ä»£ç ï¼ˆè¿™é‡Œè¦æ³¨æ„çš„æ˜¯è¾“å…¥alt+insertä¹‹åé€‰æ‹©Test Methodè¦é€‰æ‹©Junit 5æ¥è¿›è¡Œæµ‹è¯•æ–¹æ³•çš„ç¼–å†™ï¼‰ï¼š</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HmDianPingApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="variable">@Resource</span></span><br><span class="line">    private ShopServiceImpl shopService;</span><br><span class="line"> </span><br><span class="line">    <span class="variable">@Test</span></span><br><span class="line">    void testSaveShop() &#123;</span><br><span class="line">        shopService.saveShop2Redis(1L,10L);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°redisä¸­ç¡®å®å­˜å…¥äº†æ•°æ®ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-109.png" alt="img"></p><p>åœ¨ShopServiceImplä¸­å¤åˆ¶ä¸€ä»½ç¼“å­˜ç©¿é€çš„ä»£ç ï¼Œæ›´æ”¹åç§°ä¸ºqueryWithLogicalExpireï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> final <span class="title class_">ExecutorService</span> <span class="variable constant_">CACHE_REBUILD_EXECUTOR</span> = <span class="title class_">Executors</span>.<span class="title function_">newFixedThreadPool</span>(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">public</span> <span class="title class_">Shop</span> <span class="title function_">queryWithLogicalExpire</span>(<span class="params"><span class="title class_">Long</span> id</span>)&#123;</span><br><span class="line">    <span class="title class_">String</span> key = <span class="variable constant_">CACHE_SHOP_KEY</span> + id;</span><br><span class="line">    <span class="comment">//1.ä»RedisæŸ¥è¯¢ç¼“å­˜</span></span><br><span class="line">    <span class="title class_">String</span> shopJson = stringRedisTemplate.<span class="title function_">opsForValue</span>().<span class="title function_">get</span>(key);</span><br><span class="line">    <span class="comment">//2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="title class_">StrUtil</span>.<span class="title function_">isBlank</span>(shopJson))&#123;</span><br><span class="line">        <span class="comment">//3.ä¸å­˜åœ¨ï¼Œè¿”å›ç©º</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//4.å‘½ä¸­ï¼Œéœ€è¦å…ˆæŠŠjsonååºåˆ—åŒ–ä¸ºå¯¹è±¡</span></span><br><span class="line">    <span class="title class_">RedisData</span> redisData = <span class="title class_">JSON</span>Util.<span class="title function_">toBean</span>(shopJson, <span class="title class_">RedisData</span>.<span class="property">class</span>);</span><br><span class="line">    <span class="title class_">JSON</span><span class="built_in">Object</span> data = (<span class="title class_">JSON</span><span class="built_in">Object</span>) redisData.<span class="title function_">getData</span>();</span><br><span class="line">    <span class="title class_">Shop</span> shop = <span class="title class_">JSON</span>Util.<span class="title function_">toBean</span>(data, <span class="title class_">Shop</span>.<span class="property">class</span>);</span><br><span class="line">    <span class="comment">//5.åˆ¤æ–­æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">    <span class="comment">//5.1 æœªè¿‡æœŸç›´æ¥è¿”å›åº—é“ºä¿¡æ¯</span></span><br><span class="line">    <span class="title class_">LocalDateTime</span> expireTime = redisData.<span class="title function_">getExpireTime</span>();</span><br><span class="line">    <span class="keyword">if</span>(expireTime.<span class="title function_">isAfter</span>(<span class="title class_">LocalDateTime</span>.<span class="title function_">now</span>()))&#123;</span><br><span class="line">        <span class="keyword">return</span> shop;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//5.2 å·²è¿‡æœŸé‡å»ºç¼“å­˜</span></span><br><span class="line">    <span class="comment">//6.ç¼“å­˜é‡å»º</span></span><br><span class="line">    <span class="comment">//6.1.è·å–äº’æ–¥é”</span></span><br><span class="line">    <span class="title class_">String</span> lockKey = <span class="variable constant_">LOCK_SHOP_KEY</span> + id;</span><br><span class="line">    <span class="built_in">boolean</span> isLock = <span class="title function_">tryLock</span>(lockKey);</span><br><span class="line">    <span class="comment">//6.2.åˆ¤æ–­æ˜¯å¦è·å–äº’æ–¥é”æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span>(isLock)&#123;</span><br><span class="line">        <span class="comment">//6.3.æˆåŠŸï¼Œå¼€å¯ç‹¬ç«‹çº¿ç¨‹ï¼Œå®ç°ç¼“å­˜é‡å»º</span></span><br><span class="line">        <span class="variable constant_">CACHE_REBUILD_EXECUTOR</span>.<span class="title function_">submit</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="title function_">saveShop2Redis</span>(id,20L); <span class="comment">//å®é™…ä¸­åº”è¯¥è®¾ç½®ä¸º30åˆ†é’Ÿ</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (<span class="title class_">Exception</span> e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="title function_">unLock</span>(lockKey);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6.4.å¤±è´¥ï¼Œè¿”å›è¿‡æœŸçš„å•†é“ºä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">return</span> shop;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><p>å…ˆåˆ°æ•°æ®åº“æŠŠ102èŒ¶é¤å…æ”¹ä¸º103èŒ¶é¤å…ï¼ˆå› ä¸ºRedisä¹‹å‰æ’å…¥äº†ä¸€æ¡ç¼“å­˜ä¸º102èŒ¶é¤å…ï¼Œå¹¶ä¸”å·²ç»è¿‡æœŸï¼Œæ­¤æ—¶æ•°æ®åº“ä¸ç¼“å­˜ä¸ä¸€è‡´ï¼‰ï¼Œæ–°çš„HTTPè¯·æ±‚ä¼šå°†é€»è¾‘è¿‡æœŸçš„æ•°æ®åˆ é™¤ï¼Œç„¶åæ›´æ–°ç¼“å­˜ã€‚</p><p>çº¿ç¨‹æ•°è®¾ç½®ä¸º100ï¼ŒRamp-upæ—¶é—´è®¾ç½®ä¸º1</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-110.png" alt="img"></p><p>åœ¨æŸ¥çœ‹ç»“æœæ ‘é‡Œé¢åˆ°ä¸­é—´æŸä¸ªHTTPè¯·æ±‚ä¼šå®Œæˆé‡å»ºï¼Œå“åº”æ•°æ®ä¼šæ”¹å˜ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-111.png" alt="img"></p><p>1.å®‰å…¨æ€§é—®é¢˜ï¼šåœ¨é«˜å¹¶å‘æƒ…å†µä¸‹æ˜¯å¦ä¼šæœ‰å¾ˆå¤šçº¿ç¨‹æ¥åšé‡å»ºã€‚</p><p>2.ä¸€è‡´æ€§é—®é¢˜ï¼šåœ¨é‡å»ºå®Œæˆä¹‹å‰å¾—åˆ°çš„æ˜¯å¦æ˜¯æ—§çš„æ•°æ®ã€‚</p><h3 id="2-11-å°è£…Redis-å·¥å…·ç±»">2.11 å°è£…Redis å·¥å…·ç±»</h3><p>èƒŒæ™¯ï¼šåœ¨é«˜å¹¶å‘ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ Redis ç¼“å­˜æ•°æ®åº“æŸ¥è¯¢ç»“æœï¼Œå‡è½»æ•°æ®åº“å‹åŠ›ã€‚ä½†å¦‚æœç›´æ¥ä½¿ç”¨ Redisï¼Œå¯èƒ½ä¼šé‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š</p><ol><li><strong>ç¼“å­˜ç©¿é€</strong>ï¼šè¯·æ±‚çš„æ•°æ®æ—¢ä¸åœ¨ç¼“å­˜é‡Œï¼Œä¹Ÿä¸åœ¨æ•°æ®åº“é‡Œï¼Œä¼šé¢‘ç¹æ‰“æ•°æ®åº“ã€‚</li><li><strong>ç¼“å­˜å‡»ç©¿</strong>ï¼šçƒ­ç‚¹keyçªç„¶å¤±æ•ˆï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚åŒæ—¶æ‰“åˆ°æ•°æ®åº“ã€‚</li><li><strong>ç¼“å­˜é›ªå´©</strong>ï¼šå¤§é‡keyåŒæ—¶è¿‡æœŸï¼Œå¼•èµ·ç¬æ—¶æµé‡æ‰“æ»¡æ•°æ®åº“ã€‚</li></ol><p>å› æ­¤æˆ‘ä»¬åŸºäºStringRedisTemplateå°è£…ä¸€ä¸ªç¼“å­˜å·¥å…·ç±»ï¼Œæ»¡è¶³ä¸‹åˆ—éœ€æ±‚ï¼š</p><ul><li>æ–¹æ³•1ï¼šå°†ä»»æ„Javaå¯¹è±¡åºåˆ—åŒ–ä¸ºjsonå¹¶å­˜å‚¨åœ¨stringç±»å‹çš„keyä¸­ï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®TTLè¿‡æœŸæ—¶é—´</li><li>æ–¹æ³•2ï¼šå°†ä»»æ„Javaå¯¹è±¡åºåˆ—åŒ–ä¸ºjsonå¹¶å­˜å‚¨åœ¨stringç±»å‹çš„keyä¸­ï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®é€»è¾‘è¿‡æœŸæ—¶é—´ï¼Œç”¨äºå¤„ç†ç¼“å­˜å‡»ç©¿é—®é¢˜</li><li>æ–¹æ³•3ï¼šæ ¹æ®æŒ‡å®šçš„keyæŸ¥è¯¢ç¼“å­˜ï¼Œå¹¶ååºåˆ—åŒ–ä¸ºæŒ‡å®šç±»å‹ï¼Œåˆ©ç”¨ç¼“å­˜ç©ºå€¼çš„æ–¹å¼è§£å†³ç¼“å­˜ç©¿é€é—®é¢˜</li><li>æ–¹æ³•4ï¼šæ ¹æ®æŒ‡å®šçš„keyæŸ¥è¯¢ç¼“å­˜ï¼Œå¹¶ååºåˆ—åŒ–ä¸ºæŒ‡å®šç±»å‹ï¼Œéœ€è¦åˆ©ç”¨é€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜</li></ul><p><strong>å…·ä½“å®ç°</strong>ï¼š</p><p>åœ¨utilsåŒ…ä¸‹åˆ›å»ºCacheClientç±»ï¼Œå…ˆå†™å…¥å¦‚ä¸‹åŸºç¡€çš„ä»£ç ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheClient</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> final <span class="title class_">StringRedisTemplate</span> stringRedisTemplate;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">CacheClient</span>(<span class="title class_">StringRedisTemplate</span> stringRedisTemplate) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">stringRedisTemplate</span> = stringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">set</span>(<span class="params"><span class="title class_">String</span> key, <span class="title class_">Object</span> value, <span class="title class_">Long</span> time, <span class="title class_">TimeUnit</span> unit</span>)&#123;</span><br><span class="line">        stringRedisTemplate.<span class="title function_">opsForValue</span>().<span class="title function_">set</span>(key,<span class="title class_">JSON</span>Util.<span class="title function_">toJsonStr</span>(value),time,unit);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setWithLogicalExpire</span>(<span class="params"><span class="title class_">String</span> key, <span class="title class_">Object</span> value,<span class="title class_">Long</span> expire,<span class="title class_">TimeUnit</span> unit</span>)&#123;</span><br><span class="line">        <span class="comment">//è®¾ç½®é€»è¾‘è¿‡æœŸ</span></span><br><span class="line">        <span class="title class_">RedisData</span> redisData = <span class="keyword">new</span> <span class="title class_">RedisData</span>();</span><br><span class="line">        redisData.<span class="title function_">setExpireTime</span>(<span class="title class_">LocalDateTime</span>.<span class="title function_">now</span>().<span class="title function_">plusSeconds</span>(unit.<span class="title function_">toSeconds</span>(expire)));</span><br><span class="line">        redisData.<span class="title function_">setData</span>(value);</span><br><span class="line">        stringRedisTemplate.<span class="title function_">opsForValue</span>().<span class="title function_">set</span>(key,<span class="title class_">JSON</span>Util.<span class="title function_">toJsonStr</span>(redisData));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-119.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-120.png" alt="img"></p><p>åœ¨CacheClientç±»ä¸­ç¼–å†™ç¼“å­˜ç©¿é€çš„å…±æ€§æ–¹æ³•queryWithPassThroughï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;R,ID&gt; R queryWithPassThrough(String keyPrefix, ID id, Class&lt;R&gt; type,</span><br><span class="line">                                     Function&lt;ID,R&gt; dbFallBack,<span class="built_in">Long</span> time,TimeUnit unit)&#123;</span><br><span class="line">    String key = keyPrefix + id;</span><br><span class="line">    <span class="comment">//1.ä»RedisæŸ¥è¯¢ç¼“å­˜</span></span><br><span class="line">    String shopJson = stringRedisTemplate.opsForValue().<span class="keyword">get</span>(key);</span><br><span class="line">    <span class="comment">//2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span>(StrUtil.isNotBlank(shopJson))&#123;</span><br><span class="line">        <span class="comment">//3.å­˜åœ¨ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> JSONUtil.toBean(shopJson, type);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä¸Šé¢æ˜¯æœ‰å€¼çš„æƒ…å†µï¼Œä¸‹é¢æ˜¯æ— å€¼çš„2ç§æƒ…å†µï¼šAï¼šç©ºå­—ç¬¦ä¸²ã€‚Bï¼šnullã€‚</span></span><br><span class="line">    <span class="keyword">if</span>(shopJson != <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//4.ä¸å­˜åœ¨ï¼Œæ ¹æ®idæŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">    R r = dbFallBack.apply(id);</span><br><span class="line">    <span class="comment">//5.ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯</span></span><br><span class="line">    <span class="keyword">if</span>(r==<span class="literal">null</span>)&#123;</span><br><span class="line">        stringRedisTemplate.opsForValue().<span class="keyword">set</span>(key,<span class="string">&quot;&quot;</span>,CACHE_NULL_TTL,TimeUnit.MINUTES);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6.å­˜åœ¨ï¼Œå†™å…¥Redis</span></span><br><span class="line">    <span class="keyword">this</span>.<span class="keyword">set</span>(key,r,time,unit);</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-121.png" alt="img"></p><p>ç¼–å†™å®ŒqueryWithPassThroughä¹‹åå¯ä»¥åˆ°ShopServiceImplä¸­ç›´æ¥è°ƒç”¨æ–°çš„æ–¹æ³•ï¼ˆè®°å¾—å¼•å…¥CacheClientç±»ï¼‰ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> CacheClient cacheClient;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Object queryById(<span class="built_in">Long</span> id) &#123;</span><br><span class="line">    <span class="comment">//è°ƒç”¨å·¥å…·ç±»è§£å†³ç¼“å­˜å‡»ç©¿</span></span><br><span class="line">    Shop shop = cacheClient.queryWithPassThrough(CACHE_SHOP_KEY, id, Shop.<span class="keyword">class</span>, <span class="keyword">this</span>::getById, CACHE_SHOP_TTL, TimeUnit.MINUTES);</span><br><span class="line">    <span class="keyword">if</span>(shop==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº—é“ºä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.ok(shop);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼šæˆåŠŸä¼šå¯¹ä¸å­˜åœ¨çš„åº—é“ºç©ºå€¼è¿›è¡Œç¼“å­˜ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-113.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-115.png" alt="img"></p><p>æ¥ä¸‹æ¥æ‹·è´queryWithLogicalExpireçš„ä»£ç åˆ°CacheClientç±»ä¸­è¿›è¡Œæ”¹å†™ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> final <span class="title class_">ExecutorService</span> <span class="variable constant_">CACHE_REBUILD_EXECUTOR</span> = <span class="title class_">Executors</span>.<span class="title function_">newFixedThreadPool</span>(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">public</span> &lt;R,<span class="variable constant_">ID</span>&gt; R <span class="title function_">queryWithLogicalExpire</span>(<span class="params"><span class="title class_">String</span> keyPrefix,ID id,<span class="title class_">Class</span>&lt;R&gt; <span class="keyword">type</span>,<span class="title class_">Function</span>&lt;ID,R&gt; dbFallBack,<span class="title class_">Long</span> time,<span class="title class_">TimeUnit</span> unit</span>)&#123;</span><br><span class="line">    <span class="title class_">String</span> key = keyPrefix + id;</span><br><span class="line">    <span class="comment">//1.ä»RedisæŸ¥è¯¢ç¼“å­˜</span></span><br><span class="line">    <span class="title class_">String</span> shopJson = stringRedisTemplate.<span class="title function_">opsForValue</span>().<span class="title function_">get</span>(key);</span><br><span class="line">    <span class="comment">//2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="title class_">StrUtil</span>.<span class="title function_">isBlank</span>(shopJson))&#123;</span><br><span class="line">        <span class="comment">//3.ä¸å­˜åœ¨ï¼Œè¿”å›ç©º</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//4.å‘½ä¸­ï¼Œéœ€è¦å…ˆæŠŠjsonååºåˆ—åŒ–ä¸ºå¯¹è±¡</span></span><br><span class="line">    <span class="title class_">RedisData</span> redisData = <span class="title class_">JSON</span>Util.<span class="title function_">toBean</span>(shopJson, <span class="title class_">RedisData</span>.<span class="property">class</span>);</span><br><span class="line">    <span class="title class_">JSON</span><span class="built_in">Object</span> data = (<span class="title class_">JSON</span><span class="built_in">Object</span>) redisData.<span class="title function_">getData</span>();</span><br><span class="line">    R r = <span class="title class_">JSON</span>Util.<span class="title function_">toBean</span>(data, <span class="keyword">type</span>);</span><br><span class="line">    <span class="comment">//5.åˆ¤æ–­æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">    <span class="comment">//5.1 æœªè¿‡æœŸç›´æ¥è¿”å›åº—é“ºä¿¡æ¯</span></span><br><span class="line">    <span class="title class_">LocalDateTime</span> expireTime = redisData.<span class="title function_">getExpireTime</span>();</span><br><span class="line">    <span class="keyword">if</span>(expireTime.<span class="title function_">isAfter</span>(<span class="title class_">LocalDateTime</span>.<span class="title function_">now</span>()))&#123;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//5.2 å·²è¿‡æœŸé‡å»ºç¼“å­˜</span></span><br><span class="line">    <span class="comment">//6.ç¼“å­˜é‡å»º</span></span><br><span class="line">    <span class="comment">//6.1.è·å–äº’æ–¥é”</span></span><br><span class="line">    <span class="title class_">String</span> lockKey = <span class="variable constant_">LOCK_SHOP_KEY</span> + id;</span><br><span class="line">    <span class="built_in">boolean</span> isLock = <span class="title function_">tryLock</span>(lockKey);</span><br><span class="line">    <span class="comment">//6.2.åˆ¤æ–­æ˜¯å¦è·å–äº’æ–¥é”æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span>(isLock)&#123;</span><br><span class="line">        <span class="comment">//6.3.æˆåŠŸï¼Œå¼€å¯ç‹¬ç«‹çº¿ç¨‹ï¼Œå®ç°ç¼“å­˜é‡å»º</span></span><br><span class="line">        <span class="variable constant_">CACHE_REBUILD_EXECUTOR</span>.<span class="title function_">submit</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">                R r1 = dbFallBack.<span class="title function_">apply</span>(id);</span><br><span class="line">                <span class="comment">//å†™å…¥redis</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">setWithLogicalExpire</span>(key,r1,time,unit);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (<span class="title class_">Exception</span> e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="title function_">unLock</span>(lockKey);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6.4.å¤±è´¥ï¼Œè¿”å›è¿‡æœŸçš„å•†é“ºä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">boolean</span> <span class="title function_">tryLock</span>(<span class="params"><span class="title class_">String</span> key</span>)&#123;</span><br><span class="line">    <span class="title class_">Boolean</span> flag = stringRedisTemplate.<span class="title function_">opsForValue</span>().<span class="title function_">setIfAbsent</span>(key, <span class="string">&quot;1&quot;</span>, <span class="number">10</span>, <span class="title class_">TimeUnit</span>.<span class="property">SECONDS</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">BooleanUtil</span>.<span class="title function_">isTrue</span>(flag);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">unLock</span>(<span class="params"><span class="title class_">String</span> key</span>)&#123;</span><br><span class="line">    stringRedisTemplate.<span class="title function_">delete</span>(key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-125.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-126.png" alt="img"></p><p>æ”¹å†™testä¸‹çš„HmDianPingApplicationTestsç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HmDianPingApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CacheClient cacheClient;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ShopServiceImpl shopService;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testSaveShop</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> shopService.getById(<span class="number">1L</span>);</span><br><span class="line">        cacheClient.setWithLogicalExpire(CACHE_SHOP_KEY+<span class="number">1L</span>,shop,<span class="number">10L</span>,TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼šé¦–å…ˆè¿è¡ŒHmDianPingApplicationTestsç±»é‡Œçš„æµ‹è¯•æ–¹æ³•ï¼Œ10ç§’åé€»è¾‘è¿‡æœŸï¼Œæ­¤æ—¶è¿è¡Œåå°ç¨‹åºï¼Œä¿®æ”¹æ•°æ®åº“1å·å•†é“ºçš„nameå­—æ®µï¼Œæ­¤æ—¶è®¿é—®ï¼šlocalhost:8080/api/shop/1 ä¼šå‡ºç°æ•ˆæœç¬¬1æ¬¡è®¿é—®ä¸ºç¼“å­˜æ—§å€¼ï¼Œç„¶åå‘ç°ç¼“å­˜è¿‡æœŸå¼€å§‹é‡å»ºï¼Œç¬¬2æ¬¡è®¿é—®å¼€å§‹å°±æ˜¯æ–°å€¼ã€‚æ•°æ®åº“ä¹Ÿåªæœ‰1æ¬¡é‡å»ºã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-116.png" alt="img"></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-117.png" alt="img"></p><h2 id="3ã€ä¼˜æƒ å·ç§’æ€">3ã€ä¼˜æƒ å·ç§’æ€</h2><h3 id="3-1-å…¨å±€å”¯ä¸€ID">3.1 -å…¨å±€å”¯ä¸€ID</h3><p>æ¯ä¸ªåº—é“ºéƒ½å¯ä»¥å‘å¸ƒä¼˜æƒ åˆ¸ï¼Œå½“ç”¨æˆ·æŠ¢è´­æ—¶ï¼Œå°±ä¼šç”Ÿæˆè®¢å•å¹¶ä¿å­˜åˆ°tb_voucher_orderè¿™å¼ è¡¨ä¸­ï¼Œè€Œè®¢å•è¡¨å¦‚æœä½¿ç”¨æ•°æ®åº“è‡ªå¢IDä¼šå­˜åœ¨ä¸€äº›é—®é¢˜ã€‚</p><p>1.idçš„è§„å¾‹æ€§å¤ªæ˜æ˜¾ã€‚</p><p>2.å—å•è¡¨æ•°æ®é‡çš„é™åˆ¶ï¼ˆåˆ†è¡¨ä¹‹åæ¯å¼ è¡¨éƒ½è‡ªå¢é•¿ï¼Œidä¼šå‡ºç°é‡å¤ï¼‰ã€‚</p><p><strong>å…¨å±€IDç”Ÿæˆå™¨</strong>ï¼šæ˜¯ä¸€ç§åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ç”¨æ¥ç”Ÿæˆå…¨å±€å”¯ä¸€IDçš„å·¥å…·ï¼Œä¸€èˆ¬è¦æ»¡è¶³ä¸‹åˆ—ç‰¹æ€§ï¼š</p><p>1.å”¯ä¸€æ€§ã€‚2.é«˜å¯ç”¨ã€‚3.é«˜æ€§èƒ½ã€‚4.é€’å¢æ€§ã€‚5.å®‰å…¨æ€§ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-127.png" alt="img"></p><p>ä¸ºäº†å¢åŠ IDçš„å®‰å…¨æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç›´æ¥ä½¿ç”¨Redisè‡ªå¢çš„æ•°å€¼ï¼Œè€Œæ˜¯æ‹¼æ¥ä¸€äº›å…¶å®ƒä¿¡æ¯ï¼š</p><p>IDçš„ç»„æˆéƒ¨åˆ†ï¼šç¬¦å·ä½ï¼š1bitï¼Œæ°¸è¿œä¸º0ä»£è¡¨æ•´æ•°</p><p>æ—¶é—´æˆ³ï¼š31bitï¼Œä»¥ç§’ä¸ºå•ä½ï¼Œå®šä¹‰äº†ä¸€ä¸ªèµ·å§‹æ—¶é—´ï¼Œç”¨å½“å‰æ—¶é—´å‡èµ·å§‹æ—¶é—´ï¼Œé¢„ä¼°å¯ä»¥ä½¿ç”¨69å¹´ã€‚</p><p>åºåˆ—å·ï¼š32bitï¼Œç§’å†…çš„è®¡æ•°å™¨ï¼Œæ”¯æŒæ¯ç§’äº§ç”Ÿ2^32ä¸ªä¸åŒID</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-128.png" alt="img"></p><h3 id="3-2-Rediså®ç°å…¨å±€å”¯ä¸€Id">3.2 -Rediså®ç°å…¨å±€å”¯ä¸€Id</h3><p>åœ¨utilsåŒ…ä¸‹å®šä¹‰ä¸€ä¸ªRedisWorkerç±»ï¼Œæ˜¯ä¸€ä¸ªåŸºäºRedisçš„IDç”Ÿæˆå™¨ã€‚</p><p>å¦‚æœåªä½¿ç”¨ä¸€ä¸ªkeyæ¥è‡ªå¢è®°å½•æœ‰ä¸€ä¸ªåå¤„ï¼Œæœ€ç»ˆkeyçš„è‡ªå¢æ•°é‡ä¼šçªç ´å®¹é‡çš„ä¸Šé™ï¼Œå‡å¦‚è‡ªå¢è¶…è¿‡32ä½å½¼æ—¶ä¾¿æ— æ³•å†å­˜å‚¨æ–°çš„æ•°æ®ï¼Œè§£å†³çš„æ–¹æ¡ˆæ˜¯é‡‡ç”¨æ‹¼æ¥æ—¥æœŸã€‚</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisIdWorker</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">long</span> BEGIN_TIMESTAMP = <span class="number">1640995200</span>L;</span><br><span class="line">    <span class="comment">//åºåˆ—å·çš„ä½æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">int</span> COUNT_BITS=<span class="number">32</span>;</span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> RedisIdWorker(StringRedisTemplate stringRedisTemplate) &#123;</span><br><span class="line">        <span class="keyword">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span>  <span class="built_in">long</span> nextId(String keyPrefix)&#123;</span><br><span class="line">        <span class="comment">//1.ç”Ÿæˆæ—¶é—´æˆ³</span></span><br><span class="line">        LocalDateTime now = LocalDateTime.now();</span><br><span class="line">        <span class="built_in">long</span> timeStamp = now.toEpochSecond(ZoneOffset.UTC) - BEGIN_TIMESTAMP;</span><br><span class="line">        <span class="comment">//2.ç”Ÿæˆåºåˆ—å·</span></span><br><span class="line">        <span class="comment">//2.1è·å–å½“å‰æ—¥æœŸï¼Œç²¾ç¡®åˆ°å¤©</span></span><br><span class="line">        String <span class="built_in">date</span> = now.format(DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy:MM:dd&quot;</span>));</span><br><span class="line">        <span class="comment">//2.2è‡ªå¢é•¿</span></span><br><span class="line">        <span class="built_in">long</span> <span class="keyword">count</span> = stringRedisTemplate.opsForValue().increment(<span class="string">&quot;icr:&quot;</span> + keyPrefix + <span class="string">&quot;:&quot;</span> + <span class="built_in">date</span>);</span><br><span class="line">        <span class="comment">//3.æ‹¼æ¥å¹¶è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> timeStamp &lt;&lt; COUNT_BITS | <span class="keyword">count</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨HmDianPingApplicationTestsä¸­å†™å…¥å¦‚ä¸‹çš„æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@Resource</span><br><span class="line"><span class="keyword">private</span> ShopServiceImpl shopService;</span><br><span class="line">@Resource</span><br><span class="line"><span class="keyword">private</span> RedisIdWorker redisIdWorker;</span><br><span class="line"><span class="keyword">private</span> ExecutorService es = Executors.<span class="built_in">newFixedThreadPool</span>(<span class="number">500</span>);</span><br><span class="line">@<span class="function">Test</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">testIdWorker</span><span class="params">()</span> throws InterruptedException </span>&#123;</span><br><span class="line">    CountDownLatch latch = <span class="keyword">new</span> <span class="built_in">CountDownLatch</span>(<span class="number">300</span>);</span><br><span class="line">    Runnable task = ()-&gt;&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++)&#123;</span><br><span class="line">            <span class="type">long</span> id = redisIdWorker.<span class="built_in">nextId</span>(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">&quot;id=&quot;</span>+id);</span><br><span class="line">        &#125;</span><br><span class="line">        latch.<span class="built_in">countDown</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">long</span> begin = System.<span class="built_in">currentTimeMillis</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">300</span>;i++)&#123;</span><br><span class="line">        es.<span class="built_in">submit</span>(task);</span><br><span class="line">    &#125;</span><br><span class="line">    latch.<span class="built_in">await</span>();</span><br><span class="line">    <span class="type">long</span> end = System.<span class="built_in">currentTimeMillis</span>();</span><br><span class="line">    System.out.<span class="built_in">println</span>(<span class="string">&quot;Result Time = &quot;</span> + (end-begin));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¹‹åå¯ä»¥çœ‹åˆ°ä»¥åè¿›åˆ¶è¾“å‡ºçš„æ‰€æœ‰ç¼–å·</p><p>å¯ä»¥åœ¨Redisä¸­çœ‹åˆ°è‡ªå¢é•¿çš„ç»“æœï¼Œ1æ¬¡æ˜¯30000ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-130.png" alt="img"></p><p>å¤§æ¦‚2ç§’å¯ä»¥ç”Ÿæˆ3ä¸‡æ¡ï¼Œé€Ÿåº¦è¿˜æ˜¯å¯ä»¥çš„ã€‚</p><p>å…¨å±€å”¯ä¸€IDç”Ÿæˆç­–ç•¥ï¼š</p><p>1.UUIDåˆ©ç”¨JDKè‡ªå¸¦çš„å·¥å…·ç±»å³å¯ç”Ÿæˆï¼Œç”Ÿæˆçš„æ˜¯16è¿›åˆ¶çš„å­—ç¬¦ä¸²ï¼Œæ— å•è°ƒé€’å¢çš„ç‰¹æ€§ã€‚</p><p>2.Redisè‡ªå¢ï¼ˆæ¯å¤©ä¸€ä¸ªkeyï¼Œæ–¹ä¾¿ç»Ÿè®¡è®¢å•é‡ã€‚æ—¶é—´æˆ³+è®¡æ•°å™¨çš„æ ¼å¼ã€‚ï¼‰</p><p>3.snowflakeé›ªèŠ±ç®—æ³•ï¼ˆä¸ä¾èµ–äºRedisï¼Œæ€§èƒ½æ›´å¥½ï¼Œå¯¹äºæ—¶é’Ÿä¾èµ–ï¼‰</p><p>4.æ•°æ®åº“è‡ªå¢</p><h2 id="ğŸ§©-ä¸å…¶ä»–-ID-ç”Ÿæˆæ–¹æ¡ˆå¯¹æ¯”">ğŸ§© ä¸å…¶ä»– ID ç”Ÿæˆæ–¹æ¡ˆå¯¹æ¯”</h2><table><thead><tr><th>æ–¹æ³•</th><th>ç‰¹ç‚¹</th><th>ä¼˜ç¼ºç‚¹</th></tr></thead><tbody><tr><td><strong>UUID</strong></td><td>é€šè¿‡ JDK æä¾› <code>UUID.randomUUID()</code></td><td>ä¿è¯å”¯ä¸€ï¼Œä½†æ— åºã€é•¿åº¦å¤§ï¼Œä¸é€‚åˆæ’åºå’Œæ•°æ®åº“ä¸»é”®</td></tr><tr><td><strong>Redis è‡ªå¢ï¼ˆæœ¬ä¾‹ï¼‰</strong></td><td>æ—¶é—´æˆ³ + è‡ªå¢</td><td>å¹¶å‘é«˜ï¼Œæ˜“äºæ§åˆ¶å’Œæ‹†åˆ†ï¼Œä½†ä¾èµ– Redis</td></tr><tr><td><strong>é›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰</strong></td><td>Twitter å¼€æºçš„åˆ†å¸ƒå¼ ID æ–¹æ¡ˆ</td><td>æ€§èƒ½é«˜ï¼Œä¸ä¾èµ– Redisï¼Œä½†éœ€è¦ç²¾ç¡®çš„æœºå™¨æ—¶é—´</td></tr><tr><td><strong>æ•°æ®åº“è‡ªå¢ä¸»é”®</strong></td><td>åˆ©ç”¨æ•°æ®åº“ä¸»é”®è‡ªå¢</td><td>ç®€å•ä½†æ€§èƒ½å·®ï¼Œåˆ†å¸ƒå¼ä¸‹æ˜“å†²çªæˆ–å¤±æ•ˆ</td></tr></tbody></table><h3 id="3-3-æ·»åŠ ä¼˜æƒ å·">3.3 æ·»åŠ ä¼˜æƒ å·</h3><p>æ¯ä¸ªåº—é“ºéƒ½å¯ä»¥å‘æ”¾ä¼˜æƒ åˆ¸ï¼Œåˆ†ä¸ºå¹³ä»·åˆ¸å’Œç‰¹ä»·åˆ¸ã€‚å¹³ä»·åˆ¸å¯ä»¥ä»»æ„æŠ¢è´­ï¼Œç‰¹ä»·åˆ¸éœ€è¦ç§’æ€æŠ¢è´­ã€‚</p><p>tb_voucherï¼šä¼˜æƒ åˆ¸åŸºæœ¬ä¿¡æ¯ï¼Œä¼˜æƒ é‡‘é¢ï¼Œä½¿ç”¨è§„åˆ™ç­‰ã€‚</p><p>tb_seckill_voucherï¼šä¼˜æƒ åˆ¸çš„åº“å­˜ï¼Œå¼€å§‹æŠ¢è´­æ—¶é—´ï¼Œç»“æŸæŠ¢è´­æ—¶é—´ï¼Œåªæœ‰ç‰¹ä»·ä¼˜æƒ åˆ¸æ‰éœ€è¦å¡«å†™è¿™äº›ä¿¡æ¯ã€‚</p><p>è€Œä»£é‡‘åˆ¸ç”±äºä¼˜æƒ åŠ›åº¦å¤§ï¼Œæ‰€ä»¥åƒç¬¬äºŒç§å·ï¼Œå°±å¾—é™åˆ¶æ•°é‡ï¼Œä»è¡¨ç»“æ„ä¸Šä¹Ÿèƒ½çœ‹å‡ºï¼Œç‰¹ä»·å·é™¤äº†å…·æœ‰ä¼˜æƒ å·çš„åŸºæœ¬ä¿¡æ¯ä»¥å¤–ï¼Œè¿˜å…·æœ‰åº“å­˜ï¼ŒæŠ¢è´­æ—¶é—´ï¼Œç»“æŸæ—¶é—´ç­‰ç­‰å­—æ®µ</p><p>è¯·æ±‚çš„ä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;shopId&quot;</span>:<span class="number">1</span>,</span><br><span class="line"><span class="string">&quot;title&quot;</span>:<span class="string">&quot;100å…ƒä»£é‡‘åˆ¸&quot;</span>,</span><br><span class="line"><span class="string">&quot;subTitle&quot;</span>:<span class="string">&quot;å‘¨ä¸€è‡³å‘¨äº”å‡å¯ä½¿ç”¨&quot;</span>,</span><br><span class="line"><span class="string">&quot;rules&quot;</span>:<span class="string">&quot;å…¨åœºé€šç”¨<span class="char escape_">\n</span>æ— éœ€é¢„çº¦<span class="char escape_">\n</span>å¯æ— é™å åŠ <span class="char escape_">\ä¸</span>å…‘ç°ã€ä¸æ‰¾é›¶<span class="char escape_">\n</span>ä»…é™å ‚é£Ÿ&quot;</span>,</span><br><span class="line"><span class="string">&quot;payValue&quot;</span>:<span class="number">8000</span>,</span><br><span class="line"><span class="string">&quot;actualValue&quot;</span>:<span class="number">10000</span>,</span><br><span class="line"><span class="string">&quot;type&quot;</span>:<span class="number">1</span>,</span><br><span class="line"><span class="string">&quot;stock&quot;</span>:<span class="number">100</span>,</span><br><span class="line"><span class="string">&quot;beginTime&quot;</span>:<span class="string">&quot;2024-04-10T10:09:17&quot;</span>,</span><br><span class="line"><span class="string">&quot;endTime&quot;</span>:<span class="string">&quot;2024-04-11T12:09:04&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ–°å¢æ™®é€šå·ä»£ç ï¼š</strong></p><p>VoucherController</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@PostMapping</span></span><br><span class="line">public Result <span class="built_in">addVoucher</span>(<span class="variable">@RequestBody</span> Voucher voucher) &#123;</span><br><span class="line">    <span class="selector-tag">voucherService</span><span class="selector-class">.save</span>(voucher);</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">Result</span><span class="selector-class">.ok</span>(voucher.<span class="built_in">getId</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ–°å¢ç§’æ€å·ä»£ç ï¼š</strong></p><p><strong>VoucherController</strong></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@PostMapping</span>(<span class="string">&quot;seckill&quot;</span>)</span><br><span class="line">public Result <span class="built_in">addSeckillVoucher</span>(<span class="variable">@RequestBody</span> Voucher voucher) &#123;</span><br><span class="line">    <span class="selector-tag">voucherService</span><span class="selector-class">.addSeckillVoucher</span>(voucher);</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">Result</span><span class="selector-class">.ok</span>(voucher.<span class="built_in">getId</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>VoucherServiceImpl</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSeckillVoucher</span><span class="params">(Voucher voucher)</span> &#123;</span><br><span class="line">    <span class="comment">// ä¿å­˜ä¼˜æƒ åˆ¸</span></span><br><span class="line">    save(voucher);</span><br><span class="line">    <span class="comment">// ä¿å­˜ç§’æ€ä¿¡æ¯</span></span><br><span class="line">    <span class="type">SeckillVoucher</span> <span class="variable">seckillVoucher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SeckillVoucher</span>();</span><br><span class="line">    seckillVoucher.setVoucherId(voucher.getId());</span><br><span class="line">    seckillVoucher.setStock(voucher.getStock());</span><br><span class="line">    seckillVoucher.setBeginTime(voucher.getBeginTime());</span><br><span class="line">    seckillVoucher.setEndTime(voucher.getEndTime());</span><br><span class="line">    seckillVoucherService.save(seckillVoucher);</span><br><span class="line">    <span class="comment">// ä¿å­˜ç§’æ€åº“å­˜åˆ°Redisä¸­</span></span><br><span class="line">    stringRedisTemplate.opsForValue().set(SECKILL_STOCK_KEY + voucher.getId(), voucher.getStock().toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4-å®ç°ç§’æ€ä¸‹å•">3.4 å®ç°ç§’æ€ä¸‹å•</h3><p>ä¸‹å•æ ¸å¿ƒæ€è·¯ï¼šå½“æˆ‘ä»¬ç‚¹å‡»æŠ¢è´­æ—¶ï¼Œä¼šè§¦å‘å³ä¾§çš„è¯·æ±‚ï¼Œæˆ‘ä»¬åªéœ€è¦ç¼–å†™å¯¹åº”çš„controllerå³å¯</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-132.png" alt="img"></p><p>ç§’æ€ä¸‹å•åº”è¯¥æ€è€ƒçš„å†…å®¹ï¼š</p><p>ä¸‹å•æ—¶éœ€è¦åˆ¤æ–­ä¸¤ç‚¹ï¼š</p><ul><li>ç§’æ€æ˜¯å¦å¼€å§‹æˆ–ç»“æŸï¼Œå¦‚æœå°šæœªå¼€å§‹æˆ–å·²ç»ç»“æŸåˆ™æ— æ³•ä¸‹å•</li><li>åº“å­˜æ˜¯å¦å……è¶³ï¼Œä¸è¶³åˆ™æ— æ³•ä¸‹å•</li></ul><p>ä¸‹å•æ ¸å¿ƒé€»è¾‘åˆ†æï¼š</p><p>å½“ç”¨æˆ·å¼€å§‹è¿›è¡Œä¸‹å•ï¼Œæˆ‘ä»¬åº”å½“å»æŸ¥è¯¢ä¼˜æƒ å·ä¿¡æ¯ï¼ŒæŸ¥è¯¢åˆ°ä¼˜æƒ å·ä¿¡æ¯ï¼Œåˆ¤æ–­æ˜¯å¦æ»¡è¶³ç§’æ€æ¡ä»¶</p><p>æ¯”å¦‚æ—¶é—´æ˜¯å¦å……è¶³ï¼Œå¦‚æœæ—¶é—´å……è¶³ï¼Œåˆ™è¿›ä¸€æ­¥åˆ¤æ–­åº“å­˜æ˜¯å¦è¶³å¤Ÿï¼Œå¦‚æœä¸¤è€…éƒ½æ»¡è¶³ï¼Œåˆ™æ‰£å‡åº“å­˜ï¼Œåˆ›å»ºè®¢å•ï¼Œç„¶åè¿”å›è®¢å•idï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ¡ä»¶ä¸æ»¡è¶³åˆ™ç›´æ¥ç»“æŸã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-134.png" alt="img"></p><p>åœ¨VouchrOrderControllerç±»ä¸­ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@RestController</span></span><br><span class="line"><span class="variable">@RequestMapping</span>(<span class="string">&quot;/voucher-order&quot;</span>)</span><br><span class="line">public class VoucherOrderController &#123;</span><br><span class="line">  <span class="variable">@Resource</span></span><br><span class="line">   private IVoucherService voucherService;</span><br><span class="line">   <span class="variable">@PostMapping</span>(<span class="string">&quot;seckill/&#123;id&#125;&quot;</span>)</span><br><span class="line">    public Result <span class="built_in">seckillVoucher</span>(<span class="variable">@PathVariable</span>(<span class="string">&quot;id&quot;</span>) Long voucherId) &#123;</span><br><span class="line">           <span class="selector-tag">return</span> <span class="selector-tag">voucherService</span><span class="selector-class">.seckillVoucher</span>(voucherId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨IVoucherOrderServiceä¸­å†™å…¥å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="keyword">interface</span> <span class="symbol">IVoucherOrderService</span> <span class="symbol">extends</span> <span class="symbol">IService</span> &#123;</span><br><span class="line">        Result seckillVoucher(Long voucherId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨VoucherOrderServiceImplä¸­å†™å…¥å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VoucherOrderServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">VoucherOrderMapper</span>, <span class="title">VoucherOrder</span>&gt; <span class="keyword">implements</span> <span class="title">IVoucherOrderService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ISeckillVoucherService seckillVoucherService;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisIdWorker redisIdWorker;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function">Result <span class="title">seckillVoucher</span><span class="params">(Long voucherId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1.æŸ¥è¯¢ä¼˜æƒ åˆ¸ä¿¡æ¯</span></span><br><span class="line">        SeckillVoucher voucher = seckillVoucherService.getById(voucherId);</span><br><span class="line">        <span class="comment">//2.åˆ¤æ–­ç§’æ€æ˜¯å¦å¼€å§‹</span></span><br><span class="line">        <span class="comment">//2.1ç§’æ€å°šæœªå¼€å§‹è¿”å›å¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">if</span>(voucher.getBeginTime().isAfter(LocalDateTime.now()))&#123;</span><br><span class="line">            <span class="function"><span class="keyword">return</span> Result.<span class="title">fail</span><span class="params">(<span class="string">&quot;ç§’æ€å°šæœªå¼€å§‹&quot;</span>)</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//2.2ç§’æ€å·²ç»“æŸè¿”å›å¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">if</span>(voucher.getEndTime().isBefore(LocalDateTime.now()))&#123;</span><br><span class="line">            <span class="function"><span class="keyword">return</span> Result.<span class="title">fail</span><span class="params">(<span class="string">&quot;ç§’æ€å·²ç»ç»“æŸ&quot;</span>)</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//3.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class="line">        <span class="keyword">if</span>(voucher.getStock()&lt;<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="comment">//3.1åº“å­˜ä¸è¶³è¿”å›å¼‚å¸¸</span></span><br><span class="line">            <span class="function"><span class="keyword">return</span> Result.<span class="title">fail</span><span class="params">(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>)</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//3.2åº“å­˜å……è¶³æ‰£å‡åº“å­˜</span></span><br><span class="line">        <span class="keyword">boolean</span> success = seckillVoucherService.update()</span><br><span class="line">                .setSql(<span class="string">&quot;stock = stock - 1&quot;</span>)</span><br><span class="line">                .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).update();</span><br><span class="line">        <span class="keyword">if</span>(!success)&#123;</span><br><span class="line">            <span class="function"><span class="keyword">return</span> Result.<span class="title">fail</span><span class="params">(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>)</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//4.åˆ›å»ºè®¢å•ï¼Œè¿”å›è®¢å•id</span></span><br><span class="line">        VoucherOrder voucherOrder = <span class="keyword">new</span> VoucherOrder();</span><br><span class="line">        <span class="keyword">long</span> orderId = redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);<span class="comment">//è®¢å•id</span></span><br><span class="line">        voucherOrder.setId(orderId);</span><br><span class="line">        Long userId = UserHolder.getUser().getId();<span class="comment">//ç”¨æˆ·id</span></span><br><span class="line">        voucherOrder.setUserId(userId);</span><br><span class="line">        voucherOrder.setVoucherId(voucherId);<span class="comment">//ä»£é‡‘åˆ¸id</span></span><br><span class="line">        save(voucherOrder);</span><br><span class="line">        <span class="function"><span class="keyword">return</span> Result.<span class="title">ok</span><span class="params">(orderId)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-5-åº“å­˜è¶…å–é—®é¢˜åˆ†æ">3.5 åº“å­˜è¶…å–é—®é¢˜åˆ†æ</h3><p>å‡è®¾çº¿ç¨‹1è¿‡æ¥æŸ¥è¯¢åº“å­˜ï¼Œåˆ¤æ–­å‡ºæ¥åº“å­˜å¤§äº1ï¼Œæ­£å‡†å¤‡å»æ‰£å‡åº“å­˜ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰æ¥å¾—åŠå»æ‰£å‡ï¼Œæ­¤æ—¶çº¿ç¨‹2è¿‡æ¥ï¼Œçº¿ç¨‹2ä¹Ÿå»æŸ¥è¯¢åº“å­˜ï¼Œå‘ç°è¿™ä¸ªæ•°é‡ä¸€å®šä¹Ÿå¤§äº1ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªçº¿ç¨‹éƒ½ä¼šå»æ‰£å‡åº“å­˜ï¼Œæœ€ç»ˆå¤šä¸ªçº¿ç¨‹ç›¸å½“äºä¸€èµ·å»æ‰£å‡åº“å­˜ï¼Œæ­¤æ—¶å°±ä¼šå‡ºç°åº“å­˜çš„è¶…å–é—®é¢˜ã€‚</p><p>æ­£å¸¸é€»è¾‘ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-137.png" alt="img"></p><p>éæ­£å¸¸é€»è¾‘ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-135.png" alt="img"></p><p>è¶…å–é—®é¢˜æ˜¯å…¸å‹çš„å¤šçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œé’ˆå¯¹è¿™ä¸€é—®é¢˜çš„å¸¸è§è§£å†³æ–¹æ¡ˆå°±æ˜¯åŠ é”ï¼šè€Œå¯¹äºåŠ é”ï¼Œæˆ‘ä»¬é€šå¸¸æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼šè§ä¸‹å›¾ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-138.png" alt="img"></p><p><strong>æ‚²è§‚é”ï¼š</strong></p><p>æ‚²è§‚é”å¯ä»¥å®ç°å¯¹äºæ•°æ®çš„ä¸²è¡ŒåŒ–æ‰§è¡Œï¼Œæ¯”å¦‚synï¼Œå’Œlockéƒ½æ˜¯æ‚²è§‚é”çš„ä»£è¡¨ï¼ŒåŒæ—¶ï¼Œæ‚²è§‚é”ä¸­åˆå¯ä»¥å†ç»†åˆ†ä¸ºå…¬å¹³é”ï¼Œéå…¬å¹³é”ï¼Œå¯é‡å…¥é”ï¼Œç­‰ç­‰</p><p><strong>ä¹è§‚é”ï¼š</strong></p><p>ä¹è§‚é”ï¼šä¼šæœ‰ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ¯æ¬¡æ“ä½œæ•°æ®ä¼šå¯¹ç‰ˆæœ¬å·+1ï¼Œå†æäº¤å›æ•°æ®æ—¶ï¼Œä¼šå»æ ¡éªŒæ˜¯å¦æ¯”ä¹‹å‰çš„ç‰ˆæœ¬å¤§1 ï¼Œå¦‚æœå¤§1 ï¼Œåˆ™è¿›è¡Œæ“ä½œæˆåŠŸï¼Œè¿™å¥—æœºåˆ¶çš„æ ¸å¿ƒé€»è¾‘åœ¨äºï¼Œå¦‚æœåœ¨æ“ä½œè¿‡ç¨‹ä¸­ï¼Œç‰ˆæœ¬å·åªæ¯”åŸæ¥å¤§1 ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€æ“ä½œè¿‡ç¨‹ä¸­æ²¡æœ‰äººå¯¹ä»–è¿›è¡Œè¿‡ä¿®æ”¹ï¼Œä»–çš„æ“ä½œå°±æ˜¯å®‰å…¨çš„ï¼Œå¦‚æœä¸å¤§1ï¼Œåˆ™æ•°æ®è¢«ä¿®æ”¹è¿‡ï¼Œå½“ç„¶ä¹è§‚é”è¿˜æœ‰ä¸€äº›å˜ç§çš„å¤„ç†æ–¹å¼æ¯”å¦‚cas</p><p>ä¹è§‚é”çš„å…¸å‹ä»£è¡¨ï¼šå°±æ˜¯casï¼Œåˆ©ç”¨casè¿›è¡Œæ— é”åŒ–æœºåˆ¶åŠ é”ï¼Œvar5 æ˜¯æ“ä½œå‰è¯»å–çš„å†…å­˜å€¼ï¼Œwhileä¸­çš„var1+var2 æ˜¯é¢„ä¼°å€¼ï¼Œå¦‚æœé¢„ä¼°å€¼ == å†…å­˜å€¼ï¼Œåˆ™ä»£è¡¨ä¸­é—´æ²¡æœ‰è¢«äººä¿®æ”¹è¿‡ï¼Œæ­¤æ—¶å°±å°†æ–°å€¼å»æ›¿æ¢ å†…å­˜å€¼</p><p>å…¶ä¸­do while æ˜¯ä¸ºäº†åœ¨æ“ä½œå¤±è´¥æ—¶ï¼Œå†æ¬¡è¿›è¡Œè‡ªæ—‹æ“ä½œï¼Œå³æŠŠä¹‹å‰çš„é€»è¾‘å†æ“ä½œä¸€æ¬¡ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">int var5;</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    var5 = <span class="keyword">this</span>.getIntVolatile(var1, var2);</span><br><span class="line">&#125; <span class="keyword">while</span>(!<span class="keyword">this</span>.compareAndSwapInt(var1, var2, var5, var5 + var4));</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> var5;</span><br></pre></td></tr></table></figure><p><strong>è¯¾ç¨‹ä¸­çš„ä½¿ç”¨æ–¹å¼ï¼š</strong></p><p>è¯¾ç¨‹ä¸­çš„ä½¿ç”¨æ–¹å¼æ˜¯æ²¡æœ‰åƒcasä¸€æ ·å¸¦è‡ªæ—‹çš„æ“ä½œï¼Œä¹Ÿæ²¡æœ‰å¯¹versionçš„ç‰ˆæœ¬å·+1 ï¼Œä»–çš„æ“ä½œé€»è¾‘æ˜¯åœ¨æ“ä½œæ—¶ï¼Œå¯¹ç‰ˆæœ¬å·è¿›è¡Œ+1 æ“ä½œï¼Œç„¶åè¦æ±‚version å¦‚æœæ˜¯1 çš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½æ“ä½œï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªçº¿ç¨‹åœ¨æ“ä½œåï¼Œæ•°æ®åº“ä¸­çš„versionå˜æˆäº†2ï¼Œä½†æ˜¯ä»–è‡ªå·±æ»¡è¶³version=1 ï¼Œæ‰€ä»¥æ²¡æœ‰é—®é¢˜ï¼Œæ­¤æ—¶çº¿ç¨‹2æ‰§è¡Œï¼Œçº¿ç¨‹2 æœ€åä¹Ÿéœ€è¦åŠ ä¸Šæ¡ä»¶version =1 ï¼Œä½†æ˜¯ç°åœ¨ç”±äºçº¿ç¨‹1å·²ç»æ“ä½œè¿‡äº†ï¼Œæ‰€ä»¥çº¿ç¨‹2ï¼Œæ“ä½œæ—¶å°±ä¸æ»¡è¶³version=1 çš„æ¡ä»¶äº†ï¼Œæ‰€ä»¥çº¿ç¨‹2æ— æ³•æ‰§è¡ŒæˆåŠŸ</p><p><strong>ç‰ˆæœ¬å·æ³•ï¼š</strong></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-139.png" alt="img"></p><p><strong>CASæ³•</strong>ï¼ˆç‰ˆæœ¬å·æ³•çš„ç®€åŒ–ç‰ˆï¼‰ï¼šæŸ¥è¯¢çš„æ—¶å€™æŠŠåº“å­˜æŸ¥å‡ºæ¥ï¼Œæ›´æ–°çš„æ—¶å€™åˆ¤æ–­åº“å­˜å’Œä¹‹å‰æŸ¥åˆ°çš„åº“å­˜æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´åˆ™æ›´æ–°æ•°æ®ã€‚</p><h3 id="3-6-ä¹è§‚é”è§£å†³è¶…å–é—®é¢˜">3.6 ä¹è§‚é”è§£å†³è¶…å–é—®é¢˜</h3><p>åªéœ€åŠ ä¸Šä¸‹é¢è¿™æ®µä»£ç å³å¯ï¼š.eq(â€œstockâ€,voucher.getStock()) ã€‚ç”¨äºæ¯”è¾ƒå½“å‰æ•°æ®åº“çš„åº“å­˜å€¼å’Œä¹‹å‰æŸ¥è¯¢åˆ°çš„åº“å­˜å€¼æ˜¯å¦ç›¸åŒï¼Œåªæœ‰ç›¸åŒæ—¶æ‰å¯ä»¥æ‰§è¡Œsetè¯­å¥ã€‚</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//<span class="number">3.2</span>åº“å­˜å……è¶³æ‰£å‡åº“å­˜</span><br><span class="line">boolean success = seckillVoucherService.update()</span><br><span class="line">        .setSql(<span class="string">&quot;stock = stock - 1&quot;</span>) //ç›¸å½“äºsetæ¡ä»¶ set stock = stock - <span class="number">1</span></span><br><span class="line">        .e<span class="string">q(&quot;voucher_id&quot;, voucherId)</span> //ç›¸å½“äºwhereæ¡ä»¶ where id = ? <span class="keyword">and</span> stock = ?</span><br><span class="line">        .e<span class="string">q(&quot;stock&quot;,voucher.getStock()</span>).update();</span><br></pre></td></tr></table></figure><p>ä½†ç»è¿‡æµ‹è¯•ç°åœ¨å‡ºç°äº†å¼‚å¸¸å€¼åé«˜çš„é—®é¢˜ï¼Œæ­£å¸¸çš„è¯·æ±‚å¤§çº¦åªå 10%ã€‚</p><p>åŸç†æ˜¯å› ä¸ºï¼šå‡å¦‚ä¸€æ¬¡æœ‰30ä¸ªçº¿ç¨‹æ¶Œå…¥ï¼ŒæŸ¥è¯¢åˆ°åº“å­˜å€¼ä¸º100ï¼Œåªæœ‰1ä¸ªçº¿ç¨‹èƒ½æŠŠå€¼æ”¹ä¸º99ï¼Œå…¶å®ƒ29ä¸ªçº¿ç¨‹æ¯”å¯¹åº“å­˜å€¼99å‘ç°å’Œè‡ªå·±æŸ¥è¯¢åˆ°çš„åº“å­˜å€¼100ä¸åŒï¼Œæ‰€ä»¥éƒ½è®¤ä¸ºæ•°æ®å·²ç»è¢«ä¿®æ”¹è¿‡ï¼Œæ‰€ä»¥éƒ½å¤±è´¥äº†ã€‚</p><p>ç°åœ¨åªéœ€è¦ä¿è¯stock&gt;0å³å¯ï¼Œåªè¦å­˜é‡å¤§äº0å°±å¯ä»¥ä»»æ„æ‰£å‡ã€‚</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> success = seckillVoucherService.<span class="keyword">update</span>()</span><br><span class="line">        .setSql(&quot;stock = stock - 1&quot;) //ç›¸å½“äº<span class="keyword">set</span>æ¡ä»¶ <span class="keyword">set</span> stock = stock - <span class="number">1</span></span><br><span class="line">        .eq(&quot;voucher_id&quot;, voucherId) //ç›¸å½“äº<span class="keyword">where</span>æ¡ä»¶ <span class="keyword">where</span> id = ? <span class="keyword">and</span> stock = ?</span><br><span class="line">        .gt(&quot;stock&quot;,<span class="number">0</span>).<span class="keyword">update</span>();</span><br></pre></td></tr></table></figure><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-141.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-143.png" alt="img"></p><p>ä¹è§‚é”ç¼ºé™·ï¼š</p><p>éœ€è¦å¤§é‡å¯¹æ•°æ®åº“è¿›è¡Œè®¿é—®ï¼Œå®¹æ˜“å¯¼è‡´æ•°æ®åº“çš„å´©æºƒã€‚</p><p>æ€»ç»“ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-144.png" alt="img"></p><h3 id="3-7ä¼˜æƒ åˆ¸ç§’æ€-ä¸€äººä¸€å•">3.7ä¼˜æƒ åˆ¸ç§’æ€-ä¸€äººä¸€å•</h3><p>éœ€æ±‚ï¼šä¿®æ”¹ç§’æ€ä¸šåŠ¡ï¼Œè¦æ±‚åŒä¸€ä¸ªä¼˜æƒ åˆ¸ï¼Œä¸€ä¸ªç”¨æˆ·åªèƒ½ä¸‹ä¸€å•</p><p>é—®é¢˜åˆ†æï¼šä¼˜æƒ å·æ˜¯ä¸ºäº†å¼•æµï¼Œä½†æ˜¯ç›®å‰çš„æƒ…å†µæ˜¯ï¼Œä¸€ä¸ªäººå¯ä»¥æ— é™åˆ¶çš„æŠ¢è¿™ä¸ªä¼˜æƒ å·ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”å½“å¢åŠ ä¸€å±‚é€»è¾‘ï¼Œè®©ä¸€ä¸ªç”¨æˆ·åªèƒ½ä¸‹ä¸€ä¸ªå•ï¼Œè€Œä¸æ˜¯è®©ä¸€ä¸ªç”¨æˆ·ä¸‹å¤šä¸ªå•</p><p>å…·ä½“æ“ä½œé€»è¾‘å¦‚ä¸‹ï¼šæ¯”å¦‚æ—¶é—´æ˜¯å¦å……è¶³ï¼Œå¦‚æœæ—¶é—´å……è¶³ï¼Œåˆ™è¿›ä¸€æ­¥åˆ¤æ–­åº“å­˜æ˜¯å¦è¶³å¤Ÿï¼Œç„¶åå†æ ¹æ®ä¼˜æƒ å·idå’Œç”¨æˆ·idæŸ¥è¯¢æ˜¯å¦å·²ç»ä¸‹è¿‡è¿™ä¸ªè®¢å•ï¼Œå¦‚æœä¸‹è¿‡è¿™ä¸ªè®¢å•ï¼Œåˆ™ä¸å†ä¸‹å•ï¼Œå¦åˆ™è¿›è¡Œä¸‹å•</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-156.png" alt="img"></p><p>âŒ é”™è¯¯æ–¹å¼ï¼šé”æ•´ä¸ªæ–¹æ³•ï¼ˆæ¯”å¦‚ <code>synchronized public void createVoucherOrder()</code>ï¼‰</p><p><strong>é—®é¢˜</strong>ï¼šæ‰€æœ‰ç”¨æˆ·éƒ½ä¼šç«äº‰åŒä¸€ä¸ªé”ï¼Œç³»ç»Ÿæ€§èƒ½ä¼šå¾ˆå·®ï¼ˆä¸²è¡Œæ‰§è¡Œï¼Œæ•ˆç‡æä½ï¼‰</p><p>âœ… æ­£ç¡®æ–¹å¼ï¼šåªå¯¹åŒä¸€ä¸ªç”¨æˆ·åŠ é”</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">synchronized</span>(<span class="params">userId.toString().intern()</span>) &#123; ... &#125;</span><br></pre></td></tr></table></figure><p><code>.intern()</code> ä¼šè®©å­—ç¬¦ä¸²å¼•ç”¨å˜æˆå¸¸é‡æ± ä¸­çš„å…±äº«å¯¹è±¡ï¼Œç›¸åŒå†…å®¹å°±æ˜¯åŒä¸€ä¸ªé”ã€‚</p><p><strong>ä¸ºä»€ä¹ˆç”¨ <code>.intern()</code>ï¼Ÿ</strong></p><p>å› ä¸º <code>toString()</code> æ¯æ¬¡æ˜¯æ–°å¯¹è±¡ï¼Œé”ä¸ç”Ÿæ•ˆã€‚</p><p>ä½†æ˜¯å› ä¸ºäº‹åŠ¡æ˜¯åœ¨å‡½æ•°æ‰§è¡Œç»“æŸä¹‹åç”±Springè¿›è¡Œæäº¤ï¼Œå¦‚æœæŠŠé”åŠ åœ¨createVoucherOrderå†…éƒ¨å…¶å®æœ‰ç‚¹å°â€”â€”å› ä¸ºå¦‚æœè§£é”ä¹‹åï¼Œå…¶å®ƒçº¿ç¨‹å¯ä»¥è¿›å…¥ï¼Œè€Œæ­¤æ—¶äº‹åŠ¡å°šæœªæäº¤ï¼Œä»ç„¶ä¼šå¯¼è‡´å®‰å…¨æ€§é—®é¢˜ã€‚</p><h3 id="ğŸ”-äº‹åŠ¡æ§åˆ¶æ³¨æ„äº‹é¡¹">ğŸ” <strong>äº‹åŠ¡æ§åˆ¶æ³¨æ„äº‹é¡¹</strong></h3><p><strong>é—®é¢˜ç‚¹</strong>ï¼šSpring çš„ <code>@Transactional</code> åªå¯¹ä»£ç†å¯¹è±¡ç”Ÿæ•ˆã€‚</p><p><strong>é”™è¯¯æ–¹å¼</strong>ï¼šç›´æ¥åœ¨å½“å‰ç±»ä¸­å†…éƒ¨è°ƒç”¨ <code>createVoucherOrder()</code>ï¼Œäº‹åŠ¡ä¸ç”Ÿæ•ˆï¼</p><p><strong>è§£å†³æ–¹å¼</strong>ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IVoucherOrderService proxy <span class="operator">=</span> (IVoucherOrderService) AopContext.currentProxy()<span class="comment">;</span></span><br><span class="line">return proxy.createVoucherOrder(voucherId)<span class="comment">;</span></span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯ç”¨å½“å‰çº¿ç¨‹çš„ä»£ç†å¯¹è±¡æ¥è°ƒç”¨æ–¹æ³•ï¼Œäº‹åŠ¡æ‰èƒ½èµ·ä½œç”¨ã€‚</p><p><strong>å› æ­¤æœ€ç»ˆæ–¹æ¡ˆ</strong>æ˜¯æŠŠsynchronizedåŠ åœ¨createVoucherOrderçš„æ–¹æ³•å¤–éƒ¨ï¼Œé”ä½çš„æ˜¯ç”¨æˆ·idã€‚</p><p><code>seckillVoucher()</code> æ–¹æ³•ï¼ˆå¤–å±‚é€»è¾‘ + åŠ é” + äº‹åŠ¡ä»£ç†è°ƒç”¨ï¼‰</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">synchronized (userId.toString().intern()) &#123;</span><br><span class="line">    IVoucherOrderService proxy <span class="operator">=</span> (IVoucherOrderService) AopContext.currentProxy()<span class="comment">;</span></span><br><span class="line">    return proxy.createVoucherOrder(voucherId)<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="createVoucherOrder-æ–¹æ³•ï¼ˆçœŸæ­£åˆ›å»ºè®¢å•çš„é€»è¾‘ï¼Œå¸¦äº‹åŠ¡ï¼‰"><code>createVoucherOrder()</code> æ–¹æ³•ï¼ˆçœŸæ­£åˆ›å»ºè®¢å•çš„é€»è¾‘ï¼Œå¸¦äº‹åŠ¡ï¼‰</h4><ul><li>å…ˆæŸ¥è¯¢æ˜¯å¦å·²ç»æœ‰è®¢å•ï¼ˆä¿è¯ä¸€äººä¸€å•ï¼‰ã€‚</li><li>å¦‚æœæ²¡æœ‰ï¼Œå†æ‰£åº“å­˜ã€‚</li><li>ç„¶ååˆ›å»ºè®¢å•å¹¶ä¿å­˜ã€‚</li></ul><p>æ€»ç»“ï¼šå…³äºä»£ç†å¯¹è±¡äº‹åŠ¡çš„é—®é¢˜ï¼šé€šå¸¸æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ªä½¿ç”¨äº†@Transactionalæ³¨è§£çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼ŒSpringä¼šä»ä¸Šä¸‹æ–‡ä¸­è·å–ä¸€ä¸ªä»£ç†å¯¹è±¡æ¥ç®¡ç†äº‹åŠ¡ã€‚</p><p>ä½†æ˜¯å¦‚æœåŠ @Transactionalæ–¹æ³•æ˜¯è¢«åŒä¸€ä¸ªç±»ä¸­çš„å¦ä¸€ä¸ªæ–¹æ³•è°ƒç”¨æ—¶ï¼ŒSpringä¸ä¼šä½¿ç”¨ä»£ç†å¯¹è±¡ï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå¯¼è‡´äº‹åŠ¡æ³¨è§£å¤±æ•ˆã€‚</p><p>ä¸ºé¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨AopContext.currentProxyæ–¹æ³•è·å–å½“å‰çš„ä»£ç†å¯¹è±¡ï¼Œç„¶åé€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨è¢«@Transactionalæ³¨è§£ä¿®é¥°çš„æ–¹æ³•ï¼Œç¡®ä¿äº‹åŠ¡ç”Ÿæ•ˆã€‚</p><p>åœ¨VoucherOrderServiceImplä¸­å†™å…¥å¦‚ä¸‹ä»£ç ï¼ˆæ³¨æ„ï¼šctrl+alt+må¯ä»¥æŠŠå«æœ‰returnçš„ä»£ç æ®µè¿›è¡Œæå–ï¼‰ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VoucherOrderServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">VoucherOrderMapper</span>, <span class="title">VoucherOrder</span>&gt; <span class="keyword">implements</span> <span class="title">IVoucherOrderService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ISeckillVoucherService seckillVoucherService;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisIdWorker redisIdWorker;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function">Result <span class="title">seckillVoucher</span><span class="params">(Long voucherId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1.æŸ¥è¯¢ä¼˜æƒ åˆ¸ä¿¡æ¯</span></span><br><span class="line">        SeckillVoucher voucher = seckillVoucherService.getById(voucherId);</span><br><span class="line">        <span class="comment">//2.åˆ¤æ–­ç§’æ€æ˜¯å¦å¼€å§‹</span></span><br><span class="line">        <span class="comment">//2.1ç§’æ€å°šæœªå¼€å§‹è¿”å›å¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">if</span>(voucher.getBeginTime().isAfter(LocalDateTime.now()))&#123;</span><br><span class="line">            <span class="function"><span class="keyword">return</span> Result.<span class="title">fail</span><span class="params">(<span class="string">&quot;ç§’æ€å°šæœªå¼€å§‹&quot;</span>)</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//2.2ç§’æ€å·²ç»“æŸè¿”å›å¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">if</span>(voucher.getEndTime().isBefore(LocalDateTime.now()))&#123;</span><br><span class="line">            <span class="function"><span class="keyword">return</span> Result.<span class="title">fail</span><span class="params">(<span class="string">&quot;ç§’æ€å·²ç»ç»“æŸ&quot;</span>)</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line">        voucher = seckillVoucherService.getById(voucherId);</span><br><span class="line">        <span class="comment">//3.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class="line">        <span class="keyword">if</span>(voucher.getStock()&lt;<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="comment">//3.1åº“å­˜ä¸è¶³è¿”å›å¼‚å¸¸</span></span><br><span class="line">            <span class="function"><span class="keyword">return</span> Result.<span class="title">fail</span><span class="params">(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>)</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Long userId = UserHolder.getUser().getId();</span><br><span class="line">        <span class="keyword">synchronized</span> (userId.toString().intern())&#123;</span><br><span class="line">            <span class="comment">//è·å–ä»£ç†å¯¹è±¡</span></span><br><span class="line">            IVoucherOrderService proxy = (IVoucherOrderService) AopContext.currentProxy();</span><br><span class="line">            <span class="function"><span class="keyword">return</span> proxy.<span class="title">createVoucherOrder</span><span class="params">(voucherId)</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function">Result <span class="title">createVoucherOrder</span><span class="params">(Long voucherId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//6.ä¸€äººä¸€å•</span></span><br><span class="line">        Long userId = UserHolder.getUser().getId();</span><br><span class="line">        <span class="comment">//6.1æŸ¥è¯¢è®¢å•</span></span><br><span class="line">        <span class="keyword">int</span> count = query().eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).count();</span><br><span class="line">        <span class="comment">//6.2åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span>(count&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†</span></span><br><span class="line">            <span class="function"><span class="keyword">return</span> Result.<span class="title">fail</span><span class="params">(<span class="string">&quot;ç”¨æˆ·å·²ç»è´­ä¹°è¿‡ä¸€æ¬¡ï¼&quot;</span>)</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//3.2åº“å­˜å……è¶³æ‰£å‡åº“å­˜</span></span><br><span class="line">        <span class="keyword">boolean</span> success = seckillVoucherService.update()</span><br><span class="line">                .setSql(<span class="string">&quot;stock = stock - 1&quot;</span>) <span class="comment">//ç›¸å½“äºsetæ¡ä»¶ set stock = stock - 1</span></span><br><span class="line">                .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId) <span class="comment">//ç›¸å½“äºwhereæ¡ä»¶ where id = ? and stock = ?</span></span><br><span class="line">                .gt(<span class="string">&quot;stock&quot;</span>,<span class="number">0</span>).update();</span><br><span class="line">        <span class="keyword">if</span>(!success)&#123;</span><br><span class="line">            <span class="function"><span class="keyword">return</span> Result.<span class="title">fail</span><span class="params">(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>)</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//4.åˆ›å»ºè®¢å•ï¼Œè¿”å›è®¢å•id</span></span><br><span class="line">        VoucherOrder voucherOrder = <span class="keyword">new</span> VoucherOrder();</span><br><span class="line">        <span class="keyword">long</span> orderId = redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);<span class="comment">//è®¢å•id</span></span><br><span class="line">        voucherOrder.setId(orderId);</span><br><span class="line">        voucherOrder.setUserId(userId);</span><br><span class="line">        voucherOrder.setVoucherId(voucherId);<span class="comment">//ä»£é‡‘åˆ¸id</span></span><br><span class="line">        save(voucherOrder);</span><br><span class="line">        <span class="function"><span class="keyword">return</span> Result.<span class="title">ok</span><span class="params">(orderId)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨IVoucherOrderServiceæ¥å£ä¸­åŠ å…¥ä¸‹é¢è¿™ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable"><span class="class">Result</span></span> <span class="function"><span class="title">createVoucherOrder</span>(<span class="variable">Long</span> <span class="variable">voucherId</span>);</span></span><br></pre></td></tr></table></figure><p>åœ¨pom.xmlä¸­å¼•å…¥å¦‚ä¸‹çš„ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨å¯åŠ¨ç±»HmDianPingApplicationä¸ŠåŠ å¦‚ä¸‹æ³¨è§£ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAspectJAutoProxy</span>(exposeProxy = <span class="keyword">true</span>)</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š æˆåŠŸå®ç°ä¸€åç”¨æˆ·åªèƒ½é¢†å–ä¸€å¼ ä¼˜æƒ åˆ¸ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-157-1024x137.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-158-1024x111.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-159.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-160.png" alt="img"></p><h3 id="3-8-é›†ç¾¤ç¯å¢ƒä¸‹çš„å¹¶å‘é—®é¢˜">3.8 é›†ç¾¤ç¯å¢ƒä¸‹çš„å¹¶å‘é—®é¢˜</h3><p>é€šè¿‡åŠ é”å¯ä»¥è§£å†³åœ¨å•æœºæƒ…å†µä¸‹çš„ä¸€äººä¸€å•å®‰å…¨é—®é¢˜ï¼Œä½†æ˜¯åœ¨é›†ç¾¤æ¨¡å¼ä¸‹å°±ä¸è¡Œäº†ã€‚</p><p>å¦‚ä¸‹å›¾å¯ä»¥è®¾ç½®é¡¹ç›®å¯åŠ¨çš„ç«¯å£å·ï¼Œç¡®ä¿å¯åŠ¨çš„é¡¹ç›®ä¹‹é—´ç«¯å£å·ä¸åŒ:</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-164.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-163.png" alt="img"></p><p>åœ¨nginx.confä¸­æ”¾å¼€8082çš„è¿™ä¸ªé…ç½®ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-165.png" alt="img"></p><p>å‘ä¸‹é¢è¿™ä¸ªé¡µé¢å‘é€è¯·æ±‚ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>localhost:<span class="number">8080</span><span class="regexp">/api/</span>voucher<span class="regexp">/list/</span><span class="number">1</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¯·æ±‚ä¼šåˆ†åˆ«è¢«8082å’Œ8081æ¥æ”¶ï¼Œæ˜¯è½®è¯¢çš„æ•ˆæœï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-166.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-167.png" alt="img"></p><p>é¦–å…ˆåˆ°tb_voucher_orderæŠŠä¹‹å‰çš„è®¢å•åˆ é™¤ï¼Œåˆ°tb_seckill_voucherä¸­æŠŠstocké‡æ–°æ”¹å›100ã€‚</p><p>å‡†å¤‡2ä¸ªç›¸åŒçš„ç§’æ€è¯·æ±‚ï¼šè¦æ³¨æ„è¯·æ±‚çš„åœ°å€æ˜¯ï¼š<a href="http://localhost:8080/api/voucher-order/seckill/13">http://localhost:8080/api/voucher-order/seckill/13</a></p><p>æˆ‘è¿™é‡Œç›´æ¥ç”¨Jemeteræ¥è¿›è¡Œæµ‹è¯•ï¼Œæ¨¡æ‹Ÿé«˜å¹¶å‘åœºæ™¯ï¼š</p><p>ä¸‹é¢æ˜¯æ•ˆæœï¼šå¯ä»¥çœ‹åˆ°å¹¶å‘è¯·æ±‚èƒ½å¤ŸåŒæ—¶è¿›å…¥é›†ç¾¤çš„æ¯å°ç»“ç‚¹ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-169.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-170.png" alt="img"></p><p>æ­£å¸¸æƒ…å†µï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-172.png" alt="img"></p><h3 id="å•æœºä¸‹çš„é”æ§åˆ¶ï¼ˆç¬¬ä¸€å¼ å›¾ï¼‰">å•æœºä¸‹çš„é”æ§åˆ¶ï¼ˆç¬¬ä¸€å¼ å›¾ï¼‰</h3><p>è¿™ä¸€å¼ å›¾å±•ç¤ºäº†å¤šä¸ªçº¿ç¨‹åœ¨åŒä¸€ä¸ª JVM ä¸­æ“ä½œçš„åœºæ™¯ï¼Œç”¨æ¥è¯´æ˜å•æœºä¸‹é€šè¿‡ <code>synchronized</code> é”å¯¹è±¡æ§åˆ¶ä¸€äººä¸€å•çš„æœºåˆ¶ <strong>æ˜¯æœ‰æ•ˆçš„</strong>ã€‚</p><h4 id="âœ…-å…³é”®æµç¨‹ï¼š">âœ… å…³é”®æµç¨‹ï¼š</h4><ol><li><strong>çº¿ç¨‹1 å’Œ çº¿ç¨‹2</strong> åˆ†åˆ«å°è¯•ä¸ºåŒä¸€ç”¨æˆ·ä¸‹è®¢å•ã€‚</li><li>çº¿ç¨‹1 æ‹¿åˆ°äº†é”ï¼Œæ‰§è¡Œå®Œâ€œæŸ¥è¯¢æ˜¯å¦å·²æœ‰è®¢å•â€ï¼Œåˆ¤æ–­æ²¡æœ‰ï¼Œäºæ˜¯åˆ›å»ºæ–°è®¢å•ï¼Œé‡Šæ”¾é”ã€‚</li><li>çº¿ç¨‹2 æ­¤æ—¶ç­‰å¾…çº¿ç¨‹1é‡Šæ”¾é”ï¼Œå†åšåŒæ ·çš„æµç¨‹ã€‚</li><li>ä½†çº¿ç¨‹2æ‰§è¡Œåˆ°æŸ¥è¯¢è®¢å•æ—¶ï¼Œå·²ç»èƒ½æŸ¥åˆ°è®¢å•ï¼Œ<strong>æ‰€ä»¥ä¸ä¼šé‡å¤ä¸‹å•</strong>ã€‚</li></ol><h4 id="âœ…-ç»“è®ºï¼š">âœ… ç»“è®ºï¼š</h4><blockquote><p>å• JVM ä¸‹ï¼ŒåŒä¸€ä¸ªç”¨æˆ·åŠ é”æ˜¯ç”Ÿæ•ˆçš„ï¼Œèƒ½æœ‰æ•ˆé˜²æ­¢å¹¶å‘æ—¶çš„é‡å¤ä¸‹å•ã€‚</p></blockquote><p>ç”±äºç°åœ¨æˆ‘ä»¬éƒ¨ç½²äº†å¤šä¸ªtomcatï¼Œæ¯ä¸ªtomcatéƒ½æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„jvmï¼Œé‚£ä¹ˆå‡è®¾åœ¨æœåŠ¡å™¨Açš„tomcatå†…éƒ¨ï¼Œæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹ç”±äºä½¿ç”¨çš„æ˜¯åŒä¸€ä»½ä»£ç ï¼Œé‚£ä¹ˆä»–ä»¬çš„é”å¯¹è±¡æ˜¯åŒä¸€ä¸ªï¼Œæ˜¯å¯ä»¥å®ç°äº’æ–¥çš„ï¼Œä½†æ˜¯å¦‚æœç°åœ¨æ˜¯æœåŠ¡å™¨Bçš„tomcatå†…éƒ¨ï¼Œåˆæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯ä»–ä»¬çš„é”å¯¹è±¡å†™çš„è™½ç„¶å’ŒæœåŠ¡å™¨Aä¸€æ ·ï¼Œä½†æ˜¯é”å¯¹è±¡å´ä¸æ˜¯åŒä¸€ä¸ªï¼Œæ‰€ä»¥çº¿ç¨‹3å’Œçº¿ç¨‹4å¯ä»¥å®ç°äº’æ–¥ï¼Œä½†æ˜¯å´æ— æ³•å’Œçº¿ç¨‹1å’Œçº¿ç¨‹2å®ç°äº’æ–¥ï¼Œè¿™å°±æ˜¯ é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œsyné”å¤±æ•ˆçš„åŸå› ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼é”æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-173.png" alt="img"></p><h3 id="âŒ-é›†ç¾¤ä¸‹çš„é”å¤±æ•ˆé—®é¢˜ï¼ˆç¬¬äºŒå¼ å›¾ï¼‰">âŒ é›†ç¾¤ä¸‹çš„é”å¤±æ•ˆé—®é¢˜ï¼ˆç¬¬äºŒå¼ å›¾ï¼‰</h3><h4 id="å·¦ä¾§ï¼šJVM1ï¼ˆTomcat-Aï¼‰">å·¦ä¾§ï¼šJVM1ï¼ˆTomcat Aï¼‰</h4><ul><li>çº¿ç¨‹1 åŠ é”æˆåŠŸï¼Œæ­£åœ¨ä¸‹å•ï¼›</li><li>çº¿ç¨‹2 æ¥äº†ï¼Œåœ¨ç­‰å¾…é‡Šæ”¾é”ã€‚</li></ul><h4 id="å³ä¾§ï¼šJVM2ï¼ˆTomcat-Bï¼‰">å³ä¾§ï¼šJVM2ï¼ˆTomcat Bï¼‰</h4><ul><li>çº¿ç¨‹3 æ˜¯åŒä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚ï¼Œä½†ç”±äº JVM2 çš„é”å¯¹è±¡å’Œ JVM1 çš„é”å¯¹è±¡<strong>ä¸æ˜¯åŒä¸€ä¸ªå®ä¾‹</strong>ï¼Œæ‰€ä»¥ä¹Ÿèƒ½åŠ é”æˆåŠŸï¼›</li><li>åŒæ ·çº¿ç¨‹4 è·Ÿè¿›ç­‰å¾…çº¿ç¨‹3ï¼›</li></ul><h4 id="ğŸ§¨-é—®é¢˜äº§ç”Ÿï¼š">ğŸ§¨ é—®é¢˜äº§ç”Ÿï¼š</h4><p>è™½ç„¶çº¿ç¨‹1å’Œçº¿ç¨‹3é”çš„<strong>ä»£ç </strong>çœ‹èµ·æ¥æ˜¯ä¸€æ ·çš„ï¼Œä½†å› ä¸º<strong>JVMä¸ä¸€æ ·ï¼Œé”å¯¹è±¡ä¸æ˜¯åŒä¸€ä¸ª</strong>ï¼Œæ‰€ä»¥çº¿ç¨‹3å¹¶ä¸çŸ¥é“çº¿ç¨‹1å·²ç»åœ¨å¤„ç†ä¸‹å•é€»è¾‘äº†ã€‚</p><p>ç»“æœï¼š</p><ul><li>JVM1 å’Œ JVM2 å„è‡ªéƒ½åˆ›å»ºäº†ä¸€ä»½è®¢å•ï¼Œ<strong>è¿åäº†ä¸€äººä¸€å•çš„è§„åˆ™</strong>ï¼</li></ul><p>ç°åœ¨å°±è¦å®ç°è®©å¤šä¸ªJVMä½¿ç”¨çš„æ˜¯åŒä¸€æŠŠé”ã€‚è·¨JVMã€è·¨è¿›ç¨‹çš„é”ã€‚</p><h2 id="4ã€åˆ†å¸ƒå¼é”">4ã€åˆ†å¸ƒå¼é”</h2><h3 id="4-1-ã€åŸºæœ¬åŸç†å’Œå®ç°æ–¹å¼å¯¹æ¯”">4.1 ã€åŸºæœ¬åŸç†å’Œå®ç°æ–¹å¼å¯¹æ¯”</h3><p>ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”?</p><p>æ»¡è¶³åˆ†å¸ƒå¼ç³»ç»Ÿæˆ–é›†ç¾¤æ¨¡å¼ä¸‹å¤šè¿›ç¨‹å¯è§å¹¶ä¸”äº’æ–¥çš„é”.(æ‰€æœ‰æœåŠ¡å™¨éƒ½èƒ½è®¿é—®çš„å…±äº«é”ç³»ç»Ÿ)</p><p>åˆ†å¸ƒå¼é”çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯è®©å¤§å®¶éƒ½ä½¿ç”¨åŒä¸€æŠŠé”ï¼Œåªè¦å¤§å®¶ä½¿ç”¨çš„æ˜¯åŒä¸€æŠŠé”ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½é”ä½çº¿ç¨‹ï¼Œä¸è®©çº¿ç¨‹è¿›è¡Œï¼Œè®©ç¨‹åºä¸²è¡Œæ‰§è¡Œï¼Œè¿™å°±æ˜¯åˆ†å¸ƒå¼é”çš„æ ¸å¿ƒæ€è·¯</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-174.png" alt="img"></p><p>é‚£ä¹ˆåˆ†å¸ƒå¼é”ä»–åº”è¯¥æ»¡è¶³ä¸€äº›ä»€ä¹ˆæ ·çš„æ¡ä»¶å‘¢ï¼Ÿ</p><ul><li>å¯è§æ€§ï¼šå¤šä¸ªçº¿ç¨‹éƒ½èƒ½çœ‹åˆ°ç›¸åŒçš„ç»“æœï¼Œæ³¨æ„ï¼šè¿™ä¸ªåœ°æ–¹è¯´çš„å¯è§æ€§å¹¶ä¸æ˜¯å¹¶å‘ç¼–ç¨‹ä¸­æŒ‡çš„å†…å­˜å¯è§æ€§ï¼Œåªæ˜¯è¯´å¤šä¸ªè¿›ç¨‹ä¹‹é—´éƒ½èƒ½æ„ŸçŸ¥åˆ°å˜åŒ–çš„æ„æ€</li><li>äº’æ–¥ï¼šäº’æ–¥æ˜¯åˆ†å¸ƒå¼é”çš„æœ€åŸºæœ¬çš„æ¡ä»¶ï¼Œä½¿å¾—ç¨‹åºä¸²è¡Œæ‰§è¡Œ</li><li>é«˜å¯ç”¨ï¼šç¨‹åºä¸æ˜“å´©æºƒï¼Œæ—¶æ—¶åˆ»åˆ»éƒ½ä¿è¯è¾ƒé«˜çš„å¯ç”¨æ€§</li><li>é«˜æ€§èƒ½ï¼šç”±äºåŠ é”æœ¬èº«å°±è®©æ€§èƒ½é™ä½ï¼Œæ‰€æœ‰å¯¹äºåˆ†å¸ƒå¼é”æœ¬èº«éœ€è¦ä»–å°±è¾ƒé«˜çš„åŠ é”æ€§èƒ½å’Œé‡Šæ”¾é”æ€§èƒ½</li><li>å®‰å…¨æ€§ï¼šå®‰å…¨ä¹Ÿæ˜¯ç¨‹åºä¸­å¿…ä¸å¯å°‘çš„ä¸€ç¯</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-175.png" alt="img"></p><p>å¸¸è§çš„åˆ†å¸ƒå¼é”æœ‰ä¸‰ç§</p><ul><li>Mysqlï¼šmysqlæœ¬èº«å°±å¸¦æœ‰é”æœºåˆ¶ï¼Œä½†æ˜¯ç”±äºmysqlæ€§èƒ½æœ¬èº«ä¸€èˆ¬ï¼Œæ‰€ä»¥é‡‡ç”¨åˆ†å¸ƒå¼é”çš„æƒ…å†µä¸‹ï¼Œå…¶å®ä½¿ç”¨mysqlä½œä¸ºåˆ†å¸ƒå¼é”æ¯”è¾ƒå°‘è§</li><li>Redisï¼šredisä½œä¸ºåˆ†å¸ƒå¼é”æ˜¯éå¸¸å¸¸è§çš„ä¸€ç§ä½¿ç”¨æ–¹å¼ï¼Œç°åœ¨ä¼ä¸šçº§å¼€å‘ä¸­åŸºæœ¬éƒ½ä½¿ç”¨redisæˆ–è€…zookeeperä½œä¸ºåˆ†å¸ƒå¼é”ï¼Œåˆ©ç”¨setnxè¿™ä¸ªæ–¹æ³•ï¼Œå¦‚æœæ’å…¥keyæˆåŠŸï¼Œåˆ™è¡¨ç¤ºè·å¾—åˆ°äº†é”ï¼Œå¦‚æœæœ‰äººæ’å…¥æˆåŠŸï¼Œå…¶ä»–äººæ’å…¥å¤±è´¥åˆ™è¡¨ç¤ºæ— æ³•è·å¾—åˆ°é”ï¼Œåˆ©ç”¨è¿™å¥—é€»è¾‘æ¥å®ç°åˆ†å¸ƒå¼é”</li><li>Zookeeperï¼šzookeeperä¹Ÿæ˜¯ä¼ä¸šçº§å¼€å‘ä¸­è¾ƒå¥½çš„ä¸€ä¸ªå®ç°åˆ†å¸ƒå¼é”çš„æ–¹æ¡ˆï¼Œç”±äºæœ¬å¥—è§†é¢‘å¹¶ä¸è®²è§£zookeeperçš„åŸç†å’Œåˆ†å¸ƒå¼é”çš„å®ç°ï¼Œæ‰€ä»¥ä¸è¿‡å¤šé˜è¿°</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-176.png" alt="img"></p><h3 id="4-2-ã€Redisåˆ†å¸ƒå¼é”çš„å®ç°æ ¸å¿ƒæ€è·¯">4.2 ã€Redisåˆ†å¸ƒå¼é”çš„å®ç°æ ¸å¿ƒæ€è·¯</h3><p>ä½ å¯ä»¥æŠŠå®ƒç†è§£æˆåœ¨ Redis é‡Œâ€œå ä¸€ä¸ªä½ç½®â€ï¼Œè°å…ˆå ä¸Šå°±æœ‰æ‰§è¡Œæƒï¼Œå…¶å®ƒäººå°±å¾—ç­‰ã€‚</p><p>å®ç°åˆ†å¸ƒå¼é”æ—¶éœ€è¦å®ç°çš„ä¸¤ä¸ªåŸºæœ¬æ–¹æ³•ï¼š</p><h4 id="4-2-1å®ç°-Redis-é”æœ€æ ¸å¿ƒçš„å°±ä¸¤ä¸ªæŒ‡ä»¤ï¼š">4.2.1å®ç° Redis é”æœ€æ ¸å¿ƒçš„å°±ä¸¤ä¸ªæŒ‡ä»¤ï¼š</h4><p><strong>1. <code>SETNX</code>ï¼ˆSet if Not Existsï¼‰</strong></p><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SETNX <span class="keyword">lock</span> thread1</span><br></pre></td></tr></table></figure><p>æ„æ€æ˜¯ï¼šâ€œå¦‚æœè¿™ä¸ª <code>lock</code> é”®ä¸å­˜åœ¨ï¼Œå°±è®¾ç½®ä¸º <code>thread1</code>ã€‚â€</p><ul><li><strong>æˆåŠŸè¿”å› 1</strong>ï¼šè¯´æ˜ä½ æ‹¿åˆ°é”äº†ï¼›</li><li><strong>å¤±è´¥è¿”å› 0</strong>ï¼šè¯´æ˜åˆ«äººå·²ç»æŠ¢å…ˆæ‹¿åˆ°é”ã€‚</li></ul><h3 id="2-DELï¼šé‡Šæ”¾é”">2. <code>DEL</code>ï¼šé‡Šæ”¾é”</h3><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DEL <span class="keyword">lock</span></span><br></pre></td></tr></table></figure><p>é‡Šæ”¾é”ï¼Œè¡¨ç¤ºä»»åŠ¡åšå®Œäº†ï¼Œåˆ«äººå¯ä»¥æ¥äº†ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-177.png" alt="img"></p><h4 id="4-2-2è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé¿å…æ­»é”">4.2.2è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé¿å…æ­»é”</h4><h3 id="ä¸ºä»€ä¹ˆéœ€è¦åŠ -EXPIREï¼Ÿ">ä¸ºä»€ä¹ˆéœ€è¦åŠ  <code>EXPIRE</code>ï¼Ÿ</h3><p>å‡è®¾ï¼š</p><ul><li>çº¿ç¨‹1 æ‹¿åˆ°äº†é”ï¼›</li><li>ä½†å®ƒå´©æºƒäº†ï¼Œæ²¡æ¥å¾—åŠé‡Šæ”¾é”ï¼ˆ<code>DEL</code> æ²¡æ‰§è¡Œï¼‰ï¼›</li><li>é‚£è¿™æŠŠé”å°±<strong>æ°¸è¿œå¡åœ¨é‚£é‡Œ</strong>äº†ï¼Œåˆ«äººéƒ½æ‹¿ä¸åˆ°ï¼</li></ul><p>è§£å†³åŠæ³•ï¼š<strong>è®¾ç½®é”çš„è‡ªåŠ¨è¿‡æœŸæ—¶é—´</strong>ï¼Œä¾‹å¦‚ 5 ç§’é’Ÿï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">EXPIRE</span> lock <span class="number">5</span></span><br></pre></td></tr></table></figure><p>ç„¶åå¯ä»¥ç”¨ <code>TTL lock</code> æŸ¥çœ‹é”å‰©ä¸‹å¤šå°‘ç§’ï¼š</p><ul><li>æ­£å¸¸è¿”å›å‰©ä½™æ—¶é—´ï¼›</li><li>å¦‚æœè¿”å› -1ï¼Œè¯´æ˜æ²¡æœ‰è¿‡æœŸæ—¶é—´ï¼Œä¼šæ­»é”ï¼›</li><li>å¦‚æœè¿”å› -2ï¼Œè¯´æ˜é”å·²ç»ä¸å­˜åœ¨ã€‚</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-178.png" alt="img"></p><h4 id="4-2-3é¿å…-SETNX-å’Œ-EXPIRE-ä¹‹é—´çš„é—´éš™">4.2.3é¿å… <code>SETNX</code> å’Œ <code>EXPIRE</code> ä¹‹é—´çš„é—´éš™</h4><p>é—®é¢˜æ¥äº†ï¼š<br>å¦‚æœä½ åˆ†ä¸¤æ­¥æ‰§è¡Œâ€”â€”å…ˆ <code>SETNX</code> æ‹¿é”ï¼Œå† <code>EXPIRE</code> è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œåœ¨è¿™ä¸­é—´ä¸€æ—¦å®•æœºï¼Œå°±ä¼šå‡ºé—®é¢˜ã€‚</p><p>æ­£ç¡®åšæ³•ï¼šç”¨ Redis çš„ä¸€æ¡åŸå­æŒ‡ä»¤</p><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">lock</span> thread EX <span class="number">10</span> NX</span><br></pre></td></tr></table></figure><p>è§£é‡Šï¼š</p><ul><li><code>EX 10</code>ï¼šè®¾ç½®è¿‡æœŸæ—¶é—´ 10 ç§’ï¼›</li><li><code>NX</code>ï¼šåªæœ‰åœ¨ key ä¸å­˜åœ¨æ—¶æ‰è®¾ç½®ï¼›</li><li>è¿™æ˜¯ Redis çš„åŸå­æ“ä½œï¼Œ<strong>è®¾ç½®å€¼+è¿‡æœŸ+äº’æ–¥ä¸€æ¬¡å®Œæˆ</strong>ï¼</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-179.png" alt="img"></p><p>åŠ é”æ•ˆæœæ¼”ç¤º</p><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">lock</span> thread EX <span class="number">10</span> NXOK</span><br></pre></td></tr></table></figure><p>è¯´æ˜åŠ é”æˆåŠŸã€‚</p><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">lock</span> thread EX <span class="number">10</span> NXnull</span><br></pre></td></tr></table></figure><p>è¯´æ˜é”å·²å­˜åœ¨ï¼ŒåŠ é”å¤±è´¥ã€‚</p><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TTL <span class="keyword">lock</span></span><br><span class="line"><span class="number">7</span></span><br></pre></td></tr></table></figure><p>è¯´æ˜é”è¿˜æœ‰ 7 ç§’å°±ä¼šè‡ªåŠ¨é‡Šæ”¾ã€‚</p><h4 id="4-2-4åŠ é”ä¸é‡Šæ”¾çš„æ­£ç¡®æµç¨‹æ€»ç»“">4.2.4åŠ é”ä¸é‡Šæ”¾çš„æ­£ç¡®æµç¨‹æ€»ç»“</h4><ul><li>è·å–é”ï¼š<ul><li>äº’æ–¥æ€§ï¼šç¡®ä¿åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è·å–é”æˆåŠŸ</li><li>éé˜»å¡ï¼šå°è¯•ä¸€æ¬¡ï¼ŒæˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false</li><li>è‡ªåŠ¨è¿‡æœŸï¼šé¿å…æ­»é”</li></ul></li><li>é‡Šæ”¾é”ï¼š<ul><li>æ‰‹åŠ¨é‡Šæ”¾ï¼ˆä¸šåŠ¡å®Œæˆå <code>DEL</code>ï¼‰</li><li>è¶…æ—¶é‡Šæ”¾ï¼šè·å–é”æ—¶æ·»åŠ ä¸€ä¸ªè¶…æ—¶æ—¶é—´</li></ul></li></ul><h3 id="4-3-å®ç°åˆ†å¸ƒå¼é”ç‰ˆæœ¬ä¸€">4.3 å®ç°åˆ†å¸ƒå¼é”ç‰ˆæœ¬ä¸€</h3><p>åœ¨utilsä¸‹é¢åˆ›å»ºä¸€ä¸ªILockæ¥å£ï¼š</p><p>è¿™ä¸€æ­¥æ˜¯åšæ¥å£ç¼–ç¨‹ï¼Œä¾¿äºåæœŸæ‰©å±•ï¼ˆæ¯”å¦‚æ¢ Redisson æˆ– ZooKeeper é”æ—¶ï¼Œä¸æ”¹ä¸šåŠ¡é€»è¾‘ï¼‰</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ILock</span> </span>&#123;</span><br><span class="line">    <span class="comment">//å°è¯•è·å–é”</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">(<span class="keyword">long</span> timeoutSec)</span></span>;</span><br><span class="line">    <span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨utilsä¸‹é¢å®ç°SimpleRedisLockç±»ï¼š</p><h3 id="ç»†èŠ‚è§£é‡Šï¼š">ç»†èŠ‚è§£é‡Šï¼š</h3><ul><li><code>threadId</code>ï¼šå½“å‰çº¿ç¨‹çš„å”¯ä¸€æ ‡è¯†ï¼Œè®¾ç½®ä¸ºé”çš„å€¼ï¼Œä¾¿äºåæœŸæ‰©å±•å®‰å…¨æ€§ï¼›</li><li><code>setIfAbsent</code>ï¼šå°±æ˜¯ Redis çš„ <code>SET key value NX EX</code> æ“ä½œï¼›</li><li><code>timeoutSec</code>ï¼šè‡ªåŠ¨è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢æ­»é”ï¼›</li><li><code>delete</code>ï¼šé‡Šæ”¾é”ï¼Œç›´æ¥åˆ æ‰å¯¹åº” Redis keyã€‚</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleRedisLock</span> <span class="keyword">implements</span> <span class="title class_">ILock</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> name;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">StringRedisTemplate</span> stringRedisTemplate;</span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">SimpleRedisLock</span>(<span class="title class_">String</span> name, <span class="title class_">StringRedisTemplate</span> stringRedisTemplate) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">stringRedisTemplate</span> = stringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> final <span class="title class_">String</span> <span class="variable constant_">KEY_PREFIX</span> = <span class="string">&quot;lock:&quot;</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">boolean</span> <span class="title function_">tryLock</span>(<span class="params">long timeoutSec</span>) &#123;</span><br><span class="line">        <span class="comment">//è·å–çº¿ç¨‹æ ‡ç¤º</span></span><br><span class="line">        long threadId = <span class="title class_">Thread</span>.<span class="title function_">currentThread</span>().<span class="title function_">getId</span>();</span><br><span class="line">        <span class="title class_">Boolean</span> success = stringRedisTemplate.<span class="title function_">opsForValue</span>().<span class="title function_">setIfAbsent</span>(<span class="variable constant_">KEY_PREFIX</span>+name,threadId+<span class="string">&quot;&quot;</span>,timeoutSec, <span class="title class_">TimeUnit</span>.<span class="property">SECONDS</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Boolean</span>.<span class="property">TRUE</span>.<span class="title function_">equals</span>(success);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">unlock</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line">        stringRedisTemplate.<span class="title function_">delete</span>(<span class="variable constant_">KEY_PREFIX</span>+name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›´æ”¹VoucherOrderServiceImplç±»ä¸­çš„seckillVoucheræ–¹æ³•çš„ä»£ç ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> RedisIdWorker redisIdWorker;</span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="function">Result <span class="title">seckillVoucher</span><span class="params">(Long voucherId)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1.æŸ¥è¯¢ä¼˜æƒ åˆ¸ä¿¡æ¯</span></span><br><span class="line">    SeckillVoucher voucher = seckillVoucherService.getById(voucherId);</span><br><span class="line">    <span class="comment">//2.åˆ¤æ–­ç§’æ€æ˜¯å¦å¼€å§‹</span></span><br><span class="line">    <span class="comment">//2.1ç§’æ€å°šæœªå¼€å§‹è¿”å›å¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span>(voucher.getBeginTime().isAfter(LocalDateTime.now()))&#123;</span><br><span class="line">        <span class="function"><span class="keyword">return</span> Result.<span class="title">fail</span><span class="params">(<span class="string">&quot;ç§’æ€å°šæœªå¼€å§‹&quot;</span>)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2.2ç§’æ€å·²ç»“æŸè¿”å›å¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span>(voucher.getEndTime().isBefore(LocalDateTime.now()))&#123;</span><br><span class="line">        <span class="function"><span class="keyword">return</span> Result.<span class="title">fail</span><span class="params">(<span class="string">&quot;ç§’æ€å·²ç»ç»“æŸ&quot;</span>)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    voucher = seckillVoucherService.getById(voucherId);</span><br><span class="line">    <span class="comment">//3.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class="line">    <span class="keyword">if</span>(voucher.getStock()&lt;<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="comment">//3.1åº“å­˜ä¸è¶³è¿”å›å¼‚å¸¸</span></span><br><span class="line">        <span class="function"><span class="keyword">return</span> Result.<span class="title">fail</span><span class="params">(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Long userId = UserHolder.getUser().getId();</span><br><span class="line">    SimpleRedisLock lock = <span class="keyword">new</span> SimpleRedisLock(<span class="string">&quot;order:&quot;</span>+userId,stringRedisTemplate);</span><br><span class="line">    <span class="keyword">boolean</span> isLock = lock.tryLock(<span class="number">1200</span>);</span><br><span class="line">    <span class="comment">//åˆ¤æ–­æ˜¯å¦è·å–é”æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span>(!isLock) &#123;</span><br><span class="line">        <span class="function"><span class="keyword">return</span> Result.<span class="title">fail</span><span class="params">(<span class="string">&quot;ä¸å…è®¸é‡å¤ä¸‹å•&quot;</span>)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//è·å–ä»£ç†å¯¹è±¡</span></span><br><span class="line">        IVoucherOrderService proxy = (IVoucherOrderService) AopContext.currentProxy();</span><br><span class="line">        <span class="function"><span class="keyword">return</span> proxy.<span class="title">createVoucherOrder</span><span class="params">(voucherId)</span></span>;</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ ¸å¿ƒä»£ç ï¼š</strong></p><p>åœ¨ <code>VoucherOrderServiceImpl</code> é‡Œæ›¿æ¢åŸæ¥çš„åŠ é”æ–¹å¼ï¼Œæ”¹ç”¨ <code>SimpleRedisLock</code>ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SimpleRedisLock <span class="keyword">lock</span> = <span class="built_in">new</span> SimpleRedisLock(&quot;order:&quot; + userId, stringRedisTemplate);</span><br><span class="line"><span class="type">boolean</span> isLock = <span class="keyword">lock</span>.tryLock(<span class="number">1200</span>);</span><br></pre></td></tr></table></figure><p>å¦‚æœåŠ é”æˆåŠŸï¼Œå°±è°ƒç”¨ä»£ç†å¯¹è±¡åˆ›å»ºè®¢å•ï¼›å¤±è´¥å°±è¯´æ˜è¿™ä¸ªç”¨æˆ·å·²ç»åœ¨å¤„ç†ä¸­ï¼Œæ‹’ç»é‡å¤ä¸‹å•ã€‚</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!isLock) &#123;</span><br><span class="line">    <span class="function"><span class="keyword">return</span> Result.<span class="title">fail</span><span class="params">(<span class="string">&quot;ä¸å…è®¸é‡å¤ä¸‹å•&quot;</span>)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    IVoucherOrderService proxy = (IVoucherOrderService) AopContext.currentProxy();</span><br><span class="line">    <span class="function"><span class="keyword">return</span> proxy.<span class="title">createVoucherOrder</span><span class="params">(voucherId)</span></span>;</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    lock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»æµ‹è¯•å¤šå°èŠ‚ç‚¹ç›¸åŒç”¨æˆ·åªèƒ½è·å–åŒä¸€å¼ ä¼˜æƒ åˆ¸æˆåŠŸï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-180.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-181.png" alt="img"></p><p>ç›®å‰è¿™ä¸ªé”å®ç° <strong>ä»æœ‰é£é™©</strong>ï¼š</p><ul><li>â—ï¸ç›´æ¥ delete keyï¼Œ<strong>æ²¡æœ‰éªŒè¯æ˜¯å¦æ˜¯è‡ªå·±åŠ çš„é”å°±åˆ äº†</strong>ï¼ˆå®¹æ˜“è¯¯åˆ åˆ«äººçš„é”ï¼‰ï¼›</li><li>â—ï¸å¦‚æœæ‰§è¡Œæ—¶é—´è¶…è¿‡äº†è¿‡æœŸæ—¶é—´ï¼ˆæ¯”å¦‚ 2 ç§’ï¼‰ï¼Œé”ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œä½†ä»»åŠ¡è¿˜æ²¡åšå®Œï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°±å¯èƒ½æŠ¢åˆ°é”å¹¶é‡å¤æ‰§è¡Œï¼</li></ul><p>è¿™äº›é—®é¢˜åé¢ä¼šé€šè¿‡åŠ <strong>å”¯ä¸€æ ‡è¯† + Lua è„šæœ¬é‡Šæ”¾é”</strong>æ–¹å¼æ”¹è¿›ã€‚</p><h3 id="4-4Redisåˆ†å¸ƒå¼é”è¯¯åˆ æƒ…å†µè¯´æ˜">4.4Redisåˆ†å¸ƒå¼é”è¯¯åˆ æƒ…å†µè¯´æ˜</h3><p>å¦‚æœä½ æ²¡æœ‰æ ¡éªŒâ€œè¿™æŠŠé”æ˜¯ä¸æ˜¯æˆ‘åŠ çš„â€ï¼Œå°±å¯èƒ½ä¼šå‘ç”Ÿè¿™ç§é”™è¯¯ï¼š</p><blockquote><p>ä¸€ä¸ªçº¿ç¨‹å› ä¸ºå¡é¡¿æˆ–ç½‘ç»œé—®é¢˜ï¼Œ<strong>ç­‰å®ƒé†’æ¥æ—¶ï¼Œè¿™æŠŠé”å·²ç»è¢«åˆ«äººæ‹¿èµ°äº†ï¼Œä½†å®ƒè¿˜ä»¥ä¸ºæ˜¯è‡ªå·±çš„ï¼Œå°±æŠŠåˆ«äººçš„é”åˆ äº†ï¼</strong></p></blockquote><p>é€»è¾‘è¯´æ˜ï¼š</p><p>æŒæœ‰é”çš„çº¿ç¨‹åœ¨é”çš„å†…éƒ¨å‡ºç°äº†é˜»å¡ï¼Œå¯¼è‡´ä»–çš„é”è‡ªåŠ¨é‡Šæ”¾ï¼Œè¿™æ—¶å…¶ä»–çº¿ç¨‹ï¼Œçº¿ç¨‹2æ¥å°è¯•è·å¾—é”ï¼Œå°±æ‹¿åˆ°äº†è¿™æŠŠé”ï¼Œç„¶åçº¿ç¨‹2åœ¨æŒæœ‰é”æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹1ååº”è¿‡æ¥ï¼Œç»§ç»­æ‰§è¡Œï¼Œè€Œçº¿ç¨‹1æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œèµ°åˆ°äº†åˆ é™¤é”é€»è¾‘ï¼Œæ­¤æ—¶å°±ä¼šæŠŠæœ¬åº”è¯¥å±äºçº¿ç¨‹2çš„é”è¿›è¡Œåˆ é™¤ï¼Œè¿™å°±æ˜¯è¯¯åˆ åˆ«äººé”çš„æƒ…å†µè¯´æ˜</p><p>è§£å†³æ–¹æ¡ˆï¼šè§£å†³æ–¹æ¡ˆå°±æ˜¯åœ¨æ¯ä¸ªçº¿ç¨‹é‡Šæ”¾é”çš„æ—¶å€™ï¼Œå»åˆ¤æ–­ä¸€ä¸‹å½“å‰è¿™æŠŠé”æ˜¯å¦å±äºè‡ªå·±ï¼Œå¦‚æœå±äºè‡ªå·±ï¼Œåˆ™ä¸è¿›è¡Œé”çš„åˆ é™¤ï¼Œå‡è®¾è¿˜æ˜¯ä¸Šè¾¹çš„æƒ…å†µï¼Œçº¿ç¨‹1å¡é¡¿ï¼Œé”è‡ªåŠ¨é‡Šæ”¾ï¼Œçº¿ç¨‹2è¿›å…¥åˆ°é”çš„å†…éƒ¨æ‰§è¡Œé€»è¾‘ï¼Œæ­¤æ—¶çº¿ç¨‹1ååº”è¿‡æ¥ï¼Œç„¶ååˆ é™¤é”ï¼Œä½†æ˜¯çº¿ç¨‹1ï¼Œä¸€çœ‹å½“å‰è¿™æŠŠé”ä¸æ˜¯å±äºè‡ªå·±ï¼Œäºæ˜¯ä¸è¿›è¡Œåˆ é™¤é”é€»è¾‘ï¼Œå½“çº¿ç¨‹2èµ°åˆ°åˆ é™¤é”é€»è¾‘æ—¶ï¼Œå¦‚æœæ²¡æœ‰å¡è¿‡è‡ªåŠ¨é‡Šæ”¾é”çš„æ—¶é—´ç‚¹ï¼Œåˆ™åˆ¤æ–­å½“å‰è¿™æŠŠé”æ˜¯å±äºè‡ªå·±çš„ï¼Œäºæ˜¯åˆ é™¤è¿™æŠŠé”ã€‚</p><p><strong>æ€»ç»“ä¸€å¥è¯å°±æ˜¯</strong>ï¼š<strong>ä¸è¦ç”¨ <code>delete</code> ç›´æ¥é‡Šæ”¾é”</strong>ï¼Œä¸€å®šè¦æ£€æŸ¥â€œè¿™æŠŠé”æ˜¯ä¸æ˜¯æˆ‘åŠ çš„â€å†åˆ ï¼Œ<strong>ç”¨ Lua è„šæœ¬ä¿è¯åŸå­æ€§</strong>ï¼Œå¦åˆ™å°±ä¼šåœ¨å¤šçº¿ç¨‹æˆ–å¤šæœºå™¨ç¯å¢ƒä¸‹åˆ é”™åˆ«äººçš„é”ï¼</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-183-1024x428.png" alt="img"></p><h4 id="å›¾ä¸­æµç¨‹è¯¦è§£">å›¾ä¸­æµç¨‹è¯¦è§£</h4><h4 id="â–¶-çº¿ç¨‹1ï¼š">â–¶ çº¿ç¨‹1ï¼š</h4><ul><li>æˆåŠŸåŠ é”å¹¶æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼›</li><li>ä¸­é€”â€œå¡ä½äº†â€ï¼ˆå¯èƒ½æ˜¯ç½‘ç»œã€GC ç­‰å¡é¡¿ï¼‰ï¼›</li><li>é”è¿‡æœŸåï¼Œ<strong>è‡ªåŠ¨é‡Šæ”¾</strong>ï¼›</li><li>çº¿ç¨‹1 åç»­æ¢å¤ï¼Œ<strong>ç»§ç»­æ‰§è¡Œ delete</strong>ï¼Œä½†è¿™æ—¶é”å·²ç»ä¸æ˜¯å®ƒçš„äº†ï¼</li></ul><h4 id="â–¶-çº¿ç¨‹2ï¼š">â–¶ çº¿ç¨‹2ï¼š</h4><ul><li>çº¿ç¨‹1å¡ä½æ—¶ï¼Œé”è¿‡æœŸï¼›</li><li>å®ƒå°è¯•åŠ é”ï¼ŒæˆåŠŸï¼ˆå› ä¸º Redis å·²è‡ªåŠ¨é‡Šæ”¾ï¼‰ï¼›</li><li>å®ƒå¼€å§‹æ‰§è¡Œè‡ªå·±çš„ä¸šåŠ¡ã€‚</li></ul><h4 id="â–¶-é—®é¢˜æ¥äº†ï¼š">â–¶ é—®é¢˜æ¥äº†ï¼š</h4><ul><li>çº¿ç¨‹1 <strong>åçŸ¥åè§‰</strong>åœ°æ¢å¤å¹¶æ‰§è¡Œ <code>DEL lock</code>ï¼›</li><li>æ­¤æ—¶é”çš„å€¼å·²å˜æˆçº¿ç¨‹2çš„æ ‡è¯†ï¼›</li><li>ä½†å®ƒä»ç„¶æ‰§è¡Œ deleteï¼Œ<strong>è¯¯åˆ äº†çº¿ç¨‹2çš„é”</strong>ï¼</li><li>çº¿ç¨‹3 ä¹Ÿè¿›æ¥äº†ï¼Œå®ƒå°±èƒ½è·å–é”ï¼Œé€ æˆå¹¶å‘è®¿é—®ï¼Œ<strong>é€»è¾‘é”™ä¹±</strong>ï¼</li></ul><h3 id="4-5-è§£å†³Redisåˆ†å¸ƒå¼é”è¯¯åˆ é—®é¢˜">4.5 è§£å†³Redisåˆ†å¸ƒå¼é”è¯¯åˆ é—®é¢˜</h3><p>ç›®æ ‡ï¼šé”é‡Šæ”¾å‰å…ˆæ ¡éªŒâ€œé”æ˜¯æˆ‘åŠ çš„â€</p><p>æ–°éœ€æ±‚ï¼š</p><ul><li>åŠ é”æ—¶ï¼šå­˜å…¥<strong>çº¿ç¨‹æ ‡è¯†</strong>ï¼ˆå¦‚ï¼šUUID + Thread IDï¼‰ï¼›</li><li>è§£é”æ—¶ï¼šå…ˆå–å‡º Redis é‡Œçš„æ ‡è¯†ï¼›<ul><li>å¦‚æœå’Œå½“å‰çº¿ç¨‹ä¸€è‡´ï¼šæ‰èƒ½åˆ é”ï¼›</li><li>å¦åˆ™ï¼šä¸åˆ ï¼Œé˜²æ­¢è¯¯åˆ ã€‚</li></ul></li></ul><p>æ ¸å¿ƒé€»è¾‘ï¼šåœ¨å­˜å…¥é”æ—¶ï¼Œæ”¾å…¥è‡ªå·±çº¿ç¨‹çš„æ ‡è¯†ï¼Œåœ¨åˆ é™¤é”æ—¶ï¼Œåˆ¤æ–­å½“å‰è¿™æŠŠé”çš„æ ‡è¯†æ˜¯ä¸æ˜¯è‡ªå·±å­˜å…¥çš„ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿›è¡Œåˆ é™¤ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ä¸è¿›è¡Œåˆ é™¤ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-184.png" alt="img"></p><p>é¦–å…ˆè¦ä¿®æ”¹SimpleRedisLocké‡Œé¢çš„å¦‚ä¸‹ä»£ç ï¼Œä¸»è¦æ˜¯è°ƒç”¨hutoolå·¥å…·åŒ…ç”ŸæˆUUIDï¼ˆæ¯æ¬¡çº¿ç¨‹è°ƒç”¨éƒ½ä¼šç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„UUIDï¼‰ï¼Œè®©Redisçš„å‰ç¼€å˜æˆUUID+çº¿ç¨‹IDï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ID_PREFIX</span> <span class="operator">=</span> UUID.fastUUID().toString(<span class="literal">true</span>)+<span class="string">&quot;-&quot;</span>;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(<span class="type">long</span> timeoutSec)</span> &#123;</span><br><span class="line">    <span class="comment">//è·å–çº¿ç¨‹æ ‡ç¤º</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">threadId</span> <span class="operator">=</span> ID_PREFIX + Thread.currentThread().getId();</span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">success</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().setIfAbsent(KEY_PREFIX+name,threadId,timeoutSec, TimeUnit.SECONDS);</span><br><span class="line">    <span class="keyword">return</span> Boolean.TRUE.equals(success);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨è¦ä¿®æ”¹çš„æ˜¯SimpleRedisLockç±»é‡Œé¢çš„unlockæ–¹æ³•ï¼Œä¸»è¦æ˜¯æ¯”è¾ƒå½“å‰çº¿ç¨‹çš„æ ‡ç¤ºå’ŒRedisä¸­é”çš„æ ‡ç¤ºæ˜¯å¦ä¸€è‡´ï¼Œåªæœ‰æ ‡ç¤ºä¸€è‡´æ‰èƒ½é‡Šæ”¾é”ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">unlock</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//è·å–çº¿ç¨‹æ ‡ç¤º</span></span><br><span class="line">    <span class="title class_">String</span> threadId = <span class="variable constant_">ID_PREFIX</span> + <span class="title class_">Thread</span>.<span class="title function_">currentThread</span>().<span class="title function_">getId</span>();</span><br><span class="line">    <span class="comment">//è·å–é”ä¸­çš„æ ‡ç¤º</span></span><br><span class="line">    <span class="title class_">String</span> id = stringRedisTemplate.<span class="title function_">opsForValue</span>().<span class="title function_">get</span>(<span class="variable constant_">KEY_PREFIX</span> + name);</span><br><span class="line">    <span class="keyword">if</span>(threadId.<span class="title function_">equals</span>(id))&#123;</span><br><span class="line">        <span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line">        stringRedisTemplate.<span class="title function_">delete</span>(<span class="variable constant_">KEY_PREFIX</span>+name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€»ç»“ä¸€å¥è¯ï¼šé€šè¿‡åŠ â€œçº¿ç¨‹å”¯ä¸€æ ‡è¯†â€ï¼Œå¹¶åœ¨é‡Šæ”¾é”æ—¶æ¯”å¯¹è¿™ä¸ªæ ‡è¯†ï¼ŒæˆåŠŸè§£å†³ Redis åˆ†å¸ƒå¼é”çš„<strong>è¯¯åˆ é—®é¢˜</strong>ï¼Œç¡®ä¿åªæœ‰â€œåŠ é”è€…â€æ‰èƒ½â€œè§£é”â€ã€‚</p><h3 id="4-6-åˆ†å¸ƒå¼é”çš„åŸå­æ€§é—®é¢˜">4.6 åˆ†å¸ƒå¼é”çš„åŸå­æ€§é—®é¢˜</h3><p>æ›´ä¸ºæç«¯çš„è¯¯åˆ é€»è¾‘è¯´æ˜ï¼š</p><p>çº¿ç¨‹1ç°åœ¨æŒæœ‰é”ä¹‹åï¼Œåœ¨æ‰§è¡Œä¸šåŠ¡é€»è¾‘è¿‡ç¨‹ä¸­ï¼Œä»–æ­£å‡†å¤‡åˆ é™¤é”ï¼Œè€Œä¸”å·²ç»èµ°åˆ°äº†æ¡ä»¶åˆ¤æ–­çš„è¿‡ç¨‹ä¸­ï¼Œæ¯”å¦‚ä»–å·²ç»æ‹¿åˆ°äº†å½“å‰è¿™æŠŠé”ç¡®å®æ˜¯å±äºä»–è‡ªå·±çš„ï¼Œæ­£å‡†å¤‡åˆ é™¤é”ï¼Œä½†æ˜¯æ­¤æ—¶ä»–çš„é”åˆ°æœŸäº†ï¼Œé‚£ä¹ˆæ­¤æ—¶çº¿ç¨‹2è¿›æ¥ï¼Œä½†æ˜¯çº¿ç¨‹1ä»–ä¼šæ¥ç€å¾€åæ‰§è¡Œï¼Œå½“ä»–å¡é¡¿ç»“æŸåï¼Œä»–ç›´æ¥å°±ä¼šæ‰§è¡Œåˆ é™¤é”é‚£è¡Œä»£ç ï¼Œç›¸å½“äºæ¡ä»¶åˆ¤æ–­å¹¶æ²¡æœ‰èµ·åˆ°ä½œç”¨ï¼Œè¿™å°±æ˜¯åˆ é”æ—¶çš„åŸå­æ€§é—®é¢˜ï¼Œä¹‹æ‰€ä»¥æœ‰è¿™ä¸ªé—®é¢˜ï¼Œæ˜¯å› ä¸ºçº¿ç¨‹1çš„æ‹¿é”ï¼Œæ¯”é”ï¼Œåˆ é”ï¼Œå®é™…ä¸Šå¹¶ä¸æ˜¯åŸå­æ€§çš„ï¼Œæˆ‘ä»¬è¦é˜²æ­¢åˆšæ‰çš„æƒ…å†µå‘ç”Ÿï¼Œ</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-186-1024x441.png" alt="img"></p><ul><li><strong>çº¿ç¨‹1</strong> è·å–é”æˆåŠŸï¼ˆé”æ ‡è¯†æ˜¯çº¿ç¨‹1çš„ UUIDï¼‰ï¼›</li><li>æ‰§è¡Œä¸šåŠ¡ï¼›</li><li>å‡†å¤‡é‡Šæ”¾é”ï¼Œ<strong>æ­£åœ¨åˆ¤æ–­é”æ˜¯ä¸æ˜¯è‡ªå·±çš„</strong>ï¼ˆè¿™ä¸ªæ—¶å€™åˆ¤æ–­æˆåŠŸï¼‰ï¼›</li><li>ä½†æ˜¯ï¼<strong>å°±åœ¨è¿™ä¸€æ­¥ä¹‹åçº¿ç¨‹1çªç„¶è¢«å¡ä½</strong>ï¼ˆé˜»å¡æˆ–å®•æœºï¼‰ï¼›</li><li>é”è¶…æ—¶åè¢« Redis è‡ªåŠ¨é‡Šæ”¾ï¼›</li><li><strong>çº¿ç¨‹2ã€çº¿ç¨‹3</strong> å…ˆåè·å–é”å¹¶æ‰§è¡Œä¸šåŠ¡ï¼›</li><li>çº¿ç¨‹1 é†’æ¥ï¼Œç»§ç»­å¾€ä¸‹æ‰§è¡Œ deleteï¼Œ<strong>æŠŠçº¿ç¨‹2æˆ–3çš„é”åˆ æ‰äº†</strong>ï¼ï¼</li></ul><h4 id="å…³é”®é—®é¢˜ï¼šåˆ¤æ–­-åˆ é™¤ä¸æ˜¯åŸå­æ“ä½œ">å…³é”®é—®é¢˜ï¼š<strong>åˆ¤æ–­ + åˆ é™¤ä¸æ˜¯åŸå­æ“ä½œ</strong></h4><p>è¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´ä¸€æ—¦å‡ºç°â€œå¡é¡¿ã€å»¶è¿Ÿã€è°ƒåº¦åˆ‡æ¢â€ç­‰éé¢„æœŸæƒ…å†µï¼Œå°±å¯èƒ½å¯¼è‡´ä½ <strong>è¯¯åˆ äº†åˆ«äººçš„é”</strong>ï¼Œå³ä¾¿ä½ ä¹‹å‰å·²ç»åšäº†çº¿ç¨‹æ ‡è¯†æ ¡éªŒã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š<strong>ç”¨ Lua è„šæœ¬è®©â€œåˆ¤æ–­+åˆ é™¤â€åŸå­æ‰§è¡Œ</strong></p><h3 id="4-7-Luaè„šæœ¬è§£å†³å¤šæ¡å‘½ä»¤åŸå­æ€§é—®é¢˜">4.7 Luaè„šæœ¬è§£å†³å¤šæ¡å‘½ä»¤åŸå­æ€§é—®é¢˜</h3><h4 id="ä¸ºä»€ä¹ˆç”¨-Luaï¼Ÿ">ä¸ºä»€ä¹ˆç”¨ Luaï¼Ÿ</h4><blockquote><p>ç­”ï¼šRedis æä¾›çš„ <code>EVAL</code> å‘½ä»¤æ”¯æŒåœ¨æœåŠ¡ç«¯è¿è¡Œ Lua è„šæœ¬ï¼Œèƒ½è®©å¤šä¸ª Redis å‘½ä»¤ç»„æˆ <strong>ä¸€ä¸ªä¸å¯æ‹†åˆ†çš„åŸå­æ“ä½œ</strong>ã€‚</p></blockquote><p>Redisæä¾›Luaè„šæœ¬åŠŸèƒ½ï¼Œåœ¨ä¸€ä¸ªè„šæœ¬ä¸­ç¼–å†™å¤šæ¡Rediså‘½ä»¤ï¼Œç¡®ä¿å¤šæ¡å‘½ä»¤æ‰§è¡Œæ—¶çš„åŸå­æ€§ã€‚</p><p>Luaæ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒçš„åŸºæœ¬è¯­æ³•å¯ä»¥å‚è€ƒç½‘ç«™ï¼š<a href="https://www.runoob.com/lua/lua-tutorial.html">https://www.runoob.com/lua/lua-tutorial.html</a></p><h4 id="4-7-1Lua-è„šæœ¬åŸºæœ¬è¯­æ³•">4.7.1Lua è„šæœ¬åŸºæœ¬è¯­æ³•</h4><p>è¿™é‡Œé‡ç‚¹ä»‹ç»Redisæä¾›çš„è°ƒç”¨å‡½æ•°ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis.<span class="built_in">call</span>(<span class="string">&#x27;å‘½ä»¤åç§°&#x27;</span>, <span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;å…¶å®ƒå‚æ•°&#x27;</span>, ...)</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦æ‰§è¡Œset name jackï¼Œåˆ™è„šæœ¬æ˜¯è¿™æ ·ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># æ‰§è¡Œ <span class="keyword">set</span> <span class="type">name</span> jack</span><br><span class="line">redis.<span class="keyword">call</span>(<span class="string">&#x27;set&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;jack&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦å…ˆæ‰§è¡Œset name Roseï¼Œå†æ‰§è¡Œget nameï¼Œåˆ™è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># å…ˆæ‰§è¡Œ <span class="keyword">set</span> <span class="type">name</span> jack</span><br><span class="line">redis.<span class="keyword">call</span>(<span class="string">&#x27;set&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;Rose&#x27;</span>)</span><br><span class="line"># å†æ‰§è¡Œ <span class="keyword">get</span> <span class="type">name</span></span><br><span class="line"><span class="keyword">local</span> <span class="type">name</span> = redis.<span class="keyword">call</span>(<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"># è¿”å›</span><br><span class="line"><span class="keyword">return</span> <span class="type">name</span></span><br></pre></td></tr></table></figure><h4 id="4-7-2-ä½¿ç”¨-EVAL-è°ƒç”¨è„šæœ¬">4.7.2 ä½¿ç”¨ EVAL è°ƒç”¨è„šæœ¬</h4><p>å†™å¥½è„šæœ¬ä»¥åï¼Œéœ€è¦ç”¨Rediså‘½ä»¤æ¥è°ƒç”¨è„šæœ¬ï¼Œè°ƒç”¨è„šæœ¬çš„å¸¸è§å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">EVAL</span> <span class="string">&quot;è„šæœ¬å†…å®¹&quot;</span> numkeys key1 [key2 â€¦] arg1 [arg2 â€¦]</span><br></pre></td></tr></table></figure><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-187-1024x233.png" alt="img"></p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦æ‰§è¡Œ redis.call(â€˜setâ€™, â€˜nameâ€™, â€˜jackâ€™) è¿™ä¸ªè„šæœ¬ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-188.png" alt="img"></p><h4 id="4-7-3-å‚æ•°åŠ¨æ€ä¼ å…¥æ–¹å¼">4.7.3. å‚æ•°åŠ¨æ€ä¼ å…¥æ–¹å¼</h4><p>å¦‚æœè„šæœ¬ä¸­çš„keyã€valueä¸æƒ³å†™æ­»ï¼Œå¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ã€‚keyç±»å‹å‚æ•°ä¼šæ”¾å…¥KEYSæ•°ç»„ï¼Œå…¶å®ƒå‚æ•°ä¼šæ”¾å…¥ARGVæ•°ç»„ï¼Œåœ¨è„šæœ¬ä¸­å¯ä»¥ä»KEYSå’ŒARGVæ•°ç»„è·å–è¿™äº›å‚æ•°ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-189-1024x137.png" alt="img"></p><ul><li><code>1</code>ï¼šè¡¨ç¤ºæœ‰ä¸€ä¸ª key å‚æ•°</li><li><code>KEYS[1] = name</code>ï¼Œ<code>ARGV[1] = Rose</code></li></ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å›ä¸€ä¸‹æˆ‘ä»¬é‡Šæ”¾é”çš„é€»è¾‘ï¼š</p><p>ç›®æ ‡ï¼šè®©ä»¥ä¸‹é€»è¾‘å˜æˆä¸€ä¸ªåŸå­æ“ä½œï¼š</p><ol><li>è¯»å–é”çš„å€¼</li><li>æ¯”è¾ƒå€¼æ˜¯å¦ç­‰äºå½“å‰çº¿ç¨‹æ ‡è¯†</li><li>å¦‚æœä¸€è‡´ï¼Œé‡Šæ”¾é”</li><li>å¦‚æœä¸ä¸€è‡´ï¼Œä¸åšä»»ä½•æ“ä½œ</li></ol><p>å¦‚æœç”¨Luaè„šæœ¬æ¥è¡¨ç¤ºåˆ™æ˜¯è¿™æ ·çš„ï¼š</p><p>æœ€ç»ˆæˆ‘ä»¬æ“ä½œredisçš„æ‹¿é”æ¯”é”åˆ é”çš„luaè„šæœ¬å°±ä¼šå˜æˆè¿™æ ·</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è¿™é‡Œçš„ KEYS[1] å°±æ˜¯é”çš„keyï¼Œè¿™é‡Œçš„ARGV[1] å°±æ˜¯å½“å‰çº¿ç¨‹æ ‡ç¤º</span></span><br><span class="line"><span class="comment">-- è·å–é”ä¸­çš„æ ‡ç¤ºï¼Œåˆ¤æ–­æ˜¯å¦ä¸å½“å‰çº¿ç¨‹æ ‡ç¤ºä¸€è‡´</span></span><br><span class="line"><span class="keyword">if</span> (redis.<span class="keyword">call</span>(<span class="string">&#x27;GET&#x27;</span>, KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>]) <span class="keyword">then</span></span><br><span class="line">  <span class="comment">-- ä¸€è‡´ï¼Œåˆ™åˆ é™¤é”</span></span><br><span class="line">  <span class="keyword">return</span> redis.<span class="keyword">call</span>(<span class="string">&#x27;DEL&#x27;</span>, KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- ä¸ä¸€è‡´ï¼Œåˆ™ç›´æ¥è¿”å›</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><h4 id="æ€»ç»“ä¸€å¥è¯">æ€»ç»“ä¸€å¥è¯</h4><blockquote><p>æŠŠâ€œåˆ¤æ–­æ˜¯ä¸æ˜¯è‡ªå·± + åˆ é™¤é”â€è¿™ä¸¤æ­¥æ”¾è¿› Lua è„šæœ¬ä¸­äº¤ç»™ Redis åŸå­æ‰§è¡Œï¼Œå½»åº•è§£å†³åˆ†å¸ƒå¼é”çš„å¹¶å‘å®‰å…¨é—®é¢˜ã€‚</p><h3 id="4-8-åˆ©ç”¨Javaä»£ç è°ƒç”¨Luaè„šæœ¬æ”¹é€ åˆ†å¸ƒå¼é”">4.8 åˆ©ç”¨Javaä»£ç è°ƒç”¨Luaè„šæœ¬æ”¹é€ åˆ†å¸ƒå¼é”</h3><p>åœ¨SimpleRedisLockä¸­å†™å…¥å¦‚ä¸‹çš„ä»£ç ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›çš„æ˜¯åœ¨ä¸€å¼€å§‹å°±å°†Luaçš„è„šæœ¬åŠ è½½å¥½ï¼Œè€Œä¸æ˜¯ç­‰åˆ°è¦è°ƒç”¨é‡Šæ”¾é”çš„æ—¶å€™å†å»åŠ è½½Luaè„šæœ¬ï¼Œæ‰€ä»¥é‡‡ç”¨é™æ€å˜é‡å’Œé™æ€ä»£ç å—ï¼Œè¿™äº›éƒ¨åˆ†åœ¨ç±»åˆå§‹åŒ–çš„æ—¶å€™å°±ä¼šè¢«åŠ è½½ï¼š</p></blockquote><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> DefaultRedisScript&lt;<span class="keyword">Long</span>&gt; UNLOCK_SCRIPT;</span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">     UNLOCK_SCRIPT = <span class="keyword">new</span> DefaultRedisScript&lt;&gt;();</span><br><span class="line">     UNLOCK_SCRIPT.setLocation(<span class="keyword">new</span> ClassPathResource(<span class="string">&quot;unlock.lua&quot;</span>));</span><br><span class="line">     UNLOCK_SCRIPT.setResultType(<span class="keyword">Long</span>.<span class="keyword">class</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è¯´æ˜ï¼š">è¯´æ˜ï¼š</h3><ul><li><code>DefaultRedisScript</code> æ˜¯ Spring æä¾›çš„ç±»ï¼›</li><li><code>setLocation</code> æ˜¯åŠ è½½ Lua è„šæœ¬æ–‡ä»¶ï¼›</li><li><code>setResultType</code> æ˜¯å‘Šè¯‰ Redis ä½ è¿™ä¸ªè„šæœ¬è¦è¿”å›ä»€ä¹ˆç±»å‹ã€‚</li></ul><blockquote><p>åœ¨SimpleRedisLockç±»çš„unlockæ–¹æ³•ä¸­å†™å…¥å¦‚ä¸‹çš„ä»£ç ï¼š</p><p>åœ¨ <code>SimpleRedisLock</code> çš„ <code>unlock()</code> æ–¹æ³•ä¸­ï¼Œæ›¿æ¢åŸæ¥çš„ delete é€»è¾‘ï¼š</p></blockquote><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Override</span></span><br><span class="line">public void <span class="built_in">unlock</span>() &#123;</span><br><span class="line">    <span class="selector-tag">stringRedisTemplate</span><span class="selector-class">.execute</span>(UNLOCK_SCRIPT,</span><br><span class="line">            Collections.<span class="built_in">singletonList</span>(KEY_PREFIX+name),</span><br><span class="line">            ID_PREFIX + Thread.<span class="built_in">currentThread</span>().<span class="built_in">getId</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç åœ¨æ‰§è¡Œ Lua è„šæœ¬æ—¶ï¼š</p><ul><li><code>KEYS[1] = lock:order:xxx</code>ï¼ˆé”çš„ keyï¼‰ï¼›</li><li><code>ARGV[1] = UUID-threadId</code>ï¼ˆé”çš„å€¼ï¼Œç”¨äºèº«ä»½éªŒè¯ï¼‰ï¼›</li></ul><p><strong>RedisTemplate æ˜¯å¦‚ä½•æ‰§è¡Œ Lua çš„ï¼Ÿ</strong></p><p>æˆ‘ä»¬çš„RedisTemplateä¸­ï¼Œå¯ä»¥åˆ©ç”¨executeæ–¹æ³•å»æ‰§è¡Œluaè„šæœ¬ï¼Œå‚æ•°å¯¹åº”å…³ç³»å°±å¦‚ä¸‹å›¾è‚¡</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-190-1024x476.png" alt="img"></p><p><strong>æµ‹è¯•é€»è¾‘ï¼š</strong></p><p>ç¬¬ä¸€ä¸ªçº¿ç¨‹è¿›æ¥ï¼Œå¾—åˆ°äº†é”ï¼Œæ‰‹åŠ¨åˆ é™¤é”ï¼Œæ¨¡æ‹Ÿé”è¶…æ—¶äº†ï¼Œå…¶ä»–çº¿ç¨‹ä¼šæ‰§è¡Œluaæ¥æŠ¢é”ï¼Œå½“ç¬¬ä¸€å¤©çº¿ç¨‹åˆ©ç”¨luaåˆ é™¤é”æ—¶ï¼Œluaèƒ½ä¿è¯ä»–ä¸èƒ½åˆ é™¤ä»–çš„é”ï¼Œç¬¬äºŒä¸ªçº¿ç¨‹åˆ é™¤é”æ—¶ï¼Œåˆ©ç”¨luaåŒæ ·å¯ä»¥ä¿è¯ä¸ä¼šåˆ é™¤åˆ«äººçš„é”ï¼ŒåŒæ—¶è¿˜èƒ½ä¿è¯åŸå­æ€§ã€‚</p><p>åœ¨ç¨‹åº1å’Œç¨‹åº2çš„ä¸‹é¢è¿™ä¸ªä½ç½®æ‰“ä¸Šæ–­ç‚¹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-191.png" alt="img"></p><p>åœ¨æµ‹è¯•APIä¸­æµ‹è¯•è®¿é—®å¦‚ä¸‹çš„URLï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>localhost:<span class="number">8080</span><span class="regexp">/api/</span>voucher-order<span class="regexp">/seckill/</span><span class="number">14</span></span><br></pre></td></tr></table></figure><p>åˆ†åˆ«æµ‹è¯•ç§’æ€ä¼˜æƒ åˆ¸1å’Œ2ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-192.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-193.png" alt="img"></p><p>åœ¨Redisä¸­èƒ½çœ‹åˆ°ç¨‹åº1è·å–é”æˆåŠŸï¼Œç„¶åç›´æ¥æŠŠlocké”åˆ æ‰ï¼Œæ¨¡æ‹Ÿè¶…æ—¶é‡Šæ”¾çš„æƒ…å†µï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-194.png" alt="img"></p><p>ç„¶åè®©ç¨‹åº2å¾€ä¸‹èµ°ä¸€æ­¥ï¼Œå¯ä»¥çœ‹åˆ°ç¨‹åº2è·å–åˆ°äº†é”</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-195.png" alt="img"></p><p>ç„¶åå¯ä»¥ç›´æ¥æ”¾è¡Œç¨‹åº1ï¼Œä¼šçœ‹åˆ°ç»“æœæ˜¯ç¨‹åº2åŠ çš„é”æ²¡æœ‰è¢«åˆ é™¤ã€‚</p><p>æœ€åæ”¾è¡Œç¨‹åº2ï¼Œä¼šçœ‹åˆ°ç¨‹åº2åŠ çš„é”è¢«åˆ é™¤ã€‚</p><p>å°æ€»ç»“ï¼š</p><p>åŸºäºRedisçš„åˆ†å¸ƒå¼é”å®ç°æ€è·¯ï¼š</p><ul><li>åˆ©ç”¨set nx exè·å–é”ï¼Œå¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¿å­˜çº¿ç¨‹æ ‡ç¤º</li><li>é‡Šæ”¾é”æ—¶å…ˆåˆ¤æ–­çº¿ç¨‹æ ‡ç¤ºæ˜¯å¦ä¸è‡ªå·±ä¸€è‡´ï¼Œä¸€è‡´åˆ™åˆ é™¤é”</li><li>ç‰¹æ€§ï¼š<ul><li>åˆ©ç”¨set nxæ»¡è¶³äº’æ–¥æ€§</li><li>åˆ©ç”¨set exä¿è¯æ•…éšœæ—¶é”ä¾ç„¶èƒ½é‡Šæ”¾ï¼Œé¿å…æ­»é”ï¼Œæé«˜å®‰å…¨æ€§</li><li>åˆ©ç”¨Redisé›†ç¾¤ä¿è¯é«˜å¯ç”¨å’Œé«˜å¹¶å‘ç‰¹æ€§</li></ul></li></ul><p>ç¬”è€…æ€»ç»“ï¼šæˆ‘ä»¬ä¸€è·¯èµ°æ¥ï¼Œåˆ©ç”¨æ·»åŠ è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢æ­»é”é—®é¢˜çš„å‘ç”Ÿï¼Œä½†æ˜¯æœ‰äº†è¿‡æœŸæ—¶é—´ä¹‹åï¼Œå¯èƒ½å‡ºç°è¯¯åˆ åˆ«äººé”çš„é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜æˆ‘ä»¬å¼€å§‹æ˜¯åˆ©ç”¨åˆ ä¹‹å‰ é€šè¿‡æ‹¿é”ï¼Œæ¯”é”ï¼Œåˆ é”è¿™ä¸ªé€»è¾‘æ¥è§£å†³çš„ï¼Œä¹Ÿå°±æ˜¯åˆ ä¹‹å‰åˆ¤æ–­ä¸€ä¸‹å½“å‰è¿™æŠŠé”æ˜¯å¦æ˜¯å±äºè‡ªå·±çš„ï¼Œä½†æ˜¯ç°åœ¨è¿˜æœ‰åŸå­æ€§é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ²¡æ³•ä¿è¯æ‹¿é”æ¯”é”åˆ é”æ˜¯ä¸€ä¸ªåŸå­æ€§çš„åŠ¨ä½œï¼Œæœ€åé€šè¿‡luaè¡¨è¾¾å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜</p><p>å·²ç»æŠŠ Redis åˆ†å¸ƒå¼é”ä»â€œèƒ½ç”¨â€ä¼˜åŒ–åˆ°â€œé«˜å¹¶å‘å¯å®‰å…¨ç”¨â€çš„ç‰ˆæœ¬ï¼Œä½¿ç”¨ Lua è„šæœ¬åœ¨ Java ä¸­åŸå­é‡Šæ”¾é”ï¼Œæ˜¯å®ç°è¿™ä¸€åˆ‡çš„å…³é”®ä¸€æ­¥ã€‚</p><p>ä½†æ˜¯ç›®å‰è¿˜å‰©ä¸‹ä¸€ä¸ªé—®é¢˜é”ä¸ä½ï¼Œä»€ä¹ˆæ˜¯é”ä¸ä½å‘¢ï¼Œä½ æƒ³ä¸€æƒ³ï¼Œå¦‚æœå½“è¿‡æœŸæ—¶é—´åˆ°äº†ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç»™ä»–ç»­æœŸä¸€ä¸‹ï¼Œæ¯”å¦‚ç»­ä¸ª30sï¼Œå°±å¥½åƒæ˜¯ç½‘å§ä¸Šç½‘ï¼Œ ç½‘è´¹åˆ°äº†ä¹‹åï¼Œç„¶åè¯´ï¼Œæ¥ï¼Œç½‘ç®¡ï¼Œå†ç»™æˆ‘æ¥10å—çš„ï¼Œæ˜¯ä¸æ˜¯åè¾¹çš„é—®é¢˜éƒ½ä¸ä¼šå‘ç”Ÿäº†ï¼Œé‚£ä¹ˆç»­æœŸé—®é¢˜æ€ä¹ˆè§£å†³å‘¢ï¼Œå¯ä»¥ä¾èµ–äºæˆ‘ä»¬æ¥ä¸‹æ¥è¦å­¦ä¹ redissionå•¦</p><h2 id="5ã€åˆ†å¸ƒå¼é”-redission">5ã€åˆ†å¸ƒå¼é”-redission</h2><h3 id="5-1-åˆ†å¸ƒå¼é”-redissionåŠŸèƒ½ä»‹ç»">5.1 åˆ†å¸ƒå¼é”-redissionåŠŸèƒ½ä»‹ç»</h3><p>åŸºäºsetnxå®ç°çš„åˆ†å¸ƒå¼é”å­˜åœ¨ä¸‹é¢çš„é—®é¢˜ï¼š</p><ol><li><strong>ä¸å¯é‡å…¥</strong></li></ol><ul><li><p>å«ä¹‰ï¼šåŒä¸€ä¸ªçº¿ç¨‹åœ¨è¿˜æ²¡é‡Šæ”¾é”æ—¶ï¼Œåˆæƒ³å†æ¬¡è·å–è¿™ä¸ªé”ï¼Œä¸èƒ½æˆåŠŸï¼ˆä¼šè¢«è‡ªå·±é˜»å¡ï¼‰ï¼›</p></li><li><p>ä¸¾ä¾‹ï¼šå°±åƒä½ åœ¨æ–¹æ³• A æ‹¿äº†é”ï¼Œç„¶åæ–¹æ³• A åˆè°ƒç”¨äº† Bï¼Œè€Œ B åˆè¦æ‹¿åŒä¸€æŠŠé”ï¼Œå°±æŒ‚ä½äº†ï¼›</p></li><li><p><strong>é£é™©</strong>ï¼šé€’å½’è°ƒç”¨/å¤šå±‚å°è£…ä¸‹å®¹æ˜“æ­»é”ï¼›</p></li><li><p><code>synchronized</code>/<code>ReentrantLock</code> æ˜¯å¯é‡å…¥çš„ï¼Œè€ŒåŸå§‹ Redis å®ç°ä¸æ˜¯ã€‚</p></li><li><p><strong>ä¸å¯é‡è¯•</strong></p></li><li><p>å«ä¹‰ï¼šè·å–å¤±è´¥ä¸€æ¬¡å°±æ”¾å¼ƒï¼Œæ²¡æœ‰â€œç­‰å¾…+é‡è¯•â€æœºåˆ¶ï¼›</p></li><li><p><strong>é—®é¢˜</strong>ï¼šå¹¶å‘ç¯å¢ƒä¸‹ï¼Œå¾ˆå¤šçº¿ç¨‹æŠ¢é”å¤±è´¥åç«‹åˆ»è¿”å›ï¼Œ<strong>ä¸èƒ½ç­‰å¾…æ’é˜Ÿ</strong>ï¼Œä¸šåŠ¡ä½“éªŒå·®ã€‚</p></li><li><p><strong>è¶…æ—¶é‡Šæ”¾æœ‰é£é™©</strong></p></li><li><p>åŠ é”æ—¶è®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢æ­»é”ï¼›</p></li><li><p><strong>ä½†</strong>ï¼šå¦‚æœä¸šåŠ¡æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œé”å…ˆè¿‡æœŸäº†ï¼›</p></li><li><p>åˆ«äººè¿›æ¥æŠ¢é”ï¼Œä½ ä¸šåŠ¡è¿˜æ²¡åšå®Œï¼›</p></li><li><p>å³ä½¿ä½ ç”¨ Lua åˆ¤æ–­ + åˆ é™¤ï¼Œä¹Ÿåªèƒ½é¿å…è¯¯åˆ ï¼Œä½†<strong>æ— æ³•ä¿è¯é”ä¸€å®šæœ‰æ•ˆåˆ°ä½ ä¸šåŠ¡çœŸæ­£æ‰§è¡Œå®Œæ¯•</strong>ï¼›</p></li><li><p><strong>ç»“è®º</strong>ï¼šéœ€è¦â€œé”ç»­æœŸæœºåˆ¶â€æ¥ä¿æŒé”æœ‰æ•ˆï¼</p></li><li><p><strong>ä¸»ä»ä¸€è‡´æ€§é—®é¢˜ï¼ˆåˆ†å¸ƒå¼é›†ç¾¤ï¼‰</strong></p></li><li><p>Redis ä½¿ç”¨ä¸»ä»é›†ç¾¤æ—¶ï¼Œå†™å…¥æ•°æ®æ˜¯å…ˆå†™ä¸»èŠ‚ç‚¹ï¼Œå†åŒæ­¥ç»™ä»èŠ‚ç‚¹ï¼›</p></li><li><p>å¦‚æœåœ¨å†™æˆåŠŸå‰ä¸»èŠ‚ç‚¹æŒ‚äº†ï¼Œä½†ä»èŠ‚ç‚¹æ²¡æœ‰æ‹¿åˆ°åŒæ­¥æ•°æ®ï¼Œ<strong>ä»èŠ‚ç‚¹ä¼šè®¤ä¸ºé”æ²¡è¢«åŠ ï¼Œå¯¼è‡´é”è¢«é‡å¤åŠ </strong>ï¼›</p></li><li><p><strong>ç»“æœï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›å…¥ä¸´ç•ŒåŒºï¼Œé”å½¢åŒè™šè®¾</strong>ï¼›</p></li><li><p>è¿™ä¸ªé—®é¢˜æ˜¯ Redis æœ¬èº«æ¶æ„çš„å¼±ç‚¹ï¼Œå•é ä½ æ‰‹å†™é€»è¾‘ä¸å¥½å¤„ç†ã€‚</p></li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-196.png" alt="img"></p><h4 id="æ€»ç»“ä¸€å¥è¯ï¼š">æ€»ç»“ä¸€å¥è¯ï¼š</h4><blockquote><p>è‡ªå·±å†™çš„ Redis åˆ†å¸ƒå¼é”ï¼Œè™½ç„¶èƒ½ç”¨ï¼Œä½†å­˜åœ¨ <strong>ä¸å¯é‡å…¥ã€ä¸å¯ç»­æœŸã€æ— æ’é˜Ÿã€ä¸ç¨³å®š</strong> ç­‰é—®é¢˜ï¼Œåœ¨çœŸæ­£ç”Ÿäº§ç¯å¢ƒé‡Œä¸å¤Ÿå¥å£®ã€‚</p></blockquote><p><strong>ä»€ä¹ˆæ˜¯Redissionå‘¢</strong></p><p>Redisson æ˜¯ä¸€ä¸ªåŸºäº Redis çš„ Java å®¢æˆ·ç«¯æ¡†æ¶ï¼Œå®ƒå°è£…äº†å¾ˆå¤šåˆ†å¸ƒå¼æœåŠ¡ï¼Œå…¶ä¸­åŒ…æ‹¬å„ç§ç±»å‹çš„ <strong>åˆ†å¸ƒå¼é”å®ç°</strong>ï¼Œè¿˜å¸¦æœ‰â€œè‡ªåŠ¨ç»­æœŸâ€ã€â€œå¯é‡å…¥â€ã€â€œå…¬å¹³é”â€ã€â€œè¯»å†™é”â€ç­‰é«˜çº§åŠŸèƒ½ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-203.png" alt="img"></p><h3 id="5-2-åˆ†å¸ƒå¼é”-Redissionå¿«é€Ÿå…¥é—¨">5.2 åˆ†å¸ƒå¼é”-Redissionå¿«é€Ÿå…¥é—¨</h3><p>ç¬¬1æ­¥ï¼Œå…ˆå¼•å…¥ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.redisson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>redisson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.13.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç¬¬2æ­¥ï¼Œåœ¨configåŒ…ä¸‹åˆ›å»ºRedissonConfigç±»ï¼Œå†™å…¥å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedissonConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    @<span class="function">Bean</span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> RedissonClient <span class="title">redissonClient</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// é…ç½®</span></span><br><span class="line">        Config config = <span class="keyword">new</span> <span class="built_in">Config</span>();</span><br><span class="line">        config.<span class="built_in">useSingleServer</span>().<span class="built_in">setAddress</span>(<span class="string">&quot;redis://192.168.150.101:6379&quot;</span>)</span><br><span class="line">            .<span class="built_in">setPassword</span>(<span class="string">&quot;123321&quot;</span>);</span><br><span class="line">        <span class="comment">// åˆ›å»ºRedissonClientå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> Redisson.<span class="built_in">create</span>(config);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="è¯´æ˜ï¼š-2">è¯´æ˜ï¼š</h3><ul><li>åˆ›å»ºå¹¶æ³¨å†Œ <code>RedissonClient</code> Beanï¼›</li><li>ä½¿ç”¨ <code>useSingleServer()</code> è¡¨ç¤ºä½ ä½¿ç”¨çš„æ˜¯å•æœº Redisï¼ˆåæœŸå¯ä»¥åˆ‡æ¢ä¸ºé›†ç¾¤æ¨¡å¼ï¼‰ï¼›</li><li>æ³¨æ„åœ°å€å‰ç¼€æ˜¯ <code>redis://</code>ï¼›</li><li>å¯†ç å¦‚æœ Redis æ²¡è®¾å¯ä»¥ä¸å†™ <code>.setPassword(...)</code>ã€‚</li></ul><p>ç¬¬3æ­¥ï¼Œå¼•å…¥RedissonClientï¼Œè°ƒç”¨getLockè·å–é”å¯¹è±¡ï¼Œç„¶åç”¨tryLockè·å–é”ã€‚</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@Resource</span><br><span class="line"><span class="keyword">private</span> RedissionClient redissonClient;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testRedisson</span>() throws Exception</span>&#123;</span><br><span class="line">    <span class="comment">//è·å–é”(å¯é‡å…¥)ï¼ŒæŒ‡å®šé”çš„åç§°</span></span><br><span class="line">    RLock <span class="keyword">lock</span> = redissonClient.getLock(<span class="string">&quot;anyLock&quot;</span>);</span><br><span class="line">    <span class="comment">//å°è¯•è·å–é”ï¼Œå‚æ•°åˆ†åˆ«æ˜¯ï¼šè·å–é”çš„æœ€å¤§ç­‰å¾…æ—¶é—´(æœŸé—´ä¼šé‡è¯•)ï¼Œé”è‡ªåŠ¨é‡Šæ”¾æ—¶é—´ï¼Œæ—¶é—´å•ä½</span></span><br><span class="line">    boolean isLock = <span class="keyword">lock</span>.tryLock(<span class="number">1</span>,<span class="number">10</span>,TimeUnit.SECONDS);</span><br><span class="line">    <span class="comment">//åˆ¤æ–­è·å–é”æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span>(isLock)&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            System.<span class="keyword">out</span>.println(<span class="string">&quot;æ‰§è¡Œä¸šåŠ¡&quot;</span>);          </span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            <span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line">            <span class="keyword">lock</span>.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜ï¼š</p><p><code>tryLock(1, 10, TimeUnit.SECONDS)</code>ï¼š</p><ul><li><strong>1 ç§’å†…å°è¯•è·å–é”</strong>ï¼ˆæŠ¢ä¸åˆ°å°±æ”¾å¼ƒï¼‰ï¼›</li><li>é”æŒæœ‰ <strong>10 ç§’åè‡ªåŠ¨é‡Šæ”¾</strong>ï¼›</li></ul><p><code>lock.unlock()</code>ï¼šå®‰å…¨é‡Šæ”¾é”ï¼Œé˜²æ­¢é˜»å¡ï¼›</p><p>Redisson å†…éƒ¨å·²ç»è‡ªåŠ¨å®ç°äº†çº¿ç¨‹æ ‡è¯†ã€é˜²è¯¯åˆ ã€è‡ªåŠ¨ç»­æœŸç­‰é€»è¾‘ã€‚</p><p>åœ¨ VoucherOrderServiceImpl</p><p>æ³¨å…¥RedissonClient</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> RedissonClient redissonClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="function">Result <span class="title">seckillVoucher</span><span class="params">(Long voucherId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1.æŸ¥è¯¢ä¼˜æƒ åˆ¸</span></span><br><span class="line">        SeckillVoucher voucher = seckillVoucherService.getById(voucherId);</span><br><span class="line">        <span class="comment">// 2.åˆ¤æ–­ç§’æ€æ˜¯å¦å¼€å§‹</span></span><br><span class="line">        <span class="keyword">if</span> (voucher.getBeginTime().isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">            <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">            <span class="function"><span class="keyword">return</span> Result.<span class="title">fail</span><span class="params">(<span class="string">&quot;ç§’æ€å°šæœªå¼€å§‹ï¼&quot;</span>)</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.åˆ¤æ–­ç§’æ€æ˜¯å¦å·²ç»ç»“æŸ</span></span><br><span class="line">        <span class="keyword">if</span> (voucher.getEndTime().isBefore(LocalDateTime.now())) &#123;</span><br><span class="line">            <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">            <span class="function"><span class="keyword">return</span> Result.<span class="title">fail</span><span class="params">(<span class="string">&quot;ç§’æ€å·²ç»ç»“æŸï¼&quot;</span>)</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class="line">        <span class="keyword">if</span> (voucher.getStock() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// åº“å­˜ä¸è¶³</span></span><br><span class="line">            <span class="function"><span class="keyword">return</span> Result.<span class="title">fail</span><span class="params">(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>)</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Long userId = UserHolder.getUser().getId();</span><br><span class="line">        <span class="comment">//åˆ›å»ºé”å¯¹è±¡ è¿™ä¸ªä»£ç ä¸ç”¨äº†ï¼Œå› ä¸ºæˆ‘ä»¬ç°åœ¨è¦ä½¿ç”¨åˆ†å¸ƒå¼é”</span></span><br><span class="line">        <span class="comment">//SimpleRedisLock lock = new SimpleRedisLock(&quot;order:&quot; + userId, stringRedisTemplate);</span></span><br><span class="line">        RLock lock = redissonClient.getLock(<span class="string">&quot;lock:order:&quot;</span> + userId);</span><br><span class="line">        <span class="comment">//è·å–é”å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">boolean</span> isLock = lock.tryLock();</span><br><span class="line">       </span><br><span class="line">        <span class="comment">//åŠ é”å¤±è´¥</span></span><br><span class="line">        <span class="keyword">if</span> (!isLock) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">return</span> Result.<span class="title">fail</span><span class="params">(<span class="string">&quot;ä¸å…è®¸é‡å¤ä¸‹å•&quot;</span>)</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//è·å–ä»£ç†å¯¹è±¡(äº‹åŠ¡)</span></span><br><span class="line">            IVoucherOrderService proxy = (IVoucherOrderService) AopContext.currentProxy();</span><br><span class="line">            <span class="function"><span class="keyword">return</span> proxy.<span class="title">createVoucherOrder</span><span class="params">(voucherId)</span></span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="è¯´æ˜ï¼š-3">è¯´æ˜ï¼š</h3><ul><li><code>lock:order:userId</code>ï¼šç»™æ¯ä¸ªç”¨æˆ·è®¾ç½®å”¯ä¸€çš„é”ï¼Œé˜²æ­¢åŒä¸€ç”¨æˆ·é‡å¤ä¸‹å•ï¼›</li><li>ä½¿ç”¨ <code>tryLock()</code> è·å–é”ï¼ˆé»˜è®¤ç«‹å³å°è¯•è·å–ä¸€æ¬¡ï¼‰ï¼›</li><li>Redisson è‡ªåŠ¨å¤„ç†ç»­æœŸå’Œçº¿ç¨‹éš”ç¦»ï¼ˆä¸éœ€è¦ä½ æ‰‹åŠ¨åˆ¤æ–­ UUID + çº¿ç¨‹ IDï¼‰ï¼›</li><li>é‡Šæ”¾é”ç›´æ¥è°ƒç”¨ <code>.unlock()</code>ï¼Œæ›´ç®€å•æ›´å®‰å…¨ã€‚</li></ul><p>ç¬¬4æ­¥ï¼Œå¯åŠ¨æœåŠ¡</p><p>å‘é€ä¸‹é¢çš„è¯·æ±‚ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-198.png" alt="img"></p><p>åœ¨æ‰§è¡Œé‡Šæ”¾é”çš„è¯­å¥å‰ï¼Œå¯ä»¥çœ‹åˆ°Redisä¸­æœ‰é”çš„è®°å½•ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-199.png" alt="img"></p><p>ç”¨jmeteræ¥æµ‹è¯•ï¼Œå¯ä»¥å‘ç°æ²¡æœ‰å‡ºç°å¹¶å‘å®‰å…¨é—®é¢˜ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-200.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-201.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-202.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-204.png" alt="img"></p><h3 id="5-3-åˆ†å¸ƒå¼é”-redissionå¯é‡å…¥é”åŸç†">5.3 åˆ†å¸ƒå¼é”-redissionå¯é‡å…¥é”åŸç†</h3><h4 id="5-3-1é‡å…¥é”çš„æ¦‚å¿µï¼ˆæœ¬åœ°é”å’Œåˆ†å¸ƒå¼é”é€šç”¨ï¼‰">5.3.1<strong>é‡å…¥é”çš„æ¦‚å¿µï¼ˆæœ¬åœ°é”å’Œåˆ†å¸ƒå¼é”é€šç”¨ï¼‰</strong></h4><p>å¯é‡å…¥é”ï¼ˆReentrant Lockï¼‰å…è®¸ <strong>åŒä¸€ä¸ªçº¿ç¨‹é‡å¤è·å–åŒä¸€æŠŠé”</strong>ã€‚</p><ul><li>ä¾‹å¦‚ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº†ä¸¤æ¬¡ <code>lock.lock()</code>ï¼Œåªè¦çº¿ç¨‹ä¸€è‡´ï¼Œä¸ä¼šæ­»é”ã€‚è§£é”æ—¶å¿…é¡»è§£é”ä¸¤æ¬¡æ‰å½»åº•é‡Šæ”¾ã€‚</li></ul><h4 id="5-3-2æœ¬åœ°é”ï¼ˆå¦‚-Java-ReentrantLockï¼‰çš„å®ç°æœºåˆ¶">5.3.2<strong>æœ¬åœ°é”ï¼ˆå¦‚ Java ReentrantLockï¼‰çš„å®ç°æœºåˆ¶</strong></h4><ul><li><p>é€šè¿‡ä¸€ä¸ª</p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatile <span class="keyword">state</span></span><br></pre></td></tr></table></figure><p>çŠ¶æ€å˜é‡æ§åˆ¶é‡å…¥æ¬¡æ•°ã€‚</p><ul><li>åˆå§‹çŠ¶æ€ï¼š<code>state = 0</code> è¡¨ç¤ºæ²¡äººæŒæœ‰ã€‚</li><li>ç¬¬ä¸€æ¬¡è·å–ï¼š<code>state = 1</code></li><li>åŒä¸€çº¿ç¨‹å†æ¬¡è·å–ï¼š<code>state += 1</code></li><li>æ¯æ¬¡é‡Šæ”¾ï¼š<code>state -= 1</code></li><li>å½“ <code>state == 0</code>ï¼Œé”é‡Šæ”¾æˆåŠŸã€‚</li></ul></li></ul><h4 id="5-3-3Redisson-å¯é‡å…¥åˆ†å¸ƒå¼é”å®ç°åŸç†">5.3.3<strong>Redisson å¯é‡å…¥åˆ†å¸ƒå¼é”å®ç°åŸç†</strong></h4><h4 id="1-Redis-ä¸­å¦‚ä½•å­˜å‚¨é”ï¼Ÿ">1. Redis ä¸­å¦‚ä½•å­˜å‚¨é”ï¼Ÿ</h4><ul><li><p>ä½¿ç”¨</p><p>Hash ç»“æ„</p><p>å­˜å‚¨ï¼š</p><ul><li>Keyï¼šé”çš„åç§°ï¼ˆå¦‚ <code>&quot;lock&quot;</code>ï¼‰</li><li>Fieldï¼ˆå°keyï¼‰ï¼š<code>UUID:ThreadId</code> è¡¨ç¤ºå“ªä¸ªçº¿ç¨‹æŒæœ‰é”</li><li>Valueï¼šé‡å…¥æ¬¡æ•°ï¼Œä¾‹å¦‚ <code>1</code> è¡¨ç¤ºåŠ é”äº†ä¸€æ¬¡</li></ul></li></ul><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lock &#123;</span><br><span class="line">  thread1 : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2.é”çš„è·å–é€»è¾‘</strong></p><p>æƒ…å†µ1ï¼šé”ä¸å­˜åœ¨ï¼Œç›´æ¥åŠ é”</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> redis.<span class="keyword">call</span>(<span class="string">&#x27;exists&#x27;</span>, KEYS[<span class="number">1</span>]) == <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">  redis.<span class="keyword">call</span>(<span class="string">&#x27;hset&#x27;</span>, KEYS[<span class="number">1</span>], ARGV[<span class="number">2</span>], <span class="number">1</span>);</span><br><span class="line">  redis.<span class="keyword">call</span>(<span class="string">&#x27;pexpire&#x27;</span>, KEYS[<span class="number">1</span>], ARGV[<span class="number">1</span>]);</span><br><span class="line">  <span class="keyword">return</span> nil;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ul><li>åˆ¤æ–­é”æ˜¯å¦å­˜åœ¨ï¼ˆ<code>exists</code>ï¼‰</li><li>å¦‚æœä¸å­˜åœ¨ï¼Œè®¾ç½® hash <code>field = threadId</code>ï¼Œå€¼ä¸º 1ï¼ˆåŠ é”ä¸€æ¬¡ï¼‰</li><li>è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆé˜²æ­¢æ­»é”ï¼‰</li><li>è¿”å› <code>nil</code>ï¼Œè¡¨ç¤ºåŠ é”æˆåŠŸ</li></ul><p>æƒ…å†µ2ï¼šé”å­˜åœ¨ï¼Œä¸”æ˜¯è‡ªå·±çº¿ç¨‹æŒæœ‰ï¼ˆå¯é‡å…¥ï¼‰</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if redis.call(<span class="string">&#x27;hexists&#x27;</span>, <span class="symbol">KEYS</span>[<span class="number">1</span>], <span class="symbol">ARGV</span>[<span class="number">2</span>]) == <span class="number">1</span> then</span><br><span class="line">  redis.call(<span class="string">&#x27;hincrby&#x27;</span>, <span class="symbol">KEYS</span>[<span class="number">1</span>], <span class="symbol">ARGV</span>[<span class="number">2</span>], <span class="number">1</span>);</span><br><span class="line">  redis.call(<span class="string">&#x27;pexpire&#x27;</span>, <span class="symbol">KEYS</span>[<span class="number">1</span>], <span class="symbol">ARGV</span>[<span class="number">1</span>]);</span><br><span class="line">  return nil;</span><br><span class="line">end</span><br></pre></td></tr></table></figure><ul><li>åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å·²æŒæœ‰ï¼ˆ<code>hexists</code>ï¼‰</li><li>å¦‚æœæ˜¯ï¼š<code>hincrby</code> é”è®¡æ•° +1</li><li>ç»­æœŸï¼ˆ<code>pexpire</code>ï¼‰</li><li>è¿”å› <code>nil</code> è¡¨ç¤ºåŠ é”æˆåŠŸï¼ˆé‡å…¥ï¼‰</li></ul><p>æƒ…å†µ3ï¼šé”è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">return</span> redis.<span class="title">call</span><span class="params">(<span class="string">&#x27;pttl&#x27;</span>, KEYS[<span class="number">1</span>])</span></span>;</span><br></pre></td></tr></table></figure><ul><li>è¿”å›å‰©ä½™è¿‡æœŸæ—¶é—´</li><li>Java ç«¯æ ¹æ®è¿”å›å€¼æ˜¯å¦æ˜¯ <code>null</code> åˆ¤æ–­æ˜¯å¦åŠ é”æˆåŠŸï¼Œå¦‚æœå¤±è´¥ä¼šè¿›è¡Œ <strong>è‡ªæ—‹é‡è¯•</strong>ï¼ˆwhile(true) å¾ªç¯ï¼‰</li></ul><p>å®Œæ•´ä»£ç </p><figure class="highlight scilab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;if (redis.call(&#x27;</span>exists&#x27;, KEYS[<span class="number">1</span>]) == <span class="number">0</span>) <span class="keyword">then</span> <span class="string">&quot; +</span></span><br><span class="line"><span class="string">                  &quot;</span>redis.call(<span class="string">&#x27;hset&#x27;</span>, KEYS[<span class="number">1</span>], ARGV[<span class="number">2</span>], <span class="number">1</span>); <span class="string">&quot; +</span></span><br><span class="line"><span class="string">                  &quot;</span>redis.call(<span class="string">&#x27;pexpire&#x27;</span>, KEYS[<span class="number">1</span>], ARGV[<span class="number">1</span>]); <span class="string">&quot; +</span></span><br><span class="line"><span class="string">                  &quot;</span><span class="keyword">return</span> nil; <span class="string">&quot; +</span></span><br><span class="line"><span class="string">              &quot;</span><span class="keyword">end</span>; <span class="string">&quot; +</span></span><br><span class="line"><span class="string">              &quot;</span><span class="keyword">if</span> (redis.call(<span class="string">&#x27;hexists&#x27;</span>, KEYS[<span class="number">1</span>], ARGV[<span class="number">2</span>]) == <span class="number">1</span>) <span class="keyword">then</span> <span class="string">&quot; +</span></span><br><span class="line"><span class="string">                  &quot;</span>redis.call(<span class="string">&#x27;hincrby&#x27;</span>, KEYS[<span class="number">1</span>], ARGV[<span class="number">2</span>], <span class="number">1</span>); <span class="string">&quot; +</span></span><br><span class="line"><span class="string">                  &quot;</span>redis.call(<span class="string">&#x27;pexpire&#x27;</span>, KEYS[<span class="number">1</span>], ARGV[<span class="number">1</span>]); <span class="string">&quot; +</span></span><br><span class="line"><span class="string">                  &quot;</span><span class="keyword">return</span> nil; <span class="string">&quot; +</span></span><br><span class="line"><span class="string">              &quot;</span><span class="keyword">end</span>; <span class="string">&quot; +</span></span><br><span class="line"><span class="string">              &quot;</span><span class="keyword">return</span> redis.call(<span class="string">&#x27;pttl&#x27;</span>, KEYS[<span class="number">1</span>]);<span class="string">&quot;</span></span><br></pre></td></tr></table></figure><p>5.3.4 é‡Šæ”¾é”çš„é€»è¾‘</p><ul><li>åˆ¤æ–­é”æ˜¯ä¸æ˜¯è‡ªå·±åŠ çš„ï¼ˆåˆ¤æ–­ field æ˜¯å¦æ˜¯è‡ªå·±ï¼‰</li><li><code>hincrby</code> æŠŠé”å€¼å‡1</li><li>å¦‚æœå‡å®Œä¸º0ï¼Œä½¿ç”¨ <code>del</code> åˆ é™¤æ•´ä¸ªé”</li><li>è‹¥ä¸æ˜¯è‡ªå·±çº¿ç¨‹ï¼ŒåŠ é”å¤±è´¥</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-205-1024x443.png" alt="img"></p><p>ä»£ç è¯´æ˜ï¼š</p><ul><li>ç¬¬ä¸€æ¬¡ <code>tryLock()</code> æˆåŠŸåï¼Œè°ƒç”¨ <code>method2()</code> å†åŠ ä¸€æ¬¡é”ï¼Œä¹ŸæˆåŠŸï¼Œä½“ç° <strong>å¯é‡å…¥æ€§</strong>ã€‚</li><li>æ¯æ¬¡ <code>unlock()</code> åªæ˜¯è®© <code>value -1</code>ï¼Œç›´åˆ°ä¸º0ï¼Œæ‰é‡Šæ”¾ Redis ä¸­çš„é”ã€‚</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-207-1024x514.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-206-1024x468.png" alt="img"></p><h3 id="5-4-åˆ†å¸ƒå¼é”-redissioné”é‡è¯•å’ŒWatchDogæœºåˆ¶">5.4 åˆ†å¸ƒå¼é”-redissioné”é‡è¯•å’ŒWatchDogæœºåˆ¶</h3><h4 id="5-4-1Redisson-åˆ†å¸ƒå¼é”ä¸­-tryLock-é‡è¯•-WatchDog-è‡ªåŠ¨ç»­æœŸçš„æºç æœºåˆ¶ã€‚">5.4.1Redisson åˆ†å¸ƒå¼é”ä¸­ tryLock é‡è¯• + WatchDog è‡ªåŠ¨ç»­æœŸçš„æºç æœºåˆ¶ã€‚</h4><p>ä¸‹é¢æ˜¯å¯¹å«æœ‰waitTimeï¼ˆç­‰å¾…æ—¶é—´ï¼‰çš„tryLockçš„è·Ÿè¸ªï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-208.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-209.png" alt="img"></p><p><strong>ä¸»é¢˜ï¼š<code>tryLock(long waitTime, TimeUnit unit)</code> çš„æºç è°ƒç”¨é“¾ + é»˜è®¤çœ‹é—¨ç‹—æ—¶é—´ä¸º 30 ç§’</strong></p><p>ä½ è°ƒç”¨çš„æ˜¯ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">tryLock</span><span class="params">(waitTime, unit)</span></span></span><br></pre></td></tr></table></figure><p>å®é™…ä¼šè°ƒç”¨é‡è½½æ–¹æ³•ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">tryLock</span><span class="params">(waitTime, -<span class="number">1</span>L, unit)</span></span> <span class="comment">// -1 è¡¨ç¤ºæœªæŒ‡å®šè¶…æ—¶æ—¶é—´</span></span><br></pre></td></tr></table></figure><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-210.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-211-1024x378.png" alt="img"></p><p>é‡ç‚¹å«ä¹‰ï¼š</p><p><code>leaseTime = -1</code> è§¦å‘ <strong>WatchDog çœ‹é—¨ç‹—æœºåˆ¶</strong></p><p>é»˜è®¤é…ç½® this.lockWatchdogTimeout = 30000L // 30ç§’</p><p>Lua è„šæœ¬è¯´æ˜</p><p>return redis.call(â€˜pttlâ€™, KEYS[1]);</p><ul><li>è¿”å›å½“å‰é”å‰©ä½™æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</li><li>å¦‚æœé”è¢«å ç”¨ï¼Œåˆ™ Redisson ç”¨è¿™ä¸ªå€¼åˆ¤æ–­æ˜¯å¦è‡ªæ—‹é‡è¯•</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-212.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-213.png" alt="img"></p><p><strong>ä¸»é¢˜ï¼šé”çš„è·å–æµç¨‹å’Œé‡Šæ”¾é”çš„ Lua è„šæœ¬å®ç°é€»è¾‘</strong></p><p>è·å–é”é€»è¾‘ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (ttl == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// åŠ é”æˆåŠŸ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦åˆ™è¿›å…¥å‰©ä½™æ—¶é—´åˆ¤æ–­ï¼šæ˜¯å¦è¿˜æœ‰ç­‰å¾…æœºä¼šã€‚</p><p>é‡Šæ”¾é”é€»è¾‘ï¼ˆRedis è„šæœ¬ï¼‰</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis.<span class="keyword">call</span>(<span class="string">&#x27;del&#x27;</span>, KEYS[<span class="number">1</span>]);</span><br><span class="line">redis.<span class="keyword">call</span>(<span class="string">&#x27;publish&#x27;</span>, KEYS[<span class="number">2</span>], ARGV[<span class="number">1</span>]); <span class="comment">// å‘å¸ƒè§£é”é€šçŸ¥</span></span><br></pre></td></tr></table></figure><p>å½“é”é‡Šæ”¾æ—¶ï¼Œé€šè¿‡ Redis <code>publish</code> å‘æ¶ˆæ¯ï¼Œé€šçŸ¥å…¶ä»–çº¿ç¨‹â€œé”å·²é‡Šæ”¾â€ï¼Œä»¥å”¤é†’å®ƒä»¬ç»§ç»­æŠ¢é”ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-214.png" alt="img"></p><p>è¯´æ˜ subscriberFuture.awaitï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">subscriberFuture.await(<span class="built_in">time</span>, TimeUnit.MILLISECONDS);</span><br></pre></td></tr></table></figure><ul><li>ç­‰å¾…ä¸€æ®µæ—¶é—´å†…æ˜¯å¦èƒ½æ”¶åˆ°é”é‡Šæ”¾çš„é€šçŸ¥ï¼ˆè®¢é˜…æ¨¡å¼ï¼‰</li><li>å¦‚æœ <code>false</code>ï¼Œè¡¨ç¤º<strong>è¶…æ—¶æœªæ”¶åˆ°é€šçŸ¥</strong></li></ul><p>åç»­ç»§ç»­æŠ¢é”ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">tryAcquire</span><span class="params">(waitTime, leaseTime, unit, threadId)</span></span></span><br></pre></td></tr></table></figure><p>ä¼šå†è°ƒç”¨è¿™ä¸ªæ–¹æ³•å°è¯•é‡æ–°è·å–é”ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-215.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-216.png" alt="img"></p><p>Redisson å¹¶éæ­»ç­‰ï¼Œè€Œæ˜¯ç»“åˆâ€œç­‰å¾…å‘å¸ƒ+ä¸»åŠ¨æŠ¢é”â€ï¼Œé¿å…èµ„æºæµªè´¹ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-217.png" alt="img"></p><p>ä¸»é¢˜ï¼šè§¦å‘ WatchDog ç»­æœŸçš„é€»è¾‘ï¼ˆé‡ç‚¹ï¼‰</p><p>æ¡ä»¶åˆ¤æ–­ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (leaseTime <span class="operator">=</span><span class="operator">=</span> -<span class="number">1</span>) // è¡¨ç¤ºæœªæŒ‡å®šé”æ—¶é—´</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆ Redisson å°†é»˜è®¤ä½¿ç”¨ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">getLockWatchdogTimeout</span><span class="params">()</span></span> = <span class="number">30</span>_000 ms</span><br></pre></td></tr></table></figure><p>æˆåŠŸåŠ é”åè°ƒç”¨ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">scheduleExpirationRenewal</span>(threadId); <span class="comment">// å¼€å¯ç»­çº¦æœºåˆ¶</span></span><br></pre></td></tr></table></figure><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-218.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-219.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-220.png" alt="img"></p><p>ä¸»é¢˜ï¼šWatchDog å®šæ—¶ä»»åŠ¡å¦‚ä½•æ¯ 10 ç§’è‡ªåŠ¨ç»­æœŸ</p><p>æ ¸å¿ƒé€»è¾‘ï¼š</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.<span class="built_in">int</span>ernalLockLeaseTime / <span class="number">3</span></span><br></pre></td></tr></table></figure><p>é»˜è®¤é”æ—¶é—´æ˜¯ 30 ç§’ï¼Œæ‰€ä»¥æ¯ <strong>10ç§’è°ƒç”¨ä¸€æ¬¡</strong> <code>renewExpiration()</code>ï¼Œå®ç°æŒç»­ç»­æœŸã€‚</p><p>Luaè„šæœ¬ä¸­çš„ç»­æœŸæ“ä½œï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis.<span class="keyword">call</span>(<span class="string">&#x27;pexpire&#x27;</span>, KEYS[<span class="number">1</span>], ARGV[<span class="number">1</span>]); <span class="comment">// ç»­æœŸé”æœ‰æ•ˆæ—¶é—´</span></span><br></pre></td></tr></table></figure><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-221.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-222.png" alt="img"></p><p>ä¸»é¢˜ï¼šå–æ¶ˆçœ‹é—¨ç‹—ç»­æœŸä»»åŠ¡ï¼ˆé‡Šæ”¾é”æ—¶è§¦å‘ï¼‰</p><p>è§£é”åè°ƒç”¨ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.cancelExpirationRenewal(threadId)</span><br></pre></td></tr></table></figure><ul><li>ä½œç”¨ï¼šåœæ­¢å®šæ—¶å™¨ï¼Œé‡Šæ”¾çº¿ç¨‹èµ„æº</li><li>åªæœ‰å½“é”çœŸæ­£é‡Šæ”¾æˆ–è€…çº¿ç¨‹ç»“æŸæ—¶ï¼Œæ‰ä¼šå–æ¶ˆç»­æœŸé€»è¾‘ï¼Œç¡®ä¿èµ„æºä¸æµªè´¹</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-223.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-224.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-225-1024x524.png" alt="img"></p><h4 id="åŠ é”é€»è¾‘æ€»ç»“ï¼š">åŠ é”é€»è¾‘æ€»ç»“ï¼š</h4><ul><li><p>ttl == null</p><p>ï¼šè·å–é”æˆåŠŸ</p><ul><li>leaseTime == -1ï¼šå¼€å¯è‡ªåŠ¨ç»­æœŸï¼ˆWatchDogï¼‰</li><li>leaseTime != -1ï¼šå®šæ—¶é‡Šæ”¾é”ï¼Œä¸ç»­æœŸ</li></ul></li><li><p>ttl != null</p><p>ï¼šè·å–é”å¤±è´¥</p><ul><li>å‰©ä½™æ—¶é—´ &gt; 0ï¼šè®¢é˜…è§£é”ä¿¡å·</li><li>ç­‰å¾…å¹¶åˆ¤æ–­æ˜¯å¦è¶…æ—¶ï¼Œè¿›è¡Œä¸‹ä¸€è½®å°è¯•</li></ul></li></ul><h4 id="è§£é”é€»è¾‘ï¼š">è§£é”é€»è¾‘ï¼š</h4><ul><li>æˆåŠŸé‡Šæ”¾åï¼Œ<code>publish</code> å‘å¸ƒæ¶ˆæ¯é€šçŸ¥ç­‰å¾…çº¿ç¨‹</li><li>å–æ¶ˆç»­çº¦ä»»åŠ¡ï¼Œæ¸…ç† <code>EXIPRATION_RENEWAL_MAP</code></li></ul><p><strong>æ€»ç»“ä¸€å¥è¯ï¼šRedisson åˆ†å¸ƒå¼é” = <code>Redis + Lua + Javaå®šæ—¶ä»»åŠ¡</code> å®ç°äº†ä¸€ä¸ª å¯é‡å…¥ã€è‡ªåŠ¨ç»­æœŸã€å¸¦å‘å¸ƒé€šçŸ¥æœºåˆ¶çš„åˆ†å¸ƒå¼é”ç³»ç»Ÿï¼Œå¥å£®ä¸”é«˜æ€§èƒ½ã€‚</strong></p><h4 id="5-4-2Redisson-çš„ä¸¤ç§åŠ é”æ–¹å¼">5.4.2Redisson çš„ä¸¤ç§åŠ é”æ–¹å¼</h4><p>Redisson çš„ <code>lock()</code> æ–¹æ³•åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p><table><thead><tr><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>lock(long leaseTime, TimeUnit unit)</code></td><td><strong>æŒ‡å®šé”çš„è¶…æ—¶æ—¶é—´</strong>ï¼Œä¸ä¼šå¯åŠ¨çœ‹é—¨ç‹—</td></tr><tr><td><code>lock()</code>ï¼ˆæ— å‚ï¼‰</td><td><strong>æœªæŒ‡å®šé”è¶…æ—¶æ—¶é—´</strong>ï¼ŒRedisson ä¼šè‡ªåŠ¨å¯åŠ¨ <strong>WatchDog</strong> å®šæ—¶ç»­çº¦æœºåˆ¶</td></tr></tbody></table><h4 id="5-4-3lock-åŠ é”æµç¨‹å›é¡¾">5.4.3lock() åŠ é”æµç¨‹å›é¡¾</h4><p>1.è·å–å½“å‰çº¿ç¨‹ ID</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">long threadId <span class="operator">=</span> Thread.currentThread().getId()<span class="comment">;</span></span><br></pre></td></tr></table></figure><p>2.å°è¯•åŠ é”ï¼ˆtryAcquireï¼‰</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Long</span> ttl = tryAcquire(-<span class="number">1</span>, leaseTime, unit, threadId);</span><br><span class="line"><span class="keyword">if</span> (ttl == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>; <span class="comment">// åŠ é”æˆåŠŸæˆ–é‡å…¥æˆåŠŸ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‹¥è¿”å›å€¼ä¸º <code>null</code>ï¼Œè¡¨ç¤ºåŠ é”æˆåŠŸï¼ˆæˆ–æ˜¯å½“å‰çº¿ç¨‹é‡å…¥ï¼‰<br>è‹¥è¿”å› <code>ttl</code>ï¼ˆè¿‡æœŸæ—¶é—´ï¼‰ï¼Œè¡¨ç¤ºé”è¢«å…¶ä»–çº¿ç¨‹å ç”¨ï¼Œè¿›å…¥ <code>while(true)</code> è‡ªæ—‹é‡è¯•é€»è¾‘</p><h4 id="5-4-4ä¸‰ç§åŠ é”åœºæ™¯é€»è¾‘åˆ¤æ–­ï¼ˆtryAcquire-å†…éƒ¨ï¼‰">5.4.4ä¸‰ç§åŠ é”åœºæ™¯é€»è¾‘åˆ¤æ–­ï¼ˆtryAcquire å†…éƒ¨ï¼‰</h4><table><thead><tr><th>æƒ…å†µ</th><th>Redis é€»è¾‘</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>é”ä¸å­˜åœ¨</td><td><code>hset</code> + <code>pexpire</code></td><td>ç›´æ¥åŠ é”æˆåŠŸ</td></tr><tr><td>é”æ˜¯å½“å‰çº¿ç¨‹æŒæœ‰</td><td><code>hincrby</code> + <code>pexpire</code></td><td>å¯é‡å…¥ï¼Œè®¡æ•°+1</td></tr><tr><td>é”å­˜åœ¨ï¼Œéå½“å‰çº¿ç¨‹</td><td>è¿”å›å‰©ä½™è¿‡æœŸæ—¶é—´</td><td>åŠ é”å¤±è´¥ï¼Œç­‰å¾…è‡ªæ—‹é‡è¯•</td></tr></tbody></table><h4 id="5-4-5-é‡è¯•æœºåˆ¶ï¼ˆå¾ªç¯æŠ¢é”ï¼‰">5.4.5 é‡è¯•æœºåˆ¶ï¼ˆå¾ªç¯æŠ¢é”ï¼‰</h4><p>å¦‚æœåˆå§‹åŠ é”å¤±è´¥ï¼Œä¼šè¿›å…¥ä»¥ä¸‹é€»è¾‘ï¼š</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    tryAcquire() <span class="comment">// ä¸æ–­å°è¯•è·å–é”</span></span><br><span class="line">    <span class="params">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Redisson ä¼šè‡ªæ—‹å°è¯•ï¼Œç›´åˆ°è·å–é”æˆåŠŸæˆ–è¶…æ—¶ã€‚</p><h4 id="5-4-6-çœ‹é—¨ç‹—æœºåˆ¶ï¼ˆWatchDogï¼‰">5.4.6 çœ‹é—¨ç‹—æœºåˆ¶ï¼ˆWatchDogï¼‰</h4><h4 id="é€‚ç”¨åœºæ™¯ï¼š">é€‚ç”¨åœºæ™¯ï¼š</h4><p>è°ƒç”¨ <code>lock()</code> <strong>æ— å‚</strong>ç‰ˆæœ¬æ—¶ï¼Œä¸æŒ‡å®š <code>leaseTime</code>ï¼ŒRedisson é»˜è®¤è®¾ç½®é”æœ‰æ•ˆæœŸä¸º <strong>30ç§’</strong>ï¼Œå¹¶ä¼šå¯åŠ¨ <strong>è‡ªåŠ¨ç»­æœŸæœºåˆ¶</strong>ã€‚</p><p>WatchDog å®ç°æ ¸å¿ƒé€»è¾‘ï¼š</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ttlRemainingFuture.onComplete<span class="function"><span class="params">((ttlRemaining, e) -&gt; &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">if</span> (ttlRemaining == <span class="literal">null</span>) &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        scheduleExpirationRenewal(threadId);</span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;)</span>;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœåŠ é”æˆåŠŸï¼Œå°±è°ƒç”¨ <code>scheduleExpirationRenewal()</code>ï¼Œè§¦å‘è‡ªåŠ¨ç»­æœŸã€‚</p><h4 id="5-4-7-ç»­çº¦æœºåˆ¶æºç åˆ†æï¼ˆrenewExpirationï¼‰">5.4.7 ç»­çº¦æœºåˆ¶æºç åˆ†æï¼ˆrenewExpirationï¼‰</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="built_in">void</span> <span class="title function_">renewExpiration</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// æ¯æ¬¡ç»­æœŸéƒ½ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼ˆ10ç§’åè§¦å‘ï¼‰</span></span><br><span class="line">    <span class="title class_">Timeout</span> task = commandExecutor.<span class="title function_">getConnectionManager</span>().<span class="title function_">newTimeout</span>(<span class="keyword">new</span> <span class="title class_">TimerTask</span>() &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">run</span>(<span class="params"><span class="title class_">Timeout</span> timeout</span>) &#123;</span><br><span class="line">            <span class="comment">// ä»æŒæœ‰é” -&gt; å†ç»­æœŸ30s</span></span><br><span class="line">            <span class="title function_">renewExpirationAsync</span>(threadId).<span class="title function_">onComplete</span>((res, e) -&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (res) &#123;</span><br><span class="line">                    <span class="title function_">renewExpiration</span>(); <span class="comment">// é€’å½’è®¾ç½®ä¸‹æ¬¡ç»­æœŸ</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, internalLockLeaseTime / <span class="number">3</span>, <span class="title class_">TimeUnit</span>.<span class="property">MILLISECONDS</span>); <span class="comment">// é»˜è®¤æ˜¯æ¯10ç§’æ‰§è¡Œä¸€æ¬¡ï¼ˆ30/3ï¼‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ•´ä½“è¿‡ç¨‹ï¼š">æ•´ä½“è¿‡ç¨‹ï¼š</h4><ol><li><strong>é»˜è®¤é”æœ‰æ•ˆæ—¶é—´ï¼š30ç§’</strong></li><li><strong>æ¯ 10 ç§’ï¼ˆ30/3ï¼‰å¯åŠ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ç»­æœŸ</strong></li><li>å¦‚æœçº¿ç¨‹è¿˜æ´»ç€ä¸”ä»æŒæœ‰é” â†’ é‡ç½®é”çš„è¿‡æœŸæ—¶é—´ä¸º 30ç§’</li><li>å¦‚æœçº¿ç¨‹æŒ‚äº†ï¼ˆå¦‚å®•æœºã€å¼‚å¸¸ï¼‰ â†’ ä¸å†ç»­æœŸï¼Œé”è‡ªåŠ¨è¿‡æœŸé‡Šæ”¾</li></ol><h4 id="5-4-8-æ€»ç»“ï¼šRedisson-é”çš„æ ¸å¿ƒæœºåˆ¶">5.4.8 æ€»ç»“ï¼šRedisson é”çš„æ ¸å¿ƒæœºåˆ¶</h4><table><thead><tr><th>æœºåˆ¶</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><code>tryAcquire()</code></td><td>å°è¯•åŠ é”é€»è¾‘ï¼Œåˆ¤æ–­é”çŠ¶æ€</td></tr><tr><td><code>while(true)</code></td><td>è‡ªæ—‹é‡è¯•æœºåˆ¶ï¼Œç›´åˆ°åŠ é”æˆåŠŸ</td></tr><tr><td><code>WatchDog</code>ï¼ˆçœ‹é—¨ç‹—ï¼‰</td><td>è‡ªåŠ¨ç»­æœŸï¼Œé˜²æ­¢é”æå‰é‡Šæ”¾</td></tr><tr><td><code>renewExpiration()</code></td><td>å¯åŠ¨å®šæ—¶ä»»åŠ¡æ¯ 10 ç§’ç»­ä¸€æ¬¡æœŸ</td></tr><tr><td>é”è‡ªåŠ¨é‡Šæ”¾</td><td>çº¿ç¨‹æŒ‚æ‰ä¸ä¼šç»­æœŸï¼Œé”30ç§’åè‡ªåŠ¨é‡Šæ”¾</td></tr></tbody></table><ul><li>çœ‹é—¨ç‹—æœºåˆ¶æ˜¯ <strong>çº¿ç¨‹æŒæœ‰é”è‡ªåŠ¨ç»­æœŸçš„ä¿éšœ</strong>ï¼›</li><li>ä½¿ç”¨ <code>lock()</code>ï¼ˆæ— å‚ï¼‰æ—¶ <strong>ä¸è¦æ‹…å¿ƒæ­»é”</strong>ï¼Œå³ä½¿å¿˜äº†é‡Šæ”¾é”ï¼Œ30ç§’åä¹Ÿä¼šé‡Šæ”¾ï¼›</li><li>ä¸ä¼  <code>leaseTime</code> æ‰ä¼šè§¦å‘ WatchDogï¼›</li><li>Redisson çš„é‡å…¥é”ä¾é  <code>Hashç»“æ„ + çº¿ç¨‹id + è®¡æ•°</code> å®ç°ã€‚</li></ul><h3 id="5-5-åˆ†å¸ƒå¼é”-redissioné”çš„MutiLockåŸç†">5.5 åˆ†å¸ƒå¼é”-redissioné”çš„MutiLockåŸç†</h3><p><strong>ä¸ºä»€ä¹ˆéœ€è¦ MultiLockï¼ŸRedisson é”ä¸¢å¤±çš„èƒŒæ™¯</strong></p><p>ä¸ºäº†æé«˜redisçš„å¯ç”¨æ€§ï¼Œæˆ‘ä»¬ä¼šæ­å»ºé›†ç¾¤æˆ–è€…ä¸»ä»ï¼Œç°åœ¨ä»¥ä¸»ä»ä¸ºä¾‹</p><p>ä¸»ä»åŒæ­¥å»¶è¿Ÿ + å®•æœºå¯¼è‡´é”ä¸¢å¤±</p><p>å›¾ä¸­æè¿°çš„æ˜¯ä»¥ä¸‹åœºæ™¯ï¼š</p><ol><li>Java åº”ç”¨å°è¯•è·å– Redis é”ï¼š<code>SET lock thread1 NX EX 10</code>ï¼ˆè®¾ç½®é”ï¼‰</li><li>é”æˆåŠŸè®¾ç½®åˆ° Redis <strong>ä¸»èŠ‚ç‚¹</strong>ï¼ˆMasterï¼‰</li><li>Redis ä¸»èŠ‚ç‚¹è¿˜æœªå°†é”åŒæ­¥åˆ°ä»èŠ‚ç‚¹ï¼ˆSlaveï¼‰</li><li>æ­¤æ—¶ä¸»èŠ‚ç‚¹å®•æœºäº†</li><li>Redis è‡ªåŠ¨ä» Slave ä¸­é€‰å‡ºä¸€ä¸ªæ–°çš„ Masterï¼ˆåŸæ¥çš„ä»èŠ‚ç‚¹ï¼‰</li><li>ç”±äºæ–° Master ä¸Š <strong>æ²¡æœ‰é”æ•°æ®</strong> â†’ é”ä¸¢å¤±ï¼ğŸ’¥</li></ol><p>è¿™æ„å‘³ç€ï¼š<strong>å³ä½¿ä½ åˆšåŠ å®Œé”ï¼Œé”ä¿¡æ¯ä¹Ÿå¯èƒ½å› ä¸ºä¸»ä»æœªåŒæ­¥å°±ä¸¢å¤±ï¼Œé€ æˆå¹¶å‘å®‰å…¨éšæ‚£ï¼</strong></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-226-1024x487.png" alt="img"></p><p>ä¸ºäº†é¿å…ä¸Šè¿°é”ä¸¢å¤±é—®é¢˜ï¼Œ<strong>Redisson æå‡ºäº† MultiLock</strong>ï¼Œä¹Ÿå«â€œå¤šèŠ‚ç‚¹é”â€æˆ–â€œè”åˆé”â€ã€‚</p><h4 id="MultiLock-æ ¸å¿ƒåŸç†ï¼š">MultiLock æ ¸å¿ƒåŸç†ï¼š</h4><ul><li>å¦‚æœä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹å¤±è´¥ï¼Œåˆ™å¤±è´¥çš„é”ä¼šå›æ»šå¹¶é‡Šæ”¾</li><li>åŒæ—¶å‘å¤šä¸ª Redis ä¸»èŠ‚ç‚¹åŠ é”ï¼ˆæ¯”å¦‚ Redis ä¸»æœºé›†ç¾¤ï¼‰</li><li>åªæœ‰ <strong>æ‰€æœ‰èŠ‚ç‚¹éƒ½åŠ é”æˆåŠŸ</strong>ï¼Œæ‰ç®—çœŸæ­£è·å–åˆ°é”</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-227-1024x371.png" alt="img"></p><p>é‚£ä¹ˆMutiLock åŠ é”åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç¬”è€…ç”»äº†ä¸€å¹…å›¾æ¥è¯´æ˜:å½“æˆ‘ä»¬å»è®¾ç½®äº†å¤šä¸ªé”æ—¶ï¼Œredissionä¼šå°†å¤šä¸ªé”æ·»åŠ åˆ°ä¸€ä¸ªé›†åˆä¸­ï¼Œç„¶åç”¨whileå¾ªç¯å»ä¸åœå»å°è¯•æ‹¿é”ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€ä¸ªæ€»å…±çš„åŠ é”æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´æ˜¯ç”¨éœ€è¦åŠ é”çš„ä¸ªæ•° * 1500ms ï¼Œå‡è®¾æœ‰3ä¸ªé”ï¼Œé‚£ä¹ˆæ—¶é—´å°±æ˜¯4500msï¼Œå‡è®¾åœ¨è¿™4500mså†…ï¼Œæ‰€æœ‰çš„é”éƒ½åŠ é”æˆåŠŸï¼Œ é‚£ä¹ˆæ­¤æ—¶æ‰ç®—æ˜¯åŠ é”æˆåŠŸï¼Œå¦‚æœåœ¨4500msæœ‰çº¿ç¨‹åŠ é”å¤±è´¥ï¼Œåˆ™ä¼šå†æ¬¡å»è¿›è¡Œé‡è¯•.</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/1653553093967-1-1024x311.png" alt="img"></p><ol><li>æ”¶é›†å¤šä¸ªé”</li></ol><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LockList.<span class="built_in">add</span>(lock1, lock2, lock3)</span><br></pre></td></tr></table></figure><ul><li>æ”¶é›†æ‰€æœ‰å¾…åŠ é”çš„ Redis å®ä¾‹</li><li>è®¾ç½®æ€»åŠ é”æ—¶é—´ï¼š</li></ul><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ€»è¶…æ—¶æ—¶é—´ <span class="operator">=</span> é”æ•°é‡ * <span class="number">1500</span>ms</span><br></pre></td></tr></table></figure><ul><li>ä¾‹å¦‚ï¼š3 ä¸ªé” â†’ è¶…æ—¶æ—¶é—´ä¸º 4500ms</li><li>åŠ é”æµç¨‹ï¼ˆä¼ªä»£ç ï¼‰ï¼š</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (tryLock(waitTime, leaseTime, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åŠ é”å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>éå†æ¯ä¸ªé”ï¼Œé€ä¸€å°è¯•åŠ é”</li></ol><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">lock</span> <span class="keyword">in</span> LockList) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        boolean locked = <span class="keyword">lock</span>.tryLock(<span class="number">4500</span>ms, <span class="number">-1</span>); <span class="comment">// -1ï¼šè¡¨ç¤ºè§¦å‘è‡ªåŠ¨ç»­æœŸ</span></span><br><span class="line">        <span class="keyword">if</span> (locked) &#123;</span><br><span class="line">            acquiredLocks.<span class="keyword">add</span>(<span class="keyword">lock</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">break</span>; <span class="comment">// åŠ é”å¤±è´¥ä¸­æ–­</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5-æˆåŠŸåˆ¤å®šæ¡ä»¶ï¼š">5. æˆåŠŸåˆ¤å®šæ¡ä»¶ï¼š</h4><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å¦‚æœ acquiredLocks.size == LockList.size <span class="comment">// æ‰€æœ‰é”éƒ½æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br></pre></td></tr></table></figure><h4 id="6-å¦‚æœæœ‰é”å¤±è´¥ï¼Œå›æ»šæ‰€æœ‰å·²è·å–çš„é”ï¼š">6. å¦‚æœæœ‰é”å¤±è´¥ï¼Œå›æ»šæ‰€æœ‰å·²è·å–çš„é”ï¼š</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unlockInner(acquiredLocks); <span class="comment">// é‡Šæ”¾æ‰€æœ‰å·²åŠ é”çš„èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br></pre></td></tr></table></figure><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-230.png" alt="img"></p><h2 id="6ã€ç§’æ€ä¼˜åŒ–">6ã€ç§’æ€ä¼˜åŒ–</h2><h3 id="6-1-ç§’æ€ä¼˜åŒ–-å¼‚æ­¥ç§’æ€æ€è·¯">6.1 ç§’æ€ä¼˜åŒ–-å¼‚æ­¥ç§’æ€æ€è·¯</h3><p>æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹ä¸‹å•æµç¨‹</p><p>å½“ç”¨æˆ·å‘èµ·è¯·æ±‚ï¼Œæ­¤æ—¶ä¼šè¯·æ±‚nginxï¼Œnginxä¼šè®¿é—®åˆ°tomcatï¼Œè€Œtomcatä¸­çš„ç¨‹åºï¼Œä¼šè¿›è¡Œä¸²è¡Œæ“ä½œï¼Œåˆ†æˆå¦‚ä¸‹å‡ ä¸ªæ­¥éª¤</p><ul><li>1ã€æŸ¥è¯¢ä¼˜æƒ å·</li><li>2ã€åˆ¤æ–­ç§’æ€åº“å­˜æ˜¯å¦è¶³å¤Ÿ</li><li>3ã€æŸ¥è¯¢è®¢å•</li><li>4ã€æ ¡éªŒæ˜¯å¦æ˜¯ä¸€äººä¸€å•</li><li>5ã€æ‰£å‡åº“å­˜</li><li>6ã€åˆ›å»ºè®¢å•</li></ul><p>åœ¨è¿™å…­æ­¥æ“ä½œä¸­ï¼Œåˆæœ‰å¾ˆå¤šæ“ä½œæ˜¯è¦å»æ“ä½œæ•°æ®åº“çš„ï¼Œè€Œä¸”è¿˜æ˜¯ä¸€ä¸ªçº¿ç¨‹ä¸²è¡Œæ‰§è¡Œï¼Œ è¿™æ ·å°±ä¼šå¯¼è‡´æˆ‘ä»¬çš„ç¨‹åºæ‰§è¡Œçš„å¾ˆæ…¢ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¼‚æ­¥ç¨‹åºæ‰§è¡Œï¼Œé‚£ä¹ˆå¦‚ä½•åŠ é€Ÿå‘¢ï¼Ÿ</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-231-1024x503.png" alt="img"></p><p>åŸå§‹ç§’æ€æµç¨‹ï¼ˆæœªä¼˜åŒ–ï¼‰</p><p>è¿™å¼ å›¾æè¿°çš„æ˜¯ä¼ ç»Ÿçš„ç§’æ€è¯·æ±‚å¤„ç†æµç¨‹ï¼š</p><p>æµç¨‹æ­¥éª¤ï¼š</p><ol><li>ç”¨æˆ·å‘èµ·ç§’æ€è¯·æ±‚ï¼Œè¯·æ±‚è¢« Nginx æ¥æ”¶å¹¶è½¬å‘åˆ° Tomcat</li><li>Tomcat ä¸­æ‰§è¡Œä¸²è¡Œé€»è¾‘ï¼ˆæ¯ä¸€æ­¥éƒ½è®¿é—®æ•°æ®åº“ï¼‰ï¼š<ul><li>æŸ¥è¯¢ä¼˜æƒ åˆ¸</li><li>åˆ¤æ–­åº“å­˜</li><li>æŸ¥è¯¢è®¢å•ï¼ˆæ˜¯å¦é‡å¤ï¼‰</li><li>æ ¡éªŒä¸€äººä¸€å•</li><li>æ‰£å‡åº“å­˜</li><li>åˆ›å»ºè®¢å•</li></ul></li></ol><p>é—®é¢˜ï¼š</p><ul><li>æ‰€æœ‰æ“ä½œéƒ½åœ¨ä¸»çº¿ç¨‹ä¸­ä¸²è¡Œæ‰§è¡Œï¼Œè®¿é—®æ•°æ®åº“é¢‘ç¹</li><li>è¯·æ±‚é«˜å³°æœŸï¼Œæ•°æ®åº“å‹åŠ›çˆ†ç‚¸ï¼Œå“åº”é€Ÿåº¦æ…¢</li><li>å®¹æ˜“å¼•å‘ <strong>è¶…å–</strong> æˆ– <strong>æ€§èƒ½ç“¶é¢ˆ</strong></li></ul><p>ä¼˜åŒ–æ–¹æ¡ˆï¼šæˆ‘ä»¬å°†è€—æ—¶æ¯”è¾ƒçŸ­çš„é€»è¾‘åˆ¤æ–­æ”¾å…¥åˆ°redisä¸­ï¼Œæ¯”å¦‚æ˜¯å¦åº“å­˜è¶³å¤Ÿï¼Œæ¯”å¦‚æ˜¯å¦ä¸€äººä¸€å•ï¼Œè¿™æ ·çš„æ“ä½œï¼Œåªè¦è¿™ç§é€»è¾‘å¯ä»¥å®Œæˆï¼Œå°±æ„å‘³ç€æˆ‘ä»¬æ˜¯ä¸€å®šå¯ä»¥ä¸‹å•å®Œæˆçš„ï¼Œæˆ‘ä»¬åªéœ€è¦è¿›è¡Œå¿«é€Ÿçš„é€»è¾‘åˆ¤æ–­ï¼Œæ ¹æœ¬å°±ä¸ç”¨ç­‰ä¸‹å•é€»è¾‘èµ°å®Œï¼Œæˆ‘ä»¬ç›´æ¥ç»™ç”¨æˆ·è¿”å›æˆåŠŸï¼Œ å†åœ¨åå°å¼€ä¸€ä¸ªçº¿ç¨‹ï¼Œåå°çº¿ç¨‹æ…¢æ…¢çš„å»æ‰§è¡Œqueueé‡Œè¾¹çš„æ¶ˆæ¯ï¼Œè¿™æ ·ç¨‹åºä¸å°±è¶…çº§å¿«äº†å—ï¼Ÿè€Œä¸”ä¹Ÿä¸ç”¨æ‹…å¿ƒçº¿ç¨‹æ± æ¶ˆè€—æ®†å°½çš„é—®é¢˜ï¼Œå› ä¸ºè¿™é‡Œæˆ‘ä»¬çš„ç¨‹åºä¸­å¹¶æ²¡æœ‰æ‰‹åŠ¨ä½¿ç”¨ä»»ä½•çº¿ç¨‹æ± ï¼Œå½“ç„¶è¿™é‡Œè¾¹æœ‰ä¸¤ä¸ªéš¾ç‚¹</p><p>ç¬¬ä¸€ä¸ªéš¾ç‚¹æ˜¯æˆ‘ä»¬æ€ä¹ˆåœ¨redisä¸­å»å¿«é€Ÿæ ¡éªŒä¸€äººä¸€å•ï¼Œè¿˜æœ‰åº“å­˜åˆ¤æ–­</p><p>ç¬¬äºŒä¸ªéš¾ç‚¹æ˜¯ç”±äºæˆ‘ä»¬æ ¡éªŒå’Œtomctä¸‹å•æ˜¯ä¸¤ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•çŸ¥é“åˆ°åº•å“ªä¸ªå•ä»–æœ€åæ˜¯å¦æˆåŠŸï¼Œæˆ–è€…æ˜¯ä¸‹å•å®Œæˆï¼Œä¸ºäº†å®Œæˆè¿™ä»¶äº‹æˆ‘ä»¬åœ¨redisæ“ä½œå®Œä¹‹åï¼Œæˆ‘ä»¬ä¼šå°†ä¸€äº›ä¿¡æ¯è¿”å›ç»™å‰ç«¯ï¼ŒåŒæ—¶ä¹Ÿä¼šæŠŠè¿™äº›ä¿¡æ¯ä¸¢åˆ°å¼‚æ­¥queueä¸­å»ï¼Œåç»­æ“ä½œä¸­ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªidæ¥æŸ¥è¯¢æˆ‘ä»¬tomcatä¸­çš„ä¸‹å•é€»è¾‘æ˜¯å¦å®Œæˆäº†ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-232-1024x484.png" alt="img"></p><p>å‰ç«¯è¯·æ±‚æµç¨‹å˜æ›´ï¼š</p><ol><li><p>ç”¨æˆ·è¯·æ±‚å‘é€åˆ° Nginx</p></li><li><p>Nginx å°†è¯·æ±‚å‘ç»™ Redis è¿›è¡Œ</p><p>å¿«é€Ÿåˆ¤æ–­</p><p>ï¼š</p><ul><li>ç§’æ€åº“å­˜æ˜¯å¦è¶³å¤Ÿ</li><li>æ˜¯å¦ä¸€äººä¸€å•</li></ul></li></ol><blockquote><p>3.è¿™ä¸¤ä¸ªé€»è¾‘åœ¨ Redis ä¸­æ‰§è¡Œï¼Œå“åº”æå¿«ï¼Œé¿å… Tomcat é˜»å¡ã€‚</p></blockquote><p>4.åå° Tomcat æ¶ˆè´¹æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ•°æ®ï¼Œæ‰§è¡ŒçœŸæ­£çš„ä¸‹å•æµç¨‹ï¼ˆæ…¢æ…¢å®Œæˆï¼‰</p><p>5.åˆ¤æ–­é€šè¿‡åï¼ŒRedis å°† <strong>userIdã€orderId ç­‰ä¿¡æ¯</strong> å­˜å…¥ <strong>æ¶ˆæ¯é˜Ÿåˆ—</strong></p><p>ä¼˜åŠ¿ï¼š</p><ul><li>é«˜å¹¶å‘ä¸‹ä¸ä¼šå‹å®æ•°æ®åº“</li><li>ç§’æ€æ“ä½œè¿‘ä¼¼â€œæ— é”â€ï¼Œååé«˜</li><li>ç”¨æˆ·ä½“éªŒå¥½ï¼ˆå¿«é€Ÿå“åº”ï¼‰</li><li>å¯æ‰©å±•æ€§å¼ºï¼ˆå¼‚æ­¥å¤„ç†æ˜“äºä¼¸ç¼©ï¼‰</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-233-1024x482.png" alt="img"></p><p>Redis Lua è„šæœ¬ä¿éšœ <strong>åº“å­˜åˆ¤æ–­ + ä¸€äººä¸€å•åˆ¤æ–­ + å†™å…¥çŠ¶æ€</strong> çš„<strong>åŸå­æ€§</strong>ï¼Œè¿™æ˜¯å…³é”®ï¼</p><p>Redis æ•°æ®ç»“æ„è®¾è®¡</p><table><thead><tr><th>Key</th><th>Value</th></tr></thead><tbody><tr><td><code>stock:vid:7</code></td><td>ç§’æ€åº“å­˜ï¼ˆä¾‹å¦‚100ï¼‰</td></tr><tr><td><code>order:vid:7</code></td><td>ç”¨æˆ·IDåˆ—è¡¨ï¼ˆå¦‚Set/Streamï¼‰è®°å½•ä¸‹å•äºº</td></tr></tbody></table><p>Lua è„šæœ¬é€»è¾‘å›¾ï¼ˆå·¦ä¸‹ï¼‰ï¼š</p><ol><li>åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³ï¼ˆ<code>if stock &lt;= 0</code>ï¼‰</li><li>åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å·²ä¸‹å•ï¼ˆæ˜¯å¦åœ¨ set é›†åˆä¸­ï¼‰</li><li>è‹¥å‡é€šè¿‡ï¼š<ul><li>æ‰£å‡åº“å­˜</li><li>å°†ç”¨æˆ·åŠ å…¥ set é›†åˆï¼ˆé˜²æ­¢é‡å¤ï¼‰</li><li>è¿”å›æˆåŠŸç  <code>0</code></li></ul></li></ol><p>åç»­å¤„ç†ï¼ˆå³ä¾§æµç¨‹ï¼‰ï¼š</p><ol><li>æ‰§è¡Œ Lua è„šæœ¬</li><li>å¦‚æœè¿”å›ç»“æœä¸º 0ï¼Œè¯´æ˜å¯ä»¥ä¸‹å•</li><li>å°† couponIdã€userIdã€orderId åŠ å…¥æ¶ˆæ¯é˜Ÿåˆ—</li><li>åå°çº¿ç¨‹æ¶ˆè´¹æ¶ˆæ¯ï¼Œæ‰§è¡ŒçœŸæ­£çš„ï¼š<ul><li>æ ¡éªŒåº“å­˜ï¼ˆå¯é€‰ï¼‰</li><li>åˆ›å»ºè®¢å•</li><li>æŒä¹…åŒ–å…¥æ•°æ®åº“</li></ul></li></ol><h3 id="6-2-ç§’æ€ä¼˜åŒ–-Rediså®Œæˆç§’æ€èµ„æ ¼åˆ¤æ–­">6.2 ç§’æ€ä¼˜åŒ–-Rediså®Œæˆç§’æ€èµ„æ ¼åˆ¤æ–­</h3><p>éœ€æ±‚ï¼š</p><ul><li>æ–°å¢ç§’æ€ä¼˜æƒ åˆ¸çš„åŒæ—¶ï¼Œå°†ä¼˜æƒ åˆ¸ä¿¡æ¯ä¿å­˜åˆ°Redisä¸­</li><li>åŸºäºLuaè„šæœ¬ï¼Œåˆ¤æ–­ç§’æ€åº“å­˜ã€ä¸€äººä¸€å•ï¼Œå†³å®šç”¨æˆ·æ˜¯å¦æŠ¢è´­æˆåŠŸ</li><li>å¦‚æœæŠ¢è´­æˆåŠŸï¼Œå°†ä¼˜æƒ åˆ¸idå’Œç”¨æˆ·idå°è£…åå­˜å…¥é˜»å¡é˜Ÿåˆ—</li><li>å¼€å¯çº¿ç¨‹ä»»åŠ¡ï¼Œä¸æ–­ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä¿¡æ¯ï¼Œå®ç°å¼‚æ­¥ä¸‹å•åŠŸèƒ½</li></ul><p>è¿™ä¸ªé˜¶æ®µæˆ‘ä»¬è¦å®ç°çš„æ˜¯ï¼š</p><table><thead><tr><th>åŠŸèƒ½</th><th>æŠ€æœ¯æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>ç§’æ€èµ„æ ¼åˆ¤æ–­ï¼ˆåº“å­˜ &amp; ä¸€äººä¸€å•ï¼‰</td><td>ä½¿ç”¨ Redis + Lua è„šæœ¬ï¼ŒåŸå­åˆ¤æ–­</td></tr><tr><td>å¼‚æ­¥ä¸‹å•å¤„ç†</td><td>Redis Stream é˜Ÿåˆ— + åå°çº¿ç¨‹æ¶ˆè´¹</td></tr><tr><td>å¿«é€Ÿå“åº”ç”¨æˆ·</td><td>Redis è„šæœ¬ç«‹å³è¿”å›ç»“æœï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰</td></tr><tr><td>å»¶è¿Ÿè½åº“</td><td>åå°çº¿ç¨‹æ ¹æ®æ¶ˆæ¯å†…å®¹æ‰§è¡ŒçœŸæ­£çš„ä¸‹å•æ“ä½œ</td></tr></tbody></table><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-234.png" alt="img"></p><p>åœ¨VoucherServiceImplçš„addSeckillVoucheræ–¹æ³•çš„æœ«å°¾æ·»åŠ ä¸‹é¢è¿™æ®µä»£ç æŠŠç§’æ€çš„åº“å­˜ä¿å­˜åˆ°Redisä¸­ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¿å­˜ç§’æ€çš„åº“å­˜åˆ°Redis</span></span><br><span class="line">stringRedisTemplate<span class="selector-class">.opsForValue</span>()<span class="selector-class">.set</span>(RedisConstants.SECKILL_STOCK_KEY +voucher.getId(),voucher<span class="selector-class">.getStock</span>()<span class="selector-class">.toString</span>());</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><ul><li><code>SECKILL_STOCK_KEY</code> å‰ç¼€å¸¸é‡ä¸º <code>&quot;seckill:stock:&quot;</code></li><li>Redis ä¸­ä¼šç”Ÿæˆä¸€ä¸ª Keyï¼Œä¾‹å¦‚ï¼š<code>seckill:stock:17</code>ï¼Œå€¼ä¸ºåº“å­˜æ•°é‡</li><li>ç›¸å½“äºç§’æ€åˆ¸ä¸€ä¸Šæ¶ï¼Œå°±æŠŠåº“å­˜åŒæ­¥åˆ°äº† Redis é‡Œï¼Œåç»­ä¸å†è®¿é—®æ•°æ®åº“åˆ¤æ–­åº“å­˜</li></ul><p>å‘é€è¯·æ±‚ï¼Œæ–°å¢ä¸€ä»½ä¼˜æƒ åˆ¸ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-236.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°åœ¨Redisä¸­è®°å½•äº†ä¼˜æƒ åˆ¸çš„è®°å½•ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-238.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-239.png" alt="img"></p><p>å®Œæ•´çš„VoucherServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSeckillVoucher</span><span class="params">(Voucher voucher)</span> &#123;</span><br><span class="line">    <span class="comment">// ä¿å­˜ä¼˜æƒ åˆ¸</span></span><br><span class="line">    save(voucher);</span><br><span class="line">    <span class="comment">// ä¿å­˜ç§’æ€ä¿¡æ¯</span></span><br><span class="line">    <span class="type">SeckillVoucher</span> <span class="variable">seckillVoucher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SeckillVoucher</span>();</span><br><span class="line">    seckillVoucher.setVoucherId(voucher.getId());</span><br><span class="line">    seckillVoucher.setStock(voucher.getStock());</span><br><span class="line">    seckillVoucher.setBeginTime(voucher.getBeginTime());</span><br><span class="line">    seckillVoucher.setEndTime(voucher.getEndTime());</span><br><span class="line">    seckillVoucherService.save(seckillVoucher);</span><br><span class="line">    <span class="comment">// ä¿å­˜ç§’æ€åº“å­˜åˆ°Redisä¸­</span></span><br><span class="line">    <span class="comment">//SECKILL_STOCK_KEY è¿™ä¸ªå˜é‡å®šä¹‰åœ¨RedisConstansä¸­</span></span><br><span class="line">    <span class="comment">//private static final String SECKILL_STOCK_KEY =&quot;seckill:stock:&quot;</span></span><br><span class="line">    stringRedisTemplate.opsForValue().set(SECKILL_STOCK_KEY + voucher.getId(), voucher.getStock().toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œæ•´luaè¡¨è¾¾å¼</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1.å‚æ•°åˆ—è¡¨</span></span><br><span class="line"><span class="comment">-- 1.1.ä¼˜æƒ åˆ¸id</span></span><br><span class="line"><span class="keyword">local</span> voucherId = ARGV[<span class="number">1</span>]</span><br><span class="line"><span class="comment">-- 1.2.ç”¨æˆ·id</span></span><br><span class="line"><span class="keyword">local</span> userId = ARGV[<span class="number">2</span>]</span><br><span class="line"><span class="comment">-- 1.3.è®¢å•id</span></span><br><span class="line"><span class="keyword">local</span> orderId = ARGV[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2.æ•°æ®key</span></span><br><span class="line"><span class="comment">-- 2.1.åº“å­˜key</span></span><br><span class="line"><span class="keyword">local</span> stockKey = <span class="string">&#x27;seckill:stock:&#x27;</span> .. voucherId</span><br><span class="line"><span class="comment">-- 2.2.è®¢å•key</span></span><br><span class="line"><span class="keyword">local</span> orderKey = <span class="string">&#x27;seckill:order:&#x27;</span> .. voucherId</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3.è„šæœ¬ä¸šåŠ¡</span></span><br><span class="line"><span class="comment">-- 3.1.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³ get stockKey</span></span><br><span class="line"><span class="keyword">if</span>(tonumber(redis.<span class="keyword">call</span>(<span class="string">&#x27;get&#x27;</span>, stockKey)) &lt;= <span class="number">0</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- 3.2.åº“å­˜ä¸è¶³ï¼Œè¿”å›1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- 3.2.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸‹å• SISMEMBER orderKey userId</span></span><br><span class="line"><span class="keyword">if</span>(redis.<span class="keyword">call</span>(<span class="string">&#x27;sismember&#x27;</span>, orderKey, userId) == <span class="number">1</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- 3.3.å­˜åœ¨ï¼Œè¯´æ˜æ˜¯é‡å¤ä¸‹å•ï¼Œè¿”å›2</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- 3.4.æ‰£åº“å­˜ incrby stockKey -1</span></span><br><span class="line">redis.<span class="keyword">call</span>(<span class="string">&#x27;incrby&#x27;</span>, stockKey, <span class="number">-1</span>)</span><br><span class="line"><span class="comment">-- 3.5.ä¸‹å•ï¼ˆä¿å­˜ç”¨æˆ·ï¼‰sadd orderKey userId</span></span><br><span class="line">redis.<span class="keyword">call</span>(<span class="string">&#x27;sadd&#x27;</span>, orderKey, userId)</span><br><span class="line"><span class="comment">-- 3.6.å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ä¸­ï¼Œ XADD stream.orders * k1 v1 k2 v2 ...</span></span><br><span class="line">redis.<span class="keyword">call</span>(<span class="string">&#x27;xadd&#x27;</span>, <span class="string">&#x27;stream.orders&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;userId&#x27;</span>, userId, <span class="string">&#x27;voucherId&#x27;</span>, voucherId, <span class="string">&#x27;id&#x27;</span>, orderId)</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><h4 id="è§£æä¸€ä¸‹è¿™ä¸ªluaè„šæ­¥">è§£æä¸€ä¸‹è¿™ä¸ªluaè„šæ­¥</h4><p>ï¼ˆ1ï¼‰<strong>åˆ¤æ–­åº“å­˜æ˜¯å¦è¶³å¤Ÿ</strong></p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">tonumber</span>(redis.call(<span class="string">&#x27;get&#x27;</span>, stockKey)) &lt;= <span class="number">0</span> <span class="keyword">then</span> <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">end</span></span><br></pre></td></tr></table></figure><ul><li>åº“å­˜ä¸è¶³è¿”å› 1ï¼Œç»“æŸé€»è¾‘</li></ul><p>ï¼ˆ2ï¼‰<strong>åˆ¤æ–­æ˜¯å¦é‡å¤ä¸‹å•</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> redis.<span class="keyword">call</span>(<span class="string">&#x27;sismember&#x27;</span>, orderKey, userId) == <span class="number">1</span> <span class="keyword">then</span> <span class="keyword">return</span> <span class="number">2</span> <span class="keyword">end</span></span><br></pre></td></tr></table></figure><ul><li><code>orderKey</code> æ˜¯ <code>seckill:order:&lt;voucherId&gt;</code>ï¼Œç”¨ Set ä¿å­˜å·²ä¸‹å•ç”¨æˆ·</li></ul><p>ï¼ˆ3ï¼‰<strong>æ‰£åº“å­˜ã€è®°å½•ä¸‹å•ç”¨æˆ·</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis.<span class="built_in">call</span>(<span class="string">&#x27;incrby&#x27;</span>, stockKey, <span class="number">-1</span>)</span><br><span class="line">redis.<span class="built_in">call</span>(<span class="string">&#x27;sadd&#x27;</span>, orderKey, userId)</span><br></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰<strong>å†™å…¥æ¶ˆæ¯é˜Ÿåˆ— Stream</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis.<span class="built_in">call</span>(<span class="string">&#x27;xadd&#x27;</span>, <span class="string">&#x27;stream.orders&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;userId&#x27;</span>, userId, <span class="string">&#x27;voucherId&#x27;</span>, voucherId, <span class="string">&#x27;id&#x27;</span>, orderId)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ Redis Stream ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œåç»­åå°çº¿ç¨‹ä»è¿™é‡Œæ¶ˆè´¹æ•°æ®ï¼Œå®ç°å¼‚æ­¥ä¸‹å•ã€‚</p><p>å½“ä»¥ä¸Šluaè¡¨è¾¾å¼æ‰§è¡Œå®Œæ¯•åï¼Œå‰©ä¸‹çš„å°±æ˜¯æ ¹æ®æ­¥éª¤3,4æ¥æ‰§è¡Œæˆ‘ä»¬æ¥ä¸‹æ¥çš„ä»»åŠ¡äº†</p><p>VoucherOrderServiceImpl</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="function">Result <span class="title">seckillVoucher</span><span class="params">(Long voucherId)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//è·å–ç”¨æˆ·</span></span><br><span class="line">    Long userId = UserHolder.getUser().getId();</span><br><span class="line">    <span class="keyword">long</span> orderId = redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">    <span class="comment">// 1.æ‰§è¡Œluaè„šæœ¬</span></span><br><span class="line">    Long result = stringRedisTemplate.execute(</span><br><span class="line">            SECKILL_SCRIPT,</span><br><span class="line">            Collections.emptyList(),</span><br><span class="line">            voucherId.toString(), userId.toString(), String.valueOf(orderId)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">int</span> r = result.intValue();</span><br><span class="line">    <span class="comment">// 2.åˆ¤æ–­ç»“æœæ˜¯å¦ä¸º0</span></span><br><span class="line">    <span class="keyword">if</span> (r != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 2.1.ä¸ä¸º0 ï¼Œä»£è¡¨æ²¡æœ‰è´­ä¹°èµ„æ ¼</span></span><br><span class="line">        <span class="function"><span class="keyword">return</span> Result.<span class="title">fail</span><span class="params">(r == <span class="number">1</span> ? <span class="string">&quot;åº“å­˜ä¸è¶³&quot;</span> : <span class="string">&quot;ä¸èƒ½é‡å¤ä¸‹å•&quot;</span>)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//TODO ä¿å­˜é˜»å¡é˜Ÿåˆ—</span></span><br><span class="line">    <span class="comment">// 3.è¿”å›è®¢å•id</span></span><br><span class="line">    <span class="function"><span class="keyword">return</span> Result.<span class="title">ok</span><span class="params">(orderId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è„šæœ¬æ‰§è¡Œåè¿”å›å€¼å«ä¹‰ï¼š</p><table><thead><tr><th>è¿”å›å€¼</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>1</code></td><td>åº“å­˜ä¸è¶³</td></tr><tr><td><code>2</code></td><td>é‡å¤ä¸‹å•</td></tr><tr><td><code>0</code></td><td>æœ‰ç§’æ€èµ„æ ¼ï¼ŒæˆåŠŸå…¥é˜Ÿï¼Œå¼‚æ­¥ä¸‹å•ä¸­</td></tr></tbody></table><p>æµ‹è¯•ï¼š</p><p>åœ¨Apifoxä¸­å‘é€æµ‹è¯•æ•°æ®ï¼Œç§’æ€ä¸‹å•ï¼ŒæˆåŠŸåè¿”å›è®¢å•idï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-240-1024x601.png" alt="img"></p><p>åœ¨Redisä¸­åº“å­˜æˆåŠŸæ‰£å‡1ï¼Œorderæœ‰ç¼“å­˜</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-241.png" alt="img"></p><p>å¦‚æœå†æ¬¡å‘é€ä¼šæç¤ºä¸èƒ½é‡å¤ä¸‹å•ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-242-1024x600.png" alt="img"></p><p>å‡†å¤‡åœ¨Jemeterä¸­æµ‹è¯•ï¼Œé¦–å…ˆæŠŠç¼“å­˜ä¸­çš„ä¼˜æƒ åˆ¸åº“å­˜æ”¹ä¸º200ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-243.png" alt="img"></p><p>æµ‹è¯•ååº“å­˜å‡ä¸º0ï¼Œæ–°å¢200æ¡è®¢å•è®°å½•ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-244.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-245.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°å¹³å‡å“åº”æ—¶é—´å‡å°‘10å€ï¼Œæœ€å¿«å“åº”æ—¶é—´å‡å°‘60å€ï¼Œæœ€å¤§å“åº”æ—¶é—´ç¼©çŸ­ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-246-1024x491.png" alt="img"></p><h3 id="6-3-ç§’æ€ä¼˜åŒ–-åŸºäºé˜»å¡é˜Ÿåˆ—å®ç°ç§’æ€ä¼˜åŒ–">6.3 ç§’æ€ä¼˜åŒ–-åŸºäºé˜»å¡é˜Ÿåˆ—å®ç°ç§’æ€ä¼˜åŒ–</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-235.png" alt="img"></p><p>é˜»å¡é˜Ÿåˆ—ï¼šå°è¯•ä»é˜Ÿåˆ—è·å–å…ƒç´ ï¼Œå¦‚æœæ²¡æœ‰å…ƒç´ ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰å…ƒç´ æ‰ä¼šè¢«å”¤é†’ï¼Œè·å–å…ƒç´ ã€‚</p><p>åªè¦ç±»ä¸€å¯åŠ¨ï¼Œç”¨æˆ·éšæ—¶éƒ½æœ‰å¯èƒ½æ¥æŠ¢è´­ï¼Œå› æ­¤VoucherOrderHandlerè¿™ä¸ªç±»çš„åˆå§‹åŒ–å¿…é¡»åœ¨ç±»åˆå§‹åŒ–åæ‰§è¡Œã€‚</p><p>åœ¨VoucherOrderServiceImplç±»ä¸­ï¼Œé¦–å…ˆè¦æ–°å¢ä¸€ä¸ªorderTasksé˜»å¡é˜Ÿåˆ—ï¼Œç„¶åè®¾ç½®ä¸€ä¸ªçº¿ç¨‹æ± å’Œrunæ–¹æ³•ã€‚</p><p>åœ¨runæ–¹æ³•ä¸­è°ƒç”¨é˜»å¡é˜Ÿåˆ—çš„takeæ–¹æ³•ï¼ŒorderTasks.takeæ–¹æ³•æ˜¯ä¸€ä¸ªé˜»å¡æ–¹æ³•ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­æœ‰å…ƒç´ ä¼šè·å–ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­æ— å…ƒç´ åˆ™é˜»å¡ç­‰å¾…ã€‚</p><p>è¿™é‡Œç›¸å½“äºæ˜¯å¼€å¯äº†ä¸€ä¸ªå…¨æ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œè·å–é˜Ÿåˆ—ä¸­è®¢å•ä¿¡æ¯å’Œå¼‚æ­¥åˆ›å»ºè®¢å•çš„ä»»åŠ¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> BlockingQueue&lt;VoucherOrder&gt; orderTasks = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">1024</span>*<span class="number">1024</span>);</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">ExecutorService</span> <span class="variable">seckill_order_executor</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line"><span class="comment">/**orderTasks æ˜¯ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ï¼Œç”¨æ¥å­˜å‚¨å¾…å¤„ç†çš„è®¢å•ã€‚seckill_order_executor æ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„æ‰§è¡Œå™¨ï¼Œç”¨æ¥å¤„ç†é˜Ÿåˆ—ä¸­çš„è®¢å•ä»»åŠ¡ã€‚**/</span></span><br><span class="line"><span class="meta">@PostConstruct</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">    seckill_order_executor.submit(<span class="keyword">new</span> <span class="title class_">VoucherOrderHandler</span>());</span><br><span class="line">&#125;<span class="comment">//åœ¨ @PostConstruct æ³¨è§£çš„æ–¹æ³•ä¸­ï¼Œå¯åŠ¨äº†ä¸€ä¸ªæ–°çº¿ç¨‹æ¥ä¸æ–­åœ°ä»é˜Ÿåˆ—ä¸­å–å‡ºè®¢å•ä¿¡æ¯å¹¶å¤„ç†ï¼š</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">VoucherOrderHandler</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//1.è·å–é˜Ÿåˆ—ä¸­çš„è®¢å•ä¿¡æ¯</span></span><br><span class="line">                <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> orderTasks.take();</span><br><span class="line">                <span class="comment">//2.åˆ›å»ºè®¢å•</span></span><br><span class="line">                handleVoucherOrder(voucherOrder);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;å¤„ç†è®¢å•å¼‚å¸¸&quot;</span>,e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//take() æ–¹æ³•æ˜¯é˜»å¡çš„ï¼Œåªæœ‰é˜Ÿåˆ—ä¸­æœ‰å…ƒç´ æ—¶æ‰ä¼šè¿”å›ï¼Œå¦‚æœæ²¡æœ‰å…ƒç´ ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰æ–°å…ƒç´ åŠ å…¥é˜Ÿåˆ—ã€‚</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ–°å¢ä¸€ä¸ªhandleVoucherOrderæ–¹æ³•ï¼Œï¼Œé¦–å…ˆé€šè¿‡ <strong>Redisson åˆ†å¸ƒå¼é”</strong> æ¥ç¡®ä¿ <strong>ä¸€äººä¸€å•</strong> é€»è¾‘çš„åŸå­æ€§ï¼Œé˜²æ­¢åŒä¸€ä¸ªç”¨æˆ·å¤šæ¬¡ä¸‹å•ã€‚ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> IVoucherOrderService proxy ;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handleVoucherOrder</span>(<span class="params">VoucherOrder voucherOrder</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//1.è·å–ç”¨æˆ·</span></span><br><span class="line">    Long userId = voucherOrder.getUserId();</span><br><span class="line">    <span class="comment">//2.åˆ›å»ºé”å¯¹è±¡</span></span><br><span class="line">    RLock <span class="keyword">lock</span> = redissonClient.getLock(<span class="string">&quot;lock:order:&quot;</span>+userId);</span><br><span class="line">    <span class="comment">//3.è·å–é”</span></span><br><span class="line">    boolean isLock = <span class="keyword">lock</span>.tryLock();</span><br><span class="line">    <span class="comment">//4.åˆ¤æ–­æ˜¯å¦è·å–é”æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span>(!isLock) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;ä¸å…è®¸é‡å¤ä¸‹å•&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//è·å–ä»£ç†å¯¹è±¡</span></span><br><span class="line">        proxy.createVoucherOrder(voucherOrder);</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">lock</span>.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è·å–é”åï¼Œè°ƒç”¨ <code>createVoucherOrder</code> æ–¹æ³•æ¥æ‰£å‡åº“å­˜å¹¶ä¿å­˜è®¢å•ã€‚</li><li>å¦‚æœé”è·å–å¤±è´¥ï¼Œè¯´æ˜è¯¥ç”¨æˆ·å·²ç»ä¸‹å•ï¼Œç›´æ¥è¿”å›ã€‚</li></ul><p>createVoucherOrderæ–¹æ³•ä¸»è¦æ˜¯ç”¨æ¥å¯¹æ•°æ®åº“æ“ä½œï¼Œæ¯”å¦‚æ‰£å‡åº“å­˜ï¼Œç„¶åä¿å­˜è®¢å•çš„ä¿¡æ¯åˆ°æ•°æ®åº“ï¼Œä¼šæœ‰é¢å¤–çš„å¯¹ä¸€äººä¸€å•å’Œåº“å­˜æ•°é‡çš„åˆ¤æ–­ï¼Œè™½ç„¶è¿™äº›åœ¨Redisä¸­å·²ç»åˆ¤æ–­è¿‡ï¼Œä½†è¿™é‡Œæ˜¯åŒé‡ä¿é™©ã€‚</p><p>å¼‚æ­¥å¤„ç†ä¸éœ€è¦å†è¿”å›ç»™å‰ç«¯ä»»ä½•ä¸œè¥¿ã€‚</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">@Transactional</span><br><span class="line">public void createVoucherOrder(VoucherOrder voucherOrder) &#123;</span><br><span class="line">    <span class="comment">//6.ä¸€äººä¸€å•</span></span><br><span class="line">    Long userId = voucherOrder.getUserId();</span><br><span class="line">    <span class="comment">//6.1æŸ¥è¯¢è®¢å•</span></span><br><span class="line">    int <span class="keyword">count</span> = <span class="keyword">query</span>().<span class="keyword">eq</span>(<span class="string">&quot;user_id&quot;</span>, userId).<span class="keyword">eq</span>(<span class="string">&quot;voucher_id&quot;</span>, voucherOrder.getVoucherId()).<span class="keyword">count</span>();</span><br><span class="line">    <span class="comment">//6.2åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">count</span>&gt;0)&#123;</span><br><span class="line">        <span class="comment">//ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†</span></span><br><span class="line">        <span class="keyword">log</span>.<span class="keyword">error</span>(<span class="string">&quot;ç”¨æˆ·å·²ç»è´­ä¹°è¿‡ä¸€æ¬¡ï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//3.2åº“å­˜å……è¶³æ‰£å‡åº“å­˜</span></span><br><span class="line">    boolean success = seckillVoucherService.<span class="keyword">update</span>()</span><br><span class="line">            .setSql(<span class="string">&quot;stock = stock - 1&quot;</span>) <span class="comment">//ç›¸å½“äºsetæ¡ä»¶ set stock = stock - 1</span></span><br><span class="line">            .<span class="keyword">eq</span>(<span class="string">&quot;voucher_id&quot;</span>, voucherOrder.getVoucherId()) <span class="comment">//ç›¸å½“äºwhereæ¡ä»¶ where id = ? and stock = ?</span></span><br><span class="line">            .gt(<span class="string">&quot;stock&quot;</span>,0).<span class="keyword">update</span>();</span><br><span class="line">    <span class="keyword">if</span>(!success)&#123;</span><br><span class="line">        <span class="keyword">log</span>.<span class="keyword">error</span>(<span class="string">&quot;åº“å­˜ä¸è¶³!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    long orderId = redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);<span class="comment">//è®¢å•id</span></span><br><span class="line">    voucherOrder.setId(orderId);</span><br><span class="line">    voucherOrder.setUserId(userId);</span><br><span class="line">    voucherOrder.setVoucherId(voucherOrder.getVoucherId());<span class="comment">//ä»£é‡‘åˆ¸id</span></span><br><span class="line">    <span class="keyword">save</span>(voucherOrder);</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line">ä¸‹é¢æ˜¯å¯¹seckillVoucherçš„ç®€å•ä¿®æ”¹ï¼šseckillVoucher æ–¹æ³•åœ¨æ‰§è¡Œ Lua è„šæœ¬åï¼Œåˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰ç§’æ€èµ„æ ¼ã€‚å¦‚æœæœ‰ï¼Œåˆ™å°†è®¢å•ä¿¡æ¯å°è£…å¹¶æ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—ä¸­</span><br></pre></td></tr></table></figure><p>public Result seckillVoucher(Long voucherId) {</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">//1.æ‰§è¡ŒLuaè„šæœ¬</span></span><br><span class="line">Long result = stringRedisTemplate.execute(</span><br><span class="line">        SECKILL_SCRIPT,</span><br><span class="line">        Collections.emptyList(),</span><br><span class="line">        voucherId.toString(),</span><br><span class="line">        UserHolder.getUser().getId().toString()</span><br><span class="line">);</span><br><span class="line"><span class="keyword">int</span> r = result.intValue();</span><br><span class="line"><span class="keyword">if</span>(r != <span class="number">0</span>)&#123; <span class="comment">//2.åˆ¤æ–­ç»“æœæ˜¯å¦ä¸º0,ä¸ä¸º0,ä»£è¡¨æ²¡æœ‰è´­ä¹°èµ„æ ¼</span></span><br><span class="line">    <span class="function"><span class="keyword">return</span> Result.<span class="title">fail</span><span class="params">(r==<span class="number">1</span> ? <span class="string">&quot;åº“å­˜ä¸è¶³&quot;</span>:<span class="string">&quot;ä¸èƒ½é‡å¤ä¸‹å•&quot;</span>)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//2.2.ä¸º0,æœ‰è´­ä¹°èµ„æ ¼,æŠŠä¸‹å•ä¿¡æ¯ä¿å­˜åˆ°é˜»å¡é˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">long</span> orderId = redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line"><span class="comment">//å°è£…</span></span><br><span class="line">VoucherOrder voucherOrder = <span class="keyword">new</span> VoucherOrder();</span><br><span class="line">voucherOrder.setId(orderId);<span class="comment">//è®¢å•id</span></span><br><span class="line">voucherOrder.setUserId(UserHolder.getUser().getId());<span class="comment">//ç”¨æˆ·id</span></span><br><span class="line">voucherOrder.setVoucherId(voucherId);<span class="comment">//ä»£é‡‘åˆ¸id</span></span><br><span class="line"><span class="comment">//ä¿å­˜é˜»å¡é˜Ÿåˆ—</span></span><br><span class="line">orderTasks.add(voucherOrder);</span><br><span class="line"><span class="comment">//è·å–ä»£ç†å¯¹è±¡</span></span><br><span class="line">proxy = (IVoucherOrderService) AopContext.currentProxy();</span><br><span class="line"><span class="comment">//3.è¿”å›è®¢å•id</span></span><br><span class="line"><span class="function"><span class="keyword">return</span> Result.<span class="title">ok</span><span class="params">(orderId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµç¨‹æ€»ç»“</p><ul><li><strong>ç§’æ€èµ„æ ¼åˆ¤æ–­</strong>ï¼šé€šè¿‡ Lua è„šæœ¬åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³ã€æ˜¯å¦é‡å¤ä¸‹å•ã€‚</li><li><strong>å°è£…è®¢å•ä¿¡æ¯</strong>ï¼šå¦‚æœæœ‰èµ„æ ¼ï¼Œå°è£…è®¢å•ä¿¡æ¯å¹¶ä¿å­˜åˆ°é˜»å¡é˜Ÿåˆ—ã€‚</li><li><strong>å¼‚æ­¥ä¸‹å•</strong>ï¼šé€šè¿‡æ–°çº¿ç¨‹å¼‚æ­¥å¤„ç†è®¢å•ï¼Œé˜²æ­¢é˜»å¡å‰ç«¯ã€‚</li><li><strong>åŒé‡ä¿é™©</strong>ï¼šRedis å’Œæ•°æ®åº“ä¸­éƒ½è¿›è¡Œåº“å­˜ä¸ä¸€äººä¸€å•çš„åˆ¤æ–­ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§</li></ul><p>æµ‹è¯•ï¼š</p><p>å…ˆæŠŠtb_voucher_orderå†…å®¹æ¸…ç©ºã€‚æŠŠtb_seckill_voucherçš„stockåº“å­˜æ”¹ä¸º200ã€‚</p><p>ç„¶åæŠŠRedisä¸­å¯¹åº”ä¼˜æƒ åˆ¸çš„åº“å­˜æ”¹ä¸º200ã€‚æ¸…ç©ºä¹‹å‰ç”Ÿæˆçš„è®¢å•ã€‚æ£€æŸ¥æ˜¯å¦æœ‰1000ä¸ªç”¨æˆ·çš„tokenã€‚</p><p>å…ˆç”¨Apifoxè¿›è¡Œæµ‹è¯•ï¼Œæµ‹è¯•ä¸€äººä¸€å•çš„æƒ…å†µï¼šç¬¬2æ¬¡ä¸‹å•æ˜¾ç¤ºä¸èƒ½é‡å¤ä¸‹å•ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-247.png" alt="img"></p><p>æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å¤š1æ¡è®¢å•è®°å½•ï¼Œåº“å­˜æ˜¯å¦å‡å°‘1ï¼Œç¼“å­˜ä¸­åº“å­˜æ˜¯å¦å‡å°‘1ã€‚</p><p>æ¥ä¸‹æ¥ç”¨Jemeterè¿›è¡Œæµ‹è¯•ï¼Œä¼šå‘ç°åº“å­˜æ‰£å‡ä¸º0ï¼Œæ•°æ®åº“ä¸­å¤š200æ¡æ•°æ®ï¼Œç¼“å­˜ä¸­çš„åº“å­˜ä¹Ÿæ‰£å‡åˆ°0ã€‚</p><p>çœ‹èšåˆæŠ¥å‘Šçš„ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-248-1024x240.png" alt="img"></p><p>å› ä¸ºåšäº†å¼‚æ­¥ä¸‹å•ï¼Œä¼šå ç”¨ä¸€å®šçš„CPUï¼Œæ‰€ä»¥å¹³å‡å€¼è¦æ¯”ç¬¬2æ¬¡æ›´é•¿ã€‚</p><p>å’Œä¸‹é¢å‰2æ¬¡çš„ç»“æœè¿›è¡Œå¯¹æ¯”å¯ä»¥å‘ç°ï¼Œå“åº”çš„å¹³å‡å€¼æ¯”æœ€åˆæé«˜10å€ï¼Œæœ€å¿«å“åº”æ—¶é—´æé«˜äº†80å€ï¼Œæœ€æ…¢å“åº”æ—¶é—´æé«˜äº†6å€ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-249-1024x475.png" alt="img"></p><p>ç§’æ€ä¸šåŠ¡çš„ä¼˜åŒ–æ€è·¯ï¼š</p><p>1.å…ˆåˆ©ç”¨Rediså®Œæˆåº“å­˜é‡ã€ä¸€äººä¸€å•çš„åˆ¤æ–­ï¼Œå®ŒæˆæŠ¢å•ä¸šåŠ¡ã€‚</p><p>2.å°†ä¸‹å•ä¸šåŠ¡æ”¾å…¥é˜»å¡é˜Ÿåˆ—ï¼Œåˆ©ç”¨ç‹¬ç«‹çº¿ç¨‹å¼‚æ­¥ä¸‹å•ã€‚</p><p>åŸºäºé˜»å¡é˜Ÿåˆ—çš„å¼‚æ­¥ç§’æ€å­˜åœ¨å“ªäº›é—®é¢˜ï¼š</p><p>1.å†…å­˜é™åˆ¶é—®é¢˜ã€‚ä½¿ç”¨çš„æ˜¯jdkæä¾›çš„é˜»å¡é˜Ÿåˆ—ï¼Œä½¿ç”¨çš„æ˜¯JVMçš„å†…å­˜ï¼Œåœ¨ä¸€å¼€å§‹å†™æ­»äº†é˜Ÿåˆ—ç©ºé—´çš„å¤§å°ï¼Œå¦‚æœåœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œé˜Ÿåˆ—å¾ˆå¿«ä¼šè¢«å æ»¡ï¼Œå¦‚æœä¸å¯¹é˜Ÿåˆ—çš„ç©ºé—´åŠ ä»¥é™åˆ¶ï¼Œå¾ˆå®¹æ˜“é€ æˆå†…å­˜çš„æº¢å‡ºã€‚</p><p>2.æ•°æ®å®‰å…¨é—®é¢˜ã€‚ç¼ºä¹æŒä¹…åŒ–æœºåˆ¶ï¼Œæ˜¯åŸºäºå†…å­˜æ¥ä¿å­˜ä¿¡æ¯ï¼Œå¦‚æœæœåŠ¡çªç„¶å®•æœºï¼Œå†…å­˜ä¸­ä¿å­˜çš„ä¿¡æ¯éƒ½ä¼šä¸¢å¤±ã€‚å¦‚æœä»»åŠ¡è¢«å–å‡ºï¼Œä½†ç”±äºçªç„¶å‘ç”Ÿäº‹æ•…å¼‚å¸¸ï¼Œå¯¼è‡´ä»»åŠ¡æ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œä»»åŠ¡ä¸¢å¤±ï¼Œä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚</p><h2 id="7ã€Redisæ¶ˆæ¯é˜Ÿåˆ—">7ã€Redisæ¶ˆæ¯é˜Ÿåˆ—</h2><h3 id="7-1-Redisæ¶ˆæ¯é˜Ÿåˆ—-è®¤è¯†æ¶ˆæ¯é˜Ÿåˆ—">7.1 Redisæ¶ˆæ¯é˜Ÿåˆ—-è®¤è¯†æ¶ˆæ¯é˜Ÿåˆ—</h3><p>ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼š</p><p><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong> æ˜¯ä¸€ç§ä»¥å¼‚æ­¥é€šä¿¡ä¸ºåŸºç¡€çš„æœºåˆ¶ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­åº”ç”¨å¹¿æ³›ã€‚å®ƒçš„ä½œç”¨å°±æ˜¯ <strong>å­˜å‚¨å’Œç®¡ç†æ¶ˆæ¯</strong>ï¼Œå¹¶é€šè¿‡ <strong>æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆMessage Brokerï¼‰</strong> æ¥å®ç°æ¶ˆæ¯çš„ä¼ é€’ã€‚æœ€åŸºæœ¬çš„æ¶ˆæ¯é˜Ÿåˆ—åŒ…å«äº†ä¸‰ä¸ªä¸»è¦è§’è‰²ï¼š</p><ol><li><strong>ç”Ÿäº§è€…ï¼ˆProducerï¼‰</strong>ï¼šå‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ã€‚</li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼‰</strong>ï¼šå­˜å‚¨å’Œç®¡ç†æ¶ˆæ¯ã€‚</li><li><strong>æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰</strong>ï¼šä»é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯å¹¶è¿›è¡Œå¤„ç†ã€‚</li></ol><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-250.png" alt="img"></p><p><strong>ç¤ºä¾‹è¯´æ˜ï¼š</strong></p><p>é€šè¿‡ç”Ÿæ´»ä¸­çš„ä¾‹å­æ¥å¸®åŠ©ç†è§£æ¶ˆæ¯é˜Ÿåˆ—çš„ä½œç”¨ï¼š</p><ul><li><strong>ç”Ÿäº§è€…</strong>ï¼šå°±åƒä¸€ä¸ª <strong>å¿«é€’å‘˜</strong>ï¼Œä»–è´Ÿè´£å°†å¿«é€’ä»å•†å®¶æ‹¿åˆ°å¿«é€’ç«™ç‚¹ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ï¼Œç­‰å¾…é€è´§ã€‚</li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šå¿«é€’ç«™ç‚¹ï¼Œåœ¨è¿™é‡Œæ‰€æœ‰çš„å¿«é€’éƒ½æš‚æ—¶å­˜æ”¾ï¼Œç­‰å¾…è¢«æ´¾é€åˆ°æ¶ˆè´¹è€…ã€‚</li><li><strong>æ¶ˆè´¹è€…</strong>ï¼šç±»ä¼¼ <strong>æ”¶ä»¶äºº</strong>ï¼Œä»–ä»¬æ¥æ”¶åˆ°å¿«é€’ï¼Œå¤„ç†è‡ªå·±çš„éœ€æ±‚ã€‚</li></ul><p>ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ</p><p><strong>æé«˜æ•ˆç‡</strong>ï¼šæ¶ˆæ¯é˜Ÿåˆ—å¸®åŠ©ç³»ç»Ÿå¤„ç†å¹¶å‘ï¼Œç”Ÿäº§è€…å¯ä»¥å¿«é€Ÿå‘é€æ¶ˆæ¯ï¼Œè€Œæ¶ˆè´¹è€…ä¼šå¼‚æ­¥å¤„ç†ã€‚</p><p><strong>è§£è€¦</strong>ï¼šç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„å·¥ä½œå¯ä»¥è§£è€¦å¼€ï¼Œç”Ÿäº§è€…æ— éœ€å…³å¿ƒæ¶ˆè´¹è€…çš„å¤„ç†é€Ÿåº¦ï¼Œåä¹‹äº¦ç„¶ã€‚</p><p>è¿™ç§åœºæ™¯åœ¨æˆ‘ä»¬ç§’æ€ä¸­å°±å˜æˆäº†ï¼š</p><ol><li><strong>ç”¨æˆ·å‘èµ·ç§’æ€è¯·æ±‚</strong>ï¼šç”¨æˆ·ç‚¹å‡»ç§’æ€æŒ‰é’®ï¼Œç³»ç»Ÿä½œä¸º <strong>ç”Ÿäº§è€…</strong> å°†ç§’æ€è¯·æ±‚ï¼ˆæ¶ˆæ¯ï¼‰å‘é€åˆ° Redis æ¶ˆæ¯é˜Ÿåˆ—ã€‚</li><li><strong>ç³»ç»Ÿåˆ¤æ–­åº“å­˜</strong>ï¼šé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯è¿›å…¥å¤„ç†æµç¨‹ï¼Œç”± <strong>æ¶ˆè´¹è€…</strong> è´Ÿè´£ä» Redis æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯å¹¶æ‰§è¡Œç›¸åº”çš„å¤„ç†ï¼Œå¦‚åˆ¤æ–­åº“å­˜ã€ç”Ÿæˆè®¢å•ç­‰ã€‚</li><li><strong>å¼‚æ­¥å¤„ç†</strong>ï¼šæ¶ˆè´¹è€…å¤„ç†å®Œæ¶ˆæ¯åï¼Œæœ€ç»ˆç»“æœä¼šå¼‚æ­¥è¿”å›åˆ°</li></ol><p>Redisæä¾›äº†3ç§ä¸åŒçš„æ–¹å¼æ¥å®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼š</p><ul><li>1.listç»“æ„ï¼šåŸºäºListç»“æ„æ¨¡æ‹Ÿæ¶ˆæ¯é˜Ÿåˆ—ã€‚</li><li>2.PubSubï¼ˆå‘å¸ƒè®¢é˜…ï¼‰ï¼šåŸºæœ¬çš„ç‚¹å¯¹ç‚¹æ¶ˆæ¯æ¨¡å‹ã€‚</li><li>3.Streamï¼šæ¯”è¾ƒå®Œå–„çš„åŠŸèƒ½å¼ºå¤§çš„æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å‹ã€‚</li></ul><h3 id="7-2-Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºListå®ç°æ¶ˆæ¯é˜Ÿåˆ—">7.2 Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºListå®ç°æ¶ˆæ¯é˜Ÿåˆ—</h3><p><strong>åŸºäºListç»“æ„æ¨¡æ‹Ÿæ¶ˆæ¯é˜Ÿåˆ—</strong></p><p>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼‰ï¼Œå­—é¢æ„æ€å°±æ˜¯å­˜æ”¾æ¶ˆæ¯çš„é˜Ÿåˆ—ã€‚è€ŒRedisçš„listæ•°æ®ç»“æ„æ˜¯ä¸€ä¸ª<strong>åŒå‘é“¾è¡¨</strong>ï¼Œå› æ­¤æ”¯æŒä»ä¸¤ç«¯è¿›è¡Œæ“ä½œï¼Œèƒ½å¤Ÿå®ç°é˜Ÿåˆ—çš„ <strong>å…ˆè¿›å…ˆå‡º</strong>ï¼ˆFIFOï¼‰æ¨¡å¼ã€‚</p><p>å…³é”®å‘½ä»¤ï¼š</p><ul><li><strong>LPUSH</strong>ï¼šå°†ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ æ’å…¥åˆ°åˆ—è¡¨çš„ <strong>å¤´éƒ¨</strong>ã€‚ç”¨äºç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—ã€‚</li><li><strong>RPOP</strong>ï¼šç§»é™¤å¹¶è¿”å›åˆ—è¡¨çš„ <strong>å°¾éƒ¨</strong> å…ƒç´ ã€‚ç”¨äºæ¶ˆè´¹è€…ä»é˜Ÿåˆ—è·å–æ¶ˆæ¯ã€‚</li><li><strong>BRPOP</strong>ï¼šå½“é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œé˜»å¡ç­‰å¾…ï¼Œç›´åˆ°æœ‰æ¶ˆæ¯åŠ å…¥é˜Ÿåˆ—ä¸­</li></ul><h4 id="å…³é”®ç‚¹ï¼š">å…³é”®ç‚¹ï¼š</h4><ul><li><code>BRPOP</code> å’Œ <code>RPOP</code> å‘½ä»¤åœ¨é˜Ÿåˆ—ä¸ºç©ºæ—¶ä¼šè¿”å› <code>null</code>ï¼Œè¿™ä¸ <strong>JVM é˜»å¡é˜Ÿåˆ—</strong> ä¸åŒï¼ŒJVM é˜»å¡é˜Ÿåˆ—ä¼šç›´æ¥é˜»å¡çº¿ç¨‹ï¼Œç›´åˆ°é˜Ÿåˆ—æœ‰å¯ç”¨å…ƒç´ ã€‚</li><li>Redis ä¸­ä½¿ç”¨ <code>BRPOP</code> æ¥å®ç° <strong>é˜»å¡å¼é˜Ÿåˆ—</strong>ï¼Œä½¿å¾—æ¶ˆè´¹è€…å¯ä»¥åœ¨é˜Ÿåˆ—ä¸ºç©ºæ—¶é˜»å¡ç­‰å¾…ã€‚</li></ul><p>é˜Ÿåˆ—æ˜¯å…¥å£å’Œå‡ºå£ä¸åœ¨ä¸€è¾¹ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ï¼šLPUSH ç»“åˆ RPOPã€æˆ–è€… RPUSH ç»“åˆ LPOPæ¥å®ç°ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-252.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-253.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-251.png" alt="img"></p><p>åŸºäºListçš„æ¶ˆæ¯é˜Ÿåˆ—æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ ä¼˜ç‚¹ï¼š</p><ul><li><strong>åˆ©ç”¨ Redis å­˜å‚¨</strong>ï¼Œä¸ä¾èµ–äº JVM å†…å­˜ä¸­çš„é˜Ÿåˆ—ï¼Œä¿è¯äº†æ¶ˆæ¯é˜Ÿåˆ—çš„ <strong>æŒä¹…æ€§</strong> å’Œ <strong>é«˜å¯ç”¨æ€§</strong>ã€‚</li><li><strong>è·¨è¿›ç¨‹ã€è·¨å¹³å°</strong>ï¼šRedis å¯ä»¥ç”¨äºå¤šå°æœºå™¨é—´çš„æ¶ˆæ¯ä¼ é€’ï¼Œé€‚ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿã€‚</li><li><strong>å®‰å…¨æ€§</strong>ï¼šæ•°æ®å­˜å‚¨åœ¨ Redis ä¸­ï¼Œç¡®ä¿äº†æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ï¼Œç‰¹åˆ«æ˜¯åœ¨ <strong>Redis æŒä¹…åŒ–</strong>ï¼ˆAOF æˆ– RDBï¼‰å¼€å¯çš„æƒ…å†µä¸‹ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li><strong>æ— æ³•å¼ºåˆ¶æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯çš„é¡ºåº</strong>ï¼šå› ä¸º Redis æ˜¯åŸºäº List å®ç°çš„ï¼Œæ‰€ä»¥ <strong>å¤šä¸ªæ¶ˆè´¹è€…</strong> å¯èƒ½ä¼šé”™è¿‡æŸäº›æ¶ˆæ¯ï¼Œæˆ–æ¶ˆè´¹é¡ºåºä¸ä¿è¯ã€‚</li><li><strong>æ²¡æœ‰å†…å»ºçš„æ¶ˆæ¯ç¡®è®¤æœºåˆ¶</strong>ï¼šæ¶ˆè´¹è€…å¯èƒ½ä¼šæ¶ˆè´¹åŒä¸€ä¸ªæ¶ˆæ¯ï¼Œè‹¥å¤„ç†å¤±è´¥æ—¶ç¼ºä¹è¡¥å¿æœºåˆ¶ã€‚</li></ul><h3 id="7-3-Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºPubSubçš„æ¶ˆæ¯é˜Ÿåˆ—">7.3 Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºPubSubçš„æ¶ˆæ¯é˜Ÿåˆ—</h3><p>PubSubï¼ˆå‘å¸ƒè®¢é˜…ï¼‰æ˜¯Redis2.0ç‰ˆæœ¬å¼•å…¥çš„æ¶ˆæ¯ä¼ é€’æ¨¡å‹ã€‚é¡¾åæ€ä¹‰ï¼Œæ¶ˆè´¹è€…å¯ä»¥è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªchannelï¼Œç”Ÿäº§è€…å‘å¯¹åº”channelå‘é€æ¶ˆæ¯åï¼Œæ‰€æœ‰è®¢é˜…è€…éƒ½èƒ½æ”¶åˆ°ç›¸å…³æ¶ˆæ¯ã€‚</p><p>SUBSCRIBE channel [channel] ï¼šè®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªé¢‘é“ PUBLISH channel msg ï¼šå‘ä¸€ä¸ªé¢‘é“å‘é€æ¶ˆæ¯ PSUBSCRIBE pattern[pattern] ï¼šè®¢é˜…ä¸patternæ ¼å¼åŒ¹é…çš„æ‰€æœ‰é¢‘é“</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-254.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-255.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-257.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-256.png" alt="img"></p><p>åŸºäºPubSubçš„æ¶ˆæ¯é˜Ÿåˆ—æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ ä¼˜ç‚¹ï¼š</p><ul><li><strong>æ”¯æŒå¤šç”Ÿäº§è€…ã€å¤šæ¶ˆè´¹è€…</strong>ï¼šä¸€ä¸ªé¢‘é“å¯ä»¥æœ‰å¤šä¸ªç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯ï¼Œå¤šä¸ªæ¶ˆè´¹è€…è®¢é˜…å¹¶å¤„ç†è¿™äº›æ¶ˆæ¯ã€‚</li><li><strong>çµæ´»çš„è®¢é˜…æ–¹å¼</strong>ï¼šå¯ä»¥ç²¾ç¡®è®¢é˜…æŸä¸ªé¢‘é“ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ¨¡å¼åŒ¹é…ï¼ˆPSUBSCRIBEï¼‰è®¢é˜…å¤šä¸ªé¢‘é“ã€‚</li><li><strong>å®æ—¶æ€§é«˜</strong>ï¼šä¸€æ—¦æ¶ˆæ¯å‘å¸ƒï¼Œæ‰€æœ‰è®¢é˜…è€…å¯ä»¥å³æ—¶æ”¶åˆ°ï¼Œé€‚ç”¨äºå¯¹å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li><strong>ä¸æ”¯æŒæ•°æ®æŒä¹…åŒ–</strong>ï¼šRedis Pub/Sub ä¸ä¼šå°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ•°æ®ä¸¢å¤±é£é™©è¾ƒå¤§ã€‚</li><li><strong>æ— æ³•é¿å…æ¶ˆæ¯ä¸¢å¤±</strong>ï¼šå¦‚æœæ¶ˆè´¹è€…åœ¨è®¢é˜…æ—¶æ²¡æœ‰å‡†å¤‡å¥½ï¼Œæˆ– Redis æœåŠ¡é‡å¯ç­‰åŸå› ï¼Œä¼šä¸¢å¤±æ¶ˆæ¯ã€‚</li><li><strong>æ¶ˆæ¯å †ç§¯æœ‰é™åˆ¶</strong>ï¼šå¦‚æœæ¶ˆæ¯é˜Ÿåˆ—å †ç§¯è¿‡å¤šï¼Œè¶…å‡ºäº† Redis çš„å†…å­˜é™åˆ¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ã€‚</li></ul><h3 id="7-4-Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—">7.4 Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—</h3><p>Stream æ˜¯ Redis 5.0 å¼•å…¥çš„ä¸€ç§æ–°æ•°æ®ç±»å‹ï¼Œå¯ä»¥å®ç°ä¸€ä¸ªåŠŸèƒ½éå¸¸å®Œå–„çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p><p>å‘é€æ¶ˆæ¯çš„å‘½ä»¤ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-258-1024x150.png" alt="img"></p><ul><li><strong>key</strong>ï¼šæŒ‡å®š Stream çš„åç§°ã€‚</li><li><strong>field</strong> å’Œ <strong>value</strong>ï¼šæ¶ˆæ¯çš„å­—æ®µå’Œå€¼ï¼Œæ¯æ¡æ¶ˆæ¯ä¼šæœ‰å¤šä¸ªå­—æ®µå’Œå€¼ã€‚</li></ul><p>ä¾‹å¦‚ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-259.png" alt="img"></p><p>è¿™æ¡å‘½ä»¤ä¼šå°† <code>&quot;name&quot;</code> å’Œ <code>&quot;age&quot;</code> è¿™ä¸¤ä¸ªå­—æ®µåŠå…¶å¯¹åº”çš„å€¼ <code>&quot;jack&quot;</code> å’Œ <code>&quot;21&quot;</code> æ·»åŠ åˆ°åä¸º <code>users</code> çš„ Stream ä¸­ï¼ŒåŒæ—¶ Redis ä¼šè‡ªåŠ¨ä¸ºè¯¥æ¶ˆæ¯ç”Ÿæˆä¸€ä¸ª <strong>å”¯ä¸€çš„ ID</strong>ï¼ˆå¦‚ <code>1644085070523-0</code>ï¼‰ã€‚</p><p>è¯»å–æ¶ˆæ¯çš„æ–¹å¼ä¹‹ä¸€ï¼šXREADï¼Œéœ€è¦æ³¨æ„çš„æ˜¯keyå’Œ*|IDä¸­é—´é‚£ä¿©å‚æ•°æ˜¯<strong>å¯é€‰å‚æ•°</strong>ï¼Œä¸€ä¸ªæ˜¯ç”¨æ¥åˆ¤æ–­æ˜¯å¦è‡ªåŠ¨åˆ›å»ºé˜Ÿåˆ—ï¼Œä¸€ä¸ªæ˜¯ç”¨æ¥è®¾ç½®é˜Ÿåˆ—æœ€å¤§æ¶ˆæ¯æ•°é‡ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-260.png" alt="img"></p><p>ä¾‹å¦‚ï¼Œä½¿ç”¨XREADè¯»å–ç¬¬ä¸€ä¸ªæ¶ˆæ¯ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-261.png" alt="img"></p><p>è¿™æ¡å‘½ä»¤ä¼šä»åä¸º <code>users</code> çš„ Stream ä¸­è¯»å–æ¶ˆæ¯ï¼Œä» ID ä¸º <code>0</code> çš„ä½ç½®å¼€å§‹ï¼Œæœ€å¤šè¯»å– 1 æ¡æ¶ˆæ¯ã€‚</p><p>XREADé˜»å¡æ–¹å¼ï¼Œè¯»å–æœ€æ–°çš„æ¶ˆæ¯ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-262.png" alt="img"></p><ul><li><strong>BLOCK 1000</strong> è¡¨ç¤ºé˜»å¡ç­‰å¾…æœ€å¤š 1000 æ¯«ç§’ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰æ–°çš„æ¶ˆæ¯ï¼Œæˆ–è¶…æ—¶ã€‚</li><li><strong>$</strong> ä»£è¡¨è¯»å–æœ€æ–°çš„æ¶ˆæ¯ã€‚</li></ul><p>åœ¨ä¸šåŠ¡å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾ªç¯çš„è°ƒç”¨XREADé˜»å¡æ–¹å¼æ¥æŸ¥è¯¢æœ€æ–°æ¶ˆæ¯ï¼Œä»è€Œå®ç°æŒç»­ç›‘å¬é˜Ÿåˆ—çš„æ•ˆæœï¼Œä¼ªä»£ç å¦‚ä¸‹</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-263.png" alt="img"></p><ul><li>è¯¥å¾ªç¯ä¼šä¸æ–­æ‰§è¡Œ <code>XREAD</code> å‘½ä»¤ï¼Œç›´åˆ°æœ‰æ–°æ¶ˆæ¯è¿›å…¥é˜Ÿåˆ—ã€‚</li><li>æ¯æ¬¡ä» Stream ä¸­è¯»å–æ¶ˆæ¯å¹¶æ‰§è¡Œ <code>handleMessage()</code> å¤„ç†æ¶ˆæ¯ã€‚</li></ul><p>æ³¨æ„ï¼šå½“æˆ‘ä»¬æŒ‡å®šèµ·å§‹IDä¸º$æ—¶ï¼Œä»£è¡¨è¯»å–æœ€æ–°çš„æ¶ˆæ¯ï¼Œå¦‚æœæˆ‘ä»¬å¤„ç†ä¸€æ¡æ¶ˆæ¯çš„è¿‡ç¨‹ä¸­ï¼Œåˆæœ‰è¶…è¿‡1æ¡ä»¥ä¸Šçš„æ¶ˆæ¯åˆ°è¾¾é˜Ÿåˆ—ï¼Œåˆ™ä¸‹æ¬¡è·å–æ—¶ä¹Ÿåªèƒ½è·å–åˆ°æœ€æ–°çš„ä¸€æ¡ï¼Œä¼šå‡ºç°æ¼è¯»æ¶ˆæ¯çš„é—®é¢˜</p><p>STREAMç±»å‹æ¶ˆæ¯é˜Ÿåˆ—çš„XREADå‘½ä»¤ç‰¹ç‚¹ï¼š</p><ul><li>æ¶ˆæ¯å¯å›æº¯</li><li>ä¸€ä¸ªæ¶ˆæ¯å¯ä»¥è¢«å¤šä¸ªæ¶ˆè´¹è€…è¯»å–</li><li>å¯ä»¥é˜»å¡è¯»å–</li><li>æœ‰æ¶ˆæ¯æ¼è¯»çš„é£é™©</li></ul><h3 id="7-5-Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—-æ¶ˆè´¹è€…ç»„">7.5 Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—-æ¶ˆè´¹è€…ç»„</h3><p>æ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰ï¼šå°†å¤šä¸ªæ¶ˆè´¹è€…åˆ’åˆ†åˆ°ä¸€ä¸ªç»„ä¸­ï¼Œç›‘å¬åŒä¸€ä¸ªé˜Ÿåˆ—ã€‚æ¶ˆè´¹è€…ä¹‹é—´æ˜¯ç«äº‰å…³ç³»ã€‚</p><p>å…·å¤‡ä¸‹åˆ—ç‰¹ç‚¹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-264.png" alt="img"></p><p>åˆ›å»ºæ¶ˆè´¹è€…ç»„ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-265.png" alt="img"></p><ul><li>keyï¼šé˜Ÿåˆ—åç§°</li><li>groupNameï¼šæ¶ˆè´¹è€…ç»„åç§°</li><li>IDï¼šèµ·å§‹IDæ ‡ç¤ºï¼Œ$ä»£è¡¨é˜Ÿåˆ—ä¸­æœ€åä¸€ä¸ªæ¶ˆæ¯ï¼Œ0åˆ™ä»£è¡¨é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªæ¶ˆæ¯</li><li>MKSTREAMï¼šé˜Ÿåˆ—ä¸å­˜åœ¨æ—¶è‡ªåŠ¨åˆ›å»ºé˜Ÿåˆ—</li></ul><p>å…¶å®ƒå¸¸è§å‘½ä»¤ï¼š</p><p><strong>åˆ é™¤æŒ‡å®šçš„æ¶ˆè´¹è€…ç»„</strong></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">XGROUP DESTORY key groupName</span></span><br></pre></td></tr></table></figure><p><strong>ç»™æŒ‡å®šçš„æ¶ˆè´¹è€…ç»„æ·»åŠ æ¶ˆè´¹</strong></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">XGROUP CREATECONSUMER key groupname consumername</span></span><br></pre></td></tr></table></figure><p><strong>åˆ é™¤æ¶ˆè´¹è€…ç»„ä¸­çš„æŒ‡å®šæ¶ˆè´¹è€…</strong></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">XGROUP DELCONSUMER key groupname consumername</span></span><br></pre></td></tr></table></figure><p>åˆ›å»ºæ¶ˆè´¹è€…ç»„ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-269.png" alt="img"></p><p><strong>ä»æ¶ˆè´¹è€…ç»„è¯»å–æ¶ˆæ¯ï¼š</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XREADGROUP GROUP group consumer <span class="selector-attr">[COUNT count]</span> <span class="selector-attr">[BLOCK milliseconds]</span> <span class="selector-attr">[NOACK]</span> STREAMS key <span class="selector-attr">[key ...]</span> ID <span class="selector-attr">[ID ...]</span></span><br></pre></td></tr></table></figure><ul><li>groupï¼šæ¶ˆè´¹ç»„åç§°</li><li>consumerï¼šæ¶ˆè´¹è€…åç§°ï¼Œå¦‚æœæ¶ˆè´¹è€…ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…</li><li>countï¼šæœ¬æ¬¡æŸ¥è¯¢çš„æœ€å¤§æ•°é‡</li><li>BLOCK millisecondsï¼šå½“æ²¡æœ‰æ¶ˆæ¯æ—¶æœ€é•¿ç­‰å¾…æ—¶é—´</li><li>NOACKï¼šæ— éœ€æ‰‹åŠ¨ACKï¼Œè·å–åˆ°æ¶ˆæ¯åè‡ªåŠ¨ç¡®è®¤</li><li>STREAMS keyï¼šæŒ‡å®šé˜Ÿåˆ—åç§°</li><li>IDï¼šè·å–æ¶ˆæ¯çš„èµ·å§‹IDï¼š</li></ul><p>å¯ä»¥å‘ç°åœ¨åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„é‡Œçš„æ¶ˆè´¹è€…å¯¹æ¶ˆæ¯ä¸ä¼šé‡å¤è¯»å–ï¼Œè€Œæ˜¯ä¾æ¬¡è¯»å–ï¼Œå·²è¢«è¯»å–çš„æ¶ˆæ¯ä¸ä¼šå†æ¬¡è¢«è¯»å–ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-270.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-271.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-272.png" alt="img"></p><p><strong>æ¶ˆè´¹è€…ç¡®è®¤æ¶ˆæ¯ï¼š</strong></p><p>XACK key group ID</p><ul><li>keyï¼šæ˜¯é˜Ÿåˆ—åç§°ã€‚</li><li>groupï¼šæ˜¯æ¶ˆè´¹è€…ç»„åç§°ã€‚</li><li>IDï¼šæ˜¯æ¥æ”¶åˆ°çš„æ¶ˆæ¯çš„IDã€‚</li></ul><p><strong>æŸ¥çœ‹Pending-listé˜Ÿåˆ—çš„ä¿¡æ¯ï¼š</strong></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-273.png" alt="img"></p><ul><li>keyï¼šæ˜¯é˜Ÿåˆ—åç§°ã€‚</li><li>groupï¼šæ˜¯ç»„åç§°ã€‚</li></ul><p>ä¸‹é¢æ˜¯æ¶ˆæ¯ç¡®è®¤ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-274.png" alt="img"></p><p>å¯¹æ¶ˆæ¯è¿›è¡Œç¡®è®¤ï¼Œç¡®è®¤å®Œæ¶ˆæ¯ä¼šè¢«ç§»é™¤ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-275.png" alt="img"></p><p>Pending-listé˜Ÿåˆ—é‡Œé¢å­˜å‚¨çš„æ˜¯å·²ç»è¯»å–ï¼Œä½†æ˜¯è¿˜æ²¡ç¡®è®¤çš„æ¶ˆæ¯ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-276.png" alt="img"></p><p>å‡å¦‚ä¸€å°èŠ‚ç‚¹è¯»å–å®Œæ¶ˆæ¯è¿˜æ²¡å´æ¥å¾—åŠç¡®è®¤å°±å®•æœºäº†ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹çš„æ–¹æ³•è§£å†³ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-277.png" alt="img"></p><p>æ­£å¸¸æƒ…å†µä¸‹å…ˆç”¨&gt;ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œä¿¡æ¯ä¼šè¿›å…¥åˆ°Pending-listï¼ŒæŠŠIDä»&gt;æ”¹ä¸º0ï¼Œæ­¤æ—¶å–çš„å°±æ˜¯åœ¨Pending-listé‡Œçš„æ¶ˆæ¯ã€‚</p><p>æ¶ˆè´¹è€…ç›‘å¬æ¶ˆæ¯çš„åŸºæœ¬æ€è·¯ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-266.png" alt="img"></p><p>STREAMç±»å‹æ¶ˆæ¯é˜Ÿåˆ—çš„XREADGROUPå‘½ä»¤ç‰¹ç‚¹ï¼š</p><ul><li>æ¶ˆæ¯å¯å›æº¯</li><li>å¯ä»¥å¤šæ¶ˆè´¹è€…äº‰æŠ¢æ¶ˆæ¯ï¼ŒåŠ å¿«æ¶ˆè´¹é€Ÿåº¦</li><li>å¯ä»¥é˜»å¡è¯»å–</li><li>æ²¡æœ‰æ¶ˆæ¯æ¼è¯»çš„é£é™©</li><li>æœ‰æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼Œä¿è¯æ¶ˆæ¯è‡³å°‘è¢«æ¶ˆè´¹ä¸€æ¬¡</li><li>æ”¯æŒæ¶ˆæ¯æŒä¹…åŒ–</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-267.png" alt="img"></p><h3 id="7-6-åŸºäºRedisçš„Streamç»“æ„ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ç°å¼‚æ­¥ç§’æ€ä¸‹å•">7.6 åŸºäºRedisçš„Streamç»“æ„ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ç°å¼‚æ­¥ç§’æ€ä¸‹å•</h3><p>éœ€æ±‚ï¼šåœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ <strong>Redis Stream</strong> æ¥å®ç°ä¸€ä¸ª <strong>å¼‚æ­¥ç§’æ€ä¸‹å•</strong> çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>åˆ›å»ºä¸€ä¸ªStreamç±»å‹çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œåä¸ºstream.orders</li><li>ä¿®æ”¹ä¹‹å‰çš„ç§’æ€ä¸‹å•Luaè„šæœ¬ï¼Œåœ¨è®¤å®šæœ‰æŠ¢è´­èµ„æ ¼åï¼Œç›´æ¥å‘stream.ordersä¸­æ·»åŠ æ¶ˆæ¯ï¼Œå†…å®¹åŒ…å«voucherIdã€userIdã€orderId</li><li>é¡¹ç›®å¯åŠ¨æ—¶ï¼Œå¼€å¯ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ï¼Œå°è¯•è·å–stream.ordersä¸­çš„æ¶ˆæ¯ï¼Œå®Œæˆä¸‹å•</li></ul><p>ç›´æ¥é€šè¿‡æ§åˆ¶å°åˆ›å»ºä¸€ä¸ªstream.ordersé˜Ÿåˆ—ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-278.png" alt="img"></p><p>ç›´æ¥åœ¨Luaè„šæœ¬ä¸­ç¼–å†™ä»£ç ï¼ˆä¸»è¦å¢åŠ ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼‰</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--1.å‚æ•°åˆ—è¡¨</span></span><br><span class="line"><span class="comment">--1.1.ä¼˜æƒ åˆ¸id</span></span><br><span class="line"><span class="keyword">local</span> voucherId = ARGV[<span class="number">1</span>]</span><br><span class="line"><span class="comment">--1.2.ç”¨æˆ·id</span></span><br><span class="line"><span class="keyword">local</span> userId = ARGV[<span class="number">2</span>]</span><br><span class="line"><span class="comment">--1.3.è®¢å•id</span></span><br><span class="line"><span class="keyword">local</span> orderId = ARGV[<span class="number">3</span>]</span><br><span class="line"> </span><br><span class="line"><span class="comment">--2.æ•°æ®key</span></span><br><span class="line"><span class="comment">--2.1.åº“å­˜key</span></span><br><span class="line"><span class="keyword">local</span> stockKey = <span class="string">&#x27;seckill:stock:&#x27;</span> .. voucherId</span><br><span class="line"><span class="comment">--2.2.è®¢å•key</span></span><br><span class="line"><span class="keyword">local</span> orderKey = <span class="string">&#x27;seckill:order:&#x27;</span> .. voucherId</span><br><span class="line"> </span><br><span class="line"><span class="comment">--3.è„šæœ¬ä¸šåŠ¡</span></span><br><span class="line"><span class="comment">--3.1.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³ get stockKey</span></span><br><span class="line"><span class="keyword">if</span>(tonumber(redis.<span class="keyword">call</span>(<span class="string">&#x27;get&#x27;</span>,stockKey)) &lt;= <span class="number">0</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">--3.1.2.åº“å­˜ä¸è¶³ï¼Œè¿”å›1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">--3.2.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸‹å• SISMEMBER orderKey userId</span></span><br><span class="line"><span class="keyword">if</span>(redis.<span class="keyword">call</span>(<span class="string">&#x27;sismember&#x27;</span>,orderKey,userId)==<span class="number">1</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">--3.2.1.å­˜åœ¨ï¼Œè¯´æ˜æ˜¯é‡å¤ä¸‹å•ï¼Œè¿”å›2</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">--3.3.æ‰£åº“å­˜ incrby stockKey -1</span></span><br><span class="line">redis.<span class="keyword">call</span>(<span class="string">&#x27;incrby&#x27;</span>,stockKey,<span class="number">-1</span>)</span><br><span class="line"><span class="comment">--3.4.ä¸‹å• sadd orderKey userId</span></span><br><span class="line">redis.<span class="keyword">call</span>(<span class="string">&#x27;sadd&#x27;</span>,orderKey,userId)</span><br><span class="line"><span class="comment">--3.5.å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ä¸­ XADD stream.orders * k1 v1 k2 v2</span></span><br><span class="line">redis.<span class="keyword">call</span>(<span class="string">&#x27;xadd&#x27;</span>,<span class="string">&#x27;stream.orders&#x27;</span>,<span class="string">&#x27;*&#x27;</span>,<span class="string">&#x27;userId&#x27;</span>,userId,<span class="string">&#x27;voucherId&#x27;</span>,voucherId,<span class="string">&#x27;orderId&#x27;</span>,orderId)</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><ul><li><strong><code>xadd</code></strong> å‘½ä»¤å°† <code>userId</code>ã€<code>voucherId</code> å’Œ <code>orderId</code> å‘é€åˆ°åä¸º <code>stream.orders</code> çš„é˜Ÿåˆ—ä¸­ã€‚</li><li>æ¶ˆæ¯è¢«å‘é€åˆ°é˜Ÿåˆ—åï¼Œæ¶ˆè´¹è€…å¯ä»¥å¼‚æ­¥å¤„ç†è¿™ä¸ªæ¶ˆæ¯ã€‚</li></ul><p>åœ¨VoucherOrderServiceImplç±»ä¸­ä¿®æ”¹seckillVoucheræ–¹æ³•ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function">Result <span class="title">seckillVoucher</span><span class="params">(Long voucherId)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//è·å–è®¢å•id</span></span><br><span class="line">    <span class="keyword">long</span> orderId = redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">    <span class="comment">//1.æ‰§è¡ŒLuaè„šæœ¬(åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰è´­ä¹°èµ„æ ¼ï¼Œæ¶ˆæ¯å‘å‡º)</span></span><br><span class="line">    Long result = stringRedisTemplate.execute(</span><br><span class="line">            SECKILL_SCRIPT,</span><br><span class="line">            Collections.emptyList(),</span><br><span class="line">            voucherId.toString(),</span><br><span class="line">            UserHolder.getUser().getId().toString(),</span><br><span class="line">            String.valueOf(orderId)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">int</span> r = result.intValue();</span><br><span class="line">    <span class="keyword">if</span>(r != <span class="number">0</span>)&#123; <span class="comment">//2.åˆ¤æ–­ç»“æœæ˜¯å¦ä¸º0,ä¸ä¸º0,ä»£è¡¨æ²¡æœ‰è´­ä¹°èµ„æ ¼</span></span><br><span class="line">        <span class="function"><span class="keyword">return</span> Result.<span class="title">fail</span><span class="params">(r==<span class="number">1</span> ? <span class="string">&quot;åº“å­˜ä¸è¶³&quot;</span>:<span class="string">&quot;ä¸èƒ½é‡å¤ä¸‹å•&quot;</span>)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è·å–ä»£ç†å¯¹è±¡</span></span><br><span class="line">    proxy = (IVoucherOrderService) AopContext.currentProxy();</span><br><span class="line">    <span class="comment">//3.è¿”å›è®¢å•id</span></span><br><span class="line">    <span class="function"><span class="keyword">return</span> Result.<span class="title">ok</span><span class="params">(orderId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ‰§è¡Œ Lua è„šæœ¬æ¥è¿›è¡Œç§’æ€èµ„æ ¼çš„åˆ¤æ–­ï¼Œå¹¶å°†è®¢å•ä¿¡æ¯å‘é€åˆ° <code>stream.orders</code> é˜Ÿåˆ—ã€‚</p><p>åœ¨VoucherOrderServiceImplä¸­ä¿®æ”¹VoucherOrderHandleræ–¹æ³•çš„ä»£ç ï¼š</p><p>ä»£ç æ€è·¯å¦‚ä¸‹ï¼š</p><p>1.ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å°è¯•è¯»æ¶ˆæ¯ã€‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>.<span class="number">1</span>.è·å–å¤±è´¥ï¼Œç»§ç»­å¾ªç¯ã€‚</span><br></pre></td></tr></table></figure><p>2.è·å–æˆåŠŸï¼Œè¿›è¡Œè§£æå’Œè½¬æ¢ã€‚</p><p>3.è°ƒç”¨createVoucherOrder(voucherOrder)æ–¹æ³•å®Œæˆä¸‹å•ã€‚</p><p>4.ACKç¡®è®¤</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">    <span class="number">4.1</span>.ç¡®è®¤å¤±è´¥ï¼Œè°ƒç”¨<span class="title function_">handlePendingList</span>()æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="title class_">ExecutorService</span> seckill_order_executor = <span class="title class_">Executors</span>.<span class="title function_">newSingleThreadExecutor</span>();</span><br><span class="line"><span class="meta">@PostConstruct</span></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">void</span> <span class="title function_">init</span>(<span class="params"></span>)&#123;</span><br><span class="line">    seckill_order_executor.<span class="title function_">submit</span>(<span class="keyword">new</span> <span class="title class_">VoucherOrderHandler</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">VoucherOrderHandler</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="title class_">String</span> queueName = <span class="string">&quot;stream.order&quot;</span>;</span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">run</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//1.è·å–æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„è®¢å•ä¿¡æ¯ XREADGROUP GROUP g1 c1 COUNT 1 BLOCK 2000 STREAMS streams.order &gt;</span></span><br><span class="line">                <span class="title class_">List</span>&lt;<span class="title class_">MapRecord</span>&lt;<span class="title class_">String</span>, <span class="title class_">Object</span>, <span class="title class_">Object</span>&gt;&gt; list = stringRedisTemplate.<span class="title function_">opsForStream</span>().<span class="title function_">read</span>(</span><br><span class="line">                        <span class="title class_">Consumer</span>.<span class="title function_">from</span>(<span class="string">&quot;g1&quot;</span>, <span class="string">&quot;c1&quot;</span>),</span><br><span class="line">                        <span class="title class_">StreamReadOptions</span>.<span class="title function_">empty</span>().<span class="title function_">count</span>(<span class="number">1</span>).<span class="title function_">block</span>(<span class="title class_">Duration</span>.<span class="title function_">ofSeconds</span>(<span class="number">2</span>)),</span><br><span class="line">                        <span class="title class_">StreamOffset</span>.<span class="title function_">create</span>(queueName, <span class="title class_">ReadOffset</span>.<span class="title function_">lastConsumed</span>())</span><br><span class="line">                );</span><br><span class="line">                <span class="comment">//2.åˆ¤æ–­æ¶ˆæ¯è·å–æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">                <span class="keyword">if</span>(list==<span class="literal">null</span> || list.<span class="title function_">isEmpty</span>())&#123;</span><br><span class="line">                    <span class="comment">//2.1.è·å–å¤±è´¥ï¼Œæ²¡æœ‰æ¶ˆæ¯ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯</span></span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//3.è§£ææ¶ˆæ¯ä¸­çš„è®¢å•ä¿¡æ¯</span></span><br><span class="line">                <span class="title class_">MapRecord</span>&lt;<span class="title class_">String</span>, <span class="title class_">Object</span>, <span class="title class_">Object</span>&gt; record = list.<span class="title function_">get</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="comment">//4.è·å–æˆåŠŸï¼Œå¯ä»¥ä¸‹å•</span></span><br><span class="line">                <span class="title class_">Map</span>&lt;<span class="title class_">Object</span>, <span class="title class_">Object</span>&gt; values = record.<span class="title function_">getValue</span>();</span><br><span class="line">                <span class="comment">//3.åˆ›å»ºè®¢å•</span></span><br><span class="line">                <span class="title class_">VoucherOrder</span> voucherOrder = <span class="title class_">BeanUtil</span>.<span class="title function_">fillBeanWithMap</span>(values, <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>(), <span class="literal">true</span>);</span><br><span class="line">                <span class="title function_">createVoucherOrder</span>(voucherOrder);</span><br><span class="line">                <span class="comment">//4.ACKç¡®è®¤</span></span><br><span class="line">                stringRedisTemplate.<span class="title function_">opsForStream</span>().<span class="title function_">acknowledge</span>(queueName,<span class="string">&quot;g1&quot;</span>,record.<span class="title function_">getId</span>());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (<span class="title class_">Exception</span> e) &#123;</span><br><span class="line">                log.<span class="title function_">debug</span>(<span class="string">&quot;å¤„ç†è®¢å•å¼‚å¸¸&quot;</span>,e);</span><br><span class="line">                <span class="title function_">handlePendingList</span>();</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong><code>XREAD</code></strong> å‘½ä»¤ä» <code>stream.orders</code> é˜Ÿåˆ—ä¸­è¯»å–æ¶ˆæ¯ã€‚</li><li>è¯»å–åˆ°æ¶ˆæ¯åï¼Œè°ƒç”¨ <code>createVoucherOrder()</code> æ–¹æ³•æ¥å¤„ç†è®¢å•ã€‚</li><li>ä½¿ç”¨ <strong>ACK ç¡®è®¤</strong> æ¥ç¡®ä¿æ¶ˆæ¯è¢«æ­£ç¡®æ¶ˆè´¹ã€‚</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">  </span><br></pre></td></tr></table></figure><p>åœ¨VoucherOrderServiceImplä¸­æ·»åŠ handlePendingList()æ–¹æ³•çš„ä»£ç ï¼š</p><p>ä¸‹é¢æœ‰å‡ ä¸ªä¿®æ”¹ç‚¹ï¼š1.XREADGROUPè¯­å¥æœ«å°¾æ”¹ä¸º0ï¼Œè¡¨ç¤ºè¯»Pending-listé˜Ÿåˆ—ã€‚2.Pending-listæ¶ˆæ¯è·å–å¤±è´¥ç»“æŸå¾ªç¯ã€‚3.å¦‚æœæŠ›å¼‚å¸¸åªæ˜¯æš‚åœä¸€ä¸‹ï¼Œç„¶åä¼šç»§ç»­å¾ªç¯è¯»ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="built_in">void</span> <span class="title function_">handlePendingList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1.è·å–Pending-Listä¸­çš„è®¢å•ä¿¡æ¯ XREADGROUP GROUP g1 c1 COUNT 1 BLOCK 2000 STREAMS streams.order 0</span></span><br><span class="line">            <span class="title class_">List</span>&lt;<span class="title class_">MapRecord</span>&lt;<span class="title class_">String</span>, <span class="title class_">Object</span>, <span class="title class_">Object</span>&gt;&gt; list = stringRedisTemplate.<span class="title function_">opsForStream</span>().<span class="title function_">read</span>(</span><br><span class="line">                    <span class="title class_">Consumer</span>.<span class="title function_">from</span>(<span class="string">&quot;g1&quot;</span>, <span class="string">&quot;c1&quot;</span>),</span><br><span class="line">                    <span class="title class_">StreamReadOptions</span>.<span class="title function_">empty</span>().<span class="title function_">count</span>(<span class="number">1</span>),</span><br><span class="line">                    <span class="title class_">StreamOffset</span>.<span class="title function_">create</span>(queueName, <span class="title class_">ReadOffset</span>.<span class="title function_">from</span>(<span class="string">&quot;0&quot;</span>))</span><br><span class="line">            );</span><br><span class="line">            <span class="comment">//2.åˆ¤æ–­æ¶ˆæ¯è·å–æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">            <span class="keyword">if</span>(list==<span class="literal">null</span> || list.<span class="title function_">isEmpty</span>())&#123;</span><br><span class="line">                <span class="comment">//2.1.è·å–å¤±è´¥ï¼Œè¯´æ˜Pending-listé‡Œæ²¡æœ‰å¼‚å¸¸æ¶ˆæ¯ï¼Œç»“æŸå¾ªç¯</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//3.è§£ææ¶ˆæ¯ä¸­çš„è®¢å•ä¿¡æ¯</span></span><br><span class="line">            <span class="title class_">MapRecord</span>&lt;<span class="title class_">String</span>, <span class="title class_">Object</span>, <span class="title class_">Object</span>&gt; record = list.<span class="title function_">get</span>(<span class="number">0</span>);</span><br><span class="line">            <span class="comment">//4.è·å–æˆåŠŸï¼Œå¯ä»¥ä¸‹å•</span></span><br><span class="line">            <span class="title class_">Map</span>&lt;<span class="title class_">Object</span>, <span class="title class_">Object</span>&gt; values = record.<span class="title function_">getValue</span>();</span><br><span class="line">            <span class="comment">//3.åˆ›å»ºè®¢å•</span></span><br><span class="line">            <span class="title class_">VoucherOrder</span> voucherOrder = <span class="title class_">BeanUtil</span>.<span class="title function_">fillBeanWithMap</span>(values, <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>(), <span class="literal">true</span>);</span><br><span class="line">            <span class="comment">//4.ACKç¡®è®¤</span></span><br><span class="line">            stringRedisTemplate.<span class="title function_">opsForStream</span>().<span class="title function_">acknowledge</span>(queueName,<span class="string">&quot;g1&quot;</span>,record.<span class="title function_">getId</span>());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">Exception</span> e) &#123;</span><br><span class="line">            log.<span class="title function_">debug</span>(<span class="string">&quot;å¤„ç†Pending-listå¼‚å¸¸&quot;</span>,e);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="title class_">Thread</span>.<span class="title function_">sleep</span>(<span class="number">20</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (<span class="title class_">InterruptedException</span> ex) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(ex);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€»ç»“ï¼š</p><ul><li><strong>å¼‚æ­¥ä¸‹å•</strong>ï¼šé€šè¿‡ Redis Stream å®ç°ç§’æ€ä¸‹å•çš„å¼‚æ­¥å¤„ç†ï¼Œé¿å…äº†å‰ç«¯ç”¨æˆ·çš„é˜»å¡ã€‚</li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šä½¿ç”¨ Redis Stream å­˜å‚¨æ¶ˆæ¯ï¼Œç¡®ä¿æ¯ä¸ªç§’æ€è¯·æ±‚å¯ä»¥è¢«å¼‚æ­¥å¤„ç†ã€‚</li><li><strong>æ¶ˆæ¯ç¡®è®¤æœºåˆ¶</strong>ï¼šä½¿ç”¨ ACK ç¡®è®¤ç¡®ä¿æ¶ˆæ¯è¢«æˆåŠŸæ¶ˆè´¹ï¼Œå¹¶é€šè¿‡ Pending List å¤„ç†å¼‚å¸¸æ¶ˆæ¯ï¼Œé˜²æ­¢ä¸¢å¤±ã€‚</li></ul><p>æµ‹è¯•ï¼š</p><p>ç”¨Apifoxè¿›è¡Œæµ‹è¯•ï¼Œæµ‹è¯•æ¥å£è¯·æ±‚å‘é€æˆåŠŸï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-280-1024x590.png" alt="img"></p><p>æµ‹è¯•æˆåŠŸåå¯ä»¥çœ‹åˆ°ï¼štb_voucher_orderè¡¨å¤šäº†1æ¡è®°å½•ï¼Œtb_seckill_voucherè¡¨å¯¹åº”ä¼˜æƒ åˆ¸çš„åº“å­˜-1ï¼›åœ¨Redisä¸­seckill:orderä¸‹å‡ºç°è®¢å•è®°å½•ï¼Œåœ¨stockill:stockä¸‹çš„åº“å­˜-1ï¼Œåœ¨stream.ordersä¸‹å‡ºç°1æ¡æ–°çš„è®°å½•ã€‚</p><p>ç„¶åç”¨Jmeterè¿›è¡Œæµ‹è¯•ï¼šå¯ä»¥å‘ç°ç›¸è¾ƒäºæœªåšå¼‚æ­¥å¤„ç†çš„æƒ…å†µæ€§èƒ½ä»æœ‰è¾ƒå¤§æå‡ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-279-1024x264.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-281-1024x479.png" alt="img"></p><h2 id="8ã€è¾¾äººæ¢åº—">8ã€è¾¾äººæ¢åº—</h2><h3 id="8-1ã€è¾¾äººæ¢åº—-å‘å¸ƒæ¢åº—ç¬”è®°">8.1ã€è¾¾äººæ¢åº—-å‘å¸ƒæ¢åº—ç¬”è®°</h3><p>å‘å¸ƒæ¢åº—ç¬”è®°</p><p>æ¢åº—ç¬”è®°ç±»ä¼¼ç‚¹è¯„ç½‘ç«™çš„è¯„ä»·ï¼Œå¾€å¾€æ˜¯å›¾æ–‡ç»“åˆã€‚å¯¹åº”çš„è¡¨æœ‰ä¸¤ä¸ªï¼š<br>tb_blogï¼šæ¢åº—ç¬”è®°è¡¨ï¼ŒåŒ…å«ç¬”è®°ä¸­çš„æ ‡é¢˜ã€æ–‡å­—ã€å›¾ç‰‡ç­‰<br>tb_blog_commentsï¼šå…¶ä»–ç”¨æˆ·å¯¹æ¢åº—ç¬”è®°çš„è¯„ä»·</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-283.png" alt="img"></p><p><strong>å…·ä½“å‘å¸ƒæµç¨‹</strong></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-284.png" alt="img"></p><p>ä¸Šä¼ æ¥å£</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">&quot;upload&quot;</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">&quot;blog&quot;</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">Result</span> <span class="title function_">uploadImage</span>(<span class="params"><span class="meta">@RequestParam</span>(<span class="string">&quot;file&quot;</span>) <span class="title class_">MultipartFile</span> image</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è·å–åŸå§‹æ–‡ä»¶åç§°</span></span><br><span class="line">            <span class="title class_">String</span> originalFilename = image.<span class="title function_">getOriginalFilename</span>();</span><br><span class="line">            <span class="comment">// ç”Ÿæˆæ–°æ–‡ä»¶å</span></span><br><span class="line">            <span class="title class_">String</span> fileName = <span class="title function_">createNewFileName</span>(originalFilename);</span><br><span class="line">            <span class="comment">// ä¿å­˜æ–‡ä»¶</span></span><br><span class="line">            image.<span class="title function_">transferTo</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="title class_">SystemConstants</span>.<span class="property">IMAGE_UPLOAD_DIR</span>, fileName));</span><br><span class="line">            <span class="comment">// è¿”å›ç»“æœ</span></span><br><span class="line">            log.<span class="title function_">debug</span>(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œ&#123;&#125;&quot;</span>, fileName);</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Result</span>.<span class="title function_">ok</span>(fileName);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">IOException</span> e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šåŒå­¦ä»¬åœ¨æ“ä½œæ—¶ï¼Œéœ€è¦ä¿®æ”¹SystemConstants.IMAGE_UPLOAD_DIR è‡ªå·±å›¾ç‰‡æ‰€åœ¨çš„åœ°å€ï¼Œåœ¨å®é™…å¼€å‘ä¸­å›¾ç‰‡ä¸€èˆ¬ä¼šæ”¾åœ¨nginxä¸Šæˆ–è€…æ˜¯äº‘å­˜å‚¨ä¸Šã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-285-1024x179.png" alt="img"></p><p>BlogController</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(<span class="string">&quot;/blog&quot;</span>)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlogController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> IBlogService blogService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> Result saveBlog(<span class="meta">@RequestBody</span> Blog blog) &#123;</span><br><span class="line">        <span class="comment">//è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">        UserDTO user = UserHolder.getUser();</span><br><span class="line">        blog.setUpdateTime(user.getId());</span><br><span class="line">        <span class="comment">//ä¿å­˜æ¢åº—åšæ–‡</span></span><br><span class="line">        blogService.saveBlog(blog);</span><br><span class="line">        <span class="comment">//è¿”å›id</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(blog.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-2-è¾¾äººæ¢åº—-æŸ¥çœ‹æ¢åº—ç¬”è®°">8.2 è¾¾äººæ¢åº—-æŸ¥çœ‹æ¢åº—ç¬”è®°</h3><p>æ¢åº—ç¬”è®°è¦åŒ…å«ç¬”è®°çš„å†…å®¹å’Œåšä¸»çš„ç›¸å…³ä¿¡æ¯ã€‚æ‰€ä»¥é€‰æ‹©åœ¨Blogè¡¨ä¸­æ·»åŠ å¦‚ä¸‹2ä¸ªå­—æ®µï¼Œè¿™ä¸¤ä¸ªå­—æ®µéœ€è¦åç»­æˆ‘ä»¬æ‰‹åŠ¨ç»´æŠ¤ï¼ˆèµ‹å€¼ï¼‰ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-286-1024x814.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-287.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-289.png" alt="img"></p><p>åœ¨BlogControllerç±»é‡Œæ·»åŠ ä¸€ä¸ªqueryBlogByIdæ–¹æ³•ï¼ˆè™½ç„¶Controlleré‡Œä¸åº”è¯¥å‡ºç°ä¸šåŠ¡ä»£ç ï¼Œä½†é‰´äºåªæ˜¯ç®€å•çš„æŸ¥è¯¢æ“ä½œï¼Œå°±ä¸å¿…åœ¨æ„ç»†èŠ‚äº†ï¼‰ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(<span class="string">&quot;/&#123;id&#125;&quot;</span>)</span></span><br><span class="line"><span class="keyword">public</span> Result queryBlogById(<span class="meta">@PathVariable(<span class="string">&quot;id&quot;</span>)</span> <span class="built_in">Long</span> id)&#123;</span><br><span class="line">    Blog blog = blogService.getById(id);</span><br><span class="line">    <span class="keyword">if</span>(blog==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç¬”è®°ä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    User user = userService.getById(id);</span><br><span class="line">    blog.setIcon(user.getIcon());</span><br><span class="line">    blog.setName(user.getNickName());</span><br><span class="line">    <span class="keyword">return</span> Result.ok(blog);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-3-è¾¾äººæ¢åº—-ç‚¹èµåŠŸèƒ½">8.3 è¾¾äººæ¢åº—-ç‚¹èµåŠŸèƒ½</h3><p>ç°åœ¨çš„ç‚¹èµé€»è¾‘æ˜¯ï¼Œä¸€ä¸ªäººå¯ä»¥å¯¹åŒä¸€ç¯‡ç¬”è®°ç‚¹èµæ— æ•°æ¬¡ã€‚</p><p>éœ€æ±‚ï¼š</p><ul><li>1.åŒä¸€ä¸ªç”¨æˆ·åªèƒ½ç‚¹èµä¸€æ¬¡ï¼Œå¦‚æœå†æ¬¡ç‚¹å‡»åˆ™å–æ¶ˆç‚¹èµã€‚</li><li>2.å¦‚æœå½“å‰ç”¨æˆ·å·²ç»ç‚¹èµï¼Œåˆ™ç‚¹èµæŒ‰é’®é«˜äº®æ˜¾ç¤ºï¼ˆå‰ç«¯å·²å®ç°ï¼Œåˆ¤æ–­å­—æ®µBlogç±»çš„isLikeå±æ€§ï¼‰</li></ul><p>åˆ†æï¼š</p><ul><li>1.ç»™Blogç±»ä¸­æ·»åŠ ä¸€ä¸ªisLikeå­—æ®µï¼Œæ ‡ç¤ºæ˜¯å¦è¢«å½“å‰ç”¨æˆ·ç‚¹èµã€‚</li><li>2.ä¿®æ”¹ç‚¹èµåŠŸèƒ½ï¼Œåˆ©ç”¨Redisçš„Seté›†åˆåˆ¤æ–­æ˜¯å¦ç‚¹èµè¿‡ï¼Œæœªç‚¹èµåˆ™ç‚¹èµæ•°+1ï¼Œå·²ç‚¹èµåˆ™ç‚¹èµæ•°-1ã€‚</li><li>3.ä¿®æ”¹åˆ†é¡µæŸ¥è¯¢Blogä¸šåŠ¡å’Œæ ¹æ®idæŸ¥è¯¢Blogçš„ä¸šåŠ¡ï¼Œåˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦ç‚¹èµè¿‡ï¼Œèµ‹å€¼ç»™isLikeå­—æ®µã€‚</li><li>4.ä¿®æ”¹åˆ†é¡µæŸ¥è¯¢Blogä¸šåŠ¡ï¼Œåˆ¤æ–­å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦ç‚¹èµè¿‡ï¼Œèµ‹å€¼ç»™isLikeå­—æ®µ</li></ul><p>ä¸ºä»€ä¹ˆé‡‡ç”¨seté›†åˆï¼š</p><p>Redis çš„ Set æ˜¯ä¸€ä¸ªä¸å…è®¸é‡å¤å…ƒç´ çš„é›†åˆï¼Œç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨ç”¨æˆ·æ˜¯å¦ç‚¹èµçš„çŠ¶æ€ã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><p>åœ¨BlogControllerç±»ä¸­æ–°å¢likeBlogæ–¹æ³•ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@PutMapping</span>(<span class="string">&quot;/like/&#123;id&#125;&quot;</span>)</span><br><span class="line">public Result <span class="built_in">likeBlog</span>(<span class="variable">@PathVariable</span>(<span class="string">&quot;id&quot;</span>) Long id) &#123;</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">blogService</span><span class="selector-class">.likeBlog</span>(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ <code>@PutMapping</code> è¡¨ç¤ºç”¨æˆ·ç‚¹èµæˆ–å–æ¶ˆç‚¹èµã€‚</li><li>è°ƒç”¨ <code>likeBlog</code> æ–¹æ³•æ¥æ‰§è¡Œç‚¹èµé€»è¾‘ã€‚</li></ul><p>åœ¨IBlogServiceæ¥å£ä¸­æ·»åŠ æ–¹æ³•å£°æ˜ï¼š</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable"><span class="class">Result</span></span> <span class="function"><span class="title">likeBlog</span>(<span class="variable">Long</span> <span class="variable">id</span>);</span></span><br></pre></td></tr></table></figure><p>åœ¨BlogServiceImplç±»ä¸­æ·»åŠ ä¸‹é¢ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">BlogServiceImpl</span><span class="params">(StringRedisTemplate stringRedisTemplate)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">likeBlog</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">//1.è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> UserHolder.getUser();</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> user.getId();</span><br><span class="line">    <span class="comment">//2.åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦å·²ç»ç‚¹èµè¿‡</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;blog:liked:&quot;</span> +id;</span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">isMember</span> <span class="operator">=</span> stringRedisTemplate.opsForSet().isMember(key, userId.toString());</span><br><span class="line">    <span class="keyword">if</span>(BooleanUtil.isFalse(isMember))&#123;</span><br><span class="line">        <span class="comment">//3.æœªç‚¹èµï¼Œå¯ä»¥ç‚¹èµ</span></span><br><span class="line">        <span class="comment">//3.1.æ•°æ®åº“ç‚¹èµæ•°+1</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> update().setSql(<span class="string">&quot;liked=liked+1&quot;</span>).eq(<span class="string">&quot;id&quot;</span>, id).update();</span><br><span class="line">        <span class="comment">//3.2.ä¿å­˜ç”¨æˆ·åˆ°Redis</span></span><br><span class="line">        <span class="keyword">if</span>(isSuccess)&#123;</span><br><span class="line">            stringRedisTemplate.opsForSet().add(key,userId.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//4.å·²ç‚¹èµï¼Œå–æ¶ˆç‚¹èµ</span></span><br><span class="line">        <span class="comment">//4.1.æ•°æ®åº“ç‚¹èµæ•°-1</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> update().setSql(<span class="string">&quot;liked=liked-1&quot;</span>).eq(<span class="string">&quot;id&quot;</span>, id).update();</span><br><span class="line">        <span class="comment">//4.2.æŠŠç”¨æˆ·ä»Redisçš„seté›†åˆç§»é™¤</span></span><br><span class="line">        stringRedisTemplate.opsForSet().remove(key,userId.toString());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>ç‚¹èµ</strong>ï¼šå¦‚æœ Redis Set ä¸­æ²¡æœ‰å½“å‰ç”¨æˆ·çš„ IDï¼Œè¯´æ˜ç”¨æˆ·è¿˜æœªç‚¹èµï¼Œæ‰§è¡Œæ•°æ®åº“æ›´æ–°ï¼ˆç‚¹èµæ•°+1ï¼‰ï¼Œå¹¶å°†ç”¨æˆ· ID å­˜å…¥ Redis Setã€‚</li><li><strong>å–æ¶ˆç‚¹èµ</strong>ï¼šå¦‚æœ Redis Set ä¸­æœ‰å½“å‰ç”¨æˆ·çš„ IDï¼Œè¯´æ˜ç”¨æˆ·å·²ç‚¹èµï¼Œæ‰§è¡Œæ•°æ®åº“æ›´æ–°ï¼ˆç‚¹èµæ•°-1ï¼‰ï¼Œå¹¶å°†ç”¨æˆ· ID ä» Redis Set ä¸­ç§»é™¤ã€‚</li></ul><p>å› ä¸ºæˆ‘çš„queryBlogByIdå’ŒqueryHotBlogçš„ä¸šåŠ¡ä»£ç éƒ½æ²¿ç”¨åŸæœ¬çš„ä»£ç å†™åœ¨BlogControllerä¸­ï¼Œå› æ­¤æˆ‘æ˜¯ç›´æ¥åœ¨BlogControllerä¸­å†™å…¥isBlogLikedä»£ç ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">Boolean</span> isBlogLiked(Blog blog) &#123;</span><br><span class="line"><span class="built_in">Long</span> userId = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//1.è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">userId = UserHolder.getUser().getId();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">log.debug(<span class="string">&quot;ç”¨æˆ·æœªç™»å½•ï¼&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//2.åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦å·²ç»ç‚¹èµè¿‡</span></span><br><span class="line">String key = <span class="string">&quot;blog:liked:&quot;</span> +blog.getId();</span><br><span class="line"><span class="built_in">Boolean</span> isMember = stringRedisTemplate.opsForSet().isMember(key, userId.toString());</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">blog.setIsLike(BooleanUtil.isTrue(isMember));</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">log.debug(<span class="string">&quot;ç‚¹èµä¿¡æ¯ä¸ºç©ºï¼&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> isMember;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç‚¹èµ</strong>ï¼šé€šè¿‡ Redis åˆ¤æ–­å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦å·²ç‚¹èµï¼Œå¦‚æœç‚¹èµï¼Œåˆ™å°† <code>isLike</code> å­—æ®µè®¾ç½®ä¸º <code>true</code>ï¼Œå‰ç«¯æ ¹æ®è¯¥å­—æ®µå€¼æ¥æ§åˆ¶ç‚¹èµæŒ‰é’®çš„æ˜¾ç¤ºçŠ¶æ€</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-291.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-290.png" alt="img"></p><p>æ€»ç»“ï¼š</p><ul><li><strong>ç‚¹èµæ“ä½œ</strong>ï¼šä½¿ç”¨ Redis Set æ¥å­˜å‚¨æ¯ä¸ªç”¨æˆ·å¯¹åšå®¢çš„ç‚¹èµè®°å½•ï¼Œç¡®ä¿æ¯ä¸ªç”¨æˆ·åªèƒ½å¯¹åŒä¸€ç¯‡æ–‡ç« ç‚¹èµä¸€æ¬¡ã€‚</li><li><strong>å¼‚æ­¥æ›´æ–°</strong>ï¼šé€šè¿‡ Redis å­˜å‚¨ç‚¹èµçŠ¶æ€ï¼Œå‡å°‘æ•°æ®åº“æ“ä½œé¢‘ç‡ï¼Œæé«˜æ€§èƒ½ã€‚</li><li><strong>å‰ç«¯äº¤äº’</strong>ï¼šæ ¹æ® <code>isLike</code> å­—æ®µï¼Œå‰ç«¯åŠ¨æ€æ›´æ–°ç‚¹èµæŒ‰é’®çš„çŠ¶æ€ï¼Œå®ç°é«˜äº®æ˜¾ç¤ºå’Œå–æ¶ˆé«˜äº®ã€‚</li><li><strong>ç¼“å­˜ä¼˜åŒ–</strong>ï¼šä½¿ç”¨ Redis å¿«é€Ÿæ£€æŸ¥ç”¨æˆ·çš„ç‚¹èµçŠ¶æ€ï¼Œé¿å…é¢‘ç¹è®¿é—®æ•°æ®åº“ï¼Œæé«˜ç³»ç»Ÿå“åº”é€Ÿåº¦ã€‚</li></ul><p>æµ‹è¯•æ•ˆæœï¼šç‚¹èµä¸€æ¬¡é«˜äº®ï¼Œç‚¹èµä¸¤æ¬¡å–æ¶ˆã€‚åœ¨ç¼“å­˜ä¸­æœ‰ç›¸åº”çš„è®°å½•</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-294.png" alt="img"></p><h3 id="8-4-è¾¾äººæ¢åº—-ç‚¹èµæ’è¡Œæ¦œ">8.4 è¾¾äººæ¢åº—-ç‚¹èµæ’è¡Œæ¦œ</h3><p>éœ€æ±‚ï¼šåœ¨æ¢åº—ç¬”è®°è¯¦æƒ…é¡µé¢ï¼ŒæŒ‰ç…§æ—¶é—´æ’åºï¼ŒæŠŠæœ€æ—©ç‚¹èµçš„TOP5åˆ—ä¸¾å‡ºæ¥ï¼Œå½¢æˆç‚¹èµæ’è¡Œæ¦œã€‚</p><p>ä¹‹å‰çš„ç‚¹èµæ˜¯æ”¾åˆ°seté›†åˆï¼Œä½†æ˜¯<strong>seté›†åˆæ˜¯ä¸èƒ½æ’åºçš„</strong>ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™ï¼Œå’±ä»¬å¯ä»¥é‡‡ç”¨ä¸€ä¸ªå¯ä»¥æ’åºçš„seté›†åˆï¼Œå°±æ˜¯å’±ä»¬çš„sortedSet</p><p><strong>SortedSetï¼ˆæœ‰åºé›†åˆï¼‰</strong> æ˜¯ Redis ä¸­ä¸€ä¸ªé‡è¦çš„æ•°æ®ç»“æ„ï¼Œæ”¯æŒæŒ‰ <strong>score</strong> å€¼æ’åºï¼Œè¿™éå¸¸é€‚åˆç”¨äºæ’åç­‰åœºæ™¯ã€‚æˆ‘ä»¬éœ€è¦æ ¹æ® <strong>score</strong>ï¼ˆé€šå¸¸æ˜¯æ—¶é—´æˆ³æˆ–è€…ç”¨æˆ·çš„ç‚¹èµæ•°ç­‰ï¼‰æ¥æ’åºã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-295.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-292.png" alt="img"></p><p>å¯ä»¥ç”¨ZADDå‘½ä»¤æ·»åŠ å…ƒç´ ï¼ŒZSCOPEæ¥è·å¾—åˆ†æ•°å¯¹åº”çš„å…ƒç´ ï¼ŒZRANGEæ¥</p><p>Redis ä¸­é€šè¿‡ <strong>ZADD</strong> å‘½ä»¤æ¥å‘ <strong>SortedSet</strong> ä¸­æ·»åŠ å…ƒç´ ï¼Œå…ƒç´ ä¼šæ ¹æ® <strong>score</strong> å€¼æ’åºã€‚æ¯ä¸ªå…ƒç´ æœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><strong>Member</strong>ï¼šè¡¨ç¤ºå…ƒç´ ã€‚</li><li><strong>Score</strong>ï¼šè¡¨ç¤ºæ’åºå€¼ï¼ŒRedis ä¼šæ ¹æ®è¿™ä¸ªå€¼å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-296.png" alt="img"></p><ul><li><code>ZADD</code> æ·»åŠ äº† 3 ä¸ªå…ƒç´ ï¼Œåˆ†åˆ«ä¸º m1ã€m2ã€m3ï¼Œä¸”åˆ†åˆ«èµ‹äºˆäº†ä¸åŒçš„ <strong>score</strong>ã€‚</li><li><code>ZRANGE</code> å‘½ä»¤æŒ‰ <strong>score</strong> å‡åºæ’åˆ—ï¼Œå¹¶è¿”å›æŒ‡å®šèŒƒå›´çš„å…ƒç´ ã€‚</li></ul><p>ä¿®æ”¹ä»¥ä¸‹å‡ ç‚¹</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-297-1024x584.png" alt="img"></p><ul><li><strong>ZADD</strong> ç”¨æ¥å°†ç”¨æˆ· ID å’Œå½“å‰æ—¶é—´æˆ³ï¼ˆä½œä¸º <code>score</code>ï¼‰åŠ å…¥åˆ° Redis çš„ SortedSet ä¸­ã€‚</li><li><strong>ZREM</strong> ç”¨æ¥ç§»é™¤å·²ç‚¹èµç”¨æˆ·çš„è®°å½•ï¼Œè¿›è¡Œå–æ¶ˆç‚¹èµæ“ä½œã€‚</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-298.png" alt="img"></p><p>åœ¨Redisç¼“å­˜ä¸­å¤šäº†ä¸€ä¸ªscoreï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-299.png" alt="img"></p><p>åœ¨BlogControllerç±»ä¸­æ·»åŠ å¦‚ä¸‹æ–¹æ³•ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@GetMapping</span>(<span class="string">&quot;/likes/&#123;id&#125;&quot;</span>)</span><br><span class="line">public Result <span class="built_in">queryBlogLikes</span>(<span class="variable">@PathVariable</span>(<span class="string">&quot;id&quot;</span>) Long id) &#123;</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">blogService</span><span class="selector-class">.queryBlogLikes</span>(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>BlogController</code> ç±»ä¸­æ–°å¢æŸ¥è¯¢æ¥å£æ–¹æ³• <code>queryBlogLikes</code>ï¼š</p><ul><li><strong>GET</strong> è¯·æ±‚ <code>/blog/likes/&#123;id&#125;</code> æŸ¥è¯¢æŸç¯‡åšå®¢çš„ <strong>TOP 5 ç‚¹èµç”¨æˆ·</strong>ã€‚</li><li>è¿”å›ç»“æœæ˜¯ä¸€ä¸ª <code>List&lt;UserDTO&gt;</code>ï¼ŒåŒ…å«äº†ç‚¹èµæœ€å¤šçš„ç”¨æˆ·ã€‚</li></ul><p>åœ¨IBlogServiceæ¥å£ä¸­æ·»åŠ å¦‚ä¸‹æ–¹æ³•ï¼š</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable"><span class="class">Result</span></span> <span class="function"><span class="title">queryBlogLikes</span>(<span class="variable">Long</span> <span class="variable">id</span>);</span></span><br></pre></td></tr></table></figure><p>åœ¨BlogServiceImplç±»ä¸­æ·»åŠ å¦‚ä¸‹æ–¹æ³•ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line"><span class="keyword">public</span> Result queryBlogLikes(<span class="keyword">Long</span> id) &#123;</span><br><span class="line">    String key = RedisConstants.BLOG_LIKED_KEY +id;</span><br><span class="line">    <span class="comment">//1.æŸ¥è¯¢top5çš„ç‚¹èµç”¨æˆ· zrange key 0 4</span></span><br><span class="line">    Set&lt;String&gt; top5 = stringRedisTemplate.opsForZSet().range(key, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">    <span class="keyword">if</span>(top5==<span class="keyword">null</span> || top5.isEmpty())&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.ok(Collections.emptyList());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2.è§£æå‡ºå…¶ä¸­çš„ç”¨æˆ·id</span></span><br><span class="line">    List&lt;<span class="keyword">Long</span>&gt; ids = top5.stream().map(<span class="keyword">Long</span>::valueOf).<span class="keyword">collect</span>(Collectors.<span class="keyword">toList</span>());</span><br><span class="line">    <span class="comment">//3.æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line">    List&lt;UserDTO&gt; userDTOS = userService.listByIds(ids)</span><br><span class="line">            .stream()</span><br><span class="line">            .map(user -&gt; BeanUtil.copyProperties(user, UserDTO.<span class="keyword">class</span>))</span><br><span class="line">            .<span class="keyword">collect</span>(Collectors.<span class="keyword">toList</span>());</span><br><span class="line">    <span class="comment">//4.è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(userDTOS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ä¼šå‡ºç°å·¦å›¾é—®é¢˜ï¼Œå…ˆç‚¹èµçš„åè€Œè¢«æ’åˆ°åé¢äº†ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-300.png" alt="img"></p><p>ä¸‹é¢æ˜¯ä¿®æ”¹åçš„queryBlogLikesï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line"><span class="keyword">public</span> Result queryBlogLikes(<span class="keyword">Long</span> id) &#123;</span><br><span class="line">    String key = RedisConstants.BLOG_LIKED_KEY +id;</span><br><span class="line">    <span class="comment">//1.æŸ¥è¯¢top5çš„ç‚¹èµç”¨æˆ· zrange key 0 4</span></span><br><span class="line">    Set&lt;String&gt; top5 = stringRedisTemplate.opsForZSet().range(key, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">    <span class="keyword">if</span>(top5==<span class="keyword">null</span> || top5.isEmpty())&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.ok(Collections.emptyList());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2.è§£æå‡ºå…¶ä¸­çš„ç”¨æˆ·id</span></span><br><span class="line">    List&lt;<span class="keyword">Long</span>&gt; ids = top5.stream().map(<span class="keyword">Long</span>::valueOf).<span class="keyword">collect</span>(Collectors.<span class="keyword">toList</span>());</span><br><span class="line">    <span class="comment">//3.æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line">    String idStr = StrUtil.<span class="keyword">join</span>(<span class="string">&quot;,&quot;</span>, ids);</span><br><span class="line">    List&lt;UserDTO&gt; userDTOS = userService.query()</span><br><span class="line">            .in(<span class="string">&quot;id&quot;</span>,ids)</span><br><span class="line">            .last(<span class="string">&quot;ORDER BY FIELD(id,&quot;</span>+idStr+<span class="string">&quot;)&quot;</span>).list()</span><br><span class="line">            .stream()</span><br><span class="line">            .map(user -&gt; BeanUtil.copyProperties(user, UserDTO.<span class="keyword">class</span>))</span><br><span class="line">            .<span class="keyword">collect</span>(Collectors.<span class="keyword">toList</span>());</span><br><span class="line">    <span class="comment">//4.è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(userDTOS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>èƒ½å¤Ÿæ­£å¸¸å±•ç¤ºï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-301.png" alt="img"></p><h2 id="9ã€å¥½å‹å…³æ³¨">9ã€å¥½å‹å…³æ³¨</h2><h3 id="9-1-å¥½å‹å…³æ³¨-å…³æ³¨å’Œå–æ¶ˆå…³æ³¨">9.1 å¥½å‹å…³æ³¨-å…³æ³¨å’Œå–æ¶ˆå…³æ³¨</h3><p>é’ˆå¯¹ç”¨æˆ·çš„æ“ä½œï¼šå¯ä»¥å¯¹ç”¨æˆ·è¿›è¡Œå…³æ³¨å’Œå–æ¶ˆå…³æ³¨åŠŸèƒ½ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-302-1024x506.png" alt="img"></p><p>å®ç°æ€è·¯ï¼š</p><p>éœ€æ±‚ï¼šåŸºäºè¯¥è¡¨æ•°æ®ç»“æ„ï¼Œå®ç°ä¸¤ä¸ªæ¥å£ï¼š</p><ul><li>å…³æ³¨å’Œå–å…³æ¥å£</li><li>åˆ¤æ–­æ˜¯å¦å…³æ³¨çš„æ¥å£</li></ul><p>å…³æ³¨æ˜¯Userä¹‹é—´çš„å…³ç³»ï¼Œæ˜¯åšä¸»ä¸ç²‰ä¸çš„å…³ç³»ï¼Œæ•°æ®åº“ä¸­æœ‰ä¸€å¼ tb_followè¡¨æ¥æ ‡ç¤ºï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-303-1024x213.png" alt="img"></p><p>å…³æ³¨æ˜¯ç»™è¡¨æ–°å¢è®°å½•ï¼Œå–å…³æ˜¯åˆ é™¤è¡¨ä¸­è®°å½•ã€‚</p><p>åœ¨FollowControllerç±»ä¸­å†™å…¥å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å…³æ³¨</span></span><br><span class="line"><span class="variable">@PutMapping</span>(<span class="string">&quot;/&#123;id&#125;/&#123;isFollow&#125;&quot;</span>)</span><br><span class="line">public Result <span class="built_in">follow</span>(<span class="variable">@PathVariable</span>(<span class="string">&quot;id&quot;</span>) Long followUserId, <span class="variable">@PathVariable</span>(<span class="string">&quot;isFollow&quot;</span>) Boolean isFollow) &#123;</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">followService</span><span class="selector-class">.follow</span>(followUserId, isFollow);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å–æ¶ˆå…³æ³¨</span></span><br><span class="line">@<span class="selector-tag">GetMapping</span>(<span class="string">&quot;/or/not/&#123;id&#125;&quot;</span>)</span><br><span class="line"><span class="selector-tag">public</span> <span class="selector-tag">Result</span> <span class="selector-tag">isFollow</span>(<span class="variable">@PathVariable</span>(<span class="string">&quot;id&quot;</span>) Long followUserId) &#123;</span><br><span class="line">      <span class="selector-tag">return</span> <span class="selector-tag">followService</span><span class="selector-class">.isFollow</span>(followUserId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å…³æ³¨æ¥å£ï¼ˆPUT è¯·æ±‚ï¼‰</strong>ï¼š</p><ul><li>è·¯ç”±ï¼š<code>/follow/&#123;id&#125;/&#123;isFollow&#125;</code></li><li>åŠŸèƒ½ï¼šåˆ¤æ–­æ˜¯å…³æ³¨è¿˜æ˜¯å–æ¶ˆå…³æ³¨ï¼Œé€šè¿‡ <code>isFollow</code> å‚æ•°æ¥åŒºåˆ†ã€‚å¦‚æœ <code>isFollow</code> ä¸º <code>true</code>ï¼Œåˆ™è¡¨ç¤ºå…³æ³¨ï¼›å¦‚æœä¸º <code>false</code>ï¼Œåˆ™è¡¨ç¤ºå–æ¶ˆå…³æ³¨ã€‚</li></ul><p><strong>å–æ¶ˆå…³æ³¨æ¥å£ï¼ˆGET è¯·æ±‚ï¼‰</strong>ï¼š</p><ul><li>è·¯ç”±ï¼š<code>/or/not/&#123;id&#125;</code></li><li>åŠŸèƒ½ï¼šåˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦å·²å…³æ³¨ç›®æ ‡ç”¨æˆ·ã€‚</li></ul><p>åœ¨IFollowServiceä¸­å†™å…¥å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="symbol">IFollowService</span> <span class="symbol">extends</span> <span class="symbol">IService</span>&lt;<span class="symbol">Follow</span>&gt; &#123;</span><br><span class="line">    Result follow(Long followUserId, Boolean isFollow); <span class="comment">// å…³æ³¨æˆ–å–å…³</span></span><br><span class="line">    Result isFollow(Long followUserId); <span class="comment">// åˆ¤æ–­æ˜¯å¦å…³æ³¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨FollowServiceImplç±»ä¸­å†™å…¥å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Service</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">FollowServiceImpl</span> <span class="title">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">FollowMapper</span>, <span class="title">Follow</span>&gt; <span class="title">implements</span> <span class="title">IFollowService</span> </span>&#123;</span><br><span class="line">    // å…³æ³¨ä¸å–æ¶ˆå…³æ³¨æ“ä½œ</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public Result follow(Long followUserId, Boolean isFollow) &#123;</span><br><span class="line">        Long userId = UserHolder.getUser().getId();</span><br><span class="line">        <span class="regexp">//</span><span class="number">1</span>.åˆ¤æ–­æ˜¯å…³æ³¨è¿˜æ˜¯å–å…³</span><br><span class="line">        <span class="keyword">if</span>(isFollow)&#123;</span><br><span class="line">            <span class="regexp">//</span><span class="number">2</span>.å…³æ³¨ï¼Œæ–°å¢æ•°æ®</span><br><span class="line">            Follow follow = new Follow();</span><br><span class="line">            follow.setUserId(userId);</span><br><span class="line">            follow.setFollowUserId(followUserId);</span><br><span class="line">            save(follow);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="regexp">//</span><span class="number">3</span>.å–å…³ï¼Œåˆ é™¤è®°å½•</span><br><span class="line">            remove(new QueryWrapper&lt;Follow&gt;()</span><br><span class="line">                    .e<span class="string">q(&quot;user_id&quot;, userId)</span>.e<span class="string">q(&quot;follow_user_id&quot;, followUserId)</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦å·²å…³æ³¨ç›®æ ‡ç”¨æˆ·</span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public Result isFollow(Long followUserId) &#123;</span><br><span class="line">        Long userId = UserHolder.getUser().getId();</span><br><span class="line">        <span class="regexp">//</span><span class="number">1</span>.æŸ¥è¯¢æ˜¯å¦å…³æ³¨</span><br><span class="line">        Integer count = query().e<span class="string">q(&quot;user_id&quot;, userId)</span>.e<span class="string">q(&quot;follow_user_id&quot;, followUserId)</span>.count();</span><br><span class="line">        <span class="regexp">//</span><span class="number">2</span>.åˆ¤æ–­æ˜¯å¦å…³æ³¨</span><br><span class="line">        <span class="keyword">return</span> Result.ok(count&gt;<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>å…³æ³¨æ“ä½œ</strong>ï¼šé¦–å…ˆè·å–å½“å‰ç™»å½•çš„ <code>userId</code>ï¼Œç„¶åæ ¹æ® <code>followUserId</code> åˆ›å»ºä¸€ä¸ª <code>Follow</code> å®ä½“å¯¹è±¡ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚</li><li><strong>å–æ¶ˆå…³æ³¨æ“ä½œ</strong>ï¼šæ ¹æ®å½“å‰ç”¨æˆ·çš„ <code>userId</code> å’Œç›®æ ‡ç”¨æˆ·çš„ <code>followUserId</code> åˆ é™¤ <code>tb_follow</code> è¡¨ä¸­çš„è®°å½•ï¼Œè¡¨ç¤ºå–æ¶ˆå…³æ³¨ã€‚</li><li><strong>åˆ¤æ–­æ˜¯å¦å·²å…³æ³¨</strong></li><li><strong>isFollow æ–¹æ³•</strong>ï¼šè¯¥æ–¹æ³•é€šè¿‡æŸ¥è¯¢ <code>tb_follow</code> è¡¨æ¥åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦å·²ç»å…³æ³¨æŸä¸ªç›®æ ‡ç”¨æˆ·ã€‚å¦‚æœå­˜åœ¨å¯¹åº”è®°å½•ï¼Œåˆ™è¿”å› <code>true</code>ï¼Œå¦åˆ™è¿”å› <code>false</code>ã€‚</li></ul><p>æµ‹è¯•ï¼šç‚¹å‡»å…³æ³¨æ˜¾ç¤ºå…³æ³¨æˆåŠŸï¼Œæ•°æ®åº“é‡Œä¼šæœ‰è®°å½•ã€‚å–æ¶ˆå…³æ³¨ååˆ é™¤æ¶ˆæ¯ã€‚</p><h3 id="9-2-å¥½å‹å…³æ³¨-å…±åŒå…³æ³¨">9.2 å¥½å‹å…³æ³¨-å…±åŒå…³æ³¨</h3><p>æƒ³è¦å»çœ‹å…±åŒå…³æ³¨çš„å¥½å‹ï¼Œéœ€è¦é¦–å…ˆè¿›å…¥åˆ°è¿™ä¸ªé¡µé¢ï¼Œè¿™ä¸ªé¡µé¢ä¼šå‘èµ·ä¸¤ä¸ªè¯·æ±‚</p><p>1ã€å»æŸ¥è¯¢ç”¨æˆ·çš„è¯¦æƒ…</p><p>2ã€å»æŸ¥è¯¢ç”¨æˆ·çš„ç¬”è®°</p><p>ä»¥ä¸Šä¸¤ä¸ªåŠŸèƒ½å’Œå…±åŒå…³æ³¨æ²¡æœ‰ä»€ä¹ˆå…³ç³»ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œå°†ç¬”è®°ä¸­çš„ä»£ç æ‹·è´åˆ°ideaä¸­å°±å¯ä»¥å®ç°è¿™ä¸¤ä¸ªåŠŸèƒ½äº†ï¼Œæˆ‘ä»¬çš„é‡ç‚¹åœ¨äºå…±åŒå…³æ³¨åŠŸèƒ½ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserController æ ¹æ®idæŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line"><span class="meta">@GetMapping(<span class="string">&quot;/&#123;id&#125;&quot;</span>)</span></span><br><span class="line"><span class="keyword">public</span> Result queryUserById(<span class="meta">@PathVariable(<span class="string">&quot;id&quot;</span>)</span> <span class="built_in">Long</span> userId)&#123;</span><br><span class="line"><span class="comment">// æŸ¥è¯¢è¯¦æƒ…</span></span><br><span class="line">User user = userService.getById(userId);</span><br><span class="line"><span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br><span class="line">UserDTO userDTO = BeanUtil.copyProperties(user, UserDTO.<span class="keyword">class</span>);</span><br><span class="line"><span class="comment">// è¿”å›</span></span><br><span class="line"><span class="keyword">return</span> Result.ok(userDTO);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BlogController  æ ¹æ®idæŸ¥è¯¢åšä¸»çš„æ¢åº—ç¬”è®°</span></span><br><span class="line"><span class="meta">@GetMapping(<span class="string">&quot;/of/user&quot;</span>)</span></span><br><span class="line"><span class="keyword">public</span> Result queryBlogByUserId(</span><br><span class="line"><span class="meta">@RequestParam(value = <span class="string">&quot;current&quot;</span>, defaultValue = <span class="string">&quot;1&quot;</span>)</span> Integer current,</span><br><span class="line"><span class="meta">@RequestParam(<span class="string">&quot;id&quot;</span>)</span> <span class="built_in">Long</span> id) &#123;</span><br><span class="line"><span class="comment">// æ ¹æ®ç”¨æˆ·æŸ¥è¯¢</span></span><br><span class="line">Page&lt;Blog&gt; page = blogService.query()</span><br><span class="line">.eq(<span class="string">&quot;user_id&quot;</span>, id).page(new Page&lt;&gt;(current, SystemConstants.MAX_PAGE_SIZE));</span><br><span class="line"><span class="comment">// è·å–å½“å‰é¡µæ•°æ®</span></span><br><span class="line">List&lt;Blog&gt; records = page.getRecords();</span><br><span class="line"><span class="keyword">return</span> Result.ok(records);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-304-1024x403.png" alt="img"></p><p>åŠŸèƒ½å®ç°çš„æ€è·¯æ˜¯ï¼š</p><ul><li><strong>å…³æ³¨æ“ä½œ</strong>ï¼šå½“ç”¨æˆ·å…³æ³¨å¦ä¸€ä¸ªç”¨æˆ·æ—¶ï¼Œä¸ä»…è¦åœ¨æ•°æ®åº“è¡¨ä¸­æ’å…¥è®°å½•ï¼Œè¿˜éœ€è¦å°†å…³æ³¨çš„ç”¨æˆ·IDå­˜å‚¨åœ¨Redisçš„ <code>Set</code> é›†åˆä¸­ã€‚</li><li><strong>å–æ¶ˆå…³æ³¨æ“ä½œ</strong>ï¼šå½“ç”¨æˆ·å–æ¶ˆå¯¹å¦ä¸€ä¸ªç”¨æˆ·çš„å…³æ³¨æ—¶ï¼Œé™¤äº†åˆ é™¤æ•°æ®åº“ä¸­çš„è®°å½•ï¼Œè¿˜éœ€è¦ä»Redisä¸­ç§»é™¤å¯¹åº”çš„ç”¨æˆ·IDã€‚</li><li><strong>å…±åŒå…³æ³¨æ“ä½œ</strong>ï¼šé€šè¿‡Redisçš„ <code>SINTER</code> å‘½ä»¤ï¼Œè·å–å½“å‰ç”¨æˆ·ä¸ç›®æ ‡ç”¨æˆ·å…³æ³¨çš„äº¤é›†ï¼Œè¿›è€ŒæŸ¥è¯¢è¿™äº›å…±åŒå…³æ³¨çš„ç”¨æˆ·ä¿¡æ¯ã€‚</li></ul><p>é¦–å…ˆè¦æ›´æ”¹FollowServiceImplä»£ç ä¸­çš„followæ–¹æ³•ï¼Œä¸»è¦åœ¨å…³æ³¨æ—¶æŠŠè¢«å…³æ³¨ç”¨æˆ·çš„idæ”¾å…¥redisï¼Œå–å…³æ—¶ä»redisä¸­ç§»é™¤idï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> IUserService userService;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">FollowServiceImpl</span><span class="params">(StringRedisTemplate stringRedisTemplate)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">follow</span><span class="params">(Long followUserId, Boolean isFollow)</span> &#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;follows:&quot;</span> + userId;</span><br><span class="line">    <span class="comment">//1.åˆ¤æ–­æ˜¯å…³æ³¨è¿˜æ˜¯å–å…³</span></span><br><span class="line">    <span class="keyword">if</span>(isFollow)&#123;</span><br><span class="line">        <span class="comment">//2.å…³æ³¨ï¼Œæ–°å¢æ•°æ®</span></span><br><span class="line">        <span class="type">Follow</span> <span class="variable">follow</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Follow</span>();</span><br><span class="line">        follow.setUserId(userId);</span><br><span class="line">        follow.setFollowUserId(followUserId);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> save(follow);</span><br><span class="line">        <span class="keyword">if</span>(isSuccess)&#123;</span><br><span class="line">            <span class="comment">//æŠŠå…³æ³¨ç”¨æˆ·çš„idæ”¾å…¥redisçš„seté›†åˆ</span></span><br><span class="line">            stringRedisTemplate.opsForSet().add(key,followUserId.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//3.å–å…³ï¼Œåˆ é™¤è®°å½•</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> remove(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;Follow&gt;()</span><br><span class="line">                .eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;follow_user_id&quot;</span>, followUserId));</span><br><span class="line">        <span class="keyword">if</span>(isSuccess)&#123;</span><br><span class="line">            <span class="comment">//æŠŠå…³æ³¨ç”¨æˆ·çš„idä»Redisç§»é™¤</span></span><br><span class="line">            stringRedisTemplate.opsForSet().remove(key,followUserId.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>å…³æ³¨æ“ä½œ</strong>ï¼šå½“ç”¨æˆ·å…³æ³¨æŸäººæ—¶ï¼Œæˆ‘ä»¬åœ¨æ•°æ®åº“ä¸­æ’å…¥å…³æ³¨è®°å½•ï¼Œå¹¶å°†è¢«å…³æ³¨ç”¨æˆ·çš„ <code>userId</code> å­˜å…¥ Redis çš„ <code>Set</code> é›†åˆã€‚</li><li><strong>å–æ¶ˆå…³æ³¨æ“ä½œ</strong>ï¼šå½“ç”¨æˆ·å–æ¶ˆå…³æ³¨æ—¶ï¼Œæˆ‘ä»¬ä»æ•°æ®åº“åˆ é™¤å¯¹åº”çš„å…³æ³¨è®°å½•ï¼Œå¹¶å°†è¯¥ç”¨æˆ·çš„ <code>userId</code> ä» Redis ä¸­çš„ <code>Set</code> é›†åˆç§»é™¤ã€‚</li></ul><p>ä¸‹é¢è¿›è¡Œç®€å•æµ‹è¯•ï¼Œå…³æ³¨æ—¶æ•°æ®å­˜å…¥redisæ²¡é—®é¢˜ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-305.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-306.png" alt="img"></p><p>ç‚¹å‡»å…±åŒå…³æ³¨æŠ¥é”™ï¼Œä½†å‘å‡ºäº†è¯·æ±‚ï¼ŒåŸå› æ˜¯è¿˜æ²¡ç¼–å†™æ–¹æ³•ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-307-1024x272.png" alt="img"></p><p>å¯ä»¥é€šè¿‡SINTERå‘½ä»¤æ±‚å‡ºäº¤é›†ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-308.png" alt="img"></p><p>åœ¨ <code>FollowController</code> ä¸­æ·»åŠ è·¯ç”±,åœ¨FollowControllerä¸­å†™å…¥ä¸‹é¢ä»£ç ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@GetMapping</span>(<span class="string">&quot;/common/&#123;id&#125;&quot;</span>)</span><br><span class="line">public Result <span class="built_in">followCommons</span>(<span class="variable">@PathVariable</span>(<span class="string">&quot;id&quot;</span>) Long id)&#123;</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">followService</span><span class="selector-class">.followCommons</span>(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>IFollowService</code> æ¥å£ä¸­å£°æ˜,åœ¨IFollowServiceä¸­å†™å…¥ä¸‹é¢ä»£ç ï¼š</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable"><span class="class">Result</span></span> <span class="function"><span class="title">followCommons</span>(<span class="variable">Long</span> <span class="variable">id</span>);</span></span><br></pre></td></tr></table></figure><p>åœ¨ <code>FollowServiceImpl</code> ç±»ä¸­å®ç°,åœ¨FollowServiceImplç±»ä¸­å†™å…¥ä¸‹é¢ä»£ç ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line"><span class="keyword">public</span> Result followCommons(<span class="keyword">Long</span> id) &#123;</span><br><span class="line">    <span class="comment">//æ±‚çš„æ˜¯ç›®æ ‡ç”¨æˆ·å’Œå½“å‰ç”¨æˆ·å…³æ³¨çš„äº¤é›†</span></span><br><span class="line">    <span class="comment">//1.è·å–key</span></span><br><span class="line">    <span class="keyword">Long</span> userId = UserHolder.getUser().getId();</span><br><span class="line">    String key1 = <span class="string">&quot;follows:&quot;</span>+userId; <span class="comment">// å½“å‰ç”¨æˆ·å…³æ³¨çš„é›†åˆ</span></span><br><span class="line">    String key2 = <span class="string">&quot;follows:&quot;</span>+id; <span class="comment">// ç›®æ ‡ç”¨æˆ·å…³æ³¨çš„é›†åˆ</span></span><br><span class="line">    <span class="comment">//2.ä½¿ç”¨Redisçš„SINTERå‘½ä»¤æ±‚äº¤é›†</span></span><br><span class="line">    Set&lt;String&gt; <span class="keyword">intersect</span> = stringRedisTemplate.opsForSet().<span class="keyword">intersect</span>(key1, key2);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">intersect</span>==<span class="keyword">null</span>||<span class="keyword">intersect</span>.isEmpty())&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.ok(Collections.emptyList());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//3.è§£æidé›†åˆ,å°†äº¤é›†ä¸­çš„ç”¨æˆ·IDè½¬æ¢æˆLongç±»å‹</span></span><br><span class="line">    List&lt;<span class="keyword">Long</span>&gt; ids = <span class="keyword">intersect</span>.stream().map(<span class="keyword">Long</span>::valueOf).<span class="keyword">collect</span>(Collectors.<span class="keyword">toList</span>());</span><br><span class="line">    <span class="comment">//4. æŸ¥è¯¢å…±åŒå…³æ³¨çš„ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">    List&lt;UserDTO&gt; users = userService.listByIds(ids)</span><br><span class="line">            .stream()</span><br><span class="line">            .map(user -&gt; BeanUtil.copyProperties(user, UserDTO.<span class="keyword">class</span>))</span><br><span class="line">            .<span class="keyword">collect</span>(Collectors.<span class="keyword">toList</span>());</span><br><span class="line">    <span class="keyword">return</span> Result.ok(users);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è·å–å…±åŒå…³æ³¨ç”¨æˆ·</strong>ï¼šé¦–å…ˆï¼Œæˆ‘ä»¬è·å–å½“å‰ç”¨æˆ·å’Œç›®æ ‡ç”¨æˆ·çš„å…³æ³¨åˆ—è¡¨ï¼ˆå­˜å‚¨åœ¨ Redis çš„ <code>Set</code> é›†åˆä¸­ï¼‰ï¼Œç„¶åä½¿ç”¨ <code>SINTER</code> å‘½ä»¤è·å–å®ƒä»¬çš„äº¤é›†ï¼ˆå³å…±åŒå…³æ³¨çš„ç”¨æˆ·ï¼‰ã€‚æ¥ç€ï¼Œæˆ‘ä»¬å°†è¿™äº›ç”¨æˆ·IDæŸ¥è¯¢å‡ºæ¥ï¼Œå¹¶è¿”å›ç”¨æˆ·ä¿¡æ¯ã€‚</p><p>åƒæˆ‘ç°åœ¨å…³æ³¨çš„æ˜¯å°é±¼åŒå­¦å’Œå¯å¯ä»Šå¤©ä¸åƒè‚‰ã€‚æ¥ä¸‹æ¥æ¢å·ï¼Œæ¢æˆå°é±¼åŒå­¦ï¼Œç”µè¯ï¼š13686869696ï¼Œè®©å°é±¼åŒå­¦å…³æ³¨æˆ‘å’Œå¯å¯ä»Šå¤©ä¸åƒè‚‰ã€‚ä»¥å°é±¼åŒå­¦çš„è§†è§’æ¥æŸ¥çœ‹æˆ‘ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å…±åŒå…³æ³¨äº†å¯å¯ä»Šå¤©ä¸åƒè‚‰ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-309.png" alt="img"></p><h3 id="9-3-å¥½å‹å…³æ³¨-Feedæµå®ç°æ–¹æ¡ˆ">9.3 å¥½å‹å…³æ³¨-Feedæµå®ç°æ–¹æ¡ˆ</h3><p><strong>Feedæµ</strong>ï¼Œå³åŠ¨æ€æ¶ˆæ¯æµï¼Œæ˜¯ç¤¾äº¤å¹³å°ç”¨æ¥ä¸ºç”¨æˆ·æŒç»­æä¾›å†…å®¹çš„ä¸€ç§æ–¹å¼ã€‚é€šè¿‡Feedæµï¼Œç”¨æˆ·èƒ½å¤Ÿæ— éœ€ä¸»åŠ¨æŸ¥æ‰¾ï¼Œç³»ç»Ÿè‡ªåŠ¨æ¨é€ç¬¦åˆå…¶å…´è¶£çš„å†…å®¹ï¼Œæä¾›æ›´åŠ æ²‰æµ¸å¼çš„ä½“éªŒã€‚å¸¸è§çš„ä¾‹å­æœ‰ç¤¾äº¤ç½‘ç»œçš„åŠ¨æ€æ—¶é—´çº¿ï¼ˆTimelineï¼‰ï¼Œä¾‹å¦‚Facebookã€Instagramã€Twitterç­‰ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-310.png" alt="img"></p><h4 id="Feedæµçš„ä¸¤ç§æ¨¡å¼ï¼š"><strong>Feedæµçš„ä¸¤ç§æ¨¡å¼ï¼š</strong></h4><ol><li><p>Timelineæ¨¡å¼</p><p>ï¼š</p><ul><li><strong>å®šä¹‰</strong>ï¼šä¸å¯¹å†…å®¹è¿›è¡Œç­›é€‰ï¼ŒæŒ‰å†…å®¹çš„å‘å¸ƒæ—¶é—´æ’åºï¼Œé€šå¸¸ç”¨äºå¥½å‹æˆ–å…³æ³¨çš„äººå‘å¸ƒçš„å†…å®¹ï¼Œä¾‹å¦‚ç¤¾äº¤å¹³å°çš„åŠ¨æ€ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šä¿¡æ¯å…¨é¢ï¼Œä¸ä¼šç¼ºå¤±ä»»ä½•å†…å®¹ï¼›å®ç°è¾ƒä¸ºç®€å•ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šå¯èƒ½å­˜åœ¨ä¿¡æ¯å™ªéŸ³ï¼Œç”¨æˆ·æœªå¿…æ„Ÿå…´è¶£ï¼Œå¯¼è‡´å†…å®¹è·å–æ•ˆç‡ä½ã€‚</li></ul></li><li><p>æ™ºèƒ½æ’åº</p><p>ï¼š</p><ul><li><strong>å®šä¹‰</strong>ï¼šé€šè¿‡æ™ºèƒ½ç®—æ³•ç­›é€‰å‡ºç”¨æˆ·æ„Ÿå…´è¶£çš„å†…å®¹ï¼ŒåŒæ—¶å±è”½æ‰è¿è§„æˆ–ä¸æ„Ÿå…´è¶£çš„å†…å®¹ã€‚è¿™æ ·ï¼Œç³»ç»Ÿæ¨é€çš„å†…å®¹æ›´ç¬¦åˆç”¨æˆ·çš„åå¥½ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šç”¨æˆ·èƒ½å¤Ÿè·å¾—æ›´ç¬¦åˆå…¶å…´è¶£çš„å†…å®¹ï¼Œå¢åŠ ç”¨æˆ·ç²˜æ€§ï¼Œå¯èƒ½è®©ç”¨æˆ·æ›´æ²‰æµ¸åœ¨å¹³å°å†…ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šå¦‚æœæ¨èç®—æ³•ä¸å‡†ç¡®ï¼Œå¯èƒ½ä¼šè¯¯æ¨é€ä¸ç›¸å…³æˆ–è®©ç”¨æˆ·ä¸æ»¡æ„çš„å†…å®¹ã€‚</li></ul></li></ol><p>æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ <strong>Timelineæ¨¡å¼</strong>ï¼Œå³åŸºäºç”¨æˆ·å…³æ³¨çš„å¥½å‹ä¿¡æ¯ï¼ŒæŒ‰ç…§æ—¶é—´é¡ºåºå±•ç¤ºå†…å®¹ã€‚</p><p>å› æ­¤é‡‡ç”¨Timelineçš„æ¨¡å¼ã€‚è¯¥æ¨¡å¼çš„å®ç°æ–¹æ¡ˆæœ‰ä¸‰ç§ï¼š</p><ul><li>æ‹‰æ¨¡å¼</li><li>æ¨æ¨¡å¼</li><li>æ¨æ‹‰ç»“åˆ</li></ul><p><strong>æ‹‰æ¨¡å¼</strong>ï¼šä¹Ÿå«åšè¯»æ‰©æ•£</p><p>è¯¥æ¨¡å¼çš„æ ¸å¿ƒå«ä¹‰å°±æ˜¯ï¼šå½“ç”¨æˆ·æƒ³æŸ¥çœ‹å¥½å‹çš„åŠ¨æ€æ—¶ï¼Œç³»ç»Ÿä¼šä»ç”¨æˆ·å…³æ³¨çš„å¥½å‹ä¸­æ‹‰å–æœ€æ–°çš„å†…å®¹ã€‚ç³»ç»Ÿä¼šæ ¹æ®ç”¨æˆ·å…³æ³¨çš„äººç¾¤ï¼Œæ‹‰å–è¿™äº›äººå‘å¸ƒçš„ä¿¡æ¯ï¼Œå¹¶è¿›è¡Œæ’åºã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li><strong>èŠ‚çº¦ç©ºé—´</strong>ï¼šæ•°æ®ä»…åœ¨ç”¨æˆ·éœ€è¦æ—¶æ‰è¿›è¡Œè¯»å–ï¼Œå‡å°‘äº†é‡å¤å­˜å‚¨ã€‚</li><li>ç”¨æˆ·è¯»å–å®Œä¿¡æ¯åï¼Œå¯ä»¥æ¸…ç©ºæ”¶ä»¶ç®±ï¼Œé¿å…å­˜å‚¨å¤§é‡æœªè¯»æ•°æ®ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li><strong>å»¶è¿Ÿæ€§</strong>ï¼šç”¨æˆ·åœ¨è¯»å–ä¿¡æ¯æ—¶æ‰ä¼šå»æ‹‰å–ï¼Œè‹¥ç”¨æˆ·å…³æ³¨äº†å¤§é‡çš„äººï¼Œç³»ç»Ÿå¯èƒ½éœ€è¦ä¸€æ¬¡æ€§æ‹‰å–å¤§é‡çš„å†…å®¹ï¼Œå¢åŠ æœåŠ¡å™¨è´Ÿæ‹…ã€‚</li><li>åœ¨æ•°æ®é‡å¤§æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´å»¶æ—¶è¾ƒé«˜ã€‚</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-311-1024x443.png" alt="img"></p><p><strong>æ¨æ¨¡å¼</strong>ï¼šä¹Ÿå«åšå†™æ‰©æ•£ã€‚</p><p>å½“ç”¨æˆ·ï¼ˆå¦‚åšä¸»ï¼‰å‘å¸ƒæ–°çš„å†…å®¹æ—¶ï¼Œç³»ç»Ÿä¼šä¸»åŠ¨å°†å†…å®¹æ¨é€åˆ°å…³æ³¨ä»–çš„ç²‰ä¸çš„æ”¶ä»¶ç®±ä¸­ã€‚è¿™é¿å…äº†ç”¨æˆ·æ¯æ¬¡éƒ½è¦å»æ‹‰å–æ•°æ®ã€‚</p><p>ä¼˜ç‚¹ï¼šæ—¶æ•ˆå¿«ï¼Œä¸ç”¨ä¸´æ—¶æ‹‰å–</p><p>ç¼ºç‚¹ï¼šå†…å­˜å‹åŠ›å¤§ï¼Œå‡è®¾ä¸€ä¸ªå¤§Vå†™ä¿¡æ¯ï¼Œå¾ˆå¤šäººå…³æ³¨ä»–ï¼Œ å°±ä¼šå†™å¾ˆå¤šåˆ†æ•°æ®åˆ°ç²‰ä¸é‚£è¾¹å»</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-312.png" alt="img"></p><p><strong>æ¨æ‹‰ç»“åˆæ¨¡å¼</strong>ï¼šä¹Ÿå«åšè¯»å†™æ··åˆï¼Œå…¼å…·æ¨å’Œæ‹‰ä¸¤ç§æ¨¡å¼çš„ä¼˜ç‚¹ã€‚</p><p>æ¨æ‹‰æ¨¡å¼æ˜¯ä¸€ä¸ªæŠ˜ä¸­çš„æ–¹æ¡ˆ</p><ul><li><strong>æ™®é€šç”¨æˆ·</strong>ï¼šæ™®é€šç”¨æˆ·å‘å¸ƒçš„å†…å®¹ä¼šç›´æ¥æ¨é€åˆ°å…¶ç²‰ä¸çš„æ”¶ä»¶ç®±ä¸­ã€‚</li><li><strong>å¤§Vç”¨æˆ·</strong>ï¼šå¯¹äºå¤§Vï¼Œç³»ç»Ÿä¼šå…ˆå°†å…¶å†…å®¹å†™å…¥åˆ°å‘ä»¶ç®±ï¼Œå†å°†å†…å®¹æ¨é€åˆ°æ´»è·ƒç²‰ä¸çš„æ”¶ä»¶ç®±ä¸­ï¼›å¯¹äºä¸æ´»è·ƒçš„ç²‰ä¸ï¼Œå†…å®¹ä¼šå­˜å…¥å‘ä»¶ç®±ï¼Œç­‰ä»–ä»¬ä¸Šçº¿æ—¶å†æ‹‰å–ã€‚</li></ul><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li><strong>æŠ˜ä¸­æ–¹æ¡ˆ</strong>ï¼šæ—¢æœ‰æ¨é€çš„å®æ—¶æ€§ï¼Œåˆèƒ½é¿å…å¤§Vè´¦å·äº§ç”Ÿè¿‡å¤§å†…å­˜å‹åŠ›ã€‚</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-313-1024x454.png" alt="img"></p><h3 id="9-4-å¥½å‹å…³æ³¨-æ¨é€åˆ°ç²‰ä¸æ”¶ä»¶ç®±">9.4 å¥½å‹å…³æ³¨-æ¨é€åˆ°ç²‰ä¸æ”¶ä»¶ç®±</h3><p>éœ€æ±‚ï¼š</p><ul><li>ä¿®æ”¹æ–°å¢æ¢åº—ç¬”è®°çš„ä¸šåŠ¡ï¼Œåœ¨ä¿å­˜blogåˆ°æ•°æ®åº“çš„åŒæ—¶ï¼Œæ¨é€åˆ°ç²‰ä¸çš„æ”¶ä»¶ç®±</li><li>æ”¶ä»¶ç®±æ»¡è¶³å¯ä»¥æ ¹æ®æ—¶é—´æˆ³æ’åºï¼Œå¿…é¡»ç”¨Redisçš„æ•°æ®ç»“æ„å®ç°</li><li>æŸ¥è¯¢æ”¶ä»¶ç®±æ•°æ®æ—¶ï¼Œå¯ä»¥å®ç°åˆ†é¡µæŸ¥è¯¢</li></ul><p>Feedæµä¸­çš„æ•°æ®ä¼šä¸æ–­æ›´æ–°ï¼Œæ‰€ä»¥æ•°æ®çš„è§’æ ‡ä¹Ÿåœ¨å˜åŒ–ï¼Œå› æ­¤ä¸èƒ½é‡‡ç”¨ä¼ ç»Ÿçš„åˆ†é¡µæ¨¡å¼ã€‚</p><p>ä¼ ç»Ÿäº†åˆ†é¡µåœ¨feedæµæ˜¯ä¸é€‚ç”¨çš„ï¼Œå› ä¸ºæˆ‘ä»¬çš„æ•°æ®ä¼šéšæ—¶å‘ç”Ÿå˜åŒ–</p><p>æƒ…æ™¯è§£é‡Š</p><ul><li>å‡è®¾ä½ é¦–å…ˆè¯·æ±‚äº†åŠ¨æ€çš„ç¬¬ä¸€é¡µï¼ˆ<code>page=1</code>ï¼Œæ¯é¡µ5æ¡æ•°æ®ï¼‰ï¼Œç„¶åä½ ä¼šå¾—åˆ°ç±»ä¼¼10ã€11ã€12ã€13ã€14è¿™æ ·çš„æ•°æ®ã€‚</li><li>æ¥ç€ä½ è¯·æ±‚ç¬¬äºŒé¡µï¼ˆ<code>page=2</code>ï¼‰ï¼Œä½ ä¼šæœŸæœ›å¾—åˆ°æ¥ä¸‹æ¥çš„æ•°æ®ï¼ˆä¾‹å¦‚15ã€16ã€17ç­‰ï¼‰ã€‚</li><li>ç„¶è€Œï¼Œå¦‚æœåœ¨ä½ è¯·æ±‚æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼ŒåŠ¨æ€æµï¼ˆfeedï¼‰æœ‰æ–°å†…å®¹å‘å¸ƒï¼Œé‚£ä¹ˆä½ çš„è¯·æ±‚å°±å¯èƒ½ä¼šè·å–åˆ°ä¸ä¸€è‡´çš„æ•°æ®ã€‚</li></ul><p><strong>æ½œåœ¨é—®é¢˜</strong>ï¼š</p><ul><li>å¦‚æœç¬¬ä¸€é¡µçš„æ•°æ®æ˜¯åœ¨<code>t1</code>æ—¶åˆ»è¯·æ±‚çš„ï¼Œè€Œæ–°æ•°æ®ï¼ˆæ¯”å¦‚â€œFeed: 11â€ï¼‰æ˜¯åœ¨<code>t3</code>æ—¶åˆ»å‘å¸ƒçš„ï¼Œé‚£ä¹ˆç¬¬äºŒé¡µè·å–çš„æ•°æ®å¯èƒ½ä¼šå’Œç¬¬ä¸€é¡µé‡å ã€‚</li><li>è¿™ä¼šå¯¼è‡´åˆ†é¡µæ•°æ®çš„é‡å¤æˆ–è€…é”™ä¹±ï¼Œå› ä¸ºFeedåœ¨æ›´æ–°æ—¶ï¼Œæ•°æ®ä¼šå‘ç”Ÿå˜åŒ–ã€‚</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-314-1024x454.png" alt="img"></p><p>Feedæµçš„æ»šåŠ¨åˆ†é¡µ</p><ul><li>è¿™é‡Œæå‡ºçš„è§£å†³æ–¹æ³•æ˜¯è®°å½•æ¯æ¬¡è¯·æ±‚çš„æœ€åä¸€ä¸ªæ•°æ®IDï¼ˆ<code>lastId</code>ï¼‰ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿æ¯æ¬¡åˆ†é¡µè¯·æ±‚éƒ½çŸ¥é“ä»å“ªé‡Œå¼€å§‹è·å–æ•°æ®ã€‚</li><li>æ¯”å¦‚ï¼Œå¦‚æœä½ å·²ç»è·å–åˆ°çš„æœ€åä¸€ä¸ªIDæ˜¯<code>6</code>ï¼Œé‚£ä¹ˆç¬¬äºŒé¡µçš„æ•°æ®åº”è¯¥ä»IDä¸º<code>6</code>çš„ä¸‹ä¸€æ¡æ•°æ®å¼€å§‹ï¼Œè¿™æ ·å¯ä»¥é¿å…é‡å¤è·å–å·²è¯»è¿‡çš„æ•°æ®ã€‚</li></ul><p>ä¸¾ä¸ªä¾‹å­ï¼šæˆ‘æ¯æ¬¡è¯·æ±‚æ—¶ï¼Œä¿å­˜å½“å‰æœ€åè¯»å–çš„æ•°æ®IDã€‚</p><p>å½“è¯·æ±‚ä¸‹ä¸€é¡µæ—¶ï¼Œé€šè¿‡<code>lastId</code>æ¥ç¡®è®¤ä»å“ªé‡Œç»§ç»­è¯»å–æ•°æ®ï¼Œç¡®ä¿ä¸ä¼šé‡å¤æˆ–è€…é—æ¼ã€‚</p><p>è¿™ç§æ–¹å¼ç¡®ä¿äº†åˆ†é¡µçš„æ•°æ®ä¸ä¼šå—åŠ¨æ€æµä¸­é—´æ›´æ–°çš„å½±å“ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-315-1024x536.png" alt="img"></p><p>æ ¸å¿ƒçš„æ„æ€ï¼šå°±æ˜¯æˆ‘ä»¬åœ¨ä¿å­˜å®Œæ¢åº—ç¬”è®°åï¼Œè·å¾—åˆ°å½“å‰ç¬”è®°çš„ç²‰ä¸ï¼Œç„¶åæŠŠæ•°æ®æ¨é€åˆ°ç²‰ä¸çš„redisä¸­å»ã€‚</p><p>åœ¨BlogControlleré‡Œé¢å†™å…¥å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">saveBlog</span><span class="params">(<span class="meta">@RequestBody</span> Blog blog)</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> UserHolder.getUser();</span><br><span class="line">    blog.setUserId(user.getId());</span><br><span class="line">    <span class="comment">// ä¿å­˜æ¢åº—åšæ–‡</span></span><br><span class="line">    blogService.saveBlog(blog);</span><br><span class="line">    <span class="comment">// è¿”å›id</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(blog.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨IBlogServiceæ¥å£é‡Œé¢å†™å…¥å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable"><span class="class">Result</span></span> <span class="function"><span class="title">saveBlog</span>(<span class="variable">Blog</span> <span class="variable">blog</span>);</span></span><br></pre></td></tr></table></figure><p>åœ¨BlogServiceImplç±»ä¸­å†™å…¥å¦‚ä¸‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">saveBlog</span><span class="params">(Blog blog)</span> &#123;</span><br><span class="line">    <span class="comment">//1.è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> UserHolder.getUser();</span><br><span class="line">    blog.setUserId(user.getId());</span><br><span class="line">    <span class="comment">//2.ä¿å­˜æ¢åº—ç¬”è®°</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> save(blog);</span><br><span class="line">    <span class="keyword">if</span>(!isSuccess)&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;æ–°å¢ç¬”è®°å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//3.æŸ¥è¯¢ç¬”è®°ä½œä¸šçš„æ‰€æœ‰ç²‰ä¸</span></span><br><span class="line">    <span class="comment">//select * from tb_follow where follow_user_id = ?</span></span><br><span class="line">    List&lt;Follow&gt; follows = followService.query().eq(<span class="string">&quot;follow_user_id&quot;</span>, user.getId()).list();</span><br><span class="line">    <span class="comment">//4.æ¨é€ç¬”è®°idç»™ç²‰ä¸</span></span><br><span class="line">    <span class="keyword">for</span>(Follow follow : follows)&#123;</span><br><span class="line">        <span class="comment">//4.1.è·å–ç²‰ä¸id</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> follow.getUserId();</span><br><span class="line">        <span class="comment">//4.2.æ¨é€åˆ°ç²‰ä¸æ”¶ä»¶ç®±æ˜¯sortedSet</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;feed::&quot;</span>+userId;</span><br><span class="line">        stringRedisTemplate.opsForZSet().add(key,blog.getId().toString(),System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è¿”å›id</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(blog.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9-5å¥½å‹å…³æ³¨-å®ç°åˆ†é¡µæŸ¥è¯¢æ”¶é‚®ç®±çš„æ€è·¯">9.5å¥½å‹å…³æ³¨-å®ç°åˆ†é¡µæŸ¥è¯¢æ”¶é‚®ç®±çš„æ€è·¯</h3><p>ZRANGEæ˜¯æŒ‰ç…§è§’æ ‡ä»å°åˆ°å¤§æ’åºï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-316.png" alt="img"></p><p>è¿™ä¸ªå‘½ä»¤è¿”å›ä¸€ä¸ªæœ‰åºé›†åˆä¸­æˆå‘˜çš„èŒƒå›´ï¼Œå¯ä»¥æ ¹æ®ç»™å®šçš„æœ€å°å€¼å’Œæœ€å¤§å€¼æ¥é™åˆ¶è¿”å›çš„å…ƒç´ ã€‚</p><p>ZREVRANGEæ˜¯æŒ‰ç…§è§’æ ‡ä»å¤§åˆ°å°æ’åºï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-317.png" alt="img"></p><p>è¿™ä¸ªå‘½ä»¤ä¸ <code>ZRANGE</code> ç±»ä¼¼ï¼Œä¸è¿‡å®ƒæ˜¯å€’åºè¿”å›é›†åˆä¸­çš„å…ƒç´ ã€‚</p><p>ZREVRANGEBYSCOREæ˜¯æŒ‰ç…§åˆ†æ•°ä»å¤§åˆ°å°æ’åºï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-318.png" alt="img"></p><p>è¿™ä¸ªå‘½ä»¤æ ¹æ®åˆ†æ•°è¿›è¡Œè¿‡æ»¤ï¼Œè¿”å›åˆ†æ•°èŒƒå›´å†…çš„æˆå‘˜ï¼Œé€šå¸¸ç”¨æ¥å¤„ç†æ—¶é—´çº¿æˆ–è€…æ’åä¹‹ç±»çš„æ•°æ®ã€‚</p><p>æ»šåŠ¨æŸ¥è¯¢ï¼šæ¯æ¬¡åˆ†é¡µæŸ¥è¯¢éƒ½ä¼šè·å–ä¸Šä¸€æ¬¡æŸ¥è¯¢è¿”å›çš„æœ€å°å€¼ï¼Œå¹¶å°†å…¶ä½œä¸ºä¸‹ä¸€æ¬¡æŸ¥è¯¢çš„æœ€å¤§å€¼ã€‚è¿™æ ·ç¡®ä¿æ¯æ¬¡æŸ¥è¯¢è¿”å›çš„æ•°æ®æ˜¯è¿ç»­çš„ï¼Œä¸ä¼šé‡å¤æˆ–è€…é—æ¼ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-319.png" alt="img"></p><p>ä¾‹å¦‚ï¼Œå½“ä½ ä½¿ç”¨ <code>ZRANGE</code> æˆ– <code>ZREVRANGE</code> è¿›è¡Œåˆ†é¡µæŸ¥è¯¢æ—¶ï¼Œä½ å¯ä»¥è®¾ç½® <code>LIMIT</code> å‚æ•°æ¥é™åˆ¶è¿”å›çš„ç»“æœæ•°é‡ã€‚ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ—¶ï¼Œä½ ä¼šä»ç¬¬ä¸€ä¸ªæˆå‘˜å¼€å§‹ï¼Œåç»­æ¯æ¬¡æŸ¥è¯¢ä¼šæ ¹æ®ä¸Šä¸€æ¬¡æŸ¥è¯¢çš„ç»“æœæ¥è°ƒæ•´å¼€å§‹çš„åœ°æ–¹ã€‚</p><p>è§„å¾‹ï¼šåˆ†æ•°æœ€å°å€¼å’ŒæŸ¥çš„æ•°é‡å›ºå®šä¸å˜ã€‚æœ€å¤§å€¼ä¸ºä¸Šä¸€æ¬¡æŸ¥è¯¢çš„æœ€å°å€¼ã€åç§»é‡ç¬¬1æ¬¡ç»™0ï¼Œç¬¬1æ¬¡åç»™åœ¨ä¸Šä¸€æ¬¡çš„ç»“æœä¸­ï¼Œä¸æœ€å°å€¼ä¸€æ ·çš„å…ƒç´ çš„ä¸ªæ•°ã€‚</p><p>å½“åˆ†æ•°ä¸€è‡´å‡ºç°é—®é¢˜ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-320.png" alt="img"></p><ul><li>åˆ†æ•°ç›¸åŒçš„æˆå‘˜å°†è¢«è§†ä¸ºå…·æœ‰ç›¸åŒçš„é¡ºåºã€‚</li><li>å½“åˆ†æ•°ç›¸åŒçš„æˆå‘˜å‡ºç°åœ¨ä¸¤æ¬¡åˆ†é¡µæŸ¥è¯¢çš„ç»“æœä¸­æ—¶ï¼Œå®ƒä»¬ä¼šæŒ‰ç…§ç¬¬ä¸€æ¬¡æŸ¥è¯¢çš„ç»“æœé¡ºåºè¢«è¿”å›ã€‚</li><li>æ¯”å¦‚ï¼Œå½“ç¬¬ä¸€æ¬¡æŸ¥è¯¢è¿”å›åˆ†æ•°ä¸º 6 çš„æˆå‘˜æ—¶ï¼Œç¬¬äºŒæ¬¡æŸ¥è¯¢ä¼šç»§ç»­è¿”å›åˆ†æ•°ä¸º 6 çš„æˆå‘˜ï¼Œè¿™æ ·ä¿è¯äº†åˆ†é¡µçš„è¿ç»­æ€§ã€‚</li></ul><p>å¦‚æœ <code>z1</code> é›†åˆä¸­æœ‰å‡ ä¸ªåˆ†æ•°ä¸º <code>6</code> çš„å…ƒç´ ï¼Œç¬¬ä¸€æ¬¡æŸ¥è¯¢è¿”å›äº†è¿™äº›å…ƒç´ åï¼Œä¸‹ä¸€æ¬¡æŸ¥è¯¢ä¼šä»ä¸Šä¸€æ¬¡æŸ¥è¯¢çš„ç»“æœç»§ç»­è·å–æ•°æ®ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-321.png" alt="img"></p><h3 id="9-6å¥½å‹å…³æ³¨-å®ç°æ»šåŠ¨åˆ†é¡µæŸ¥è¯¢">9.6å¥½å‹å…³æ³¨-å®ç°æ»šåŠ¨åˆ†é¡µæŸ¥è¯¢</h3><p>éœ€æ±‚ï¼šåœ¨å®ç°<strong>æ»šåŠ¨åˆ†é¡µæŸ¥è¯¢</strong>æ—¶ï¼Œç›®çš„æ˜¯åœ¨ç”¨æˆ·çš„ä¸ªäººä¸»é¡µå±•ç¤ºä»–ä»¬å…³æ³¨çš„åšå®¢å†…å®¹ã€‚æ¯æ¬¡æŸ¥è¯¢è¿”å›ä¸€å®šæ•°é‡çš„æ•°æ®ï¼ŒåŒæ—¶å°†æœ€å°æ—¶é—´æˆ³å’Œåç§»é‡ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ä¼ é€’ç»™ä¸‹ä¸€æ¬¡æŸ¥è¯¢ã€‚</p><p>å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</p><p>1.<strong>è·å–æœ€å°æ—¶é—´æˆ³</strong>ï¼šæ¯æ¬¡æŸ¥è¯¢ç»“æŸåï¼Œåˆ†æå‡ºè¿”å›æ•°æ®ä¸­çš„æœ€å°æ—¶é—´æˆ³ï¼Œè¿™ä¸ªæ—¶é—´æˆ³å°†ä½œä¸ºä¸‹ä¸€æ¬¡æŸ¥è¯¢çš„æ¡ä»¶ï¼Œç”¨äºè·å–æ¯”å½“å‰æŸ¥è¯¢æ—¶é—´æ›´æ–°çš„åšå®¢ã€‚</p><p>2.<strong>è®¡ç®—åç§»é‡</strong>ï¼šåç§»é‡æ˜¯ä¸Šæ¬¡æŸ¥è¯¢ä¸­è¿”å›çš„æ•°æ®æ¡ç›®æ•°ï¼Œç›®çš„æ˜¯è·³è¿‡å·²ç»æŸ¥è¯¢è¿‡çš„æ•°æ®ï¼Œä»è€Œç¡®ä¿æ¯æ¬¡æŸ¥è¯¢éƒ½èƒ½è·å–æ–°çš„æ•°æ®ã€‚</p><p>3.<strong>è¯·æ±‚å‚æ•°</strong>ï¼šæ¯æ¬¡è¯·æ±‚æ—¶éœ€è¦æºå¸¦ <code>lastId</code>ï¼ˆå³ä¸Šä¸€æ¬¡æŸ¥è¯¢çš„æœ€å°æ—¶é—´æˆ³ï¼‰å’Œ <code>offset</code>ï¼ˆå³åç§»é‡ï¼‰è¿™ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ—¶ï¼Œå‰ç«¯ä¼šæŒ‡å®šè¿™ä¸¤ä¸ªå‚æ•°ï¼Œä¹‹åçš„æŸ¥è¯¢ç”±åå°æ ¹æ®ä¸Šä¸€æ¬¡çš„æŸ¥è¯¢ç»“æœè¿›è¡Œä¼ é€’ã€‚</p><p>ç»¼ä¸Šï¼šæˆ‘ä»¬çš„è¯·æ±‚å‚æ•°ä¸­å°±éœ€è¦æºå¸¦ lastIdï¼šä¸Šä¸€æ¬¡æŸ¥è¯¢çš„æœ€å°æ—¶é—´æˆ³ å’Œåç§»é‡è¿™ä¸¤ä¸ªå‚æ•°ã€‚</p><p>è¿™ä¸¤ä¸ªå‚æ•°ç¬¬ä¸€æ¬¡ä¼šç”±å‰ç«¯æ¥æŒ‡å®šï¼Œä»¥åçš„æŸ¥è¯¢å°±æ ¹æ®åå°ç»“æœä½œä¸ºæ¡ä»¶ï¼Œå†æ¬¡ä¼ é€’åˆ°åå°ã€‚</p><p>é¦–å…ˆå®šä¹‰å‡ºæ¥å…·ä½“çš„è¿”å›å€¼å®ä½“ç±»</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScrollResult</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">List</span>&lt;<span class="string">?&gt;</span> list;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Long</span> minTime;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Integer</span> offset;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ScrollResult</code> ç±»ç”¨äºå°è£…æŸ¥è¯¢ç»“æœï¼ŒåŒ…å«ä¸‰ä¸ªå­—æ®µï¼š</p><ul><li><code>list</code>ï¼šå­˜å‚¨æŸ¥è¯¢åˆ°çš„åšå®¢åˆ—è¡¨ã€‚</li><li><code>minTime</code>ï¼šæœ¬æ¬¡æŸ¥è¯¢è¿”å›æ•°æ®ä¸­çš„æœ€å°æ—¶é—´æˆ³ï¼Œç”¨äºä¸‹ä¸€æ¬¡æŸ¥è¯¢çš„æ¡ä»¶ã€‚</li><li><code>offset</code>ï¼šåç§»é‡ï¼Œè¡¨ç¤ºè¿™æ¬¡æŸ¥è¯¢è¿”å›çš„æ•°æ®æ•°é‡ï¼Œä¸‹ä¸€æ¬¡æŸ¥è¯¢éœ€è¦è·³è¿‡è¿™äº›æ•°æ®ã€‚</li></ul><p>åœ¨BlogControllerä¸­å†™å…¥ä¸‹é¢ä»£ç ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@GetMapping</span>(<span class="string">&quot;/of/follow&quot;</span>)</span><br><span class="line">public Result <span class="built_in">queryBlogOfFollow</span>(<span class="variable">@RequestParam</span>(<span class="string">&quot;lastId&quot;</span>) Long max,<span class="variable">@RequestParam</span>(value = <span class="string">&quot;offset&quot;</span>,defaultValue = <span class="string">&quot;0&quot;</span>) Integer offset) &#123;</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">blogService</span><span class="selector-class">.queryBlogOfFollow</span>(max,offset);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥å£æ¥æ”¶ä¸¤ä¸ªè¯·æ±‚å‚æ•°ï¼š</p><ul><li><code>lastId</code>ï¼šä¸Šæ¬¡æŸ¥è¯¢çš„æœ€å°æ—¶é—´æˆ³ã€‚</li><li><code>offset</code>ï¼šæœ¬æ¬¡æŸ¥è¯¢çš„åç§»é‡ï¼Œé»˜è®¤å€¼ä¸º 0ã€‚</li></ul><p>åœ¨IBlogServiceå†™å…¥å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Result</span> queryBlogOfFollow(Long max, <span class="type">Integer</span> <span class="keyword">offset</span>);</span><br></pre></td></tr></table></figure><p>åœ¨BlogServiceImplä¸­å†™å…¥å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public Result queryB<span class="keyword">log</span>OfFollow(Long <span class="keyword">max</span>, Integer offset) &#123;</span><br><span class="line">    //<span class="number">1</span>.è·å–å½“å‰ç”¨æˆ·</span><br><span class="line">    Long <span class="keyword">user</span>Id = UserHolder.getUser().getId();</span><br><span class="line">    //<span class="number">2</span>.æŸ¥è¯¢æ”¶ä»¶ç®± ZREVRANGEBYSCORE key Max M<span class="keyword">in</span> LIMIT offset count</span><br><span class="line">    String key = FEED_KEY+<span class="keyword">user</span>Id;</span><br><span class="line">    Set<span class="variable">&lt;ZSetOperations.TypedTuple&lt;String&gt;</span>&gt; typedTuples = stringRedisTemplate.opsForZSet()</span><br><span class="line">            .reverseRangeByScoreWithScores(key, <span class="number">0</span>, <span class="keyword">max</span>, offset, <span class="number">3</span>);</span><br><span class="line">    //<span class="number">2.1</span>.éç©ºåˆ¤æ–­</span><br><span class="line">    if(typedTuples==null || typedTuples.isEmpty())&#123;</span><br><span class="line">        return Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line">    //<span class="number">3</span>.è§£ææ•°æ®ï¼šblogIdã€<span class="keyword">min</span>Time(æ—¶é—´æˆ³)ã€offset</span><br><span class="line">    List<span class="variable">&lt;Long&gt;</span> ids = new ArrayList<span class="variable">&lt;&gt;</span>(typedTuples.size());</span><br><span class="line">    long <span class="keyword">min</span>Time = <span class="number">0</span>;</span><br><span class="line">    int <span class="keyword">os</span> = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(ZSetOperations.TypedTuple<span class="variable">&lt;String&gt;</span> tuple:typedTuples)&#123;</span><br><span class="line">        //<span class="number">4.1</span>.è·å–id</span><br><span class="line">        String idStr = tuple.getValue();</span><br><span class="line">        ids.add(Long.valueOf(idStr));</span><br><span class="line">        //<span class="number">4.2</span>.è·å–åˆ†æ•°</span><br><span class="line">        long time = tuple.getScore().longValue();</span><br><span class="line">        if(time == <span class="keyword">min</span>Time)&#123;</span><br><span class="line">            <span class="keyword">os</span>++;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            <span class="keyword">min</span>Time = time;</span><br><span class="line">            <span class="keyword">os</span>=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    //<span class="number">4</span>.æ ¹æ®idæŸ¥è¯¢blog</span><br><span class="line">    String idStr = StrUtil.join(<span class="string">&quot;,&quot;</span>,ids);</span><br><span class="line">    List<span class="variable">&lt;Blog&gt;</span> blogs = query().<span class="keyword">in</span>(<span class="string">&quot;id&quot;</span>,ids).last(<span class="string">&quot;ORDER BY FIELD(id,&quot;</span>+idStr+<span class="string">&quot;)&quot;</span>).list();</span><br><span class="line">    <span class="keyword">for</span> (B<span class="keyword">log</span> blog : blogs) &#123;</span><br><span class="line">        isB<span class="keyword">log</span>Liked(blog);</span><br><span class="line">        User <span class="keyword">user</span> = <span class="keyword">user</span>Service.getById(blog.getUserId());</span><br><span class="line">        blog.<span class="built_in">set</span>Name(<span class="keyword">user</span>.getNickName());</span><br><span class="line">        blog.<span class="built_in">set</span>Icon(<span class="keyword">user</span>.getIcon());</span><br><span class="line">    &#125;</span><br><span class="line">    //<span class="number">5</span>.å°è£…å¹¶è¿”å›</span><br><span class="line">    ScrollResult r = new ScrollResult();</span><br><span class="line">    r.<span class="built_in">set</span>List(blogs);</span><br><span class="line">    r.<span class="built_in">set</span>Offset(<span class="keyword">os</span>);</span><br><span class="line">    r.<span class="built_in">set</span>M<span class="keyword">in</span>Time(<span class="keyword">min</span>Time);</span><br><span class="line">    return Result.ok(r);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è·å–å½“å‰ç”¨æˆ·</strong>ï¼š</p><ul><li>ä½¿ç”¨ <code>UserHolder.getUser().getId()</code> è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„ IDã€‚</li></ul><p><strong>æŸ¥è¯¢åŠ¨æ€æµ</strong>ï¼š</p><ul><li>ä½¿ç”¨ Redis çš„ <code>reverseRangeByScoreWithScores</code> å‘½ä»¤æŒ‰æ—¶é—´æˆ³å€’åºè·å–åŠ¨æ€æµä¸­çš„åšå®¢ IDã€‚æŸ¥è¯¢èŒƒå›´æ˜¯ä»æ—¶é—´æˆ³ 0 åˆ° <code>max</code>ï¼ˆå³ä¸Šæ¬¡æŸ¥è¯¢çš„æœ€å°æ—¶é—´æˆ³ï¼‰ï¼Œåç§»é‡ä¸º <code>offset</code>ï¼Œæ¯æ¬¡æŸ¥è¯¢ 3 æ¡æ•°æ®ã€‚</li></ul><p><strong>å¤„ç†æŸ¥è¯¢ç»“æœ</strong>ï¼š</p><ul><li>éå†æŸ¥è¯¢ç»“æœï¼Œæå–å‡ºåšå®¢çš„ ID å’Œæ—¶é—´æˆ³ã€‚æ ¹æ®æ—¶é—´æˆ³åˆ¤æ–­æ˜¯å¦ä¸ä¸Šä¸€æ¬¡çš„æœ€å°æ—¶é—´æˆ³ç›¸åŒï¼Œè‹¥ç›¸åŒï¼Œåˆ™åç§»é‡åŠ  1ï¼Œè‹¥ä¸åŒï¼Œåˆ™æ›´æ–°æœ€å°æ—¶é—´æˆ³å¹¶é‡ç½®åç§»é‡ã€‚</li></ul><p><strong>æŸ¥è¯¢åšå®¢ä¿¡æ¯</strong>ï¼š</p><ul><li>ä½¿ç”¨ <code>query().in(&quot;id&quot;, ids)</code> æ ¹æ®æŸ¥è¯¢åˆ°çš„åšå®¢ ID æŸ¥è¯¢åšå®¢è¯¦ç»†ä¿¡æ¯ï¼Œä½¿ç”¨ <code>ORDER BY FIELD</code> ç¡®ä¿è¿”å›çš„åšå®¢é¡ºåºä¸ ID åˆ—è¡¨ä¸€è‡´ã€‚</li></ul><p><strong>è¿”å›ç»“æœ</strong>ï¼š</p><ul><li>å°†æŸ¥è¯¢åˆ°çš„åšå®¢ä¿¡æ¯ã€æœ€å°æ—¶é—´æˆ³å’Œåç§»é‡å°è£…åœ¨ <code>ScrollResult</code> å¯¹è±¡ä¸­ï¼Œå¹¶è¿”å›ç»™å‰ç«¯ã€‚</li></ul><p>æ•ˆæœå›¾å¦‚ä¸‹ï¼ˆæˆ‘å…³æ³¨äº†å°é±¼åŒå­¦ï¼Œäºæ˜¯æˆ‘å¯ä»¥çœ‹åˆ°å°é±¼åŒå­¦å‘å¸ƒçš„æ–‡ç« ï¼‰ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-322.png" alt="img"></p><h2 id="10ã€é™„è¿‘å•†æˆ·">10ã€é™„è¿‘å•†æˆ·</h2><h3 id="10-1ã€é™„è¿‘å•†æˆ·-GEOæ•°æ®ç»“æ„çš„åŸºæœ¬ç”¨æ³•">10.1ã€é™„è¿‘å•†æˆ·-GEOæ•°æ®ç»“æ„çš„åŸºæœ¬ç”¨æ³•</h3><p>GEOæ˜¯Geolocationçš„ç®€å†™å½¢å¼ï¼Œä»£è¡¨åœ°ç†åæ ‡ï¼Œåœ¨Redisçš„3.2ç‰ˆæœ¬ååŠ å…¥äº†GEOçš„æ”¯æŒï¼Œå…è®¸å­˜å‚¨åœ°ç†åæ ‡ä¿¡æ¯ï¼Œå¸®åŠ©æˆ‘ä»¬æ ¹æ®ç»çº¬åº¦æ¥æ£€ç´¢æ•°æ®ã€‚</p><p>å¸¸è§çš„å‘½ä»¤æœ‰ï¼š</p><ol><li>GEOADDï¼šæ·»åŠ ä¸€ä¸ªåœ°ç†ç©ºé—´ä¿¡æ¯ï¼ŒåŒ…å«ï¼šç»åº¦ï¼ˆlongitudeï¼‰ã€çº¬åº¦ï¼ˆlatitudeï¼‰ã€å€¼ï¼ˆmemberï¼‰</li><li>GEODISTï¼šè®¡ç®—æŒ‡å®šçš„ä¸¤ä¸ªç‚¹ä¹‹é—´çš„è·ç¦»å¹¶è¿”å›</li><li>GEOHASHï¼šå°†æŒ‡å®šmemberçš„åæ ‡è½¬ä¸ºhashå­—ç¬¦ä¸²å½¢å¼å¹¶è¿”å›</li><li>GEOPOSï¼šè¿”å›æŒ‡å®šmemberçš„åæ ‡</li><li>GEORADIUSï¼šæŒ‡å®šåœ†å¿ƒã€åŠå¾„ï¼Œæ‰¾åˆ°è¯¥åœ†å†…åŒ…å«çš„æ‰€æœ‰memberï¼Œå¹¶æŒ‰ç…§ä¸åœ†å¿ƒä¹‹é—´çš„è·ç¦»æ’åºåè¿”å›ã€‚6.ä»¥åå·²åºŸå¼ƒ</li><li>GEOSEARCHï¼šåœ¨æŒ‡å®šèŒƒå›´å†…æœç´¢memberï¼Œå¹¶æŒ‰ç…§ä¸æŒ‡å®šç‚¹ä¹‹é—´çš„è·ç¦»æ’åºåè¿”å›ã€‚èŒƒå›´å¯ä»¥æ˜¯åœ†å½¢æˆ–çŸ©å½¢ã€‚6.2.æ–°åŠŸèƒ½</li><li>GEOSEARCHSTOREï¼šä¸GEOSEARCHåŠŸèƒ½ä¸€è‡´ï¼Œä¸è¿‡å¯ä»¥æŠŠç»“æœå­˜å‚¨åˆ°ä¸€ä¸ªæŒ‡å®šçš„keyã€‚ 6.2.æ–°åŠŸèƒ½</li></ol><h3 id="10-2ã€-é™„è¿‘å•†æˆ·-å¯¼å…¥åº—é“ºæ•°æ®åˆ°GEO">10.2ã€ é™„è¿‘å•†æˆ·-å¯¼å…¥åº—é“ºæ•°æ®åˆ°GEO</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-323-1024x421.png" alt="img"></p><p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨ Redis GEO</strong>ï¼š</p><p>Redis æä¾›çš„ GEO æ•°æ®ç»“æ„æ”¯æŒå­˜å‚¨åŸºäºåœ°ç†ä½ç½®çš„æˆå‘˜ï¼Œå¯ä»¥é€šè¿‡ç»çº¬åº¦æ¥å­˜å‚¨åœ°ç†åæ ‡ï¼Œå¹¶æ”¯æŒéå¸¸é«˜æ•ˆçš„åŸºäºè·ç¦»çš„æŸ¥è¯¢ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥éå¸¸æ–¹ä¾¿åœ°è¿›è¡Œä»¥ä¸‹æ“ä½œï¼š</p><ul><li><strong>æ’å…¥å•†æˆ·çš„åœ°ç†ä½ç½®ä¿¡æ¯</strong>ï¼šå°†å•†æˆ·çš„ç»çº¬åº¦å’Œå•†æˆ·IDå­˜å…¥ Redisã€‚</li><li><strong>æ ¹æ®è·ç¦»æŸ¥è¯¢å•†æˆ·</strong>ï¼šåŸºäºç”¨æˆ·çš„å½“å‰ä½ç½®ï¼ŒæŸ¥è¯¢æŒ‡å®šèŒƒå›´å†…çš„å•†æˆ·ã€‚</li></ul><p>å…·ä½“åœºæ™¯è¯´æ˜ï¼š</p><p>å½“ç”¨æˆ·ç‚¹å‡»â€œç¾é£Ÿâ€åï¼Œåå°ä¼šæ ¹æ®ç”¨æˆ·çš„åœ°ç†ä½ç½®æŸ¥è¯¢å‡ºå‘¨è¾¹çš„å•†æˆ·ã€‚æŸ¥è¯¢çš„æ–¹å¼æ˜¯ï¼šé€šè¿‡ç”¨æˆ·æä¾›çš„åœ°ç†åæ ‡ä½œä¸ºåœ†å¿ƒï¼Œåœ¨ Redis ä¸­æ ¹æ®ç»çº¬åº¦å­˜å‚¨å•†æˆ·ä¿¡æ¯ï¼ŒæŒ‰è·ç¦»æ¥æ’åºå•†æˆ·ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-324.png" alt="img"></p><p>æˆ‘ä»¬è¦åšçš„äº‹æƒ…æ˜¯ï¼šå°†æ•°æ®åº“è¡¨ä¸­çš„æ•°æ®å¯¼å…¥åˆ°redisä¸­å»ï¼Œredisä¸­çš„GEOï¼ŒGEOåœ¨redisä¸­å°±ä¸€ä¸ªmenberå’Œä¸€ä¸ªç»çº¬åº¦ï¼Œæˆ‘ä»¬æŠŠxå’Œyè½´ä¼ å…¥åˆ°redisåšçš„ç»çº¬åº¦ä½ç½®å»ï¼Œä½†æˆ‘ä»¬ä¸èƒ½æŠŠæ‰€æœ‰çš„æ•°æ®éƒ½æ”¾å…¥åˆ°menberä¸­å»ï¼Œæ¯•ç«Ÿä½œä¸ºredisæ˜¯ä¸€ä¸ªå†…å­˜çº§æ•°æ®åº“ï¼Œå¦‚æœå­˜æµ·é‡æ•°æ®ï¼Œredisè¿˜æ˜¯åŠ›ä¸ä»å¿ƒï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™ä¸ªåœ°æ–¹å­˜å‚¨ä»–çš„idå³å¯ã€‚</p><p>ä½†æ˜¯è¿™ä¸ªæ—¶å€™è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨redisä¸­å¹¶æ²¡æœ‰å­˜å‚¨typeï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•æ ¹æ®typeæ¥å¯¹æ•°æ®è¿›è¡Œç­›é€‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŒ‰ç…§å•†æˆ·ç±»å‹åšåˆ†ç»„ï¼Œç±»å‹ç›¸åŒçš„å•†æˆ·ä½œä¸ºåŒä¸€ç»„ï¼Œä»¥typeIdä¸ºkeyå­˜å…¥åŒä¸€ä¸ªGEOé›†åˆä¸­å³å¯</p><p>åœ¨src/test/java/com/hmdpçš„HmDianPingApplicationTestsç±»ä¸­å†™å…¥å¦‚ä¸‹çš„æ–¹æ³•ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="type">StringRedisTemplate</span> stringRedisTemplate;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line">void loadShopData()&#123;</span><br><span class="line">    <span class="comment">//1.æŸ¥è¯¢åº—é“ºä¿¡æ¯</span></span><br><span class="line">    <span class="type">List</span>&lt;<span class="type">Shop</span>&gt; list <span class="operator">=</span> shopService.list();</span><br><span class="line">    <span class="comment">//2.æŠŠåº—é“ºåˆ†ç»„ï¼ŒæŒ‰ç…§typeIdåˆ†ç»„ï¼ŒtypeIdä¸€è‡´çš„æ”¾åˆ°ä¸€ä¸ªé›†åˆ</span></span><br><span class="line">    <span class="type">Map</span>&lt;<span class="type">Long</span>,<span class="type">List</span>&lt;<span class="type">Shop</span>&gt;&gt; map <span class="operator">=</span> list.stream().collect(<span class="type">Collectors</span>.groupingBy(Shop::getTypeId));</span><br><span class="line">    <span class="comment">//3.åˆ†æ‰¹å®Œæˆå†™å…¥Redis</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">Map</span>.<span class="type">Entry</span>&lt;<span class="type">Long</span>, <span class="type">List</span>&lt;<span class="type">Shop</span>&gt;&gt; entry : map.entrySet()) &#123;</span><br><span class="line">        <span class="comment">//3.1.è·å–ç±»å‹id</span></span><br><span class="line">        <span class="type">Long</span> typeid <span class="operator">=</span> entry.getKey();</span><br><span class="line">        <span class="type">String</span> key <span class="operator">=</span> <span class="string">&quot;shop:geo:&quot;</span><span class="operator">+</span>typeid;</span><br><span class="line">        <span class="comment">//3.2.è·å–åŒç±»å‹çš„åº—é“ºçš„é›†åˆ</span></span><br><span class="line">        <span class="type">List</span>&lt;<span class="type">Shop</span>&gt; value <span class="operator">=</span> entry.getValue();</span><br><span class="line">        <span class="comment">//3.3.å†™å…¥redis GEOADD key ç»åº¦ çº¬åº¦ member</span></span><br><span class="line">        <span class="type">List</span>&lt;<span class="type">RedisGeoCommands</span>.<span class="type">GeoLocation</span>&lt;<span class="type">String</span>&gt;&gt; locations <span class="operator">=</span> new <span class="type">ArrayList</span>&lt;&gt;(value.size());</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">Shop</span> shop : value)&#123;</span><br><span class="line"><span class="comment">//                stringRedisTemplate.opsForGeo().add(key,new Point(shop.getX(),shop.getY()),shop.getId().toString());</span></span><br><span class="line">            locations.add(new <span class="type">RedisGeoCommands</span>.<span class="type">GeoLocation</span>&lt;&gt;(</span><br><span class="line">                    shop.getId().toString(),</span><br><span class="line">                    new <span class="type">Point</span>(shop.getX(),shop.getY())</span><br><span class="line">            ));</span><br><span class="line">        &#125;</span><br><span class="line">        stringRedisTemplate.opsForGeo().add(key,locations);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ­¥éª¤è¯¦è§£</strong>ï¼š</p><h4 id="1-æŸ¥è¯¢å•†æˆ·ä¿¡æ¯ï¼š">1. <strong>æŸ¥è¯¢å•†æˆ·ä¿¡æ¯</strong>ï¼š</h4><p>é¦–å…ˆï¼Œä»æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ‰€æœ‰çš„å•†æˆ·æ•°æ®ã€‚</p><p><code>shopService.list()</code> è¿”å›çš„æ˜¯æ‰€æœ‰å•†æˆ·çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬å•†æˆ·çš„ç»çº¬åº¦ï¼ˆ<code>x</code> å’Œ <code>y</code>ï¼‰ã€å•†æˆ·ç±»å‹ï¼ˆ<code>typeId</code>ï¼‰ç­‰ã€‚</p><ol start="2"><li><strong>å°†å•†æˆ·æŒ‰ç±»å‹åˆ†ç»„</strong>ï¼š</li></ol><p>å•†æˆ·æ•°æ®æŒ‰ <code>typeId</code>ï¼ˆå•†æˆ·ç±»å‹ï¼‰è¿›è¡Œåˆ†ç»„ï¼Œç¡®ä¿åŒç±»å‹çš„å•†æˆ·ä¼šå­˜å‚¨åœ¨åŒä¸€ä¸ª GEO é›†åˆä¸­ã€‚</p><p>é€šè¿‡ Java 8 çš„ <code>Collectors.groupingBy()</code> æ–¹æ³•ï¼ŒæŒ‰ç…§ <code>typeId</code> å¯¹å•†æˆ·è¿›è¡Œåˆ†ç»„ï¼Œè¿”å›ä¸€ä¸ªä»¥ <code>typeId</code> ä¸ºé”®çš„ <code>Map</code>ï¼Œæ¯ä¸ªé”®å¯¹åº”ä¸€ä¸ªå•†æˆ·ç±»å‹çš„å•†æˆ·åˆ—è¡¨ã€‚</p><h4 id="3-å°†å•†æˆ·æ•°æ®åˆ†æ‰¹å†™å…¥-Redisï¼š">3. <strong>å°†å•†æˆ·æ•°æ®åˆ†æ‰¹å†™å…¥ Redis</strong>ï¼š</h4><p>å¯¹äºæ¯ä¸€ç»„å•†æˆ·ï¼Œä½¿ç”¨ Redis çš„ <code>GEOADD</code> å‘½ä»¤å°†å•†æˆ·çš„ç»çº¬åº¦æ•°æ®æ·»åŠ åˆ°å¯¹åº”çš„ GEO é›†åˆä¸­ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ Redis ä¸­ä¸ºæ¯ç§ç±»å‹çš„å•†æˆ·åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ GEO é›†åˆã€‚</p><ul><li><code>key</code>ï¼šä»¥å•†æˆ·ç±»å‹çš„ <code>typeId</code> ä¸ºé”®ï¼Œåˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ Redis GEO é›†åˆï¼ˆå¦‚ <code>shop:geo:1</code> å¯¹åº”ç±»å‹ä¸º 1 çš„å•†æˆ·ï¼‰ã€‚</li><li><code>locations</code>ï¼šè¿™æ˜¯ä¸€ä¸ª <code>List</code>ï¼ŒåŒ…å«æ¯ä¸ªå•†æˆ·çš„ <code>GeoLocation</code>ï¼Œæ¯ä¸ªå•†æˆ·çš„ä½ç½®ä¿¡æ¯åŒ…æ‹¬å•†æˆ·çš„ <code>ID</code> å’Œ <code>Point</code>ï¼ˆç»çº¬åº¦ï¼‰ã€‚</li><li><code>stringRedisTemplate.opsForGeo().add(key, locations)</code>ï¼šé€šè¿‡ <code>stringRedisTemplate</code> çš„ <code>Geo</code> æ“ä½œå°†å•†æˆ·çš„ä½ç½®ä¿¡æ¯æ‰¹é‡å†™å…¥ Redis ä¸­ã€‚</li></ul><h4 id="å…³äº-Redis-GEO-çš„å­˜å‚¨å’ŒæŸ¥è¯¢ï¼š"><strong>å…³äº Redis GEO çš„å­˜å‚¨å’ŒæŸ¥è¯¢</strong>ï¼š</h4><ul><li><strong>å­˜å‚¨æ•°æ®</strong>ï¼šæ¯ä¸ªå•†æˆ·çš„ ID ä½œä¸º Redis GEO é›†åˆçš„ memberï¼Œå•†æˆ·çš„ç»çº¬åº¦ä½œä¸ºå¯¹åº”çš„ <code>Point</code> å­˜å‚¨åœ¨ Redis ä¸­ã€‚</li><li><strong>æŸ¥è¯¢æ•°æ®</strong>ï¼šå­˜å‚¨å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Redis æä¾›çš„ GEO å‘½ä»¤æ¥è¿›è¡ŒåŸºäºåœ°ç†ä½ç½®çš„æŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æŸ¥è¯¢ç»™å®šåæ ‡èŒƒå›´å†…çš„å•†æˆ·ï¼Œæˆ–è€…æ ¹æ®ç”¨æˆ·çš„ä½ç½®ï¼ŒæŸ¥è¯¢é™„è¿‘çš„å•†æˆ·ã€‚</li></ul><p>æµ‹è¯•ï¼šç‚¹å‡»è¿è¡Œä¹‹åï¼Œåœ¨Redisä¸­èƒ½å¤Ÿçœ‹åˆ°å¯¼å…¥çš„æ•°æ®ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-325-1024x608.png" alt="img"></p><h3 id="10-3-é™„è¿‘å•†æˆ·-å®ç°é™„è¿‘å•†æˆ·åŠŸèƒ½">10.3 é™„è¿‘å•†æˆ·-å®ç°é™„è¿‘å•†æˆ·åŠŸèƒ½</h3><p>SpringDataRedisçš„2.3.9ç‰ˆæœ¬å¹¶ä¸æ”¯æŒRedis 6.2æä¾›çš„GEOSEARCHå‘½ä»¤ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æç¤ºå…¶ç‰ˆæœ¬ï¼Œä¿®æ”¹è‡ªå·±çš„POM</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>spring-data-redis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>lettuce-core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>io.lettuce<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.lettuce<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lettuce-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.1.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><strong><code>spring-data-redis</code></strong> å‡çº§è‡³ 2.6.2 ç‰ˆæœ¬ï¼Œä»¥æ”¯æŒ Redis 6.2 æ–°ç‰¹æ€§ã€‚</li><li><strong><code>lettuce-core</code></strong> å‡çº§è‡³ 6.1.6 ç‰ˆæœ¬ï¼Œç¡®ä¿æ”¯æŒ <code>GEOSEARCH</code> å‘½ä»¤ã€‚</li></ul><p>åœ¨ShopControllerä¸­ä¿®æ”¹queryShopByTypeæ–¹æ³•ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@GetMapping</span>(<span class="string">&quot;/of/type&quot;</span>)</span><br><span class="line">public Result <span class="built_in">queryShopByType</span>(</span><br><span class="line">        <span class="variable">@RequestParam</span>(<span class="string">&quot;typeId&quot;</span>) Integer typeId,</span><br><span class="line">        <span class="variable">@RequestParam</span>(value = <span class="string">&quot;current&quot;</span>, defaultValue = <span class="string">&quot;1&quot;</span>) Integer current,</span><br><span class="line">        <span class="variable">@RequestParam</span>(value=<span class="string">&quot;x&quot;</span>,required=false) Double x,</span><br><span class="line">        <span class="variable">@RequestParam</span>(value=<span class="string">&quot;y&quot;</span>,required=false) Double y</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">shopService</span><span class="selector-class">.queryShopByType</span>(typeId,current,x,y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong><code>typeId</code></strong>ï¼šå•†æˆ·ç±»å‹IDï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„å•†æˆ·ã€‚</li><li><strong><code>current</code></strong>ï¼šå½“å‰é¡µï¼Œé»˜è®¤ä¸º1ï¼Œç”¨äºåˆ†é¡µã€‚</li><li><strong><code>x</code> å’Œ <code>y</code></strong>ï¼šå¯é€‰çš„ç»çº¬åº¦ï¼Œç”¨äºæŸ¥è¯¢é™„è¿‘çš„å•†æˆ·ã€‚å¦‚æœä¸ºç©ºï¼Œåˆ™ä¸æŒ‰è·ç¦»æŸ¥è¯¢ã€‚</li></ul><p>åœ¨IShopServiceæ¥å£ä¸­å†™å…¥å¦‚ä¸‹æ–¹æ³•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Result</span> queryShopByType(<span class="type">Integer</span> typeId, <span class="type">Integer</span> <span class="keyword">current</span>, <span class="keyword">Double</span> x, <span class="keyword">Double</span> y);</span><br></pre></td></tr></table></figure><p>åœ¨ShopServiceImplç±»ä¸­å†™å…¥å¦‚ä¸‹æ–¹æ³•ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line"><span class="keyword">public</span> Result queryShopByType(Integer typeId, Integer current, <span class="keyword">Double</span> x, <span class="keyword">Double</span> y) &#123;</span><br><span class="line">    <span class="comment">//1.åˆ¤æ–­æ˜¯å¦éœ€è¦æ ¹æ®åæ ‡æŸ¥è¯¢</span></span><br><span class="line">    <span class="keyword">if</span>(x==<span class="keyword">null</span> || y==<span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">//ä¸éœ€è¦æŸ¥è¯¢åæ ‡ï¼ŒæŒ‰æ•°æ®åº“æŸ¥</span></span><br><span class="line">        Page&lt;Shop&gt; page = query()</span><br><span class="line">                .eq(<span class="string">&quot;type_id&quot;</span>,typeId)</span><br><span class="line">                .page(<span class="keyword">new</span> Page&lt;&gt;(current, SystemConstants.DEFAULT_PAGE_SIZE));</span><br><span class="line">        <span class="keyword">return</span> Result.ok(page.getRecords());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2.è®¡ç®—åˆ†é¡µå‚æ•°</span></span><br><span class="line">    <span class="keyword">int</span> <span class="keyword">from</span> = (current - <span class="number">1</span>)*SystemConstants.DEFAULT_PAGE_SIZE;</span><br><span class="line">    <span class="keyword">int</span> end = current*SystemConstants.DEFAULT_PAGE_SIZE;</span><br><span class="line">    <span class="comment">//3.æŸ¥è¯¢redisï¼ŒæŒ‰ç…§è·ç¦»æ’åºã€åˆ†é¡µã€‚ç»“æœï¼šshopId,distance</span></span><br><span class="line">    String key = SHOP_GEO_KEY+typeId;</span><br><span class="line">    GeoResults&lt;RedisGeoCommands.GeoLocation&lt;String&gt;&gt; results = stringRedisTemplate.opsForGeo()</span><br><span class="line">            .search(</span><br><span class="line">                    key,</span><br><span class="line">                    GeoReference.fromCoordinate(x, y),</span><br><span class="line">                    <span class="keyword">new</span> Distance(<span class="number">5000</span>),</span><br><span class="line">                    RedisGeoCommands.GeoSearchCommandArgs.newGeoSearchArgs().includeDistance().limit(end)</span><br><span class="line">            );</span><br><span class="line">    <span class="comment">//4.è§£æå‡ºid</span></span><br><span class="line">    <span class="keyword">if</span>(results==<span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.ok(Collections.emptyList());</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;GeoResult&lt;RedisGeoCommands.GeoLocation&lt;String&gt;&gt;&gt; list = results.getContent();</span><br><span class="line">    <span class="comment">//4.1.æˆªå–from-endçš„éƒ¨åˆ†</span></span><br><span class="line">    List&lt;<span class="keyword">Long</span>&gt; ids = <span class="keyword">new</span> ArrayList&lt;&gt;(list.<span class="keyword">size</span>());</span><br><span class="line">    Map&lt;String,Distance&gt; distanceMap = <span class="keyword">new</span> HashMap&lt;&gt;(list.<span class="keyword">size</span>());</span><br><span class="line">    <span class="keyword">if</span>(list.<span class="keyword">size</span>()&lt;=<span class="keyword">from</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.ok(Collections.emptyList());</span><br><span class="line">    &#125;</span><br><span class="line">    list.stream().skip(<span class="keyword">from</span>).forEach(result-&gt;&#123; <span class="comment">//è·³è¿‡å¯èƒ½æŠŠæ‰€æœ‰æ•°æ®è·³è¿‡äº†</span></span><br><span class="line">        <span class="comment">//4.2.è·å–åº—é“ºid</span></span><br><span class="line">        String shopIdStr = result.getContent().getName();</span><br><span class="line">        ids.add(<span class="keyword">Long</span>.valueOf(shopIdStr));</span><br><span class="line">        <span class="comment">//4.3.è·å–è·ç¦»</span></span><br><span class="line">        Distance distance = result.getDistance();</span><br><span class="line">        distanceMap.put(shopIdStr,distance);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//5.æ ¹æ®idæŸ¥è¯¢shop</span></span><br><span class="line">    String idStr = StrUtil.<span class="keyword">join</span>(<span class="string">&quot;,&quot;</span>, ids);</span><br><span class="line">    List&lt;Shop&gt; shops = query().in(<span class="string">&quot;id&quot;</span>, ids).last(<span class="string">&quot;ORDER BY FIELD ( id,&quot;</span> + idStr + <span class="string">&quot;)&quot;</span>).list();</span><br><span class="line">    <span class="keyword">for</span>(Shop shop : shops)&#123;</span><br><span class="line">        shop.setDistance(distanceMap.get(shop.getId().toString()).getValue());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6ã€è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(shops);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤-1ï¼šåˆ¤æ–­æ˜¯å¦éœ€è¦æ ¹æ®åæ ‡æŸ¥è¯¢"><strong>æ­¥éª¤ 1ï¼šåˆ¤æ–­æ˜¯å¦éœ€è¦æ ¹æ®åæ ‡æŸ¥è¯¢</strong></h4><p>é¦–å…ˆæ£€æŸ¥ <code>x</code> å’Œ <code>y</code> æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™ä¸éœ€è¦æ ¹æ®åæ ‡æŸ¥è¯¢ï¼Œç›´æ¥ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å•†æˆ·ä¿¡æ¯ã€‚å¦‚æœ <code>x</code> å’Œ <code>y</code> ä¸ä¸ºç©ºï¼Œåˆ™è¡¨ç¤ºéœ€è¦æ ¹æ®ç»çº¬åº¦æŸ¥è¯¢é™„è¿‘çš„å•†æˆ·ã€‚</p><h4 id="æ­¥éª¤-2ï¼šè®¡ç®—åˆ†é¡µå‚æ•°"><strong>æ­¥éª¤ 2ï¼šè®¡ç®—åˆ†é¡µå‚æ•°</strong></h4><p>æ ¹æ®å½“å‰é¡µæ•° <code>current</code>ï¼Œè®¡ç®—åˆ†é¡µçš„èµ·å§‹ä½ç½® <code>from</code> å’Œç»“æŸä½ç½® <code>end</code>ã€‚è¿™å°†ç”¨äºä»æŸ¥è¯¢ç»“æœä¸­æå–å¯¹åº”çš„æ•°æ®ã€‚</p><h4 id="æ­¥éª¤-3ï¼šæŸ¥è¯¢-Redis-ä¸­çš„å•†æˆ·æ•°æ®"><strong>æ­¥éª¤ 3ï¼šæŸ¥è¯¢ Redis ä¸­çš„å•†æˆ·æ•°æ®</strong></h4><p>ä½¿ç”¨ Redis çš„ <code>GEOSEARCH</code> å‘½ä»¤æŸ¥è¯¢å•†æˆ·ï¼Œæ ¹æ®ç”¨æˆ·æä¾›çš„ç»çº¬åº¦ï¼ˆ<code>x</code>, <code>y</code>ï¼‰è®¡ç®—è·ç¦»ï¼Œç­›é€‰å‡ºè·ç¦»ç”¨æˆ·ä½ç½®åœ¨ä¸€å®šèŒƒå›´å†…çš„å•†æˆ·ã€‚</p><ul><li><code>SHOP_GEO_KEY + typeId</code>ï¼šRedis ä¸­å­˜å‚¨å•†æˆ·ä½ç½®ä¿¡æ¯çš„é”®ï¼Œä»¥å•†æˆ·ç±»å‹ <code>typeId</code> ä¸ºåŒºåˆ†ã€‚</li><li><code>GeoReference.fromCoordinate(x, y)</code>ï¼šé€šè¿‡ç”¨æˆ·æä¾›çš„ç»çº¬åº¦åˆ›å»º <code>GeoReference</code>ã€‚</li><li><code>new Distance(5000)</code>ï¼šè®¾ç½®æŸ¥è¯¢çš„åŠå¾„ä¸º 5000 ç±³ï¼Œå³æŸ¥è¯¢ 5 å…¬é‡ŒèŒƒå›´å†…çš„å•†æˆ·ã€‚</li><li><code>limit(end)</code>ï¼šé™åˆ¶è¿”å›çš„å•†æˆ·æ•°é‡ã€‚</li></ul><h4 id="æ­¥éª¤-4ï¼šè§£ææŸ¥è¯¢ç»“æœ"><strong>æ­¥éª¤ 4ï¼šè§£ææŸ¥è¯¢ç»“æœ</strong></h4><p>ä» Redis è¿”å›çš„ç»“æœä¸­æå–å•†æˆ· ID å’Œè·ç¦»ä¿¡æ¯ï¼Œå¹¶æ ¹æ®åˆ†é¡µå‚æ•°æˆªå–éœ€è¦çš„æ•°æ®ã€‚</p><ul><li>ä½¿ç”¨ <code>skip(from)</code> è·³è¿‡ä¸éœ€è¦çš„å•†æˆ·æ•°æ®ï¼Œç¡®ä¿ä»æ­£ç¡®çš„èµ·å§‹ä½ç½®å¼€å§‹æå–å•†æˆ·ã€‚</li><li>æå–å•†æˆ·çš„ ID å’Œè·ç¦»ä¿¡æ¯ï¼Œå­˜å…¥ <code>ids</code> å’Œ <code>distanceMap</code>ã€‚</li></ul><h4 id="æ­¥éª¤-5ï¼šæ ¹æ®å•†æˆ·-ID-æŸ¥è¯¢å•†æˆ·è¯¦æƒ…"><strong>æ­¥éª¤ 5ï¼šæ ¹æ®å•†æˆ· ID æŸ¥è¯¢å•†æˆ·è¯¦æƒ…</strong></h4><p>æ ¹æ®æå–åˆ°çš„å•†æˆ· IDï¼Œä»æ•°æ®åº“ä¸­æŸ¥è¯¢å•†æˆ·çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶å°†æŸ¥è¯¢åˆ°çš„è·ç¦»ä¿¡æ¯æ·»åŠ åˆ°å•†æˆ·æ•°æ®ä¸­ã€‚</p><h4 id="æ­¥éª¤-6ï¼šè¿”å›ç»“æœ"><strong>æ­¥éª¤ 6ï¼šè¿”å›ç»“æœ</strong></h4><p>æœ€ç»ˆè¿”å›å•†æˆ·çš„è¯¦ç»†ä¿¡æ¯ä»¥åŠè·ç¦»ã€‚</p><p>æ•ˆæœï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-326.png" alt="img"></p><h2 id="11ã€ç”¨æˆ·ç­¾åˆ°">11ã€ç”¨æˆ·ç­¾åˆ°</h2><h3 id="11-1ã€ç”¨æˆ·ç­¾åˆ°-BitMapåŠŸèƒ½æ¼”ç¤º">11.1ã€ç”¨æˆ·ç­¾åˆ°-BitMapåŠŸèƒ½æ¼”ç¤º</h3><p>æˆ‘ä»¬é’ˆå¯¹ç­¾åˆ°åŠŸèƒ½å®Œå…¨å¯ä»¥é€šè¿‡mysqlæ¥å®Œæˆï¼Œæ¯”å¦‚è¯´ä»¥ä¸‹è¿™å¼ è¡¨</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-327.png" alt="img"></p><p>ç”¨æˆ·ä¸€æ¬¡ç­¾åˆ°ï¼Œå°±æ˜¯ä¸€æ¡è®°å½•ï¼Œå‡å¦‚æœ‰1000ä¸‡ç”¨æˆ·ï¼Œå¹³å‡æ¯äººæ¯å¹´ç­¾åˆ°æ¬¡æ•°ä¸º10æ¬¡ï¼Œåˆ™è¿™å¼ è¡¨ä¸€å¹´çš„æ•°æ®é‡ä¸º 1äº¿æ¡</p><p>æ¯ç­¾åˆ°ä¸€æ¬¡éœ€è¦ä½¿ç”¨ï¼ˆ8 + 8 + 1 + 1 + 3 + 1ï¼‰å…±22 å­—èŠ‚çš„å†…å­˜ï¼Œä¸€ä¸ªæœˆåˆ™æœ€å¤šéœ€è¦600å¤šå­—èŠ‚</p><p>æˆ‘ä»¬å¦‚ä½•èƒ½å¤Ÿç®€åŒ–ä¸€ç‚¹å‘¢ï¼Ÿå…¶å®å¯ä»¥è€ƒè™‘å°æ—¶å€™ä¸€ä¸ªæŒºå¸¸è§çš„æ–¹æ¡ˆï¼Œå°±æ˜¯å°æ—¶å€™ï¼Œå’±ä»¬å‡†å¤‡ä¸€å¼ å°å°çš„å¡ç‰‡ï¼Œä½ åªè¦ç­¾åˆ°å°±æ‰“ä¸Šä¸€ä¸ªå‹¾ï¼Œæˆ‘æœ€ååˆ¤æ–­ä½ æ˜¯å¦ç­¾åˆ°ï¼Œå…¶å®åªéœ€è¦åˆ°å°å¡ç‰‡ä¸Šçœ‹ä¸€çœ‹å°±çŸ¥é“äº†</p><p>æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ç±»ä¼¼è¿™æ ·çš„æ–¹æ¡ˆæ¥å®ç°æˆ‘ä»¬çš„ç­¾åˆ°éœ€æ±‚ã€‚</p><p>åœ¨å®é™…åœºæ™¯ä¸­ï¼Œå¯èƒ½æœ‰å¾ˆå¤šç”¨æˆ·æ¯æœˆçš„ç­¾åˆ°è®°å½•ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æ¯ä¸ªç”¨æˆ·æ¯æœˆæœ‰ 30 å¤©çš„ç­¾åˆ°è®°å½•ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªç”¨æˆ·ä½¿ç”¨ä¸€ä¸ª BitMap æ¥è®°å½•ä»–ä»¬çš„ç­¾åˆ°æƒ…å†µã€‚æ¯ä½ç”¨æˆ·çš„ç­¾åˆ°ä¿¡æ¯ä¼šå¯¹åº”ä¸€ä¸ª 1 æˆ– 0ï¼Œ1 è¡¨ç¤ºç­¾åˆ°ï¼Œ0 è¡¨ç¤ºæœªç­¾åˆ°ã€‚</p><p>æŠŠæ¯ä¸€ä¸ªbitä½å¯¹åº”å½“æœˆçš„æ¯ä¸€å¤©ï¼Œå½¢æˆäº†æ˜ å°„å…³ç³»ã€‚ç”¨0å’Œ1æ ‡ç¤ºä¸šåŠ¡çŠ¶æ€ï¼Œè¿™ç§æ€è·¯å°±ç§°ä¸ºä½å›¾ï¼ˆBitMapï¼‰ã€‚è¿™æ ·æˆ‘ä»¬å°±ç”¨æå°çš„ç©ºé—´ï¼Œæ¥å®ç°äº†å¤§é‡æ•°æ®çš„è¡¨ç¤º</p><p>Redisä¸­æ˜¯åˆ©ç”¨stringç±»å‹æ•°æ®ç»“æ„å®ç°BitMapï¼Œå› æ­¤æœ€å¤§ä¸Šé™æ˜¯512Mï¼Œè½¬æ¢ä¸ºbitåˆ™æ˜¯ 2^32ä¸ªbitä½ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-328-1024x225.png" alt="img"></p><p>æ¯å¤©çš„ç­¾åˆ°æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶ä½ï¼Œ1 è¡¨ç¤ºç­¾åˆ°ï¼Œ0 è¡¨ç¤ºæœªç­¾åˆ°ã€‚æ¯ä¸ªç”¨æˆ·æ¯æœˆçš„ç­¾åˆ°æ•°æ®å°±å¯¹åº”ä¸€ä¸ªé•¿åº¦ä¸º 30 æˆ– 31 çš„äºŒè¿›åˆ¶æ•°ã€‚</p><p>å‡è®¾ä¸€ä¸ªç”¨æˆ·çš„ç­¾åˆ°è®°å½•æ˜¯ï¼š<br><code>1110101001001010111011001...</code><br>æ¯ä¸ªä½ç½®å¯¹åº”ä¸€ä¸ªæ—¥æœŸï¼Œ1 è¡¨ç¤ºè¯¥æ—¥æœŸç­¾åˆ°ï¼Œ0 è¡¨ç¤ºæœªç­¾åˆ°ã€‚</p><p>BitMapçš„æ“ä½œå‘½ä»¤æœ‰ï¼š</p><ul><li>SETBITï¼šå‘æŒ‡å®šä½ç½®ï¼ˆoffsetï¼‰å­˜å…¥ä¸€ä¸ª0æˆ–1</li><li>GETBIT ï¼šè·å–æŒ‡å®šä½ç½®ï¼ˆoffsetï¼‰çš„bitå€¼</li><li>BITCOUNT ï¼šç»Ÿè®¡BitMapä¸­å€¼ä¸º1çš„bitä½çš„æ•°é‡</li><li>BITFIELD ï¼šæ“ä½œï¼ˆæŸ¥è¯¢ã€ä¿®æ”¹ã€è‡ªå¢ï¼‰BitMapä¸­bitæ•°ç»„ä¸­çš„æŒ‡å®šä½ç½®ï¼ˆoffsetï¼‰çš„å€¼</li><li>BITFIELD_RO ï¼šè·å–BitMapä¸­bitæ•°ç»„ï¼Œå¹¶ä»¥åè¿›åˆ¶å½¢å¼è¿”å›</li><li>BITOP ï¼šå°†å¤šä¸ªBitMapçš„ç»“æœåšä½è¿ç®—ï¼ˆä¸ ã€æˆ–ã€å¼‚æˆ–ï¼‰</li><li>BITPOS ï¼šæŸ¥æ‰¾bitæ•°ç»„ä¸­æŒ‡å®šèŒƒå›´å†…ç¬¬ä¸€ä¸ª0æˆ–1å‡ºç°çš„ä½ç½®</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-329.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-330.png" alt="img"></p><p><strong>BITFIELD key GET</strong>(ä»£è¡¨æŸ¥è¯¢) <strong>u</strong>(uä»£è¡¨æ— ç¬¦å·ï¼Œiä»£è¡¨æœ‰ç¬¦å·)<strong>æˆªå–å‡ ä½ä½œä¸ºç»“æœ å¼€å§‹çš„ä½ç½®</strong></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-333.png" alt="img"></p><h3 id="11-2-ã€ç”¨æˆ·ç­¾åˆ°-å®ç°ç­¾åˆ°åŠŸèƒ½">11.2 ã€ç”¨æˆ·ç­¾åˆ°-å®ç°ç­¾åˆ°åŠŸèƒ½</h3><p>éœ€æ±‚ï¼šå®ç°ç­¾åˆ°æ¥å£ï¼Œå°†å½“å‰ç”¨æˆ·å½“å¤©ç­¾åˆ°ä¿¡æ¯ä¿å­˜åˆ°Redisä¸­</p><p>æ€è·¯ï¼š</p><ul><li>å°†æ¯ä¸ªç”¨æˆ·çš„ç­¾åˆ°æ•°æ®ä»¥ <code>BitMap</code> çš„å½¢å¼å­˜å‚¨ã€‚<code>BitMap</code> é€šè¿‡ä½æ¥è¡¨ç¤ºæ•°æ®ï¼Œç­¾åˆ°çš„ä½ä¸º <code>1</code>ï¼Œæœªç­¾åˆ°çš„ä½ä¸º <code>0</code>ã€‚</li><li>æ¯æ¬¡ç­¾åˆ°æ—¶ï¼Œæ›´æ–°å¯¹åº”æ—¥æœŸçš„ä½ç½®ï¼ˆå³æ¯ä¸ªç”¨æˆ·çš„ç­¾åˆ°ä¿¡æ¯ï¼‰ã€‚</li></ul><p>æˆ‘ä»¬é€šè¿‡æ¥å£æ–‡æ¡£å‘ç°ï¼Œæ­¤æ¥å£å¹¶æ²¡æœ‰ä¼ é€’ä»»ä½•çš„å‚æ•°ï¼Œæ²¡æœ‰å‚æ•°æ€ä¹ˆç¡®å®æ˜¯å“ªä¸€å¤©ç­¾åˆ°å‘¢ï¼Ÿè¿™ä¸ªå¾ˆå®¹æ˜“ï¼Œå¯ä»¥é€šè¿‡åå°ä»£ç ç›´æ¥è·å–å³å¯ï¼Œç„¶ååˆ°å¯¹åº”çš„åœ°å€ä¸Šå»ä¿®æ”¹bitMapã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-334-1024x510.png" alt="img"></p><p><strong>ä»£ç </strong></p><p>UserController</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">&quot;/sign&quot;</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="function">Result <span class="title">sign</span><span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">return</span> userService.<span class="title">sign</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">sign</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–å½“å‰ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="comment">// 2.è·å–æ—¥æœŸ</span></span><br><span class="line">    <span class="type">LocalDateTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">    <span class="comment">// 3.æ‹¼æ¥key</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">keySuffix</span> <span class="operator">=</span> now.format(DateTimeFormatter.ofPattern(<span class="string">&quot;:yyyyMM&quot;</span>));</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> USER_SIGN_KEY + userId + keySuffix;</span><br><span class="line">    <span class="comment">// 4.è·å–ä»Šå¤©æ˜¯æœ¬æœˆçš„ç¬¬å‡ å¤©</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">dayOfMonth</span> <span class="operator">=</span> now.getDayOfMonth();</span><br><span class="line">    <span class="comment">// 5.å†™å…¥Redis SETBIT key offset 1</span></span><br><span class="line">    stringRedisTemplate.opsForValue().setBit(key, dayOfMonth - <span class="number">1</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>UserServiceImpl</code> ä¸­ï¼Œå…·ä½“å®ç°ç­¾åˆ°çš„åŠŸèƒ½ã€‚ä»£ç æ‰§è¡Œçš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li><strong>è·å–å½“å‰ç”¨æˆ· ID</strong>ï¼šé€šè¿‡ <code>UserHolder.getUser().getId()</code> è·å–å½“å‰ç”¨æˆ·çš„ IDã€‚</li><li><strong>è·å–å½“å‰æ—¥æœŸ</strong>ï¼šä½¿ç”¨ <code>LocalDateTime.now()</code> è·å–å½“å‰æ—¥æœŸï¼Œç”¨äºè®¡ç®—å½“å¤©çš„æ—¥æœŸã€‚</li><li><strong>æ„å»º Redis <code>key</code></strong>ï¼šæ ¹æ®ç”¨æˆ· ID å’Œå½“å‰å¹´æœˆï¼ˆæ ¼å¼ï¼š<code>yyyyMM</code>ï¼‰æ„å»º Redis çš„ <code>key</code>ï¼Œå³ <code>USER_SIGN_KEY + userId + keySuffix</code>ï¼Œå…¶ä¸­ <code>keySuffix</code> ä¸ºå¹´æœˆã€‚</li><li><strong>è®¡ç®—ä»Šå¤©æ˜¯æœ¬æœˆçš„ç¬¬å‡ å¤©</strong>ï¼šé€šè¿‡ <code>now.getDayOfMonth()</code> è·å–ä»Šå¤©æ˜¯æœ¬æœˆçš„ç¬¬å‡ å¤©ï¼ˆä¾‹å¦‚ 1ã€2ã€3â€¦ï¼‰ã€‚</li><li><strong>æ›´æ–° Redis ä¸­çš„ BitMap</strong>ï¼šé€šè¿‡ <code>stringRedisTemplate.opsForValue().setBit(key, dayOfMonth - 1, true)</code> å°†å¯¹åº”æ—¥æœŸçš„ç­¾åˆ°çŠ¶æ€è®¾ç½®ä¸º <code>1</code>ï¼Œè¡¨ç¤ºè¯¥ç”¨æˆ·å·²ç­¾åˆ°ã€‚</li></ul><p><code>SETBIT key offset 1</code>ï¼šå°† <code>key</code> å¯¹åº”çš„ BitMap ä¸­çš„ <code>offset</code> ä½ç½®è®¾ç½®ä¸º <code>1</code>ï¼Œè¡¨ç¤ºç”¨æˆ·åœ¨è¯¥æ—¥æœŸå·²ç­¾åˆ°ã€‚</p><ul><li><code>key</code>ï¼šç”¨æˆ·æŸä¸ªæœˆçš„ç­¾åˆ°è®°å½•ã€‚</li><li><code>offset</code>ï¼šç­¾åˆ°çš„æ—¥æœŸï¼Œ<code>dayOfMonth - 1</code>ï¼ˆå¦‚ 1 å·ç­¾åˆ°å¯¹åº”çš„ <code>offset</code> ä¸º 0ï¼‰ã€‚</li><li><code>true</code>ï¼šè¡¨ç¤ºè¯¥æ—¥æœŸå·²ç­¾åˆ°ï¼ˆ1ï¼‰ï¼Œ<code>false</code> è¡¨ç¤ºæœªç­¾åˆ°ï¼ˆ0ï¼‰ã€‚</li></ul><p>ç”¨Apifoxè¿›è¡Œæµ‹è¯•ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-335-1024x453.png" alt="img"></p><h3 id="11-3-ç”¨æˆ·ç­¾åˆ°-ç­¾åˆ°ç»Ÿè®¡">11.3 ç”¨æˆ·ç­¾åˆ°-ç­¾åˆ°ç»Ÿè®¡</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-337.png" alt="img"></p><p>åœ¨UserControllerç±»ä¸­å†™å…¥å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">&quot;/sign/count&quot;</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="function">Result <span class="title">signCount</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">return</span> userService.<span class="title">signCount</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨IUserServiceç±»ä¸­å†™å…¥å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Result <span class="title">signCount</span>()</span>;</span><br></pre></td></tr></table></figure><p>åœ¨UserServiceImplç±»ä¸­å†™å…¥å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">public Result signCount() &#123;</span><br><span class="line">    <span class="comment">//1.è·å–å½“å‰ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    Long userId = UserHolder.getUser().getId();</span><br><span class="line">    <span class="comment">//2.è·å–æ—¥æœŸ</span></span><br><span class="line">    LocalDateTime now = LocalDateTime.now();</span><br><span class="line">    <span class="comment">//3.æ‹¼æ¥key</span></span><br><span class="line">    <span class="built_in">String</span> keySuffix = now.format(DateTimeFormatter.ofPattern(<span class="string">&quot;yyyyMM&quot;</span>));</span><br><span class="line">    <span class="built_in">String</span> key = USER_SIGN_KEY + userId + keySuffix;</span><br><span class="line">    <span class="comment">//4.è·å–ä»Šå¤©æ˜¯æœ¬æœˆç¬¬å‡ å¤©</span></span><br><span class="line">    <span class="built_in">int</span> dayOfMonth = now.getDayOfMonth();</span><br><span class="line">    <span class="comment">//5.è·å–æœ¬æœˆæˆªæ­¢ä»Šå¤©ä¸ºæ­¢çš„æ‰€æœ‰çš„ç­¾åˆ°è®°å½•ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªåè¿›åˆ¶çš„æ•°å­— BITFIELD sign:5:202203 GET u14 0</span></span><br><span class="line">    <span class="built_in">List</span>&lt;Long&gt; result = stringRedisTemplate.opsForValue().bitField(</span><br><span class="line">            key, BitFieldSubCommands.create()</span><br><span class="line">                    .<span class="keyword">get</span>(BitFieldSubCommands.BitFieldType.unsigned(dayOfMonth)).valueAt(<span class="number">0</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">if</span>(result==<span class="keyword">null</span> || result.isEmpty())&#123;</span><br><span class="line">        <span class="comment">//æ²¡æœ‰ä»»ä½•ç­¾åˆ°ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    Long <span class="built_in">num</span> = result.<span class="keyword">get</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">num</span>==<span class="keyword">null</span> || <span class="built_in">num</span>==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.ok(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6.å¾ªç¯éå†</span></span><br><span class="line">    <span class="built_in">int</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">        <span class="comment">//6.1.è®©è¿™ä¸ªæ•°å­—ä¸1åšä¸è¿ç®—ï¼Œå¾—åˆ°æ•°å­—çš„æœ€åä¸€ä¸ªbitä½</span></span><br><span class="line">        <span class="keyword">if</span>((<span class="built_in">num</span>&amp;<span class="number">1</span>)==<span class="number">0</span>)&#123;<span class="comment">//6.2.åˆ¤æ–­è¿™ä¸ªbitä½æ˜¯å¦ä¸º0</span></span><br><span class="line">            <span class="comment">//6.3.å¦‚æœä¸º0ï¼Œè¯´æ˜æœªç­¾åˆ°ç»“æŸ</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//6.4.å¦‚æœä¸ä¸º0ï¼Œè¯´æ˜å·²ç­¾åˆ°ï¼Œè®¡æ•°å™¨+1</span></span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//6.5.æŠŠæ•°å­—å³ç§»ä¸€ä½ï¼ŒæŠ›å¼ƒæœ€åä¸€ä¸ªbitä½,ç»§ç»­ä¸‹ä¸€ä¸ªbitä½</span></span><br><span class="line">        <span class="built_in">num</span> &gt;&gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> Result.ok(count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>æ­¥éª¤ 1</strong>ï¼šè·å–å½“å‰ç™»å½•ç”¨æˆ·çš„ IDã€‚</li><li><strong>æ­¥éª¤ 2</strong>ï¼šè·å–å½“å‰æ—¥æœŸã€‚</li><li><strong>æ­¥éª¤ 3</strong>ï¼šæ‹¼æ¥ Redis <code>key</code>ï¼Œæ ¼å¼ä¸º <code>USER_SIGN_KEY + userId + &quot;yyyyMM&quot;</code>ï¼Œç”¨äºæ ‡è¯†æ¯ä¸ªæœˆçš„ç­¾åˆ°æ•°æ®ã€‚</li><li><strong>æ­¥éª¤ 4</strong>ï¼šè·å–ä»Šå¤©æ˜¯æœ¬æœˆçš„ç¬¬å‡ å¤©ï¼Œå³ <code>dayOfMonth</code>ã€‚</li><li><strong>æ­¥éª¤ 5</strong>ï¼šä½¿ç”¨ <code>BITFIELD</code> å‘½ä»¤è·å–å½“å‰æœˆæˆªè‡³ä»Šå¤©çš„ç­¾åˆ°æ•°æ®ã€‚é€šè¿‡ <code>BitFieldSubCommands</code> è®¾ç½®è·å–ç­¾åˆ°ä¿¡æ¯çš„ä½æ•°ã€‚</li><li><strong>æ­¥éª¤ 6</strong>ï¼šéå†ç­¾åˆ°æ•°æ®ï¼Œé€šè¿‡ä½æ“ä½œï¼ˆä¸è¿ç®—ï¼‰ç»Ÿè®¡è¿ç»­ç­¾åˆ°çš„å¤©æ•°ã€‚</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-338-1024x449.png" alt="img"></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-339.png" alt="img"></p><p>11.4 é¢å¤–è¡¥å……-å…³äºä½¿ç”¨bitmapæ¥è§£å†³ç¼“å­˜ç©¿é€çš„æ–¹æ¡ˆ</p><p>å›é¡¾<strong>ç¼“å­˜ç©¿é€</strong>ï¼š</p><p><strong>ç¼“å­˜ç©¿é€é—®é¢˜æ¦‚è¿°</strong>ï¼š</p><ul><li>å…¸å‹çš„è§£å†³åŠæ³•æ˜¯ <strong>ç¼“å­˜ç©ºå€¼</strong>ï¼Œå³å½“æ•°æ®åº“æŸ¥è¯¢è¿”å›ç©ºæ•°æ®æ—¶ï¼Œå°†è¿™ä¸ªç©ºæ•°æ®ä¹Ÿå­˜å…¥ç¼“å­˜ï¼Œä»¥é˜²æ­¢ç›¸åŒçš„æ— æ•ˆæŸ¥è¯¢é¢‘ç¹è®¿é—®æ•°æ®åº“ã€‚</li><li><strong>ç¼“å­˜ç©¿é€</strong>æŒ‡çš„æ˜¯ç”¨æˆ·è¯·æ±‚çš„æ•°æ®æ—¢ä¸åœ¨ç¼“å­˜ä¸­ï¼Œä¹Ÿä¸åœ¨æ•°æ®åº“ä¸­ã€‚æ¯æ¬¡ç”¨æˆ·è¯·æ±‚çš„éƒ½å¯èƒ½æ˜¯ä¸€ä¸ªä¸å­˜åœ¨çš„æ•°æ®ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä¸æ–­è¯·æ±‚ä¸å­˜åœ¨çš„æ•°æ®æ¥ç»•è¿‡ç¼“å­˜ï¼Œç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œé€ æˆæ•°æ®åº“è´Ÿæ‹…è¿‡é‡ã€‚</li></ul><p><strong>ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><p>åœ¨ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆä¸­ï¼Œå¦‚æœæ•°æ®åº“ä¸­æ²¡æœ‰æ•°æ®ï¼Œç¼“å­˜ä¸­ä¹Ÿæ²¡æœ‰ï¼Œæˆ‘ä»¬å°±ä¼šæŠŠè¯¥æ•°æ®æ ‡è®°ä¸ºç©ºå¹¶å­˜å…¥ç¼“å­˜ï¼Œè¿™æ ·ä¸‹ä¸€æ¬¡è¯·æ±‚è¯¥æ•°æ®æ—¶ç›´æ¥ä»ç¼“å­˜ä¸­è·å–ã€‚ä½†è¿™ä¸ªæ–¹æ³•å­˜åœ¨çš„é—®é¢˜æ˜¯ï¼š</p><ul><li>å¦‚æœæŸ¥è¯¢çš„æ˜¯ä¸åŒçš„ ID æ•°æ®ï¼Œç¼“å­˜ä¼šé€æ¸å˜å¾—éå¸¸å¤§ï¼Œå ç”¨è¾ƒå¤šå†…å­˜ã€‚</li><li>å¦‚æœè¯·æ±‚çš„æ˜¯æŸä¸ªä¸å­˜åœ¨çš„æ•°æ®ï¼Œç¼“å­˜æ— æ³•ä»ä¸€å¼€å§‹è§£å†³ã€‚</li></ul><p>æ‰€ä»¥æˆ‘ä»¬å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p><p>ä¸ºäº†æ›´æœ‰æ•ˆåœ°è§£å†³ç¼“å­˜ç©¿é€é—®é¢˜å¹¶ä¼˜åŒ–å­˜å‚¨ç©ºé—´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <strong>BitMap</strong> ä»£æ›¿ <strong>List</strong> æ¥å­˜å‚¨ ID æ•°æ®ã€‚</p><h4 id="æ€è·¯ï¼š"><strong>æ€è·¯</strong>ï¼š</h4><ol><li><strong>æ•°æ®å­˜å‚¨æ–¹å¼</strong>ï¼šå°†æ‰€æœ‰åˆæ³•çš„ ID å­˜å‚¨åˆ°ä¸€ä¸ªéå¸¸å¤§çš„ <strong>BitMap</strong> ä¸­ã€‚æ¯ä¸ª ID çš„ä½ç½®ï¼ˆå³ç´¢å¼•ï¼‰å¯¹åº”äº BitMap çš„æŸä¸€ä½ã€‚å½“ç”¨æˆ·è®¿é—®æŸä¸ª ID æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡å“ˆå¸Œç®—æ³•ï¼ˆå¦‚ <code>id % bitmap.size</code>ï¼‰è®¡ç®—å‡ºè¯¥ ID åº”è¯¥å­˜å‚¨åœ¨ BitMap çš„å“ªä¸ªä½ç½®ï¼Œå¹¶å°†è¯¥ä½ç½®çš„å€¼è®¾ç½®ä¸º 1ï¼Œè¡¨ç¤ºè¯¥æ•°æ®å·²ç»å­˜åœ¨ã€‚</li><li><strong>æŸ¥è¯¢è¿‡ç¨‹</strong>ï¼šå½“ç”¨æˆ·æŸ¥è¯¢æŸä¸ªæ•°æ®æ—¶ï¼Œæˆ‘ä»¬åŒæ ·é€šè¿‡å“ˆå¸Œç®—æ³•è®¡ç®—è¯¥ ID åº”è¯¥è½åœ¨ BitMap çš„å“ªä¸ªä½ç½®ã€‚å¦‚æœè¯¥ä½ç½®çš„å€¼ä¸º 1ï¼Œè¡¨ç¤ºè¯¥æ•°æ®å­˜åœ¨ï¼›å¦‚æœä¸º 0ï¼Œåˆ™è¡¨ç¤ºè¯¥æ•°æ®ä¸å­˜åœ¨ï¼Œå¯ä»¥ç›´æ¥è¿”å›ï¼Œä¸è®¿é—®æ•°æ®åº“ã€‚</li></ol><h4 id="æ­¥éª¤ï¼š"><strong>æ­¥éª¤</strong>ï¼š</h4><ol><li><p>å°† ID æ•°æ®å­˜å‚¨åˆ° BitMap</p><p>ï¼šä¾‹å¦‚ï¼Œä½¿ç”¨ Redis çš„</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">SETBIT</span></span><br></pre></td></tr></table></figure><p>å‘½ä»¤å°†æŸä¸ª ID å¯¹åº”çš„ä½è®¾ç½®ä¸º</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1</span><br></pre></td></tr></table></figure><p>ï¼Œè¡¨ç¤ºè¯¥ ID å¯¹åº”çš„æ•°æ®å­˜åœ¨ã€‚</p><ul><li><code>SETBIT key offset 1</code>ï¼šè®¾ç½® <code>key</code> å¯¹åº”çš„ä½ï¼ˆç”± ID è®¡ç®—å¾—å‡ºï¼‰ä¸º 1ï¼Œè¡¨ç¤ºæ•°æ®å­˜åœ¨ã€‚</li></ul></li><li><p><strong>æŸ¥è¯¢æ—¶é€šè¿‡å“ˆå¸Œè®¡ç®—ä½ç½®</strong>ï¼šå½“ç”¨æˆ·è¯·æ±‚æŸä¸ª ID æ—¶ï¼Œä½¿ç”¨å“ˆå¸Œç®—æ³•ï¼ˆ<code>id % bitmap.size</code>ï¼‰è®¡ç®—å‡ºè¯¥ ID åœ¨ BitMap ä¸­çš„åç§»ä½ç½®ã€‚å¦‚æœè¯¥ä½ç½®ä¸º 1ï¼Œåˆ™è¡¨ç¤ºè¯¥æ•°æ®å­˜åœ¨ï¼Œåä¹‹ä¸º 0ï¼Œåˆ™è¯´æ˜è¯¥æ•°æ®ä¸å­˜åœ¨ã€‚</p></li></ol><h4 id="ä¼˜ç‚¹ï¼š"><strong>ä¼˜ç‚¹</strong>ï¼š</h4><ul><li><strong>èŠ‚çœå†…å­˜</strong>ï¼šBitMap åªç”¨ä¸€ä¸ªæ¯”ç‰¹ä½æ¥è¡¨ç¤ºä¸€ä¸ªæ•°æ®çš„å­˜åœ¨ä¸å¦ï¼Œç›¸æ¯” List æˆ– HashMap ç­‰æ•°æ®ç»“æ„ï¼Œå®ƒèƒ½å¤Ÿæ˜¾è‘—å‡å°‘å†…å­˜å ç”¨ã€‚</li><li><strong>é«˜æ•ˆæŸ¥è¯¢</strong>ï¼šBitMap çš„æŸ¥è¯¢æ“ä½œéå¸¸å¿«é€Ÿï¼Œé€šè¿‡ç›´æ¥è®¿é—®å¯¹åº”çš„ä½æ¥åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ï¼ŒæŸ¥è¯¢å¤æ‚åº¦ä¸º O(1)ã€‚</li></ul><h4 id="è¯¯å·®ç‡ï¼š"><strong>è¯¯å·®ç‡</strong>ï¼š</h4><p>ç”±äºä½¿ç”¨å“ˆå¸Œç®—æ³•æ¥æ˜ å°„ ID åˆ° BitMap ä¸­çš„ä½ï¼Œå› æ­¤å¯èƒ½ä¼šå‘ç”Ÿ <strong>å“ˆå¸Œå†²çª</strong>ã€‚å¦‚æœå¤šä¸ª ID è¢«æ˜ å°„åˆ° BitMap çš„åŒä¸€ä½ä¸Šï¼Œå¯èƒ½ä¼šå‡ºç°è¯¯åˆ¤çš„æƒ…å†µï¼ˆå³è®¤ä¸ºæŸä¸ªæ•°æ®å­˜åœ¨ï¼Œä½†å®é™…å¹¶ä¸å­˜åœ¨ï¼‰ã€‚è¿™ç§æƒ…å†µç§°ä¸ºè¯¯å·®ç‡ã€‚</p><p>è¯¯å·®ç‡ä¼šéšç€å“ˆå¸Œå†²çªçš„å¢åŠ è€Œå¢å¤§ï¼Œé€šå¸¸æˆ‘ä»¬å¯ä»¥é€šè¿‡å¢åŠ  BitMap çš„å¤§å°æ¥é™ä½è¯¯å·®ç‡ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-340-1024x260.png" alt="img"></p><ul><li>ç”¨æˆ·å‘èµ·è¯·æ±‚ï¼ŒæŸ¥è¯¢æŸä¸ªæ•°æ®ï¼ˆå¦‚ ID ä¸º 1ã€2ã€3 çš„æ•°æ®ï¼‰ã€‚</li><li>æ•°æ®è¢«å­˜å‚¨åˆ° Redis ä¸­ï¼Œé€šè¿‡ <code>List</code> å­˜å‚¨ ID æ•°æ®ã€‚æŸ¥è¯¢æ—¶ï¼Œé€šè¿‡æ£€æŸ¥ <code>List</code> æ˜¯å¦åŒ…å«å¯¹åº”çš„ ID æ•°æ®æ¥åˆ¤æ–­ç¼“å­˜æ˜¯å¦å‘½ä¸­ã€‚</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-341-1024x432.png" alt="img"></p><ul><li>å°† <code>List</code> æ•°æ®ç»“æ„æ›¿æ¢æˆ <code>BitMap</code>ï¼Œå¹¶ä½¿ç”¨å“ˆå¸Œç®—æ³•å°†æ¯ä¸ª ID æ˜ å°„åˆ° BitMap çš„æŸä¸€ä½ã€‚</li><li>ä½¿ç”¨ Redis çš„ BitMapï¼ˆ<code>SETBIT</code> å’Œ <code>GETBIT</code>ï¼‰æ“ä½œï¼Œå‡å°‘äº† <code>List</code> å­˜å‚¨ç©ºé—´ï¼Œå¹¶ä¸”æé«˜äº†æŸ¥è¯¢æ•ˆç‡ã€‚</li></ul><h4 id="å…·ä½“æ“ä½œï¼š"><strong>å…·ä½“æ“ä½œ</strong>ï¼š</h4><ul><li><strong>SETBIT</strong>ï¼šè®¾ç½®æŸä¸ªä½ä¸º <code>1</code>ï¼Œè¡¨ç¤ºæ•°æ®å­˜åœ¨ã€‚</li><li><strong>GETBIT</strong>ï¼šè·å–æŸä¸ªä½çš„å€¼ï¼Œåˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ã€‚</li></ul><h2 id="12ã€UVç»Ÿè®¡">12ã€UVç»Ÿè®¡</h2><h3 id="12-1-ã€UVç»Ÿè®¡-HyperLogLog">12.1 ã€UVç»Ÿè®¡-HyperLogLog</h3><p>é¦–å…ˆæˆ‘ä»¬ææ‡‚ä¸¤ä¸ªæ¦‚å¿µï¼š</p><ul><li>UVï¼šå…¨ç§°Unique Visitorï¼Œä¹Ÿå«ç‹¬ç«‹è®¿å®¢é‡ï¼Œæ˜¯æŒ‡é€šè¿‡äº’è”ç½‘è®¿é—®ã€æµè§ˆè¿™ä¸ªç½‘é¡µçš„è‡ªç„¶äººã€‚1å¤©å†…åŒä¸€ä¸ªç”¨æˆ·å¤šæ¬¡è®¿é—®è¯¥ç½‘ç«™ï¼Œåªè®°å½•1æ¬¡ã€‚</li><li>PVï¼šå…¨ç§°Page Viewï¼Œä¹Ÿå«é¡µé¢è®¿é—®é‡æˆ–ç‚¹å‡»é‡ï¼Œç”¨æˆ·æ¯è®¿é—®ç½‘ç«™çš„ä¸€ä¸ªé¡µé¢ï¼Œè®°å½•1æ¬¡PVï¼Œç”¨æˆ·å¤šæ¬¡æ‰“å¼€é¡µé¢ï¼Œåˆ™è®°å½•å¤šæ¬¡PVã€‚å¾€å¾€ç”¨æ¥è¡¡é‡ç½‘ç«™çš„æµé‡ã€‚</li></ul><p>é€šå¸¸æ¥è¯´UVä¼šæ¯”PVå¤§å¾ˆå¤šï¼Œæ‰€ä»¥è¡¡é‡åŒä¸€ä¸ªç½‘ç«™çš„è®¿é—®é‡ï¼Œæˆ‘ä»¬éœ€è¦ç»¼åˆè€ƒè™‘å¾ˆå¤šå› ç´ ï¼Œæ‰€ä»¥æˆ‘ä»¬åªæ˜¯å•çº¯çš„æŠŠè¿™ä¸¤ä¸ªå€¼ä½œä¸ºä¸€ä¸ªå‚è€ƒå€¼</p><p>UVç»Ÿè®¡åœ¨æœåŠ¡ç«¯åšä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸ºè¦åˆ¤æ–­è¯¥ç”¨æˆ·æ˜¯å¦å·²ç»ç»Ÿè®¡è¿‡äº†ï¼Œéœ€è¦å°†ç»Ÿè®¡è¿‡çš„ç”¨æˆ·ä¿¡æ¯ä¿å­˜ã€‚ä½†æ˜¯å¦‚æœæ¯ä¸ªè®¿é—®çš„ç”¨æˆ·éƒ½ä¿å­˜åˆ°Redisä¸­ï¼Œæ•°æ®é‡ä¼šéå¸¸ææ€–ï¼Œé‚£æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p><p>Hyperloglog(HLL)æ˜¯ä»Loglogç®—æ³•æ´¾ç”Ÿçš„æ¦‚ç‡ç®—æ³•ï¼Œç”¨äºç¡®å®šéå¸¸å¤§çš„é›†åˆçš„åŸºæ•°ï¼Œè€Œä¸éœ€è¦å­˜å‚¨å…¶æ‰€æœ‰å€¼ã€‚ç›¸å…³ç®—æ³•åŸç†å¤§å®¶å¯ä»¥å‚è€ƒï¼š<a href="https://juejin.cn/post/6844903785744056333#heading-0">https://juejin.cn/post/6844903785744056333#heading-0</a> Redisä¸­çš„HLLæ˜¯åŸºäºstringç»“æ„å®ç°çš„ï¼Œå•ä¸ªHLLçš„å†…å­˜<strong>æ°¸è¿œå°äº16kb</strong>ï¼Œ<strong>å†…å­˜å ç”¨ä½</strong>çš„ä»¤äººå‘æŒ‡ï¼ä½œä¸ºä»£ä»·ï¼Œå…¶æµ‹é‡ç»“æœæ˜¯æ¦‚ç‡æ€§çš„ï¼Œ<strong>æœ‰å°äº0.81ï¼…çš„è¯¯å·®</strong>ã€‚ä¸è¿‡å¯¹äºUVç»Ÿè®¡æ¥è¯´ï¼Œè¿™å®Œå…¨å¯ä»¥å¿½ç•¥ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-342-1024x356.png" alt="img"></p><p>ä¸è®ºæ·»åŠ å‡ æ¬¡ï¼Œæ°¸è¿œåªè®°å½•ä¸€æ¬¡ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-344.png" alt="img"></p><h3 id="12-2-UVç»Ÿè®¡-æµ‹è¯•ç™¾ä¸‡æ•°æ®çš„ç»Ÿè®¡">12.2 UVç»Ÿè®¡-æµ‹è¯•ç™¾ä¸‡æ•°æ®çš„ç»Ÿè®¡</h3><p>æµ‹è¯•æ€è·¯ï¼šæˆ‘ä»¬ç›´æ¥åˆ©ç”¨å•å…ƒæµ‹è¯•ï¼Œå‘HyperLogLogä¸­æ·»åŠ 100ä¸‡æ¡æ•°æ®ï¼Œçœ‹çœ‹å†…å­˜å ç”¨å’Œç»Ÿè®¡æ•ˆæœå¦‚ä½•</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-343-1024x506.png" alt="img"></p><p>ç»è¿‡æµ‹è¯•ï¼šæˆ‘ä»¬ä¼šå‘ç”Ÿä»–çš„è¯¯å·®æ˜¯åœ¨å…è®¸èŒƒå›´å†…ï¼Œå¹¶ä¸”å†…å­˜å ç”¨æå°</p><p>100ä¸‡æ•°æ®æˆåŠŸå†™å…¥ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-345-1024x556.png" alt="img"></p><p>æµ‹è¯•å‰ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-346.png" alt="img"></p><p>æµ‹è¯•åï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-347.png" alt="img"></p><p>å¤§çº¦å ç”¨11kbï¼Œç¡®å®æ˜¯å°äº16kbã€‚</p><h1 id="Redis-å®æˆ˜ç¯‡-é»‘é©¬ç‚¹è¯„-å®Œç»“">Redis(å®æˆ˜ç¯‡-é»‘é©¬ç‚¹è¯„) å®Œç»“</h1>]]></content>
    
    
    <summary type="html">Redisä¸‰éƒ¨æ›²ä¸­ç¯‡-å®æˆ˜ç¯‡é»‘é©¬ç‚¹è¯„</summary>
    
    
    
    <category term="Redis" scheme="https://itgeqian.github.io/categories/Redis/"/>
    
    
    <category term="Redis" scheme="https://itgeqian.github.io/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>RedisåŸºç¡€ç¯‡</title>
    <link href="https://itgeqian.github.io/posts/5.html"/>
    <id>https://itgeqian.github.io/posts/5.html</id>
    <published>2024-09-10T03:19:03.000Z</published>
    <updated>2024-09-12T09:12:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-åˆè¯†Redis">1.åˆè¯†Redis</h2><p>Redisæ˜¯ä¸€ç§é”®å€¼å‹çš„NoSqlæ•°æ®åº“ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªå…³é”®å­—ï¼š</p><ul><li>é”®å€¼å‹</li><li>NoSql</li></ul><p>å…¶ä¸­<strong>é”®å€¼å‹</strong>ï¼Œæ˜¯æŒ‡Redisä¸­å­˜å‚¨çš„æ•°æ®éƒ½æ˜¯ä»¥keyã€valueå¯¹çš„å½¢å¼å­˜å‚¨ï¼Œè€Œvalueçš„å½¢å¼å¤šç§å¤šæ ·ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•°å€¼ã€ç”šè‡³jsonï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-1024x416.png" alt="img"></p><h3 id=""></h3><h3 id="1-1-è®¤è¯†NoSQL">1.1.è®¤è¯†NoSQL</h3><p><strong>NoSql</strong>å¯ä»¥ç¿»è¯‘åšNot Only Sqlï¼ˆä¸ä»…ä»…æ˜¯SQLï¼‰ï¼Œæˆ–è€…æ˜¯No Sqlï¼ˆéSqlçš„ï¼‰æ•°æ®åº“ã€‚æ˜¯ç›¸å¯¹äºä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“è€Œè¨€ï¼Œæœ‰å¾ˆå¤§å·®å¼‚çš„ä¸€ç§ç‰¹æ®Šçš„æ•°æ®åº“ï¼Œå› æ­¤ä¹Ÿç§°ä¹‹ä¸º<strong>éå…³ç³»å‹æ•°æ®åº“</strong>ã€‚</p><ul><li>Redis</li><li>Mongo db</li><li>MemCached</li></ul><h4 id="1-1-1-ç»“æ„åŒ–ä¸éç»“æ„åŒ–">1.1.1.ç»“æ„åŒ–ä¸éç»“æ„åŒ–</h4><p>ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“æ˜¯ç»“æ„åŒ–æ•°æ®ï¼Œæ¯ä¸€å¼ è¡¨éƒ½æœ‰ä¸¥æ ¼çš„çº¦æŸä¿¡æ¯ï¼šå­—æ®µåã€å­—æ®µæ•°æ®ç±»å‹ã€å­—æ®µçº¦æŸç­‰ç­‰ä¿¡æ¯ï¼Œæ’å…¥çš„æ•°æ®å¿…é¡»éµå®ˆè¿™äº›çº¦æŸï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-2.png" alt="img"></p><p>è€ŒNoSqlåˆ™å¯¹æ•°æ®åº“æ ¼å¼æ²¡æœ‰ä¸¥æ ¼çº¦æŸï¼Œå¾€å¾€å½¢å¼æ¾æ•£ï¼Œè‡ªç”±ã€‚</p><p>å¯ä»¥æ˜¯é”®å€¼å‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-3.png" alt="img"></p><p>ä¹Ÿå¯ä»¥æ˜¯æ–‡æ¡£å‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-4.png" alt="img"></p><p>ç”šè‡³å¯ä»¥æ˜¯å›¾æ ¼å¼ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-5.png" alt="img"></p><h4 id="1-1-2-å…³è”å’Œéå…³è”">1.1.2.å…³è”å’Œéå…³è”</h4><p>ä¼ ç»Ÿæ•°æ®åº“çš„è¡¨ä¸è¡¨ä¹‹é—´å¾€å¾€å­˜åœ¨å…³è”ï¼Œä¾‹å¦‚å¤–é”®ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-6-1024x520.png" alt="img"></p><p>è€Œéå…³ç³»å‹æ•°æ®åº“ä¸å­˜åœ¨å…³è”å…³ç³»ï¼Œè¦ç»´æŠ¤å…³ç³»è¦ä¹ˆé ä»£ç ä¸­çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¦ä¹ˆé æ•°æ®ä¹‹é—´çš„è€¦åˆï¼š</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="params">id:</span> <span class="number">1</span>,</span><br><span class="line">  <span class="params">name:</span> <span class="string">&quot;å¼ ä¸‰&quot;</span>,</span><br><span class="line">  <span class="params">orders:</span> [</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="params">id:</span> <span class="number">1</span>,</span><br><span class="line">       <span class="params">item:</span> &#123;</span><br><span class="line">     <span class="params">id:</span> <span class="number">10</span>, <span class="params">title:</span> <span class="string">&quot;è£è€€6&quot;</span>, <span class="params">price:</span> <span class="number">4999</span></span><br><span class="line">       &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="params">id:</span> <span class="number">2</span>,</span><br><span class="line">       <span class="params">item:</span> &#123;</span><br><span class="line">     <span class="params">id:</span> <span class="number">20</span>, <span class="params">title:</span> <span class="string">&quot;å°ç±³11&quot;</span>, <span class="params">price:</span> <span class="number">3999</span></span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤å¤„è¦ç»´æŠ¤â€œå¼ ä¸‰â€çš„è®¢å•ä¸å•†å“â€œè£è€€â€å’Œâ€œå°ç±³11â€çš„å…³ç³»ï¼Œä¸å¾—ä¸å†—ä½™çš„å°†è¿™ä¸¤ä¸ªå•†å“ä¿å­˜åœ¨å¼ ä¸‰çš„è®¢å•æ–‡æ¡£ä¸­ï¼Œä¸å¤Ÿä¼˜é›…ã€‚è¿˜æ˜¯å»ºè®®ç”¨ä¸šåŠ¡æ¥ç»´æŠ¤å…³è”å…³ç³»ã€‚</p><h4 id="1-1-3-æŸ¥è¯¢æ–¹å¼">1.1.3.æŸ¥è¯¢æ–¹å¼</h4><p>ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“ä¼šåŸºäºSqlè¯­å¥åšæŸ¥è¯¢ï¼Œè¯­æ³•æœ‰ç»Ÿä¸€æ ‡å‡†ï¼›</p><p>è€Œä¸åŒçš„éå…³ç³»æ•°æ®åº“æŸ¥è¯¢è¯­æ³•å·®å¼‚æå¤§ï¼Œäº”èŠ±å…«é—¨å„ç§å„æ ·ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-7-1024x391.png" alt="img"></p><h4 id="1-1-4-äº‹åŠ¡">1.1.4.äº‹åŠ¡</h4><p>ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“èƒ½æ»¡è¶³äº‹åŠ¡ACIDçš„åŸåˆ™ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-8.png" alt="img"></p><p>è€Œéå…³ç³»å‹æ•°æ®åº“å¾€å¾€ä¸æ”¯æŒäº‹åŠ¡ï¼Œæˆ–è€…ä¸èƒ½ä¸¥æ ¼ä¿è¯ACIDçš„ç‰¹æ€§ï¼Œåªèƒ½å®ç°åŸºæœ¬çš„ä¸€è‡´æ€§ã€‚</p><h4 id="1-1-5-æ€»ç»“">1.1.5.æ€»ç»“</h4><p>é™¤äº†ä¸Šè¿°å››ç‚¹ä»¥å¤–ï¼Œåœ¨å­˜å‚¨æ–¹å¼ã€æ‰©å±•æ€§ã€æŸ¥è¯¢æ€§èƒ½ä¸Šå…³ç³»å‹ä¸éå…³ç³»å‹ä¹Ÿéƒ½æœ‰ç€æ˜¾è‘—å·®å¼‚ï¼Œæ€»ç»“å¦‚ä¸‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-9-1024x483.png" alt="img"></p><ul><li>å­˜å‚¨æ–¹å¼<ul><li>å…³ç³»å‹æ•°æ®åº“åŸºäºç£ç›˜è¿›è¡Œå­˜å‚¨ï¼Œä¼šæœ‰å¤§é‡çš„ç£ç›˜IOï¼Œå¯¹æ€§èƒ½æœ‰ä¸€å®šå½±å“</li><li>éå…³ç³»å‹æ•°æ®åº“ï¼Œä»–ä»¬çš„æ“ä½œæ›´å¤šçš„æ˜¯ä¾èµ–äºå†…å­˜æ¥æ“ä½œï¼Œå†…å­˜çš„è¯»å†™é€Ÿåº¦ä¼šéå¸¸å¿«ï¼Œæ€§èƒ½è‡ªç„¶ä¼šå¥½ä¸€äº›</li></ul></li><li>æ‰©å±•æ€§<ul><li>å…³ç³»å‹æ•°æ®åº“é›†ç¾¤æ¨¡å¼ä¸€èˆ¬æ˜¯ä¸»ä»ï¼Œä¸»ä»æ•°æ®ä¸€è‡´ï¼Œèµ·åˆ°æ•°æ®å¤‡ä»½çš„ä½œç”¨ï¼Œç§°ä¸ºå‚ç›´æ‰©å±•ã€‚</li><li>éå…³ç³»å‹æ•°æ®åº“å¯ä»¥å°†æ•°æ®æ‹†åˆ†ï¼Œå­˜å‚¨åœ¨ä¸åŒæœºå™¨ä¸Šï¼Œå¯ä»¥ä¿å­˜æµ·é‡æ•°æ®ï¼Œè§£å†³å†…å­˜å¤§å°æœ‰é™çš„é—®é¢˜ã€‚ç§°ä¸ºæ°´å¹³æ‰©å±•ã€‚</li><li>å…³ç³»å‹æ•°æ®åº“å› ä¸ºè¡¨ä¹‹é—´å­˜åœ¨å…³è”å…³ç³»ï¼Œå¦‚æœåšæ°´å¹³æ‰©å±•ä¼šç»™æ•°æ®æŸ¥è¯¢å¸¦æ¥å¾ˆå¤šéº»çƒ¦</li></ul></li></ul><h3 id="1-2-è®¤è¯†Redis">1.2.è®¤è¯†Redis</h3><p><strong>ç‰¹å¾</strong>ï¼š</p><ul><li>é”®å€¼ï¼ˆkey-valueï¼‰å‹ï¼Œvalueæ”¯æŒå¤šç§ä¸åŒæ•°æ®ç»“æ„ï¼ŒåŠŸèƒ½ä¸°å¯Œ</li><li>å•çº¿ç¨‹ï¼Œæ¯ä¸ªå‘½ä»¤å…·å¤‡åŸå­æ€§</li><li>ä½å»¶è¿Ÿï¼Œé€Ÿåº¦å¿«ï¼ˆåŸºäºå†…å­˜ã€IOå¤šè·¯å¤ç”¨ã€è‰¯å¥½çš„ç¼–ç ï¼‰ã€‚</li><li>æ”¯æŒæ•°æ®æŒä¹…åŒ–</li><li>æ”¯æŒä¸»ä»é›†ç¾¤ã€åˆ†ç‰‡é›†ç¾¤</li><li>æ”¯æŒå¤šè¯­è¨€å®¢æˆ·ç«¯</li></ul><h3 id="1-3-Redisçš„å¯åŠ¨">1.3 Redisçš„å¯åŠ¨</h3><p>redisçš„å¯åŠ¨æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œä¾‹å¦‚ï¼š</p><ul><li>é»˜è®¤å¯åŠ¨</li><li>æŒ‡å®šé…ç½®å¯åŠ¨</li><li>å¼€æœºè‡ªå¯</li></ul><h4 id="1-3-1é»˜è®¤å¯åŠ¨">1.3.1é»˜è®¤å¯åŠ¨</h4><p>å®‰è£…å®Œæˆåï¼Œåœ¨ä»»æ„ç›®å½•è¾“å…¥redis-serverå‘½ä»¤å³å¯å¯åŠ¨Redisï¼š</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-<span class="keyword">server</span></span><br></pre></td></tr></table></figure><h4 id="1-3-2-æŒ‡å®šé…ç½®å¯åŠ¨">1.3.2.æŒ‡å®šé…ç½®å¯åŠ¨</h4><p>å¦‚æœè¦è®©Redisä»¥<code>åå°</code>æ–¹å¼å¯åŠ¨ï¼Œåˆ™å¿…é¡»ä¿®æ”¹Redisé…ç½®æ–‡ä»¶</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># è¿›å…¥rediså®‰è£…ç›®å½• </span></span><br><span class="line"><span class="meta"># å¯åŠ¨</span></span><br><span class="line">redis-<span class="keyword">server</span>.exe redis.windows.conf</span><br><span class="line">RedisæœåŠ¡é»˜è®¤ç«¯å£å·ä¸º <span class="number">6379</span> ï¼Œé€šè¿‡å¿«æ·é”®Ctrl + C å³å¯åœæ­¢RedisæœåŠ¡</span><br><span class="line"></span><br><span class="line">å½“RedisæœåŠ¡å¯åŠ¨æˆåŠŸåï¼Œå¯é€šè¿‡å®¢æˆ·ç«¯è¿›è¡Œè¿æ¥ã€‚</span><br></pre></td></tr></table></figure><p>ç„¶åä¿®æ”¹redis.confæ–‡ä»¶ä¸­çš„ä¸€äº›é…ç½®ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…è®¸è®¿é—®çš„åœ°å€ï¼Œé»˜è®¤æ˜¯127.0.0.1ï¼Œä¼šå¯¼è‡´åªèƒ½åœ¨æœ¬åœ°è®¿é—®ã€‚ä¿®æ”¹ä¸º0.0.0.0åˆ™å¯ä»¥åœ¨ä»»æ„IPè®¿é—®ï¼Œç”Ÿäº§ç¯å¢ƒä¸è¦è®¾ç½®ä¸º0.0.0.0</span></span><br><span class="line"><span class="attribute">bind</span> <span class="number">0.0.0.0</span></span><br><span class="line"><span class="comment"># å®ˆæŠ¤è¿›ç¨‹ï¼Œä¿®æ”¹ä¸ºyesåå³å¯åå°è¿è¡Œ ï¼ˆwindowsä¸æ”¯æŒï¼‰</span></span><br><span class="line">daemonize <span class="literal">yes</span> </span><br><span class="line"><span class="comment"># å¯†ç ï¼Œè®¾ç½®åè®¿é—®Rediså¿…é¡»è¾“å…¥å¯†ç </span></span><br><span class="line">requirepass <span class="number">123456</span></span><br></pre></td></tr></table></figure><p>Redisçš„å…¶å®ƒå¸¸è§é…ç½®ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›‘å¬çš„ç«¯å£</span></span><br><span class="line"><span class="attribute">port</span> <span class="number">6379</span></span><br><span class="line"><span class="comment"># å·¥ä½œç›®å½•ï¼Œé»˜è®¤æ˜¯å½“å‰ç›®å½•ï¼Œä¹Ÿå°±æ˜¯è¿è¡Œredis-serveræ—¶çš„å‘½ä»¤ï¼Œæ—¥å¿—ã€æŒä¹…åŒ–ç­‰æ–‡ä»¶ä¼šä¿å­˜åœ¨è¿™ä¸ªç›®å½•</span></span><br><span class="line"><span class="attribute">dir</span> .</span><br><span class="line"><span class="comment"># æ•°æ®åº“æ•°é‡ï¼Œè®¾ç½®ä¸º1ï¼Œä»£è¡¨åªä½¿ç”¨1ä¸ªåº“ï¼Œé»˜è®¤æœ‰16ä¸ªåº“ï¼Œç¼–å·0~15</span></span><br><span class="line"><span class="attribute">databases</span> <span class="number">1</span></span><br><span class="line"><span class="comment"># è®¾ç½®redisèƒ½å¤Ÿä½¿ç”¨çš„æœ€å¤§å†…å­˜</span></span><br><span class="line"><span class="attribute">maxmemory</span> <span class="number">512</span>mb</span><br><span class="line"><span class="comment"># æ—¥å¿—æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºç©ºï¼Œä¸è®°å½•æ—¥å¿—ï¼Œå¯ä»¥æŒ‡å®šæ—¥å¿—æ–‡ä»¶å</span></span><br><span class="line"><span class="attribute">logfile</span> <span class="string">&quot;redis.log&quot;</span></span><br></pre></td></tr></table></figure><p>åœæ­¢æœåŠ¡ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ©ç”¨redis-cliæ¥æ‰§è¡Œ shutdown å‘½ä»¤ï¼Œå³å¯åœæ­¢ Redis æœåŠ¡ï¼Œ</span></span><br><span class="line"><span class="comment"># å› ä¸ºä¹‹å‰é…ç½®äº†å¯†ç ï¼Œå› æ­¤éœ€è¦é€šè¿‡ -u æ¥æŒ‡å®šå¯†ç </span></span><br><span class="line"><span class="attribute">redis</span>-cli -u <span class="number">123456</span> shutdown</span><br></pre></td></tr></table></figure><h4 id="1-3-3-å®¢æˆ·ç«¯è¿æ¥å‘½ä»¤">1.3.3 å®¢æˆ·ç«¯è¿æ¥å‘½ä»¤</h4><p><strong>redis-cli.exe</strong></p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-10-1024x261.png" alt="img"></p><p>é€šè¿‡redis-cli.exeå‘½ä»¤é»˜è®¤è¿æ¥çš„æ˜¯æœ¬åœ°çš„redisæœåŠ¡ï¼Œå¹¶ä¸”ä½¿ç”¨é»˜è®¤6379ç«¯å£ã€‚ä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®šå¦‚ä¸‹å‚æ•°è¿æ¥ï¼š</p><ul><li>-h ipåœ°å€</li><li>-p ç«¯å£å·</li><li>-a å¯†ç ï¼ˆå¦‚æœéœ€è¦ï¼‰</li><li></li></ul><h4 id="1-3-4Rediså®¢æˆ·ç«¯å›¾å½¢å·¥å…·">1.3.4Rediså®¢æˆ·ç«¯å›¾å½¢å·¥å…·</h4><p>é»˜è®¤æä¾›çš„å®¢æˆ·ç«¯è¿æ¥å·¥å…·ç•Œé¢ä¸å¤ªå‹å¥½ï¼ŒåŒæ—¶æ“ä½œä¹Ÿè¾ƒä¸ºéº»çƒ¦ï¼Œéœ€å¼•å…¥ä¸€ä¸ªRediså®¢æˆ·ç«¯å›¾å½¢å·¥å…·ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-11-1024x771.png" alt="img"></p><h2 id="2-Redisæ•°æ®ç±»å‹">2. Redisæ•°æ®ç±»å‹</h2><h3 id="2-1-äº”ç§å¸¸ç”¨æ•°æ®ç±»å‹ä»‹ç»">2.1 äº”ç§å¸¸ç”¨æ•°æ®ç±»å‹ä»‹ç»</h3><p>Rediså­˜å‚¨çš„æ˜¯key-valueç»“æ„çš„æ•°æ®ï¼Œå…¶ä¸­keyæ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œvalueæœ‰5ç§å¸¸ç”¨çš„æ•°æ®ç±»å‹ï¼š</p><ul><li>å­—ç¬¦ä¸² string</li><li>å“ˆå¸Œ hash</li><li>åˆ—è¡¨ list</li><li>é›†åˆ set</li><li>æœ‰åºé›†åˆ sorted set / zset</li></ul><h3 id="2-2-å„ç§æ•°æ®ç±»å‹ç‰¹ç‚¹">2.2 å„ç§æ•°æ®ç±»å‹ç‰¹ç‚¹</h3><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-12.png" alt="img"></p><p><strong>è§£é‡Šè¯´æ˜ï¼š</strong></p><ul><li>å­—ç¬¦ä¸²(string)ï¼šæ™®é€šå­—ç¬¦ä¸²ï¼ŒRedisä¸­æœ€ç®€å•çš„æ•°æ®ç±»å‹</li><li>å“ˆå¸Œ(hash)ï¼šä¹Ÿå«æ•£åˆ—ï¼Œç±»ä¼¼äºJavaä¸­çš„HashMapç»“æ„</li><li>åˆ—è¡¨(list)ï¼šæŒ‰ç…§æ’å…¥é¡ºåºæ’åºï¼Œå¯ä»¥æœ‰é‡å¤å…ƒç´ ï¼Œç±»ä¼¼äºJavaä¸­çš„LinkedList</li><li>é›†åˆ(set)ï¼šæ— åºé›†åˆï¼Œæ²¡æœ‰é‡å¤å…ƒç´ ï¼Œç±»ä¼¼äºJavaä¸­çš„HashSet</li><li>æœ‰åºé›†åˆ(sorted set/zset)ï¼šé›†åˆä¸­æ¯ä¸ªå…ƒç´ å…³è”ä¸€ä¸ªåˆ†æ•°(score)ï¼Œæ ¹æ®åˆ†æ•°å‡åºæ’åºï¼Œæ²¡æœ‰é‡å¤å…ƒç´ </li></ul><p>Redisæ˜¯å…¸å‹çš„key-valueæ•°æ®åº“ï¼Œkeyä¸€èˆ¬æ˜¯å­—ç¬¦ä¸²ï¼Œè€ŒvalueåŒ…å«å¾ˆå¤šä¸åŒçš„æ•°æ®ç±»å‹ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-13-1024x516.png" alt="img"></p><h2 id="3-Rediså¸¸ç”¨å‘½ä»¤">3. Rediså¸¸ç”¨å‘½ä»¤</h2><h3 id="3-1-Stringå­—ç¬¦ä¸²æ“ä½œå‘½ä»¤">3.1 Stringå­—ç¬¦ä¸²æ“ä½œå‘½ä»¤</h3><p>Redis ä¸­å­—ç¬¦ä¸²ç±»å‹å¸¸ç”¨å‘½ä»¤ï¼š</p><ul><li>SETï¼šæ·»åŠ æˆ–è€…ä¿®æ”¹å·²ç»å­˜åœ¨çš„ä¸€ä¸ªStringç±»å‹çš„é”®å€¼å¯¹</li><li>GETï¼šæ ¹æ®keyè·å–Stringç±»å‹çš„value</li><li>MSETï¼šæ‰¹é‡æ·»åŠ å¤šä¸ªStringç±»å‹çš„é”®å€¼å¯¹</li><li>MGETï¼šæ ¹æ®å¤šä¸ªkeyè·å–å¤šä¸ªStringç±»å‹çš„value</li><li>INCRï¼šè®©ä¸€ä¸ªæ•´å‹çš„keyè‡ªå¢1</li><li>INCRBY:è®©ä¸€ä¸ªæ•´å‹çš„keyè‡ªå¢å¹¶æŒ‡å®šæ­¥é•¿ï¼Œä¾‹å¦‚ï¼šincrby num 2 è®©numå€¼è‡ªå¢2</li><li>INCRBYFLOATï¼šè®©ä¸€ä¸ªæµ®ç‚¹ç±»å‹çš„æ•°å­—è‡ªå¢å¹¶æŒ‡å®šæ­¥é•¿</li><li>SETNXï¼šæ·»åŠ ä¸€ä¸ªStringç±»å‹çš„é”®å€¼å¯¹ï¼Œå‰ææ˜¯è¿™ä¸ªkeyä¸å­˜åœ¨ï¼Œå¦åˆ™ä¸æ‰§è¡Œ</li><li>SETEXï¼šæ·»åŠ ä¸€ä¸ªStringç±»å‹çš„é”®å€¼å¯¹ï¼Œå¹¶ä¸”æŒ‡å®šæœ‰æ•ˆæœŸ</li></ul><p>æ›´å¤šå‘½ä»¤å¯ä»¥å‚è€ƒRedisä¸­æ–‡ç½‘ï¼š<a href="https://www.redis.net.cn/">https://www.redis.net.cn</a></p><h3 id="3-2-Hashå“ˆå¸Œæ“ä½œå‘½ä»¤">3.2 Hashå“ˆå¸Œæ“ä½œå‘½ä»¤</h3><p>Redis hash æ˜¯ä¸€ä¸ªstringç±»å‹çš„ field å’Œ value çš„æ˜ å°„è¡¨ï¼Œhashç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ï¼Œå¸¸ç”¨å‘½ä»¤ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-14.png" alt="img"></p><ul><li>HSET key field valueï¼šæ·»åŠ æˆ–è€…ä¿®æ”¹hashç±»å‹keyçš„fieldçš„å€¼</li><li>HGET key fieldï¼šè·å–ä¸€ä¸ªhashç±»å‹keyçš„fieldçš„å€¼</li><li>HMSETï¼šæ‰¹é‡æ·»åŠ å¤šä¸ªhashç±»å‹keyçš„fieldçš„å€¼</li><li>HMGETï¼šæ‰¹é‡è·å–å¤šä¸ªhashç±»å‹keyçš„fieldçš„å€¼</li><li>HGETALLï¼šè·å–ä¸€ä¸ªhashç±»å‹çš„keyä¸­çš„æ‰€æœ‰çš„fieldå’Œvalue</li><li>HKEYSï¼šè·å–ä¸€ä¸ªhashç±»å‹çš„keyä¸­çš„æ‰€æœ‰çš„field</li><li>HINCRBY:è®©ä¸€ä¸ªhashç±»å‹keyçš„å­—æ®µå€¼è‡ªå¢å¹¶æŒ‡å®šæ­¥é•¿</li><li>HSETNXï¼šæ·»åŠ ä¸€ä¸ªhashç±»å‹çš„keyçš„fieldå€¼ï¼Œå‰ææ˜¯è¿™ä¸ªfieldä¸å­˜åœ¨ï¼Œå¦åˆ™ä¸æ‰§è¡Œ</li></ul><h3 id="3-3-Liståˆ—è¡¨æ“ä½œå‘½ä»¤">3.3 Liståˆ—è¡¨æ“ä½œå‘½ä»¤</h3><p>Redisä¸­çš„Listç±»å‹ä¸Javaä¸­çš„LinkedListç±»ä¼¼ï¼Œå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ç»“æ„ã€‚æ—¢å¯ä»¥æ”¯æŒæ­£å‘æ£€ç´¢å’Œä¹Ÿå¯ä»¥æ”¯æŒåå‘æ£€ç´¢ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-15.png" alt="img"></p><p>ç‰¹å¾ä¹Ÿä¸LinkedListç±»ä¼¼ï¼š</p><ul><li>æœ‰åº</li><li>å…ƒç´ å¯ä»¥é‡å¤</li><li>æ’å…¥å’Œåˆ é™¤å¿«</li><li>æŸ¥è¯¢é€Ÿåº¦ä¸€èˆ¬</li></ul><p>å¸¸ç”¨æ¥å­˜å‚¨ä¸€ä¸ªæœ‰åºæ•°æ®ï¼Œä¾‹å¦‚ï¼šæœ‹å‹åœˆç‚¹èµåˆ—è¡¨ï¼Œè¯„è®ºåˆ—è¡¨ç­‰ã€‚</p><ul><li>LPUSH key element â€¦ ï¼šå‘åˆ—è¡¨å·¦ä¾§æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </li><li>LPOP keyï¼šç§»é™¤å¹¶è¿”å›åˆ—è¡¨å·¦ä¾§çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ²¡æœ‰åˆ™è¿”å›nil</li><li>RPUSH key element â€¦ ï¼šå‘åˆ—è¡¨å³ä¾§æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </li><li>RPOP keyï¼šç§»é™¤å¹¶è¿”å›åˆ—è¡¨å³ä¾§çš„ç¬¬ä¸€ä¸ªå…ƒç´ </li><li>LRANGE key star endï¼šè¿”å›ä¸€æ®µè§’æ ‡èŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ </li><li>BLPOPå’ŒBRPOPï¼šä¸LPOPå’ŒRPOPç±»ä¼¼ï¼Œåªä¸è¿‡åœ¨æ²¡æœ‰å…ƒç´ æ—¶ç­‰å¾…æŒ‡å®šæ—¶é—´ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å›nil</li></ul><h3 id="3-4-Seté›†åˆæ“ä½œå‘½ä»¤">3.4 Seté›†åˆæ“ä½œå‘½ä»¤</h3><p>Redisçš„Setç»“æ„ä¸Javaä¸­çš„HashSetç±»ä¼¼ï¼Œå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªvalueä¸ºnullçš„HashMapã€‚å› ä¸ºä¹Ÿæ˜¯ä¸€ä¸ªhashè¡¨ï¼Œå› æ­¤å…·å¤‡ä¸HashSetç±»ä¼¼çš„ç‰¹å¾ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-16.png" alt="img"></p><ul><li>æ”¯æŒäº¤é›†ã€å¹¶é›†ã€å·®é›†ç­‰åŠŸèƒ½</li><li>æ— åº</li><li>å…ƒç´ ä¸å¯é‡å¤</li><li>æŸ¥æ‰¾å¿«</li></ul><p>Setçš„å¸¸è§å‘½ä»¤æœ‰ï¼š</p><ul><li>SADD key member â€¦ ï¼šå‘setä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </li><li>SREM key member â€¦ : ç§»é™¤setä¸­çš„æŒ‡å®šå…ƒç´ </li><li>SCARD keyï¼š è¿”å›setä¸­å…ƒç´ çš„ä¸ªæ•°</li><li>SISMEMBER key memberï¼šåˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºsetä¸­</li><li>SMEMBERSï¼šè·å–setä¸­çš„æ‰€æœ‰å…ƒç´ </li><li>SINTER key1 key2 â€¦ ï¼šæ±‚key1ä¸key2çš„äº¤é›†</li></ul><h3 id="3-5-SortedSetæœ‰åºé›†åˆæ“ä½œå‘½ä»¤">3.5 SortedSetæœ‰åºé›†åˆæ“ä½œå‘½ä»¤</h3><p>Redisçš„SortedSetæ˜¯ä¸€ä¸ªå¯æ’åºçš„seté›†åˆï¼Œä¸Javaä¸­çš„TreeSetæœ‰äº›ç±»ä¼¼ï¼Œä½†åº•å±‚æ•°æ®ç»“æ„å´å·®åˆ«å¾ˆå¤§ã€‚SortedSetä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½å¸¦æœ‰ä¸€ä¸ªscoreå±æ€§ï¼Œå¯ä»¥åŸºäºscoreå±æ€§å¯¹å…ƒç´ æ’åºï¼Œåº•å±‚çš„å®ç°æ˜¯ä¸€ä¸ªè·³è¡¨ï¼ˆSkipListï¼‰åŠ  hashè¡¨ã€‚</p><p>SortedSetå…·å¤‡ä¸‹åˆ—ç‰¹æ€§ï¼š</p><ul><li>å¯æ’åº</li><li>å…ƒç´ ä¸é‡å¤</li><li>æŸ¥è¯¢é€Ÿåº¦å¿«</li></ul><p>å› ä¸ºSortedSetçš„å¯æ’åºç‰¹æ€§ï¼Œç»å¸¸è¢«ç”¨æ¥å®ç°æ’è¡Œæ¦œè¿™æ ·çš„åŠŸèƒ½ã€‚</p><p>å¸¸ç”¨å‘½ä»¤ï¼š</p><ul><li>ZADD key score memberï¼šæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ åˆ°sorted set ï¼Œå¦‚æœå·²ç»å­˜åœ¨åˆ™æ›´æ–°å…¶scoreå€¼</li><li>ZREM key memberï¼šåˆ é™¤sorted setä¸­çš„ä¸€ä¸ªæŒ‡å®šå…ƒç´ </li><li>ZSCORE key member : è·å–sorted setä¸­çš„æŒ‡å®šå…ƒç´ çš„scoreå€¼</li><li>ZRANK key memberï¼šè·å–sorted set ä¸­çš„æŒ‡å®šå…ƒç´ çš„æ’å</li><li>ZCARD keyï¼šè·å–sorted setä¸­çš„å…ƒç´ ä¸ªæ•°</li><li>ZCOUNT key min maxï¼šç»Ÿè®¡scoreå€¼åœ¨ç»™å®šèŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ çš„ä¸ªæ•°</li><li>ZINCRBY key increment memberï¼šè®©sorted setä¸­çš„æŒ‡å®šå…ƒç´ è‡ªå¢ï¼Œæ­¥é•¿ä¸ºæŒ‡å®šçš„incrementå€¼</li><li>ZRANGE key min maxï¼šæŒ‰ç…§scoreæ’åºåï¼Œè·å–æŒ‡å®šæ’åèŒƒå›´å†…çš„å…ƒç´ </li><li>ZRANGEBYSCORE key min maxï¼šæŒ‰ç…§scoreæ’åºåï¼Œè·å–æŒ‡å®šscoreèŒƒå›´å†…çš„å…ƒç´ </li><li>ZDIFFã€ZINTERã€ZUNIONï¼šæ±‚å·®é›†ã€äº¤é›†ã€å¹¶é›†</li><li>æ³¨æ„ï¼šæ‰€æœ‰çš„æ’åé»˜è®¤éƒ½æ˜¯å‡åºï¼Œå¦‚æœè¦é™åºåˆ™åœ¨å‘½ä»¤çš„Zåé¢æ·»åŠ REVå³å¯ï¼Œä¾‹å¦‚ï¼š</li><li><strong>å‡åº</strong>è·å–sorted set ä¸­çš„æŒ‡å®šå…ƒç´ çš„æ’åï¼šZRANK key member</li><li><strong>é™åº</strong>è·å–sorted set ä¸­çš„æŒ‡å®šå…ƒç´ çš„æ’åï¼šZREVRANK key memeber</li></ul><p>æ³¨æ„ï¼šæ‰€æœ‰çš„æ’åé»˜è®¤éƒ½æ˜¯å‡åºï¼Œå¦‚æœè¦é™åºåˆ™åœ¨å‘½ä»¤çš„Zåé¢æ·»åŠ REVå³å¯ï¼Œä¾‹å¦‚ï¼š</p><ul><li><strong>å‡åº</strong>è·å–sorted set ä¸­çš„æŒ‡å®šå…ƒç´ çš„æ’åï¼šZRANK key member</li><li><strong>é™åº</strong>è·å–sorted set ä¸­çš„æŒ‡å®šå…ƒç´ çš„æ’åï¼šZREVRANK key memeber</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-17.png" alt="img"></p><h3 id="3-6-é€šç”¨å‘½ä»¤">3.6 é€šç”¨å‘½ä»¤</h3><p>Redisçš„é€šç”¨å‘½ä»¤æ˜¯ä¸åˆ†æ•°æ®ç±»å‹çš„ï¼Œéƒ½å¯ä»¥ä½¿ç”¨çš„å‘½ä»¤ï¼š</p><ul><li>KEYS pattern æŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆç»™å®šæ¨¡å¼( pattern)çš„ key</li><li>EXISTS key æ£€æŸ¥ç»™å®š key æ˜¯å¦å­˜åœ¨</li><li>TYPE key è¿”å› key æ‰€å‚¨å­˜çš„å€¼çš„ç±»å‹</li><li>DEL key è¯¥å‘½ä»¤ç”¨äºåœ¨ key å­˜åœ¨æ˜¯åˆ é™¤ key</li><li>EXPIRE key ç»™ä¸€ä¸ªkeyè®¾ç½®æœ‰æ•ˆæœŸï¼Œæœ‰æ•ˆæœŸåˆ°æœŸæ—¶keyä¼šè‡ªåŠ¨åˆ é™¤</li><li>TTL key æŸ¥çœ‹ä¸€ä¸ªkeyçš„å‰©ä½™æœ‰æ•ˆæœŸ(-1æ°¸ä¹…ï¼Œ-2è¢«ç§»é™¤)</li></ul><h3 id="3-7-Keyç»“æ„">3.7 Keyç»“æ„</h3><p>Redisæ²¡æœ‰ç±»ä¼¼MySQLä¸­çš„Tableçš„æ¦‚å¿µï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•åŒºåˆ†ä¸åŒç±»å‹çš„keyå‘¢ï¼Ÿ</p><p>ä¾‹å¦‚ï¼Œéœ€è¦å­˜å‚¨ç”¨æˆ·ã€å•†å“ä¿¡æ¯åˆ°redisï¼Œæœ‰ä¸€ä¸ªç”¨æˆ·idæ˜¯1ï¼Œæœ‰ä¸€ä¸ªå•†å“idæ°å¥½ä¹Ÿæ˜¯1ï¼Œæ­¤æ—¶å¦‚æœä½¿ç”¨idä½œä¸ºkeyï¼Œé‚£å°±ä¼šå†²çªäº†ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»™keyæ·»åŠ å‰ç¼€åŠ ä»¥åŒºåˆ†ï¼Œä¸è¿‡è¿™ä¸ªå‰ç¼€ä¸æ˜¯éšä¾¿åŠ çš„ï¼Œæœ‰ä¸€å®šçš„è§„èŒƒï¼š</p><p>Redisçš„keyå…è®¸æœ‰å¤šä¸ªå•è¯å½¢æˆå±‚çº§ç»“æ„ï¼Œå¤šä¸ªå•è¯ä¹‹é—´ç”¨â€™:'éš”å¼€ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é¡¹ç›®å:ä¸šåŠ¡å:ç±»å‹:<span class="built_in">id</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ ¼å¼å¹¶éå›ºå®šï¼Œä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥åˆ é™¤æˆ–æ·»åŠ è¯æ¡ã€‚è¿™æ ·ä»¥æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠä¸åŒç±»å‹çš„æ•°æ®åŒºåˆ†å¼€äº†ã€‚ä»è€Œé¿å…äº†keyçš„å†²çªé—®é¢˜ã€‚</p><p>ä¾‹å¦‚æˆ‘ä»¬çš„é¡¹ç›®åç§°å« heimaï¼Œæœ‰userå’Œproductä¸¤ç§ä¸åŒç±»å‹çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å®šä¹‰keyï¼š</p><ul><li>userç›¸å…³çš„keyï¼š<strong>heima:user:1</strong></li><li>productç›¸å…³çš„keyï¼š<strong>heima:product:1</strong></li></ul><p>å¦‚æœValueæ˜¯ä¸€ä¸ªJavaå¯¹è±¡ï¼Œä¾‹å¦‚ä¸€ä¸ªUserå¯¹è±¡ï¼Œåˆ™å¯ä»¥å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²åå­˜å‚¨ï¼š</p><table><thead><tr><th><strong>KEY</strong></th><th><strong>VALUE</strong></th></tr></thead><tbody><tr><td>heima:user:1</td><td>{â€œidâ€:1, â€œnameâ€: â€œJackâ€, â€œageâ€: 21}</td></tr><tr><td>heima:product:1</td><td>{â€œidâ€:1, â€œnameâ€: â€œå°ç±³11â€, â€œpriceâ€: 4999}</td></tr></tbody></table><p>å¹¶ä¸”ï¼Œåœ¨Redisçš„æ¡Œé¢å®¢æˆ·ç«¯ä¸­ï¼Œè¿˜ä¼šä»¥ç›¸åŒå‰ç¼€ä½œä¸ºå±‚çº§ç»“æ„ï¼Œè®©æ•°æ®çœ‹èµ·æ¥å±‚æ¬¡åˆ†æ˜ï¼Œå…³ç³»æ¸…æ™°ã€‚</p><h2 id="4-åœ¨Javaä¸­æ“ä½œRedis">4.åœ¨Javaä¸­æ“ä½œRedis</h2><h3 id="4-1-Redisçš„Javaå®¢æˆ·ç«¯">4.1 Redisçš„Javaå®¢æˆ·ç«¯</h3><p>å‰é¢æˆ‘ä»¬è®²è§£äº†Redisçš„å¸¸ç”¨å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤æ˜¯æˆ‘ä»¬æ“ä½œRedisçš„åŸºç¡€ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨javaç¨‹åºä¸­åº”è¯¥å¦‚ä½•æ“ä½œRediså‘¢ï¼Ÿè¿™å°±éœ€è¦ä½¿ç”¨Redisçš„Javaå®¢æˆ·ç«¯ï¼Œå°±å¦‚åŒæˆ‘ä»¬ä½¿ç”¨JDBCæ“ä½œMySQLæ•°æ®åº“ä¸€æ ·ã€‚</p><p>Redis çš„ Java å®¢æˆ·ç«¯å¾ˆå¤šï¼Œå¸¸ç”¨çš„å‡ ç§ï¼š</p><ul><li>Jedis</li><li>Lettuce</li><li>Spring Data Redis</li></ul><p>Spring å¯¹ Redis å®¢æˆ·ç«¯è¿›è¡Œäº†æ•´åˆï¼Œæä¾›äº† Spring Data Redisï¼Œåœ¨Spring Booté¡¹ç›®ä¸­è¿˜æä¾›äº†å¯¹åº”çš„Starterï¼Œå³ spring-boot-starter-data-redisã€‚</p><p>æˆ‘ä»¬é‡ç‚¹å­¦ä¹ <strong>Spring Data Redis</strong>ã€‚</p><h4 id="4-1-1Jediså®¢æˆ·ç«¯">4.1.1Jediså®¢æˆ·ç«¯</h4><p>Jedisçš„å®˜ç½‘åœ°å€ï¼š <a href="https://github.com/redis/jedis">https://github.com/redis/jedis</a>   ï¼ˆå¿«é€Ÿå…¥é—¨ï¼‰</p><h4 id="4-1-2-SpringDataRediså®¢æˆ·ç«¯">4.1.2 SpringDataRediså®¢æˆ·ç«¯</h4><p>SpringDataæ˜¯Springä¸­æ•°æ®æ“ä½œçš„æ¨¡å—ï¼ŒåŒ…å«å¯¹å„ç§æ•°æ®åº“çš„é›†æˆï¼Œå…¶ä¸­å¯¹Redisçš„é›†æˆæ¨¡å—å°±å«åšSpringDataRedisï¼Œå®˜ç½‘åœ°å€ï¼š<a href="https://spring.io/projects/spring-data-redis">https://spring.io/projects/spring-data-redis</a></p><ul><li>æä¾›äº†å¯¹ä¸åŒRediså®¢æˆ·ç«¯çš„æ•´åˆï¼ˆLettuceå’ŒJedisï¼‰</li><li>æä¾›äº†RedisTemplateç»Ÿä¸€APIæ¥æ“ä½œRedis</li><li>æ”¯æŒRedisçš„å‘å¸ƒè®¢é˜…æ¨¡å‹</li><li>æ”¯æŒRediså“¨å…µå’ŒRedisé›†ç¾¤</li><li>æ”¯æŒåŸºäºLettuceçš„å“åº”å¼ç¼–ç¨‹</li><li>æ”¯æŒåŸºäºJDKã€JSONã€å­—ç¬¦ä¸²ã€Springå¯¹è±¡çš„æ•°æ®åºåˆ—åŒ–åŠååºåˆ—åŒ–</li><li>æ”¯æŒåŸºäºRedisçš„JDKCollectionå®ç°</li></ul><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-18-1024x331.png" alt="img"></p><p><strong>ç¯å¢ƒæ­å»º</strong>ï¼š</p><p><strong>1). å¯¼å…¥Spring Data Redisçš„mavenåæ ‡</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>2). é…ç½®Redisæ•°æ®æº</strong></p><p>åœ¨application-dev.ymlä¸­æ·»åŠ </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sky:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">10</span></span><br><span class="line">    <span class="attr">lettuce:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">8</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">8</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">0</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="string">100ms</span></span><br></pre></td></tr></table></figure><p>database:æŒ‡å®šä½¿ç”¨Redisçš„å“ªä¸ªæ•°æ®åº“ï¼ŒRedisæœåŠ¡å¯åŠ¨åé»˜è®¤æœ‰16ä¸ªæ•°æ®åº“ï¼Œç¼–å·åˆ†åˆ«æ˜¯ä»0åˆ°15ã€‚</p><p>å¯ä»¥é€šè¿‡ä¿®æ”¹Redisé…ç½®æ–‡ä»¶æ¥æŒ‡å®šæ•°æ®åº“çš„æ•°é‡ã€‚</p><p>åœ¨application.ymlä¸­æ·»åŠ è¯»å–application-dev.ymlä¸­çš„ç›¸å…³Redisé…ç½®</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">spring:</span></span><br><span class="line"><span class="symbol">  profiles:</span></span><br><span class="line"><span class="symbol">    active:</span> dev</span><br><span class="line"><span class="symbol">  redis:</span></span><br><span class="line"><span class="symbol">    host:</span> $<span class="punctuation">&#123;</span>sky.redis.host<span class="punctuation">&#125;</span></span><br><span class="line"><span class="symbol">    port:</span> $<span class="punctuation">&#123;</span>sky.redis.port<span class="punctuation">&#125;</span></span><br><span class="line"><span class="symbol">    password:</span> $<span class="punctuation">&#123;</span>sky.redis.password<span class="punctuation">&#125;</span></span><br><span class="line"><span class="symbol">    database:</span> $<span class="punctuation">&#123;</span>sky.redis.database<span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>3). ç¼–å†™é…ç½®ç±»ï¼Œåˆ›å»ºRedisTemplateå¯¹è±¡</strong>ï¼Œè‡ªå®šä¹‰RedisTemplateçš„åºåˆ—åŒ–æ–¹å¼</p><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> RedisConfig &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory connectionFactory)&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºRedisTemplateå¯¹è±¡</span></span><br><span class="line">        RedisTemplate&lt;String, Object&gt; <span class="keyword">template</span> = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        <span class="comment">// è®¾ç½®è¿æ¥å·¥å‚</span></span><br><span class="line">        <span class="keyword">template</span>.setConnectionFactory(connectionFactory);</span><br><span class="line">        <span class="comment">// åˆ›å»ºJSONåºåˆ—åŒ–å·¥å…·</span></span><br><span class="line">        GenericJackson2JsonRedisSerializer jsonRedisSerializer = </span><br><span class="line">            <span class="keyword">new</span> GenericJackson2JsonRedisSerializer();</span><br><span class="line">        <span class="comment">// è®¾ç½®Keyçš„åºåˆ—åŒ–</span></span><br><span class="line">        <span class="keyword">template</span>.setKeySerializer(RedisSerializer.<span class="built_in">string</span>());</span><br><span class="line">        <span class="keyword">template</span>.setHashKeySerializer(RedisSerializer.<span class="built_in">string</span>());</span><br><span class="line">        <span class="comment">// è®¾ç½®Valueçš„åºåˆ—åŒ–</span></span><br><span class="line">        <span class="keyword">template</span>.setValueSerializer(jsonRedisSerializer);</span><br><span class="line">        <span class="keyword">template</span>.setHashValueSerializer(jsonRedisSerializer);</span><br><span class="line">        <span class="comment">// è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">template</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-19-1024x210.png" alt="img"></p><p>ç¼ºç‚¹ï¼š</p><ul><li>å¯è¯»æ€§å·®</li><li>å†…å­˜å ç”¨è¾ƒå¤§</li></ul><p>è¿™é‡Œé‡‡ç”¨äº†JSONåºåˆ—åŒ–æ¥ä»£æ›¿é»˜è®¤çš„JDKåºåˆ—åŒ–æ–¹å¼ã€‚æœ€ç»ˆç»“æœå¦‚å›¾ï¼š</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-20-1024x326.png" alt="img"></p><p>*<strong>ä¸ºäº†èŠ‚çœå†…å­˜ç©ºé—´*</strong>ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ä½¿ç”¨JSONåºåˆ—åŒ–å™¨æ¥å¤„ç†valueï¼Œè€Œæ˜¯ç»Ÿä¸€ä½¿ç”¨Stringåºåˆ—åŒ–å™¨ï¼Œè¦æ±‚åªèƒ½å­˜å‚¨Stringç±»å‹çš„keyå’Œvalueã€‚å½“éœ€è¦å­˜å‚¨Javaå¯¹è±¡æ—¶ï¼Œæ‰‹åŠ¨å®Œæˆå¯¹è±¡çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-21-1024x352.png" alt="img"></p><p>StringRedisTemplateï¼Œå®ƒçš„keyå’Œvalueçš„åºåˆ—åŒ–æ–¹å¼é»˜è®¤å°±æ˜¯Stringæ–¹å¼ã€‚</p><p>çœå»äº†æˆ‘ä»¬è‡ªå®šä¹‰RedisTemplateçš„åºåˆ—åŒ–æ–¹å¼çš„æ­¥éª¤ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"><span class="comment">// JSONåºåˆ—åŒ–å·¥å…·</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testSaveUser</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;è™å“¥&quot;</span>, <span class="number">21</span>);</span><br><span class="line">    <span class="comment">// æ‰‹åŠ¨åºåˆ—åŒ–</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> mapper.writeValueAsString(user);</span><br><span class="line">    <span class="comment">// å†™å…¥æ•°æ®</span></span><br><span class="line">    stringRedisTemplate.opsForValue().set(<span class="string">&quot;user:200&quot;</span>, json);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–æ•°æ®</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">jsonUser</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(<span class="string">&quot;user:200&quot;</span>);</span><br><span class="line">    <span class="comment">// æ‰‹åŠ¨ååºåˆ—åŒ–</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> mapper.readValue(jsonUser, User.class);</span><br><span class="line">    System.out.println(<span class="string">&quot;user1 = &quot;</span> + user1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å°ç»“ï¼šRedisTemplate å’Œ StringRedisTemplate</strong></p><p><code>**RedisTemplate**</code>ï¼ˆæ³›å‹é€šç”¨ï¼‰ï¼š</p><ul><li>æ˜¯ä¸€ä¸ª<strong>é€šç”¨çš„ Redis æ“ä½œæ¨¡æ¿</strong>ï¼Œæ”¯æŒä»»æ„ç±»å‹çš„ key å’Œ valueï¼ˆé€šè¿‡æ³›å‹æ§åˆ¶ï¼‰ï¼Œä¾‹å¦‚å¯¹è±¡ã€åˆ—è¡¨ã€å“ˆå¸Œç­‰ã€‚</li><li>éœ€è¦è‡ªå·±é…ç½®åºåˆ—åŒ–å™¨ï¼ˆæ¯”å¦‚ <code>Jackson2JsonRedisSerializer</code>ï¼‰æ¥å¤„ç† key/value çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</li></ul><p><code>**StringRedisTemplate**</code>ï¼ˆä¸“é—¨é’ˆå¯¹å­—ç¬¦ä¸²ï¼‰</p><ul><li>æ˜¯ <code>RedisTemplate&lt;String, String&gt;</code> çš„ä¸€ä¸ª<strong>ä¸“ç”¨å­ç±»</strong>ã€‚</li><li>å†…éƒ¨å·²ç»é»˜è®¤è®¾ç½®å¥½äº†å­—ç¬¦ä¸²çš„åºåˆ—åŒ–æ–¹å¼ï¼Œé€‚åˆ key å’Œ value éƒ½æ˜¯å­—ç¬¦ä¸²çš„åœºæ™¯ã€‚</li><li>ä½¿ç”¨æ›´ç®€å•ç›´è§‚ï¼Œå¸¸ç”¨äºç¼“å­˜ç®€å•å­—ç¬¦ä¸²å€¼ï¼Œå¦‚ï¼š</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stringRedisTemplate.opsForValue().<span class="built_in">set</span>(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>);</span><br></pre></td></tr></table></figure><p><img src="https://www.legendkiller.xyz/wp-content/uploads/2025/05/image-22.png" alt="img"></p><h1 id="RedisåŸºç¡€ç¯‡å®Œç»“"><strong>RedisåŸºç¡€ç¯‡å®Œç»“</strong></h1>]]></content>
    
    
    <summary type="html">é»‘é©¬ç¨‹åºå‘˜Redisä¸‰éƒ¨æ›²ä¸Šç¯‡-åŸºç¡€ç¯‡ï¼ˆåˆå§‹Redisã€æ•°æ®ç±»å‹ã€å¸¸ç”¨å‘½ä»¤ã€javaä¸­æ“ä½œRedisï¼‰</summary>
    
    
    
    <category term="Redis" scheme="https://itgeqian.github.io/categories/Redis/"/>
    
    
    <category term="Redis" scheme="https://itgeqian.github.io/tags/Redis/"/>
    
  </entry>
  
</feed>
